var JM=t=>{throw TypeError(t)};var mT=(t,i,c)=>i.has(t)||JM("Cannot "+c);var Mt=(t,i,c)=>(mT(t,i,"read from private field"),c?c.call(t):i.get(t)),Ni=(t,i,c)=>i.has(t)?JM("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(t):i.set(t,c),si=(t,i,c,f)=>(mT(t,i,"write to private field"),f?f.call(t,c):i.set(t,c),c),Hs=(t,i,c)=>(mT(t,i,"access private method"),c);var n0=(t,i,c,f)=>({set _(_){si(t,i,_,c)},get _(){return Mt(t,i,f)}});function UV(t,i){for(var c=0;c<i.length;c++){const f=i[c];if(typeof f!="string"&&!Array.isArray(f)){for(const _ in f)if(_!=="default"&&!(_ in t)){const w=Object.getOwnPropertyDescriptor(f,_);w&&Object.defineProperty(t,_,w.get?w:{enumerable:!0,get:()=>f[_]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))f(_);new MutationObserver(_=>{for(const w of _)if(w.type==="childList")for(const E of w.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&f(E)}).observe(document,{childList:!0,subtree:!0});function c(_){const w={};return _.integrity&&(w.integrity=_.integrity),_.referrerPolicy&&(w.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?w.credentials="include":_.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function f(_){if(_.ep)return;_.ep=!0;const w=c(_);fetch(_.href,w)}})();var GV=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function O1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var OL={exports:{}},F1={},FL={exports:{}},Mi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xy=Symbol.for("react.element"),$V=Symbol.for("react.portal"),HV=Symbol.for("react.fragment"),WV=Symbol.for("react.strict_mode"),qV=Symbol.for("react.profiler"),ZV=Symbol.for("react.provider"),XV=Symbol.for("react.context"),KV=Symbol.for("react.forward_ref"),YV=Symbol.for("react.suspense"),JV=Symbol.for("react.memo"),QV=Symbol.for("react.lazy"),QM=Symbol.iterator;function eU(t){return t===null||typeof t!="object"?null:(t=QM&&t[QM]||t["@@iterator"],typeof t=="function"?t:null)}var NL={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},BL=Object.assign,jL={};function bm(t,i,c){this.props=t,this.context=i,this.refs=jL,this.updater=c||NL}bm.prototype.isReactComponent={};bm.prototype.setState=function(t,i){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,i,"setState")};bm.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function VL(){}VL.prototype=bm.prototype;function J2(t,i,c){this.props=t,this.context=i,this.refs=jL,this.updater=c||NL}var Q2=J2.prototype=new VL;Q2.constructor=J2;BL(Q2,bm.prototype);Q2.isPureReactComponent=!0;var eR=Array.isArray,UL=Object.prototype.hasOwnProperty,eE={current:null},GL={key:!0,ref:!0,__self:!0,__source:!0};function $L(t,i,c){var f,_={},w=null,E=null;if(i!=null)for(f in i.ref!==void 0&&(E=i.ref),i.key!==void 0&&(w=""+i.key),i)UL.call(i,f)&&!GL.hasOwnProperty(f)&&(_[f]=i[f]);var o=arguments.length-2;if(o===1)_.children=c;else if(1<o){for(var k=Array(o),L=0;L<o;L++)k[L]=arguments[L+2];_.children=k}if(t&&t.defaultProps)for(f in o=t.defaultProps,o)_[f]===void 0&&(_[f]=o[f]);return{$$typeof:Xy,type:t,key:w,ref:E,props:_,_owner:eE.current}}function tU(t,i){return{$$typeof:Xy,type:t.type,key:i,ref:t.ref,props:t.props,_owner:t._owner}}function tE(t){return typeof t=="object"&&t!==null&&t.$$typeof===Xy}function nU(t){var i={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(c){return i[c]})}var tR=/\/+/g;function gT(t,i){return typeof t=="object"&&t!==null&&t.key!=null?nU(""+t.key):i.toString(36)}function M0(t,i,c,f,_){var w=typeof t;(w==="undefined"||w==="boolean")&&(t=null);var E=!1;if(t===null)E=!0;else switch(w){case"string":case"number":E=!0;break;case"object":switch(t.$$typeof){case Xy:case $V:E=!0}}if(E)return E=t,_=_(E),t=f===""?"."+gT(E,0):f,eR(_)?(c="",t!=null&&(c=t.replace(tR,"$&/")+"/"),M0(_,i,c,"",function(L){return L})):_!=null&&(tE(_)&&(_=tU(_,c+(!_.key||E&&E.key===_.key?"":(""+_.key).replace(tR,"$&/")+"/")+t)),i.push(_)),1;if(E=0,f=f===""?".":f+":",eR(t))for(var o=0;o<t.length;o++){w=t[o];var k=f+gT(w,o);E+=M0(w,i,c,k,_)}else if(k=eU(t),typeof k=="function")for(t=k.call(t),o=0;!(w=t.next()).done;)w=w.value,k=f+gT(w,o++),E+=M0(w,i,c,k,_);else if(w==="object")throw i=String(t),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return E}function i0(t,i,c){if(t==null)return t;var f=[],_=0;return M0(t,f,"","",function(w){return i.call(c,w,_++)}),f}function iU(t){if(t._status===-1){var i=t._result;i=i(),i.then(function(c){(t._status===0||t._status===-1)&&(t._status=1,t._result=c)},function(c){(t._status===0||t._status===-1)&&(t._status=2,t._result=c)}),t._status===-1&&(t._status=0,t._result=i)}if(t._status===1)return t._result.default;throw t._result}var So={current:null},R0={transition:null},rU={ReactCurrentDispatcher:So,ReactCurrentBatchConfig:R0,ReactCurrentOwner:eE};function HL(){throw Error("act(...) is not supported in production builds of React.")}Mi.Children={map:i0,forEach:function(t,i,c){i0(t,function(){i.apply(this,arguments)},c)},count:function(t){var i=0;return i0(t,function(){i++}),i},toArray:function(t){return i0(t,function(i){return i})||[]},only:function(t){if(!tE(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Mi.Component=bm;Mi.Fragment=HV;Mi.Profiler=qV;Mi.PureComponent=J2;Mi.StrictMode=WV;Mi.Suspense=YV;Mi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rU;Mi.act=HL;Mi.cloneElement=function(t,i,c){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var f=BL({},t.props),_=t.key,w=t.ref,E=t._owner;if(i!=null){if(i.ref!==void 0&&(w=i.ref,E=eE.current),i.key!==void 0&&(_=""+i.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(k in i)UL.call(i,k)&&!GL.hasOwnProperty(k)&&(f[k]=i[k]===void 0&&o!==void 0?o[k]:i[k])}var k=arguments.length-2;if(k===1)f.children=c;else if(1<k){o=Array(k);for(var L=0;L<k;L++)o[L]=arguments[L+2];f.children=o}return{$$typeof:Xy,type:t.type,key:_,ref:w,props:f,_owner:E}};Mi.createContext=function(t){return t={$$typeof:XV,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:ZV,_context:t},t.Consumer=t};Mi.createElement=$L;Mi.createFactory=function(t){var i=$L.bind(null,t);return i.type=t,i};Mi.createRef=function(){return{current:null}};Mi.forwardRef=function(t){return{$$typeof:KV,render:t}};Mi.isValidElement=tE;Mi.lazy=function(t){return{$$typeof:QV,_payload:{_status:-1,_result:t},_init:iU}};Mi.memo=function(t,i){return{$$typeof:JV,type:t,compare:i===void 0?null:i}};Mi.startTransition=function(t){var i=R0.transition;R0.transition={};try{t()}finally{R0.transition=i}};Mi.unstable_act=HL;Mi.useCallback=function(t,i){return So.current.useCallback(t,i)};Mi.useContext=function(t){return So.current.useContext(t)};Mi.useDebugValue=function(){};Mi.useDeferredValue=function(t){return So.current.useDeferredValue(t)};Mi.useEffect=function(t,i){return So.current.useEffect(t,i)};Mi.useId=function(){return So.current.useId()};Mi.useImperativeHandle=function(t,i,c){return So.current.useImperativeHandle(t,i,c)};Mi.useInsertionEffect=function(t,i){return So.current.useInsertionEffect(t,i)};Mi.useLayoutEffect=function(t,i){return So.current.useLayoutEffect(t,i)};Mi.useMemo=function(t,i){return So.current.useMemo(t,i)};Mi.useReducer=function(t,i,c){return So.current.useReducer(t,i,c)};Mi.useRef=function(t){return So.current.useRef(t)};Mi.useState=function(t){return So.current.useState(t)};Mi.useSyncExternalStore=function(t,i,c){return So.current.useSyncExternalStore(t,i,c)};Mi.useTransition=function(){return So.current.useTransition()};Mi.version="18.3.1";FL.exports=Mi;var fe=FL.exports;const Ka=O1(fe),nE=UV({__proto__:null,default:Ka},[fe]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sU=fe,oU=Symbol.for("react.element"),aU=Symbol.for("react.fragment"),lU=Object.prototype.hasOwnProperty,cU=sU.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,uU={key:!0,ref:!0,__self:!0,__source:!0};function WL(t,i,c){var f,_={},w=null,E=null;c!==void 0&&(w=""+c),i.key!==void 0&&(w=""+i.key),i.ref!==void 0&&(E=i.ref);for(f in i)lU.call(i,f)&&!uU.hasOwnProperty(f)&&(_[f]=i[f]);if(t&&t.defaultProps)for(f in i=t.defaultProps,i)_[f]===void 0&&(_[f]=i[f]);return{$$typeof:oU,type:t,key:w,ref:E,props:_,_owner:cU.current}}F1.Fragment=aU;F1.jsx=WL;F1.jsxs=WL;OL.exports=F1;var B=OL.exports,xS={},qL={exports:{}},na={},ZL={exports:{}},XL={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function i(Nt,sn){var Tn=Nt.length;Nt.push(sn);e:for(;0<Tn;){var on=Tn-1>>>1,Xn=Nt[on];if(0<_(Xn,sn))Nt[on]=sn,Nt[Tn]=Xn,Tn=on;else break e}}function c(Nt){return Nt.length===0?null:Nt[0]}function f(Nt){if(Nt.length===0)return null;var sn=Nt[0],Tn=Nt.pop();if(Tn!==sn){Nt[0]=Tn;e:for(var on=0,Xn=Nt.length,_r=Xn>>>1;on<_r;){var ir=2*(on+1)-1,Qr=Nt[ir],Vn=ir+1,Wn=Nt[Vn];if(0>_(Qr,Tn))Vn<Xn&&0>_(Wn,Qr)?(Nt[on]=Wn,Nt[Vn]=Tn,on=Vn):(Nt[on]=Qr,Nt[ir]=Tn,on=ir);else if(Vn<Xn&&0>_(Wn,Tn))Nt[on]=Wn,Nt[Vn]=Tn,on=Vn;else break e}}return sn}function _(Nt,sn){var Tn=Nt.sortIndex-sn.sortIndex;return Tn!==0?Tn:Nt.id-sn.id}if(typeof performance=="object"&&typeof performance.now=="function"){var w=performance;t.unstable_now=function(){return w.now()}}else{var E=Date,o=E.now();t.unstable_now=function(){return E.now()-o}}var k=[],L=[],N=1,V=null,H=3,ne=!1,ce=!1,K=!1,se=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,Q=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ae(Nt){for(var sn=c(L);sn!==null;){if(sn.callback===null)f(L);else if(sn.startTime<=Nt)f(L),sn.sortIndex=sn.expirationTime,i(k,sn);else break;sn=c(L)}}function Te(Nt){if(K=!1,ae(Nt),!ce)if(c(k)!==null)ce=!0,pn(Be);else{var sn=c(L);sn!==null&&Rn(Te,sn.startTime-Nt)}}function Be(Nt,sn){ce=!1,K&&(K=!1,Y(Je),Je=-1),ne=!0;var Tn=H;try{for(ae(sn),V=c(k);V!==null&&(!(V.expirationTime>sn)||Nt&&!xt());){var on=V.callback;if(typeof on=="function"){V.callback=null,H=V.priorityLevel;var Xn=on(V.expirationTime<=sn);sn=t.unstable_now(),typeof Xn=="function"?V.callback=Xn:V===c(k)&&f(k),ae(sn)}else f(k);V=c(k)}if(V!==null)var _r=!0;else{var ir=c(L);ir!==null&&Rn(Te,ir.startTime-sn),_r=!1}return _r}finally{V=null,H=Tn,ne=!1}}var et=!1,nt=null,Je=-1,Dt=5,wt=-1;function xt(){return!(t.unstable_now()-wt<Dt)}function qt(){if(nt!==null){var Nt=t.unstable_now();wt=Nt;var sn=!0;try{sn=nt(!0,Nt)}finally{sn?ln():(et=!1,nt=null)}}else et=!1}var ln;if(typeof Q=="function")ln=function(){Q(qt)};else if(typeof MessageChannel<"u"){var Ht=new MessageChannel,cn=Ht.port2;Ht.port1.onmessage=qt,ln=function(){cn.postMessage(null)}}else ln=function(){se(qt,0)};function pn(Nt){nt=Nt,et||(et=!0,ln())}function Rn(Nt,sn){Je=se(function(){Nt(t.unstable_now())},sn)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Nt){Nt.callback=null},t.unstable_continueExecution=function(){ce||ne||(ce=!0,pn(Be))},t.unstable_forceFrameRate=function(Nt){0>Nt||125<Nt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Dt=0<Nt?Math.floor(1e3/Nt):5},t.unstable_getCurrentPriorityLevel=function(){return H},t.unstable_getFirstCallbackNode=function(){return c(k)},t.unstable_next=function(Nt){switch(H){case 1:case 2:case 3:var sn=3;break;default:sn=H}var Tn=H;H=sn;try{return Nt()}finally{H=Tn}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Nt,sn){switch(Nt){case 1:case 2:case 3:case 4:case 5:break;default:Nt=3}var Tn=H;H=Nt;try{return sn()}finally{H=Tn}},t.unstable_scheduleCallback=function(Nt,sn,Tn){var on=t.unstable_now();switch(typeof Tn=="object"&&Tn!==null?(Tn=Tn.delay,Tn=typeof Tn=="number"&&0<Tn?on+Tn:on):Tn=on,Nt){case 1:var Xn=-1;break;case 2:Xn=250;break;case 5:Xn=1073741823;break;case 4:Xn=1e4;break;default:Xn=5e3}return Xn=Tn+Xn,Nt={id:N++,callback:sn,priorityLevel:Nt,startTime:Tn,expirationTime:Xn,sortIndex:-1},Tn>on?(Nt.sortIndex=Tn,i(L,Nt),c(k)===null&&Nt===c(L)&&(K?(Y(Je),Je=-1):K=!0,Rn(Te,Tn-on))):(Nt.sortIndex=Xn,i(k,Nt),ce||ne||(ce=!0,pn(Be))),Nt},t.unstable_shouldYield=xt,t.unstable_wrapCallback=function(Nt){var sn=H;return function(){var Tn=H;H=sn;try{return Nt.apply(this,arguments)}finally{H=Tn}}}})(XL);ZL.exports=XL;var hU=ZL.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dU=fe,ea=hU;function Zt(t){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+t,c=1;c<arguments.length;c++)i+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+t+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var KL=new Set,py={};function Vd(t,i){hm(t,i),hm(t+"Capture",i)}function hm(t,i){for(py[t]=i,t=0;t<i.length;t++)KL.add(i[t])}var zc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wS=Object.prototype.hasOwnProperty,fU=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,nR={},iR={};function pU(t){return wS.call(iR,t)?!0:wS.call(nR,t)?!1:fU.test(t)?iR[t]=!0:(nR[t]=!0,!1)}function mU(t,i,c,f){if(c!==null&&c.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return f?!1:c!==null?!c.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function gU(t,i,c,f){if(i===null||typeof i>"u"||mU(t,i,c,f))return!0;if(f)return!1;if(c!==null)switch(c.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function Eo(t,i,c,f,_,w,E){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=f,this.attributeNamespace=_,this.mustUseProperty=c,this.propertyName=t,this.type=i,this.sanitizeURL=w,this.removeEmptyString=E}var Os={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Os[t]=new Eo(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var i=t[0];Os[i]=new Eo(i,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Os[t]=new Eo(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Os[t]=new Eo(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Os[t]=new Eo(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Os[t]=new Eo(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Os[t]=new Eo(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Os[t]=new Eo(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Os[t]=new Eo(t,5,!1,t.toLowerCase(),null,!1,!1)});var iE=/[\-:]([a-z])/g;function rE(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var i=t.replace(iE,rE);Os[i]=new Eo(i,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var i=t.replace(iE,rE);Os[i]=new Eo(i,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var i=t.replace(iE,rE);Os[i]=new Eo(i,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Os[t]=new Eo(t,1,!1,t.toLowerCase(),null,!1,!1)});Os.xlinkHref=new Eo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Os[t]=new Eo(t,1,!1,t.toLowerCase(),null,!0,!0)});function sE(t,i,c,f){var _=Os.hasOwnProperty(i)?Os[i]:null;(_!==null?_.type!==0:f||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(gU(i,c,_,f)&&(c=null),f||_===null?pU(i)&&(c===null?t.removeAttribute(i):t.setAttribute(i,""+c)):_.mustUseProperty?t[_.propertyName]=c===null?_.type===3?!1:"":c:(i=_.attributeName,f=_.attributeNamespace,c===null?t.removeAttribute(i):(_=_.type,c=_===3||_===4&&c===!0?"":""+c,f?t.setAttributeNS(f,i,c):t.setAttribute(i,c))))}var jc=dU.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,r0=Symbol.for("react.element"),Pp=Symbol.for("react.portal"),Mp=Symbol.for("react.fragment"),oE=Symbol.for("react.strict_mode"),bS=Symbol.for("react.profiler"),YL=Symbol.for("react.provider"),JL=Symbol.for("react.context"),aE=Symbol.for("react.forward_ref"),TS=Symbol.for("react.suspense"),SS=Symbol.for("react.suspense_list"),lE=Symbol.for("react.memo"),Nu=Symbol.for("react.lazy"),QL=Symbol.for("react.offscreen"),rR=Symbol.iterator;function C_(t){return t===null||typeof t!="object"?null:(t=rR&&t[rR]||t["@@iterator"],typeof t=="function"?t:null)}var Fr=Object.assign,_T;function V_(t){if(_T===void 0)try{throw Error()}catch(c){var i=c.stack.trim().match(/\n( *(at )?)/);_T=i&&i[1]||""}return`
`+_T+t}var yT=!1;function vT(t,i){if(!t||yT)return"";yT=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(L){var f=L}Reflect.construct(t,[],i)}else{try{i.call()}catch(L){f=L}t.call(i.prototype)}else{try{throw Error()}catch(L){f=L}t()}}catch(L){if(L&&f&&typeof L.stack=="string"){for(var _=L.stack.split(`
`),w=f.stack.split(`
`),E=_.length-1,o=w.length-1;1<=E&&0<=o&&_[E]!==w[o];)o--;for(;1<=E&&0<=o;E--,o--)if(_[E]!==w[o]){if(E!==1||o!==1)do if(E--,o--,0>o||_[E]!==w[o]){var k=`
`+_[E].replace(" at new "," at ");return t.displayName&&k.includes("<anonymous>")&&(k=k.replace("<anonymous>",t.displayName)),k}while(1<=E&&0<=o);break}}}finally{yT=!1,Error.prepareStackTrace=c}return(t=t?t.displayName||t.name:"")?V_(t):""}function _U(t){switch(t.tag){case 5:return V_(t.type);case 16:return V_("Lazy");case 13:return V_("Suspense");case 19:return V_("SuspenseList");case 0:case 2:case 15:return t=vT(t.type,!1),t;case 11:return t=vT(t.type.render,!1),t;case 1:return t=vT(t.type,!0),t;default:return""}}function ES(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Mp:return"Fragment";case Pp:return"Portal";case bS:return"Profiler";case oE:return"StrictMode";case TS:return"Suspense";case SS:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case JL:return(t.displayName||"Context")+".Consumer";case YL:return(t._context.displayName||"Context")+".Provider";case aE:var i=t.render;return t=t.displayName,t||(t=i.displayName||i.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case lE:return i=t.displayName||null,i!==null?i:ES(t.type)||"Memo";case Nu:i=t._payload,t=t._init;try{return ES(t(i))}catch{}}return null}function yU(t){var i=t.type;switch(t.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=i.render,t=t.displayName||t.name||"",i.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ES(i);case 8:return i===oE?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function ah(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function ez(t){var i=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function vU(t){var i=ez(t)?"checked":"value",c=Object.getOwnPropertyDescriptor(t.constructor.prototype,i),f=""+t[i];if(!t.hasOwnProperty(i)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var _=c.get,w=c.set;return Object.defineProperty(t,i,{configurable:!0,get:function(){return _.call(this)},set:function(E){f=""+E,w.call(this,E)}}),Object.defineProperty(t,i,{enumerable:c.enumerable}),{getValue:function(){return f},setValue:function(E){f=""+E},stopTracking:function(){t._valueTracker=null,delete t[i]}}}}function s0(t){t._valueTracker||(t._valueTracker=vU(t))}function tz(t){if(!t)return!1;var i=t._valueTracker;if(!i)return!0;var c=i.getValue(),f="";return t&&(f=ez(t)?t.checked?"true":"false":t.value),t=f,t!==c?(i.setValue(t),!0):!1}function K0(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function IS(t,i){var c=i.checked;return Fr({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??t._wrapperState.initialChecked})}function sR(t,i){var c=i.defaultValue==null?"":i.defaultValue,f=i.checked!=null?i.checked:i.defaultChecked;c=ah(i.value!=null?i.value:c),t._wrapperState={initialChecked:f,initialValue:c,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function nz(t,i){i=i.checked,i!=null&&sE(t,"checked",i,!1)}function AS(t,i){nz(t,i);var c=ah(i.value),f=i.type;if(c!=null)f==="number"?(c===0&&t.value===""||t.value!=c)&&(t.value=""+c):t.value!==""+c&&(t.value=""+c);else if(f==="submit"||f==="reset"){t.removeAttribute("value");return}i.hasOwnProperty("value")?CS(t,i.type,c):i.hasOwnProperty("defaultValue")&&CS(t,i.type,ah(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(t.defaultChecked=!!i.defaultChecked)}function oR(t,i,c){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var f=i.type;if(!(f!=="submit"&&f!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+t._wrapperState.initialValue,c||i===t.value||(t.value=i),t.defaultValue=i}c=t.name,c!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,c!==""&&(t.name=c)}function CS(t,i,c){(i!=="number"||K0(t.ownerDocument)!==t)&&(c==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+c&&(t.defaultValue=""+c))}var U_=Array.isArray;function qp(t,i,c,f){if(t=t.options,i){i={};for(var _=0;_<c.length;_++)i["$"+c[_]]=!0;for(c=0;c<t.length;c++)_=i.hasOwnProperty("$"+t[c].value),t[c].selected!==_&&(t[c].selected=_),_&&f&&(t[c].defaultSelected=!0)}else{for(c=""+ah(c),i=null,_=0;_<t.length;_++){if(t[_].value===c){t[_].selected=!0,f&&(t[_].defaultSelected=!0);return}i!==null||t[_].disabled||(i=t[_])}i!==null&&(i.selected=!0)}}function PS(t,i){if(i.dangerouslySetInnerHTML!=null)throw Error(Zt(91));return Fr({},i,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function aR(t,i){var c=i.value;if(c==null){if(c=i.children,i=i.defaultValue,c!=null){if(i!=null)throw Error(Zt(92));if(U_(c)){if(1<c.length)throw Error(Zt(93));c=c[0]}i=c}i==null&&(i=""),c=i}t._wrapperState={initialValue:ah(c)}}function iz(t,i){var c=ah(i.value),f=ah(i.defaultValue);c!=null&&(c=""+c,c!==t.value&&(t.value=c),i.defaultValue==null&&t.defaultValue!==c&&(t.defaultValue=c)),f!=null&&(t.defaultValue=""+f)}function lR(t){var i=t.textContent;i===t._wrapperState.initialValue&&i!==""&&i!==null&&(t.value=i)}function rz(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function MS(t,i){return t==null||t==="http://www.w3.org/1999/xhtml"?rz(i):t==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var o0,sz=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,c,f,_){MSApp.execUnsafeLocalFunction(function(){return t(i,c,f,_)})}:t}(function(t,i){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=i;else{for(o0=o0||document.createElement("div"),o0.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=o0.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;i.firstChild;)t.appendChild(i.firstChild)}});function my(t,i){if(i){var c=t.firstChild;if(c&&c===t.lastChild&&c.nodeType===3){c.nodeValue=i;return}}t.textContent=i}var X_={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},xU=["Webkit","ms","Moz","O"];Object.keys(X_).forEach(function(t){xU.forEach(function(i){i=i+t.charAt(0).toUpperCase()+t.substring(1),X_[i]=X_[t]})});function oz(t,i,c){return i==null||typeof i=="boolean"||i===""?"":c||typeof i!="number"||i===0||X_.hasOwnProperty(t)&&X_[t]?(""+i).trim():i+"px"}function az(t,i){t=t.style;for(var c in i)if(i.hasOwnProperty(c)){var f=c.indexOf("--")===0,_=oz(c,i[c],f);c==="float"&&(c="cssFloat"),f?t.setProperty(c,_):t[c]=_}}var wU=Fr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function RS(t,i){if(i){if(wU[t]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(Zt(137,t));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(Zt(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(Zt(61))}if(i.style!=null&&typeof i.style!="object")throw Error(Zt(62))}}function kS(t,i){if(t.indexOf("-")===-1)return typeof i.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var DS=null;function cE(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var LS=null,Zp=null,Xp=null;function cR(t){if(t=Jy(t)){if(typeof LS!="function")throw Error(Zt(280));var i=t.stateNode;i&&(i=U1(i),LS(t.stateNode,t.type,i))}}function lz(t){Zp?Xp?Xp.push(t):Xp=[t]:Zp=t}function cz(){if(Zp){var t=Zp,i=Xp;if(Xp=Zp=null,cR(t),i)for(t=0;t<i.length;t++)cR(i[t])}}function uz(t,i){return t(i)}function hz(){}var xT=!1;function dz(t,i,c){if(xT)return t(i,c);xT=!0;try{return uz(t,i,c)}finally{xT=!1,(Zp!==null||Xp!==null)&&(hz(),cz())}}function gy(t,i){var c=t.stateNode;if(c===null)return null;var f=U1(c);if(f===null)return null;c=f[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(t=t.type,f=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!f;break e;default:t=!1}if(t)return null;if(c&&typeof c!="function")throw Error(Zt(231,i,typeof c));return c}var zS=!1;if(zc)try{var P_={};Object.defineProperty(P_,"passive",{get:function(){zS=!0}}),window.addEventListener("test",P_,P_),window.removeEventListener("test",P_,P_)}catch{zS=!1}function bU(t,i,c,f,_,w,E,o,k){var L=Array.prototype.slice.call(arguments,3);try{i.apply(c,L)}catch(N){this.onError(N)}}var K_=!1,Y0=null,J0=!1,OS=null,TU={onError:function(t){K_=!0,Y0=t}};function SU(t,i,c,f,_,w,E,o,k){K_=!1,Y0=null,bU.apply(TU,arguments)}function EU(t,i,c,f,_,w,E,o,k){if(SU.apply(this,arguments),K_){if(K_){var L=Y0;K_=!1,Y0=null}else throw Error(Zt(198));J0||(J0=!0,OS=L)}}function Ud(t){var i=t,c=t;if(t.alternate)for(;i.return;)i=i.return;else{t=i;do i=t,i.flags&4098&&(c=i.return),t=i.return;while(t)}return i.tag===3?c:null}function fz(t){if(t.tag===13){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function uR(t){if(Ud(t)!==t)throw Error(Zt(188))}function IU(t){var i=t.alternate;if(!i){if(i=Ud(t),i===null)throw Error(Zt(188));return i!==t?null:t}for(var c=t,f=i;;){var _=c.return;if(_===null)break;var w=_.alternate;if(w===null){if(f=_.return,f!==null){c=f;continue}break}if(_.child===w.child){for(w=_.child;w;){if(w===c)return uR(_),t;if(w===f)return uR(_),i;w=w.sibling}throw Error(Zt(188))}if(c.return!==f.return)c=_,f=w;else{for(var E=!1,o=_.child;o;){if(o===c){E=!0,c=_,f=w;break}if(o===f){E=!0,f=_,c=w;break}o=o.sibling}if(!E){for(o=w.child;o;){if(o===c){E=!0,c=w,f=_;break}if(o===f){E=!0,f=w,c=_;break}o=o.sibling}if(!E)throw Error(Zt(189))}}if(c.alternate!==f)throw Error(Zt(190))}if(c.tag!==3)throw Error(Zt(188));return c.stateNode.current===c?t:i}function pz(t){return t=IU(t),t!==null?mz(t):null}function mz(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var i=mz(t);if(i!==null)return i;t=t.sibling}return null}var gz=ea.unstable_scheduleCallback,hR=ea.unstable_cancelCallback,AU=ea.unstable_shouldYield,CU=ea.unstable_requestPaint,Yr=ea.unstable_now,PU=ea.unstable_getCurrentPriorityLevel,uE=ea.unstable_ImmediatePriority,_z=ea.unstable_UserBlockingPriority,Q0=ea.unstable_NormalPriority,MU=ea.unstable_LowPriority,yz=ea.unstable_IdlePriority,N1=null,Vl=null;function RU(t){if(Vl&&typeof Vl.onCommitFiberRoot=="function")try{Vl.onCommitFiberRoot(N1,t,void 0,(t.current.flags&128)===128)}catch{}}var Qa=Math.clz32?Math.clz32:LU,kU=Math.log,DU=Math.LN2;function LU(t){return t>>>=0,t===0?32:31-(kU(t)/DU|0)|0}var a0=64,l0=4194304;function G_(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function e1(t,i){var c=t.pendingLanes;if(c===0)return 0;var f=0,_=t.suspendedLanes,w=t.pingedLanes,E=c&268435455;if(E!==0){var o=E&~_;o!==0?f=G_(o):(w&=E,w!==0&&(f=G_(w)))}else E=c&~_,E!==0?f=G_(E):w!==0&&(f=G_(w));if(f===0)return 0;if(i!==0&&i!==f&&!(i&_)&&(_=f&-f,w=i&-i,_>=w||_===16&&(w&4194240)!==0))return i;if(f&4&&(f|=c&16),i=t.entangledLanes,i!==0)for(t=t.entanglements,i&=f;0<i;)c=31-Qa(i),_=1<<c,f|=t[c],i&=~_;return f}function zU(t,i){switch(t){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function OU(t,i){for(var c=t.suspendedLanes,f=t.pingedLanes,_=t.expirationTimes,w=t.pendingLanes;0<w;){var E=31-Qa(w),o=1<<E,k=_[E];k===-1?(!(o&c)||o&f)&&(_[E]=zU(o,i)):k<=i&&(t.expiredLanes|=o),w&=~o}}function FS(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function vz(){var t=a0;return a0<<=1,!(a0&4194240)&&(a0=64),t}function wT(t){for(var i=[],c=0;31>c;c++)i.push(t);return i}function Ky(t,i,c){t.pendingLanes|=i,i!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,i=31-Qa(i),t[i]=c}function FU(t,i){var c=t.pendingLanes&~i;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=i,t.mutableReadLanes&=i,t.entangledLanes&=i,i=t.entanglements;var f=t.eventTimes;for(t=t.expirationTimes;0<c;){var _=31-Qa(c),w=1<<_;i[_]=0,f[_]=-1,t[_]=-1,c&=~w}}function hE(t,i){var c=t.entangledLanes|=i;for(t=t.entanglements;c;){var f=31-Qa(c),_=1<<f;_&i|t[f]&i&&(t[f]|=i),c&=~_}}var Qi=0;function xz(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var wz,dE,bz,Tz,Sz,NS=!1,c0=[],Yu=null,Ju=null,Qu=null,_y=new Map,yy=new Map,ju=[],NU="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function dR(t,i){switch(t){case"focusin":case"focusout":Yu=null;break;case"dragenter":case"dragleave":Ju=null;break;case"mouseover":case"mouseout":Qu=null;break;case"pointerover":case"pointerout":_y.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":yy.delete(i.pointerId)}}function M_(t,i,c,f,_,w){return t===null||t.nativeEvent!==w?(t={blockedOn:i,domEventName:c,eventSystemFlags:f,nativeEvent:w,targetContainers:[_]},i!==null&&(i=Jy(i),i!==null&&dE(i)),t):(t.eventSystemFlags|=f,i=t.targetContainers,_!==null&&i.indexOf(_)===-1&&i.push(_),t)}function BU(t,i,c,f,_){switch(i){case"focusin":return Yu=M_(Yu,t,i,c,f,_),!0;case"dragenter":return Ju=M_(Ju,t,i,c,f,_),!0;case"mouseover":return Qu=M_(Qu,t,i,c,f,_),!0;case"pointerover":var w=_.pointerId;return _y.set(w,M_(_y.get(w)||null,t,i,c,f,_)),!0;case"gotpointercapture":return w=_.pointerId,yy.set(w,M_(yy.get(w)||null,t,i,c,f,_)),!0}return!1}function Ez(t){var i=_d(t.target);if(i!==null){var c=Ud(i);if(c!==null){if(i=c.tag,i===13){if(i=fz(c),i!==null){t.blockedOn=i,Sz(t.priority,function(){bz(c)});return}}else if(i===3&&c.stateNode.current.memoizedState.isDehydrated){t.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}t.blockedOn=null}function k0(t){if(t.blockedOn!==null)return!1;for(var i=t.targetContainers;0<i.length;){var c=BS(t.domEventName,t.eventSystemFlags,i[0],t.nativeEvent);if(c===null){c=t.nativeEvent;var f=new c.constructor(c.type,c);DS=f,c.target.dispatchEvent(f),DS=null}else return i=Jy(c),i!==null&&dE(i),t.blockedOn=c,!1;i.shift()}return!0}function fR(t,i,c){k0(t)&&c.delete(i)}function jU(){NS=!1,Yu!==null&&k0(Yu)&&(Yu=null),Ju!==null&&k0(Ju)&&(Ju=null),Qu!==null&&k0(Qu)&&(Qu=null),_y.forEach(fR),yy.forEach(fR)}function R_(t,i){t.blockedOn===i&&(t.blockedOn=null,NS||(NS=!0,ea.unstable_scheduleCallback(ea.unstable_NormalPriority,jU)))}function vy(t){function i(_){return R_(_,t)}if(0<c0.length){R_(c0[0],t);for(var c=1;c<c0.length;c++){var f=c0[c];f.blockedOn===t&&(f.blockedOn=null)}}for(Yu!==null&&R_(Yu,t),Ju!==null&&R_(Ju,t),Qu!==null&&R_(Qu,t),_y.forEach(i),yy.forEach(i),c=0;c<ju.length;c++)f=ju[c],f.blockedOn===t&&(f.blockedOn=null);for(;0<ju.length&&(c=ju[0],c.blockedOn===null);)Ez(c),c.blockedOn===null&&ju.shift()}var Kp=jc.ReactCurrentBatchConfig,t1=!0;function VU(t,i,c,f){var _=Qi,w=Kp.transition;Kp.transition=null;try{Qi=1,fE(t,i,c,f)}finally{Qi=_,Kp.transition=w}}function UU(t,i,c,f){var _=Qi,w=Kp.transition;Kp.transition=null;try{Qi=4,fE(t,i,c,f)}finally{Qi=_,Kp.transition=w}}function fE(t,i,c,f){if(t1){var _=BS(t,i,c,f);if(_===null)RT(t,i,f,n1,c),dR(t,f);else if(BU(_,t,i,c,f))f.stopPropagation();else if(dR(t,f),i&4&&-1<NU.indexOf(t)){for(;_!==null;){var w=Jy(_);if(w!==null&&wz(w),w=BS(t,i,c,f),w===null&&RT(t,i,f,n1,c),w===_)break;_=w}_!==null&&f.stopPropagation()}else RT(t,i,f,null,c)}}var n1=null;function BS(t,i,c,f){if(n1=null,t=cE(f),t=_d(t),t!==null)if(i=Ud(t),i===null)t=null;else if(c=i.tag,c===13){if(t=fz(i),t!==null)return t;t=null}else if(c===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;t=null}else i!==t&&(t=null);return n1=t,null}function Iz(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(PU()){case uE:return 1;case _z:return 4;case Q0:case MU:return 16;case yz:return 536870912;default:return 16}default:return 16}}var Zu=null,pE=null,D0=null;function Az(){if(D0)return D0;var t,i=pE,c=i.length,f,_="value"in Zu?Zu.value:Zu.textContent,w=_.length;for(t=0;t<c&&i[t]===_[t];t++);var E=c-t;for(f=1;f<=E&&i[c-f]===_[w-f];f++);return D0=_.slice(t,1<f?1-f:void 0)}function L0(t){var i=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&i===13&&(t=13)):t=i,t===10&&(t=13),32<=t||t===13?t:0}function u0(){return!0}function pR(){return!1}function ia(t){function i(c,f,_,w,E){this._reactName=c,this._targetInst=_,this.type=f,this.nativeEvent=w,this.target=E,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(c=t[o],this[o]=c?c(w):w[o]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?u0:pR,this.isPropagationStopped=pR,this}return Fr(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=u0)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=u0)},persist:function(){},isPersistent:u0}),i}var Tm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},mE=ia(Tm),Yy=Fr({},Tm,{view:0,detail:0}),GU=ia(Yy),bT,TT,k_,B1=Fr({},Yy,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gE,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==k_&&(k_&&t.type==="mousemove"?(bT=t.screenX-k_.screenX,TT=t.screenY-k_.screenY):TT=bT=0,k_=t),bT)},movementY:function(t){return"movementY"in t?t.movementY:TT}}),mR=ia(B1),$U=Fr({},B1,{dataTransfer:0}),HU=ia($U),WU=Fr({},Yy,{relatedTarget:0}),ST=ia(WU),qU=Fr({},Tm,{animationName:0,elapsedTime:0,pseudoElement:0}),ZU=ia(qU),XU=Fr({},Tm,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),KU=ia(XU),YU=Fr({},Tm,{data:0}),gR=ia(YU),JU={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},QU={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},e6={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function t6(t){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(t):(t=e6[t])?!!i[t]:!1}function gE(){return t6}var n6=Fr({},Yy,{key:function(t){if(t.key){var i=JU[t.key]||t.key;if(i!=="Unidentified")return i}return t.type==="keypress"?(t=L0(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?QU[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gE,charCode:function(t){return t.type==="keypress"?L0(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?L0(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),i6=ia(n6),r6=Fr({},B1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_R=ia(r6),s6=Fr({},Yy,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gE}),o6=ia(s6),a6=Fr({},Tm,{propertyName:0,elapsedTime:0,pseudoElement:0}),l6=ia(a6),c6=Fr({},B1,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),u6=ia(c6),h6=[9,13,27,32],_E=zc&&"CompositionEvent"in window,Y_=null;zc&&"documentMode"in document&&(Y_=document.documentMode);var d6=zc&&"TextEvent"in window&&!Y_,Cz=zc&&(!_E||Y_&&8<Y_&&11>=Y_),yR=" ",vR=!1;function Pz(t,i){switch(t){case"keyup":return h6.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mz(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Rp=!1;function f6(t,i){switch(t){case"compositionend":return Mz(i);case"keypress":return i.which!==32?null:(vR=!0,yR);case"textInput":return t=i.data,t===yR&&vR?null:t;default:return null}}function p6(t,i){if(Rp)return t==="compositionend"||!_E&&Pz(t,i)?(t=Az(),D0=pE=Zu=null,Rp=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Cz&&i.locale!=="ko"?null:i.data;default:return null}}var m6={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xR(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i==="input"?!!m6[t.type]:i==="textarea"}function Rz(t,i,c,f){lz(f),i=i1(i,"onChange"),0<i.length&&(c=new mE("onChange","change",null,c,f),t.push({event:c,listeners:i}))}var J_=null,xy=null;function g6(t){Uz(t,0)}function j1(t){var i=Lp(t);if(tz(i))return t}function _6(t,i){if(t==="change")return i}var kz=!1;if(zc){var ET;if(zc){var IT="oninput"in document;if(!IT){var wR=document.createElement("div");wR.setAttribute("oninput","return;"),IT=typeof wR.oninput=="function"}ET=IT}else ET=!1;kz=ET&&(!document.documentMode||9<document.documentMode)}function bR(){J_&&(J_.detachEvent("onpropertychange",Dz),xy=J_=null)}function Dz(t){if(t.propertyName==="value"&&j1(xy)){var i=[];Rz(i,xy,t,cE(t)),dz(g6,i)}}function y6(t,i,c){t==="focusin"?(bR(),J_=i,xy=c,J_.attachEvent("onpropertychange",Dz)):t==="focusout"&&bR()}function v6(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return j1(xy)}function x6(t,i){if(t==="click")return j1(i)}function w6(t,i){if(t==="input"||t==="change")return j1(i)}function b6(t,i){return t===i&&(t!==0||1/t===1/i)||t!==t&&i!==i}var nl=typeof Object.is=="function"?Object.is:b6;function wy(t,i){if(nl(t,i))return!0;if(typeof t!="object"||t===null||typeof i!="object"||i===null)return!1;var c=Object.keys(t),f=Object.keys(i);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var _=c[f];if(!wS.call(i,_)||!nl(t[_],i[_]))return!1}return!0}function TR(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function SR(t,i){var c=TR(t);t=0;for(var f;c;){if(c.nodeType===3){if(f=t+c.textContent.length,t<=i&&f>=i)return{node:c,offset:i-t};t=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=TR(c)}}function Lz(t,i){return t&&i?t===i?!0:t&&t.nodeType===3?!1:i&&i.nodeType===3?Lz(t,i.parentNode):"contains"in t?t.contains(i):t.compareDocumentPosition?!!(t.compareDocumentPosition(i)&16):!1:!1}function zz(){for(var t=window,i=K0();i instanceof t.HTMLIFrameElement;){try{var c=typeof i.contentWindow.location.href=="string"}catch{c=!1}if(c)t=i.contentWindow;else break;i=K0(t.document)}return i}function yE(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i&&(i==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||i==="textarea"||t.contentEditable==="true")}function T6(t){var i=zz(),c=t.focusedElem,f=t.selectionRange;if(i!==c&&c&&c.ownerDocument&&Lz(c.ownerDocument.documentElement,c)){if(f!==null&&yE(c)){if(i=f.start,t=f.end,t===void 0&&(t=i),"selectionStart"in c)c.selectionStart=i,c.selectionEnd=Math.min(t,c.value.length);else if(t=(i=c.ownerDocument||document)&&i.defaultView||window,t.getSelection){t=t.getSelection();var _=c.textContent.length,w=Math.min(f.start,_);f=f.end===void 0?w:Math.min(f.end,_),!t.extend&&w>f&&(_=f,f=w,w=_),_=SR(c,w);var E=SR(c,f);_&&E&&(t.rangeCount!==1||t.anchorNode!==_.node||t.anchorOffset!==_.offset||t.focusNode!==E.node||t.focusOffset!==E.offset)&&(i=i.createRange(),i.setStart(_.node,_.offset),t.removeAllRanges(),w>f?(t.addRange(i),t.extend(E.node,E.offset)):(i.setEnd(E.node,E.offset),t.addRange(i)))}}for(i=[],t=c;t=t.parentNode;)t.nodeType===1&&i.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<i.length;c++)t=i[c],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var S6=zc&&"documentMode"in document&&11>=document.documentMode,kp=null,jS=null,Q_=null,VS=!1;function ER(t,i,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;VS||kp==null||kp!==K0(f)||(f=kp,"selectionStart"in f&&yE(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Q_&&wy(Q_,f)||(Q_=f,f=i1(jS,"onSelect"),0<f.length&&(i=new mE("onSelect","select",null,i,c),t.push({event:i,listeners:f}),i.target=kp)))}function h0(t,i){var c={};return c[t.toLowerCase()]=i.toLowerCase(),c["Webkit"+t]="webkit"+i,c["Moz"+t]="moz"+i,c}var Dp={animationend:h0("Animation","AnimationEnd"),animationiteration:h0("Animation","AnimationIteration"),animationstart:h0("Animation","AnimationStart"),transitionend:h0("Transition","TransitionEnd")},AT={},Oz={};zc&&(Oz=document.createElement("div").style,"AnimationEvent"in window||(delete Dp.animationend.animation,delete Dp.animationiteration.animation,delete Dp.animationstart.animation),"TransitionEvent"in window||delete Dp.transitionend.transition);function V1(t){if(AT[t])return AT[t];if(!Dp[t])return t;var i=Dp[t],c;for(c in i)if(i.hasOwnProperty(c)&&c in Oz)return AT[t]=i[c];return t}var Fz=V1("animationend"),Nz=V1("animationiteration"),Bz=V1("animationstart"),jz=V1("transitionend"),Vz=new Map,IR="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function hh(t,i){Vz.set(t,i),Vd(i,[t])}for(var CT=0;CT<IR.length;CT++){var PT=IR[CT],E6=PT.toLowerCase(),I6=PT[0].toUpperCase()+PT.slice(1);hh(E6,"on"+I6)}hh(Fz,"onAnimationEnd");hh(Nz,"onAnimationIteration");hh(Bz,"onAnimationStart");hh("dblclick","onDoubleClick");hh("focusin","onFocus");hh("focusout","onBlur");hh(jz,"onTransitionEnd");hm("onMouseEnter",["mouseout","mouseover"]);hm("onMouseLeave",["mouseout","mouseover"]);hm("onPointerEnter",["pointerout","pointerover"]);hm("onPointerLeave",["pointerout","pointerover"]);Vd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Vd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Vd("onBeforeInput",["compositionend","keypress","textInput","paste"]);Vd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Vd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Vd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),A6=new Set("cancel close invalid load scroll toggle".split(" ").concat($_));function AR(t,i,c){var f=t.type||"unknown-event";t.currentTarget=c,EU(f,i,void 0,t),t.currentTarget=null}function Uz(t,i){i=(i&4)!==0;for(var c=0;c<t.length;c++){var f=t[c],_=f.event;f=f.listeners;e:{var w=void 0;if(i)for(var E=f.length-1;0<=E;E--){var o=f[E],k=o.instance,L=o.currentTarget;if(o=o.listener,k!==w&&_.isPropagationStopped())break e;AR(_,o,L),w=k}else for(E=0;E<f.length;E++){if(o=f[E],k=o.instance,L=o.currentTarget,o=o.listener,k!==w&&_.isPropagationStopped())break e;AR(_,o,L),w=k}}}if(J0)throw t=OS,J0=!1,OS=null,t}function Tr(t,i){var c=i[WS];c===void 0&&(c=i[WS]=new Set);var f=t+"__bubble";c.has(f)||(Gz(i,t,2,!1),c.add(f))}function MT(t,i,c){var f=0;i&&(f|=4),Gz(c,t,f,i)}var d0="_reactListening"+Math.random().toString(36).slice(2);function by(t){if(!t[d0]){t[d0]=!0,KL.forEach(function(c){c!=="selectionchange"&&(A6.has(c)||MT(c,!1,t),MT(c,!0,t))});var i=t.nodeType===9?t:t.ownerDocument;i===null||i[d0]||(i[d0]=!0,MT("selectionchange",!1,i))}}function Gz(t,i,c,f){switch(Iz(i)){case 1:var _=VU;break;case 4:_=UU;break;default:_=fE}c=_.bind(null,i,c,t),_=void 0,!zS||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(_=!0),f?_!==void 0?t.addEventListener(i,c,{capture:!0,passive:_}):t.addEventListener(i,c,!0):_!==void 0?t.addEventListener(i,c,{passive:_}):t.addEventListener(i,c,!1)}function RT(t,i,c,f,_){var w=f;if(!(i&1)&&!(i&2)&&f!==null)e:for(;;){if(f===null)return;var E=f.tag;if(E===3||E===4){var o=f.stateNode.containerInfo;if(o===_||o.nodeType===8&&o.parentNode===_)break;if(E===4)for(E=f.return;E!==null;){var k=E.tag;if((k===3||k===4)&&(k=E.stateNode.containerInfo,k===_||k.nodeType===8&&k.parentNode===_))return;E=E.return}for(;o!==null;){if(E=_d(o),E===null)return;if(k=E.tag,k===5||k===6){f=w=E;continue e}o=o.parentNode}}f=f.return}dz(function(){var L=w,N=cE(c),V=[];e:{var H=Vz.get(t);if(H!==void 0){var ne=mE,ce=t;switch(t){case"keypress":if(L0(c)===0)break e;case"keydown":case"keyup":ne=i6;break;case"focusin":ce="focus",ne=ST;break;case"focusout":ce="blur",ne=ST;break;case"beforeblur":case"afterblur":ne=ST;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ne=mR;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ne=HU;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ne=o6;break;case Fz:case Nz:case Bz:ne=ZU;break;case jz:ne=l6;break;case"scroll":ne=GU;break;case"wheel":ne=u6;break;case"copy":case"cut":case"paste":ne=KU;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ne=_R}var K=(i&4)!==0,se=!K&&t==="scroll",Y=K?H!==null?H+"Capture":null:H;K=[];for(var Q=L,ae;Q!==null;){ae=Q;var Te=ae.stateNode;if(ae.tag===5&&Te!==null&&(ae=Te,Y!==null&&(Te=gy(Q,Y),Te!=null&&K.push(Ty(Q,Te,ae)))),se)break;Q=Q.return}0<K.length&&(H=new ne(H,ce,null,c,N),V.push({event:H,listeners:K}))}}if(!(i&7)){e:{if(H=t==="mouseover"||t==="pointerover",ne=t==="mouseout"||t==="pointerout",H&&c!==DS&&(ce=c.relatedTarget||c.fromElement)&&(_d(ce)||ce[Oc]))break e;if((ne||H)&&(H=N.window===N?N:(H=N.ownerDocument)?H.defaultView||H.parentWindow:window,ne?(ce=c.relatedTarget||c.toElement,ne=L,ce=ce?_d(ce):null,ce!==null&&(se=Ud(ce),ce!==se||ce.tag!==5&&ce.tag!==6)&&(ce=null)):(ne=null,ce=L),ne!==ce)){if(K=mR,Te="onMouseLeave",Y="onMouseEnter",Q="mouse",(t==="pointerout"||t==="pointerover")&&(K=_R,Te="onPointerLeave",Y="onPointerEnter",Q="pointer"),se=ne==null?H:Lp(ne),ae=ce==null?H:Lp(ce),H=new K(Te,Q+"leave",ne,c,N),H.target=se,H.relatedTarget=ae,Te=null,_d(N)===L&&(K=new K(Y,Q+"enter",ce,c,N),K.target=ae,K.relatedTarget=se,Te=K),se=Te,ne&&ce)t:{for(K=ne,Y=ce,Q=0,ae=K;ae;ae=wp(ae))Q++;for(ae=0,Te=Y;Te;Te=wp(Te))ae++;for(;0<Q-ae;)K=wp(K),Q--;for(;0<ae-Q;)Y=wp(Y),ae--;for(;Q--;){if(K===Y||Y!==null&&K===Y.alternate)break t;K=wp(K),Y=wp(Y)}K=null}else K=null;ne!==null&&CR(V,H,ne,K,!1),ce!==null&&se!==null&&CR(V,se,ce,K,!0)}}e:{if(H=L?Lp(L):window,ne=H.nodeName&&H.nodeName.toLowerCase(),ne==="select"||ne==="input"&&H.type==="file")var Be=_6;else if(xR(H))if(kz)Be=w6;else{Be=v6;var et=y6}else(ne=H.nodeName)&&ne.toLowerCase()==="input"&&(H.type==="checkbox"||H.type==="radio")&&(Be=x6);if(Be&&(Be=Be(t,L))){Rz(V,Be,c,N);break e}et&&et(t,H,L),t==="focusout"&&(et=H._wrapperState)&&et.controlled&&H.type==="number"&&CS(H,"number",H.value)}switch(et=L?Lp(L):window,t){case"focusin":(xR(et)||et.contentEditable==="true")&&(kp=et,jS=L,Q_=null);break;case"focusout":Q_=jS=kp=null;break;case"mousedown":VS=!0;break;case"contextmenu":case"mouseup":case"dragend":VS=!1,ER(V,c,N);break;case"selectionchange":if(S6)break;case"keydown":case"keyup":ER(V,c,N)}var nt;if(_E)e:{switch(t){case"compositionstart":var Je="onCompositionStart";break e;case"compositionend":Je="onCompositionEnd";break e;case"compositionupdate":Je="onCompositionUpdate";break e}Je=void 0}else Rp?Pz(t,c)&&(Je="onCompositionEnd"):t==="keydown"&&c.keyCode===229&&(Je="onCompositionStart");Je&&(Cz&&c.locale!=="ko"&&(Rp||Je!=="onCompositionStart"?Je==="onCompositionEnd"&&Rp&&(nt=Az()):(Zu=N,pE="value"in Zu?Zu.value:Zu.textContent,Rp=!0)),et=i1(L,Je),0<et.length&&(Je=new gR(Je,t,null,c,N),V.push({event:Je,listeners:et}),nt?Je.data=nt:(nt=Mz(c),nt!==null&&(Je.data=nt)))),(nt=d6?f6(t,c):p6(t,c))&&(L=i1(L,"onBeforeInput"),0<L.length&&(N=new gR("onBeforeInput","beforeinput",null,c,N),V.push({event:N,listeners:L}),N.data=nt))}Uz(V,i)})}function Ty(t,i,c){return{instance:t,listener:i,currentTarget:c}}function i1(t,i){for(var c=i+"Capture",f=[];t!==null;){var _=t,w=_.stateNode;_.tag===5&&w!==null&&(_=w,w=gy(t,c),w!=null&&f.unshift(Ty(t,w,_)),w=gy(t,i),w!=null&&f.push(Ty(t,w,_))),t=t.return}return f}function wp(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function CR(t,i,c,f,_){for(var w=i._reactName,E=[];c!==null&&c!==f;){var o=c,k=o.alternate,L=o.stateNode;if(k!==null&&k===f)break;o.tag===5&&L!==null&&(o=L,_?(k=gy(c,w),k!=null&&E.unshift(Ty(c,k,o))):_||(k=gy(c,w),k!=null&&E.push(Ty(c,k,o)))),c=c.return}E.length!==0&&t.push({event:i,listeners:E})}var C6=/\r\n?/g,P6=/\u0000|\uFFFD/g;function PR(t){return(typeof t=="string"?t:""+t).replace(C6,`
`).replace(P6,"")}function f0(t,i,c){if(i=PR(i),PR(t)!==i&&c)throw Error(Zt(425))}function r1(){}var US=null,GS=null;function $S(t,i){return t==="textarea"||t==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var HS=typeof setTimeout=="function"?setTimeout:void 0,M6=typeof clearTimeout=="function"?clearTimeout:void 0,MR=typeof Promise=="function"?Promise:void 0,R6=typeof queueMicrotask=="function"?queueMicrotask:typeof MR<"u"?function(t){return MR.resolve(null).then(t).catch(k6)}:HS;function k6(t){setTimeout(function(){throw t})}function kT(t,i){var c=i,f=0;do{var _=c.nextSibling;if(t.removeChild(c),_&&_.nodeType===8)if(c=_.data,c==="/$"){if(f===0){t.removeChild(_),vy(i);return}f--}else c!=="$"&&c!=="$?"&&c!=="$!"||f++;c=_}while(c);vy(i)}function eh(t){for(;t!=null;t=t.nextSibling){var i=t.nodeType;if(i===1||i===3)break;if(i===8){if(i=t.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return t}function RR(t){t=t.previousSibling;for(var i=0;t;){if(t.nodeType===8){var c=t.data;if(c==="$"||c==="$!"||c==="$?"){if(i===0)return t;i--}else c==="/$"&&i++}t=t.previousSibling}return null}var Sm=Math.random().toString(36).slice(2),Nl="__reactFiber$"+Sm,Sy="__reactProps$"+Sm,Oc="__reactContainer$"+Sm,WS="__reactEvents$"+Sm,D6="__reactListeners$"+Sm,L6="__reactHandles$"+Sm;function _d(t){var i=t[Nl];if(i)return i;for(var c=t.parentNode;c;){if(i=c[Oc]||c[Nl]){if(c=i.alternate,i.child!==null||c!==null&&c.child!==null)for(t=RR(t);t!==null;){if(c=t[Nl])return c;t=RR(t)}return i}t=c,c=t.parentNode}return null}function Jy(t){return t=t[Nl]||t[Oc],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Lp(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Zt(33))}function U1(t){return t[Sy]||null}var qS=[],zp=-1;function dh(t){return{current:t}}function Sr(t){0>zp||(t.current=qS[zp],qS[zp]=null,zp--)}function gr(t,i){zp++,qS[zp]=t.current,t.current=i}var lh={},Js=dh(lh),ko=dh(!1),kd=lh;function dm(t,i){var c=t.type.contextTypes;if(!c)return lh;var f=t.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===i)return f.__reactInternalMemoizedMaskedChildContext;var _={},w;for(w in c)_[w]=i[w];return f&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=_),_}function Do(t){return t=t.childContextTypes,t!=null}function s1(){Sr(ko),Sr(Js)}function kR(t,i,c){if(Js.current!==lh)throw Error(Zt(168));gr(Js,i),gr(ko,c)}function $z(t,i,c){var f=t.stateNode;if(i=i.childContextTypes,typeof f.getChildContext!="function")return c;f=f.getChildContext();for(var _ in f)if(!(_ in i))throw Error(Zt(108,yU(t)||"Unknown",_));return Fr({},c,f)}function o1(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||lh,kd=Js.current,gr(Js,t),gr(ko,ko.current),!0}function DR(t,i,c){var f=t.stateNode;if(!f)throw Error(Zt(169));c?(t=$z(t,i,kd),f.__reactInternalMemoizedMergedChildContext=t,Sr(ko),Sr(Js),gr(Js,t)):Sr(ko),gr(ko,c)}var Cc=null,G1=!1,DT=!1;function Hz(t){Cc===null?Cc=[t]:Cc.push(t)}function z6(t){G1=!0,Hz(t)}function fh(){if(!DT&&Cc!==null){DT=!0;var t=0,i=Qi;try{var c=Cc;for(Qi=1;t<c.length;t++){var f=c[t];do f=f(!0);while(f!==null)}Cc=null,G1=!1}catch(_){throw Cc!==null&&(Cc=Cc.slice(t+1)),gz(uE,fh),_}finally{Qi=i,DT=!1}}return null}var Op=[],Fp=0,a1=null,l1=0,Ta=[],Sa=0,Dd=null,Mc=1,Rc="";function hd(t,i){Op[Fp++]=l1,Op[Fp++]=a1,a1=t,l1=i}function Wz(t,i,c){Ta[Sa++]=Mc,Ta[Sa++]=Rc,Ta[Sa++]=Dd,Dd=t;var f=Mc;t=Rc;var _=32-Qa(f)-1;f&=~(1<<_),c+=1;var w=32-Qa(i)+_;if(30<w){var E=_-_%5;w=(f&(1<<E)-1).toString(32),f>>=E,_-=E,Mc=1<<32-Qa(i)+_|c<<_|f,Rc=w+t}else Mc=1<<w|c<<_|f,Rc=t}function vE(t){t.return!==null&&(hd(t,1),Wz(t,1,0))}function xE(t){for(;t===a1;)a1=Op[--Fp],Op[Fp]=null,l1=Op[--Fp],Op[Fp]=null;for(;t===Dd;)Dd=Ta[--Sa],Ta[Sa]=null,Rc=Ta[--Sa],Ta[Sa]=null,Mc=Ta[--Sa],Ta[Sa]=null}var Jo=null,Yo=null,Mr=!1,Ja=null;function qz(t,i){var c=Ea(5,null,null,0);c.elementType="DELETED",c.stateNode=i,c.return=t,i=t.deletions,i===null?(t.deletions=[c],t.flags|=16):i.push(c)}function LR(t,i){switch(t.tag){case 5:var c=t.type;return i=i.nodeType!==1||c.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(t.stateNode=i,Jo=t,Yo=eh(i.firstChild),!0):!1;case 6:return i=t.pendingProps===""||i.nodeType!==3?null:i,i!==null?(t.stateNode=i,Jo=t,Yo=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(c=Dd!==null?{id:Mc,overflow:Rc}:null,t.memoizedState={dehydrated:i,treeContext:c,retryLane:1073741824},c=Ea(18,null,null,0),c.stateNode=i,c.return=t,t.child=c,Jo=t,Yo=null,!0):!1;default:return!1}}function ZS(t){return(t.mode&1)!==0&&(t.flags&128)===0}function XS(t){if(Mr){var i=Yo;if(i){var c=i;if(!LR(t,i)){if(ZS(t))throw Error(Zt(418));i=eh(c.nextSibling);var f=Jo;i&&LR(t,i)?qz(f,c):(t.flags=t.flags&-4097|2,Mr=!1,Jo=t)}}else{if(ZS(t))throw Error(Zt(418));t.flags=t.flags&-4097|2,Mr=!1,Jo=t}}}function zR(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Jo=t}function p0(t){if(t!==Jo)return!1;if(!Mr)return zR(t),Mr=!0,!1;var i;if((i=t.tag!==3)&&!(i=t.tag!==5)&&(i=t.type,i=i!=="head"&&i!=="body"&&!$S(t.type,t.memoizedProps)),i&&(i=Yo)){if(ZS(t))throw Zz(),Error(Zt(418));for(;i;)qz(t,i),i=eh(i.nextSibling)}if(zR(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Zt(317));e:{for(t=t.nextSibling,i=0;t;){if(t.nodeType===8){var c=t.data;if(c==="/$"){if(i===0){Yo=eh(t.nextSibling);break e}i--}else c!=="$"&&c!=="$!"&&c!=="$?"||i++}t=t.nextSibling}Yo=null}}else Yo=Jo?eh(t.stateNode.nextSibling):null;return!0}function Zz(){for(var t=Yo;t;)t=eh(t.nextSibling)}function fm(){Yo=Jo=null,Mr=!1}function wE(t){Ja===null?Ja=[t]:Ja.push(t)}var O6=jc.ReactCurrentBatchConfig;function D_(t,i,c){if(t=c.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(Zt(309));var f=c.stateNode}if(!f)throw Error(Zt(147,t));var _=f,w=""+t;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===w?i.ref:(i=function(E){var o=_.refs;E===null?delete o[w]:o[w]=E},i._stringRef=w,i)}if(typeof t!="string")throw Error(Zt(284));if(!c._owner)throw Error(Zt(290,t))}return t}function m0(t,i){throw t=Object.prototype.toString.call(i),Error(Zt(31,t==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":t))}function OR(t){var i=t._init;return i(t._payload)}function Xz(t){function i(Y,Q){if(t){var ae=Y.deletions;ae===null?(Y.deletions=[Q],Y.flags|=16):ae.push(Q)}}function c(Y,Q){if(!t)return null;for(;Q!==null;)i(Y,Q),Q=Q.sibling;return null}function f(Y,Q){for(Y=new Map;Q!==null;)Q.key!==null?Y.set(Q.key,Q):Y.set(Q.index,Q),Q=Q.sibling;return Y}function _(Y,Q){return Y=rh(Y,Q),Y.index=0,Y.sibling=null,Y}function w(Y,Q,ae){return Y.index=ae,t?(ae=Y.alternate,ae!==null?(ae=ae.index,ae<Q?(Y.flags|=2,Q):ae):(Y.flags|=2,Q)):(Y.flags|=1048576,Q)}function E(Y){return t&&Y.alternate===null&&(Y.flags|=2),Y}function o(Y,Q,ae,Te){return Q===null||Q.tag!==6?(Q=jT(ae,Y.mode,Te),Q.return=Y,Q):(Q=_(Q,ae),Q.return=Y,Q)}function k(Y,Q,ae,Te){var Be=ae.type;return Be===Mp?N(Y,Q,ae.props.children,Te,ae.key):Q!==null&&(Q.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===Nu&&OR(Be)===Q.type)?(Te=_(Q,ae.props),Te.ref=D_(Y,Q,ae),Te.return=Y,Te):(Te=V0(ae.type,ae.key,ae.props,null,Y.mode,Te),Te.ref=D_(Y,Q,ae),Te.return=Y,Te)}function L(Y,Q,ae,Te){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==ae.containerInfo||Q.stateNode.implementation!==ae.implementation?(Q=VT(ae,Y.mode,Te),Q.return=Y,Q):(Q=_(Q,ae.children||[]),Q.return=Y,Q)}function N(Y,Q,ae,Te,Be){return Q===null||Q.tag!==7?(Q=Md(ae,Y.mode,Te,Be),Q.return=Y,Q):(Q=_(Q,ae),Q.return=Y,Q)}function V(Y,Q,ae){if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Q=jT(""+Q,Y.mode,ae),Q.return=Y,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case r0:return ae=V0(Q.type,Q.key,Q.props,null,Y.mode,ae),ae.ref=D_(Y,null,Q),ae.return=Y,ae;case Pp:return Q=VT(Q,Y.mode,ae),Q.return=Y,Q;case Nu:var Te=Q._init;return V(Y,Te(Q._payload),ae)}if(U_(Q)||C_(Q))return Q=Md(Q,Y.mode,ae,null),Q.return=Y,Q;m0(Y,Q)}return null}function H(Y,Q,ae,Te){var Be=Q!==null?Q.key:null;if(typeof ae=="string"&&ae!==""||typeof ae=="number")return Be!==null?null:o(Y,Q,""+ae,Te);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case r0:return ae.key===Be?k(Y,Q,ae,Te):null;case Pp:return ae.key===Be?L(Y,Q,ae,Te):null;case Nu:return Be=ae._init,H(Y,Q,Be(ae._payload),Te)}if(U_(ae)||C_(ae))return Be!==null?null:N(Y,Q,ae,Te,null);m0(Y,ae)}return null}function ne(Y,Q,ae,Te,Be){if(typeof Te=="string"&&Te!==""||typeof Te=="number")return Y=Y.get(ae)||null,o(Q,Y,""+Te,Be);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case r0:return Y=Y.get(Te.key===null?ae:Te.key)||null,k(Q,Y,Te,Be);case Pp:return Y=Y.get(Te.key===null?ae:Te.key)||null,L(Q,Y,Te,Be);case Nu:var et=Te._init;return ne(Y,Q,ae,et(Te._payload),Be)}if(U_(Te)||C_(Te))return Y=Y.get(ae)||null,N(Q,Y,Te,Be,null);m0(Q,Te)}return null}function ce(Y,Q,ae,Te){for(var Be=null,et=null,nt=Q,Je=Q=0,Dt=null;nt!==null&&Je<ae.length;Je++){nt.index>Je?(Dt=nt,nt=null):Dt=nt.sibling;var wt=H(Y,nt,ae[Je],Te);if(wt===null){nt===null&&(nt=Dt);break}t&&nt&&wt.alternate===null&&i(Y,nt),Q=w(wt,Q,Je),et===null?Be=wt:et.sibling=wt,et=wt,nt=Dt}if(Je===ae.length)return c(Y,nt),Mr&&hd(Y,Je),Be;if(nt===null){for(;Je<ae.length;Je++)nt=V(Y,ae[Je],Te),nt!==null&&(Q=w(nt,Q,Je),et===null?Be=nt:et.sibling=nt,et=nt);return Mr&&hd(Y,Je),Be}for(nt=f(Y,nt);Je<ae.length;Je++)Dt=ne(nt,Y,Je,ae[Je],Te),Dt!==null&&(t&&Dt.alternate!==null&&nt.delete(Dt.key===null?Je:Dt.key),Q=w(Dt,Q,Je),et===null?Be=Dt:et.sibling=Dt,et=Dt);return t&&nt.forEach(function(xt){return i(Y,xt)}),Mr&&hd(Y,Je),Be}function K(Y,Q,ae,Te){var Be=C_(ae);if(typeof Be!="function")throw Error(Zt(150));if(ae=Be.call(ae),ae==null)throw Error(Zt(151));for(var et=Be=null,nt=Q,Je=Q=0,Dt=null,wt=ae.next();nt!==null&&!wt.done;Je++,wt=ae.next()){nt.index>Je?(Dt=nt,nt=null):Dt=nt.sibling;var xt=H(Y,nt,wt.value,Te);if(xt===null){nt===null&&(nt=Dt);break}t&&nt&&xt.alternate===null&&i(Y,nt),Q=w(xt,Q,Je),et===null?Be=xt:et.sibling=xt,et=xt,nt=Dt}if(wt.done)return c(Y,nt),Mr&&hd(Y,Je),Be;if(nt===null){for(;!wt.done;Je++,wt=ae.next())wt=V(Y,wt.value,Te),wt!==null&&(Q=w(wt,Q,Je),et===null?Be=wt:et.sibling=wt,et=wt);return Mr&&hd(Y,Je),Be}for(nt=f(Y,nt);!wt.done;Je++,wt=ae.next())wt=ne(nt,Y,Je,wt.value,Te),wt!==null&&(t&&wt.alternate!==null&&nt.delete(wt.key===null?Je:wt.key),Q=w(wt,Q,Je),et===null?Be=wt:et.sibling=wt,et=wt);return t&&nt.forEach(function(qt){return i(Y,qt)}),Mr&&hd(Y,Je),Be}function se(Y,Q,ae,Te){if(typeof ae=="object"&&ae!==null&&ae.type===Mp&&ae.key===null&&(ae=ae.props.children),typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case r0:e:{for(var Be=ae.key,et=Q;et!==null;){if(et.key===Be){if(Be=ae.type,Be===Mp){if(et.tag===7){c(Y,et.sibling),Q=_(et,ae.props.children),Q.return=Y,Y=Q;break e}}else if(et.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===Nu&&OR(Be)===et.type){c(Y,et.sibling),Q=_(et,ae.props),Q.ref=D_(Y,et,ae),Q.return=Y,Y=Q;break e}c(Y,et);break}else i(Y,et);et=et.sibling}ae.type===Mp?(Q=Md(ae.props.children,Y.mode,Te,ae.key),Q.return=Y,Y=Q):(Te=V0(ae.type,ae.key,ae.props,null,Y.mode,Te),Te.ref=D_(Y,Q,ae),Te.return=Y,Y=Te)}return E(Y);case Pp:e:{for(et=ae.key;Q!==null;){if(Q.key===et)if(Q.tag===4&&Q.stateNode.containerInfo===ae.containerInfo&&Q.stateNode.implementation===ae.implementation){c(Y,Q.sibling),Q=_(Q,ae.children||[]),Q.return=Y,Y=Q;break e}else{c(Y,Q);break}else i(Y,Q);Q=Q.sibling}Q=VT(ae,Y.mode,Te),Q.return=Y,Y=Q}return E(Y);case Nu:return et=ae._init,se(Y,Q,et(ae._payload),Te)}if(U_(ae))return ce(Y,Q,ae,Te);if(C_(ae))return K(Y,Q,ae,Te);m0(Y,ae)}return typeof ae=="string"&&ae!==""||typeof ae=="number"?(ae=""+ae,Q!==null&&Q.tag===6?(c(Y,Q.sibling),Q=_(Q,ae),Q.return=Y,Y=Q):(c(Y,Q),Q=jT(ae,Y.mode,Te),Q.return=Y,Y=Q),E(Y)):c(Y,Q)}return se}var pm=Xz(!0),Kz=Xz(!1),c1=dh(null),u1=null,Np=null,bE=null;function TE(){bE=Np=u1=null}function SE(t){var i=c1.current;Sr(c1),t._currentValue=i}function KS(t,i,c){for(;t!==null;){var f=t.alternate;if((t.childLanes&i)!==i?(t.childLanes|=i,f!==null&&(f.childLanes|=i)):f!==null&&(f.childLanes&i)!==i&&(f.childLanes|=i),t===c)break;t=t.return}}function Yp(t,i){u1=t,bE=Np=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&i&&(Ro=!0),t.firstContext=null)}function Aa(t){var i=t._currentValue;if(bE!==t)if(t={context:t,memoizedValue:i,next:null},Np===null){if(u1===null)throw Error(Zt(308));Np=t,u1.dependencies={lanes:0,firstContext:t}}else Np=Np.next=t;return i}var yd=null;function EE(t){yd===null?yd=[t]:yd.push(t)}function Yz(t,i,c,f){var _=i.interleaved;return _===null?(c.next=c,EE(i)):(c.next=_.next,_.next=c),i.interleaved=c,Fc(t,f)}function Fc(t,i){t.lanes|=i;var c=t.alternate;for(c!==null&&(c.lanes|=i),c=t,t=t.return;t!==null;)t.childLanes|=i,c=t.alternate,c!==null&&(c.childLanes|=i),c=t,t=t.return;return c.tag===3?c.stateNode:null}var Bu=!1;function IE(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Jz(t,i){t=t.updateQueue,i.updateQueue===t&&(i.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function kc(t,i){return{eventTime:t,lane:i,tag:0,payload:null,callback:null,next:null}}function th(t,i,c){var f=t.updateQueue;if(f===null)return null;if(f=f.shared,$i&2){var _=f.pending;return _===null?i.next=i:(i.next=_.next,_.next=i),f.pending=i,Fc(t,c)}return _=f.interleaved,_===null?(i.next=i,EE(f)):(i.next=_.next,_.next=i),f.interleaved=i,Fc(t,c)}function z0(t,i,c){if(i=i.updateQueue,i!==null&&(i=i.shared,(c&4194240)!==0)){var f=i.lanes;f&=t.pendingLanes,c|=f,i.lanes=c,hE(t,c)}}function FR(t,i){var c=t.updateQueue,f=t.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var _=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var E={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};w===null?_=w=E:w=w.next=E,c=c.next}while(c!==null);w===null?_=w=i:w=w.next=i}else _=w=i;c={baseState:f.baseState,firstBaseUpdate:_,lastBaseUpdate:w,shared:f.shared,effects:f.effects},t.updateQueue=c;return}t=c.lastBaseUpdate,t===null?c.firstBaseUpdate=i:t.next=i,c.lastBaseUpdate=i}function h1(t,i,c,f){var _=t.updateQueue;Bu=!1;var w=_.firstBaseUpdate,E=_.lastBaseUpdate,o=_.shared.pending;if(o!==null){_.shared.pending=null;var k=o,L=k.next;k.next=null,E===null?w=L:E.next=L,E=k;var N=t.alternate;N!==null&&(N=N.updateQueue,o=N.lastBaseUpdate,o!==E&&(o===null?N.firstBaseUpdate=L:o.next=L,N.lastBaseUpdate=k))}if(w!==null){var V=_.baseState;E=0,N=L=k=null,o=w;do{var H=o.lane,ne=o.eventTime;if((f&H)===H){N!==null&&(N=N.next={eventTime:ne,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var ce=t,K=o;switch(H=i,ne=c,K.tag){case 1:if(ce=K.payload,typeof ce=="function"){V=ce.call(ne,V,H);break e}V=ce;break e;case 3:ce.flags=ce.flags&-65537|128;case 0:if(ce=K.payload,H=typeof ce=="function"?ce.call(ne,V,H):ce,H==null)break e;V=Fr({},V,H);break e;case 2:Bu=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,H=_.effects,H===null?_.effects=[o]:H.push(o))}else ne={eventTime:ne,lane:H,tag:o.tag,payload:o.payload,callback:o.callback,next:null},N===null?(L=N=ne,k=V):N=N.next=ne,E|=H;if(o=o.next,o===null){if(o=_.shared.pending,o===null)break;H=o,o=H.next,H.next=null,_.lastBaseUpdate=H,_.shared.pending=null}}while(!0);if(N===null&&(k=V),_.baseState=k,_.firstBaseUpdate=L,_.lastBaseUpdate=N,i=_.shared.interleaved,i!==null){_=i;do E|=_.lane,_=_.next;while(_!==i)}else w===null&&(_.shared.lanes=0);zd|=E,t.lanes=E,t.memoizedState=V}}function NR(t,i,c){if(t=i.effects,i.effects=null,t!==null)for(i=0;i<t.length;i++){var f=t[i],_=f.callback;if(_!==null){if(f.callback=null,f=c,typeof _!="function")throw Error(Zt(191,_));_.call(f)}}}var Qy={},Ul=dh(Qy),Ey=dh(Qy),Iy=dh(Qy);function vd(t){if(t===Qy)throw Error(Zt(174));return t}function AE(t,i){switch(gr(Iy,i),gr(Ey,t),gr(Ul,Qy),t=i.nodeType,t){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:MS(null,"");break;default:t=t===8?i.parentNode:i,i=t.namespaceURI||null,t=t.tagName,i=MS(i,t)}Sr(Ul),gr(Ul,i)}function mm(){Sr(Ul),Sr(Ey),Sr(Iy)}function Qz(t){vd(Iy.current);var i=vd(Ul.current),c=MS(i,t.type);i!==c&&(gr(Ey,t),gr(Ul,c))}function CE(t){Ey.current===t&&(Sr(Ul),Sr(Ey))}var Dr=dh(0);function d1(t){for(var i=t;i!==null;){if(i.tag===13){var c=i.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var LT=[];function PE(){for(var t=0;t<LT.length;t++)LT[t]._workInProgressVersionPrimary=null;LT.length=0}var O0=jc.ReactCurrentDispatcher,zT=jc.ReactCurrentBatchConfig,Ld=0,Or=null,hs=null,Is=null,f1=!1,ey=!1,Ay=0,F6=0;function Ws(){throw Error(Zt(321))}function ME(t,i){if(i===null)return!1;for(var c=0;c<i.length&&c<t.length;c++)if(!nl(t[c],i[c]))return!1;return!0}function RE(t,i,c,f,_,w){if(Ld=w,Or=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,O0.current=t===null||t.memoizedState===null?V6:U6,t=c(f,_),ey){w=0;do{if(ey=!1,Ay=0,25<=w)throw Error(Zt(301));w+=1,Is=hs=null,i.updateQueue=null,O0.current=G6,t=c(f,_)}while(ey)}if(O0.current=p1,i=hs!==null&&hs.next!==null,Ld=0,Is=hs=Or=null,f1=!1,i)throw Error(Zt(300));return t}function kE(){var t=Ay!==0;return Ay=0,t}function Dl(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Is===null?Or.memoizedState=Is=t:Is=Is.next=t,Is}function Ca(){if(hs===null){var t=Or.alternate;t=t!==null?t.memoizedState:null}else t=hs.next;var i=Is===null?Or.memoizedState:Is.next;if(i!==null)Is=i,hs=t;else{if(t===null)throw Error(Zt(310));hs=t,t={memoizedState:hs.memoizedState,baseState:hs.baseState,baseQueue:hs.baseQueue,queue:hs.queue,next:null},Is===null?Or.memoizedState=Is=t:Is=Is.next=t}return Is}function Cy(t,i){return typeof i=="function"?i(t):i}function OT(t){var i=Ca(),c=i.queue;if(c===null)throw Error(Zt(311));c.lastRenderedReducer=t;var f=hs,_=f.baseQueue,w=c.pending;if(w!==null){if(_!==null){var E=_.next;_.next=w.next,w.next=E}f.baseQueue=_=w,c.pending=null}if(_!==null){w=_.next,f=f.baseState;var o=E=null,k=null,L=w;do{var N=L.lane;if((Ld&N)===N)k!==null&&(k=k.next={lane:0,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null}),f=L.hasEagerState?L.eagerState:t(f,L.action);else{var V={lane:N,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null};k===null?(o=k=V,E=f):k=k.next=V,Or.lanes|=N,zd|=N}L=L.next}while(L!==null&&L!==w);k===null?E=f:k.next=o,nl(f,i.memoizedState)||(Ro=!0),i.memoizedState=f,i.baseState=E,i.baseQueue=k,c.lastRenderedState=f}if(t=c.interleaved,t!==null){_=t;do w=_.lane,Or.lanes|=w,zd|=w,_=_.next;while(_!==t)}else _===null&&(c.lanes=0);return[i.memoizedState,c.dispatch]}function FT(t){var i=Ca(),c=i.queue;if(c===null)throw Error(Zt(311));c.lastRenderedReducer=t;var f=c.dispatch,_=c.pending,w=i.memoizedState;if(_!==null){c.pending=null;var E=_=_.next;do w=t(w,E.action),E=E.next;while(E!==_);nl(w,i.memoizedState)||(Ro=!0),i.memoizedState=w,i.baseQueue===null&&(i.baseState=w),c.lastRenderedState=w}return[w,f]}function eO(){}function tO(t,i){var c=Or,f=Ca(),_=i(),w=!nl(f.memoizedState,_);if(w&&(f.memoizedState=_,Ro=!0),f=f.queue,DE(rO.bind(null,c,f,t),[t]),f.getSnapshot!==i||w||Is!==null&&Is.memoizedState.tag&1){if(c.flags|=2048,Py(9,iO.bind(null,c,f,_,i),void 0,null),As===null)throw Error(Zt(349));Ld&30||nO(c,i,_)}return _}function nO(t,i,c){t.flags|=16384,t={getSnapshot:i,value:c},i=Or.updateQueue,i===null?(i={lastEffect:null,stores:null},Or.updateQueue=i,i.stores=[t]):(c=i.stores,c===null?i.stores=[t]:c.push(t))}function iO(t,i,c,f){i.value=c,i.getSnapshot=f,sO(i)&&oO(t)}function rO(t,i,c){return c(function(){sO(i)&&oO(t)})}function sO(t){var i=t.getSnapshot;t=t.value;try{var c=i();return!nl(t,c)}catch{return!0}}function oO(t){var i=Fc(t,1);i!==null&&el(i,t,1,-1)}function BR(t){var i=Dl();return typeof t=="function"&&(t=t()),i.memoizedState=i.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Cy,lastRenderedState:t},i.queue=t,t=t.dispatch=j6.bind(null,Or,t),[i.memoizedState,t]}function Py(t,i,c,f){return t={tag:t,create:i,destroy:c,deps:f,next:null},i=Or.updateQueue,i===null?(i={lastEffect:null,stores:null},Or.updateQueue=i,i.lastEffect=t.next=t):(c=i.lastEffect,c===null?i.lastEffect=t.next=t:(f=c.next,c.next=t,t.next=f,i.lastEffect=t)),t}function aO(){return Ca().memoizedState}function F0(t,i,c,f){var _=Dl();Or.flags|=t,_.memoizedState=Py(1|i,c,void 0,f===void 0?null:f)}function $1(t,i,c,f){var _=Ca();f=f===void 0?null:f;var w=void 0;if(hs!==null){var E=hs.memoizedState;if(w=E.destroy,f!==null&&ME(f,E.deps)){_.memoizedState=Py(i,c,w,f);return}}Or.flags|=t,_.memoizedState=Py(1|i,c,w,f)}function jR(t,i){return F0(8390656,8,t,i)}function DE(t,i){return $1(2048,8,t,i)}function lO(t,i){return $1(4,2,t,i)}function cO(t,i){return $1(4,4,t,i)}function uO(t,i){if(typeof i=="function")return t=t(),i(t),function(){i(null)};if(i!=null)return t=t(),i.current=t,function(){i.current=null}}function hO(t,i,c){return c=c!=null?c.concat([t]):null,$1(4,4,uO.bind(null,i,t),c)}function LE(){}function dO(t,i){var c=Ca();i=i===void 0?null:i;var f=c.memoizedState;return f!==null&&i!==null&&ME(i,f[1])?f[0]:(c.memoizedState=[t,i],t)}function fO(t,i){var c=Ca();i=i===void 0?null:i;var f=c.memoizedState;return f!==null&&i!==null&&ME(i,f[1])?f[0]:(t=t(),c.memoizedState=[t,i],t)}function pO(t,i,c){return Ld&21?(nl(c,i)||(c=vz(),Or.lanes|=c,zd|=c,t.baseState=!0),i):(t.baseState&&(t.baseState=!1,Ro=!0),t.memoizedState=c)}function N6(t,i){var c=Qi;Qi=c!==0&&4>c?c:4,t(!0);var f=zT.transition;zT.transition={};try{t(!1),i()}finally{Qi=c,zT.transition=f}}function mO(){return Ca().memoizedState}function B6(t,i,c){var f=ih(t);if(c={lane:f,action:c,hasEagerState:!1,eagerState:null,next:null},gO(t))_O(i,c);else if(c=Yz(t,i,c,f),c!==null){var _=To();el(c,t,f,_),yO(c,i,f)}}function j6(t,i,c){var f=ih(t),_={lane:f,action:c,hasEagerState:!1,eagerState:null,next:null};if(gO(t))_O(i,_);else{var w=t.alternate;if(t.lanes===0&&(w===null||w.lanes===0)&&(w=i.lastRenderedReducer,w!==null))try{var E=i.lastRenderedState,o=w(E,c);if(_.hasEagerState=!0,_.eagerState=o,nl(o,E)){var k=i.interleaved;k===null?(_.next=_,EE(i)):(_.next=k.next,k.next=_),i.interleaved=_;return}}catch{}finally{}c=Yz(t,i,_,f),c!==null&&(_=To(),el(c,t,f,_),yO(c,i,f))}}function gO(t){var i=t.alternate;return t===Or||i!==null&&i===Or}function _O(t,i){ey=f1=!0;var c=t.pending;c===null?i.next=i:(i.next=c.next,c.next=i),t.pending=i}function yO(t,i,c){if(c&4194240){var f=i.lanes;f&=t.pendingLanes,c|=f,i.lanes=c,hE(t,c)}}var p1={readContext:Aa,useCallback:Ws,useContext:Ws,useEffect:Ws,useImperativeHandle:Ws,useInsertionEffect:Ws,useLayoutEffect:Ws,useMemo:Ws,useReducer:Ws,useRef:Ws,useState:Ws,useDebugValue:Ws,useDeferredValue:Ws,useTransition:Ws,useMutableSource:Ws,useSyncExternalStore:Ws,useId:Ws,unstable_isNewReconciler:!1},V6={readContext:Aa,useCallback:function(t,i){return Dl().memoizedState=[t,i===void 0?null:i],t},useContext:Aa,useEffect:jR,useImperativeHandle:function(t,i,c){return c=c!=null?c.concat([t]):null,F0(4194308,4,uO.bind(null,i,t),c)},useLayoutEffect:function(t,i){return F0(4194308,4,t,i)},useInsertionEffect:function(t,i){return F0(4,2,t,i)},useMemo:function(t,i){var c=Dl();return i=i===void 0?null:i,t=t(),c.memoizedState=[t,i],t},useReducer:function(t,i,c){var f=Dl();return i=c!==void 0?c(i):i,f.memoizedState=f.baseState=i,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:i},f.queue=t,t=t.dispatch=B6.bind(null,Or,t),[f.memoizedState,t]},useRef:function(t){var i=Dl();return t={current:t},i.memoizedState=t},useState:BR,useDebugValue:LE,useDeferredValue:function(t){return Dl().memoizedState=t},useTransition:function(){var t=BR(!1),i=t[0];return t=N6.bind(null,t[1]),Dl().memoizedState=t,[i,t]},useMutableSource:function(){},useSyncExternalStore:function(t,i,c){var f=Or,_=Dl();if(Mr){if(c===void 0)throw Error(Zt(407));c=c()}else{if(c=i(),As===null)throw Error(Zt(349));Ld&30||nO(f,i,c)}_.memoizedState=c;var w={value:c,getSnapshot:i};return _.queue=w,jR(rO.bind(null,f,w,t),[t]),f.flags|=2048,Py(9,iO.bind(null,f,w,c,i),void 0,null),c},useId:function(){var t=Dl(),i=As.identifierPrefix;if(Mr){var c=Rc,f=Mc;c=(f&~(1<<32-Qa(f)-1)).toString(32)+c,i=":"+i+"R"+c,c=Ay++,0<c&&(i+="H"+c.toString(32)),i+=":"}else c=F6++,i=":"+i+"r"+c.toString(32)+":";return t.memoizedState=i},unstable_isNewReconciler:!1},U6={readContext:Aa,useCallback:dO,useContext:Aa,useEffect:DE,useImperativeHandle:hO,useInsertionEffect:lO,useLayoutEffect:cO,useMemo:fO,useReducer:OT,useRef:aO,useState:function(){return OT(Cy)},useDebugValue:LE,useDeferredValue:function(t){var i=Ca();return pO(i,hs.memoizedState,t)},useTransition:function(){var t=OT(Cy)[0],i=Ca().memoizedState;return[t,i]},useMutableSource:eO,useSyncExternalStore:tO,useId:mO,unstable_isNewReconciler:!1},G6={readContext:Aa,useCallback:dO,useContext:Aa,useEffect:DE,useImperativeHandle:hO,useInsertionEffect:lO,useLayoutEffect:cO,useMemo:fO,useReducer:FT,useRef:aO,useState:function(){return FT(Cy)},useDebugValue:LE,useDeferredValue:function(t){var i=Ca();return hs===null?i.memoizedState=t:pO(i,hs.memoizedState,t)},useTransition:function(){var t=FT(Cy)[0],i=Ca().memoizedState;return[t,i]},useMutableSource:eO,useSyncExternalStore:tO,useId:mO,unstable_isNewReconciler:!1};function Wa(t,i){if(t&&t.defaultProps){i=Fr({},i),t=t.defaultProps;for(var c in t)i[c]===void 0&&(i[c]=t[c]);return i}return i}function YS(t,i,c,f){i=t.memoizedState,c=c(f,i),c=c==null?i:Fr({},i,c),t.memoizedState=c,t.lanes===0&&(t.updateQueue.baseState=c)}var H1={isMounted:function(t){return(t=t._reactInternals)?Ud(t)===t:!1},enqueueSetState:function(t,i,c){t=t._reactInternals;var f=To(),_=ih(t),w=kc(f,_);w.payload=i,c!=null&&(w.callback=c),i=th(t,w,_),i!==null&&(el(i,t,_,f),z0(i,t,_))},enqueueReplaceState:function(t,i,c){t=t._reactInternals;var f=To(),_=ih(t),w=kc(f,_);w.tag=1,w.payload=i,c!=null&&(w.callback=c),i=th(t,w,_),i!==null&&(el(i,t,_,f),z0(i,t,_))},enqueueForceUpdate:function(t,i){t=t._reactInternals;var c=To(),f=ih(t),_=kc(c,f);_.tag=2,i!=null&&(_.callback=i),i=th(t,_,f),i!==null&&(el(i,t,f,c),z0(i,t,f))}};function VR(t,i,c,f,_,w,E){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(f,w,E):i.prototype&&i.prototype.isPureReactComponent?!wy(c,f)||!wy(_,w):!0}function vO(t,i,c){var f=!1,_=lh,w=i.contextType;return typeof w=="object"&&w!==null?w=Aa(w):(_=Do(i)?kd:Js.current,f=i.contextTypes,w=(f=f!=null)?dm(t,_):lh),i=new i(c,w),t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=H1,t.stateNode=i,i._reactInternals=t,f&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=_,t.__reactInternalMemoizedMaskedChildContext=w),i}function UR(t,i,c,f){t=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(c,f),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(c,f),i.state!==t&&H1.enqueueReplaceState(i,i.state,null)}function JS(t,i,c,f){var _=t.stateNode;_.props=c,_.state=t.memoizedState,_.refs={},IE(t);var w=i.contextType;typeof w=="object"&&w!==null?_.context=Aa(w):(w=Do(i)?kd:Js.current,_.context=dm(t,w)),_.state=t.memoizedState,w=i.getDerivedStateFromProps,typeof w=="function"&&(YS(t,i,w,c),_.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(i=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),i!==_.state&&H1.enqueueReplaceState(_,_.state,null),h1(t,c,_,f),_.state=t.memoizedState),typeof _.componentDidMount=="function"&&(t.flags|=4194308)}function gm(t,i){try{var c="",f=i;do c+=_U(f),f=f.return;while(f);var _=c}catch(w){_=`
Error generating stack: `+w.message+`
`+w.stack}return{value:t,source:i,stack:_,digest:null}}function NT(t,i,c){return{value:t,source:null,stack:c??null,digest:i??null}}function QS(t,i){try{console.error(i.value)}catch(c){setTimeout(function(){throw c})}}var $6=typeof WeakMap=="function"?WeakMap:Map;function xO(t,i,c){c=kc(-1,c),c.tag=3,c.payload={element:null};var f=i.value;return c.callback=function(){g1||(g1=!0,c2=f),QS(t,i)},c}function wO(t,i,c){c=kc(-1,c),c.tag=3;var f=t.type.getDerivedStateFromError;if(typeof f=="function"){var _=i.value;c.payload=function(){return f(_)},c.callback=function(){QS(t,i)}}var w=t.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(c.callback=function(){QS(t,i),typeof f!="function"&&(nh===null?nh=new Set([this]):nh.add(this));var E=i.stack;this.componentDidCatch(i.value,{componentStack:E!==null?E:""})}),c}function GR(t,i,c){var f=t.pingCache;if(f===null){f=t.pingCache=new $6;var _=new Set;f.set(i,_)}else _=f.get(i),_===void 0&&(_=new Set,f.set(i,_));_.has(c)||(_.add(c),t=r8.bind(null,t,i,c),i.then(t,t))}function $R(t){do{var i;if((i=t.tag===13)&&(i=t.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return t;t=t.return}while(t!==null);return null}function HR(t,i,c,f,_){return t.mode&1?(t.flags|=65536,t.lanes=_,t):(t===i?t.flags|=65536:(t.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(i=kc(-1,1),i.tag=2,th(c,i,1))),c.lanes|=1),t)}var H6=jc.ReactCurrentOwner,Ro=!1;function vo(t,i,c,f){i.child=t===null?Kz(i,null,c,f):pm(i,t.child,c,f)}function WR(t,i,c,f,_){c=c.render;var w=i.ref;return Yp(i,_),f=RE(t,i,c,f,w,_),c=kE(),t!==null&&!Ro?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~_,Nc(t,i,_)):(Mr&&c&&vE(i),i.flags|=1,vo(t,i,f,_),i.child)}function qR(t,i,c,f,_){if(t===null){var w=c.type;return typeof w=="function"&&!UE(w)&&w.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(i.tag=15,i.type=w,bO(t,i,w,f,_)):(t=V0(c.type,null,f,i,i.mode,_),t.ref=i.ref,t.return=i,i.child=t)}if(w=t.child,!(t.lanes&_)){var E=w.memoizedProps;if(c=c.compare,c=c!==null?c:wy,c(E,f)&&t.ref===i.ref)return Nc(t,i,_)}return i.flags|=1,t=rh(w,f),t.ref=i.ref,t.return=i,i.child=t}function bO(t,i,c,f,_){if(t!==null){var w=t.memoizedProps;if(wy(w,f)&&t.ref===i.ref)if(Ro=!1,i.pendingProps=f=w,(t.lanes&_)!==0)t.flags&131072&&(Ro=!0);else return i.lanes=t.lanes,Nc(t,i,_)}return e2(t,i,c,f,_)}function TO(t,i,c){var f=i.pendingProps,_=f.children,w=t!==null?t.memoizedState:null;if(f.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},gr(jp,Ko),Ko|=c;else{if(!(c&1073741824))return t=w!==null?w.baseLanes|c:c,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:t,cachePool:null,transitions:null},i.updateQueue=null,gr(jp,Ko),Ko|=t,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=w!==null?w.baseLanes:c,gr(jp,Ko),Ko|=f}else w!==null?(f=w.baseLanes|c,i.memoizedState=null):f=c,gr(jp,Ko),Ko|=f;return vo(t,i,_,c),i.child}function SO(t,i){var c=i.ref;(t===null&&c!==null||t!==null&&t.ref!==c)&&(i.flags|=512,i.flags|=2097152)}function e2(t,i,c,f,_){var w=Do(c)?kd:Js.current;return w=dm(i,w),Yp(i,_),c=RE(t,i,c,f,w,_),f=kE(),t!==null&&!Ro?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~_,Nc(t,i,_)):(Mr&&f&&vE(i),i.flags|=1,vo(t,i,c,_),i.child)}function ZR(t,i,c,f,_){if(Do(c)){var w=!0;o1(i)}else w=!1;if(Yp(i,_),i.stateNode===null)N0(t,i),vO(i,c,f),JS(i,c,f,_),f=!0;else if(t===null){var E=i.stateNode,o=i.memoizedProps;E.props=o;var k=E.context,L=c.contextType;typeof L=="object"&&L!==null?L=Aa(L):(L=Do(c)?kd:Js.current,L=dm(i,L));var N=c.getDerivedStateFromProps,V=typeof N=="function"||typeof E.getSnapshotBeforeUpdate=="function";V||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(o!==f||k!==L)&&UR(i,E,f,L),Bu=!1;var H=i.memoizedState;E.state=H,h1(i,f,E,_),k=i.memoizedState,o!==f||H!==k||ko.current||Bu?(typeof N=="function"&&(YS(i,c,N,f),k=i.memoizedState),(o=Bu||VR(i,c,o,f,H,k,L))?(V||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(i.flags|=4194308)):(typeof E.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=f,i.memoizedState=k),E.props=f,E.state=k,E.context=L,f=o):(typeof E.componentDidMount=="function"&&(i.flags|=4194308),f=!1)}else{E=i.stateNode,Jz(t,i),o=i.memoizedProps,L=i.type===i.elementType?o:Wa(i.type,o),E.props=L,V=i.pendingProps,H=E.context,k=c.contextType,typeof k=="object"&&k!==null?k=Aa(k):(k=Do(c)?kd:Js.current,k=dm(i,k));var ne=c.getDerivedStateFromProps;(N=typeof ne=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(o!==V||H!==k)&&UR(i,E,f,k),Bu=!1,H=i.memoizedState,E.state=H,h1(i,f,E,_);var ce=i.memoizedState;o!==V||H!==ce||ko.current||Bu?(typeof ne=="function"&&(YS(i,c,ne,f),ce=i.memoizedState),(L=Bu||VR(i,c,L,f,H,ce,k)||!1)?(N||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(f,ce,k),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(f,ce,k)),typeof E.componentDidUpdate=="function"&&(i.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof E.componentDidUpdate!="function"||o===t.memoizedProps&&H===t.memoizedState||(i.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&H===t.memoizedState||(i.flags|=1024),i.memoizedProps=f,i.memoizedState=ce),E.props=f,E.state=ce,E.context=k,f=L):(typeof E.componentDidUpdate!="function"||o===t.memoizedProps&&H===t.memoizedState||(i.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&H===t.memoizedState||(i.flags|=1024),f=!1)}return t2(t,i,c,f,w,_)}function t2(t,i,c,f,_,w){SO(t,i);var E=(i.flags&128)!==0;if(!f&&!E)return _&&DR(i,c,!1),Nc(t,i,w);f=i.stateNode,H6.current=i;var o=E&&typeof c.getDerivedStateFromError!="function"?null:f.render();return i.flags|=1,t!==null&&E?(i.child=pm(i,t.child,null,w),i.child=pm(i,null,o,w)):vo(t,i,o,w),i.memoizedState=f.state,_&&DR(i,c,!0),i.child}function EO(t){var i=t.stateNode;i.pendingContext?kR(t,i.pendingContext,i.pendingContext!==i.context):i.context&&kR(t,i.context,!1),AE(t,i.containerInfo)}function XR(t,i,c,f,_){return fm(),wE(_),i.flags|=256,vo(t,i,c,f),i.child}var n2={dehydrated:null,treeContext:null,retryLane:0};function i2(t){return{baseLanes:t,cachePool:null,transitions:null}}function IO(t,i,c){var f=i.pendingProps,_=Dr.current,w=!1,E=(i.flags&128)!==0,o;if((o=E)||(o=t!==null&&t.memoizedState===null?!1:(_&2)!==0),o?(w=!0,i.flags&=-129):(t===null||t.memoizedState!==null)&&(_|=1),gr(Dr,_&1),t===null)return XS(i),t=i.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(i.mode&1?t.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(E=f.children,t=f.fallback,w?(f=i.mode,w=i.child,E={mode:"hidden",children:E},!(f&1)&&w!==null?(w.childLanes=0,w.pendingProps=E):w=Z1(E,f,0,null),t=Md(t,f,c,null),w.return=i,t.return=i,w.sibling=t,i.child=w,i.child.memoizedState=i2(c),i.memoizedState=n2,t):zE(i,E));if(_=t.memoizedState,_!==null&&(o=_.dehydrated,o!==null))return W6(t,i,E,f,o,_,c);if(w){w=f.fallback,E=i.mode,_=t.child,o=_.sibling;var k={mode:"hidden",children:f.children};return!(E&1)&&i.child!==_?(f=i.child,f.childLanes=0,f.pendingProps=k,i.deletions=null):(f=rh(_,k),f.subtreeFlags=_.subtreeFlags&14680064),o!==null?w=rh(o,w):(w=Md(w,E,c,null),w.flags|=2),w.return=i,f.return=i,f.sibling=w,i.child=f,f=w,w=i.child,E=t.child.memoizedState,E=E===null?i2(c):{baseLanes:E.baseLanes|c,cachePool:null,transitions:E.transitions},w.memoizedState=E,w.childLanes=t.childLanes&~c,i.memoizedState=n2,f}return w=t.child,t=w.sibling,f=rh(w,{mode:"visible",children:f.children}),!(i.mode&1)&&(f.lanes=c),f.return=i,f.sibling=null,t!==null&&(c=i.deletions,c===null?(i.deletions=[t],i.flags|=16):c.push(t)),i.child=f,i.memoizedState=null,f}function zE(t,i){return i=Z1({mode:"visible",children:i},t.mode,0,null),i.return=t,t.child=i}function g0(t,i,c,f){return f!==null&&wE(f),pm(i,t.child,null,c),t=zE(i,i.pendingProps.children),t.flags|=2,i.memoizedState=null,t}function W6(t,i,c,f,_,w,E){if(c)return i.flags&256?(i.flags&=-257,f=NT(Error(Zt(422))),g0(t,i,E,f)):i.memoizedState!==null?(i.child=t.child,i.flags|=128,null):(w=f.fallback,_=i.mode,f=Z1({mode:"visible",children:f.children},_,0,null),w=Md(w,_,E,null),w.flags|=2,f.return=i,w.return=i,f.sibling=w,i.child=f,i.mode&1&&pm(i,t.child,null,E),i.child.memoizedState=i2(E),i.memoizedState=n2,w);if(!(i.mode&1))return g0(t,i,E,null);if(_.data==="$!"){if(f=_.nextSibling&&_.nextSibling.dataset,f)var o=f.dgst;return f=o,w=Error(Zt(419)),f=NT(w,f,void 0),g0(t,i,E,f)}if(o=(E&t.childLanes)!==0,Ro||o){if(f=As,f!==null){switch(E&-E){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(f.suspendedLanes|E)?0:_,_!==0&&_!==w.retryLane&&(w.retryLane=_,Fc(t,_),el(f,t,_,-1))}return VE(),f=NT(Error(Zt(421))),g0(t,i,E,f)}return _.data==="$?"?(i.flags|=128,i.child=t.child,i=s8.bind(null,t),_._reactRetry=i,null):(t=w.treeContext,Yo=eh(_.nextSibling),Jo=i,Mr=!0,Ja=null,t!==null&&(Ta[Sa++]=Mc,Ta[Sa++]=Rc,Ta[Sa++]=Dd,Mc=t.id,Rc=t.overflow,Dd=i),i=zE(i,f.children),i.flags|=4096,i)}function KR(t,i,c){t.lanes|=i;var f=t.alternate;f!==null&&(f.lanes|=i),KS(t.return,i,c)}function BT(t,i,c,f,_){var w=t.memoizedState;w===null?t.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:_}:(w.isBackwards=i,w.rendering=null,w.renderingStartTime=0,w.last=f,w.tail=c,w.tailMode=_)}function AO(t,i,c){var f=i.pendingProps,_=f.revealOrder,w=f.tail;if(vo(t,i,f.children,c),f=Dr.current,f&2)f=f&1|2,i.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=i.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&KR(t,c,i);else if(t.tag===19)KR(t,c,i);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break e;for(;t.sibling===null;){if(t.return===null||t.return===i)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}f&=1}if(gr(Dr,f),!(i.mode&1))i.memoizedState=null;else switch(_){case"forwards":for(c=i.child,_=null;c!==null;)t=c.alternate,t!==null&&d1(t)===null&&(_=c),c=c.sibling;c=_,c===null?(_=i.child,i.child=null):(_=c.sibling,c.sibling=null),BT(i,!1,_,c,w);break;case"backwards":for(c=null,_=i.child,i.child=null;_!==null;){if(t=_.alternate,t!==null&&d1(t)===null){i.child=_;break}t=_.sibling,_.sibling=c,c=_,_=t}BT(i,!0,c,null,w);break;case"together":BT(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function N0(t,i){!(i.mode&1)&&t!==null&&(t.alternate=null,i.alternate=null,i.flags|=2)}function Nc(t,i,c){if(t!==null&&(i.dependencies=t.dependencies),zd|=i.lanes,!(c&i.childLanes))return null;if(t!==null&&i.child!==t.child)throw Error(Zt(153));if(i.child!==null){for(t=i.child,c=rh(t,t.pendingProps),i.child=c,c.return=i;t.sibling!==null;)t=t.sibling,c=c.sibling=rh(t,t.pendingProps),c.return=i;c.sibling=null}return i.child}function q6(t,i,c){switch(i.tag){case 3:EO(i),fm();break;case 5:Qz(i);break;case 1:Do(i.type)&&o1(i);break;case 4:AE(i,i.stateNode.containerInfo);break;case 10:var f=i.type._context,_=i.memoizedProps.value;gr(c1,f._currentValue),f._currentValue=_;break;case 13:if(f=i.memoizedState,f!==null)return f.dehydrated!==null?(gr(Dr,Dr.current&1),i.flags|=128,null):c&i.child.childLanes?IO(t,i,c):(gr(Dr,Dr.current&1),t=Nc(t,i,c),t!==null?t.sibling:null);gr(Dr,Dr.current&1);break;case 19:if(f=(c&i.childLanes)!==0,t.flags&128){if(f)return AO(t,i,c);i.flags|=128}if(_=i.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),gr(Dr,Dr.current),f)break;return null;case 22:case 23:return i.lanes=0,TO(t,i,c)}return Nc(t,i,c)}var CO,r2,PO,MO;CO=function(t,i){for(var c=i.child;c!==null;){if(c.tag===5||c.tag===6)t.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===i)break;for(;c.sibling===null;){if(c.return===null||c.return===i)return;c=c.return}c.sibling.return=c.return,c=c.sibling}};r2=function(){};PO=function(t,i,c,f){var _=t.memoizedProps;if(_!==f){t=i.stateNode,vd(Ul.current);var w=null;switch(c){case"input":_=IS(t,_),f=IS(t,f),w=[];break;case"select":_=Fr({},_,{value:void 0}),f=Fr({},f,{value:void 0}),w=[];break;case"textarea":_=PS(t,_),f=PS(t,f),w=[];break;default:typeof _.onClick!="function"&&typeof f.onClick=="function"&&(t.onclick=r1)}RS(c,f);var E;c=null;for(L in _)if(!f.hasOwnProperty(L)&&_.hasOwnProperty(L)&&_[L]!=null)if(L==="style"){var o=_[L];for(E in o)o.hasOwnProperty(E)&&(c||(c={}),c[E]="")}else L!=="dangerouslySetInnerHTML"&&L!=="children"&&L!=="suppressContentEditableWarning"&&L!=="suppressHydrationWarning"&&L!=="autoFocus"&&(py.hasOwnProperty(L)?w||(w=[]):(w=w||[]).push(L,null));for(L in f){var k=f[L];if(o=_!=null?_[L]:void 0,f.hasOwnProperty(L)&&k!==o&&(k!=null||o!=null))if(L==="style")if(o){for(E in o)!o.hasOwnProperty(E)||k&&k.hasOwnProperty(E)||(c||(c={}),c[E]="");for(E in k)k.hasOwnProperty(E)&&o[E]!==k[E]&&(c||(c={}),c[E]=k[E])}else c||(w||(w=[]),w.push(L,c)),c=k;else L==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,o=o?o.__html:void 0,k!=null&&o!==k&&(w=w||[]).push(L,k)):L==="children"?typeof k!="string"&&typeof k!="number"||(w=w||[]).push(L,""+k):L!=="suppressContentEditableWarning"&&L!=="suppressHydrationWarning"&&(py.hasOwnProperty(L)?(k!=null&&L==="onScroll"&&Tr("scroll",t),w||o===k||(w=[])):(w=w||[]).push(L,k))}c&&(w=w||[]).push("style",c);var L=w;(i.updateQueue=L)&&(i.flags|=4)}};MO=function(t,i,c,f){c!==f&&(i.flags|=4)};function L_(t,i){if(!Mr)switch(t.tailMode){case"hidden":i=t.tail;for(var c=null;i!==null;)i.alternate!==null&&(c=i),i=i.sibling;c===null?t.tail=null:c.sibling=null;break;case"collapsed":c=t.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?i||t.tail===null?t.tail=null:t.tail.sibling=null:f.sibling=null}}function qs(t){var i=t.alternate!==null&&t.alternate.child===t.child,c=0,f=0;if(i)for(var _=t.child;_!==null;)c|=_.lanes|_.childLanes,f|=_.subtreeFlags&14680064,f|=_.flags&14680064,_.return=t,_=_.sibling;else for(_=t.child;_!==null;)c|=_.lanes|_.childLanes,f|=_.subtreeFlags,f|=_.flags,_.return=t,_=_.sibling;return t.subtreeFlags|=f,t.childLanes=c,i}function Z6(t,i,c){var f=i.pendingProps;switch(xE(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qs(i),null;case 1:return Do(i.type)&&s1(),qs(i),null;case 3:return f=i.stateNode,mm(),Sr(ko),Sr(Js),PE(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(t===null||t.child===null)&&(p0(i)?i.flags|=4:t===null||t.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,Ja!==null&&(d2(Ja),Ja=null))),r2(t,i),qs(i),null;case 5:CE(i);var _=vd(Iy.current);if(c=i.type,t!==null&&i.stateNode!=null)PO(t,i,c,f,_),t.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!f){if(i.stateNode===null)throw Error(Zt(166));return qs(i),null}if(t=vd(Ul.current),p0(i)){f=i.stateNode,c=i.type;var w=i.memoizedProps;switch(f[Nl]=i,f[Sy]=w,t=(i.mode&1)!==0,c){case"dialog":Tr("cancel",f),Tr("close",f);break;case"iframe":case"object":case"embed":Tr("load",f);break;case"video":case"audio":for(_=0;_<$_.length;_++)Tr($_[_],f);break;case"source":Tr("error",f);break;case"img":case"image":case"link":Tr("error",f),Tr("load",f);break;case"details":Tr("toggle",f);break;case"input":sR(f,w),Tr("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!w.multiple},Tr("invalid",f);break;case"textarea":aR(f,w),Tr("invalid",f)}RS(c,w),_=null;for(var E in w)if(w.hasOwnProperty(E)){var o=w[E];E==="children"?typeof o=="string"?f.textContent!==o&&(w.suppressHydrationWarning!==!0&&f0(f.textContent,o,t),_=["children",o]):typeof o=="number"&&f.textContent!==""+o&&(w.suppressHydrationWarning!==!0&&f0(f.textContent,o,t),_=["children",""+o]):py.hasOwnProperty(E)&&o!=null&&E==="onScroll"&&Tr("scroll",f)}switch(c){case"input":s0(f),oR(f,w,!0);break;case"textarea":s0(f),lR(f);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(f.onclick=r1)}f=_,i.updateQueue=f,f!==null&&(i.flags|=4)}else{E=_.nodeType===9?_:_.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=rz(c)),t==="http://www.w3.org/1999/xhtml"?c==="script"?(t=E.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof f.is=="string"?t=E.createElement(c,{is:f.is}):(t=E.createElement(c),c==="select"&&(E=t,f.multiple?E.multiple=!0:f.size&&(E.size=f.size))):t=E.createElementNS(t,c),t[Nl]=i,t[Sy]=f,CO(t,i,!1,!1),i.stateNode=t;e:{switch(E=kS(c,f),c){case"dialog":Tr("cancel",t),Tr("close",t),_=f;break;case"iframe":case"object":case"embed":Tr("load",t),_=f;break;case"video":case"audio":for(_=0;_<$_.length;_++)Tr($_[_],t);_=f;break;case"source":Tr("error",t),_=f;break;case"img":case"image":case"link":Tr("error",t),Tr("load",t),_=f;break;case"details":Tr("toggle",t),_=f;break;case"input":sR(t,f),_=IS(t,f),Tr("invalid",t);break;case"option":_=f;break;case"select":t._wrapperState={wasMultiple:!!f.multiple},_=Fr({},f,{value:void 0}),Tr("invalid",t);break;case"textarea":aR(t,f),_=PS(t,f),Tr("invalid",t);break;default:_=f}RS(c,_),o=_;for(w in o)if(o.hasOwnProperty(w)){var k=o[w];w==="style"?az(t,k):w==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,k!=null&&sz(t,k)):w==="children"?typeof k=="string"?(c!=="textarea"||k!=="")&&my(t,k):typeof k=="number"&&my(t,""+k):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(py.hasOwnProperty(w)?k!=null&&w==="onScroll"&&Tr("scroll",t):k!=null&&sE(t,w,k,E))}switch(c){case"input":s0(t),oR(t,f,!1);break;case"textarea":s0(t),lR(t);break;case"option":f.value!=null&&t.setAttribute("value",""+ah(f.value));break;case"select":t.multiple=!!f.multiple,w=f.value,w!=null?qp(t,!!f.multiple,w,!1):f.defaultValue!=null&&qp(t,!!f.multiple,f.defaultValue,!0);break;default:typeof _.onClick=="function"&&(t.onclick=r1)}switch(c){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return qs(i),null;case 6:if(t&&i.stateNode!=null)MO(t,i,t.memoizedProps,f);else{if(typeof f!="string"&&i.stateNode===null)throw Error(Zt(166));if(c=vd(Iy.current),vd(Ul.current),p0(i)){if(f=i.stateNode,c=i.memoizedProps,f[Nl]=i,(w=f.nodeValue!==c)&&(t=Jo,t!==null))switch(t.tag){case 3:f0(f.nodeValue,c,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&f0(f.nodeValue,c,(t.mode&1)!==0)}w&&(i.flags|=4)}else f=(c.nodeType===9?c:c.ownerDocument).createTextNode(f),f[Nl]=i,i.stateNode=f}return qs(i),null;case 13:if(Sr(Dr),f=i.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Mr&&Yo!==null&&i.mode&1&&!(i.flags&128))Zz(),fm(),i.flags|=98560,w=!1;else if(w=p0(i),f!==null&&f.dehydrated!==null){if(t===null){if(!w)throw Error(Zt(318));if(w=i.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(Zt(317));w[Nl]=i}else fm(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;qs(i),w=!1}else Ja!==null&&(d2(Ja),Ja=null),w=!0;if(!w)return i.flags&65536?i:null}return i.flags&128?(i.lanes=c,i):(f=f!==null,f!==(t!==null&&t.memoizedState!==null)&&f&&(i.child.flags|=8192,i.mode&1&&(t===null||Dr.current&1?ds===0&&(ds=3):VE())),i.updateQueue!==null&&(i.flags|=4),qs(i),null);case 4:return mm(),r2(t,i),t===null&&by(i.stateNode.containerInfo),qs(i),null;case 10:return SE(i.type._context),qs(i),null;case 17:return Do(i.type)&&s1(),qs(i),null;case 19:if(Sr(Dr),w=i.memoizedState,w===null)return qs(i),null;if(f=(i.flags&128)!==0,E=w.rendering,E===null)if(f)L_(w,!1);else{if(ds!==0||t!==null&&t.flags&128)for(t=i.child;t!==null;){if(E=d1(t),E!==null){for(i.flags|=128,L_(w,!1),f=E.updateQueue,f!==null&&(i.updateQueue=f,i.flags|=4),i.subtreeFlags=0,f=c,c=i.child;c!==null;)w=c,t=f,w.flags&=14680066,E=w.alternate,E===null?(w.childLanes=0,w.lanes=t,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=E.childLanes,w.lanes=E.lanes,w.child=E.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=E.memoizedProps,w.memoizedState=E.memoizedState,w.updateQueue=E.updateQueue,w.type=E.type,t=E.dependencies,w.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),c=c.sibling;return gr(Dr,Dr.current&1|2),i.child}t=t.sibling}w.tail!==null&&Yr()>_m&&(i.flags|=128,f=!0,L_(w,!1),i.lanes=4194304)}else{if(!f)if(t=d1(E),t!==null){if(i.flags|=128,f=!0,c=t.updateQueue,c!==null&&(i.updateQueue=c,i.flags|=4),L_(w,!0),w.tail===null&&w.tailMode==="hidden"&&!E.alternate&&!Mr)return qs(i),null}else 2*Yr()-w.renderingStartTime>_m&&c!==1073741824&&(i.flags|=128,f=!0,L_(w,!1),i.lanes=4194304);w.isBackwards?(E.sibling=i.child,i.child=E):(c=w.last,c!==null?c.sibling=E:i.child=E,w.last=E)}return w.tail!==null?(i=w.tail,w.rendering=i,w.tail=i.sibling,w.renderingStartTime=Yr(),i.sibling=null,c=Dr.current,gr(Dr,f?c&1|2:c&1),i):(qs(i),null);case 22:case 23:return jE(),f=i.memoizedState!==null,t!==null&&t.memoizedState!==null!==f&&(i.flags|=8192),f&&i.mode&1?Ko&1073741824&&(qs(i),i.subtreeFlags&6&&(i.flags|=8192)):qs(i),null;case 24:return null;case 25:return null}throw Error(Zt(156,i.tag))}function X6(t,i){switch(xE(i),i.tag){case 1:return Do(i.type)&&s1(),t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 3:return mm(),Sr(ko),Sr(Js),PE(),t=i.flags,t&65536&&!(t&128)?(i.flags=t&-65537|128,i):null;case 5:return CE(i),null;case 13:if(Sr(Dr),t=i.memoizedState,t!==null&&t.dehydrated!==null){if(i.alternate===null)throw Error(Zt(340));fm()}return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 19:return Sr(Dr),null;case 4:return mm(),null;case 10:return SE(i.type._context),null;case 22:case 23:return jE(),null;case 24:return null;default:return null}}var _0=!1,Xs=!1,K6=typeof WeakSet=="function"?WeakSet:Set,Pn=null;function Bp(t,i){var c=t.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(f){Gr(t,i,f)}else c.current=null}function s2(t,i,c){try{c()}catch(f){Gr(t,i,f)}}var YR=!1;function Y6(t,i){if(US=t1,t=zz(),yE(t)){if("selectionStart"in t)var c={start:t.selectionStart,end:t.selectionEnd};else e:{c=(c=t.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var _=f.anchorOffset,w=f.focusNode;f=f.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var E=0,o=-1,k=-1,L=0,N=0,V=t,H=null;t:for(;;){for(var ne;V!==c||_!==0&&V.nodeType!==3||(o=E+_),V!==w||f!==0&&V.nodeType!==3||(k=E+f),V.nodeType===3&&(E+=V.nodeValue.length),(ne=V.firstChild)!==null;)H=V,V=ne;for(;;){if(V===t)break t;if(H===c&&++L===_&&(o=E),H===w&&++N===f&&(k=E),(ne=V.nextSibling)!==null)break;V=H,H=V.parentNode}V=ne}c=o===-1||k===-1?null:{start:o,end:k}}else c=null}c=c||{start:0,end:0}}else c=null;for(GS={focusedElem:t,selectionRange:c},t1=!1,Pn=i;Pn!==null;)if(i=Pn,t=i.child,(i.subtreeFlags&1028)!==0&&t!==null)t.return=i,Pn=t;else for(;Pn!==null;){i=Pn;try{var ce=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(ce!==null){var K=ce.memoizedProps,se=ce.memoizedState,Y=i.stateNode,Q=Y.getSnapshotBeforeUpdate(i.elementType===i.type?K:Wa(i.type,K),se);Y.__reactInternalSnapshotBeforeUpdate=Q}break;case 3:var ae=i.stateNode.containerInfo;ae.nodeType===1?ae.textContent="":ae.nodeType===9&&ae.documentElement&&ae.removeChild(ae.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Zt(163))}}catch(Te){Gr(i,i.return,Te)}if(t=i.sibling,t!==null){t.return=i.return,Pn=t;break}Pn=i.return}return ce=YR,YR=!1,ce}function ty(t,i,c){var f=i.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var _=f=f.next;do{if((_.tag&t)===t){var w=_.destroy;_.destroy=void 0,w!==void 0&&s2(i,c,w)}_=_.next}while(_!==f)}}function W1(t,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var c=i=i.next;do{if((c.tag&t)===t){var f=c.create;c.destroy=f()}c=c.next}while(c!==i)}}function o2(t){var i=t.ref;if(i!==null){var c=t.stateNode;switch(t.tag){case 5:t=c;break;default:t=c}typeof i=="function"?i(t):i.current=t}}function RO(t){var i=t.alternate;i!==null&&(t.alternate=null,RO(i)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(i=t.stateNode,i!==null&&(delete i[Nl],delete i[Sy],delete i[WS],delete i[D6],delete i[L6])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function kO(t){return t.tag===5||t.tag===3||t.tag===4}function JR(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||kO(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function a2(t,i,c){var f=t.tag;if(f===5||f===6)t=t.stateNode,i?c.nodeType===8?c.parentNode.insertBefore(t,i):c.insertBefore(t,i):(c.nodeType===8?(i=c.parentNode,i.insertBefore(t,c)):(i=c,i.appendChild(t)),c=c._reactRootContainer,c!=null||i.onclick!==null||(i.onclick=r1));else if(f!==4&&(t=t.child,t!==null))for(a2(t,i,c),t=t.sibling;t!==null;)a2(t,i,c),t=t.sibling}function l2(t,i,c){var f=t.tag;if(f===5||f===6)t=t.stateNode,i?c.insertBefore(t,i):c.appendChild(t);else if(f!==4&&(t=t.child,t!==null))for(l2(t,i,c),t=t.sibling;t!==null;)l2(t,i,c),t=t.sibling}var ks=null,Ya=!1;function Ru(t,i,c){for(c=c.child;c!==null;)DO(t,i,c),c=c.sibling}function DO(t,i,c){if(Vl&&typeof Vl.onCommitFiberUnmount=="function")try{Vl.onCommitFiberUnmount(N1,c)}catch{}switch(c.tag){case 5:Xs||Bp(c,i);case 6:var f=ks,_=Ya;ks=null,Ru(t,i,c),ks=f,Ya=_,ks!==null&&(Ya?(t=ks,c=c.stateNode,t.nodeType===8?t.parentNode.removeChild(c):t.removeChild(c)):ks.removeChild(c.stateNode));break;case 18:ks!==null&&(Ya?(t=ks,c=c.stateNode,t.nodeType===8?kT(t.parentNode,c):t.nodeType===1&&kT(t,c),vy(t)):kT(ks,c.stateNode));break;case 4:f=ks,_=Ya,ks=c.stateNode.containerInfo,Ya=!0,Ru(t,i,c),ks=f,Ya=_;break;case 0:case 11:case 14:case 15:if(!Xs&&(f=c.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){_=f=f.next;do{var w=_,E=w.destroy;w=w.tag,E!==void 0&&(w&2||w&4)&&s2(c,i,E),_=_.next}while(_!==f)}Ru(t,i,c);break;case 1:if(!Xs&&(Bp(c,i),f=c.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=c.memoizedProps,f.state=c.memoizedState,f.componentWillUnmount()}catch(o){Gr(c,i,o)}Ru(t,i,c);break;case 21:Ru(t,i,c);break;case 22:c.mode&1?(Xs=(f=Xs)||c.memoizedState!==null,Ru(t,i,c),Xs=f):Ru(t,i,c);break;default:Ru(t,i,c)}}function QR(t){var i=t.updateQueue;if(i!==null){t.updateQueue=null;var c=t.stateNode;c===null&&(c=t.stateNode=new K6),i.forEach(function(f){var _=o8.bind(null,t,f);c.has(f)||(c.add(f),f.then(_,_))})}}function $a(t,i){var c=i.deletions;if(c!==null)for(var f=0;f<c.length;f++){var _=c[f];try{var w=t,E=i,o=E;e:for(;o!==null;){switch(o.tag){case 5:ks=o.stateNode,Ya=!1;break e;case 3:ks=o.stateNode.containerInfo,Ya=!0;break e;case 4:ks=o.stateNode.containerInfo,Ya=!0;break e}o=o.return}if(ks===null)throw Error(Zt(160));DO(w,E,_),ks=null,Ya=!1;var k=_.alternate;k!==null&&(k.return=null),_.return=null}catch(L){Gr(_,i,L)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)LO(i,t),i=i.sibling}function LO(t,i){var c=t.alternate,f=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if($a(i,t),kl(t),f&4){try{ty(3,t,t.return),W1(3,t)}catch(K){Gr(t,t.return,K)}try{ty(5,t,t.return)}catch(K){Gr(t,t.return,K)}}break;case 1:$a(i,t),kl(t),f&512&&c!==null&&Bp(c,c.return);break;case 5:if($a(i,t),kl(t),f&512&&c!==null&&Bp(c,c.return),t.flags&32){var _=t.stateNode;try{my(_,"")}catch(K){Gr(t,t.return,K)}}if(f&4&&(_=t.stateNode,_!=null)){var w=t.memoizedProps,E=c!==null?c.memoizedProps:w,o=t.type,k=t.updateQueue;if(t.updateQueue=null,k!==null)try{o==="input"&&w.type==="radio"&&w.name!=null&&nz(_,w),kS(o,E);var L=kS(o,w);for(E=0;E<k.length;E+=2){var N=k[E],V=k[E+1];N==="style"?az(_,V):N==="dangerouslySetInnerHTML"?sz(_,V):N==="children"?my(_,V):sE(_,N,V,L)}switch(o){case"input":AS(_,w);break;case"textarea":iz(_,w);break;case"select":var H=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!w.multiple;var ne=w.value;ne!=null?qp(_,!!w.multiple,ne,!1):H!==!!w.multiple&&(w.defaultValue!=null?qp(_,!!w.multiple,w.defaultValue,!0):qp(_,!!w.multiple,w.multiple?[]:"",!1))}_[Sy]=w}catch(K){Gr(t,t.return,K)}}break;case 6:if($a(i,t),kl(t),f&4){if(t.stateNode===null)throw Error(Zt(162));_=t.stateNode,w=t.memoizedProps;try{_.nodeValue=w}catch(K){Gr(t,t.return,K)}}break;case 3:if($a(i,t),kl(t),f&4&&c!==null&&c.memoizedState.isDehydrated)try{vy(i.containerInfo)}catch(K){Gr(t,t.return,K)}break;case 4:$a(i,t),kl(t);break;case 13:$a(i,t),kl(t),_=t.child,_.flags&8192&&(w=_.memoizedState!==null,_.stateNode.isHidden=w,!w||_.alternate!==null&&_.alternate.memoizedState!==null||(NE=Yr())),f&4&&QR(t);break;case 22:if(N=c!==null&&c.memoizedState!==null,t.mode&1?(Xs=(L=Xs)||N,$a(i,t),Xs=L):$a(i,t),kl(t),f&8192){if(L=t.memoizedState!==null,(t.stateNode.isHidden=L)&&!N&&t.mode&1)for(Pn=t,N=t.child;N!==null;){for(V=Pn=N;Pn!==null;){switch(H=Pn,ne=H.child,H.tag){case 0:case 11:case 14:case 15:ty(4,H,H.return);break;case 1:Bp(H,H.return);var ce=H.stateNode;if(typeof ce.componentWillUnmount=="function"){f=H,c=H.return;try{i=f,ce.props=i.memoizedProps,ce.state=i.memoizedState,ce.componentWillUnmount()}catch(K){Gr(f,c,K)}}break;case 5:Bp(H,H.return);break;case 22:if(H.memoizedState!==null){tk(V);continue}}ne!==null?(ne.return=H,Pn=ne):tk(V)}N=N.sibling}e:for(N=null,V=t;;){if(V.tag===5){if(N===null){N=V;try{_=V.stateNode,L?(w=_.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(o=V.stateNode,k=V.memoizedProps.style,E=k!=null&&k.hasOwnProperty("display")?k.display:null,o.style.display=oz("display",E))}catch(K){Gr(t,t.return,K)}}}else if(V.tag===6){if(N===null)try{V.stateNode.nodeValue=L?"":V.memoizedProps}catch(K){Gr(t,t.return,K)}}else if((V.tag!==22&&V.tag!==23||V.memoizedState===null||V===t)&&V.child!==null){V.child.return=V,V=V.child;continue}if(V===t)break e;for(;V.sibling===null;){if(V.return===null||V.return===t)break e;N===V&&(N=null),V=V.return}N===V&&(N=null),V.sibling.return=V.return,V=V.sibling}}break;case 19:$a(i,t),kl(t),f&4&&QR(t);break;case 21:break;default:$a(i,t),kl(t)}}function kl(t){var i=t.flags;if(i&2){try{e:{for(var c=t.return;c!==null;){if(kO(c)){var f=c;break e}c=c.return}throw Error(Zt(160))}switch(f.tag){case 5:var _=f.stateNode;f.flags&32&&(my(_,""),f.flags&=-33);var w=JR(t);l2(t,w,_);break;case 3:case 4:var E=f.stateNode.containerInfo,o=JR(t);a2(t,o,E);break;default:throw Error(Zt(161))}}catch(k){Gr(t,t.return,k)}t.flags&=-3}i&4096&&(t.flags&=-4097)}function J6(t,i,c){Pn=t,zO(t)}function zO(t,i,c){for(var f=(t.mode&1)!==0;Pn!==null;){var _=Pn,w=_.child;if(_.tag===22&&f){var E=_.memoizedState!==null||_0;if(!E){var o=_.alternate,k=o!==null&&o.memoizedState!==null||Xs;o=_0;var L=Xs;if(_0=E,(Xs=k)&&!L)for(Pn=_;Pn!==null;)E=Pn,k=E.child,E.tag===22&&E.memoizedState!==null?nk(_):k!==null?(k.return=E,Pn=k):nk(_);for(;w!==null;)Pn=w,zO(w),w=w.sibling;Pn=_,_0=o,Xs=L}ek(t)}else _.subtreeFlags&8772&&w!==null?(w.return=_,Pn=w):ek(t)}}function ek(t){for(;Pn!==null;){var i=Pn;if(i.flags&8772){var c=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:Xs||W1(5,i);break;case 1:var f=i.stateNode;if(i.flags&4&&!Xs)if(c===null)f.componentDidMount();else{var _=i.elementType===i.type?c.memoizedProps:Wa(i.type,c.memoizedProps);f.componentDidUpdate(_,c.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var w=i.updateQueue;w!==null&&NR(i,w,f);break;case 3:var E=i.updateQueue;if(E!==null){if(c=null,i.child!==null)switch(i.child.tag){case 5:c=i.child.stateNode;break;case 1:c=i.child.stateNode}NR(i,E,c)}break;case 5:var o=i.stateNode;if(c===null&&i.flags&4){c=o;var k=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":k.autoFocus&&c.focus();break;case"img":k.src&&(c.src=k.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var L=i.alternate;if(L!==null){var N=L.memoizedState;if(N!==null){var V=N.dehydrated;V!==null&&vy(V)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Zt(163))}Xs||i.flags&512&&o2(i)}catch(H){Gr(i,i.return,H)}}if(i===t){Pn=null;break}if(c=i.sibling,c!==null){c.return=i.return,Pn=c;break}Pn=i.return}}function tk(t){for(;Pn!==null;){var i=Pn;if(i===t){Pn=null;break}var c=i.sibling;if(c!==null){c.return=i.return,Pn=c;break}Pn=i.return}}function nk(t){for(;Pn!==null;){var i=Pn;try{switch(i.tag){case 0:case 11:case 15:var c=i.return;try{W1(4,i)}catch(k){Gr(i,c,k)}break;case 1:var f=i.stateNode;if(typeof f.componentDidMount=="function"){var _=i.return;try{f.componentDidMount()}catch(k){Gr(i,_,k)}}var w=i.return;try{o2(i)}catch(k){Gr(i,w,k)}break;case 5:var E=i.return;try{o2(i)}catch(k){Gr(i,E,k)}}}catch(k){Gr(i,i.return,k)}if(i===t){Pn=null;break}var o=i.sibling;if(o!==null){o.return=i.return,Pn=o;break}Pn=i.return}}var Q6=Math.ceil,m1=jc.ReactCurrentDispatcher,OE=jc.ReactCurrentOwner,Ia=jc.ReactCurrentBatchConfig,$i=0,As=null,ss=null,zs=0,Ko=0,jp=dh(0),ds=0,My=null,zd=0,q1=0,FE=0,ny=null,Mo=null,NE=0,_m=1/0,Ac=null,g1=!1,c2=null,nh=null,y0=!1,Xu=null,_1=0,iy=0,u2=null,B0=-1,j0=0;function To(){return $i&6?Yr():B0!==-1?B0:B0=Yr()}function ih(t){return t.mode&1?$i&2&&zs!==0?zs&-zs:O6.transition!==null?(j0===0&&(j0=vz()),j0):(t=Qi,t!==0||(t=window.event,t=t===void 0?16:Iz(t.type)),t):1}function el(t,i,c,f){if(50<iy)throw iy=0,u2=null,Error(Zt(185));Ky(t,c,f),(!($i&2)||t!==As)&&(t===As&&(!($i&2)&&(q1|=c),ds===4&&Vu(t,zs)),Lo(t,f),c===1&&$i===0&&!(i.mode&1)&&(_m=Yr()+500,G1&&fh()))}function Lo(t,i){var c=t.callbackNode;OU(t,i);var f=e1(t,t===As?zs:0);if(f===0)c!==null&&hR(c),t.callbackNode=null,t.callbackPriority=0;else if(i=f&-f,t.callbackPriority!==i){if(c!=null&&hR(c),i===1)t.tag===0?z6(ik.bind(null,t)):Hz(ik.bind(null,t)),R6(function(){!($i&6)&&fh()}),c=null;else{switch(xz(f)){case 1:c=uE;break;case 4:c=_z;break;case 16:c=Q0;break;case 536870912:c=yz;break;default:c=Q0}c=GO(c,OO.bind(null,t))}t.callbackPriority=i,t.callbackNode=c}}function OO(t,i){if(B0=-1,j0=0,$i&6)throw Error(Zt(327));var c=t.callbackNode;if(Jp()&&t.callbackNode!==c)return null;var f=e1(t,t===As?zs:0);if(f===0)return null;if(f&30||f&t.expiredLanes||i)i=y1(t,f);else{i=f;var _=$i;$i|=2;var w=NO();(As!==t||zs!==i)&&(Ac=null,_m=Yr()+500,Pd(t,i));do try{n8();break}catch(o){FO(t,o)}while(!0);TE(),m1.current=w,$i=_,ss!==null?i=0:(As=null,zs=0,i=ds)}if(i!==0){if(i===2&&(_=FS(t),_!==0&&(f=_,i=h2(t,_))),i===1)throw c=My,Pd(t,0),Vu(t,f),Lo(t,Yr()),c;if(i===6)Vu(t,f);else{if(_=t.current.alternate,!(f&30)&&!e8(_)&&(i=y1(t,f),i===2&&(w=FS(t),w!==0&&(f=w,i=h2(t,w))),i===1))throw c=My,Pd(t,0),Vu(t,f),Lo(t,Yr()),c;switch(t.finishedWork=_,t.finishedLanes=f,i){case 0:case 1:throw Error(Zt(345));case 2:dd(t,Mo,Ac);break;case 3:if(Vu(t,f),(f&130023424)===f&&(i=NE+500-Yr(),10<i)){if(e1(t,0)!==0)break;if(_=t.suspendedLanes,(_&f)!==f){To(),t.pingedLanes|=t.suspendedLanes&_;break}t.timeoutHandle=HS(dd.bind(null,t,Mo,Ac),i);break}dd(t,Mo,Ac);break;case 4:if(Vu(t,f),(f&4194240)===f)break;for(i=t.eventTimes,_=-1;0<f;){var E=31-Qa(f);w=1<<E,E=i[E],E>_&&(_=E),f&=~w}if(f=_,f=Yr()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*Q6(f/1960))-f,10<f){t.timeoutHandle=HS(dd.bind(null,t,Mo,Ac),f);break}dd(t,Mo,Ac);break;case 5:dd(t,Mo,Ac);break;default:throw Error(Zt(329))}}}return Lo(t,Yr()),t.callbackNode===c?OO.bind(null,t):null}function h2(t,i){var c=ny;return t.current.memoizedState.isDehydrated&&(Pd(t,i).flags|=256),t=y1(t,i),t!==2&&(i=Mo,Mo=c,i!==null&&d2(i)),t}function d2(t){Mo===null?Mo=t:Mo.push.apply(Mo,t)}function e8(t){for(var i=t;;){if(i.flags&16384){var c=i.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var f=0;f<c.length;f++){var _=c[f],w=_.getSnapshot;_=_.value;try{if(!nl(w(),_))return!1}catch{return!1}}}if(c=i.child,i.subtreeFlags&16384&&c!==null)c.return=i,i=c;else{if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Vu(t,i){for(i&=~FE,i&=~q1,t.suspendedLanes|=i,t.pingedLanes&=~i,t=t.expirationTimes;0<i;){var c=31-Qa(i),f=1<<c;t[c]=-1,i&=~f}}function ik(t){if($i&6)throw Error(Zt(327));Jp();var i=e1(t,0);if(!(i&1))return Lo(t,Yr()),null;var c=y1(t,i);if(t.tag!==0&&c===2){var f=FS(t);f!==0&&(i=f,c=h2(t,f))}if(c===1)throw c=My,Pd(t,0),Vu(t,i),Lo(t,Yr()),c;if(c===6)throw Error(Zt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=i,dd(t,Mo,Ac),Lo(t,Yr()),null}function BE(t,i){var c=$i;$i|=1;try{return t(i)}finally{$i=c,$i===0&&(_m=Yr()+500,G1&&fh())}}function Od(t){Xu!==null&&Xu.tag===0&&!($i&6)&&Jp();var i=$i;$i|=1;var c=Ia.transition,f=Qi;try{if(Ia.transition=null,Qi=1,t)return t()}finally{Qi=f,Ia.transition=c,$i=i,!($i&6)&&fh()}}function jE(){Ko=jp.current,Sr(jp)}function Pd(t,i){t.finishedWork=null,t.finishedLanes=0;var c=t.timeoutHandle;if(c!==-1&&(t.timeoutHandle=-1,M6(c)),ss!==null)for(c=ss.return;c!==null;){var f=c;switch(xE(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&s1();break;case 3:mm(),Sr(ko),Sr(Js),PE();break;case 5:CE(f);break;case 4:mm();break;case 13:Sr(Dr);break;case 19:Sr(Dr);break;case 10:SE(f.type._context);break;case 22:case 23:jE()}c=c.return}if(As=t,ss=t=rh(t.current,null),zs=Ko=i,ds=0,My=null,FE=q1=zd=0,Mo=ny=null,yd!==null){for(i=0;i<yd.length;i++)if(c=yd[i],f=c.interleaved,f!==null){c.interleaved=null;var _=f.next,w=c.pending;if(w!==null){var E=w.next;w.next=_,f.next=E}c.pending=f}yd=null}return t}function FO(t,i){do{var c=ss;try{if(TE(),O0.current=p1,f1){for(var f=Or.memoizedState;f!==null;){var _=f.queue;_!==null&&(_.pending=null),f=f.next}f1=!1}if(Ld=0,Is=hs=Or=null,ey=!1,Ay=0,OE.current=null,c===null||c.return===null){ds=1,My=i,ss=null;break}e:{var w=t,E=c.return,o=c,k=i;if(i=zs,o.flags|=32768,k!==null&&typeof k=="object"&&typeof k.then=="function"){var L=k,N=o,V=N.tag;if(!(N.mode&1)&&(V===0||V===11||V===15)){var H=N.alternate;H?(N.updateQueue=H.updateQueue,N.memoizedState=H.memoizedState,N.lanes=H.lanes):(N.updateQueue=null,N.memoizedState=null)}var ne=$R(E);if(ne!==null){ne.flags&=-257,HR(ne,E,o,w,i),ne.mode&1&&GR(w,L,i),i=ne,k=L;var ce=i.updateQueue;if(ce===null){var K=new Set;K.add(k),i.updateQueue=K}else ce.add(k);break e}else{if(!(i&1)){GR(w,L,i),VE();break e}k=Error(Zt(426))}}else if(Mr&&o.mode&1){var se=$R(E);if(se!==null){!(se.flags&65536)&&(se.flags|=256),HR(se,E,o,w,i),wE(gm(k,o));break e}}w=k=gm(k,o),ds!==4&&(ds=2),ny===null?ny=[w]:ny.push(w),w=E;do{switch(w.tag){case 3:w.flags|=65536,i&=-i,w.lanes|=i;var Y=xO(w,k,i);FR(w,Y);break e;case 1:o=k;var Q=w.type,ae=w.stateNode;if(!(w.flags&128)&&(typeof Q.getDerivedStateFromError=="function"||ae!==null&&typeof ae.componentDidCatch=="function"&&(nh===null||!nh.has(ae)))){w.flags|=65536,i&=-i,w.lanes|=i;var Te=wO(w,o,i);FR(w,Te);break e}}w=w.return}while(w!==null)}jO(c)}catch(Be){i=Be,ss===c&&c!==null&&(ss=c=c.return);continue}break}while(!0)}function NO(){var t=m1.current;return m1.current=p1,t===null?p1:t}function VE(){(ds===0||ds===3||ds===2)&&(ds=4),As===null||!(zd&268435455)&&!(q1&268435455)||Vu(As,zs)}function y1(t,i){var c=$i;$i|=2;var f=NO();(As!==t||zs!==i)&&(Ac=null,Pd(t,i));do try{t8();break}catch(_){FO(t,_)}while(!0);if(TE(),$i=c,m1.current=f,ss!==null)throw Error(Zt(261));return As=null,zs=0,ds}function t8(){for(;ss!==null;)BO(ss)}function n8(){for(;ss!==null&&!AU();)BO(ss)}function BO(t){var i=UO(t.alternate,t,Ko);t.memoizedProps=t.pendingProps,i===null?jO(t):ss=i,OE.current=null}function jO(t){var i=t;do{var c=i.alternate;if(t=i.return,i.flags&32768){if(c=X6(c,i),c!==null){c.flags&=32767,ss=c;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ds=6,ss=null;return}}else if(c=Z6(c,i,Ko),c!==null){ss=c;return}if(i=i.sibling,i!==null){ss=i;return}ss=i=t}while(i!==null);ds===0&&(ds=5)}function dd(t,i,c){var f=Qi,_=Ia.transition;try{Ia.transition=null,Qi=1,i8(t,i,c,f)}finally{Ia.transition=_,Qi=f}return null}function i8(t,i,c,f){do Jp();while(Xu!==null);if($i&6)throw Error(Zt(327));c=t.finishedWork;var _=t.finishedLanes;if(c===null)return null;if(t.finishedWork=null,t.finishedLanes=0,c===t.current)throw Error(Zt(177));t.callbackNode=null,t.callbackPriority=0;var w=c.lanes|c.childLanes;if(FU(t,w),t===As&&(ss=As=null,zs=0),!(c.subtreeFlags&2064)&&!(c.flags&2064)||y0||(y0=!0,GO(Q0,function(){return Jp(),null})),w=(c.flags&15990)!==0,c.subtreeFlags&15990||w){w=Ia.transition,Ia.transition=null;var E=Qi;Qi=1;var o=$i;$i|=4,OE.current=null,Y6(t,c),LO(c,t),T6(GS),t1=!!US,GS=US=null,t.current=c,J6(c),CU(),$i=o,Qi=E,Ia.transition=w}else t.current=c;if(y0&&(y0=!1,Xu=t,_1=_),w=t.pendingLanes,w===0&&(nh=null),RU(c.stateNode),Lo(t,Yr()),i!==null)for(f=t.onRecoverableError,c=0;c<i.length;c++)_=i[c],f(_.value,{componentStack:_.stack,digest:_.digest});if(g1)throw g1=!1,t=c2,c2=null,t;return _1&1&&t.tag!==0&&Jp(),w=t.pendingLanes,w&1?t===u2?iy++:(iy=0,u2=t):iy=0,fh(),null}function Jp(){if(Xu!==null){var t=xz(_1),i=Ia.transition,c=Qi;try{if(Ia.transition=null,Qi=16>t?16:t,Xu===null)var f=!1;else{if(t=Xu,Xu=null,_1=0,$i&6)throw Error(Zt(331));var _=$i;for($i|=4,Pn=t.current;Pn!==null;){var w=Pn,E=w.child;if(Pn.flags&16){var o=w.deletions;if(o!==null){for(var k=0;k<o.length;k++){var L=o[k];for(Pn=L;Pn!==null;){var N=Pn;switch(N.tag){case 0:case 11:case 15:ty(8,N,w)}var V=N.child;if(V!==null)V.return=N,Pn=V;else for(;Pn!==null;){N=Pn;var H=N.sibling,ne=N.return;if(RO(N),N===L){Pn=null;break}if(H!==null){H.return=ne,Pn=H;break}Pn=ne}}}var ce=w.alternate;if(ce!==null){var K=ce.child;if(K!==null){ce.child=null;do{var se=K.sibling;K.sibling=null,K=se}while(K!==null)}}Pn=w}}if(w.subtreeFlags&2064&&E!==null)E.return=w,Pn=E;else e:for(;Pn!==null;){if(w=Pn,w.flags&2048)switch(w.tag){case 0:case 11:case 15:ty(9,w,w.return)}var Y=w.sibling;if(Y!==null){Y.return=w.return,Pn=Y;break e}Pn=w.return}}var Q=t.current;for(Pn=Q;Pn!==null;){E=Pn;var ae=E.child;if(E.subtreeFlags&2064&&ae!==null)ae.return=E,Pn=ae;else e:for(E=Q;Pn!==null;){if(o=Pn,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:W1(9,o)}}catch(Be){Gr(o,o.return,Be)}if(o===E){Pn=null;break e}var Te=o.sibling;if(Te!==null){Te.return=o.return,Pn=Te;break e}Pn=o.return}}if($i=_,fh(),Vl&&typeof Vl.onPostCommitFiberRoot=="function")try{Vl.onPostCommitFiberRoot(N1,t)}catch{}f=!0}return f}finally{Qi=c,Ia.transition=i}}return!1}function rk(t,i,c){i=gm(c,i),i=xO(t,i,1),t=th(t,i,1),i=To(),t!==null&&(Ky(t,1,i),Lo(t,i))}function Gr(t,i,c){if(t.tag===3)rk(t,t,c);else for(;i!==null;){if(i.tag===3){rk(i,t,c);break}else if(i.tag===1){var f=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(nh===null||!nh.has(f))){t=gm(c,t),t=wO(i,t,1),i=th(i,t,1),t=To(),i!==null&&(Ky(i,1,t),Lo(i,t));break}}i=i.return}}function r8(t,i,c){var f=t.pingCache;f!==null&&f.delete(i),i=To(),t.pingedLanes|=t.suspendedLanes&c,As===t&&(zs&c)===c&&(ds===4||ds===3&&(zs&130023424)===zs&&500>Yr()-NE?Pd(t,0):FE|=c),Lo(t,i)}function VO(t,i){i===0&&(t.mode&1?(i=l0,l0<<=1,!(l0&130023424)&&(l0=4194304)):i=1);var c=To();t=Fc(t,i),t!==null&&(Ky(t,i,c),Lo(t,c))}function s8(t){var i=t.memoizedState,c=0;i!==null&&(c=i.retryLane),VO(t,c)}function o8(t,i){var c=0;switch(t.tag){case 13:var f=t.stateNode,_=t.memoizedState;_!==null&&(c=_.retryLane);break;case 19:f=t.stateNode;break;default:throw Error(Zt(314))}f!==null&&f.delete(i),VO(t,c)}var UO;UO=function(t,i,c){if(t!==null)if(t.memoizedProps!==i.pendingProps||ko.current)Ro=!0;else{if(!(t.lanes&c)&&!(i.flags&128))return Ro=!1,q6(t,i,c);Ro=!!(t.flags&131072)}else Ro=!1,Mr&&i.flags&1048576&&Wz(i,l1,i.index);switch(i.lanes=0,i.tag){case 2:var f=i.type;N0(t,i),t=i.pendingProps;var _=dm(i,Js.current);Yp(i,c),_=RE(null,i,f,t,_,c);var w=kE();return i.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Do(f)?(w=!0,o1(i)):w=!1,i.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,IE(i),_.updater=H1,i.stateNode=_,_._reactInternals=i,JS(i,f,t,c),i=t2(null,i,f,!0,w,c)):(i.tag=0,Mr&&w&&vE(i),vo(null,i,_,c),i=i.child),i;case 16:f=i.elementType;e:{switch(N0(t,i),t=i.pendingProps,_=f._init,f=_(f._payload),i.type=f,_=i.tag=l8(f),t=Wa(f,t),_){case 0:i=e2(null,i,f,t,c);break e;case 1:i=ZR(null,i,f,t,c);break e;case 11:i=WR(null,i,f,t,c);break e;case 14:i=qR(null,i,f,Wa(f.type,t),c);break e}throw Error(Zt(306,f,""))}return i;case 0:return f=i.type,_=i.pendingProps,_=i.elementType===f?_:Wa(f,_),e2(t,i,f,_,c);case 1:return f=i.type,_=i.pendingProps,_=i.elementType===f?_:Wa(f,_),ZR(t,i,f,_,c);case 3:e:{if(EO(i),t===null)throw Error(Zt(387));f=i.pendingProps,w=i.memoizedState,_=w.element,Jz(t,i),h1(i,f,null,c);var E=i.memoizedState;if(f=E.element,w.isDehydrated)if(w={element:f,isDehydrated:!1,cache:E.cache,pendingSuspenseBoundaries:E.pendingSuspenseBoundaries,transitions:E.transitions},i.updateQueue.baseState=w,i.memoizedState=w,i.flags&256){_=gm(Error(Zt(423)),i),i=XR(t,i,f,c,_);break e}else if(f!==_){_=gm(Error(Zt(424)),i),i=XR(t,i,f,c,_);break e}else for(Yo=eh(i.stateNode.containerInfo.firstChild),Jo=i,Mr=!0,Ja=null,c=Kz(i,null,f,c),i.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(fm(),f===_){i=Nc(t,i,c);break e}vo(t,i,f,c)}i=i.child}return i;case 5:return Qz(i),t===null&&XS(i),f=i.type,_=i.pendingProps,w=t!==null?t.memoizedProps:null,E=_.children,$S(f,_)?E=null:w!==null&&$S(f,w)&&(i.flags|=32),SO(t,i),vo(t,i,E,c),i.child;case 6:return t===null&&XS(i),null;case 13:return IO(t,i,c);case 4:return AE(i,i.stateNode.containerInfo),f=i.pendingProps,t===null?i.child=pm(i,null,f,c):vo(t,i,f,c),i.child;case 11:return f=i.type,_=i.pendingProps,_=i.elementType===f?_:Wa(f,_),WR(t,i,f,_,c);case 7:return vo(t,i,i.pendingProps,c),i.child;case 8:return vo(t,i,i.pendingProps.children,c),i.child;case 12:return vo(t,i,i.pendingProps.children,c),i.child;case 10:e:{if(f=i.type._context,_=i.pendingProps,w=i.memoizedProps,E=_.value,gr(c1,f._currentValue),f._currentValue=E,w!==null)if(nl(w.value,E)){if(w.children===_.children&&!ko.current){i=Nc(t,i,c);break e}}else for(w=i.child,w!==null&&(w.return=i);w!==null;){var o=w.dependencies;if(o!==null){E=w.child;for(var k=o.firstContext;k!==null;){if(k.context===f){if(w.tag===1){k=kc(-1,c&-c),k.tag=2;var L=w.updateQueue;if(L!==null){L=L.shared;var N=L.pending;N===null?k.next=k:(k.next=N.next,N.next=k),L.pending=k}}w.lanes|=c,k=w.alternate,k!==null&&(k.lanes|=c),KS(w.return,c,i),o.lanes|=c;break}k=k.next}}else if(w.tag===10)E=w.type===i.type?null:w.child;else if(w.tag===18){if(E=w.return,E===null)throw Error(Zt(341));E.lanes|=c,o=E.alternate,o!==null&&(o.lanes|=c),KS(E,c,i),E=w.sibling}else E=w.child;if(E!==null)E.return=w;else for(E=w;E!==null;){if(E===i){E=null;break}if(w=E.sibling,w!==null){w.return=E.return,E=w;break}E=E.return}w=E}vo(t,i,_.children,c),i=i.child}return i;case 9:return _=i.type,f=i.pendingProps.children,Yp(i,c),_=Aa(_),f=f(_),i.flags|=1,vo(t,i,f,c),i.child;case 14:return f=i.type,_=Wa(f,i.pendingProps),_=Wa(f.type,_),qR(t,i,f,_,c);case 15:return bO(t,i,i.type,i.pendingProps,c);case 17:return f=i.type,_=i.pendingProps,_=i.elementType===f?_:Wa(f,_),N0(t,i),i.tag=1,Do(f)?(t=!0,o1(i)):t=!1,Yp(i,c),vO(i,f,_),JS(i,f,_,c),t2(null,i,f,!0,t,c);case 19:return AO(t,i,c);case 22:return TO(t,i,c)}throw Error(Zt(156,i.tag))};function GO(t,i){return gz(t,i)}function a8(t,i,c,f){this.tag=t,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ea(t,i,c,f){return new a8(t,i,c,f)}function UE(t){return t=t.prototype,!(!t||!t.isReactComponent)}function l8(t){if(typeof t=="function")return UE(t)?1:0;if(t!=null){if(t=t.$$typeof,t===aE)return 11;if(t===lE)return 14}return 2}function rh(t,i){var c=t.alternate;return c===null?(c=Ea(t.tag,i,t.key,t.mode),c.elementType=t.elementType,c.type=t.type,c.stateNode=t.stateNode,c.alternate=t,t.alternate=c):(c.pendingProps=i,c.type=t.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=t.flags&14680064,c.childLanes=t.childLanes,c.lanes=t.lanes,c.child=t.child,c.memoizedProps=t.memoizedProps,c.memoizedState=t.memoizedState,c.updateQueue=t.updateQueue,i=t.dependencies,c.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},c.sibling=t.sibling,c.index=t.index,c.ref=t.ref,c}function V0(t,i,c,f,_,w){var E=2;if(f=t,typeof t=="function")UE(t)&&(E=1);else if(typeof t=="string")E=5;else e:switch(t){case Mp:return Md(c.children,_,w,i);case oE:E=8,_|=8;break;case bS:return t=Ea(12,c,i,_|2),t.elementType=bS,t.lanes=w,t;case TS:return t=Ea(13,c,i,_),t.elementType=TS,t.lanes=w,t;case SS:return t=Ea(19,c,i,_),t.elementType=SS,t.lanes=w,t;case QL:return Z1(c,_,w,i);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case YL:E=10;break e;case JL:E=9;break e;case aE:E=11;break e;case lE:E=14;break e;case Nu:E=16,f=null;break e}throw Error(Zt(130,t==null?t:typeof t,""))}return i=Ea(E,c,i,_),i.elementType=t,i.type=f,i.lanes=w,i}function Md(t,i,c,f){return t=Ea(7,t,f,i),t.lanes=c,t}function Z1(t,i,c,f){return t=Ea(22,t,f,i),t.elementType=QL,t.lanes=c,t.stateNode={isHidden:!1},t}function jT(t,i,c){return t=Ea(6,t,null,i),t.lanes=c,t}function VT(t,i,c){return i=Ea(4,t.children!==null?t.children:[],t.key,i),i.lanes=c,i.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},i}function c8(t,i,c,f,_){this.tag=i,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wT(0),this.expirationTimes=wT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wT(0),this.identifierPrefix=f,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function GE(t,i,c,f,_,w,E,o,k){return t=new c8(t,i,c,o,k),i===1?(i=1,w===!0&&(i|=8)):i=0,w=Ea(3,null,null,i),t.current=w,w.stateNode=t,w.memoizedState={element:f,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},IE(w),t}function u8(t,i,c){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Pp,key:f==null?null:""+f,children:t,containerInfo:i,implementation:c}}function $O(t){if(!t)return lh;t=t._reactInternals;e:{if(Ud(t)!==t||t.tag!==1)throw Error(Zt(170));var i=t;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Do(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(Zt(171))}if(t.tag===1){var c=t.type;if(Do(c))return $z(t,c,i)}return i}function HO(t,i,c,f,_,w,E,o,k){return t=GE(c,f,!0,t,_,w,E,o,k),t.context=$O(null),c=t.current,f=To(),_=ih(c),w=kc(f,_),w.callback=i??null,th(c,w,_),t.current.lanes=_,Ky(t,_,f),Lo(t,f),t}function X1(t,i,c,f){var _=i.current,w=To(),E=ih(_);return c=$O(c),i.context===null?i.context=c:i.pendingContext=c,i=kc(w,E),i.payload={element:t},f=f===void 0?null:f,f!==null&&(i.callback=f),t=th(_,i,E),t!==null&&(el(t,_,E,w),z0(t,_,E)),E}function v1(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function sk(t,i){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var c=t.retryLane;t.retryLane=c!==0&&c<i?c:i}}function $E(t,i){sk(t,i),(t=t.alternate)&&sk(t,i)}function h8(){return null}var WO=typeof reportError=="function"?reportError:function(t){console.error(t)};function HE(t){this._internalRoot=t}K1.prototype.render=HE.prototype.render=function(t){var i=this._internalRoot;if(i===null)throw Error(Zt(409));X1(t,i,null,null)};K1.prototype.unmount=HE.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var i=t.containerInfo;Od(function(){X1(null,t,null,null)}),i[Oc]=null}};function K1(t){this._internalRoot=t}K1.prototype.unstable_scheduleHydration=function(t){if(t){var i=Tz();t={blockedOn:null,target:t,priority:i};for(var c=0;c<ju.length&&i!==0&&i<ju[c].priority;c++);ju.splice(c,0,t),c===0&&Ez(t)}};function WE(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Y1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function ok(){}function d8(t,i,c,f,_){if(_){if(typeof f=="function"){var w=f;f=function(){var L=v1(E);w.call(L)}}var E=HO(i,f,t,0,null,!1,!1,"",ok);return t._reactRootContainer=E,t[Oc]=E.current,by(t.nodeType===8?t.parentNode:t),Od(),E}for(;_=t.lastChild;)t.removeChild(_);if(typeof f=="function"){var o=f;f=function(){var L=v1(k);o.call(L)}}var k=GE(t,0,!1,null,null,!1,!1,"",ok);return t._reactRootContainer=k,t[Oc]=k.current,by(t.nodeType===8?t.parentNode:t),Od(function(){X1(i,k,c,f)}),k}function J1(t,i,c,f,_){var w=c._reactRootContainer;if(w){var E=w;if(typeof _=="function"){var o=_;_=function(){var k=v1(E);o.call(k)}}X1(i,E,t,_)}else E=d8(c,i,t,_,f);return v1(E)}wz=function(t){switch(t.tag){case 3:var i=t.stateNode;if(i.current.memoizedState.isDehydrated){var c=G_(i.pendingLanes);c!==0&&(hE(i,c|1),Lo(i,Yr()),!($i&6)&&(_m=Yr()+500,fh()))}break;case 13:Od(function(){var f=Fc(t,1);if(f!==null){var _=To();el(f,t,1,_)}}),$E(t,1)}};dE=function(t){if(t.tag===13){var i=Fc(t,134217728);if(i!==null){var c=To();el(i,t,134217728,c)}$E(t,134217728)}};bz=function(t){if(t.tag===13){var i=ih(t),c=Fc(t,i);if(c!==null){var f=To();el(c,t,i,f)}$E(t,i)}};Tz=function(){return Qi};Sz=function(t,i){var c=Qi;try{return Qi=t,i()}finally{Qi=c}};LS=function(t,i,c){switch(i){case"input":if(AS(t,c),i=c.name,c.type==="radio"&&i!=null){for(c=t;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<c.length;i++){var f=c[i];if(f!==t&&f.form===t.form){var _=U1(f);if(!_)throw Error(Zt(90));tz(f),AS(f,_)}}}break;case"textarea":iz(t,c);break;case"select":i=c.value,i!=null&&qp(t,!!c.multiple,i,!1)}};uz=BE;hz=Od;var f8={usingClientEntryPoint:!1,Events:[Jy,Lp,U1,lz,cz,BE]},z_={findFiberByHostInstance:_d,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},p8={bundleType:z_.bundleType,version:z_.version,rendererPackageName:z_.rendererPackageName,rendererConfig:z_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:jc.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=pz(t),t===null?null:t.stateNode},findFiberByHostInstance:z_.findFiberByHostInstance||h8,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var v0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!v0.isDisabled&&v0.supportsFiber)try{N1=v0.inject(p8),Vl=v0}catch{}}na.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=f8;na.createPortal=function(t,i){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!WE(i))throw Error(Zt(200));return u8(t,i,null,c)};na.createRoot=function(t,i){if(!WE(t))throw Error(Zt(299));var c=!1,f="",_=WO;return i!=null&&(i.unstable_strictMode===!0&&(c=!0),i.identifierPrefix!==void 0&&(f=i.identifierPrefix),i.onRecoverableError!==void 0&&(_=i.onRecoverableError)),i=GE(t,1,!1,null,null,c,!1,f,_),t[Oc]=i.current,by(t.nodeType===8?t.parentNode:t),new HE(i)};na.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var i=t._reactInternals;if(i===void 0)throw typeof t.render=="function"?Error(Zt(188)):(t=Object.keys(t).join(","),Error(Zt(268,t)));return t=pz(i),t=t===null?null:t.stateNode,t};na.flushSync=function(t){return Od(t)};na.hydrate=function(t,i,c){if(!Y1(i))throw Error(Zt(200));return J1(null,t,i,!0,c)};na.hydrateRoot=function(t,i,c){if(!WE(t))throw Error(Zt(405));var f=c!=null&&c.hydratedSources||null,_=!1,w="",E=WO;if(c!=null&&(c.unstable_strictMode===!0&&(_=!0),c.identifierPrefix!==void 0&&(w=c.identifierPrefix),c.onRecoverableError!==void 0&&(E=c.onRecoverableError)),i=HO(i,null,t,1,c??null,_,!1,w,E),t[Oc]=i.current,by(t),f)for(t=0;t<f.length;t++)c=f[t],_=c._getVersion,_=_(c._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[c,_]:i.mutableSourceEagerHydrationData.push(c,_);return new K1(i)};na.render=function(t,i,c){if(!Y1(i))throw Error(Zt(200));return J1(null,t,i,!1,c)};na.unmountComponentAtNode=function(t){if(!Y1(t))throw Error(Zt(40));return t._reactRootContainer?(Od(function(){J1(null,null,t,!1,function(){t._reactRootContainer=null,t[Oc]=null})}),!0):!1};na.unstable_batchedUpdates=BE;na.unstable_renderSubtreeIntoContainer=function(t,i,c,f){if(!Y1(c))throw Error(Zt(200));if(t==null||t._reactInternals===void 0)throw Error(Zt(38));return J1(t,i,c,!1,f)};na.version="18.3.1-next-f1338f8080-20240426";function qO(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(qO)}catch(t){console.error(t)}}qO(),qL.exports=na;var Q1=qL.exports;const m8=O1(Q1);var ak=Q1;xS.createRoot=ak.createRoot,xS.hydrateRoot=ak.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ry(){return Ry=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var c=arguments[i];for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(t[f]=c[f])}return t},Ry.apply(this,arguments)}var Ku;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Ku||(Ku={}));const lk="popstate";function g8(t){t===void 0&&(t={});function i(f,_){let{pathname:w,search:E,hash:o}=f.location;return f2("",{pathname:w,search:E,hash:o},_.state&&_.state.usr||null,_.state&&_.state.key||"default")}function c(f,_){return typeof _=="string"?_:x1(_)}return y8(i,c,null,t)}function Jr(t,i){if(t===!1||t===null||typeof t>"u")throw new Error(i)}function ZO(t,i){if(!t){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function _8(){return Math.random().toString(36).substr(2,8)}function ck(t,i){return{usr:t.state,key:t.key,idx:i}}function f2(t,i,c,f){return c===void 0&&(c=null),Ry({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof i=="string"?Em(i):i,{state:c,key:i&&i.key||f||_8()})}function x1(t){let{pathname:i="/",search:c="",hash:f=""}=t;return c&&c!=="?"&&(i+=c.charAt(0)==="?"?c:"?"+c),f&&f!=="#"&&(i+=f.charAt(0)==="#"?f:"#"+f),i}function Em(t){let i={};if(t){let c=t.indexOf("#");c>=0&&(i.hash=t.substr(c),t=t.substr(0,c));let f=t.indexOf("?");f>=0&&(i.search=t.substr(f),t=t.substr(0,f)),t&&(i.pathname=t)}return i}function y8(t,i,c,f){f===void 0&&(f={});let{window:_=document.defaultView,v5Compat:w=!1}=f,E=_.history,o=Ku.Pop,k=null,L=N();L==null&&(L=0,E.replaceState(Ry({},E.state,{idx:L}),""));function N(){return(E.state||{idx:null}).idx}function V(){o=Ku.Pop;let se=N(),Y=se==null?null:se-L;L=se,k&&k({action:o,location:K.location,delta:Y})}function H(se,Y){o=Ku.Push;let Q=f2(K.location,se,Y);L=N()+1;let ae=ck(Q,L),Te=K.createHref(Q);try{E.pushState(ae,"",Te)}catch(Be){if(Be instanceof DOMException&&Be.name==="DataCloneError")throw Be;_.location.assign(Te)}w&&k&&k({action:o,location:K.location,delta:1})}function ne(se,Y){o=Ku.Replace;let Q=f2(K.location,se,Y);L=N();let ae=ck(Q,L),Te=K.createHref(Q);E.replaceState(ae,"",Te),w&&k&&k({action:o,location:K.location,delta:0})}function ce(se){let Y=_.location.origin!=="null"?_.location.origin:_.location.href,Q=typeof se=="string"?se:x1(se);return Q=Q.replace(/ $/,"%20"),Jr(Y,"No window.location.(origin|href) available to create URL for href: "+Q),new URL(Q,Y)}let K={get action(){return o},get location(){return t(_,E)},listen(se){if(k)throw new Error("A history only accepts one active listener");return _.addEventListener(lk,V),k=se,()=>{_.removeEventListener(lk,V),k=null}},createHref(se){return i(_,se)},createURL:ce,encodeLocation(se){let Y=ce(se);return{pathname:Y.pathname,search:Y.search,hash:Y.hash}},push:H,replace:ne,go(se){return E.go(se)}};return K}var uk;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(uk||(uk={}));function v8(t,i,c){return c===void 0&&(c="/"),x8(t,i,c)}function x8(t,i,c,f){let _=typeof i=="string"?Em(i):i,w=qE(_.pathname||"/",c);if(w==null)return null;let E=XO(t);w8(E);let o=null;for(let k=0;o==null&&k<E.length;++k){let L=D8(w);o=M8(E[k],L)}return o}function XO(t,i,c,f){i===void 0&&(i=[]),c===void 0&&(c=[]),f===void 0&&(f="");let _=(w,E,o)=>{let k={relativePath:o===void 0?w.path||"":o,caseSensitive:w.caseSensitive===!0,childrenIndex:E,route:w};k.relativePath.startsWith("/")&&(Jr(k.relativePath.startsWith(f),'Absolute route path "'+k.relativePath+'" nested under path '+('"'+f+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),k.relativePath=k.relativePath.slice(f.length));let L=sh([f,k.relativePath]),N=c.concat(k);w.children&&w.children.length>0&&(Jr(w.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+L+'".')),XO(w.children,i,N,L)),!(w.path==null&&!w.index)&&i.push({path:L,score:C8(L,w.index),routesMeta:N})};return t.forEach((w,E)=>{var o;if(w.path===""||!((o=w.path)!=null&&o.includes("?")))_(w,E);else for(let k of KO(w.path))_(w,E,k)}),i}function KO(t){let i=t.split("/");if(i.length===0)return[];let[c,...f]=i,_=c.endsWith("?"),w=c.replace(/\?$/,"");if(f.length===0)return _?[w,""]:[w];let E=KO(f.join("/")),o=[];return o.push(...E.map(k=>k===""?w:[w,k].join("/"))),_&&o.push(...E),o.map(k=>t.startsWith("/")&&k===""?"/":k)}function w8(t){t.sort((i,c)=>i.score!==c.score?c.score-i.score:P8(i.routesMeta.map(f=>f.childrenIndex),c.routesMeta.map(f=>f.childrenIndex)))}const b8=/^:[\w-]+$/,T8=3,S8=2,E8=1,I8=10,A8=-2,hk=t=>t==="*";function C8(t,i){let c=t.split("/"),f=c.length;return c.some(hk)&&(f+=A8),i&&(f+=S8),c.filter(_=>!hk(_)).reduce((_,w)=>_+(b8.test(w)?T8:w===""?E8:I8),f)}function P8(t,i){return t.length===i.length&&t.slice(0,-1).every((f,_)=>f===i[_])?t[t.length-1]-i[i.length-1]:0}function M8(t,i,c){let{routesMeta:f}=t,_={},w="/",E=[];for(let o=0;o<f.length;++o){let k=f[o],L=o===f.length-1,N=w==="/"?i:i.slice(w.length)||"/",V=R8({path:k.relativePath,caseSensitive:k.caseSensitive,end:L},N),H=k.route;if(!V)return null;Object.assign(_,V.params),E.push({params:_,pathname:sh([w,V.pathname]),pathnameBase:F8(sh([w,V.pathnameBase])),route:H}),V.pathnameBase!=="/"&&(w=sh([w,V.pathnameBase]))}return E}function R8(t,i){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[c,f]=k8(t.path,t.caseSensitive,t.end),_=i.match(c);if(!_)return null;let w=_[0],E=w.replace(/(.)\/+$/,"$1"),o=_.slice(1);return{params:f.reduce((L,N,V)=>{let{paramName:H,isOptional:ne}=N;if(H==="*"){let K=o[V]||"";E=w.slice(0,w.length-K.length).replace(/(.)\/+$/,"$1")}const ce=o[V];return ne&&!ce?L[H]=void 0:L[H]=(ce||"").replace(/%2F/g,"/"),L},{}),pathname:w,pathnameBase:E,pattern:t}}function k8(t,i,c){i===void 0&&(i=!1),c===void 0&&(c=!0),ZO(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let f=[],_="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(E,o,k)=>(f.push({paramName:o,isOptional:k!=null}),k?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(f.push({paramName:"*"}),_+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):c?_+="\\/*$":t!==""&&t!=="/"&&(_+="(?:(?=\\/|$))"),[new RegExp(_,i?void 0:"i"),f]}function D8(t){try{return t.split("/").map(i=>decodeURIComponent(i).replace(/\//g,"%2F")).join("/")}catch(i){return ZO(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+i+").")),t}}function qE(t,i){if(i==="/")return t;if(!t.toLowerCase().startsWith(i.toLowerCase()))return null;let c=i.endsWith("/")?i.length-1:i.length,f=t.charAt(c);return f&&f!=="/"?null:t.slice(c)||"/"}function L8(t,i){i===void 0&&(i="/");let{pathname:c,search:f="",hash:_=""}=typeof t=="string"?Em(t):t;return{pathname:c?c.startsWith("/")?c:z8(c,i):i,search:N8(f),hash:B8(_)}}function z8(t,i){let c=i.replace(/\/+$/,"").split("/");return t.split("/").forEach(_=>{_===".."?c.length>1&&c.pop():_!=="."&&c.push(_)}),c.length>1?c.join("/"):"/"}function UT(t,i,c,f){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+i+"` field ["+JSON.stringify(f)+"].  Please separate it out to the ")+("`to."+c+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function O8(t){return t.filter((i,c)=>c===0||i.route.path&&i.route.path.length>0)}function ZE(t,i){let c=O8(t);return i?c.map((f,_)=>_===c.length-1?f.pathname:f.pathnameBase):c.map(f=>f.pathnameBase)}function XE(t,i,c,f){f===void 0&&(f=!1);let _;typeof t=="string"?_=Em(t):(_=Ry({},t),Jr(!_.pathname||!_.pathname.includes("?"),UT("?","pathname","search",_)),Jr(!_.pathname||!_.pathname.includes("#"),UT("#","pathname","hash",_)),Jr(!_.search||!_.search.includes("#"),UT("#","search","hash",_)));let w=t===""||_.pathname==="",E=w?"/":_.pathname,o;if(E==null)o=c;else{let V=i.length-1;if(!f&&E.startsWith("..")){let H=E.split("/");for(;H[0]==="..";)H.shift(),V-=1;_.pathname=H.join("/")}o=V>=0?i[V]:"/"}let k=L8(_,o),L=E&&E!=="/"&&E.endsWith("/"),N=(w||E===".")&&c.endsWith("/");return!k.pathname.endsWith("/")&&(L||N)&&(k.pathname+="/"),k}const sh=t=>t.join("/").replace(/\/\/+/g,"/"),F8=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),N8=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,B8=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function j8(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const YO=["post","put","patch","delete"];new Set(YO);const V8=["get",...YO];new Set(V8);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ky(){return ky=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var c=arguments[i];for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(t[f]=c[f])}return t},ky.apply(this,arguments)}const KE=fe.createContext(null),U8=fe.createContext(null),ph=fe.createContext(null),ew=fe.createContext(null),mh=fe.createContext({outlet:null,matches:[],isDataRoute:!1}),JO=fe.createContext(null);function G8(t,i){let{relative:c}=i===void 0?{}:i;Im()||Jr(!1);let{basename:f,navigator:_}=fe.useContext(ph),{hash:w,pathname:E,search:o}=e3(t,{relative:c}),k=E;return f!=="/"&&(k=E==="/"?f:sh([f,E])),_.createHref({pathname:k,search:o,hash:w})}function Im(){return fe.useContext(ew)!=null}function Am(){return Im()||Jr(!1),fe.useContext(ew).location}function QO(t){fe.useContext(ph).static||fe.useLayoutEffect(t)}function Gd(){let{isDataRoute:t}=fe.useContext(mh);return t?nG():$8()}function $8(){Im()||Jr(!1);let t=fe.useContext(KE),{basename:i,future:c,navigator:f}=fe.useContext(ph),{matches:_}=fe.useContext(mh),{pathname:w}=Am(),E=JSON.stringify(ZE(_,c.v7_relativeSplatPath)),o=fe.useRef(!1);return QO(()=>{o.current=!0}),fe.useCallback(function(L,N){if(N===void 0&&(N={}),!o.current)return;if(typeof L=="number"){f.go(L);return}let V=XE(L,JSON.parse(E),w,N.relative==="path");t==null&&i!=="/"&&(V.pathname=V.pathname==="/"?i:sh([i,V.pathname])),(N.replace?f.replace:f.push)(V,N.state,N)},[i,f,E,w,t])}function e3(t,i){let{relative:c}=i===void 0?{}:i,{future:f}=fe.useContext(ph),{matches:_}=fe.useContext(mh),{pathname:w}=Am(),E=JSON.stringify(ZE(_,f.v7_relativeSplatPath));return fe.useMemo(()=>XE(t,JSON.parse(E),w,c==="path"),[t,E,w,c])}function H8(t,i){return W8(t,i)}function W8(t,i,c,f){Im()||Jr(!1);let{navigator:_}=fe.useContext(ph),{matches:w}=fe.useContext(mh),E=w[w.length-1],o=E?E.params:{};E&&E.pathname;let k=E?E.pathnameBase:"/";E&&E.route;let L=Am(),N;if(i){var V;let se=typeof i=="string"?Em(i):i;k==="/"||(V=se.pathname)!=null&&V.startsWith(k)||Jr(!1),N=se}else N=L;let H=N.pathname||"/",ne=H;if(k!=="/"){let se=k.replace(/^\//,"").split("/");ne="/"+H.replace(/^\//,"").split("/").slice(se.length).join("/")}let ce=v8(t,{pathname:ne}),K=Y8(ce&&ce.map(se=>Object.assign({},se,{params:Object.assign({},o,se.params),pathname:sh([k,_.encodeLocation?_.encodeLocation(se.pathname).pathname:se.pathname]),pathnameBase:se.pathnameBase==="/"?k:sh([k,_.encodeLocation?_.encodeLocation(se.pathnameBase).pathname:se.pathnameBase])})),w,c,f);return i&&K?fe.createElement(ew.Provider,{value:{location:ky({pathname:"/",search:"",hash:"",state:null,key:"default"},N),navigationType:Ku.Pop}},K):K}function q8(){let t=tG(),i=j8(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),c=t instanceof Error?t.stack:null,_={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return fe.createElement(fe.Fragment,null,fe.createElement("h2",null,"Unexpected Application Error!"),fe.createElement("h3",{style:{fontStyle:"italic"}},i),c?fe.createElement("pre",{style:_},c):null,null)}const Z8=fe.createElement(q8,null);class X8 extends fe.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,c){return c.location!==i.location||c.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:c.error,location:c.location,revalidation:i.revalidation||c.revalidation}}componentDidCatch(i,c){console.error("React Router caught the following error during render",i,c)}render(){return this.state.error!==void 0?fe.createElement(mh.Provider,{value:this.props.routeContext},fe.createElement(JO.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function K8(t){let{routeContext:i,match:c,children:f}=t,_=fe.useContext(KE);return _&&_.static&&_.staticContext&&(c.route.errorElement||c.route.ErrorBoundary)&&(_.staticContext._deepestRenderedBoundaryId=c.route.id),fe.createElement(mh.Provider,{value:i},f)}function Y8(t,i,c,f){var _;if(i===void 0&&(i=[]),c===void 0&&(c=null),f===void 0&&(f=null),t==null){var w;if(!c)return null;if(c.errors)t=c.matches;else if((w=f)!=null&&w.v7_partialHydration&&i.length===0&&!c.initialized&&c.matches.length>0)t=c.matches;else return null}let E=t,o=(_=c)==null?void 0:_.errors;if(o!=null){let N=E.findIndex(V=>V.route.id&&(o==null?void 0:o[V.route.id])!==void 0);N>=0||Jr(!1),E=E.slice(0,Math.min(E.length,N+1))}let k=!1,L=-1;if(c&&f&&f.v7_partialHydration)for(let N=0;N<E.length;N++){let V=E[N];if((V.route.HydrateFallback||V.route.hydrateFallbackElement)&&(L=N),V.route.id){let{loaderData:H,errors:ne}=c,ce=V.route.loader&&H[V.route.id]===void 0&&(!ne||ne[V.route.id]===void 0);if(V.route.lazy||ce){k=!0,L>=0?E=E.slice(0,L+1):E=[E[0]];break}}}return E.reduceRight((N,V,H)=>{let ne,ce=!1,K=null,se=null;c&&(ne=o&&V.route.id?o[V.route.id]:void 0,K=V.route.errorElement||Z8,k&&(L<0&&H===0?(iG("route-fallback"),ce=!0,se=null):L===H&&(ce=!0,se=V.route.hydrateFallbackElement||null)));let Y=i.concat(E.slice(0,H+1)),Q=()=>{let ae;return ne?ae=K:ce?ae=se:V.route.Component?ae=fe.createElement(V.route.Component,null):V.route.element?ae=V.route.element:ae=N,fe.createElement(K8,{match:V,routeContext:{outlet:N,matches:Y,isDataRoute:c!=null},children:ae})};return c&&(V.route.ErrorBoundary||V.route.errorElement||H===0)?fe.createElement(X8,{location:c.location,revalidation:c.revalidation,component:K,error:ne,children:Q(),routeContext:{outlet:null,matches:Y,isDataRoute:!0}}):Q()},null)}var t3=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(t3||{}),n3=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(n3||{});function J8(t){let i=fe.useContext(KE);return i||Jr(!1),i}function Q8(t){let i=fe.useContext(U8);return i||Jr(!1),i}function eG(t){let i=fe.useContext(mh);return i||Jr(!1),i}function i3(t){let i=eG(),c=i.matches[i.matches.length-1];return c.route.id||Jr(!1),c.route.id}function tG(){var t;let i=fe.useContext(JO),c=Q8(),f=i3();return i!==void 0?i:(t=c.errors)==null?void 0:t[f]}function nG(){let{router:t}=J8(t3.UseNavigateStable),i=i3(n3.UseNavigateStable),c=fe.useRef(!1);return QO(()=>{c.current=!0}),fe.useCallback(function(_,w){w===void 0&&(w={}),c.current&&(typeof _=="number"?t.navigate(_):t.navigate(_,ky({fromRouteId:i},w)))},[t,i])}const dk={};function iG(t,i,c){dk[t]||(dk[t]=!0)}function rG(t,i){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function sG(t){let{to:i,replace:c,state:f,relative:_}=t;Im()||Jr(!1);let{future:w,static:E}=fe.useContext(ph),{matches:o}=fe.useContext(mh),{pathname:k}=Am(),L=Gd(),N=XE(i,ZE(o,w.v7_relativeSplatPath),k,_==="path"),V=JSON.stringify(N);return fe.useEffect(()=>L(JSON.parse(V),{replace:c,state:f,relative:_}),[L,V,_,c,f]),null}function Lu(t){Jr(!1)}function oG(t){let{basename:i="/",children:c=null,location:f,navigationType:_=Ku.Pop,navigator:w,static:E=!1,future:o}=t;Im()&&Jr(!1);let k=i.replace(/^\/*/,"/"),L=fe.useMemo(()=>({basename:k,navigator:w,static:E,future:ky({v7_relativeSplatPath:!1},o)}),[k,o,w,E]);typeof f=="string"&&(f=Em(f));let{pathname:N="/",search:V="",hash:H="",state:ne=null,key:ce="default"}=f,K=fe.useMemo(()=>{let se=qE(N,k);return se==null?null:{location:{pathname:se,search:V,hash:H,state:ne,key:ce},navigationType:_}},[k,N,V,H,ne,ce,_]);return K==null?null:fe.createElement(ph.Provider,{value:L},fe.createElement(ew.Provider,{children:c,value:K}))}function aG(t){let{children:i,location:c}=t;return H8(p2(i),c)}new Promise(()=>{});function p2(t,i){i===void 0&&(i=[]);let c=[];return fe.Children.forEach(t,(f,_)=>{if(!fe.isValidElement(f))return;let w=[...i,_];if(f.type===fe.Fragment){c.push.apply(c,p2(f.props.children,w));return}f.type!==Lu&&Jr(!1),!f.props.index||!f.props.children||Jr(!1);let E={id:f.props.id||w.join("-"),caseSensitive:f.props.caseSensitive,element:f.props.element,Component:f.props.Component,index:f.props.index,path:f.props.path,loader:f.props.loader,action:f.props.action,errorElement:f.props.errorElement,ErrorBoundary:f.props.ErrorBoundary,hasErrorBoundary:f.props.ErrorBoundary!=null||f.props.errorElement!=null,shouldRevalidate:f.props.shouldRevalidate,handle:f.props.handle,lazy:f.props.lazy};f.props.children&&(E.children=p2(f.props.children,w)),c.push(E)}),c}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function m2(){return m2=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var c=arguments[i];for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(t[f]=c[f])}return t},m2.apply(this,arguments)}function lG(t,i){if(t==null)return{};var c={},f=Object.keys(t),_,w;for(w=0;w<f.length;w++)_=f[w],!(i.indexOf(_)>=0)&&(c[_]=t[_]);return c}function cG(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function uG(t,i){return t.button===0&&(!i||i==="_self")&&!cG(t)}const hG=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],dG="6";try{window.__reactRouterVersion=dG}catch{}const fG="startTransition",fk=nE[fG];function pG(t){let{basename:i,children:c,future:f,window:_}=t,w=fe.useRef();w.current==null&&(w.current=g8({window:_,v5Compat:!0}));let E=w.current,[o,k]=fe.useState({action:E.action,location:E.location}),{v7_startTransition:L}=f||{},N=fe.useCallback(V=>{L&&fk?fk(()=>k(V)):k(V)},[k,L]);return fe.useLayoutEffect(()=>E.listen(N),[E,N]),fe.useEffect(()=>rG(f),[f]),fe.createElement(oG,{basename:i,children:c,location:o.location,navigationType:o.action,navigator:E,future:f})}const mG=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",gG=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,_G=fe.forwardRef(function(i,c){let{onClick:f,relative:_,reloadDocument:w,replace:E,state:o,target:k,to:L,preventScrollReset:N,viewTransition:V}=i,H=lG(i,hG),{basename:ne}=fe.useContext(ph),ce,K=!1;if(typeof L=="string"&&gG.test(L)&&(ce=L,mG))try{let ae=new URL(window.location.href),Te=L.startsWith("//")?new URL(ae.protocol+L):new URL(L),Be=qE(Te.pathname,ne);Te.origin===ae.origin&&Be!=null?L=Be+Te.search+Te.hash:K=!0}catch{}let se=G8(L,{relative:_}),Y=yG(L,{replace:E,state:o,target:k,preventScrollReset:N,relative:_,viewTransition:V});function Q(ae){f&&f(ae),ae.defaultPrevented||Y(ae)}return fe.createElement("a",m2({},H,{href:ce||se,onClick:K||w?f:Q,ref:c,target:k}))});var pk;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(pk||(pk={}));var mk;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(mk||(mk={}));function yG(t,i){let{target:c,replace:f,state:_,preventScrollReset:w,relative:E,viewTransition:o}=i===void 0?{}:i,k=Gd(),L=Am(),N=e3(t,{relative:E});return fe.useCallback(V=>{if(uG(V,c)){V.preventDefault();let H=f!==void 0?f:x1(L)===x1(N);k(t,{replace:H,state:_,preventScrollReset:w,relative:E,viewTransition:o})}},[L,k,N,f,_,c,t,w,E,o])}var g2=function(t,i){return g2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,f){c.__proto__=f}||function(c,f){for(var _ in f)Object.prototype.hasOwnProperty.call(f,_)&&(c[_]=f[_])},g2(t,i)};function vG(t,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");g2(t,i);function c(){this.constructor=t}t.prototype=i===null?Object.create(i):(c.prototype=i.prototype,new c)}var Es=function(){return Es=Object.assign||function(i){for(var c,f=1,_=arguments.length;f<_;f++){c=arguments[f];for(var w in c)Object.prototype.hasOwnProperty.call(c,w)&&(i[w]=c[w])}return i},Es.apply(this,arguments)};function xG(t,i){var c={};for(var f in t)Object.prototype.hasOwnProperty.call(t,f)&&i.indexOf(f)<0&&(c[f]=t[f]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _=0,f=Object.getOwnPropertySymbols(t);_<f.length;_++)i.indexOf(f[_])<0&&Object.prototype.propertyIsEnumerable.call(t,f[_])&&(c[f[_]]=t[f[_]]);return c}function bp(t,i,c,f){function _(w){return w instanceof c?w:new c(function(E){E(w)})}return new(c||(c=Promise))(function(w,E){function o(N){try{L(f.next(N))}catch(V){E(V)}}function k(N){try{L(f.throw(N))}catch(V){E(V)}}function L(N){N.done?w(N.value):_(N.value).then(o,k)}L((f=f.apply(t,i||[])).next())})}function Tp(t,i){var c={label:0,sent:function(){if(w[0]&1)throw w[1];return w[1]},trys:[],ops:[]},f,_,w,E=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return E.next=o(0),E.throw=o(1),E.return=o(2),typeof Symbol=="function"&&(E[Symbol.iterator]=function(){return this}),E;function o(L){return function(N){return k([L,N])}}function k(L){if(f)throw new TypeError("Generator is already executing.");for(;E&&(E=0,L[0]&&(c=0)),c;)try{if(f=1,_&&(w=L[0]&2?_.return:L[0]?_.throw||((w=_.return)&&w.call(_),0):_.next)&&!(w=w.call(_,L[1])).done)return w;switch(_=0,w&&(L=[L[0]&2,w.value]),L[0]){case 0:case 1:w=L;break;case 4:return c.label++,{value:L[1],done:!1};case 5:c.label++,_=L[1],L=[0];continue;case 7:L=c.ops.pop(),c.trys.pop();continue;default:if(w=c.trys,!(w=w.length>0&&w[w.length-1])&&(L[0]===6||L[0]===2)){c=0;continue}if(L[0]===3&&(!w||L[1]>w[0]&&L[1]<w[3])){c.label=L[1];break}if(L[0]===6&&c.label<w[1]){c.label=w[1],w=L;break}if(w&&c.label<w[2]){c.label=w[2],c.ops.push(L);break}w[2]&&c.ops.pop(),c.trys.pop();continue}L=i.call(t,c)}catch(N){L=[6,N],_=0}finally{f=w=0}if(L[0]&5)throw L[1];return{value:L[0]?L[1]:void 0,done:!0}}}function wG(t,i,c){for(var f=0,_=i.length,w;f<_;f++)(w||!(f in i))&&(w||(w=Array.prototype.slice.call(i,0,f)),w[f]=i[f]);return t.concat(w||Array.prototype.slice.call(i))}function Fl(t,i){var c={};for(var f in t)Object.prototype.hasOwnProperty.call(t,f)&&i.indexOf(f)<0&&(c[f]=t[f]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function"){var _=0;for(f=Object.getOwnPropertySymbols(t);_<f.length;_++)i.indexOf(f[_])<0&&Object.prototype.propertyIsEnumerable.call(t,f[_])&&(c[f[_]]=t[f[_]])}return c}var gd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function YE(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function JE(t,i){return t(i={exports:{}},i.exports),i.exports}var fd=JE(function(t,i){Object.defineProperty(i,"__esModule",{value:!0});var c=function(){function f(){var _=this;this.locked=new Map,this.addToLocked=function(w,E){var o=_.locked.get(w);o===void 0?E===void 0?_.locked.set(w,[]):_.locked.set(w,[E]):E!==void 0&&(o.unshift(E),_.locked.set(w,o))},this.isLocked=function(w){return _.locked.has(w)},this.lock=function(w){return new Promise(function(E,o){_.isLocked(w)?_.addToLocked(w,E):(_.addToLocked(w),E())})},this.unlock=function(w){var E=_.locked.get(w);if(E!==void 0&&E.length!==0){var o=E.pop();_.locked.set(w,E),o!==void 0&&setTimeout(o,0)}else _.locked.delete(w)}}return f.getInstance=function(){return f.instance===void 0&&(f.instance=new f),f.instance},f}();i.default=function(){return c.getInstance()}});YE(fd);var bG=YE(JE(function(t,i){var c=gd&&gd.__awaiter||function(N,V,H,ne){return new(H||(H=Promise))(function(ce,K){function se(ae){try{Q(ne.next(ae))}catch(Te){K(Te)}}function Y(ae){try{Q(ne.throw(ae))}catch(Te){K(Te)}}function Q(ae){ae.done?ce(ae.value):new H(function(Te){Te(ae.value)}).then(se,Y)}Q((ne=ne.apply(N,V||[])).next())})},f=gd&&gd.__generator||function(N,V){var H,ne,ce,K,se={label:0,sent:function(){if(1&ce[0])throw ce[1];return ce[1]},trys:[],ops:[]};return K={next:Y(0),throw:Y(1),return:Y(2)},typeof Symbol=="function"&&(K[Symbol.iterator]=function(){return this}),K;function Y(Q){return function(ae){return function(Te){if(H)throw new TypeError("Generator is already executing.");for(;se;)try{if(H=1,ne&&(ce=2&Te[0]?ne.return:Te[0]?ne.throw||((ce=ne.return)&&ce.call(ne),0):ne.next)&&!(ce=ce.call(ne,Te[1])).done)return ce;switch(ne=0,ce&&(Te=[2&Te[0],ce.value]),Te[0]){case 0:case 1:ce=Te;break;case 4:return se.label++,{value:Te[1],done:!1};case 5:se.label++,ne=Te[1],Te=[0];continue;case 7:Te=se.ops.pop(),se.trys.pop();continue;default:if(ce=se.trys,!((ce=ce.length>0&&ce[ce.length-1])||Te[0]!==6&&Te[0]!==2)){se=0;continue}if(Te[0]===3&&(!ce||Te[1]>ce[0]&&Te[1]<ce[3])){se.label=Te[1];break}if(Te[0]===6&&se.label<ce[1]){se.label=ce[1],ce=Te;break}if(ce&&se.label<ce[2]){se.label=ce[2],se.ops.push(Te);break}ce[2]&&se.ops.pop(),se.trys.pop();continue}Te=V.call(N,se)}catch(Be){Te=[6,Be],ne=0}finally{H=ce=0}if(5&Te[0])throw Te[1];return{value:Te[0]?Te[1]:void 0,done:!0}}([Q,ae])}}},_=gd;Object.defineProperty(i,"__esModule",{value:!0});var w="browser-tabs-lock-key",E={key:function(N){return c(_,void 0,void 0,function(){return f(this,function(V){throw new Error("Unsupported")})})},getItem:function(N){return c(_,void 0,void 0,function(){return f(this,function(V){throw new Error("Unsupported")})})},clear:function(){return c(_,void 0,void 0,function(){return f(this,function(N){return[2,window.localStorage.clear()]})})},removeItem:function(N){return c(_,void 0,void 0,function(){return f(this,function(V){throw new Error("Unsupported")})})},setItem:function(N,V){return c(_,void 0,void 0,function(){return f(this,function(H){throw new Error("Unsupported")})})},keySync:function(N){return window.localStorage.key(N)},getItemSync:function(N){return window.localStorage.getItem(N)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(N){return window.localStorage.removeItem(N)},setItemSync:function(N,V){return window.localStorage.setItem(N,V)}};function o(N){return new Promise(function(V){return setTimeout(V,N)})}function k(N){for(var V="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",H="",ne=0;ne<N;ne++)H+=V[Math.floor(Math.random()*V.length)];return H}var L=function(){function N(V){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+k(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=V,N.waiters===void 0&&(N.waiters=[])}return N.prototype.acquireLock=function(V,H){return H===void 0&&(H=5e3),c(this,void 0,void 0,function(){var ne,ce,K,se,Y,Q,ae;return f(this,function(Te){switch(Te.label){case 0:ne=Date.now()+k(4),ce=Date.now()+H,K=w+"-"+V,se=this.storageHandler===void 0?E:this.storageHandler,Te.label=1;case 1:return Date.now()<ce?[4,o(30)]:[3,8];case 2:return Te.sent(),se.getItemSync(K)!==null?[3,5]:(Y=this.id+"-"+V+"-"+ne,[4,o(Math.floor(25*Math.random()))]);case 3:return Te.sent(),se.setItemSync(K,JSON.stringify({id:this.id,iat:ne,timeoutKey:Y,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,o(30)];case 4:return Te.sent(),(Q=se.getItemSync(K))!==null&&(ae=JSON.parse(Q)).id===this.id&&ae.iat===ne?(this.acquiredIatSet.add(ne),this.refreshLockWhileAcquired(K,ne),[2,!0]):[3,7];case 5:return N.lockCorrector(this.storageHandler===void 0?E:this.storageHandler),[4,this.waitForSomethingToChange(ce)];case 6:Te.sent(),Te.label=7;case 7:return ne=Date.now()+k(4),[3,1];case 8:return[2,!1]}})})},N.prototype.refreshLockWhileAcquired=function(V,H){return c(this,void 0,void 0,function(){var ne=this;return f(this,function(ce){return setTimeout(function(){return c(ne,void 0,void 0,function(){var K,se,Y;return f(this,function(Q){switch(Q.label){case 0:return[4,fd.default().lock(H)];case 1:return Q.sent(),this.acquiredIatSet.has(H)?(K=this.storageHandler===void 0?E:this.storageHandler,(se=K.getItemSync(V))===null?(fd.default().unlock(H),[2]):((Y=JSON.parse(se)).timeRefreshed=Date.now(),K.setItemSync(V,JSON.stringify(Y)),fd.default().unlock(H),this.refreshLockWhileAcquired(V,H),[2])):(fd.default().unlock(H),[2])}})})},1e3),[2]})})},N.prototype.waitForSomethingToChange=function(V){return c(this,void 0,void 0,function(){return f(this,function(H){switch(H.label){case 0:return[4,new Promise(function(ne){var ce=!1,K=Date.now(),se=!1;function Y(){if(se||(window.removeEventListener("storage",Y),N.removeFromWaiting(Y),clearTimeout(Q),se=!0),!ce){ce=!0;var ae=50-(Date.now()-K);ae>0?setTimeout(ne,ae):ne(null)}}window.addEventListener("storage",Y),N.addToWaiting(Y);var Q=setTimeout(Y,Math.max(0,V-Date.now()))})];case 1:return H.sent(),[2]}})})},N.addToWaiting=function(V){this.removeFromWaiting(V),N.waiters!==void 0&&N.waiters.push(V)},N.removeFromWaiting=function(V){N.waiters!==void 0&&(N.waiters=N.waiters.filter(function(H){return H!==V}))},N.notifyWaiters=function(){N.waiters!==void 0&&N.waiters.slice().forEach(function(V){return V()})},N.prototype.releaseLock=function(V){return c(this,void 0,void 0,function(){return f(this,function(H){switch(H.label){case 0:return[4,this.releaseLock__private__(V)];case 1:return[2,H.sent()]}})})},N.prototype.releaseLock__private__=function(V){return c(this,void 0,void 0,function(){var H,ne,ce,K;return f(this,function(se){switch(se.label){case 0:return H=this.storageHandler===void 0?E:this.storageHandler,ne=w+"-"+V,(ce=H.getItemSync(ne))===null?[2]:(K=JSON.parse(ce)).id!==this.id?[3,2]:[4,fd.default().lock(K.iat)];case 1:se.sent(),this.acquiredIatSet.delete(K.iat),H.removeItemSync(ne),fd.default().unlock(K.iat),N.notifyWaiters(),se.label=2;case 2:return[2]}})})},N.lockCorrector=function(V){for(var H=Date.now()-5e3,ne=V,ce=[],K=0;;){var se=ne.keySync(K);if(se===null)break;ce.push(se),K++}for(var Y=!1,Q=0;Q<ce.length;Q++){var ae=ce[Q];if(ae.includes(w)){var Te=ne.getItemSync(ae);if(Te!==null){var Be=JSON.parse(Te);(Be.timeRefreshed===void 0&&Be.timeAcquired<H||Be.timeRefreshed!==void 0&&Be.timeRefreshed<H)&&(ne.removeItemSync(ae),Y=!0)}}}Y&&N.notifyWaiters()},N.waiters=void 0,N}();i.default=L}));const TG={timeoutInSeconds:60},r3={name:"auth0-spa-js",version:"2.4.1"},s3=()=>Date.now();class Ls extends Error{constructor(i,c){super(c),this.error=i,this.error_description=c,Object.setPrototypeOf(this,Ls.prototype)}static fromPayload({error:i,error_description:c}){return new Ls(i,c)}}class QE extends Ls{constructor(i,c,f,_=null){super(i,c),this.state=f,this.appState=_,Object.setPrototypeOf(this,QE.prototype)}}class Dy extends Ls{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,Dy.prototype)}}class eI extends Dy{constructor(i){super(),this.popup=i,Object.setPrototypeOf(this,eI.prototype)}}class tI extends Ls{constructor(i){super("cancelled","Popup closed"),this.popup=i,Object.setPrototypeOf(this,tI.prototype)}}class nI extends Ls{constructor(i,c,f){super(i,c),this.mfa_token=f,Object.setPrototypeOf(this,nI.prototype)}}class tw extends Ls{constructor(i,c){super("missing_refresh_token",`Missing Refresh Token (audience: '${gk(i,["default"])}', scope: '${gk(c)}')`),this.audience=i,this.scope=c,Object.setPrototypeOf(this,tw.prototype)}}class nw extends Ls{constructor(i){super("use_dpop_nonce","Server rejected DPoP proof: wrong nonce"),this.newDpopNonce=i,Object.setPrototypeOf(this,nw.prototype)}}function gk(t,i=[]){return t&&!i.includes(t)?t:""}const U0=()=>window.crypto,GT=()=>{const t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.";let i="";return Array.from(U0().getRandomValues(new Uint8Array(43))).forEach(c=>i+=t[c%t.length]),i},_k=t=>btoa(t),_2=t=>{var{clientId:i}=t,c=Fl(t,["clientId"]);return new URLSearchParams((f=>Object.keys(f).filter(_=>f[_]!==void 0).reduce((_,w)=>Object.assign(Object.assign({},_),{[w]:f[w]}),{}))(Object.assign({client_id:i},c))).toString()},yk=t=>(i=>decodeURIComponent(atob(i).split("").map(c=>"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)).join("")))(t.replace(/_/g,"/").replace(/-/g,"+")),SG=new TextEncoder,EG=new TextDecoder;function ry(t){return typeof t=="string"?SG.encode(t):EG.decode(t)}function vk(t){if(typeof t.modulusLength!="number"||t.modulusLength<2048)throw new AG(`${t.name} modulusLength must be at least 2048 bits`)}async function IG(t,i,c){if(c.usages.includes("sign")===!1)throw new TypeError('private CryptoKey instances used for signing assertions must include "sign" in their "usages"');const f=`${sy(ry(JSON.stringify(t)))}.${sy(ry(JSON.stringify(i)))}`;return`${f}.${sy(await crypto.subtle.sign(function(_){switch(_.algorithm.name){case"ECDSA":return{name:_.algorithm.name,hash:"SHA-256"};case"RSA-PSS":return vk(_.algorithm),{name:_.algorithm.name,saltLength:32};case"RSASSA-PKCS1-v1_5":return vk(_.algorithm),{name:_.algorithm.name};case"Ed25519":return{name:_.algorithm.name}}throw new xd}(c),c,ry(f)))}`}let y2;Uint8Array.prototype.toBase64?y2=t=>(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),t.toBase64({alphabet:"base64url",omitPadding:!0})):y2=i=>{i instanceof ArrayBuffer&&(i=new Uint8Array(i));const c=[];for(let f=0;f<i.byteLength;f+=32768)c.push(String.fromCharCode.apply(null,i.subarray(f,f+32768)));return btoa(c.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")};function sy(t){return y2(t)}class xd extends Error{constructor(i){var c;super(i??"operation not supported"),this.name=this.constructor.name,(c=Error.captureStackTrace)===null||c===void 0||c.call(Error,this,this.constructor)}}class AG extends Error{constructor(i){var c;super(i),this.name=this.constructor.name,(c=Error.captureStackTrace)===null||c===void 0||c.call(Error,this,this.constructor)}}function CG(t){switch(t.algorithm.name){case"RSA-PSS":return function(i){if(i.algorithm.hash.name==="SHA-256")return"PS256";throw new xd("unsupported RsaHashedKeyAlgorithm hash name")}(t);case"RSASSA-PKCS1-v1_5":return function(i){if(i.algorithm.hash.name==="SHA-256")return"RS256";throw new xd("unsupported RsaHashedKeyAlgorithm hash name")}(t);case"ECDSA":return function(i){if(i.algorithm.namedCurve==="P-256")return"ES256";throw new xd("unsupported EcKeyAlgorithm namedCurve")}(t);case"Ed25519":return"Ed25519";default:throw new xd("unsupported CryptoKey algorithm name")}}function o3(t){return t instanceof CryptoKey}function a3(t){return o3(t)&&t.type==="public"}async function PG(t,i,c,f,_,w){const E=t==null?void 0:t.privateKey,o=t==null?void 0:t.publicKey;if(!o3(k=E)||k.type!=="private")throw new TypeError('"keypair.privateKey" must be a private CryptoKey');var k;if(!a3(o))throw new TypeError('"keypair.publicKey" must be a public CryptoKey');if(o.extractable!==!0)throw new TypeError('"keypair.publicKey.extractable" must be true');if(typeof i!="string")throw new TypeError('"htu" must be a string');if(typeof c!="string")throw new TypeError('"htm" must be a string');if(f!==void 0&&typeof f!="string")throw new TypeError('"nonce" must be a string or undefined');if(_!==void 0&&typeof _!="string")throw new TypeError('"accessToken" must be a string or undefined');return IG({alg:CG(E),typ:"dpop+jwt",jwk:await l3(o)},Object.assign(Object.assign({},w),{iat:Math.floor(Date.now()/1e3),jti:crypto.randomUUID(),htm:c,nonce:f,htu:i,ath:_?sy(await crypto.subtle.digest("SHA-256",ry(_))):void 0}),E)}async function l3(t){const{kty:i,e:c,n:f,x:_,y:w,crv:E}=await crypto.subtle.exportKey("jwk",t);return{kty:i,crv:E,e:c,n:f,x:_,y:w}}const MG=["authorization_code","refresh_token","urn:ietf:params:oauth:grant-type:token-exchange"];function RG(){return async function(t,i){var c;let f;if(t.length===0)throw new TypeError('"alg" must be a non-empty string');switch(t){case"PS256":f={name:"RSA-PSS",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"RS256":f={name:"RSASSA-PKCS1-v1_5",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"ES256":f={name:"ECDSA",namedCurve:"P-256"};break;case"Ed25519":f={name:"Ed25519"};break;default:throw new xd}return crypto.subtle.generateKey(f,(c=i==null?void 0:i.extractable)!==null&&c!==void 0&&c,["sign","verify"])}("ES256",{extractable:!1})}function kG(t){return async function(i){if(!a3(i))throw new TypeError('"publicKey" must be a public CryptoKey');if(i.extractable!==!0)throw new TypeError('"publicKey.extractable" must be true');const c=await l3(i);let f;switch(c.kty){case"EC":f={crv:c.crv,kty:c.kty,x:c.x,y:c.y};break;case"OKP":f={crv:c.crv,kty:c.kty,x:c.x};break;case"RSA":f={e:c.e,kty:c.kty,n:c.n};break;default:throw new xd("unsupported JWK kty")}return sy(await crypto.subtle.digest({name:"SHA-256"},ry(JSON.stringify(f))))}(t.publicKey)}function DG({keyPair:t,url:i,method:c,nonce:f,accessToken:_}){const w=function(E){const o=new URL(E);return o.search="",o.hash="",o.href}(i);return PG(t,w,c,f,_)}const LG=async(t,i)=>{const c=await fetch(t,i);return{ok:c.ok,json:await c.json(),headers:(f=c.headers,[...f].reduce((_,[w,E])=>(_[w]=E,_),{}))};var f},zG=async(t,i,c)=>{const f=new AbortController;let _;return i.signal=f.signal,Promise.race([LG(t,i),new Promise((w,E)=>{_=setTimeout(()=>{f.abort(),E(new Error("Timeout when executing 'fetch'"))},c)})]).finally(()=>{clearTimeout(_)})},OG=async(t,i,c,f,_,w,E)=>{return o={auth:{audience:i,scope:c},timeout:_,fetchUrl:t,fetchOptions:f,useFormData:E},k=w,new Promise(function(L,N){const V=new MessageChannel;V.port1.onmessage=function(H){H.data.error?N(new Error(H.data.error)):L(H.data),V.port1.close()},k.postMessage(o,[V.port2])});var o,k},FG=async(t,i,c,f,_,w,E=1e4)=>_?OG(t,i,c,f,E,_,w):zG(t,f,E);async function c3(t,i,c,f,_,w,E,o,k){if(o){const Q=await o.generateProof({url:t,method:_.method||"GET",nonce:await o.getNonce()});_.headers=Object.assign(Object.assign({},_.headers),{dpop:Q})}let L,N=null;for(let Q=0;Q<3;Q++)try{L=await FG(t,c,f,_,w,E,i),N=null;break}catch(ae){N=ae}if(N)throw N;const V=L.json,{error:H,error_description:ne}=V,ce=Fl(V,["error","error_description"]),{headers:K,ok:se}=L;let Y;if(o&&(Y=K["dpop-nonce"],Y&&await o.setNonce(Y)),!se){const Q=ne||`HTTP error. Unable to fetch ${t}`;if(H==="mfa_required")throw new nI(H,Q,ce.mfa_token);if(H==="missing_refresh_token")throw new tw(c,f);if(H==="use_dpop_nonce"){if(!o||!Y||k)throw new nw(Y);return c3(t,i,c,f,_,w,E,o,!0)}throw new Ls(H||"request_error",Q)}return ce}async function NG(t,i){var{baseUrl:c,timeout:f,audience:_,scope:w,auth0Client:E,useFormData:o,dpop:k}=t,L=Fl(t,["baseUrl","timeout","audience","scope","auth0Client","useFormData","dpop"]);const N=L.grant_type==="urn:ietf:params:oauth:grant-type:token-exchange",V=Object.assign(Object.assign(Object.assign({},L),N&&_&&{audience:_}),N&&w&&{scope:w}),H=o?_2(V):JSON.stringify(V),ne=(ce=L.grant_type,MG.includes(ce));var ce;return await c3(`${c}/oauth/token`,f,_||"default",w,{method:"POST",body:H,headers:{"Content-Type":o?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(E||r3))}},i,o,ne?k:void 0)}const O_=(...t)=>{return(i=t.filter(Boolean).join(" ").trim().split(/\s+/),Array.from(new Set(i))).join(" ");var i};class jl{constructor(i,c="@@auth0spajs@@",f){this.prefix=c,this.suffix=f,this.clientId=i.clientId,this.scope=i.scope,this.audience=i.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(i){const[c,f,_,w]=i.split("::");return new jl({clientId:f,scope:w,audience:_},c)}static fromCacheEntry(i){const{scope:c,audience:f,client_id:_}=i;return new jl({scope:c,audience:f,clientId:_})}}class BG{set(i,c){localStorage.setItem(i,JSON.stringify(c))}get(i){const c=window.localStorage.getItem(i);if(c)try{return JSON.parse(c)}catch{return}}remove(i){localStorage.removeItem(i)}allKeys(){return Object.keys(window.localStorage).filter(i=>i.startsWith("@@auth0spajs@@"))}}class u3{constructor(){this.enclosedCache=function(){let i={};return{set(c,f){i[c]=f},get(c){const f=i[c];if(f)return f},remove(c){delete i[c]},allKeys:()=>Object.keys(i)}}()}}class jG{constructor(i,c,f){this.cache=i,this.keyManifest=c,this.nowProvider=f||s3}async setIdToken(i,c,f){var _;const w=this.getIdTokenCacheKey(i);await this.cache.set(w,{id_token:c,decodedToken:f}),await((_=this.keyManifest)===null||_===void 0?void 0:_.add(w))}async getIdToken(i){const c=await this.cache.get(this.getIdTokenCacheKey(i.clientId));if(!c&&i.scope&&i.audience){const f=await this.get(i);return!f||!f.id_token||!f.decodedToken?void 0:{id_token:f.id_token,decodedToken:f.decodedToken}}if(c)return{id_token:c.id_token,decodedToken:c.decodedToken}}async get(i,c=0){var f;let _=await this.cache.get(i.toKey());if(!_){const o=await this.getCacheKeys();if(!o)return;const k=this.matchExistingCacheKey(i,o);k&&(_=await this.cache.get(k))}if(!_)return;const w=await this.nowProvider(),E=Math.floor(w/1e3);return _.expiresAt-c<E?_.body.refresh_token?(_.body={refresh_token:_.body.refresh_token},await this.cache.set(i.toKey(),_),_.body):(await this.cache.remove(i.toKey()),void await((f=this.keyManifest)===null||f===void 0?void 0:f.remove(i.toKey()))):_.body}async set(i){var c;const f=new jl({clientId:i.client_id,scope:i.scope,audience:i.audience}),_=await this.wrapCacheEntry(i);await this.cache.set(f.toKey(),_),await((c=this.keyManifest)===null||c===void 0?void 0:c.add(f.toKey()))}async clear(i){var c;const f=await this.getCacheKeys();f&&(await f.filter(_=>!i||_.includes(i)).reduce(async(_,w)=>{await _,await this.cache.remove(w)},Promise.resolve()),await((c=this.keyManifest)===null||c===void 0?void 0:c.clear()))}async wrapCacheEntry(i){const c=await this.nowProvider();return{body:i,expiresAt:Math.floor(c/1e3)+i.expires_in}}async getCacheKeys(){var i;return this.keyManifest?(i=await this.keyManifest.get())===null||i===void 0?void 0:i.keys:this.cache.allKeys?this.cache.allKeys():void 0}getIdTokenCacheKey(i){return new jl({clientId:i},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(i,c){return c.filter(f=>{var _;const w=jl.fromKey(f),E=new Set(w.scope&&w.scope.split(" ")),o=((_=i.scope)===null||_===void 0?void 0:_.split(" "))||[],k=w.scope&&o.reduce((L,N)=>L&&E.has(N),!0);return w.prefix==="@@auth0spajs@@"&&w.clientId===i.clientId&&w.audience===i.audience&&k})[0]}}class VG{constructor(i,c,f){this.storage=i,this.clientId=c,this.cookieDomain=f,this.storageKey=`a0.spajs.txs.${this.clientId}`}create(i){this.storage.save(this.storageKey,i,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}}const F_=t=>typeof t=="number",UG=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"],GG=t=>{if(!t.id_token)throw new Error("ID token is required but missing");const i=(w=>{const E=w.split("."),[o,k,L]=E;if(E.length!==3||!o||!k||!L)throw new Error("ID token could not be decoded");const N=JSON.parse(yk(k)),V={__raw:w},H={};return Object.keys(N).forEach(ne=>{V[ne]=N[ne],UG.includes(ne)||(H[ne]=N[ne])}),{encoded:{header:o,payload:k,signature:L},header:JSON.parse(yk(o)),claims:V,user:H}})(t.id_token);if(!i.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(i.claims.iss!==t.iss)throw new Error(`Issuer (iss) claim mismatch in the ID token; expected "${t.iss}", found "${i.claims.iss}"`);if(!i.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if(i.header.alg!=="RS256")throw new Error(`Signature algorithm of "${i.header.alg}" is not supported. Expected the ID token to be signed with "RS256".`);if(!i.claims.aud||typeof i.claims.aud!="string"&&!Array.isArray(i.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(i.claims.aud)){if(!i.claims.aud.includes(t.aud))throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${t.aud}" but was not one of "${i.claims.aud.join(", ")}"`);if(i.claims.aud.length>1){if(!i.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(i.claims.azp!==t.aud)throw new Error(`Authorized Party (azp) claim mismatch in the ID token; expected "${t.aud}", found "${i.claims.azp}"`)}}else if(i.claims.aud!==t.aud)throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${t.aud}" but found "${i.claims.aud}"`);if(t.nonce){if(!i.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(i.claims.nonce!==t.nonce)throw new Error(`Nonce (nonce) claim mismatch in the ID token; expected "${t.nonce}", found "${i.claims.nonce}"`)}if(t.max_age&&!F_(i.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(i.claims.exp==null||!F_(i.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!F_(i.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");const c=t.leeway||60,f=new Date(t.now||Date.now()),_=new Date(0);if(_.setUTCSeconds(i.claims.exp+c),f>_)throw new Error(`Expiration Time (exp) claim error in the ID token; current time (${f}) is after expiration time (${_})`);if(i.claims.nbf!=null&&F_(i.claims.nbf)){const w=new Date(0);if(w.setUTCSeconds(i.claims.nbf-c),f<w)throw new Error(`Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (${f}) is before ${w}`)}if(i.claims.auth_time!=null&&F_(i.claims.auth_time)){const w=new Date(0);if(w.setUTCSeconds(parseInt(i.claims.auth_time)+t.max_age+c),f>w)throw new Error(`Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (${f}) is after last auth at ${w}`)}if(t.organization){const w=t.organization.trim();if(w.startsWith("org_")){const E=w;if(!i.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(E!==i.claims.org_id)throw new Error(`Organization ID (org_id) claim mismatch in the ID token; expected "${E}", found "${i.claims.org_id}"`)}else{const E=w.toLowerCase();if(!i.claims.org_name)throw new Error("Organization Name (org_name) claim must be a string present in the ID token");if(E!==i.claims.org_name)throw new Error(`Organization Name (org_name) claim mismatch in the ID token; expected "${E}", found "${i.claims.org_name}"`)}}return i};var wd=JE(function(t,i){var c=gd&&gd.__assign||function(){return c=Object.assign||function(k){for(var L,N=1,V=arguments.length;N<V;N++)for(var H in L=arguments[N])Object.prototype.hasOwnProperty.call(L,H)&&(k[H]=L[H]);return k},c.apply(this,arguments)};function f(k,L){if(!L)return"";var N="; "+k;return L===!0?N:N+"="+L}function _(k,L,N){return encodeURIComponent(k).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(L).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(V){if(typeof V.expires=="number"){var H=new Date;H.setMilliseconds(H.getMilliseconds()+864e5*V.expires),V.expires=H}return f("Expires",V.expires?V.expires.toUTCString():"")+f("Domain",V.domain)+f("Path",V.path)+f("Secure",V.secure)+f("SameSite",V.sameSite)}(N)}function w(k){for(var L={},N=k?k.split("; "):[],V=/(%[\dA-F]{2})+/gi,H=0;H<N.length;H++){var ne=N[H].split("="),ce=ne.slice(1).join("=");ce.charAt(0)==='"'&&(ce=ce.slice(1,-1));try{L[ne[0].replace(V,decodeURIComponent)]=ce.replace(V,decodeURIComponent)}catch{}}return L}function E(){return w(document.cookie)}function o(k,L,N){document.cookie=_(k,L,c({path:"/"},N))}i.__esModule=!0,i.encode=_,i.parse=w,i.getAll=E,i.get=function(k){return E()[k]},i.set=o,i.remove=function(k,L){o(k,"",c(c({},L),{expires:-1}))}});YE(wd),wd.encode,wd.parse,wd.getAll;var $G=wd.get,h3=wd.set,d3=wd.remove;const Cp={get(t){const i=$G(t);if(i!==void 0)return JSON.parse(i)},save(t,i,c){let f={};window.location.protocol==="https:"&&(f={secure:!0,sameSite:"none"}),c!=null&&c.daysUntilExpire&&(f.expires=c.daysUntilExpire),c!=null&&c.cookieDomain&&(f.domain=c.cookieDomain),h3(t,JSON.stringify(i),f)},remove(t,i){let c={};i!=null&&i.cookieDomain&&(c.domain=i.cookieDomain),d3(t,c)}},HG={get(t){return Cp.get(t)||Cp.get(`_legacy_${t}`)},save(t,i,c){let f={};window.location.protocol==="https:"&&(f={secure:!0}),c!=null&&c.daysUntilExpire&&(f.expires=c.daysUntilExpire),c!=null&&c.cookieDomain&&(f.domain=c.cookieDomain),h3(`_legacy_${t}`,JSON.stringify(i),f),Cp.save(t,i,c)},remove(t,i){let c={};i!=null&&i.cookieDomain&&(c.domain=i.cookieDomain),d3(t,c),Cp.remove(t,i),Cp.remove(`_legacy_${t}`,i)}},WG={get(t){if(typeof sessionStorage>"u")return;const i=sessionStorage.getItem(t);return i!=null?JSON.parse(i):void 0},save(t,i){sessionStorage.setItem(t,JSON.stringify(i))},remove(t){sessionStorage.removeItem(t)}};function qG(t,i,c){var f=i===void 0?null:i,_=function(k,L){var N=atob(k);if(L){for(var V=new Uint8Array(N.length),H=0,ne=N.length;H<ne;++H)V[H]=N.charCodeAt(H);return String.fromCharCode.apply(null,new Uint16Array(V.buffer))}return N}(t,c!==void 0&&c),w=_.indexOf(`
`,10)+1,E=_.substring(w)+(f?"//# sourceMappingURL="+f:""),o=new Blob([E],{type:"application/javascript"});return URL.createObjectURL(o)}var xk,wk,bk,$T,ZG=(xk="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHIsdCl7c3VwZXIodCksdGhpcy5lcnJvcj1yLHRoaXMuZXJyb3JfZGVzY3JpcHRpb249dCxPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHtlcnJvcjpyLGVycm9yX2Rlc2NyaXB0aW9uOnR9KXtyZXR1cm4gbmV3IGUocix0KX19Y2xhc3MgciBleHRlbmRzIGV7Y29uc3RydWN0b3IoZSxzKXtzdXBlcigibWlzc2luZ19yZWZyZXNoX3Rva2VuIixgTWlzc2luZyBSZWZyZXNoIFRva2VuIChhdWRpZW5jZTogJyR7dChlLFsiZGVmYXVsdCJdKX0nLCBzY29wZTogJyR7dChzKX0nKWApLHRoaXMuYXVkaWVuY2U9ZSx0aGlzLnNjb3BlPXMsT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsci5wcm90b3R5cGUpfX1mdW5jdGlvbiB0KGUscj1bXSl7cmV0dXJuIGUmJiFyLmluY2x1ZGVzKGUpP2U6IiJ9ImZ1bmN0aW9uIj09dHlwZW9mIFN1cHByZXNzZWRFcnJvciYmU3VwcHJlc3NlZEVycm9yO2NvbnN0IHM9ZT0+e3ZhcntjbGllbnRJZDpyfT1lLHQ9ZnVuY3Rpb24oZSxyKXt2YXIgdD17fTtmb3IodmFyIHMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxzKSYmci5pbmRleE9mKHMpPDAmJih0W3NdPWVbc10pO2lmKG51bGwhPWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbz0wO2ZvcihzPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7bzxzLmxlbmd0aDtvKyspci5pbmRleE9mKHNbb10pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLHNbb10pJiYodFtzW29dXT1lW3Nbb11dKX1yZXR1cm4gdH0oZSxbImNsaWVudElkIl0pO3JldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKChlPT5PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHI9PnZvaWQgMCE9PWVbcl0pKS5yZWR1Y2UoKChyLHQpPT5PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scikse1t0XTplW3RdfSkpLHt9KSkoT2JqZWN0LmFzc2lnbih7Y2xpZW50X2lkOnJ9LHQpKSkudG9TdHJpbmcoKX07bGV0IG89e307Y29uc3Qgbj0oZSxyKT0+YCR7ZX18JHtyfWA7YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKGFzeW5jKHtkYXRhOnt0aW1lb3V0OmUsYXV0aDp0LGZldGNoVXJsOmMsZmV0Y2hPcHRpb25zOmksdXNlRm9ybURhdGE6YX0scG9ydHM6W3BdfSk9PntsZXQgZix1PXt9O2NvbnN0e2F1ZGllbmNlOmQsc2NvcGU6aH09dHx8e307dHJ5e2NvbnN0IHQ9YT8oZT0+e2NvbnN0IHI9bmV3IFVSTFNlYXJjaFBhcmFtcyhlKSx0PXt9O3JldHVybiByLmZvckVhY2goKChlLHIpPT57dFtyXT1lfSkpLHR9KShpLmJvZHkpOkpTT04ucGFyc2UoaS5ib2R5KTtpZighdC5yZWZyZXNoX3Rva2VuJiYicmVmcmVzaF90b2tlbiI9PT10LmdyYW50X3R5cGUpe2NvbnN0IGU9KChlLHIpPT5vW24oZSxyKV0pKGQsaCk7aWYoIWUpdGhyb3cgbmV3IHIoZCxoKTtpLmJvZHk9YT9zKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSx0KSx7cmVmcmVzaF90b2tlbjplfSkpOkpTT04uc3RyaW5naWZ5KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSx0KSx7cmVmcmVzaF90b2tlbjplfSkpfWxldCB5LE87ImZ1bmN0aW9uIj09dHlwZW9mIEFib3J0Q29udHJvbGxlciYmKHk9bmV3IEFib3J0Q29udHJvbGxlcixpLnNpZ25hbD15LnNpZ25hbCk7dHJ5e089YXdhaXQgUHJvbWlzZS5yYWNlKFsoZz1lLG5ldyBQcm9taXNlKChlPT5zZXRUaW1lb3V0KGUsZykpKSksZmV0Y2goYyxPYmplY3QuYXNzaWduKHt9LGkpKV0pfWNhdGNoKGUpe3JldHVybiB2b2lkIHAucG9zdE1lc3NhZ2Uoe2Vycm9yOmUubWVzc2FnZX0pfWlmKCFPKXJldHVybiB5JiZ5LmFib3J0KCksdm9pZCBwLnBvc3RNZXNzYWdlKHtlcnJvcjoiVGltZW91dCB3aGVuIGV4ZWN1dGluZyAnZmV0Y2gnIn0pO2w9Ty5oZWFkZXJzLHU9Wy4uLmxdLnJlZHVjZSgoKGUsW3IsdF0pPT4oZVtyXT10LGUpKSx7fSksZj1hd2FpdCBPLmpzb24oKSxmLnJlZnJlc2hfdG9rZW4/KCgoZSxyLHQpPT57b1tuKHIsdCldPWV9KShmLnJlZnJlc2hfdG9rZW4sZCxoKSxkZWxldGUgZi5yZWZyZXNoX3Rva2VuKTooKGUscik9PntkZWxldGUgb1tuKGUscildfSkoZCxoKSxwLnBvc3RNZXNzYWdlKHtvazpPLm9rLGpzb246ZixoZWFkZXJzOnV9KX1jYXRjaChlKXtwLnBvc3RNZXNzYWdlKHtvazohMSxqc29uOntlcnJvcjplLmVycm9yLGVycm9yX2Rlc2NyaXB0aW9uOmUubWVzc2FnZX0saGVhZGVyczp1fSl9dmFyIGwsZ30pKX0oKTsKCg==",wk=null,bk=!1,function(t){return $T=$T||qG(xk,wk,bk),new Worker($T,t)});const HT={};class XG{constructor(i,c){this.cache=i,this.clientId=c,this.manifestKey=this.createManifestKeyFrom(this.clientId)}async add(i){var c;const f=new Set(((c=await this.cache.get(this.manifestKey))===null||c===void 0?void 0:c.keys)||[]);f.add(i),await this.cache.set(this.manifestKey,{keys:[...f]})}async remove(i){const c=await this.cache.get(this.manifestKey);if(c){const f=new Set(c.keys);return f.delete(i),f.size>0?await this.cache.set(this.manifestKey,{keys:[...f]}):await this.cache.remove(this.manifestKey)}}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(i){return`@@auth0spajs@@::${i}`}}const KG={memory:()=>new u3().enclosedCache,localstorage:()=>new BG},Tk=t=>KG[t],Sk=t=>{const{openUrl:i,onRedirect:c}=t,f=Fl(t,["openUrl","onRedirect"]);return Object.assign(Object.assign({},f),{openUrl:i===!1||i?i:c})},ld={NONCE:"nonce",KEYPAIR:"keypair"};class YG{constructor(i){this.clientId=i}getVersion(){return 1}createDbHandle(){const i=window.indexedDB.open("auth0-spa-js",this.getVersion());return new Promise((c,f)=>{i.onupgradeneeded=()=>Object.values(ld).forEach(_=>i.result.createObjectStore(_)),i.onerror=()=>f(i.error),i.onsuccess=()=>c(i.result)})}async getDbHandle(){return this.dbHandle||(this.dbHandle=await this.createDbHandle()),this.dbHandle}async executeDbRequest(i,c,f){const _=f((await this.getDbHandle()).transaction(i,c).objectStore(i));return new Promise((w,E)=>{_.onsuccess=()=>w(_.result),_.onerror=()=>E(_.error)})}buildKey(i){const c=i?`_${i}`:"auth0";return`${this.clientId}::${c}`}setNonce(i,c){return this.save(ld.NONCE,this.buildKey(c),i)}setKeyPair(i){return this.save(ld.KEYPAIR,this.buildKey(),i)}async save(i,c,f){await this.executeDbRequest(i,"readwrite",_=>_.put(f,c))}findNonce(i){return this.find(ld.NONCE,this.buildKey(i))}findKeyPair(){return this.find(ld.KEYPAIR,this.buildKey())}find(i,c){return this.executeDbRequest(i,"readonly",f=>f.get(c))}async deleteBy(i,c){const f=await this.executeDbRequest(i,"readonly",_=>_.getAllKeys());f==null||f.filter(c).map(_=>this.executeDbRequest(i,"readwrite",w=>w.delete(_)))}deleteByClientId(i,c){return this.deleteBy(i,f=>typeof f=="string"&&f.startsWith(`${c}::`))}clearNonces(){return this.deleteByClientId(ld.NONCE,this.clientId)}clearKeyPairs(){return this.deleteByClientId(ld.KEYPAIR,this.clientId)}}class JG{constructor(i){this.storage=new YG(i)}getNonce(i){return this.storage.findNonce(i)}setNonce(i,c){return this.storage.setNonce(i,c)}async getOrGenerateKeyPair(){let i=await this.storage.findKeyPair();return i||(i=await RG(),await this.storage.setKeyPair(i)),i}async generateProof(i){const c=await this.getOrGenerateKeyPair();return DG(Object.assign({keyPair:c},i))}async calculateThumbprint(){return kG(await this.getOrGenerateKeyPair())}async clear(){await Promise.all([this.storage.clearNonces(),this.storage.clearKeyPairs()])}}class QG{constructor(i,c){this.hooks=c,this.config=Object.assign(Object.assign({},i),{fetch:i.fetch||(typeof window>"u"?fetch:window.fetch.bind(window))})}isAbsoluteUrl(i){return/^(https?:)?\/\//i.test(i)}buildUrl(i,c){if(c){if(this.isAbsoluteUrl(c))return c;if(i)return`${i.replace(/\/?\/$/,"")}/${c.replace(/^\/+/,"")}`}throw new TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(){return this.config.getAccessToken?this.config.getAccessToken():this.hooks.getAccessToken()}buildBaseRequest(i,c){const f=new Request(i,c);return this.config.baseUrl?new Request(this.buildUrl(this.config.baseUrl,f.url),f):f}async setAuthorizationHeader(i,c){i.headers.set("authorization",`${this.config.dpopNonceId?"DPoP":"Bearer"} ${c}`)}async setDpopProofHeader(i,c){if(!this.config.dpopNonceId)return;const f=await this.hooks.getDpopNonce(),_=await this.hooks.generateDpopProof({accessToken:c,method:i.method,nonce:f,url:i.url});i.headers.set("dpop",_)}async prepareRequest(i){const c=await this.getAccessToken();this.setAuthorizationHeader(i,c),await this.setDpopProofHeader(i,c)}getHeader(i,c){return Array.isArray(i)?new Headers(i).get(c)||"":typeof i.get=="function"?i.get(c)||"":i[c]||""}hasUseDpopNonceError(i){return i.status!==401?!1:this.getHeader(i.headers,"www-authenticate").includes("use_dpop_nonce")}async handleResponse(i,c){const f=this.getHeader(i.headers,"dpop-nonce");if(f&&await this.hooks.setDpopNonce(f),!this.hasUseDpopNonceError(i))return i;if(!f||!c.onUseDpopNonceError)throw new nw(f);return c.onUseDpopNonceError()}async internalFetchWithAuth(i,c,f){const _=this.buildBaseRequest(i,c);await this.prepareRequest(_);const w=await this.config.fetch(_);return this.handleResponse(w,f)}fetchWithAuth(i,c){const f={onUseDpopNonceError:()=>this.internalFetchWithAuth(i,c,Object.assign(Object.assign({},f),{onUseDpopNonceError:void 0}))};return this.internalFetchWithAuth(i,c,f)}}const WT=new bG;class e${constructor(i){let c,f;if(this.userCache=new u3().enclosedCache,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this._releaseLockOnPageHide=async()=>{await WT.releaseLock("auth0.lock.getTokenSilently"),window.removeEventListener("pagehide",this._releaseLockOnPageHide)},this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),i),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),i.authorizationParams)}),typeof window<"u"&&(()=>{if(!U0())throw new Error("For security reasons, `window.crypto` is required to run `auth0-spa-js`.");if(U0().subtle===void 0)throw new Error(`
      auth0-spa-js must run on a secure origin. See https://github.com/auth0/auth0-spa-js/blob/main/FAQ.md#why-do-i-get-auth0-spa-js-must-run-on-a-secure-origin for more information.
    `)})(),i.cache&&i.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),i.cache)f=i.cache;else{if(c=i.cacheLocation||"memory",!Tk(c))throw new Error(`Invalid cache location "${c}"`);f=Tk(c)()}this.httpTimeoutMs=i.httpTimeoutInSeconds?1e3*i.httpTimeoutInSeconds:1e4,this.cookieStorage=i.legacySameSiteCookie===!1?Cp:HG,this.orgHintCookieName=`auth0.${this.options.clientId}.organization_hint`,this.isAuthenticatedCookieName=(E=>`auth0.${E}.is.authenticated`)(this.options.clientId),this.sessionCheckExpiryDays=i.sessionCheckExpiryDays||1;const _=i.useCookiesForTransactions?this.cookieStorage:WG;var w;this.scope=O_("openid",this.options.authorizationParams.scope,this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new VG(_,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||s3,this.cacheManager=new jG(f,f.allKeys?void 0:new XG(f,this.options.clientId),this.nowProvider),this.dpop=this.options.useDpop?new JG(this.options.clientId):void 0,this.domainUrl=(w=this.options.domain,/^https?:\/\//.test(w)?w:`https://${w}`),this.tokenIssuer=((E,o)=>E?E.startsWith("https://")?E:`https://${E}/`:`${o}/`)(this.options.issuer,this.domainUrl),typeof window<"u"&&window.Worker&&this.options.useRefreshTokens&&c==="memory"&&(this.options.workerUrl?this.worker=new Worker(this.options.workerUrl):this.worker=new ZG)}_url(i){const c=encodeURIComponent(btoa(JSON.stringify(this.options.auth0Client||r3)));return`${this.domainUrl}${i}&auth0Client=${c}`}_authorizeUrl(i){return this._url(`/authorize?${_2(i)}`)}async _verifyIdToken(i,c,f){const _=await this.nowProvider();return GG({iss:this.tokenIssuer,aud:this.options.clientId,id_token:i,nonce:c,organization:f,leeway:this.options.leeway,max_age:(w=this.options.authorizationParams.max_age,typeof w!="string"?w:parseInt(w,10)||void 0),now:_});var w}_processOrgHint(i){i?this.cookieStorage.save(this.orgHintCookieName,i,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}async _prepareAuthorizeUrl(i,c,f){var _;const w=_k(GT()),E=_k(GT()),o=GT(),k=(H=>{const ne=new Uint8Array(H);return(ce=>{const K={"+":"-","/":"_","=":""};return ce.replace(/[+/=]/g,se=>K[se])})(window.btoa(String.fromCharCode(...Array.from(ne))))})(await(async H=>await U0().subtle.digest({name:"SHA-256"},new TextEncoder().encode(H)))(o)),L=await((_=this.dpop)===null||_===void 0?void 0:_.calculateThumbprint()),N=((H,ne,ce,K,se,Y,Q,ae,Te)=>Object.assign(Object.assign(Object.assign({client_id:H.clientId},H.authorizationParams),ce),{scope:O_(ne,ce.scope),response_type:"code",response_mode:ae||"query",state:K,nonce:se,redirect_uri:Q||H.authorizationParams.redirect_uri,code_challenge:Y,code_challenge_method:"S256",dpop_jkt:Te}))(this.options,this.scope,i,w,E,k,i.redirect_uri||this.options.authorizationParams.redirect_uri||f,c==null?void 0:c.response_mode,L),V=this._authorizeUrl(N);return{nonce:E,code_verifier:o,scope:N.scope,audience:N.audience||"default",redirect_uri:N.redirect_uri,state:w,url:V}}async loginWithPopup(i,c){var f;if(i=i||{},!(c=c||{}).popup&&(c.popup=(o=>{const k=window.screenX+(window.innerWidth-400)/2,L=window.screenY+(window.innerHeight-600)/2;return window.open(o,"auth0:authorize:popup",`left=${k},top=${L},width=400,height=600,resizable,scrollbars=yes,status=1`)})(""),!c.popup))throw new Error("Unable to open a popup for loginWithPopup - window.open returned `null`");const _=await this._prepareAuthorizeUrl(i.authorizationParams||{},{response_mode:"web_message"},window.location.origin);c.popup.location.href=_.url;const w=await(o=>new Promise((k,L)=>{let N;const V=setInterval(()=>{o.popup&&o.popup.closed&&(clearInterval(V),clearTimeout(H),window.removeEventListener("message",N,!1),L(new tI(o.popup)))},1e3),H=setTimeout(()=>{clearInterval(V),L(new eI(o.popup)),window.removeEventListener("message",N,!1)},1e3*(o.timeoutInSeconds||60));N=function(ne){if(ne.data&&ne.data.type==="authorization_response"){if(clearTimeout(H),clearInterval(V),window.removeEventListener("message",N,!1),o.popup.close(),ne.data.response.error)return L(Ls.fromPayload(ne.data.response));k(ne.data.response)}},window.addEventListener("message",N)}))(Object.assign(Object.assign({},c),{timeoutInSeconds:c.timeoutInSeconds||this.options.authorizeTimeoutInSeconds||60}));if(_.state!==w.state)throw new Ls("state_mismatch","Invalid state");const E=((f=i.authorizationParams)===null||f===void 0?void 0:f.organization)||this.options.authorizationParams.organization;await this._requestToken({audience:_.audience,scope:_.scope,code_verifier:_.code_verifier,grant_type:"authorization_code",code:w.code,redirect_uri:_.redirect_uri},{nonceIn:_.nonce,organization:E})}async getUser(){var i;const c=await this._getIdTokenFromCache();return(i=c==null?void 0:c.decodedToken)===null||i===void 0?void 0:i.user}async getIdTokenClaims(){var i;const c=await this._getIdTokenFromCache();return(i=c==null?void 0:c.decodedToken)===null||i===void 0?void 0:i.claims}async loginWithRedirect(i={}){var c;const f=Sk(i),{openUrl:_,fragment:w,appState:E}=f,o=Fl(f,["openUrl","fragment","appState"]),k=((c=o.authorizationParams)===null||c===void 0?void 0:c.organization)||this.options.authorizationParams.organization,L=await this._prepareAuthorizeUrl(o.authorizationParams||{}),{url:N}=L,V=Fl(L,["url"]);this.transactionManager.create(Object.assign(Object.assign(Object.assign({},V),{appState:E}),k&&{organization:k}));const H=w?`${N}#${w}`:N;_?await _(H):window.location.assign(H)}async handleRedirectCallback(i=window.location.href){const c=i.split("?").slice(1);if(c.length===0)throw new Error("There are no query params available for parsing.");const{state:f,code:_,error:w,error_description:E}=(V=>{V.indexOf("#")>-1&&(V=V.substring(0,V.indexOf("#")));const H=new URLSearchParams(V);return{state:H.get("state"),code:H.get("code")||void 0,error:H.get("error")||void 0,error_description:H.get("error_description")||void 0}})(c.join("")),o=this.transactionManager.get();if(!o)throw new Ls("missing_transaction","Invalid state");if(this.transactionManager.remove(),w)throw new QE(w,E||w,f,o.appState);if(!o.code_verifier||o.state&&o.state!==f)throw new Ls("state_mismatch","Invalid state");const k=o.organization,L=o.nonce,N=o.redirect_uri;return await this._requestToken(Object.assign({audience:o.audience,scope:o.scope,code_verifier:o.code_verifier,grant_type:"authorization_code",code:_},N?{redirect_uri:N}:{}),{nonceIn:L,organization:k}),{appState:o.appState}}async checkSession(i){if(!this.cookieStorage.get(this.isAuthenticatedCookieName)){if(!this.cookieStorage.get("auth0.is.authenticated"))return;this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove("auth0.is.authenticated")}try{await this.getTokenSilently(i)}catch{}}async getTokenSilently(i={}){var c;const f=Object.assign(Object.assign({cacheMode:"on"},i),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),i.authorizationParams),{scope:O_(this.scope,(c=i.authorizationParams)===null||c===void 0?void 0:c.scope)})}),_=await((w,E)=>{let o=HT[E];return o||(o=w().finally(()=>{delete HT[E],o=null}),HT[E]=o),o})(()=>this._getTokenSilently(f),`${this.options.clientId}::${f.authorizationParams.audience}::${f.authorizationParams.scope}`);return i.detailedResponse?_:_==null?void 0:_.access_token}async _getTokenSilently(i){const{cacheMode:c}=i,f=Fl(i,["cacheMode"]);if(c!=="off"){const _=await this._getEntryFromCache({scope:f.authorizationParams.scope,audience:f.authorizationParams.audience||"default",clientId:this.options.clientId});if(_)return _}if(c!=="cache-only"){if(!await(async(_,w=3)=>{for(let E=0;E<w;E++)if(await _())return!0;return!1})(()=>WT.acquireLock("auth0.lock.getTokenSilently",5e3),10))throw new Dy;try{if(window.addEventListener("pagehide",this._releaseLockOnPageHide),c!=="off"){const N=await this._getEntryFromCache({scope:f.authorizationParams.scope,audience:f.authorizationParams.audience||"default",clientId:this.options.clientId});if(N)return N}const _=this.options.useRefreshTokens?await this._getTokenUsingRefreshToken(f):await this._getTokenFromIFrame(f),{id_token:w,token_type:E,access_token:o,oauthTokenScope:k,expires_in:L}=_;return Object.assign(Object.assign({id_token:w,token_type:E,access_token:o},k?{scope:k}:null),{expires_in:L})}finally{await WT.releaseLock("auth0.lock.getTokenSilently"),window.removeEventListener("pagehide",this._releaseLockOnPageHide)}}}async getTokenWithPopup(i={},c={}){var f;const _=Object.assign(Object.assign({},i),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),i.authorizationParams),{scope:O_(this.scope,(f=i.authorizationParams)===null||f===void 0?void 0:f.scope)})});return c=Object.assign(Object.assign({},TG),c),await this.loginWithPopup(_,c),(await this.cacheManager.get(new jl({scope:_.authorizationParams.scope,audience:_.authorizationParams.audience||"default",clientId:this.options.clientId}))).access_token}async isAuthenticated(){return!!await this.getUser()}_buildLogoutUrl(i){i.clientId!==null?i.clientId=i.clientId||this.options.clientId:delete i.clientId;const c=i.logoutParams||{},{federated:f}=c,_=Fl(c,["federated"]),w=f?"&federated":"";return this._url(`/v2/logout?${_2(Object.assign({clientId:i.clientId},_))}`)+w}async logout(i={}){var c;const f=Sk(i),{openUrl:_}=f,w=Fl(f,["openUrl"]);i.clientId===null?await this.cacheManager.clear():await this.cacheManager.clear(i.clientId||this.options.clientId),this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove(this.isAuthenticatedCookieName,{cookieDomain:this.options.cookieDomain}),this.userCache.remove("@@user@@"),await((c=this.dpop)===null||c===void 0?void 0:c.clear());const E=this._buildLogoutUrl(w);_?await _(E):_!==!1&&window.location.assign(E)}async _getTokenFromIFrame(i){const c=Object.assign(Object.assign({},i.authorizationParams),{prompt:"none"}),f=this.cookieStorage.get(this.orgHintCookieName);f&&!c.organization&&(c.organization=f);const{url:_,state:w,nonce:E,code_verifier:o,redirect_uri:k,scope:L,audience:N}=await this._prepareAuthorizeUrl(c,{response_mode:"web_message"},window.location.origin);try{if(window.crossOriginIsolated)throw new Ls("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");const V=i.timeoutInSeconds||this.options.authorizeTimeoutInSeconds;let H;try{H=new URL(this.domainUrl).origin}catch{H=this.domainUrl}const ne=await((K,se,Y=60)=>new Promise((Q,ae)=>{const Te=window.document.createElement("iframe");Te.setAttribute("width","0"),Te.setAttribute("height","0"),Te.style.display="none";const Be=()=>{window.document.body.contains(Te)&&(window.document.body.removeChild(Te),window.removeEventListener("message",et,!1))};let et;const nt=setTimeout(()=>{ae(new Dy),Be()},1e3*Y);et=function(Je){if(Je.origin!=se||!Je.data||Je.data.type!=="authorization_response")return;const Dt=Je.source;Dt&&Dt.close(),Je.data.response.error?ae(Ls.fromPayload(Je.data.response)):Q(Je.data.response),clearTimeout(nt),window.removeEventListener("message",et,!1),setTimeout(Be,2e3)},window.addEventListener("message",et,!1),window.document.body.appendChild(Te),Te.setAttribute("src",K)}))(_,H,V);if(w!==ne.state)throw new Ls("state_mismatch","Invalid state");const ce=await this._requestToken(Object.assign(Object.assign({},i.authorizationParams),{code_verifier:o,code:ne.code,grant_type:"authorization_code",redirect_uri:k,timeout:i.authorizationParams.timeout||this.httpTimeoutMs}),{nonceIn:E,organization:c.organization});return Object.assign(Object.assign({},ce),{scope:L,oauthTokenScope:ce.scope,audience:N})}catch(V){throw V.error==="login_required"&&this.logout({openUrl:!1}),V}}async _getTokenUsingRefreshToken(i){const c=await this.cacheManager.get(new jl({scope:i.authorizationParams.scope,audience:i.authorizationParams.audience||"default",clientId:this.options.clientId}));if(!(c&&c.refresh_token||this.worker)){if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(i);throw new tw(i.authorizationParams.audience||"default",i.authorizationParams.scope)}const f=i.authorizationParams.redirect_uri||this.options.authorizationParams.redirect_uri||window.location.origin,_=typeof i.timeoutInSeconds=="number"?1e3*i.timeoutInSeconds:null;try{const w=await this._requestToken(Object.assign(Object.assign(Object.assign({},i.authorizationParams),{grant_type:"refresh_token",refresh_token:c&&c.refresh_token,redirect_uri:f}),_&&{timeout:_}));return Object.assign(Object.assign({},w),{scope:i.authorizationParams.scope,oauthTokenScope:w.scope,audience:i.authorizationParams.audience||"default"})}catch(w){if((w.message.indexOf("Missing Refresh Token")>-1||w.message&&w.message.indexOf("invalid refresh token")>-1)&&this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(i);throw w}}async _saveEntryInCache(i){const{id_token:c,decodedToken:f}=i,_=Fl(i,["id_token","decodedToken"]);this.userCache.set("@@user@@",{id_token:c,decodedToken:f}),await this.cacheManager.setIdToken(this.options.clientId,i.id_token,i.decodedToken),await this.cacheManager.set(_)}async _getIdTokenFromCache(){const i=this.options.authorizationParams.audience||"default",c=await this.cacheManager.getIdToken(new jl({clientId:this.options.clientId,audience:i,scope:this.scope})),f=this.userCache.get("@@user@@");return c&&c.id_token===(f==null?void 0:f.id_token)?f:(this.userCache.set("@@user@@",c),c)}async _getEntryFromCache({scope:i,audience:c,clientId:f}){const _=await this.cacheManager.get(new jl({scope:i,audience:c,clientId:f}),60);if(_&&_.access_token){const{token_type:w,access_token:E,oauthTokenScope:o,expires_in:k}=_,L=await this._getIdTokenFromCache();return L&&Object.assign(Object.assign({id_token:L.id_token,token_type:w||"Bearer",access_token:E},o?{scope:o}:null),{expires_in:k})}}async _requestToken(i,c){const{nonceIn:f,organization:_}=c||{},w=await NG(Object.assign({baseUrl:this.domainUrl,client_id:this.options.clientId,auth0Client:this.options.auth0Client,useFormData:this.options.useFormData,timeout:this.httpTimeoutMs,dpop:this.dpop},i),this.worker),E=await this._verifyIdToken(w.id_token,f,_);return await this._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},w),{decodedToken:E,scope:i.scope,audience:i.audience||"default"}),w.scope?{oauthTokenScope:w.scope}:null),{client_id:this.options.clientId})),this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this._processOrgHint(_||E.claims.org_id),Object.assign(Object.assign({},w),{decodedToken:E})}async exchangeToken(i){return this._requestToken({grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:i.subject_token,subject_token_type:i.subject_token_type,scope:O_(i.scope,this.scope),audience:i.audience||this.options.authorizationParams.audience})}_assertDpop(i){if(!i)throw new Error("`useDpop` option must be enabled before using DPoP.")}getDpopNonce(i){return this._assertDpop(this.dpop),this.dpop.getNonce(i)}setDpopNonce(i,c){return this._assertDpop(this.dpop),this.dpop.setNonce(i,c)}generateDpopProof(i){return this._assertDpop(this.dpop),this.dpop.generateProof(i)}createFetcher(i={}){if(this.options.useDpop&&!i.dpopNonceId)throw new TypeError("When `useDpop` is enabled, `dpopNonceId` must be set when calling `createFetcher()`.");return new QG(i,{isDpopEnabled:()=>!!this.options.useDpop,getAccessToken:()=>this.getTokenSilently(),getDpopNonce:()=>this.getDpopNonce(i.dpopNonceId),setDpopNonce:c=>this.setDpopNonce(c),generateDpopProof:c=>this.generateDpopProof(c)})}}var f3={isAuthenticated:!1,isLoading:!0,error:void 0,user:void 0},Xo=function(){throw new Error("You forgot to wrap your component in <Auth0Provider>.")},t$=Es(Es({},f3),{buildAuthorizeUrl:Xo,buildLogoutUrl:Xo,getAccessTokenSilently:Xo,getAccessTokenWithPopup:Xo,getIdTokenClaims:Xo,loginWithRedirect:Xo,loginWithPopup:Xo,logout:Xo,handleRedirectCallback:Xo,getDpopNonce:Xo,setDpopNonce:Xo,generateDpopProof:Xo,createFetcher:Xo}),p3=fe.createContext(t$),Ek=function(t){vG(i,t);function i(c,f){var _=t.call(this,f??c)||this;return _.error=c,_.error_description=f,Object.setPrototypeOf(_,i.prototype),_}return i}(Error),n$=/[?&]code=[^&]+/,i$=/[?&]state=[^&]+/,r$=/[?&]error=[^&]+/,s$=function(t){return t===void 0&&(t=window.location.search),(n$.test(t)||r$.test(t))&&i$.test(t)},m3=function(t){return function(i){return i instanceof Error?i:i!==null&&typeof i=="object"&&"error"in i&&typeof i.error=="string"?"error_description"in i&&typeof i.error_description=="string"?new Ek(i.error,i.error_description):new Ek(i.error):new Error(t)}},Ik=m3("Login failed"),qT=m3("Get access token failed"),g3=function(t){var i,c;t!=null&&t.redirectUri&&(console.warn("Using `redirectUri` has been deprecated, please use `authorizationParams.redirect_uri` instead as `redirectUri` will be no longer supported in a future version"),t.authorizationParams=(i=t.authorizationParams)!==null&&i!==void 0?i:{},t.authorizationParams.redirect_uri=t.redirectUri,delete t.redirectUri),!((c=t==null?void 0:t.authorizationParams)===null||c===void 0)&&c.redirectUri&&(console.warn("Using `authorizationParams.redirectUri` has been deprecated, please use `authorizationParams.redirect_uri` instead as `authorizationParams.redirectUri` will be removed in a future version"),t.authorizationParams.redirect_uri=t.authorizationParams.redirectUri,delete t.authorizationParams.redirectUri)},o$=function(t,i){switch(i.type){case"LOGIN_POPUP_STARTED":return Es(Es({},t),{isLoading:!0});case"LOGIN_POPUP_COMPLETE":case"INITIALISED":return Es(Es({},t),{isAuthenticated:!!i.user,user:i.user,isLoading:!1,error:void 0});case"HANDLE_REDIRECT_COMPLETE":case"GET_ACCESS_TOKEN_COMPLETE":return t.user===i.user?t:Es(Es({},t),{isAuthenticated:!!i.user,user:i.user});case"LOGOUT":return Es(Es({},t),{isAuthenticated:!1,user:void 0});case"ERROR":return Es(Es({},t),{isLoading:!1,error:i.error})}},a$=function(t){return g3(t),Es(Es({},t),{auth0Client:{name:"auth0-react",version:"2.5.0"}})},l$=function(t){var i;window.history.replaceState({},document.title,(i=t==null?void 0:t.returnTo)!==null&&i!==void 0?i:window.location.pathname)},c$=function(t){var i=t.children,c=t.skipRedirectCallback,f=t.onRedirectCallback,_=f===void 0?l$:f,w=t.context,E=w===void 0?p3:w,o=xG(t,["children","skipRedirectCallback","onRedirectCallback","context"]),k=fe.useState(function(){return new e$(a$(o))})[0],L=fe.useReducer(o$,f3),N=L[0],V=L[1],H=fe.useRef(!1),ne=fe.useCallback(function(wt){return V({type:"ERROR",error:wt}),wt},[]);fe.useEffect(function(){H.current||(H.current=!0,function(){return bp(void 0,void 0,void 0,function(){var wt,xt,qt;return Tp(this,function(ln){switch(ln.label){case 0:return ln.trys.push([0,7,,8]),wt=void 0,s$()&&!c?[4,k.handleRedirectCallback()]:[3,3];case 1:return xt=ln.sent().appState,[4,k.getUser()];case 2:return wt=ln.sent(),_(xt,wt),[3,6];case 3:return[4,k.checkSession()];case 4:return ln.sent(),[4,k.getUser()];case 5:wt=ln.sent(),ln.label=6;case 6:return V({type:"INITIALISED",user:wt}),[3,8];case 7:return qt=ln.sent(),ne(Ik(qt)),[3,8];case 8:return[2]}})})}())},[k,_,c,ne]);var ce=fe.useCallback(function(wt){return g3(wt),k.loginWithRedirect(wt)},[k]),K=fe.useCallback(function(wt,xt){return bp(void 0,void 0,void 0,function(){var qt,ln;return Tp(this,function(Ht){switch(Ht.label){case 0:V({type:"LOGIN_POPUP_STARTED"}),Ht.label=1;case 1:return Ht.trys.push([1,3,,4]),[4,k.loginWithPopup(wt,xt)];case 2:return Ht.sent(),[3,4];case 3:return qt=Ht.sent(),ne(Ik(qt)),[2];case 4:return[4,k.getUser()];case 5:return ln=Ht.sent(),V({type:"LOGIN_POPUP_COMPLETE",user:ln}),[2]}})})},[k,ne]),se=fe.useCallback(function(){for(var wt=[],xt=0;xt<arguments.length;xt++)wt[xt]=arguments[xt];return bp(void 0,wG([],wt),void 0,function(qt){return qt===void 0&&(qt={}),Tp(this,function(ln){switch(ln.label){case 0:return[4,k.logout(qt)];case 1:return ln.sent(),(qt.openUrl||qt.openUrl===!1)&&V({type:"LOGOUT"}),[2]}})})},[k]),Y=fe.useCallback(function(wt){return bp(void 0,void 0,void 0,function(){var xt,qt,ln,Ht;return Tp(this,function(cn){switch(cn.label){case 0:return cn.trys.push([0,2,3,5]),[4,k.getTokenSilently(wt)];case 1:return xt=cn.sent(),[3,5];case 2:throw qt=cn.sent(),qT(qt);case 3:return ln=V,Ht={type:"GET_ACCESS_TOKEN_COMPLETE"},[4,k.getUser()];case 4:return ln.apply(void 0,[(Ht.user=cn.sent(),Ht)]),[7];case 5:return[2,xt]}})})},[k]),Q=fe.useCallback(function(wt,xt){return bp(void 0,void 0,void 0,function(){var qt,ln,Ht,cn;return Tp(this,function(pn){switch(pn.label){case 0:return pn.trys.push([0,2,3,5]),[4,k.getTokenWithPopup(wt,xt)];case 1:return qt=pn.sent(),[3,5];case 2:throw ln=pn.sent(),qT(ln);case 3:return Ht=V,cn={type:"GET_ACCESS_TOKEN_COMPLETE"},[4,k.getUser()];case 4:return Ht.apply(void 0,[(cn.user=pn.sent(),cn)]),[7];case 5:return[2,qt]}})})},[k]),ae=fe.useCallback(function(){return k.getIdTokenClaims()},[k]),Te=fe.useCallback(function(wt){return bp(void 0,void 0,void 0,function(){var xt,qt,ln;return Tp(this,function(Ht){switch(Ht.label){case 0:return Ht.trys.push([0,2,3,5]),[4,k.handleRedirectCallback(wt)];case 1:return[2,Ht.sent()];case 2:throw xt=Ht.sent(),qT(xt);case 3:return qt=V,ln={type:"HANDLE_REDIRECT_COMPLETE"},[4,k.getUser()];case 4:return qt.apply(void 0,[(ln.user=Ht.sent(),ln)]),[7];case 5:return[2]}})})},[k]),Be=fe.useCallback(function(wt){return k.getDpopNonce(wt)},[k]),et=fe.useCallback(function(wt,xt){return k.setDpopNonce(wt,xt)},[k]),nt=fe.useCallback(function(wt){return k.generateDpopProof(wt)},[k]),Je=fe.useCallback(function(wt){return k.createFetcher(wt)},[k]),Dt=fe.useMemo(function(){return Es(Es({},N),{getAccessTokenSilently:Y,getAccessTokenWithPopup:Q,getIdTokenClaims:ae,loginWithRedirect:ce,loginWithPopup:K,logout:se,handleRedirectCallback:Te,getDpopNonce:Be,setDpopNonce:et,generateDpopProof:nt,createFetcher:Je})},[N,Y,Q,ae,ce,K,se,Te,Be,et,nt,Je]);return Ka.createElement(E.Provider,{value:Dt},i)},ev=function(t){return t===void 0&&(t=p3),fe.useContext(t)},iw=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},u$={setTimeout:(t,i)=>setTimeout(t,i),clearTimeout:t=>clearTimeout(t),setInterval:(t,i)=>setInterval(t,i),clearInterval:t=>clearInterval(t)},Uu,Y2,AL,h$=(AL=class{constructor(){Ni(this,Uu,u$);Ni(this,Y2,!1)}setTimeoutProvider(t){si(this,Uu,t)}setTimeout(t,i){return Mt(this,Uu).setTimeout(t,i)}clearTimeout(t){Mt(this,Uu).clearTimeout(t)}setInterval(t,i){return Mt(this,Uu).setInterval(t,i)}clearInterval(t){Mt(this,Uu).clearInterval(t)}},Uu=new WeakMap,Y2=new WeakMap,AL),v2=new h$;function d$(t){setTimeout(t,0)}var rw=typeof window>"u"||"Deno"in globalThis;function qa(){}function f$(t,i){return typeof t=="function"?t(i):t}function p$(t){return typeof t=="number"&&t>=0&&t!==1/0}function m$(t,i){return Math.max(t+(i||0)-Date.now(),0)}function x2(t,i){return typeof t=="function"?t(i):t}function g$(t,i){return typeof t=="function"?t(i):t}function Ak(t,i){const{type:c="all",exact:f,fetchStatus:_,predicate:w,queryKey:E,stale:o}=t;if(E){if(f){if(i.queryHash!==iI(E,i.options))return!1}else if(!zy(i.queryKey,E))return!1}if(c!=="all"){const k=i.isActive();if(c==="active"&&!k||c==="inactive"&&k)return!1}return!(typeof o=="boolean"&&i.isStale()!==o||_&&_!==i.state.fetchStatus||w&&!w(i))}function Ck(t,i){const{exact:c,status:f,predicate:_,mutationKey:w}=t;if(w){if(!i.options.mutationKey)return!1;if(c){if(Ly(i.options.mutationKey)!==Ly(w))return!1}else if(!zy(i.options.mutationKey,w))return!1}return!(f&&i.state.status!==f||_&&!_(i))}function iI(t,i){return((i==null?void 0:i.queryKeyHashFn)||Ly)(t)}function Ly(t){return JSON.stringify(t,(i,c)=>w2(c)?Object.keys(c).sort().reduce((f,_)=>(f[_]=c[_],f),{}):c)}function zy(t,i){return t===i?!0:typeof t!=typeof i?!1:t&&i&&typeof t=="object"&&typeof i=="object"?Object.keys(i).every(c=>zy(t[c],i[c])):!1}var _$=Object.prototype.hasOwnProperty;function _3(t,i){if(t===i)return t;const c=Pk(t)&&Pk(i);if(!c&&!(w2(t)&&w2(i)))return i;const _=(c?t:Object.keys(t)).length,w=c?i:Object.keys(i),E=w.length,o=c?new Array(E):{};let k=0;for(let L=0;L<E;L++){const N=c?L:w[L],V=t[N],H=i[N];if(V===H){o[N]=V,(c?L<_:_$.call(t,N))&&k++;continue}if(V===null||H===null||typeof V!="object"||typeof H!="object"){o[N]=H;continue}const ne=_3(V,H);o[N]=ne,ne===V&&k++}return _===E&&k===_?t:o}function Pk(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function w2(t){if(!Mk(t))return!1;const i=t.constructor;if(i===void 0)return!0;const c=i.prototype;return!(!Mk(c)||!c.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Mk(t){return Object.prototype.toString.call(t)==="[object Object]"}function y$(t){return new Promise(i=>{v2.setTimeout(i,t)})}function v$(t,i,c){return typeof c.structuralSharing=="function"?c.structuralSharing(t,i):c.structuralSharing!==!1?_3(t,i):i}function x$(t,i,c=0){const f=[...t,i];return c&&f.length>c?f.slice(1):f}function w$(t,i,c=0){const f=[i,...t];return c&&f.length>c?f.slice(0,-1):f}var rI=Symbol();function y3(t,i){return!t.queryFn&&(i!=null&&i.initialPromise)?()=>i.initialPromise:!t.queryFn||t.queryFn===rI?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}var Td,Gu,im,CL,b$=(CL=class extends iw{constructor(){super();Ni(this,Td);Ni(this,Gu);Ni(this,im);si(this,im,i=>{if(!rw&&window.addEventListener){const c=()=>i();return window.addEventListener("visibilitychange",c,!1),()=>{window.removeEventListener("visibilitychange",c)}}})}onSubscribe(){Mt(this,Gu)||this.setEventListener(Mt(this,im))}onUnsubscribe(){var i;this.hasListeners()||((i=Mt(this,Gu))==null||i.call(this),si(this,Gu,void 0))}setEventListener(i){var c;si(this,im,i),(c=Mt(this,Gu))==null||c.call(this),si(this,Gu,i(f=>{typeof f=="boolean"?this.setFocused(f):this.onFocus()}))}setFocused(i){Mt(this,Td)!==i&&(si(this,Td,i),this.onFocus())}onFocus(){const i=this.isFocused();this.listeners.forEach(c=>{c(i)})}isFocused(){var i;return typeof Mt(this,Td)=="boolean"?Mt(this,Td):((i=globalThis.document)==null?void 0:i.visibilityState)!=="hidden"}},Td=new WeakMap,Gu=new WeakMap,im=new WeakMap,CL),v3=new b$;function T$(){let t,i;const c=new Promise((_,w)=>{t=_,i=w});c.status="pending",c.catch(()=>{});function f(_){Object.assign(c,_),delete c.resolve,delete c.reject}return c.resolve=_=>{f({status:"fulfilled",value:_}),t(_)},c.reject=_=>{f({status:"rejected",reason:_}),i(_)},c}var S$=d$;function E$(){let t=[],i=0,c=o=>{o()},f=o=>{o()},_=S$;const w=o=>{i?t.push(o):_(()=>{c(o)})},E=()=>{const o=t;t=[],o.length&&_(()=>{f(()=>{o.forEach(k=>{c(k)})})})};return{batch:o=>{let k;i++;try{k=o()}finally{i--,i||E()}return k},batchCalls:o=>(...k)=>{w(()=>{o(...k)})},schedule:w,setNotifyFunction:o=>{c=o},setBatchNotifyFunction:o=>{f=o},setScheduler:o=>{_=o}}}var xo=E$(),rm,$u,sm,PL,I$=(PL=class extends iw{constructor(){super();Ni(this,rm,!0);Ni(this,$u);Ni(this,sm);si(this,sm,i=>{if(!rw&&window.addEventListener){const c=()=>i(!0),f=()=>i(!1);return window.addEventListener("online",c,!1),window.addEventListener("offline",f,!1),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",f)}}})}onSubscribe(){Mt(this,$u)||this.setEventListener(Mt(this,sm))}onUnsubscribe(){var i;this.hasListeners()||((i=Mt(this,$u))==null||i.call(this),si(this,$u,void 0))}setEventListener(i){var c;si(this,sm,i),(c=Mt(this,$u))==null||c.call(this),si(this,$u,i(this.setOnline.bind(this)))}setOnline(i){Mt(this,rm)!==i&&(si(this,rm,i),this.listeners.forEach(f=>{f(i)}))}isOnline(){return Mt(this,rm)}},rm=new WeakMap,$u=new WeakMap,sm=new WeakMap,PL),w1=new I$;function A$(t){return Math.min(1e3*2**t,3e4)}function x3(t){return(t??"online")==="online"?w1.isOnline():!0}var b2=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function w3(t){let i=!1,c=0,f;const _=T$(),w=()=>_.status!=="pending",E=K=>{var se;if(!w()){const Y=new b2(K);H(Y),(se=t.onCancel)==null||se.call(t,Y)}},o=()=>{i=!0},k=()=>{i=!1},L=()=>v3.isFocused()&&(t.networkMode==="always"||w1.isOnline())&&t.canRun(),N=()=>x3(t.networkMode)&&t.canRun(),V=K=>{w()||(f==null||f(),_.resolve(K))},H=K=>{w()||(f==null||f(),_.reject(K))},ne=()=>new Promise(K=>{var se;f=Y=>{(w()||L())&&K(Y)},(se=t.onPause)==null||se.call(t)}).then(()=>{var K;f=void 0,w()||(K=t.onContinue)==null||K.call(t)}),ce=()=>{if(w())return;let K;const se=c===0?t.initialPromise:void 0;try{K=se??t.fn()}catch(Y){K=Promise.reject(Y)}Promise.resolve(K).then(V).catch(Y=>{var et;if(w())return;const Q=t.retry??(rw?0:3),ae=t.retryDelay??A$,Te=typeof ae=="function"?ae(c,Y):ae,Be=Q===!0||typeof Q=="number"&&c<Q||typeof Q=="function"&&Q(c,Y);if(i||!Be){H(Y);return}c++,(et=t.onFail)==null||et.call(t,c,Y),y$(Te).then(()=>L()?void 0:ne()).then(()=>{i?H(Y):ce()})})};return{promise:_,status:()=>_.status,cancel:E,continue:()=>(f==null||f(),_),cancelRetry:o,continueRetry:k,canStart:N,start:()=>(N()?ce():ne().then(ce),_)}}var Sd,ML,b3=(ML=class{constructor(){Ni(this,Sd)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),p$(this.gcTime)&&si(this,Sd,v2.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(rw?1/0:5*60*1e3))}clearGcTimeout(){Mt(this,Sd)&&(v2.clearTimeout(Mt(this,Sd)),si(this,Sd,void 0))}},Sd=new WeakMap,ML),Ed,om,ba,Id,Ss,Wy,Ad,Za,Ic,RL,C$=(RL=class extends b3{constructor(i){super();Ni(this,Za);Ni(this,Ed);Ni(this,om);Ni(this,ba);Ni(this,Id);Ni(this,Ss);Ni(this,Wy);Ni(this,Ad);si(this,Ad,!1),si(this,Wy,i.defaultOptions),this.setOptions(i.options),this.observers=[],si(this,Id,i.client),si(this,ba,Mt(this,Id).getQueryCache()),this.queryKey=i.queryKey,this.queryHash=i.queryHash,si(this,Ed,Rk(this.options)),this.state=i.state??Mt(this,Ed),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var i;return(i=Mt(this,Ss))==null?void 0:i.promise}setOptions(i){if(this.options={...Mt(this,Wy),...i},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const c=Rk(this.options);c.data!==void 0&&(this.setData(c.data,{updatedAt:c.dataUpdatedAt,manual:!0}),si(this,Ed,c))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Mt(this,ba).remove(this)}setData(i,c){const f=v$(this.state.data,i,this.options);return Hs(this,Za,Ic).call(this,{data:f,type:"success",dataUpdatedAt:c==null?void 0:c.updatedAt,manual:c==null?void 0:c.manual}),f}setState(i,c){Hs(this,Za,Ic).call(this,{type:"setState",state:i,setStateOptions:c})}cancel(i){var f,_;const c=(f=Mt(this,Ss))==null?void 0:f.promise;return(_=Mt(this,Ss))==null||_.cancel(i),c?c.then(qa).catch(qa):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Mt(this,Ed))}isActive(){return this.observers.some(i=>g$(i.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===rI||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(i=>x2(i.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(i=>i.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(i=0){return this.state.data===void 0?!0:i==="static"?!1:this.state.isInvalidated?!0:!m$(this.state.dataUpdatedAt,i)}onFocus(){var c;const i=this.observers.find(f=>f.shouldFetchOnWindowFocus());i==null||i.refetch({cancelRefetch:!1}),(c=Mt(this,Ss))==null||c.continue()}onOnline(){var c;const i=this.observers.find(f=>f.shouldFetchOnReconnect());i==null||i.refetch({cancelRefetch:!1}),(c=Mt(this,Ss))==null||c.continue()}addObserver(i){this.observers.includes(i)||(this.observers.push(i),this.clearGcTimeout(),Mt(this,ba).notify({type:"observerAdded",query:this,observer:i}))}removeObserver(i){this.observers.includes(i)&&(this.observers=this.observers.filter(c=>c!==i),this.observers.length||(Mt(this,Ss)&&(Mt(this,Ad)?Mt(this,Ss).cancel({revert:!0}):Mt(this,Ss).cancelRetry()),this.scheduleGc()),Mt(this,ba).notify({type:"observerRemoved",query:this,observer:i}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Hs(this,Za,Ic).call(this,{type:"invalidate"})}async fetch(i,c){var k,L,N,V,H,ne,ce,K,se,Y,Q,ae;if(this.state.fetchStatus!=="idle"&&((k=Mt(this,Ss))==null?void 0:k.status())!=="rejected"){if(this.state.data!==void 0&&(c!=null&&c.cancelRefetch))this.cancel({silent:!0});else if(Mt(this,Ss))return Mt(this,Ss).continueRetry(),Mt(this,Ss).promise}if(i&&this.setOptions(i),!this.options.queryFn){const Te=this.observers.find(Be=>Be.options.queryFn);Te&&this.setOptions(Te.options)}const f=new AbortController,_=Te=>{Object.defineProperty(Te,"signal",{enumerable:!0,get:()=>(si(this,Ad,!0),f.signal)})},w=()=>{const Te=y3(this.options,c),et=(()=>{const nt={client:Mt(this,Id),queryKey:this.queryKey,meta:this.meta};return _(nt),nt})();return si(this,Ad,!1),this.options.persister?this.options.persister(Te,et,this):Te(et)},o=(()=>{const Te={fetchOptions:c,options:this.options,queryKey:this.queryKey,client:Mt(this,Id),state:this.state,fetchFn:w};return _(Te),Te})();(L=this.options.behavior)==null||L.onFetch(o,this),si(this,om,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((N=o.fetchOptions)==null?void 0:N.meta))&&Hs(this,Za,Ic).call(this,{type:"fetch",meta:(V=o.fetchOptions)==null?void 0:V.meta}),si(this,Ss,w3({initialPromise:c==null?void 0:c.initialPromise,fn:o.fetchFn,onCancel:Te=>{Te instanceof b2&&Te.revert&&this.setState({...Mt(this,om),fetchStatus:"idle"}),f.abort()},onFail:(Te,Be)=>{Hs(this,Za,Ic).call(this,{type:"failed",failureCount:Te,error:Be})},onPause:()=>{Hs(this,Za,Ic).call(this,{type:"pause"})},onContinue:()=>{Hs(this,Za,Ic).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0}));try{const Te=await Mt(this,Ss).start();if(Te===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(Te),(ne=(H=Mt(this,ba).config).onSuccess)==null||ne.call(H,Te,this),(K=(ce=Mt(this,ba).config).onSettled)==null||K.call(ce,Te,this.state.error,this),Te}catch(Te){if(Te instanceof b2){if(Te.silent)return Mt(this,Ss).promise;if(Te.revert){if(this.state.data===void 0)throw Te;return this.state.data}}throw Hs(this,Za,Ic).call(this,{type:"error",error:Te}),(Y=(se=Mt(this,ba).config).onError)==null||Y.call(se,Te,this),(ae=(Q=Mt(this,ba).config).onSettled)==null||ae.call(Q,this.state.data,Te,this),Te}finally{this.scheduleGc()}}},Ed=new WeakMap,om=new WeakMap,ba=new WeakMap,Id=new WeakMap,Ss=new WeakMap,Wy=new WeakMap,Ad=new WeakMap,Za=new WeakSet,Ic=function(i){const c=f=>{switch(i.type){case"failed":return{...f,fetchFailureCount:i.failureCount,fetchFailureReason:i.error};case"pause":return{...f,fetchStatus:"paused"};case"continue":return{...f,fetchStatus:"fetching"};case"fetch":return{...f,...P$(f.data,this.options),fetchMeta:i.meta??null};case"success":const _={...f,data:i.data,dataUpdateCount:f.dataUpdateCount+1,dataUpdatedAt:i.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!i.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return si(this,om,i.manual?_:void 0),_;case"error":const w=i.error;return{...f,error:w,errorUpdateCount:f.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:f.fetchFailureCount+1,fetchFailureReason:w,fetchStatus:"idle",status:"error"};case"invalidate":return{...f,isInvalidated:!0};case"setState":return{...f,...i.state}}};this.state=c(this.state),xo.batch(()=>{this.observers.forEach(f=>{f.onQueryUpdate()}),Mt(this,ba).notify({query:this,type:"updated",action:i})})},RL);function P$(t,i){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:x3(i.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Rk(t){const i=typeof t.initialData=="function"?t.initialData():t.initialData,c=i!==void 0,f=c?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:i,dataUpdateCount:0,dataUpdatedAt:c?f??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:c?"success":"pending",fetchStatus:"idle"}}function kk(t){return{onFetch:(i,c)=>{var N,V,H,ne,ce;const f=i.options,_=(H=(V=(N=i.fetchOptions)==null?void 0:N.meta)==null?void 0:V.fetchMore)==null?void 0:H.direction,w=((ne=i.state.data)==null?void 0:ne.pages)||[],E=((ce=i.state.data)==null?void 0:ce.pageParams)||[];let o={pages:[],pageParams:[]},k=0;const L=async()=>{let K=!1;const se=ae=>{Object.defineProperty(ae,"signal",{enumerable:!0,get:()=>(i.signal.aborted?K=!0:i.signal.addEventListener("abort",()=>{K=!0}),i.signal)})},Y=y3(i.options,i.fetchOptions),Q=async(ae,Te,Be)=>{if(K)return Promise.reject();if(Te==null&&ae.pages.length)return Promise.resolve(ae);const nt=(()=>{const xt={client:i.client,queryKey:i.queryKey,pageParam:Te,direction:Be?"backward":"forward",meta:i.options.meta};return se(xt),xt})(),Je=await Y(nt),{maxPages:Dt}=i.options,wt=Be?w$:x$;return{pages:wt(ae.pages,Je,Dt),pageParams:wt(ae.pageParams,Te,Dt)}};if(_&&w.length){const ae=_==="backward",Te=ae?M$:Dk,Be={pages:w,pageParams:E},et=Te(f,Be);o=await Q(Be,et,ae)}else{const ae=t??w.length;do{const Te=k===0?E[0]??f.initialPageParam:Dk(f,o);if(k>0&&Te==null)break;o=await Q(o,Te),k++}while(k<ae)}return o};i.options.persister?i.fetchFn=()=>{var K,se;return(se=(K=i.options).persister)==null?void 0:se.call(K,L,{client:i.client,queryKey:i.queryKey,meta:i.options.meta,signal:i.signal},c)}:i.fetchFn=L}}}function Dk(t,{pages:i,pageParams:c}){const f=i.length-1;return i.length>0?t.getNextPageParam(i[f],i,c[f],c):void 0}function M$(t,{pages:i,pageParams:c}){var f;return i.length>0?(f=t.getPreviousPageParam)==null?void 0:f.call(t,i[0],i,c[0],c):void 0}var qy,Ll,yo,Cd,zl,zu,kL,R$=(kL=class extends b3{constructor(i){super();Ni(this,zl);Ni(this,qy);Ni(this,Ll);Ni(this,yo);Ni(this,Cd);si(this,qy,i.client),this.mutationId=i.mutationId,si(this,yo,i.mutationCache),si(this,Ll,[]),this.state=i.state||k$(),this.setOptions(i.options),this.scheduleGc()}setOptions(i){this.options=i,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(i){Mt(this,Ll).includes(i)||(Mt(this,Ll).push(i),this.clearGcTimeout(),Mt(this,yo).notify({type:"observerAdded",mutation:this,observer:i}))}removeObserver(i){si(this,Ll,Mt(this,Ll).filter(c=>c!==i)),this.scheduleGc(),Mt(this,yo).notify({type:"observerRemoved",mutation:this,observer:i})}optionalRemove(){Mt(this,Ll).length||(this.state.status==="pending"?this.scheduleGc():Mt(this,yo).remove(this))}continue(){var i;return((i=Mt(this,Cd))==null?void 0:i.continue())??this.execute(this.state.variables)}async execute(i){var E,o,k,L,N,V,H,ne,ce,K,se,Y,Q,ae,Te,Be,et,nt,Je,Dt;const c=()=>{Hs(this,zl,zu).call(this,{type:"continue"})},f={client:Mt(this,qy),meta:this.options.meta,mutationKey:this.options.mutationKey};si(this,Cd,w3({fn:()=>this.options.mutationFn?this.options.mutationFn(i,f):Promise.reject(new Error("No mutationFn found")),onFail:(wt,xt)=>{Hs(this,zl,zu).call(this,{type:"failed",failureCount:wt,error:xt})},onPause:()=>{Hs(this,zl,zu).call(this,{type:"pause"})},onContinue:c,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Mt(this,yo).canRun(this)}));const _=this.state.status==="pending",w=!Mt(this,Cd).canStart();try{if(_)c();else{Hs(this,zl,zu).call(this,{type:"pending",variables:i,isPaused:w}),await((o=(E=Mt(this,yo).config).onMutate)==null?void 0:o.call(E,i,this,f));const xt=await((L=(k=this.options).onMutate)==null?void 0:L.call(k,i,f));xt!==this.state.context&&Hs(this,zl,zu).call(this,{type:"pending",context:xt,variables:i,isPaused:w})}const wt=await Mt(this,Cd).start();return await((V=(N=Mt(this,yo).config).onSuccess)==null?void 0:V.call(N,wt,i,this.state.context,this,f)),await((ne=(H=this.options).onSuccess)==null?void 0:ne.call(H,wt,i,this.state.context,f)),await((K=(ce=Mt(this,yo).config).onSettled)==null?void 0:K.call(ce,wt,null,this.state.variables,this.state.context,this,f)),await((Y=(se=this.options).onSettled)==null?void 0:Y.call(se,wt,null,i,this.state.context,f)),Hs(this,zl,zu).call(this,{type:"success",data:wt}),wt}catch(wt){try{throw await((ae=(Q=Mt(this,yo).config).onError)==null?void 0:ae.call(Q,wt,i,this.state.context,this,f)),await((Be=(Te=this.options).onError)==null?void 0:Be.call(Te,wt,i,this.state.context,f)),await((nt=(et=Mt(this,yo).config).onSettled)==null?void 0:nt.call(et,void 0,wt,this.state.variables,this.state.context,this,f)),await((Dt=(Je=this.options).onSettled)==null?void 0:Dt.call(Je,void 0,wt,i,this.state.context,f)),wt}finally{Hs(this,zl,zu).call(this,{type:"error",error:wt})}}finally{Mt(this,yo).runNext(this)}}},qy=new WeakMap,Ll=new WeakMap,yo=new WeakMap,Cd=new WeakMap,zl=new WeakSet,zu=function(i){const c=f=>{switch(i.type){case"failed":return{...f,failureCount:i.failureCount,failureReason:i.error};case"pause":return{...f,isPaused:!0};case"continue":return{...f,isPaused:!1};case"pending":return{...f,context:i.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:i.isPaused,status:"pending",variables:i.variables,submittedAt:Date.now()};case"success":return{...f,data:i.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...f,data:void 0,error:i.error,failureCount:f.failureCount+1,failureReason:i.error,isPaused:!1,status:"error"}}};this.state=c(this.state),xo.batch(()=>{Mt(this,Ll).forEach(f=>{f.onMutationUpdate(i)}),Mt(this,yo).notify({mutation:this,type:"updated",action:i})})},kL);function k$(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Pc,Xa,Zy,DL,D$=(DL=class extends iw{constructor(i={}){super();Ni(this,Pc);Ni(this,Xa);Ni(this,Zy);this.config=i,si(this,Pc,new Set),si(this,Xa,new Map),si(this,Zy,0)}build(i,c,f){const _=new R$({client:i,mutationCache:this,mutationId:++n0(this,Zy)._,options:i.defaultMutationOptions(c),state:f});return this.add(_),_}add(i){Mt(this,Pc).add(i);const c=x0(i);if(typeof c=="string"){const f=Mt(this,Xa).get(c);f?f.push(i):Mt(this,Xa).set(c,[i])}this.notify({type:"added",mutation:i})}remove(i){if(Mt(this,Pc).delete(i)){const c=x0(i);if(typeof c=="string"){const f=Mt(this,Xa).get(c);if(f)if(f.length>1){const _=f.indexOf(i);_!==-1&&f.splice(_,1)}else f[0]===i&&Mt(this,Xa).delete(c)}}this.notify({type:"removed",mutation:i})}canRun(i){const c=x0(i);if(typeof c=="string"){const f=Mt(this,Xa).get(c),_=f==null?void 0:f.find(w=>w.state.status==="pending");return!_||_===i}else return!0}runNext(i){var f;const c=x0(i);if(typeof c=="string"){const _=(f=Mt(this,Xa).get(c))==null?void 0:f.find(w=>w!==i&&w.state.isPaused);return(_==null?void 0:_.continue())??Promise.resolve()}else return Promise.resolve()}clear(){xo.batch(()=>{Mt(this,Pc).forEach(i=>{this.notify({type:"removed",mutation:i})}),Mt(this,Pc).clear(),Mt(this,Xa).clear()})}getAll(){return Array.from(Mt(this,Pc))}find(i){const c={exact:!0,...i};return this.getAll().find(f=>Ck(c,f))}findAll(i={}){return this.getAll().filter(c=>Ck(i,c))}notify(i){xo.batch(()=>{this.listeners.forEach(c=>{c(i)})})}resumePausedMutations(){const i=this.getAll().filter(c=>c.state.isPaused);return xo.batch(()=>Promise.all(i.map(c=>c.continue().catch(qa))))}},Pc=new WeakMap,Xa=new WeakMap,Zy=new WeakMap,DL);function x0(t){var i;return(i=t.options.scope)==null?void 0:i.id}var Ol,LL,L$=(LL=class extends iw{constructor(i={}){super();Ni(this,Ol);this.config=i,si(this,Ol,new Map)}build(i,c,f){const _=c.queryKey,w=c.queryHash??iI(_,c);let E=this.get(w);return E||(E=new C$({client:i,queryKey:_,queryHash:w,options:i.defaultQueryOptions(c),state:f,defaultOptions:i.getQueryDefaults(_)}),this.add(E)),E}add(i){Mt(this,Ol).has(i.queryHash)||(Mt(this,Ol).set(i.queryHash,i),this.notify({type:"added",query:i}))}remove(i){const c=Mt(this,Ol).get(i.queryHash);c&&(i.destroy(),c===i&&Mt(this,Ol).delete(i.queryHash),this.notify({type:"removed",query:i}))}clear(){xo.batch(()=>{this.getAll().forEach(i=>{this.remove(i)})})}get(i){return Mt(this,Ol).get(i)}getAll(){return[...Mt(this,Ol).values()]}find(i){const c={exact:!0,...i};return this.getAll().find(f=>Ak(c,f))}findAll(i={}){const c=this.getAll();return Object.keys(i).length>0?c.filter(f=>Ak(i,f)):c}notify(i){xo.batch(()=>{this.listeners.forEach(c=>{c(i)})})}onFocus(){xo.batch(()=>{this.getAll().forEach(i=>{i.onFocus()})})}onOnline(){xo.batch(()=>{this.getAll().forEach(i=>{i.onOnline()})})}},Ol=new WeakMap,LL),Vr,Hu,Wu,am,lm,qu,cm,um,zL,z$=(zL=class{constructor(t={}){Ni(this,Vr);Ni(this,Hu);Ni(this,Wu);Ni(this,am);Ni(this,lm);Ni(this,qu);Ni(this,cm);Ni(this,um);si(this,Vr,t.queryCache||new L$),si(this,Hu,t.mutationCache||new D$),si(this,Wu,t.defaultOptions||{}),si(this,am,new Map),si(this,lm,new Map),si(this,qu,0)}mount(){n0(this,qu)._++,Mt(this,qu)===1&&(si(this,cm,v3.subscribe(async t=>{t&&(await this.resumePausedMutations(),Mt(this,Vr).onFocus())})),si(this,um,w1.subscribe(async t=>{t&&(await this.resumePausedMutations(),Mt(this,Vr).onOnline())})))}unmount(){var t,i;n0(this,qu)._--,Mt(this,qu)===0&&((t=Mt(this,cm))==null||t.call(this),si(this,cm,void 0),(i=Mt(this,um))==null||i.call(this),si(this,um,void 0))}isFetching(t){return Mt(this,Vr).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return Mt(this,Hu).findAll({...t,status:"pending"}).length}getQueryData(t){var c;const i=this.defaultQueryOptions({queryKey:t});return(c=Mt(this,Vr).get(i.queryHash))==null?void 0:c.state.data}ensureQueryData(t){const i=this.defaultQueryOptions(t),c=Mt(this,Vr).build(this,i),f=c.state.data;return f===void 0?this.fetchQuery(t):(t.revalidateIfStale&&c.isStaleByTime(x2(i.staleTime,c))&&this.prefetchQuery(i),Promise.resolve(f))}getQueriesData(t){return Mt(this,Vr).findAll(t).map(({queryKey:i,state:c})=>{const f=c.data;return[i,f]})}setQueryData(t,i,c){const f=this.defaultQueryOptions({queryKey:t}),_=Mt(this,Vr).get(f.queryHash),w=_==null?void 0:_.state.data,E=f$(i,w);if(E!==void 0)return Mt(this,Vr).build(this,f).setData(E,{...c,manual:!0})}setQueriesData(t,i,c){return xo.batch(()=>Mt(this,Vr).findAll(t).map(({queryKey:f})=>[f,this.setQueryData(f,i,c)]))}getQueryState(t){var c;const i=this.defaultQueryOptions({queryKey:t});return(c=Mt(this,Vr).get(i.queryHash))==null?void 0:c.state}removeQueries(t){const i=Mt(this,Vr);xo.batch(()=>{i.findAll(t).forEach(c=>{i.remove(c)})})}resetQueries(t,i){const c=Mt(this,Vr);return xo.batch(()=>(c.findAll(t).forEach(f=>{f.reset()}),this.refetchQueries({type:"active",...t},i)))}cancelQueries(t,i={}){const c={revert:!0,...i},f=xo.batch(()=>Mt(this,Vr).findAll(t).map(_=>_.cancel(c)));return Promise.all(f).then(qa).catch(qa)}invalidateQueries(t,i={}){return xo.batch(()=>(Mt(this,Vr).findAll(t).forEach(c=>{c.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},i)))}refetchQueries(t,i={}){const c={...i,cancelRefetch:i.cancelRefetch??!0},f=xo.batch(()=>Mt(this,Vr).findAll(t).filter(_=>!_.isDisabled()&&!_.isStatic()).map(_=>{let w=_.fetch(void 0,c);return c.throwOnError||(w=w.catch(qa)),_.state.fetchStatus==="paused"?Promise.resolve():w}));return Promise.all(f).then(qa)}fetchQuery(t){const i=this.defaultQueryOptions(t);i.retry===void 0&&(i.retry=!1);const c=Mt(this,Vr).build(this,i);return c.isStaleByTime(x2(i.staleTime,c))?c.fetch(i):Promise.resolve(c.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(qa).catch(qa)}fetchInfiniteQuery(t){return t.behavior=kk(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(qa).catch(qa)}ensureInfiniteQueryData(t){return t.behavior=kk(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return w1.isOnline()?Mt(this,Hu).resumePausedMutations():Promise.resolve()}getQueryCache(){return Mt(this,Vr)}getMutationCache(){return Mt(this,Hu)}getDefaultOptions(){return Mt(this,Wu)}setDefaultOptions(t){si(this,Wu,t)}setQueryDefaults(t,i){Mt(this,am).set(Ly(t),{queryKey:t,defaultOptions:i})}getQueryDefaults(t){const i=[...Mt(this,am).values()],c={};return i.forEach(f=>{zy(t,f.queryKey)&&Object.assign(c,f.defaultOptions)}),c}setMutationDefaults(t,i){Mt(this,lm).set(Ly(t),{mutationKey:t,defaultOptions:i})}getMutationDefaults(t){const i=[...Mt(this,lm).values()],c={};return i.forEach(f=>{zy(t,f.mutationKey)&&Object.assign(c,f.defaultOptions)}),c}defaultQueryOptions(t){if(t._defaulted)return t;const i={...Mt(this,Wu).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return i.queryHash||(i.queryHash=iI(i.queryKey,i)),i.refetchOnReconnect===void 0&&(i.refetchOnReconnect=i.networkMode!=="always"),i.throwOnError===void 0&&(i.throwOnError=!!i.suspense),!i.networkMode&&i.persister&&(i.networkMode="offlineFirst"),i.queryFn===rI&&(i.enabled=!1),i}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...Mt(this,Wu).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){Mt(this,Vr).clear(),Mt(this,Hu).clear()}},Vr=new WeakMap,Hu=new WeakMap,Wu=new WeakMap,am=new WeakMap,lm=new WeakMap,qu=new WeakMap,cm=new WeakMap,um=new WeakMap,zL),O$=fe.createContext(void 0),F$=({client:t,children:i})=>(fe.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),B.jsx(O$.Provider,{value:t,children:i}));function T3(t){var i,c,f="";if(typeof t=="string"||typeof t=="number")f+=t;else if(typeof t=="object")if(Array.isArray(t)){var _=t.length;for(i=0;i<_;i++)t[i]&&(c=T3(t[i]))&&(f&&(f+=" "),f+=c)}else for(c in t)t[c]&&(f&&(f+=" "),f+=c);return f}function S3(){for(var t,i,c=0,f="",_=arguments.length;c<_;c++)(t=arguments[c])&&(i=T3(t))&&(f&&(f+=" "),f+=i);return f}const sI="-",N$=t=>{const i=j$(t),{conflictingClassGroups:c,conflictingClassGroupModifiers:f}=t;return{getClassGroupId:E=>{const o=E.split(sI);return o[0]===""&&o.length!==1&&o.shift(),E3(o,i)||B$(E)},getConflictingClassGroupIds:(E,o)=>{const k=c[E]||[];return o&&f[E]?[...k,...f[E]]:k}}},E3=(t,i)=>{var E;if(t.length===0)return i.classGroupId;const c=t[0],f=i.nextPart.get(c),_=f?E3(t.slice(1),f):void 0;if(_)return _;if(i.validators.length===0)return;const w=t.join(sI);return(E=i.validators.find(({validator:o})=>o(w)))==null?void 0:E.classGroupId},Lk=/^\[(.+)\]$/,B$=t=>{if(Lk.test(t)){const i=Lk.exec(t)[1],c=i==null?void 0:i.substring(0,i.indexOf(":"));if(c)return"arbitrary.."+c}},j$=t=>{const{theme:i,prefix:c}=t,f={nextPart:new Map,validators:[]};return U$(Object.entries(t.classGroups),c).forEach(([w,E])=>{T2(E,f,w,i)}),f},T2=(t,i,c,f)=>{t.forEach(_=>{if(typeof _=="string"){const w=_===""?i:zk(i,_);w.classGroupId=c;return}if(typeof _=="function"){if(V$(_)){T2(_(f),i,c,f);return}i.validators.push({validator:_,classGroupId:c});return}Object.entries(_).forEach(([w,E])=>{T2(E,zk(i,w),c,f)})})},zk=(t,i)=>{let c=t;return i.split(sI).forEach(f=>{c.nextPart.has(f)||c.nextPart.set(f,{nextPart:new Map,validators:[]}),c=c.nextPart.get(f)}),c},V$=t=>t.isThemeGetter,U$=(t,i)=>i?t.map(([c,f])=>{const _=f.map(w=>typeof w=="string"?i+w:typeof w=="object"?Object.fromEntries(Object.entries(w).map(([E,o])=>[i+E,o])):w);return[c,_]}):t,G$=t=>{if(t<1)return{get:()=>{},set:()=>{}};let i=0,c=new Map,f=new Map;const _=(w,E)=>{c.set(w,E),i++,i>t&&(i=0,f=c,c=new Map)};return{get(w){let E=c.get(w);if(E!==void 0)return E;if((E=f.get(w))!==void 0)return _(w,E),E},set(w,E){c.has(w)?c.set(w,E):_(w,E)}}},I3="!",$$=t=>{const{separator:i,experimentalParseClassName:c}=t,f=i.length===1,_=i[0],w=i.length,E=o=>{const k=[];let L=0,N=0,V;for(let se=0;se<o.length;se++){let Y=o[se];if(L===0){if(Y===_&&(f||o.slice(se,se+w)===i)){k.push(o.slice(N,se)),N=se+w;continue}if(Y==="/"){V=se;continue}}Y==="["?L++:Y==="]"&&L--}const H=k.length===0?o:o.substring(N),ne=H.startsWith(I3),ce=ne?H.substring(1):H,K=V&&V>N?V-N:void 0;return{modifiers:k,hasImportantModifier:ne,baseClassName:ce,maybePostfixModifierPosition:K}};return c?o=>c({className:o,parseClassName:E}):E},H$=t=>{if(t.length<=1)return t;const i=[];let c=[];return t.forEach(f=>{f[0]==="["?(i.push(...c.sort(),f),c=[]):c.push(f)}),i.push(...c.sort()),i},W$=t=>({cache:G$(t.cacheSize),parseClassName:$$(t),...N$(t)}),q$=/\s+/,Z$=(t,i)=>{const{parseClassName:c,getClassGroupId:f,getConflictingClassGroupIds:_}=i,w=[],E=t.trim().split(q$);let o="";for(let k=E.length-1;k>=0;k-=1){const L=E[k],{modifiers:N,hasImportantModifier:V,baseClassName:H,maybePostfixModifierPosition:ne}=c(L);let ce=!!ne,K=f(ce?H.substring(0,ne):H);if(!K){if(!ce){o=L+(o.length>0?" "+o:o);continue}if(K=f(H),!K){o=L+(o.length>0?" "+o:o);continue}ce=!1}const se=H$(N).join(":"),Y=V?se+I3:se,Q=Y+K;if(w.includes(Q))continue;w.push(Q);const ae=_(K,ce);for(let Te=0;Te<ae.length;++Te){const Be=ae[Te];w.push(Y+Be)}o=L+(o.length>0?" "+o:o)}return o};function X$(){let t=0,i,c,f="";for(;t<arguments.length;)(i=arguments[t++])&&(c=A3(i))&&(f&&(f+=" "),f+=c);return f}const A3=t=>{if(typeof t=="string")return t;let i,c="";for(let f=0;f<t.length;f++)t[f]&&(i=A3(t[f]))&&(c&&(c+=" "),c+=i);return c};function K$(t,...i){let c,f,_,w=E;function E(k){const L=i.reduce((N,V)=>V(N),t());return c=W$(L),f=c.cache.get,_=c.cache.set,w=o,o(k)}function o(k){const L=f(k);if(L)return L;const N=Z$(k,c);return _(k,N),N}return function(){return w(X$.apply(null,arguments))}}const br=t=>{const i=c=>c[t]||[];return i.isThemeGetter=!0,i},C3=/^\[(?:([a-z-]+):)?(.+)\]$/i,Y$=/^\d+\/\d+$/,J$=new Set(["px","full","screen"]),Q$=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,eH=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,tH=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,nH=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,iH=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ec=t=>Qp(t)||J$.has(t)||Y$.test(t),ku=t=>Cm(t,"length",hH),Qp=t=>!!t&&!Number.isNaN(Number(t)),ZT=t=>Cm(t,"number",Qp),N_=t=>!!t&&Number.isInteger(Number(t)),rH=t=>t.endsWith("%")&&Qp(t.slice(0,-1)),gi=t=>C3.test(t),Du=t=>Q$.test(t),sH=new Set(["length","size","percentage"]),oH=t=>Cm(t,sH,P3),aH=t=>Cm(t,"position",P3),lH=new Set(["image","url"]),cH=t=>Cm(t,lH,fH),uH=t=>Cm(t,"",dH),B_=()=>!0,Cm=(t,i,c)=>{const f=C3.exec(t);return f?f[1]?typeof i=="string"?f[1]===i:i.has(f[1]):c(f[2]):!1},hH=t=>eH.test(t)&&!tH.test(t),P3=()=>!1,dH=t=>nH.test(t),fH=t=>iH.test(t),pH=()=>{const t=br("colors"),i=br("spacing"),c=br("blur"),f=br("brightness"),_=br("borderColor"),w=br("borderRadius"),E=br("borderSpacing"),o=br("borderWidth"),k=br("contrast"),L=br("grayscale"),N=br("hueRotate"),V=br("invert"),H=br("gap"),ne=br("gradientColorStops"),ce=br("gradientColorStopPositions"),K=br("inset"),se=br("margin"),Y=br("opacity"),Q=br("padding"),ae=br("saturate"),Te=br("scale"),Be=br("sepia"),et=br("skew"),nt=br("space"),Je=br("translate"),Dt=()=>["auto","contain","none"],wt=()=>["auto","hidden","clip","visible","scroll"],xt=()=>["auto",gi,i],qt=()=>[gi,i],ln=()=>["",Ec,ku],Ht=()=>["auto",Qp,gi],cn=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],pn=()=>["solid","dashed","dotted","double","none"],Rn=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Nt=()=>["start","end","center","between","around","evenly","stretch"],sn=()=>["","0",gi],Tn=()=>["auto","avoid","all","avoid-page","page","left","right","column"],on=()=>[Qp,gi];return{cacheSize:500,separator:":",theme:{colors:[B_],spacing:[Ec,ku],blur:["none","",Du,gi],brightness:on(),borderColor:[t],borderRadius:["none","","full",Du,gi],borderSpacing:qt(),borderWidth:ln(),contrast:on(),grayscale:sn(),hueRotate:on(),invert:sn(),gap:qt(),gradientColorStops:[t],gradientColorStopPositions:[rH,ku],inset:xt(),margin:xt(),opacity:on(),padding:qt(),saturate:on(),scale:on(),sepia:sn(),skew:on(),space:qt(),translate:qt()},classGroups:{aspect:[{aspect:["auto","square","video",gi]}],container:["container"],columns:[{columns:[Du]}],"break-after":[{"break-after":Tn()}],"break-before":[{"break-before":Tn()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...cn(),gi]}],overflow:[{overflow:wt()}],"overflow-x":[{"overflow-x":wt()}],"overflow-y":[{"overflow-y":wt()}],overscroll:[{overscroll:Dt()}],"overscroll-x":[{"overscroll-x":Dt()}],"overscroll-y":[{"overscroll-y":Dt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[K]}],"inset-x":[{"inset-x":[K]}],"inset-y":[{"inset-y":[K]}],start:[{start:[K]}],end:[{end:[K]}],top:[{top:[K]}],right:[{right:[K]}],bottom:[{bottom:[K]}],left:[{left:[K]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",N_,gi]}],basis:[{basis:xt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",gi]}],grow:[{grow:sn()}],shrink:[{shrink:sn()}],order:[{order:["first","last","none",N_,gi]}],"grid-cols":[{"grid-cols":[B_]}],"col-start-end":[{col:["auto",{span:["full",N_,gi]},gi]}],"col-start":[{"col-start":Ht()}],"col-end":[{"col-end":Ht()}],"grid-rows":[{"grid-rows":[B_]}],"row-start-end":[{row:["auto",{span:[N_,gi]},gi]}],"row-start":[{"row-start":Ht()}],"row-end":[{"row-end":Ht()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",gi]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",gi]}],gap:[{gap:[H]}],"gap-x":[{"gap-x":[H]}],"gap-y":[{"gap-y":[H]}],"justify-content":[{justify:["normal",...Nt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Nt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Nt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[Q]}],px:[{px:[Q]}],py:[{py:[Q]}],ps:[{ps:[Q]}],pe:[{pe:[Q]}],pt:[{pt:[Q]}],pr:[{pr:[Q]}],pb:[{pb:[Q]}],pl:[{pl:[Q]}],m:[{m:[se]}],mx:[{mx:[se]}],my:[{my:[se]}],ms:[{ms:[se]}],me:[{me:[se]}],mt:[{mt:[se]}],mr:[{mr:[se]}],mb:[{mb:[se]}],ml:[{ml:[se]}],"space-x":[{"space-x":[nt]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[nt]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",gi,i]}],"min-w":[{"min-w":[gi,i,"min","max","fit"]}],"max-w":[{"max-w":[gi,i,"none","full","min","max","fit","prose",{screen:[Du]},Du]}],h:[{h:[gi,i,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[gi,i,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[gi,i,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[gi,i,"auto","min","max","fit"]}],"font-size":[{text:["base",Du,ku]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ZT]}],"font-family":[{font:[B_]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",gi]}],"line-clamp":[{"line-clamp":["none",Qp,ZT]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Ec,gi]}],"list-image":[{"list-image":["none",gi]}],"list-style-type":[{list:["none","disc","decimal",gi]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[Y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[Y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...pn(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Ec,ku]}],"underline-offset":[{"underline-offset":["auto",Ec,gi]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:qt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",gi]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",gi]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...cn(),aH]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",oH]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},cH]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[ce]}],"gradient-via-pos":[{via:[ce]}],"gradient-to-pos":[{to:[ce]}],"gradient-from":[{from:[ne]}],"gradient-via":[{via:[ne]}],"gradient-to":[{to:[ne]}],rounded:[{rounded:[w]}],"rounded-s":[{"rounded-s":[w]}],"rounded-e":[{"rounded-e":[w]}],"rounded-t":[{"rounded-t":[w]}],"rounded-r":[{"rounded-r":[w]}],"rounded-b":[{"rounded-b":[w]}],"rounded-l":[{"rounded-l":[w]}],"rounded-ss":[{"rounded-ss":[w]}],"rounded-se":[{"rounded-se":[w]}],"rounded-ee":[{"rounded-ee":[w]}],"rounded-es":[{"rounded-es":[w]}],"rounded-tl":[{"rounded-tl":[w]}],"rounded-tr":[{"rounded-tr":[w]}],"rounded-br":[{"rounded-br":[w]}],"rounded-bl":[{"rounded-bl":[w]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[Y]}],"border-style":[{border:[...pn(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Y]}],"divide-style":[{divide:pn()}],"border-color":[{border:[_]}],"border-color-x":[{"border-x":[_]}],"border-color-y":[{"border-y":[_]}],"border-color-s":[{"border-s":[_]}],"border-color-e":[{"border-e":[_]}],"border-color-t":[{"border-t":[_]}],"border-color-r":[{"border-r":[_]}],"border-color-b":[{"border-b":[_]}],"border-color-l":[{"border-l":[_]}],"divide-color":[{divide:[_]}],"outline-style":[{outline:["",...pn()]}],"outline-offset":[{"outline-offset":[Ec,gi]}],"outline-w":[{outline:[Ec,ku]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:ln()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[Y]}],"ring-offset-w":[{"ring-offset":[Ec,ku]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Du,uH]}],"shadow-color":[{shadow:[B_]}],opacity:[{opacity:[Y]}],"mix-blend":[{"mix-blend":[...Rn(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Rn()}],filter:[{filter:["","none"]}],blur:[{blur:[c]}],brightness:[{brightness:[f]}],contrast:[{contrast:[k]}],"drop-shadow":[{"drop-shadow":["","none",Du,gi]}],grayscale:[{grayscale:[L]}],"hue-rotate":[{"hue-rotate":[N]}],invert:[{invert:[V]}],saturate:[{saturate:[ae]}],sepia:[{sepia:[Be]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[c]}],"backdrop-brightness":[{"backdrop-brightness":[f]}],"backdrop-contrast":[{"backdrop-contrast":[k]}],"backdrop-grayscale":[{"backdrop-grayscale":[L]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[N]}],"backdrop-invert":[{"backdrop-invert":[V]}],"backdrop-opacity":[{"backdrop-opacity":[Y]}],"backdrop-saturate":[{"backdrop-saturate":[ae]}],"backdrop-sepia":[{"backdrop-sepia":[Be]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[E]}],"border-spacing-x":[{"border-spacing-x":[E]}],"border-spacing-y":[{"border-spacing-y":[E]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",gi]}],duration:[{duration:on()}],ease:[{ease:["linear","in","out","in-out",gi]}],delay:[{delay:on()}],animate:[{animate:["none","spin","ping","pulse","bounce",gi]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Te]}],"scale-x":[{"scale-x":[Te]}],"scale-y":[{"scale-y":[Te]}],rotate:[{rotate:[N_,gi]}],"translate-x":[{"translate-x":[Je]}],"translate-y":[{"translate-y":[Je]}],"skew-x":[{"skew-x":[et]}],"skew-y":[{"skew-y":[et]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",gi]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",gi]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":qt()}],"scroll-mx":[{"scroll-mx":qt()}],"scroll-my":[{"scroll-my":qt()}],"scroll-ms":[{"scroll-ms":qt()}],"scroll-me":[{"scroll-me":qt()}],"scroll-mt":[{"scroll-mt":qt()}],"scroll-mr":[{"scroll-mr":qt()}],"scroll-mb":[{"scroll-mb":qt()}],"scroll-ml":[{"scroll-ml":qt()}],"scroll-p":[{"scroll-p":qt()}],"scroll-px":[{"scroll-px":qt()}],"scroll-py":[{"scroll-py":qt()}],"scroll-ps":[{"scroll-ps":qt()}],"scroll-pe":[{"scroll-pe":qt()}],"scroll-pt":[{"scroll-pt":qt()}],"scroll-pr":[{"scroll-pr":qt()}],"scroll-pb":[{"scroll-pb":qt()}],"scroll-pl":[{"scroll-pl":qt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",gi]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[Ec,ku,ZT]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},mH=K$(pH);function or(...t){return mH(S3(t))}function Fd(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}function gH(t){const i={dining:"",gas:"",groceries:"",travel:"",shopping:"",entertainment:"",default:""};return i[t.toLowerCase()]||i.default}const $r=fe.forwardRef(({className:t,variant:i="default",size:c="default",...f},_)=>B.jsx("button",{className:or("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{"bg-primary text-primary-foreground hover:bg-primary/90":i==="default","bg-secondary text-secondary-foreground hover:bg-secondary/80":i==="secondary","border border-input bg-background hover:bg-accent hover:text-accent-foreground":i==="outline","hover:bg-accent hover:text-accent-foreground":i==="ghost","h-10 px-4 py-2":c==="default","h-9 rounded-md px-3":c==="sm","h-11 rounded-md px-8":c==="lg"},t),ref:_,...f}));$r.displayName="Button";const Ok=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,Fk=S3,M3=(t,i)=>c=>{var f;if((i==null?void 0:i.variants)==null)return Fk(t,c==null?void 0:c.class,c==null?void 0:c.className);const{variants:_,defaultVariants:w}=i,E=Object.keys(_).map(L=>{const N=c==null?void 0:c[L],V=w==null?void 0:w[L];if(N===null)return null;const H=Ok(N)||Ok(V);return _[L][H]}),o=c&&Object.entries(c).reduce((L,N)=>{let[V,H]=N;return H===void 0||(L[V]=H),L},{}),k=i==null||(f=i.compoundVariants)===null||f===void 0?void 0:f.reduce((L,N)=>{let{class:V,className:H,...ne}=N;return Object.entries(ne).every(ce=>{let[K,se]=ce;return Array.isArray(se)?se.includes({...w,...o}[K]):{...w,...o}[K]===se})?[...L,V,H]:L},[]);return Fk(t,E,k,c==null?void 0:c.class,c==null?void 0:c.className)},_H=M3("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Ks({className:t,variant:i,...c}){return B.jsx("div",{className:or(_H({variant:i}),t),...c})}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var yH={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vH=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),nr=(t,i)=>{const c=fe.forwardRef(({color:f="currentColor",size:_=24,strokeWidth:w=2,absoluteStrokeWidth:E,className:o="",children:k,...L},N)=>fe.createElement("svg",{ref:N,...yH,width:_,height:_,stroke:f,strokeWidth:E?Number(w)*24/Number(_):w,className:["lucide",`lucide-${vH(t)}`,o].join(" "),...L},[...i.map(([V,H])=>fe.createElement(V,H)),...Array.isArray(k)?k:[k]]));return c.displayName=`${t}`,c};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xH=nr("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const em=nr("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wH=nr("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nk=nr("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S2=nr("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bH=nr("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TH=nr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tm=nr("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b1=nr("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SH=nr("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EH=nr("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IH=nr("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AH=nr("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oI=nr("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CH=nr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PH=nr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MH=nr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oy=nr("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RH=nr("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kH=nr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bk=nr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T1=nr("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oh=nr("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ay=nr("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nd=nr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DH=nr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R3=nr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S1=nr("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),k3=fe.createContext({});function LH(t){const i=fe.useRef(null);return i.current===null&&(i.current=t()),i.current}const aI=fe.createContext(null),D3=fe.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function zH(t=!0){const i=fe.useContext(aI);if(i===null)return[!0,null];const{isPresent:c,onExitComplete:f,register:_}=i,w=fe.useId();fe.useEffect(()=>{t&&_(w)},[t]);const E=fe.useCallback(()=>t&&f&&f(w),[w,f,t]);return!c&&f?[!1,E]:[!0]}const lI=typeof window<"u",OH=lI?fe.useLayoutEffect:fe.useEffect,Qo=t=>t;let L3=Qo;function cI(t){let i;return()=>(i===void 0&&(i=t()),i)}const ym=(t,i,c)=>{const f=i-t;return f===0?1:(c-t)/f},Dc=t=>t*1e3,Lc=t=>t/1e3,FH={useManualTiming:!1};function NH(t){let i=new Set,c=new Set,f=!1,_=!1;const w=new WeakSet;let E={delta:0,timestamp:0,isProcessing:!1};function o(L){w.has(L)&&(k.schedule(L),t()),L(E)}const k={schedule:(L,N=!1,V=!1)=>{const ne=V&&f?i:c;return N&&w.add(L),ne.has(L)||ne.add(L),L},cancel:L=>{c.delete(L),w.delete(L)},process:L=>{if(E=L,f){_=!0;return}f=!0,[i,c]=[c,i],i.forEach(o),i.clear(),f=!1,_&&(_=!1,k.process(L))}};return k}const w0=["read","resolveKeyframes","update","preRender","render","postRender"],BH=40;function z3(t,i){let c=!1,f=!0;const _={delta:0,timestamp:0,isProcessing:!1},w=()=>c=!0,E=w0.reduce((Y,Q)=>(Y[Q]=NH(w),Y),{}),{read:o,resolveKeyframes:k,update:L,preRender:N,render:V,postRender:H}=E,ne=()=>{const Y=performance.now();c=!1,_.delta=f?1e3/60:Math.max(Math.min(Y-_.timestamp,BH),1),_.timestamp=Y,_.isProcessing=!0,o.process(_),k.process(_),L.process(_),N.process(_),V.process(_),H.process(_),_.isProcessing=!1,c&&i&&(f=!1,t(ne))},ce=()=>{c=!0,f=!0,_.isProcessing||t(ne)};return{schedule:w0.reduce((Y,Q)=>{const ae=E[Q];return Y[Q]=(Te,Be=!1,et=!1)=>(c||ce(),ae.schedule(Te,Be,et)),Y},{}),cancel:Y=>{for(let Q=0;Q<w0.length;Q++)E[w0[Q]].cancel(Y)},state:_,steps:E}}const{schedule:Er,cancel:ch,state:Ds,steps:XT}=z3(typeof requestAnimationFrame<"u"?requestAnimationFrame:Qo,!0),O3=fe.createContext({strict:!1}),jk={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},vm={};for(const t in jk)vm[t]={isEnabled:i=>jk[t].some(c=>!!i[c])};function jH(t){for(const i in t)vm[i]={...vm[i],...t[i]}}const VH=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function E1(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||VH.has(t)}let F3=t=>!E1(t);function UH(t){t&&(F3=i=>i.startsWith("on")?!E1(i):t(i))}try{UH(require("@emotion/is-prop-valid").default)}catch{}function GH(t,i,c){const f={};for(const _ in t)_==="values"&&typeof t.values=="object"||(F3(_)||c===!0&&E1(_)||!i&&!E1(_)||t.draggable&&_.startsWith("onDrag"))&&(f[_]=t[_]);return f}function $H(t){if(typeof Proxy>"u")return t;const i=new Map,c=(...f)=>t(...f);return new Proxy(c,{get:(f,_)=>_==="create"?t:(i.has(_)||i.set(_,t(_)),i.get(_))})}const sw=fe.createContext({});function Oy(t){return typeof t=="string"||Array.isArray(t)}function ow(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const uI=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],hI=["initial",...uI];function aw(t){return ow(t.animate)||hI.some(i=>Oy(t[i]))}function N3(t){return!!(aw(t)||t.variants)}function HH(t,i){if(aw(t)){const{initial:c,animate:f}=t;return{initial:c===!1||Oy(c)?c:void 0,animate:Oy(f)?f:void 0}}return t.inherit!==!1?i:{}}function WH(t){const{initial:i,animate:c}=HH(t,fe.useContext(sw));return fe.useMemo(()=>({initial:i,animate:c}),[Vk(i),Vk(c)])}function Vk(t){return Array.isArray(t)?t.join(" "):t}const qH=Symbol.for("motionComponentSymbol");function Vp(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function ZH(t,i,c){return fe.useCallback(f=>{f&&t.onMount&&t.onMount(f),i&&(f?i.mount(f):i.unmount()),c&&(typeof c=="function"?c(f):Vp(c)&&(c.current=f))},[i])}const dI=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),XH="framerAppearId",B3="data-"+dI(XH),{schedule:fI}=z3(queueMicrotask,!1),j3=fe.createContext({});function KH(t,i,c,f,_){var w,E;const{visualElement:o}=fe.useContext(sw),k=fe.useContext(O3),L=fe.useContext(aI),N=fe.useContext(D3).reducedMotion,V=fe.useRef(null);f=f||k.renderer,!V.current&&f&&(V.current=f(t,{visualState:i,parent:o,props:c,presenceContext:L,blockInitialAnimation:L?L.initial===!1:!1,reducedMotionConfig:N}));const H=V.current,ne=fe.useContext(j3);H&&!H.projection&&_&&(H.type==="html"||H.type==="svg")&&YH(V.current,c,_,ne);const ce=fe.useRef(!1);fe.useInsertionEffect(()=>{H&&ce.current&&H.update(c,L)});const K=c[B3],se=fe.useRef(!!K&&!(!((w=window.MotionHandoffIsComplete)===null||w===void 0)&&w.call(window,K))&&((E=window.MotionHasOptimisedAnimation)===null||E===void 0?void 0:E.call(window,K)));return OH(()=>{H&&(ce.current=!0,window.MotionIsMounted=!0,H.updateFeatures(),fI.render(H.render),se.current&&H.animationState&&H.animationState.animateChanges())}),fe.useEffect(()=>{H&&(!se.current&&H.animationState&&H.animationState.animateChanges(),se.current&&(queueMicrotask(()=>{var Y;(Y=window.MotionHandoffMarkAsComplete)===null||Y===void 0||Y.call(window,K)}),se.current=!1))}),H}function YH(t,i,c,f){const{layoutId:_,layout:w,drag:E,dragConstraints:o,layoutScroll:k,layoutRoot:L}=i;t.projection=new c(t.latestValues,i["data-framer-portal-id"]?void 0:V3(t.parent)),t.projection.setOptions({layoutId:_,layout:w,alwaysMeasureLayout:!!E||o&&Vp(o),visualElement:t,animationType:typeof w=="string"?w:"both",initialPromotionConfig:f,layoutScroll:k,layoutRoot:L})}function V3(t){if(t)return t.options.allowProjection!==!1?t.projection:V3(t.parent)}function JH({preloadedFeatures:t,createVisualElement:i,useRender:c,useVisualState:f,Component:_}){var w,E;t&&jH(t);function o(L,N){let V;const H={...fe.useContext(D3),...L,layoutId:QH(L)},{isStatic:ne}=H,ce=WH(L),K=f(L,ne);if(!ne&&lI){eW();const se=tW(H);V=se.MeasureLayout,ce.visualElement=KH(_,K,H,i,se.ProjectionNode)}return B.jsxs(sw.Provider,{value:ce,children:[V&&ce.visualElement?B.jsx(V,{visualElement:ce.visualElement,...H}):null,c(_,L,ZH(K,ce.visualElement,N),K,ne,ce.visualElement)]})}o.displayName=`motion.${typeof _=="string"?_:`create(${(E=(w=_.displayName)!==null&&w!==void 0?w:_.name)!==null&&E!==void 0?E:""})`}`;const k=fe.forwardRef(o);return k[qH]=_,k}function QH({layoutId:t}){const i=fe.useContext(k3).id;return i&&t!==void 0?i+"-"+t:t}function eW(t,i){fe.useContext(O3).strict}function tW(t){const{drag:i,layout:c}=vm;if(!i&&!c)return{};const f={...i,...c};return{MeasureLayout:i!=null&&i.isEnabled(t)||c!=null&&c.isEnabled(t)?f.MeasureLayout:void 0,ProjectionNode:f.ProjectionNode}}const nW=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function pI(t){return typeof t!="string"||t.includes("-")?!1:!!(nW.indexOf(t)>-1||/[A-Z]/u.test(t))}function Uk(t){const i=[{},{}];return t==null||t.values.forEach((c,f)=>{i[0][f]=c.get(),i[1][f]=c.getVelocity()}),i}function mI(t,i,c,f){if(typeof i=="function"){const[_,w]=Uk(f);i=i(c!==void 0?c:t.custom,_,w)}if(typeof i=="string"&&(i=t.variants&&t.variants[i]),typeof i=="function"){const[_,w]=Uk(f);i=i(c!==void 0?c:t.custom,_,w)}return i}const E2=t=>Array.isArray(t),iW=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),rW=t=>E2(t)?t[t.length-1]||0:t,Ys=t=>!!(t&&t.getVelocity);function G0(t){const i=Ys(t)?t.get():t;return iW(i)?i.toValue():i}function sW({scrapeMotionValuesFromProps:t,createRenderState:i,onUpdate:c},f,_,w){const E={latestValues:oW(f,_,w,t),renderState:i()};return c&&(E.onMount=o=>c({props:f,current:o,...E}),E.onUpdate=o=>c(o)),E}const U3=t=>(i,c)=>{const f=fe.useContext(sw),_=fe.useContext(aI),w=()=>sW(t,i,f,_);return c?w():LH(w)};function oW(t,i,c,f){const _={},w=f(t,{});for(const H in w)_[H]=G0(w[H]);let{initial:E,animate:o}=t;const k=aw(t),L=N3(t);i&&L&&!k&&t.inherit!==!1&&(E===void 0&&(E=i.initial),o===void 0&&(o=i.animate));let N=c?c.initial===!1:!1;N=N||E===!1;const V=N?o:E;if(V&&typeof V!="boolean"&&!ow(V)){const H=Array.isArray(V)?V:[V];for(let ne=0;ne<H.length;ne++){const ce=mI(t,H[ne]);if(ce){const{transitionEnd:K,transition:se,...Y}=ce;for(const Q in Y){let ae=Y[Q];if(Array.isArray(ae)){const Te=N?ae.length-1:0;ae=ae[Te]}ae!==null&&(_[Q]=ae)}for(const Q in K)_[Q]=K[Q]}}}return _}const Pm=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],$d=new Set(Pm),G3=t=>i=>typeof i=="string"&&i.startsWith(t),$3=G3("--"),aW=G3("var(--"),gI=t=>aW(t)?lW.test(t.split("/*")[0].trim()):!1,lW=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,H3=(t,i)=>i&&typeof t=="number"?i.transform(t):t,Bc=(t,i,c)=>c>i?i:c<t?t:c,Mm={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Fy={...Mm,transform:t=>Bc(0,1,t)},b0={...Mm,default:1},tv=t=>({test:i=>typeof i=="string"&&i.endsWith(t)&&i.split(" ").length===1,parse:parseFloat,transform:i=>`${i}${t}`}),Ou=tv("deg"),Gl=tv("%"),Hn=tv("px"),cW=tv("vh"),uW=tv("vw"),Gk={...Gl,parse:t=>Gl.parse(t)/100,transform:t=>Gl.transform(t*100)},hW={borderWidth:Hn,borderTopWidth:Hn,borderRightWidth:Hn,borderBottomWidth:Hn,borderLeftWidth:Hn,borderRadius:Hn,radius:Hn,borderTopLeftRadius:Hn,borderTopRightRadius:Hn,borderBottomRightRadius:Hn,borderBottomLeftRadius:Hn,width:Hn,maxWidth:Hn,height:Hn,maxHeight:Hn,top:Hn,right:Hn,bottom:Hn,left:Hn,padding:Hn,paddingTop:Hn,paddingRight:Hn,paddingBottom:Hn,paddingLeft:Hn,margin:Hn,marginTop:Hn,marginRight:Hn,marginBottom:Hn,marginLeft:Hn,backgroundPositionX:Hn,backgroundPositionY:Hn},dW={rotate:Ou,rotateX:Ou,rotateY:Ou,rotateZ:Ou,scale:b0,scaleX:b0,scaleY:b0,scaleZ:b0,skew:Ou,skewX:Ou,skewY:Ou,distance:Hn,translateX:Hn,translateY:Hn,translateZ:Hn,x:Hn,y:Hn,z:Hn,perspective:Hn,transformPerspective:Hn,opacity:Fy,originX:Gk,originY:Gk,originZ:Hn},$k={...Mm,transform:Math.round},_I={...hW,...dW,zIndex:$k,size:Hn,fillOpacity:Fy,strokeOpacity:Fy,numOctaves:$k},fW={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},pW=Pm.length;function mW(t,i,c){let f="",_=!0;for(let w=0;w<pW;w++){const E=Pm[w],o=t[E];if(o===void 0)continue;let k=!0;if(typeof o=="number"?k=o===(E.startsWith("scale")?1:0):k=parseFloat(o)===0,!k||c){const L=H3(o,_I[E]);if(!k){_=!1;const N=fW[E]||E;f+=`${N}(${L}) `}c&&(i[E]=L)}}return f=f.trim(),c?f=c(i,_?"":f):_&&(f="none"),f}function yI(t,i,c){const{style:f,vars:_,transformOrigin:w}=t;let E=!1,o=!1;for(const k in i){const L=i[k];if($d.has(k)){E=!0;continue}else if($3(k)){_[k]=L;continue}else{const N=H3(L,_I[k]);k.startsWith("origin")?(o=!0,w[k]=N):f[k]=N}}if(i.transform||(E||c?f.transform=mW(i,t.transform,c):f.transform&&(f.transform="none")),o){const{originX:k="50%",originY:L="50%",originZ:N=0}=w;f.transformOrigin=`${k} ${L} ${N}`}}const gW={offset:"stroke-dashoffset",array:"stroke-dasharray"},_W={offset:"strokeDashoffset",array:"strokeDasharray"};function yW(t,i,c=1,f=0,_=!0){t.pathLength=1;const w=_?gW:_W;t[w.offset]=Hn.transform(-f);const E=Hn.transform(i),o=Hn.transform(c);t[w.array]=`${E} ${o}`}function Hk(t,i,c){return typeof t=="string"?t:Hn.transform(i+c*t)}function vW(t,i,c){const f=Hk(i,t.x,t.width),_=Hk(c,t.y,t.height);return`${f} ${_}`}function vI(t,{attrX:i,attrY:c,attrScale:f,originX:_,originY:w,pathLength:E,pathSpacing:o=1,pathOffset:k=0,...L},N,V){if(yI(t,L,V),N){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:H,style:ne,dimensions:ce}=t;H.transform&&(ce&&(ne.transform=H.transform),delete H.transform),ce&&(_!==void 0||w!==void 0||ne.transform)&&(ne.transformOrigin=vW(ce,_!==void 0?_:.5,w!==void 0?w:.5)),i!==void 0&&(H.x=i),c!==void 0&&(H.y=c),f!==void 0&&(H.scale=f),E!==void 0&&yW(H,E,o,k,!1)}const xI=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),W3=()=>({...xI(),attrs:{}}),wI=t=>typeof t=="string"&&t.toLowerCase()==="svg";function q3(t,{style:i,vars:c},f,_){Object.assign(t.style,i,_&&_.getProjectionStyles(f));for(const w in c)t.style.setProperty(w,c[w])}const Z3=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function X3(t,i,c,f){q3(t,i,void 0,f);for(const _ in i.attrs)t.setAttribute(Z3.has(_)?_:dI(_),i.attrs[_])}const I1={};function xW(t){Object.assign(I1,t)}function K3(t,{layout:i,layoutId:c}){return $d.has(t)||t.startsWith("origin")||(i||c!==void 0)&&(!!I1[t]||t==="opacity")}function bI(t,i,c){var f;const{style:_}=t,w={};for(const E in _)(Ys(_[E])||i.style&&Ys(i.style[E])||K3(E,t)||((f=c==null?void 0:c.getValue(E))===null||f===void 0?void 0:f.liveStyle)!==void 0)&&(w[E]=_[E]);return w}function Y3(t,i,c){const f=bI(t,i,c);for(const _ in t)if(Ys(t[_])||Ys(i[_])){const w=Pm.indexOf(_)!==-1?"attr"+_.charAt(0).toUpperCase()+_.substring(1):_;f[w]=t[_]}return f}function wW(t,i){try{i.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{i.dimensions={x:0,y:0,width:0,height:0}}}const Wk=["x","y","width","height","cx","cy","r"],bW={useVisualState:U3({scrapeMotionValuesFromProps:Y3,createRenderState:W3,onUpdate:({props:t,prevProps:i,current:c,renderState:f,latestValues:_})=>{if(!c)return;let w=!!t.drag;if(!w){for(const o in _)if($d.has(o)){w=!0;break}}if(!w)return;let E=!i;if(i)for(let o=0;o<Wk.length;o++){const k=Wk[o];t[k]!==i[k]&&(E=!0)}E&&Er.read(()=>{wW(c,f),Er.render(()=>{vI(f,_,wI(c.tagName),t.transformTemplate),X3(c,f)})})}})},TW={useVisualState:U3({scrapeMotionValuesFromProps:bI,createRenderState:xI})};function J3(t,i,c){for(const f in i)!Ys(i[f])&&!K3(f,c)&&(t[f]=i[f])}function SW({transformTemplate:t},i){return fe.useMemo(()=>{const c=xI();return yI(c,i,t),Object.assign({},c.vars,c.style)},[i])}function EW(t,i){const c=t.style||{},f={};return J3(f,c,t),Object.assign(f,SW(t,i)),f}function IW(t,i){const c={},f=EW(t,i);return t.drag&&t.dragListener!==!1&&(c.draggable=!1,f.userSelect=f.WebkitUserSelect=f.WebkitTouchCallout="none",f.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(c.tabIndex=0),c.style=f,c}function AW(t,i,c,f){const _=fe.useMemo(()=>{const w=W3();return vI(w,i,wI(f),t.transformTemplate),{...w.attrs,style:{...w.style}}},[i]);if(t.style){const w={};J3(w,t.style,t),_.style={...w,..._.style}}return _}function CW(t=!1){return(c,f,_,{latestValues:w},E)=>{const k=(pI(c)?AW:IW)(f,w,E,c),L=GH(f,typeof c=="string",t),N=c!==fe.Fragment?{...L,...k,ref:_}:{},{children:V}=f,H=fe.useMemo(()=>Ys(V)?V.get():V,[V]);return fe.createElement(c,{...N,children:H})}}function PW(t,i){return function(f,{forwardMotionProps:_}={forwardMotionProps:!1}){const E={...pI(f)?bW:TW,preloadedFeatures:t,useRender:CW(_),createVisualElement:i,Component:f};return JH(E)}}function Q3(t,i){if(!Array.isArray(i))return!1;const c=i.length;if(c!==t.length)return!1;for(let f=0;f<c;f++)if(i[f]!==t[f])return!1;return!0}function lw(t,i,c){const f=t.getProps();return mI(f,i,c!==void 0?c:f.custom,t)}const MW=cI(()=>window.ScrollTimeline!==void 0);class RW{constructor(i){this.stop=()=>this.runAll("stop"),this.animations=i.filter(Boolean)}get finished(){return Promise.all(this.animations.map(i=>"finished"in i?i.finished:i))}getAll(i){return this.animations[0][i]}setAll(i,c){for(let f=0;f<this.animations.length;f++)this.animations[f][i]=c}attachTimeline(i,c){const f=this.animations.map(_=>{if(MW()&&_.attachTimeline)return _.attachTimeline(i);if(typeof c=="function")return c(_)});return()=>{f.forEach((_,w)=>{_&&_(),this.animations[w].stop()})}}get time(){return this.getAll("time")}set time(i){this.setAll("time",i)}get speed(){return this.getAll("speed")}set speed(i){this.setAll("speed",i)}get startTime(){return this.getAll("startTime")}get duration(){let i=0;for(let c=0;c<this.animations.length;c++)i=Math.max(i,this.animations[c].duration);return i}runAll(i){this.animations.forEach(c=>c[i]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class kW extends RW{then(i,c){return Promise.all(this.animations).then(i).catch(c)}}function TI(t,i){return t?t[i]||t.default||t:void 0}const I2=2e4;function eF(t){let i=0;const c=50;let f=t.next(i);for(;!f.done&&i<I2;)i+=c,f=t.next(i);return i>=I2?1/0:i}function SI(t){return typeof t=="function"}function qk(t,i){t.timeline=i,t.onfinish=null}const EI=t=>Array.isArray(t)&&typeof t[0]=="number",DW={linearEasing:void 0};function LW(t,i){const c=cI(t);return()=>{var f;return(f=DW[i])!==null&&f!==void 0?f:c()}}const A1=LW(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),tF=(t,i,c=10)=>{let f="";const _=Math.max(Math.round(i/c),2);for(let w=0;w<_;w++)f+=t(ym(0,_-1,w))+", ";return`linear(${f.substring(0,f.length-2)})`};function nF(t){return!!(typeof t=="function"&&A1()||!t||typeof t=="string"&&(t in A2||A1())||EI(t)||Array.isArray(t)&&t.every(nF))}const H_=([t,i,c,f])=>`cubic-bezier(${t}, ${i}, ${c}, ${f})`,A2={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:H_([0,.65,.55,1]),circOut:H_([.55,0,1,.45]),backIn:H_([.31,.01,.66,-.59]),backOut:H_([.33,1.53,.69,.99])};function iF(t,i){if(t)return typeof t=="function"&&A1()?tF(t,i):EI(t)?H_(t):Array.isArray(t)?t.map(c=>iF(c,i)||A2.easeOut):A2[t]}const Ha={x:!1,y:!1};function rF(){return Ha.x||Ha.y}function zW(t,i,c){var f;if(t instanceof Element)return[t];if(typeof t=="string"){let _=document;const w=(f=void 0)!==null&&f!==void 0?f:_.querySelectorAll(t);return w?Array.from(w):[]}return Array.from(t)}function sF(t,i){const c=zW(t),f=new AbortController,_={passive:!0,...i,signal:f.signal};return[c,_,()=>f.abort()]}function Zk(t){return i=>{i.pointerType==="touch"||rF()||t(i)}}function OW(t,i,c={}){const[f,_,w]=sF(t,c),E=Zk(o=>{const{target:k}=o,L=i(o);if(typeof L!="function"||!k)return;const N=Zk(V=>{L(V),k.removeEventListener("pointerleave",N)});k.addEventListener("pointerleave",N,_)});return f.forEach(o=>{o.addEventListener("pointerenter",E,_)}),w}const oF=(t,i)=>i?t===i?!0:oF(t,i.parentElement):!1,II=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,FW=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function NW(t){return FW.has(t.tagName)||t.tabIndex!==-1}const W_=new WeakSet;function Xk(t){return i=>{i.key==="Enter"&&t(i)}}function KT(t,i){t.dispatchEvent(new PointerEvent("pointer"+i,{isPrimary:!0,bubbles:!0}))}const BW=(t,i)=>{const c=t.currentTarget;if(!c)return;const f=Xk(()=>{if(W_.has(c))return;KT(c,"down");const _=Xk(()=>{KT(c,"up")}),w=()=>KT(c,"cancel");c.addEventListener("keyup",_,i),c.addEventListener("blur",w,i)});c.addEventListener("keydown",f,i),c.addEventListener("blur",()=>c.removeEventListener("keydown",f),i)};function Kk(t){return II(t)&&!rF()}function jW(t,i,c={}){const[f,_,w]=sF(t,c),E=o=>{const k=o.currentTarget;if(!Kk(o)||W_.has(k))return;W_.add(k);const L=i(o),N=(ne,ce)=>{window.removeEventListener("pointerup",V),window.removeEventListener("pointercancel",H),!(!Kk(ne)||!W_.has(k))&&(W_.delete(k),typeof L=="function"&&L(ne,{success:ce}))},V=ne=>{N(ne,c.useGlobalTarget||oF(k,ne.target))},H=ne=>{N(ne,!1)};window.addEventListener("pointerup",V,_),window.addEventListener("pointercancel",H,_)};return f.forEach(o=>{!NW(o)&&o.getAttribute("tabindex")===null&&(o.tabIndex=0),(c.useGlobalTarget?window:o).addEventListener("pointerdown",E,_),o.addEventListener("focus",L=>BW(L,_),_)}),w}function VW(t){return t==="x"||t==="y"?Ha[t]?null:(Ha[t]=!0,()=>{Ha[t]=!1}):Ha.x||Ha.y?null:(Ha.x=Ha.y=!0,()=>{Ha.x=Ha.y=!1})}const aF=new Set(["width","height","top","left","right","bottom",...Pm]);let $0;function UW(){$0=void 0}const $l={now:()=>($0===void 0&&$l.set(Ds.isProcessing||FH.useManualTiming?Ds.timestamp:performance.now()),$0),set:t=>{$0=t,queueMicrotask(UW)}};function AI(t,i){t.indexOf(i)===-1&&t.push(i)}function CI(t,i){const c=t.indexOf(i);c>-1&&t.splice(c,1)}class PI{constructor(){this.subscriptions=[]}add(i){return AI(this.subscriptions,i),()=>CI(this.subscriptions,i)}notify(i,c,f){const _=this.subscriptions.length;if(_)if(_===1)this.subscriptions[0](i,c,f);else for(let w=0;w<_;w++){const E=this.subscriptions[w];E&&E(i,c,f)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function lF(t,i){return i?t*(1e3/i):0}const Yk=30,GW=t=>!isNaN(parseFloat(t));class $W{constructor(i,c={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(f,_=!0)=>{const w=$l.now();this.updatedAt!==w&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(f),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),_&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(i),this.owner=c.owner}setCurrent(i){this.current=i,this.updatedAt=$l.now(),this.canTrackVelocity===null&&i!==void 0&&(this.canTrackVelocity=GW(this.current))}setPrevFrameValue(i=this.current){this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt}onChange(i){return this.on("change",i)}on(i,c){this.events[i]||(this.events[i]=new PI);const f=this.events[i].add(c);return i==="change"?()=>{f(),Er.read(()=>{this.events.change.getSize()||this.stop()})}:f}clearListeners(){for(const i in this.events)this.events[i].clear()}attach(i,c){this.passiveEffect=i,this.stopPassiveEffect=c}set(i,c=!0){!c||!this.passiveEffect?this.updateAndNotify(i,c):this.passiveEffect(i,this.updateAndNotify)}setWithVelocity(i,c,f){this.set(c),this.prev=void 0,this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt-f}jump(i,c=!0){this.updateAndNotify(i),this.prev=i,this.prevUpdatedAt=this.prevFrameValue=void 0,c&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const i=$l.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||i-this.updatedAt>Yk)return 0;const c=Math.min(this.updatedAt-this.prevUpdatedAt,Yk);return lF(parseFloat(this.current)-parseFloat(this.prevFrameValue),c)}start(i){return this.stop(),new Promise(c=>{this.hasAnimated=!0,this.animation=i(c),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Ny(t,i){return new $W(t,i)}function HW(t,i,c){t.hasValue(i)?t.getValue(i).set(c):t.addValue(i,Ny(c))}function WW(t,i){const c=lw(t,i);let{transitionEnd:f={},transition:_={},...w}=c||{};w={...w,...f};for(const E in w){const o=rW(w[E]);HW(t,E,o)}}function qW(t){return!!(Ys(t)&&t.add)}function C2(t,i){const c=t.getValue("willChange");if(qW(c))return c.add(i)}function cF(t){return t.props[B3]}const uF=(t,i,c)=>(((1-3*c+3*i)*t+(3*c-6*i))*t+3*i)*t,ZW=1e-7,XW=12;function KW(t,i,c,f,_){let w,E,o=0;do E=i+(c-i)/2,w=uF(E,f,_)-t,w>0?c=E:i=E;while(Math.abs(w)>ZW&&++o<XW);return E}function nv(t,i,c,f){if(t===i&&c===f)return Qo;const _=w=>KW(w,0,1,t,c);return w=>w===0||w===1?w:uF(_(w),i,f)}const hF=t=>i=>i<=.5?t(2*i)/2:(2-t(2*(1-i)))/2,dF=t=>i=>1-t(1-i),fF=nv(.33,1.53,.69,.99),MI=dF(fF),pF=hF(MI),mF=t=>(t*=2)<1?.5*MI(t):.5*(2-Math.pow(2,-10*(t-1))),RI=t=>1-Math.sin(Math.acos(t)),gF=dF(RI),_F=hF(RI),yF=t=>/^0[^.\s]+$/u.test(t);function YW(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||yF(t):!0}const ly=t=>Math.round(t*1e5)/1e5,kI=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function JW(t){return t==null}const QW=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,DI=(t,i)=>c=>!!(typeof c=="string"&&QW.test(c)&&c.startsWith(t)||i&&!JW(c)&&Object.prototype.hasOwnProperty.call(c,i)),vF=(t,i,c)=>f=>{if(typeof f!="string")return f;const[_,w,E,o]=f.match(kI);return{[t]:parseFloat(_),[i]:parseFloat(w),[c]:parseFloat(E),alpha:o!==void 0?parseFloat(o):1}},eq=t=>Bc(0,255,t),YT={...Mm,transform:t=>Math.round(eq(t))},bd={test:DI("rgb","red"),parse:vF("red","green","blue"),transform:({red:t,green:i,blue:c,alpha:f=1})=>"rgba("+YT.transform(t)+", "+YT.transform(i)+", "+YT.transform(c)+", "+ly(Fy.transform(f))+")"};function tq(t){let i="",c="",f="",_="";return t.length>5?(i=t.substring(1,3),c=t.substring(3,5),f=t.substring(5,7),_=t.substring(7,9)):(i=t.substring(1,2),c=t.substring(2,3),f=t.substring(3,4),_=t.substring(4,5),i+=i,c+=c,f+=f,_+=_),{red:parseInt(i,16),green:parseInt(c,16),blue:parseInt(f,16),alpha:_?parseInt(_,16)/255:1}}const P2={test:DI("#"),parse:tq,transform:bd.transform},Up={test:DI("hsl","hue"),parse:vF("hue","saturation","lightness"),transform:({hue:t,saturation:i,lightness:c,alpha:f=1})=>"hsla("+Math.round(t)+", "+Gl.transform(ly(i))+", "+Gl.transform(ly(c))+", "+ly(Fy.transform(f))+")"},Zs={test:t=>bd.test(t)||P2.test(t)||Up.test(t),parse:t=>bd.test(t)?bd.parse(t):Up.test(t)?Up.parse(t):P2.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?bd.transform(t):Up.transform(t)},nq=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function iq(t){var i,c;return isNaN(t)&&typeof t=="string"&&(((i=t.match(kI))===null||i===void 0?void 0:i.length)||0)+(((c=t.match(nq))===null||c===void 0?void 0:c.length)||0)>0}const xF="number",wF="color",rq="var",sq="var(",Jk="${}",oq=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function By(t){const i=t.toString(),c=[],f={color:[],number:[],var:[]},_=[];let w=0;const o=i.replace(oq,k=>(Zs.test(k)?(f.color.push(w),_.push(wF),c.push(Zs.parse(k))):k.startsWith(sq)?(f.var.push(w),_.push(rq),c.push(k)):(f.number.push(w),_.push(xF),c.push(parseFloat(k))),++w,Jk)).split(Jk);return{values:c,split:o,indexes:f,types:_}}function bF(t){return By(t).values}function TF(t){const{split:i,types:c}=By(t),f=i.length;return _=>{let w="";for(let E=0;E<f;E++)if(w+=i[E],_[E]!==void 0){const o=c[E];o===xF?w+=ly(_[E]):o===wF?w+=Zs.transform(_[E]):w+=_[E]}return w}}const aq=t=>typeof t=="number"?0:t;function lq(t){const i=bF(t);return TF(t)(i.map(aq))}const uh={test:iq,parse:bF,createTransformer:TF,getAnimatableNone:lq},cq=new Set(["brightness","contrast","saturate","opacity"]);function uq(t){const[i,c]=t.slice(0,-1).split("(");if(i==="drop-shadow")return t;const[f]=c.match(kI)||[];if(!f)return t;const _=c.replace(f,"");let w=cq.has(i)?1:0;return f!==c&&(w*=100),i+"("+w+_+")"}const hq=/\b([a-z-]*)\(.*?\)/gu,M2={...uh,getAnimatableNone:t=>{const i=t.match(hq);return i?i.map(uq).join(" "):t}},dq={..._I,color:Zs,backgroundColor:Zs,outlineColor:Zs,fill:Zs,stroke:Zs,borderColor:Zs,borderTopColor:Zs,borderRightColor:Zs,borderBottomColor:Zs,borderLeftColor:Zs,filter:M2,WebkitFilter:M2},LI=t=>dq[t];function SF(t,i){let c=LI(t);return c!==M2&&(c=uh),c.getAnimatableNone?c.getAnimatableNone(i):void 0}const fq=new Set(["auto","none","0"]);function pq(t,i,c){let f=0,_;for(;f<t.length&&!_;){const w=t[f];typeof w=="string"&&!fq.has(w)&&By(w).values.length&&(_=t[f]),f++}if(_&&c)for(const w of i)t[w]=SF(c,_)}const Qk=t=>t===Mm||t===Hn,eD=(t,i)=>parseFloat(t.split(", ")[i]),tD=(t,i)=>(c,{transform:f})=>{if(f==="none"||!f)return 0;const _=f.match(/^matrix3d\((.+)\)$/u);if(_)return eD(_[1],i);{const w=f.match(/^matrix\((.+)\)$/u);return w?eD(w[1],t):0}},mq=new Set(["x","y","z"]),gq=Pm.filter(t=>!mq.has(t));function _q(t){const i=[];return gq.forEach(c=>{const f=t.getValue(c);f!==void 0&&(i.push([c,f.get()]),f.set(c.startsWith("scale")?1:0))}),i}const xm={width:({x:t},{paddingLeft:i="0",paddingRight:c="0"})=>t.max-t.min-parseFloat(i)-parseFloat(c),height:({y:t},{paddingTop:i="0",paddingBottom:c="0"})=>t.max-t.min-parseFloat(i)-parseFloat(c),top:(t,{top:i})=>parseFloat(i),left:(t,{left:i})=>parseFloat(i),bottom:({y:t},{top:i})=>parseFloat(i)+(t.max-t.min),right:({x:t},{left:i})=>parseFloat(i)+(t.max-t.min),x:tD(4,13),y:tD(5,14)};xm.translateX=xm.x;xm.translateY=xm.y;const Rd=new Set;let R2=!1,k2=!1;function EF(){if(k2){const t=Array.from(Rd).filter(f=>f.needsMeasurement),i=new Set(t.map(f=>f.element)),c=new Map;i.forEach(f=>{const _=_q(f);_.length&&(c.set(f,_),f.render())}),t.forEach(f=>f.measureInitialState()),i.forEach(f=>{f.render();const _=c.get(f);_&&_.forEach(([w,E])=>{var o;(o=f.getValue(w))===null||o===void 0||o.set(E)})}),t.forEach(f=>f.measureEndState()),t.forEach(f=>{f.suspendedScrollY!==void 0&&window.scrollTo(0,f.suspendedScrollY)})}k2=!1,R2=!1,Rd.forEach(t=>t.complete()),Rd.clear()}function IF(){Rd.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(k2=!0)})}function yq(){IF(),EF()}class zI{constructor(i,c,f,_,w,E=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...i],this.onComplete=c,this.name=f,this.motionValue=_,this.element=w,this.isAsync=E}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Rd.add(this),R2||(R2=!0,Er.read(IF),Er.resolveKeyframes(EF))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:i,name:c,element:f,motionValue:_}=this;for(let w=0;w<i.length;w++)if(i[w]===null)if(w===0){const E=_==null?void 0:_.get(),o=i[i.length-1];if(E!==void 0)i[0]=E;else if(f&&c){const k=f.readValue(c,o);k!=null&&(i[0]=k)}i[0]===void 0&&(i[0]=o),_&&E===void 0&&_.set(i[0])}else i[w]=i[w-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Rd.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Rd.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const AF=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t),vq=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function xq(t){const i=vq.exec(t);if(!i)return[,];const[,c,f,_]=i;return[`--${c??f}`,_]}function CF(t,i,c=1){const[f,_]=xq(t);if(!f)return;const w=window.getComputedStyle(i).getPropertyValue(f);if(w){const E=w.trim();return AF(E)?parseFloat(E):E}return gI(_)?CF(_,i,c+1):_}const PF=t=>i=>i.test(t),wq={test:t=>t==="auto",parse:t=>t},MF=[Mm,Hn,Gl,Ou,uW,cW,wq],nD=t=>MF.find(PF(t));class RF extends zI{constructor(i,c,f,_,w){super(i,c,f,_,w,!0)}readKeyframes(){const{unresolvedKeyframes:i,element:c,name:f}=this;if(!c||!c.current)return;super.readKeyframes();for(let k=0;k<i.length;k++){let L=i[k];if(typeof L=="string"&&(L=L.trim(),gI(L))){const N=CF(L,c.current);N!==void 0&&(i[k]=N),k===i.length-1&&(this.finalKeyframe=L)}}if(this.resolveNoneKeyframes(),!aF.has(f)||i.length!==2)return;const[_,w]=i,E=nD(_),o=nD(w);if(E!==o)if(Qk(E)&&Qk(o))for(let k=0;k<i.length;k++){const L=i[k];typeof L=="string"&&(i[k]=parseFloat(L))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:i,name:c}=this,f=[];for(let _=0;_<i.length;_++)YW(i[_])&&f.push(_);f.length&&pq(i,f,c)}measureInitialState(){const{element:i,unresolvedKeyframes:c,name:f}=this;if(!i||!i.current)return;f==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=xm[f](i.measureViewportBox(),window.getComputedStyle(i.current)),c[0]=this.measuredOrigin;const _=c[c.length-1];_!==void 0&&i.getValue(f,_).jump(_,!1)}measureEndState(){var i;const{element:c,name:f,unresolvedKeyframes:_}=this;if(!c||!c.current)return;const w=c.getValue(f);w&&w.jump(this.measuredOrigin,!1);const E=_.length-1,o=_[E];_[E]=xm[f](c.measureViewportBox(),window.getComputedStyle(c.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),!((i=this.removedTransforms)===null||i===void 0)&&i.length&&this.removedTransforms.forEach(([k,L])=>{c.getValue(k).set(L)}),this.resolveNoneKeyframes()}}const iD=(t,i)=>i==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(uh.test(t)||t==="0")&&!t.startsWith("url("));function bq(t){const i=t[0];if(t.length===1)return!0;for(let c=0;c<t.length;c++)if(t[c]!==i)return!0}function Tq(t,i,c,f){const _=t[0];if(_===null)return!1;if(i==="display"||i==="visibility")return!0;const w=t[t.length-1],E=iD(_,i),o=iD(w,i);return!E||!o?!1:bq(t)||(c==="spring"||SI(c))&&f}const Sq=t=>t!==null;function cw(t,{repeat:i,repeatType:c="loop"},f){const _=t.filter(Sq),w=i&&c!=="loop"&&i%2===1?0:_.length-1;return!w||f===void 0?_[w]:f}const Eq=40;class kF{constructor({autoplay:i=!0,delay:c=0,type:f="keyframes",repeat:_=0,repeatDelay:w=0,repeatType:E="loop",...o}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=$l.now(),this.options={autoplay:i,delay:c,type:f,repeat:_,repeatDelay:w,repeatType:E,...o},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>Eq?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&yq(),this._resolved}onKeyframesResolved(i,c){this.resolvedAt=$l.now(),this.hasAttemptedResolve=!0;const{name:f,type:_,velocity:w,delay:E,onComplete:o,onUpdate:k,isGenerator:L}=this.options;if(!L&&!Tq(i,f,_,w))if(E)this.options.duration=0;else{k&&k(cw(i,this.options,c)),o&&o(),this.resolveFinishedPromise();return}const N=this.initPlayback(i,c);N!==!1&&(this._resolved={keyframes:i,finalKeyframe:c,...N},this.onPostResolved())}onPostResolved(){}then(i,c){return this.currentFinishedPromise.then(i,c)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(i=>{this.resolveFinishedPromise=i})}}const Lr=(t,i,c)=>t+(i-t)*c;function JT(t,i,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?t+(i-t)*6*c:c<1/2?i:c<2/3?t+(i-t)*(2/3-c)*6:t}function Iq({hue:t,saturation:i,lightness:c,alpha:f}){t/=360,i/=100,c/=100;let _=0,w=0,E=0;if(!i)_=w=E=c;else{const o=c<.5?c*(1+i):c+i-c*i,k=2*c-o;_=JT(k,o,t+1/3),w=JT(k,o,t),E=JT(k,o,t-1/3)}return{red:Math.round(_*255),green:Math.round(w*255),blue:Math.round(E*255),alpha:f}}function C1(t,i){return c=>c>0?i:t}const QT=(t,i,c)=>{const f=t*t,_=c*(i*i-f)+f;return _<0?0:Math.sqrt(_)},Aq=[P2,bd,Up],Cq=t=>Aq.find(i=>i.test(t));function rD(t){const i=Cq(t);if(!i)return!1;let c=i.parse(t);return i===Up&&(c=Iq(c)),c}const sD=(t,i)=>{const c=rD(t),f=rD(i);if(!c||!f)return C1(t,i);const _={...c};return w=>(_.red=QT(c.red,f.red,w),_.green=QT(c.green,f.green,w),_.blue=QT(c.blue,f.blue,w),_.alpha=Lr(c.alpha,f.alpha,w),bd.transform(_))},Pq=(t,i)=>c=>i(t(c)),iv=(...t)=>t.reduce(Pq),D2=new Set(["none","hidden"]);function Mq(t,i){return D2.has(t)?c=>c<=0?t:i:c=>c>=1?i:t}function Rq(t,i){return c=>Lr(t,i,c)}function OI(t){return typeof t=="number"?Rq:typeof t=="string"?gI(t)?C1:Zs.test(t)?sD:Lq:Array.isArray(t)?DF:typeof t=="object"?Zs.test(t)?sD:kq:C1}function DF(t,i){const c=[...t],f=c.length,_=t.map((w,E)=>OI(w)(w,i[E]));return w=>{for(let E=0;E<f;E++)c[E]=_[E](w);return c}}function kq(t,i){const c={...t,...i},f={};for(const _ in c)t[_]!==void 0&&i[_]!==void 0&&(f[_]=OI(t[_])(t[_],i[_]));return _=>{for(const w in f)c[w]=f[w](_);return c}}function Dq(t,i){var c;const f=[],_={color:0,var:0,number:0};for(let w=0;w<i.values.length;w++){const E=i.types[w],o=t.indexes[E][_[E]],k=(c=t.values[o])!==null&&c!==void 0?c:0;f[w]=k,_[E]++}return f}const Lq=(t,i)=>{const c=uh.createTransformer(i),f=By(t),_=By(i);return f.indexes.var.length===_.indexes.var.length&&f.indexes.color.length===_.indexes.color.length&&f.indexes.number.length>=_.indexes.number.length?D2.has(t)&&!_.values.length||D2.has(i)&&!f.values.length?Mq(t,i):iv(DF(Dq(f,_),_.values),c):C1(t,i)};function LF(t,i,c){return typeof t=="number"&&typeof i=="number"&&typeof c=="number"?Lr(t,i,c):OI(t)(t,i)}const zq=5;function zF(t,i,c){const f=Math.max(i-zq,0);return lF(c-t(f),i-f)}const Ur={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},eS=.001;function Oq({duration:t=Ur.duration,bounce:i=Ur.bounce,velocity:c=Ur.velocity,mass:f=Ur.mass}){let _,w,E=1-i;E=Bc(Ur.minDamping,Ur.maxDamping,E),t=Bc(Ur.minDuration,Ur.maxDuration,Lc(t)),E<1?(_=L=>{const N=L*E,V=N*t,H=N-c,ne=L2(L,E),ce=Math.exp(-V);return eS-H/ne*ce},w=L=>{const V=L*E*t,H=V*c+c,ne=Math.pow(E,2)*Math.pow(L,2)*t,ce=Math.exp(-V),K=L2(Math.pow(L,2),E);return(-_(L)+eS>0?-1:1)*((H-ne)*ce)/K}):(_=L=>{const N=Math.exp(-L*t),V=(L-c)*t+1;return-eS+N*V},w=L=>{const N=Math.exp(-L*t),V=(c-L)*(t*t);return N*V});const o=5/t,k=Nq(_,w,o);if(t=Dc(t),isNaN(k))return{stiffness:Ur.stiffness,damping:Ur.damping,duration:t};{const L=Math.pow(k,2)*f;return{stiffness:L,damping:E*2*Math.sqrt(f*L),duration:t}}}const Fq=12;function Nq(t,i,c){let f=c;for(let _=1;_<Fq;_++)f=f-t(f)/i(f);return f}function L2(t,i){return t*Math.sqrt(1-i*i)}const Bq=["duration","bounce"],jq=["stiffness","damping","mass"];function oD(t,i){return i.some(c=>t[c]!==void 0)}function Vq(t){let i={velocity:Ur.velocity,stiffness:Ur.stiffness,damping:Ur.damping,mass:Ur.mass,isResolvedFromDuration:!1,...t};if(!oD(t,jq)&&oD(t,Bq))if(t.visualDuration){const c=t.visualDuration,f=2*Math.PI/(c*1.2),_=f*f,w=2*Bc(.05,1,1-(t.bounce||0))*Math.sqrt(_);i={...i,mass:Ur.mass,stiffness:_,damping:w}}else{const c=Oq(t);i={...i,...c,mass:Ur.mass},i.isResolvedFromDuration=!0}return i}function OF(t=Ur.visualDuration,i=Ur.bounce){const c=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:i}:t;let{restSpeed:f,restDelta:_}=c;const w=c.keyframes[0],E=c.keyframes[c.keyframes.length-1],o={done:!1,value:w},{stiffness:k,damping:L,mass:N,duration:V,velocity:H,isResolvedFromDuration:ne}=Vq({...c,velocity:-Lc(c.velocity||0)}),ce=H||0,K=L/(2*Math.sqrt(k*N)),se=E-w,Y=Lc(Math.sqrt(k/N)),Q=Math.abs(se)<5;f||(f=Q?Ur.restSpeed.granular:Ur.restSpeed.default),_||(_=Q?Ur.restDelta.granular:Ur.restDelta.default);let ae;if(K<1){const Be=L2(Y,K);ae=et=>{const nt=Math.exp(-K*Y*et);return E-nt*((ce+K*Y*se)/Be*Math.sin(Be*et)+se*Math.cos(Be*et))}}else if(K===1)ae=Be=>E-Math.exp(-Y*Be)*(se+(ce+Y*se)*Be);else{const Be=Y*Math.sqrt(K*K-1);ae=et=>{const nt=Math.exp(-K*Y*et),Je=Math.min(Be*et,300);return E-nt*((ce+K*Y*se)*Math.sinh(Je)+Be*se*Math.cosh(Je))/Be}}const Te={calculatedDuration:ne&&V||null,next:Be=>{const et=ae(Be);if(ne)o.done=Be>=V;else{let nt=0;K<1&&(nt=Be===0?Dc(ce):zF(ae,Be,et));const Je=Math.abs(nt)<=f,Dt=Math.abs(E-et)<=_;o.done=Je&&Dt}return o.value=o.done?E:et,o},toString:()=>{const Be=Math.min(eF(Te),I2),et=tF(nt=>Te.next(Be*nt).value,Be,30);return Be+"ms "+et}};return Te}function aD({keyframes:t,velocity:i=0,power:c=.8,timeConstant:f=325,bounceDamping:_=10,bounceStiffness:w=500,modifyTarget:E,min:o,max:k,restDelta:L=.5,restSpeed:N}){const V=t[0],H={done:!1,value:V},ne=Je=>o!==void 0&&Je<o||k!==void 0&&Je>k,ce=Je=>o===void 0?k:k===void 0||Math.abs(o-Je)<Math.abs(k-Je)?o:k;let K=c*i;const se=V+K,Y=E===void 0?se:E(se);Y!==se&&(K=Y-V);const Q=Je=>-K*Math.exp(-Je/f),ae=Je=>Y+Q(Je),Te=Je=>{const Dt=Q(Je),wt=ae(Je);H.done=Math.abs(Dt)<=L,H.value=H.done?Y:wt};let Be,et;const nt=Je=>{ne(H.value)&&(Be=Je,et=OF({keyframes:[H.value,ce(H.value)],velocity:zF(ae,Je,H.value),damping:_,stiffness:w,restDelta:L,restSpeed:N}))};return nt(0),{calculatedDuration:null,next:Je=>{let Dt=!1;return!et&&Be===void 0&&(Dt=!0,Te(Je),nt(Je)),Be!==void 0&&Je>=Be?et.next(Je-Be):(!Dt&&Te(Je),H)}}}const Uq=nv(.42,0,1,1),Gq=nv(0,0,.58,1),FF=nv(.42,0,.58,1),$q=t=>Array.isArray(t)&&typeof t[0]!="number",Hq={linear:Qo,easeIn:Uq,easeInOut:FF,easeOut:Gq,circIn:RI,circInOut:_F,circOut:gF,backIn:MI,backInOut:pF,backOut:fF,anticipate:mF},lD=t=>{if(EI(t)){L3(t.length===4);const[i,c,f,_]=t;return nv(i,c,f,_)}else if(typeof t=="string")return Hq[t];return t};function Wq(t,i,c){const f=[],_=c||LF,w=t.length-1;for(let E=0;E<w;E++){let o=_(t[E],t[E+1]);if(i){const k=Array.isArray(i)?i[E]||Qo:i;o=iv(k,o)}f.push(o)}return f}function qq(t,i,{clamp:c=!0,ease:f,mixer:_}={}){const w=t.length;if(L3(w===i.length),w===1)return()=>i[0];if(w===2&&i[0]===i[1])return()=>i[1];const E=t[0]===t[1];t[0]>t[w-1]&&(t=[...t].reverse(),i=[...i].reverse());const o=Wq(i,f,_),k=o.length,L=N=>{if(E&&N<t[0])return i[0];let V=0;if(k>1)for(;V<t.length-2&&!(N<t[V+1]);V++);const H=ym(t[V],t[V+1],N);return o[V](H)};return c?N=>L(Bc(t[0],t[w-1],N)):L}function Zq(t,i){const c=t[t.length-1];for(let f=1;f<=i;f++){const _=ym(0,i,f);t.push(Lr(c,1,_))}}function Xq(t){const i=[0];return Zq(i,t.length-1),i}function Kq(t,i){return t.map(c=>c*i)}function Yq(t,i){return t.map(()=>i||FF).splice(0,t.length-1)}function P1({duration:t=300,keyframes:i,times:c,ease:f="easeInOut"}){const _=$q(f)?f.map(lD):lD(f),w={done:!1,value:i[0]},E=Kq(c&&c.length===i.length?c:Xq(i),t),o=qq(E,i,{ease:Array.isArray(_)?_:Yq(i,_)});return{calculatedDuration:t,next:k=>(w.value=o(k),w.done=k>=t,w)}}const Jq=t=>{const i=({timestamp:c})=>t(c);return{start:()=>Er.update(i,!0),stop:()=>ch(i),now:()=>Ds.isProcessing?Ds.timestamp:$l.now()}},Qq={decay:aD,inertia:aD,tween:P1,keyframes:P1,spring:OF},e9=t=>t/100;class FI extends kF{constructor(i){super(i),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:k}=this.options;k&&k()};const{name:c,motionValue:f,element:_,keyframes:w}=this.options,E=(_==null?void 0:_.KeyframeResolver)||zI,o=(k,L)=>this.onKeyframesResolved(k,L);this.resolver=new E(w,o,c,f,_),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(i){const{type:c="keyframes",repeat:f=0,repeatDelay:_=0,repeatType:w,velocity:E=0}=this.options,o=SI(c)?c:Qq[c]||P1;let k,L;o!==P1&&typeof i[0]!="number"&&(k=iv(e9,LF(i[0],i[1])),i=[0,100]);const N=o({...this.options,keyframes:i});w==="mirror"&&(L=o({...this.options,keyframes:[...i].reverse(),velocity:-E})),N.calculatedDuration===null&&(N.calculatedDuration=eF(N));const{calculatedDuration:V}=N,H=V+_,ne=H*(f+1)-_;return{generator:N,mirroredGenerator:L,mapPercentToKeyframes:k,calculatedDuration:V,resolvedDuration:H,totalDuration:ne}}onPostResolved(){const{autoplay:i=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!i?this.pause():this.state=this.pendingPlayState}tick(i,c=!1){const{resolved:f}=this;if(!f){const{keyframes:Je}=this.options;return{done:!0,value:Je[Je.length-1]}}const{finalKeyframe:_,generator:w,mirroredGenerator:E,mapPercentToKeyframes:o,keyframes:k,calculatedDuration:L,totalDuration:N,resolvedDuration:V}=f;if(this.startTime===null)return w.next(0);const{delay:H,repeat:ne,repeatType:ce,repeatDelay:K,onUpdate:se}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,i):this.speed<0&&(this.startTime=Math.min(i-N/this.speed,this.startTime)),c?this.currentTime=i:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(i-this.startTime)*this.speed;const Y=this.currentTime-H*(this.speed>=0?1:-1),Q=this.speed>=0?Y<0:Y>N;this.currentTime=Math.max(Y,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=N);let ae=this.currentTime,Te=w;if(ne){const Je=Math.min(this.currentTime,N)/V;let Dt=Math.floor(Je),wt=Je%1;!wt&&Je>=1&&(wt=1),wt===1&&Dt--,Dt=Math.min(Dt,ne+1),!!(Dt%2)&&(ce==="reverse"?(wt=1-wt,K&&(wt-=K/V)):ce==="mirror"&&(Te=E)),ae=Bc(0,1,wt)*V}const Be=Q?{done:!1,value:k[0]}:Te.next(ae);o&&(Be.value=o(Be.value));let{done:et}=Be;!Q&&L!==null&&(et=this.speed>=0?this.currentTime>=N:this.currentTime<=0);const nt=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&et);return nt&&_!==void 0&&(Be.value=cw(k,this.options,_)),se&&se(Be.value),nt&&this.finish(),Be}get duration(){const{resolved:i}=this;return i?Lc(i.calculatedDuration):0}get time(){return Lc(this.currentTime)}set time(i){i=Dc(i),this.currentTime=i,this.holdTime!==null||this.speed===0?this.holdTime=i:this.driver&&(this.startTime=this.driver.now()-i/this.speed)}get speed(){return this.playbackSpeed}set speed(i){const c=this.playbackSpeed!==i;this.playbackSpeed=i,c&&(this.time=Lc(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:i=Jq,onPlay:c,startTime:f}=this.options;this.driver||(this.driver=i(w=>this.tick(w))),c&&c();const _=this.driver.now();this.holdTime!==null?this.startTime=_-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=_):this.startTime=f??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var i;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(i=this.currentTime)!==null&&i!==void 0?i:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:i}=this.options;i&&i()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(i){return this.startTime=0,this.tick(i,!0)}}const t9=new Set(["opacity","clipPath","filter","transform"]);function n9(t,i,c,{delay:f=0,duration:_=300,repeat:w=0,repeatType:E="loop",ease:o="easeInOut",times:k}={}){const L={[i]:c};k&&(L.offset=k);const N=iF(o,_);return Array.isArray(N)&&(L.easing=N),t.animate(L,{delay:f,duration:_,easing:Array.isArray(N)?"linear":N,fill:"both",iterations:w+1,direction:E==="reverse"?"alternate":"normal"})}const i9=cI(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),M1=10,r9=2e4;function s9(t){return SI(t.type)||t.type==="spring"||!nF(t.ease)}function o9(t,i){const c=new FI({...i,keyframes:t,repeat:0,delay:0,isGenerator:!0});let f={done:!1,value:t[0]};const _=[];let w=0;for(;!f.done&&w<r9;)f=c.sample(w),_.push(f.value),w+=M1;return{times:void 0,keyframes:_,duration:w-M1,ease:"linear"}}const NF={anticipate:mF,backInOut:pF,circInOut:_F};function a9(t){return t in NF}class cD extends kF{constructor(i){super(i);const{name:c,motionValue:f,element:_,keyframes:w}=this.options;this.resolver=new RF(w,(E,o)=>this.onKeyframesResolved(E,o),c,f,_),this.resolver.scheduleResolve()}initPlayback(i,c){let{duration:f=300,times:_,ease:w,type:E,motionValue:o,name:k,startTime:L}=this.options;if(!o.owner||!o.owner.current)return!1;if(typeof w=="string"&&A1()&&a9(w)&&(w=NF[w]),s9(this.options)){const{onComplete:V,onUpdate:H,motionValue:ne,element:ce,...K}=this.options,se=o9(i,K);i=se.keyframes,i.length===1&&(i[1]=i[0]),f=se.duration,_=se.times,w=se.ease,E="keyframes"}const N=n9(o.owner.current,k,i,{...this.options,duration:f,times:_,ease:w});return N.startTime=L??this.calcStartTime(),this.pendingTimeline?(qk(N,this.pendingTimeline),this.pendingTimeline=void 0):N.onfinish=()=>{const{onComplete:V}=this.options;o.set(cw(i,this.options,c)),V&&V(),this.cancel(),this.resolveFinishedPromise()},{animation:N,duration:f,times:_,type:E,ease:w,keyframes:i}}get duration(){const{resolved:i}=this;if(!i)return 0;const{duration:c}=i;return Lc(c)}get time(){const{resolved:i}=this;if(!i)return 0;const{animation:c}=i;return Lc(c.currentTime||0)}set time(i){const{resolved:c}=this;if(!c)return;const{animation:f}=c;f.currentTime=Dc(i)}get speed(){const{resolved:i}=this;if(!i)return 1;const{animation:c}=i;return c.playbackRate}set speed(i){const{resolved:c}=this;if(!c)return;const{animation:f}=c;f.playbackRate=i}get state(){const{resolved:i}=this;if(!i)return"idle";const{animation:c}=i;return c.playState}get startTime(){const{resolved:i}=this;if(!i)return null;const{animation:c}=i;return c.startTime}attachTimeline(i){if(!this._resolved)this.pendingTimeline=i;else{const{resolved:c}=this;if(!c)return Qo;const{animation:f}=c;qk(f,i)}return Qo}play(){if(this.isStopped)return;const{resolved:i}=this;if(!i)return;const{animation:c}=i;c.playState==="finished"&&this.updateFinishedPromise(),c.play()}pause(){const{resolved:i}=this;if(!i)return;const{animation:c}=i;c.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:i}=this;if(!i)return;const{animation:c,keyframes:f,duration:_,type:w,ease:E,times:o}=i;if(c.playState==="idle"||c.playState==="finished")return;if(this.time){const{motionValue:L,onUpdate:N,onComplete:V,element:H,...ne}=this.options,ce=new FI({...ne,keyframes:f,duration:_,type:w,ease:E,times:o,isGenerator:!0}),K=Dc(this.time);L.setWithVelocity(ce.sample(K-M1).value,ce.sample(K).value,M1)}const{onStop:k}=this.options;k&&k(),this.cancel()}complete(){const{resolved:i}=this;i&&i.animation.finish()}cancel(){const{resolved:i}=this;i&&i.animation.cancel()}static supports(i){const{motionValue:c,name:f,repeatDelay:_,repeatType:w,damping:E,type:o}=i;if(!c||!c.owner||!(c.owner.current instanceof HTMLElement))return!1;const{onUpdate:k,transformTemplate:L}=c.owner.getProps();return i9()&&f&&t9.has(f)&&!k&&!L&&!_&&w!=="mirror"&&E!==0&&o!=="inertia"}}const l9={type:"spring",stiffness:500,damping:25,restSpeed:10},c9=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),u9={type:"keyframes",duration:.8},h9={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},d9=(t,{keyframes:i})=>i.length>2?u9:$d.has(t)?t.startsWith("scale")?c9(i[1]):l9:h9;function f9({when:t,delay:i,delayChildren:c,staggerChildren:f,staggerDirection:_,repeat:w,repeatType:E,repeatDelay:o,from:k,elapsed:L,...N}){return!!Object.keys(N).length}const NI=(t,i,c,f={},_,w)=>E=>{const o=TI(f,t)||{},k=o.delay||f.delay||0;let{elapsed:L=0}=f;L=L-Dc(k);let N={keyframes:Array.isArray(c)?c:[null,c],ease:"easeOut",velocity:i.getVelocity(),...o,delay:-L,onUpdate:H=>{i.set(H),o.onUpdate&&o.onUpdate(H)},onComplete:()=>{E(),o.onComplete&&o.onComplete()},name:t,motionValue:i,element:w?void 0:_};f9(o)||(N={...N,...d9(t,N)}),N.duration&&(N.duration=Dc(N.duration)),N.repeatDelay&&(N.repeatDelay=Dc(N.repeatDelay)),N.from!==void 0&&(N.keyframes[0]=N.from);let V=!1;if((N.type===!1||N.duration===0&&!N.repeatDelay)&&(N.duration=0,N.delay===0&&(V=!0)),V&&!w&&i.get()!==void 0){const H=cw(N.keyframes,o);if(H!==void 0)return Er.update(()=>{N.onUpdate(H),N.onComplete()}),new kW([])}return!w&&cD.supports(N)?new cD(N):new FI(N)};function p9({protectedKeys:t,needsAnimating:i},c){const f=t.hasOwnProperty(c)&&i[c]!==!0;return i[c]=!1,f}function BF(t,i,{delay:c=0,transitionOverride:f,type:_}={}){var w;let{transition:E=t.getDefaultTransition(),transitionEnd:o,...k}=i;f&&(E=f);const L=[],N=_&&t.animationState&&t.animationState.getState()[_];for(const V in k){const H=t.getValue(V,(w=t.latestValues[V])!==null&&w!==void 0?w:null),ne=k[V];if(ne===void 0||N&&p9(N,V))continue;const ce={delay:c,...TI(E||{},V)};let K=!1;if(window.MotionHandoffAnimation){const Y=cF(t);if(Y){const Q=window.MotionHandoffAnimation(Y,V,Er);Q!==null&&(ce.startTime=Q,K=!0)}}C2(t,V),H.start(NI(V,H,ne,t.shouldReduceMotion&&aF.has(V)?{type:!1}:ce,t,K));const se=H.animation;se&&L.push(se)}return o&&Promise.all(L).then(()=>{Er.update(()=>{o&&WW(t,o)})}),L}function z2(t,i,c={}){var f;const _=lw(t,i,c.type==="exit"?(f=t.presenceContext)===null||f===void 0?void 0:f.custom:void 0);let{transition:w=t.getDefaultTransition()||{}}=_||{};c.transitionOverride&&(w=c.transitionOverride);const E=_?()=>Promise.all(BF(t,_,c)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(L=0)=>{const{delayChildren:N=0,staggerChildren:V,staggerDirection:H}=w;return m9(t,i,N+L,V,H,c)}:()=>Promise.resolve(),{when:k}=w;if(k){const[L,N]=k==="beforeChildren"?[E,o]:[o,E];return L().then(()=>N())}else return Promise.all([E(),o(c.delay)])}function m9(t,i,c=0,f=0,_=1,w){const E=[],o=(t.variantChildren.size-1)*f,k=_===1?(L=0)=>L*f:(L=0)=>o-L*f;return Array.from(t.variantChildren).sort(g9).forEach((L,N)=>{L.notify("AnimationStart",i),E.push(z2(L,i,{...w,delay:c+k(N)}).then(()=>L.notify("AnimationComplete",i)))}),Promise.all(E)}function g9(t,i){return t.sortNodePosition(i)}function _9(t,i,c={}){t.notify("AnimationStart",i);let f;if(Array.isArray(i)){const _=i.map(w=>z2(t,w,c));f=Promise.all(_)}else if(typeof i=="string")f=z2(t,i,c);else{const _=typeof i=="function"?lw(t,i,c.custom):i;f=Promise.all(BF(t,_,c))}return f.then(()=>{t.notify("AnimationComplete",i)})}const y9=hI.length;function jF(t){if(!t)return;if(!t.isControllingVariants){const c=t.parent?jF(t.parent)||{}:{};return t.props.initial!==void 0&&(c.initial=t.props.initial),c}const i={};for(let c=0;c<y9;c++){const f=hI[c],_=t.props[f];(Oy(_)||_===!1)&&(i[f]=_)}return i}const v9=[...uI].reverse(),x9=uI.length;function w9(t){return i=>Promise.all(i.map(({animation:c,options:f})=>_9(t,c,f)))}function b9(t){let i=w9(t),c=uD(),f=!0;const _=k=>(L,N)=>{var V;const H=lw(t,N,k==="exit"?(V=t.presenceContext)===null||V===void 0?void 0:V.custom:void 0);if(H){const{transition:ne,transitionEnd:ce,...K}=H;L={...L,...K,...ce}}return L};function w(k){i=k(t)}function E(k){const{props:L}=t,N=jF(t.parent)||{},V=[],H=new Set;let ne={},ce=1/0;for(let se=0;se<x9;se++){const Y=v9[se],Q=c[Y],ae=L[Y]!==void 0?L[Y]:N[Y],Te=Oy(ae),Be=Y===k?Q.isActive:null;Be===!1&&(ce=se);let et=ae===N[Y]&&ae!==L[Y]&&Te;if(et&&f&&t.manuallyAnimateOnMount&&(et=!1),Q.protectedKeys={...ne},!Q.isActive&&Be===null||!ae&&!Q.prevProp||ow(ae)||typeof ae=="boolean")continue;const nt=T9(Q.prevProp,ae);let Je=nt||Y===k&&Q.isActive&&!et&&Te||se>ce&&Te,Dt=!1;const wt=Array.isArray(ae)?ae:[ae];let xt=wt.reduce(_(Y),{});Be===!1&&(xt={});const{prevResolvedValues:qt={}}=Q,ln={...qt,...xt},Ht=Rn=>{Je=!0,H.has(Rn)&&(Dt=!0,H.delete(Rn)),Q.needsAnimating[Rn]=!0;const Nt=t.getValue(Rn);Nt&&(Nt.liveStyle=!1)};for(const Rn in ln){const Nt=xt[Rn],sn=qt[Rn];if(ne.hasOwnProperty(Rn))continue;let Tn=!1;E2(Nt)&&E2(sn)?Tn=!Q3(Nt,sn):Tn=Nt!==sn,Tn?Nt!=null?Ht(Rn):H.add(Rn):Nt!==void 0&&H.has(Rn)?Ht(Rn):Q.protectedKeys[Rn]=!0}Q.prevProp=ae,Q.prevResolvedValues=xt,Q.isActive&&(ne={...ne,...xt}),f&&t.blockInitialAnimation&&(Je=!1),Je&&(!(et&&nt)||Dt)&&V.push(...wt.map(Rn=>({animation:Rn,options:{type:Y}})))}if(H.size){const se={};H.forEach(Y=>{const Q=t.getBaseTarget(Y),ae=t.getValue(Y);ae&&(ae.liveStyle=!0),se[Y]=Q??null}),V.push({animation:se})}let K=!!V.length;return f&&(L.initial===!1||L.initial===L.animate)&&!t.manuallyAnimateOnMount&&(K=!1),f=!1,K?i(V):Promise.resolve()}function o(k,L){var N;if(c[k].isActive===L)return Promise.resolve();(N=t.variantChildren)===null||N===void 0||N.forEach(H=>{var ne;return(ne=H.animationState)===null||ne===void 0?void 0:ne.setActive(k,L)}),c[k].isActive=L;const V=E(k);for(const H in c)c[H].protectedKeys={};return V}return{animateChanges:E,setActive:o,setAnimateFunction:w,getState:()=>c,reset:()=>{c=uD(),f=!0}}}function T9(t,i){return typeof i=="string"?i!==t:Array.isArray(i)?!Q3(i,t):!1}function cd(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function uD(){return{animate:cd(!0),whileInView:cd(),whileHover:cd(),whileTap:cd(),whileDrag:cd(),whileFocus:cd(),exit:cd()}}class gh{constructor(i){this.isMounted=!1,this.node=i}update(){}}class S9 extends gh{constructor(i){super(i),i.animationState||(i.animationState=b9(i))}updateAnimationControlsSubscription(){const{animate:i}=this.node.getProps();ow(i)&&(this.unmountControls=i.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:i}=this.node.getProps(),{animate:c}=this.node.prevProps||{};i!==c&&this.updateAnimationControlsSubscription()}unmount(){var i;this.node.animationState.reset(),(i=this.unmountControls)===null||i===void 0||i.call(this)}}let E9=0;class I9 extends gh{constructor(){super(...arguments),this.id=E9++}update(){if(!this.node.presenceContext)return;const{isPresent:i,onExitComplete:c}=this.node.presenceContext,{isPresent:f}=this.node.prevPresenceContext||{};if(!this.node.animationState||i===f)return;const _=this.node.animationState.setActive("exit",!i);c&&!i&&_.then(()=>c(this.id))}mount(){const{register:i}=this.node.presenceContext||{};i&&(this.unmount=i(this.id))}unmount(){}}const A9={animation:{Feature:S9},exit:{Feature:I9}};function jy(t,i,c,f={passive:!0}){return t.addEventListener(i,c,f),()=>t.removeEventListener(i,c)}function rv(t){return{point:{x:t.pageX,y:t.pageY}}}const C9=t=>i=>II(i)&&t(i,rv(i));function cy(t,i,c,f){return jy(t,i,C9(c),f)}const hD=(t,i)=>Math.abs(t-i);function P9(t,i){const c=hD(t.x,i.x),f=hD(t.y,i.y);return Math.sqrt(c**2+f**2)}class VF{constructor(i,c,{transformPagePoint:f,contextWindow:_,dragSnapToOrigin:w=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const V=nS(this.lastMoveEventInfo,this.history),H=this.startEvent!==null,ne=P9(V.offset,{x:0,y:0})>=3;if(!H&&!ne)return;const{point:ce}=V,{timestamp:K}=Ds;this.history.push({...ce,timestamp:K});const{onStart:se,onMove:Y}=this.handlers;H||(se&&se(this.lastMoveEvent,V),this.startEvent=this.lastMoveEvent),Y&&Y(this.lastMoveEvent,V)},this.handlePointerMove=(V,H)=>{this.lastMoveEvent=V,this.lastMoveEventInfo=tS(H,this.transformPagePoint),Er.update(this.updatePoint,!0)},this.handlePointerUp=(V,H)=>{this.end();const{onEnd:ne,onSessionEnd:ce,resumeAnimation:K}=this.handlers;if(this.dragSnapToOrigin&&K&&K(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const se=nS(V.type==="pointercancel"?this.lastMoveEventInfo:tS(H,this.transformPagePoint),this.history);this.startEvent&&ne&&ne(V,se),ce&&ce(V,se)},!II(i))return;this.dragSnapToOrigin=w,this.handlers=c,this.transformPagePoint=f,this.contextWindow=_||window;const E=rv(i),o=tS(E,this.transformPagePoint),{point:k}=o,{timestamp:L}=Ds;this.history=[{...k,timestamp:L}];const{onSessionStart:N}=c;N&&N(i,nS(o,this.history)),this.removeListeners=iv(cy(this.contextWindow,"pointermove",this.handlePointerMove),cy(this.contextWindow,"pointerup",this.handlePointerUp),cy(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(i){this.handlers=i}end(){this.removeListeners&&this.removeListeners(),ch(this.updatePoint)}}function tS(t,i){return i?{point:i(t.point)}:t}function dD(t,i){return{x:t.x-i.x,y:t.y-i.y}}function nS({point:t},i){return{point:t,delta:dD(t,UF(i)),offset:dD(t,M9(i)),velocity:R9(i,.1)}}function M9(t){return t[0]}function UF(t){return t[t.length-1]}function R9(t,i){if(t.length<2)return{x:0,y:0};let c=t.length-1,f=null;const _=UF(t);for(;c>=0&&(f=t[c],!(_.timestamp-f.timestamp>Dc(i)));)c--;if(!f)return{x:0,y:0};const w=Lc(_.timestamp-f.timestamp);if(w===0)return{x:0,y:0};const E={x:(_.x-f.x)/w,y:(_.y-f.y)/w};return E.x===1/0&&(E.x=0),E.y===1/0&&(E.y=0),E}const GF=1e-4,k9=1-GF,D9=1+GF,$F=.01,L9=0-$F,z9=0+$F;function ta(t){return t.max-t.min}function O9(t,i,c){return Math.abs(t-i)<=c}function fD(t,i,c,f=.5){t.origin=f,t.originPoint=Lr(i.min,i.max,t.origin),t.scale=ta(c)/ta(i),t.translate=Lr(c.min,c.max,t.origin)-t.originPoint,(t.scale>=k9&&t.scale<=D9||isNaN(t.scale))&&(t.scale=1),(t.translate>=L9&&t.translate<=z9||isNaN(t.translate))&&(t.translate=0)}function uy(t,i,c,f){fD(t.x,i.x,c.x,f?f.originX:void 0),fD(t.y,i.y,c.y,f?f.originY:void 0)}function pD(t,i,c){t.min=c.min+i.min,t.max=t.min+ta(i)}function F9(t,i,c){pD(t.x,i.x,c.x),pD(t.y,i.y,c.y)}function mD(t,i,c){t.min=i.min-c.min,t.max=t.min+ta(i)}function hy(t,i,c){mD(t.x,i.x,c.x),mD(t.y,i.y,c.y)}function N9(t,{min:i,max:c},f){return i!==void 0&&t<i?t=f?Lr(i,t,f.min):Math.max(t,i):c!==void 0&&t>c&&(t=f?Lr(c,t,f.max):Math.min(t,c)),t}function gD(t,i,c){return{min:i!==void 0?t.min+i:void 0,max:c!==void 0?t.max+c-(t.max-t.min):void 0}}function B9(t,{top:i,left:c,bottom:f,right:_}){return{x:gD(t.x,c,_),y:gD(t.y,i,f)}}function _D(t,i){let c=i.min-t.min,f=i.max-t.max;return i.max-i.min<t.max-t.min&&([c,f]=[f,c]),{min:c,max:f}}function j9(t,i){return{x:_D(t.x,i.x),y:_D(t.y,i.y)}}function V9(t,i){let c=.5;const f=ta(t),_=ta(i);return _>f?c=ym(i.min,i.max-f,t.min):f>_&&(c=ym(t.min,t.max-_,i.min)),Bc(0,1,c)}function U9(t,i){const c={};return i.min!==void 0&&(c.min=i.min-t.min),i.max!==void 0&&(c.max=i.max-t.min),c}const O2=.35;function G9(t=O2){return t===!1?t=0:t===!0&&(t=O2),{x:yD(t,"left","right"),y:yD(t,"top","bottom")}}function yD(t,i,c){return{min:vD(t,i),max:vD(t,c)}}function vD(t,i){return typeof t=="number"?t:t[i]||0}const xD=()=>({translate:0,scale:1,origin:0,originPoint:0}),Gp=()=>({x:xD(),y:xD()}),wD=()=>({min:0,max:0}),Zr=()=>({x:wD(),y:wD()});function wa(t){return[t("x"),t("y")]}function HF({top:t,left:i,right:c,bottom:f}){return{x:{min:i,max:c},y:{min:t,max:f}}}function $9({x:t,y:i}){return{top:i.min,right:t.max,bottom:i.max,left:t.min}}function H9(t,i){if(!i)return t;const c=i({x:t.left,y:t.top}),f=i({x:t.right,y:t.bottom});return{top:c.y,left:c.x,bottom:f.y,right:f.x}}function iS(t){return t===void 0||t===1}function F2({scale:t,scaleX:i,scaleY:c}){return!iS(t)||!iS(i)||!iS(c)}function pd(t){return F2(t)||WF(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function WF(t){return bD(t.x)||bD(t.y)}function bD(t){return t&&t!=="0%"}function R1(t,i,c){const f=t-c,_=i*f;return c+_}function TD(t,i,c,f,_){return _!==void 0&&(t=R1(t,_,f)),R1(t,c,f)+i}function N2(t,i=0,c=1,f,_){t.min=TD(t.min,i,c,f,_),t.max=TD(t.max,i,c,f,_)}function qF(t,{x:i,y:c}){N2(t.x,i.translate,i.scale,i.originPoint),N2(t.y,c.translate,c.scale,c.originPoint)}const SD=.999999999999,ED=1.0000000000001;function W9(t,i,c,f=!1){const _=c.length;if(!_)return;i.x=i.y=1;let w,E;for(let o=0;o<_;o++){w=c[o],E=w.projectionDelta;const{visualElement:k}=w.options;k&&k.props.style&&k.props.style.display==="contents"||(f&&w.options.layoutScroll&&w.scroll&&w!==w.root&&Hp(t,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),E&&(i.x*=E.x.scale,i.y*=E.y.scale,qF(t,E)),f&&pd(w.latestValues)&&Hp(t,w.latestValues))}i.x<ED&&i.x>SD&&(i.x=1),i.y<ED&&i.y>SD&&(i.y=1)}function $p(t,i){t.min=t.min+i,t.max=t.max+i}function ID(t,i,c,f,_=.5){const w=Lr(t.min,t.max,_);N2(t,i,c,w,f)}function Hp(t,i){ID(t.x,i.x,i.scaleX,i.scale,i.originX),ID(t.y,i.y,i.scaleY,i.scale,i.originY)}function ZF(t,i){return HF(H9(t.getBoundingClientRect(),i))}function q9(t,i,c){const f=ZF(t,c),{scroll:_}=i;return _&&($p(f.x,_.offset.x),$p(f.y,_.offset.y)),f}const XF=({current:t})=>t?t.ownerDocument.defaultView:null,Z9=new WeakMap;class X9{constructor(i){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Zr(),this.visualElement=i}start(i,{snapToCursor:c=!1}={}){const{presenceContext:f}=this.visualElement;if(f&&f.isPresent===!1)return;const _=N=>{const{dragSnapToOrigin:V}=this.getProps();V?this.pauseAnimation():this.stopAnimation(),c&&this.snapToCursor(rv(N).point)},w=(N,V)=>{const{drag:H,dragPropagation:ne,onDragStart:ce}=this.getProps();if(H&&!ne&&(this.openDragLock&&this.openDragLock(),this.openDragLock=VW(H),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),wa(se=>{let Y=this.getAxisMotionValue(se).get()||0;if(Gl.test(Y)){const{projection:Q}=this.visualElement;if(Q&&Q.layout){const ae=Q.layout.layoutBox[se];ae&&(Y=ta(ae)*(parseFloat(Y)/100))}}this.originPoint[se]=Y}),ce&&Er.postRender(()=>ce(N,V)),C2(this.visualElement,"transform");const{animationState:K}=this.visualElement;K&&K.setActive("whileDrag",!0)},E=(N,V)=>{const{dragPropagation:H,dragDirectionLock:ne,onDirectionLock:ce,onDrag:K}=this.getProps();if(!H&&!this.openDragLock)return;const{offset:se}=V;if(ne&&this.currentDirection===null){this.currentDirection=K9(se),this.currentDirection!==null&&ce&&ce(this.currentDirection);return}this.updateAxis("x",V.point,se),this.updateAxis("y",V.point,se),this.visualElement.render(),K&&K(N,V)},o=(N,V)=>this.stop(N,V),k=()=>wa(N=>{var V;return this.getAnimationState(N)==="paused"&&((V=this.getAxisMotionValue(N).animation)===null||V===void 0?void 0:V.play())}),{dragSnapToOrigin:L}=this.getProps();this.panSession=new VF(i,{onSessionStart:_,onStart:w,onMove:E,onSessionEnd:o,resumeAnimation:k},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:L,contextWindow:XF(this.visualElement)})}stop(i,c){const f=this.isDragging;if(this.cancel(),!f)return;const{velocity:_}=c;this.startAnimation(_);const{onDragEnd:w}=this.getProps();w&&Er.postRender(()=>w(i,c))}cancel(){this.isDragging=!1;const{projection:i,animationState:c}=this.visualElement;i&&(i.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:f}=this.getProps();!f&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),c&&c.setActive("whileDrag",!1)}updateAxis(i,c,f){const{drag:_}=this.getProps();if(!f||!T0(i,_,this.currentDirection))return;const w=this.getAxisMotionValue(i);let E=this.originPoint[i]+f[i];this.constraints&&this.constraints[i]&&(E=N9(E,this.constraints[i],this.elastic[i])),w.set(E)}resolveConstraints(){var i;const{dragConstraints:c,dragElastic:f}=this.getProps(),_=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(i=this.visualElement.projection)===null||i===void 0?void 0:i.layout,w=this.constraints;c&&Vp(c)?this.constraints||(this.constraints=this.resolveRefConstraints()):c&&_?this.constraints=B9(_.layoutBox,c):this.constraints=!1,this.elastic=G9(f),w!==this.constraints&&_&&this.constraints&&!this.hasMutatedConstraints&&wa(E=>{this.constraints!==!1&&this.getAxisMotionValue(E)&&(this.constraints[E]=U9(_.layoutBox[E],this.constraints[E]))})}resolveRefConstraints(){const{dragConstraints:i,onMeasureDragConstraints:c}=this.getProps();if(!i||!Vp(i))return!1;const f=i.current,{projection:_}=this.visualElement;if(!_||!_.layout)return!1;const w=q9(f,_.root,this.visualElement.getTransformPagePoint());let E=j9(_.layout.layoutBox,w);if(c){const o=c($9(E));this.hasMutatedConstraints=!!o,o&&(E=HF(o))}return E}startAnimation(i){const{drag:c,dragMomentum:f,dragElastic:_,dragTransition:w,dragSnapToOrigin:E,onDragTransitionEnd:o}=this.getProps(),k=this.constraints||{},L=wa(N=>{if(!T0(N,c,this.currentDirection))return;let V=k&&k[N]||{};E&&(V={min:0,max:0});const H=_?200:1e6,ne=_?40:1e7,ce={type:"inertia",velocity:f?i[N]:0,bounceStiffness:H,bounceDamping:ne,timeConstant:750,restDelta:1,restSpeed:10,...w,...V};return this.startAxisValueAnimation(N,ce)});return Promise.all(L).then(o)}startAxisValueAnimation(i,c){const f=this.getAxisMotionValue(i);return C2(this.visualElement,i),f.start(NI(i,f,0,c,this.visualElement,!1))}stopAnimation(){wa(i=>this.getAxisMotionValue(i).stop())}pauseAnimation(){wa(i=>{var c;return(c=this.getAxisMotionValue(i).animation)===null||c===void 0?void 0:c.pause()})}getAnimationState(i){var c;return(c=this.getAxisMotionValue(i).animation)===null||c===void 0?void 0:c.state}getAxisMotionValue(i){const c=`_drag${i.toUpperCase()}`,f=this.visualElement.getProps(),_=f[c];return _||this.visualElement.getValue(i,(f.initial?f.initial[i]:void 0)||0)}snapToCursor(i){wa(c=>{const{drag:f}=this.getProps();if(!T0(c,f,this.currentDirection))return;const{projection:_}=this.visualElement,w=this.getAxisMotionValue(c);if(_&&_.layout){const{min:E,max:o}=_.layout.layoutBox[c];w.set(i[c]-Lr(E,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:i,dragConstraints:c}=this.getProps(),{projection:f}=this.visualElement;if(!Vp(c)||!f||!this.constraints)return;this.stopAnimation();const _={x:0,y:0};wa(E=>{const o=this.getAxisMotionValue(E);if(o&&this.constraints!==!1){const k=o.get();_[E]=V9({min:k,max:k},this.constraints[E])}});const{transformTemplate:w}=this.visualElement.getProps();this.visualElement.current.style.transform=w?w({},""):"none",f.root&&f.root.updateScroll(),f.updateLayout(),this.resolveConstraints(),wa(E=>{if(!T0(E,i,null))return;const o=this.getAxisMotionValue(E),{min:k,max:L}=this.constraints[E];o.set(Lr(k,L,_[E]))})}addListeners(){if(!this.visualElement.current)return;Z9.set(this.visualElement,this);const i=this.visualElement.current,c=cy(i,"pointerdown",k=>{const{drag:L,dragListener:N=!0}=this.getProps();L&&N&&this.start(k)}),f=()=>{const{dragConstraints:k}=this.getProps();Vp(k)&&k.current&&(this.constraints=this.resolveRefConstraints())},{projection:_}=this.visualElement,w=_.addEventListener("measure",f);_&&!_.layout&&(_.root&&_.root.updateScroll(),_.updateLayout()),Er.read(f);const E=jy(window,"resize",()=>this.scalePositionWithinConstraints()),o=_.addEventListener("didUpdate",({delta:k,hasLayoutChanged:L})=>{this.isDragging&&L&&(wa(N=>{const V=this.getAxisMotionValue(N);V&&(this.originPoint[N]+=k[N].translate,V.set(V.get()+k[N].translate))}),this.visualElement.render())});return()=>{E(),c(),w(),o&&o()}}getProps(){const i=this.visualElement.getProps(),{drag:c=!1,dragDirectionLock:f=!1,dragPropagation:_=!1,dragConstraints:w=!1,dragElastic:E=O2,dragMomentum:o=!0}=i;return{...i,drag:c,dragDirectionLock:f,dragPropagation:_,dragConstraints:w,dragElastic:E,dragMomentum:o}}}function T0(t,i,c){return(i===!0||i===t)&&(c===null||c===t)}function K9(t,i=10){let c=null;return Math.abs(t.y)>i?c="y":Math.abs(t.x)>i&&(c="x"),c}class Y9 extends gh{constructor(i){super(i),this.removeGroupControls=Qo,this.removeListeners=Qo,this.controls=new X9(i)}mount(){const{dragControls:i}=this.node.getProps();i&&(this.removeGroupControls=i.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Qo}unmount(){this.removeGroupControls(),this.removeListeners()}}const AD=t=>(i,c)=>{t&&Er.postRender(()=>t(i,c))};class J9 extends gh{constructor(){super(...arguments),this.removePointerDownListener=Qo}onPointerDown(i){this.session=new VF(i,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:XF(this.node)})}createPanHandlers(){const{onPanSessionStart:i,onPanStart:c,onPan:f,onPanEnd:_}=this.node.getProps();return{onSessionStart:AD(i),onStart:AD(c),onMove:f,onEnd:(w,E)=>{delete this.session,_&&Er.postRender(()=>_(w,E))}}}mount(){this.removePointerDownListener=cy(this.node.current,"pointerdown",i=>this.onPointerDown(i))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const H0={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function CD(t,i){return i.max===i.min?0:t/(i.max-i.min)*100}const j_={correct:(t,i)=>{if(!i.target)return t;if(typeof t=="string")if(Hn.test(t))t=parseFloat(t);else return t;const c=CD(t,i.target.x),f=CD(t,i.target.y);return`${c}% ${f}%`}},Q9={correct:(t,{treeScale:i,projectionDelta:c})=>{const f=t,_=uh.parse(t);if(_.length>5)return f;const w=uh.createTransformer(t),E=typeof _[0]!="number"?1:0,o=c.x.scale*i.x,k=c.y.scale*i.y;_[0+E]/=o,_[1+E]/=k;const L=Lr(o,k,.5);return typeof _[2+E]=="number"&&(_[2+E]/=L),typeof _[3+E]=="number"&&(_[3+E]/=L),w(_)}};class eZ extends fe.Component{componentDidMount(){const{visualElement:i,layoutGroup:c,switchLayoutGroup:f,layoutId:_}=this.props,{projection:w}=i;xW(tZ),w&&(c.group&&c.group.add(w),f&&f.register&&_&&f.register(w),w.root.didUpdate(),w.addEventListener("animationComplete",()=>{this.safeToRemove()}),w.setOptions({...w.options,onExitComplete:()=>this.safeToRemove()})),H0.hasEverUpdated=!0}getSnapshotBeforeUpdate(i){const{layoutDependency:c,visualElement:f,drag:_,isPresent:w}=this.props,E=f.projection;return E&&(E.isPresent=w,_||i.layoutDependency!==c||c===void 0?E.willUpdate():this.safeToRemove(),i.isPresent!==w&&(w?E.promote():E.relegate()||Er.postRender(()=>{const o=E.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:i}=this.props.visualElement;i&&(i.root.didUpdate(),fI.postRender(()=>{!i.currentAnimation&&i.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:i,layoutGroup:c,switchLayoutGroup:f}=this.props,{projection:_}=i;_&&(_.scheduleCheckAfterUnmount(),c&&c.group&&c.group.remove(_),f&&f.deregister&&f.deregister(_))}safeToRemove(){const{safeToRemove:i}=this.props;i&&i()}render(){return null}}function KF(t){const[i,c]=zH(),f=fe.useContext(k3);return B.jsx(eZ,{...t,layoutGroup:f,switchLayoutGroup:fe.useContext(j3),isPresent:i,safeToRemove:c})}const tZ={borderRadius:{...j_,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:j_,borderTopRightRadius:j_,borderBottomLeftRadius:j_,borderBottomRightRadius:j_,boxShadow:Q9};function nZ(t,i,c){const f=Ys(t)?t:Ny(t);return f.start(NI("",f,i,c)),f.animation}function iZ(t){return t instanceof SVGElement&&t.tagName!=="svg"}const rZ=(t,i)=>t.depth-i.depth;class sZ{constructor(){this.children=[],this.isDirty=!1}add(i){AI(this.children,i),this.isDirty=!0}remove(i){CI(this.children,i),this.isDirty=!0}forEach(i){this.isDirty&&this.children.sort(rZ),this.isDirty=!1,this.children.forEach(i)}}function oZ(t,i){const c=$l.now(),f=({timestamp:_})=>{const w=_-c;w>=i&&(ch(f),t(w-i))};return Er.read(f,!0),()=>ch(f)}const YF=["TopLeft","TopRight","BottomLeft","BottomRight"],aZ=YF.length,PD=t=>typeof t=="string"?parseFloat(t):t,MD=t=>typeof t=="number"||Hn.test(t);function lZ(t,i,c,f,_,w){_?(t.opacity=Lr(0,c.opacity!==void 0?c.opacity:1,cZ(f)),t.opacityExit=Lr(i.opacity!==void 0?i.opacity:1,0,uZ(f))):w&&(t.opacity=Lr(i.opacity!==void 0?i.opacity:1,c.opacity!==void 0?c.opacity:1,f));for(let E=0;E<aZ;E++){const o=`border${YF[E]}Radius`;let k=RD(i,o),L=RD(c,o);if(k===void 0&&L===void 0)continue;k||(k=0),L||(L=0),k===0||L===0||MD(k)===MD(L)?(t[o]=Math.max(Lr(PD(k),PD(L),f),0),(Gl.test(L)||Gl.test(k))&&(t[o]+="%")):t[o]=L}(i.rotate||c.rotate)&&(t.rotate=Lr(i.rotate||0,c.rotate||0,f))}function RD(t,i){return t[i]!==void 0?t[i]:t.borderRadius}const cZ=JF(0,.5,gF),uZ=JF(.5,.95,Qo);function JF(t,i,c){return f=>f<t?0:f>i?1:c(ym(t,i,f))}function kD(t,i){t.min=i.min,t.max=i.max}function xa(t,i){kD(t.x,i.x),kD(t.y,i.y)}function DD(t,i){t.translate=i.translate,t.scale=i.scale,t.originPoint=i.originPoint,t.origin=i.origin}function LD(t,i,c,f,_){return t-=i,t=R1(t,1/c,f),_!==void 0&&(t=R1(t,1/_,f)),t}function hZ(t,i=0,c=1,f=.5,_,w=t,E=t){if(Gl.test(i)&&(i=parseFloat(i),i=Lr(E.min,E.max,i/100)-E.min),typeof i!="number")return;let o=Lr(w.min,w.max,f);t===w&&(o-=i),t.min=LD(t.min,i,c,o,_),t.max=LD(t.max,i,c,o,_)}function zD(t,i,[c,f,_],w,E){hZ(t,i[c],i[f],i[_],i.scale,w,E)}const dZ=["x","scaleX","originX"],fZ=["y","scaleY","originY"];function OD(t,i,c,f){zD(t.x,i,dZ,c?c.x:void 0,f?f.x:void 0),zD(t.y,i,fZ,c?c.y:void 0,f?f.y:void 0)}function FD(t){return t.translate===0&&t.scale===1}function QF(t){return FD(t.x)&&FD(t.y)}function ND(t,i){return t.min===i.min&&t.max===i.max}function pZ(t,i){return ND(t.x,i.x)&&ND(t.y,i.y)}function BD(t,i){return Math.round(t.min)===Math.round(i.min)&&Math.round(t.max)===Math.round(i.max)}function eN(t,i){return BD(t.x,i.x)&&BD(t.y,i.y)}function jD(t){return ta(t.x)/ta(t.y)}function VD(t,i){return t.translate===i.translate&&t.scale===i.scale&&t.originPoint===i.originPoint}class mZ{constructor(){this.members=[]}add(i){AI(this.members,i),i.scheduleRender()}remove(i){if(CI(this.members,i),i===this.prevLead&&(this.prevLead=void 0),i===this.lead){const c=this.members[this.members.length-1];c&&this.promote(c)}}relegate(i){const c=this.members.findIndex(_=>i===_);if(c===0)return!1;let f;for(let _=c;_>=0;_--){const w=this.members[_];if(w.isPresent!==!1){f=w;break}}return f?(this.promote(f),!0):!1}promote(i,c){const f=this.lead;if(i!==f&&(this.prevLead=f,this.lead=i,i.show(),f)){f.instance&&f.scheduleRender(),i.scheduleRender(),i.resumeFrom=f,c&&(i.resumeFrom.preserveOpacity=!0),f.snapshot&&(i.snapshot=f.snapshot,i.snapshot.latestValues=f.animationValues||f.latestValues),i.root&&i.root.isUpdating&&(i.isLayoutDirty=!0);const{crossfade:_}=i.options;_===!1&&f.hide()}}exitAnimationComplete(){this.members.forEach(i=>{const{options:c,resumingFrom:f}=i;c.onExitComplete&&c.onExitComplete(),f&&f.options.onExitComplete&&f.options.onExitComplete()})}scheduleRender(){this.members.forEach(i=>{i.instance&&i.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function gZ(t,i,c){let f="";const _=t.x.translate/i.x,w=t.y.translate/i.y,E=(c==null?void 0:c.z)||0;if((_||w||E)&&(f=`translate3d(${_}px, ${w}px, ${E}px) `),(i.x!==1||i.y!==1)&&(f+=`scale(${1/i.x}, ${1/i.y}) `),c){const{transformPerspective:L,rotate:N,rotateX:V,rotateY:H,skewX:ne,skewY:ce}=c;L&&(f=`perspective(${L}px) ${f}`),N&&(f+=`rotate(${N}deg) `),V&&(f+=`rotateX(${V}deg) `),H&&(f+=`rotateY(${H}deg) `),ne&&(f+=`skewX(${ne}deg) `),ce&&(f+=`skewY(${ce}deg) `)}const o=t.x.scale*i.x,k=t.y.scale*i.y;return(o!==1||k!==1)&&(f+=`scale(${o}, ${k})`),f||"none"}const md={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},q_=typeof window<"u"&&window.MotionDebug!==void 0,rS=["","X","Y","Z"],_Z={visibility:"hidden"},UD=1e3;let yZ=0;function sS(t,i,c,f){const{latestValues:_}=i;_[t]&&(c[t]=_[t],i.setStaticValue(t,0),f&&(f[t]=0))}function tN(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:i}=t.options;if(!i)return;const c=cF(i);if(window.MotionHasOptimisedAnimation(c,"transform")){const{layout:_,layoutId:w}=t.options;window.MotionCancelOptimisedAnimation(c,"transform",Er,!(_||w))}const{parent:f}=t;f&&!f.hasCheckedOptimisedAppear&&tN(f)}function nN({attachResizeListener:t,defaultParent:i,measureScroll:c,checkIsScrollRoot:f,resetTransform:_}){return class{constructor(E={},o=i==null?void 0:i()){this.id=yZ++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,q_&&(md.totalNodes=md.resolvedTargetDeltas=md.recalculatedProjection=0),this.nodes.forEach(wZ),this.nodes.forEach(IZ),this.nodes.forEach(AZ),this.nodes.forEach(bZ),q_&&window.MotionDebug.record(md)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=E,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let k=0;k<this.path.length;k++)this.path[k].shouldResetTransform=!0;this.root===this&&(this.nodes=new sZ)}addEventListener(E,o){return this.eventHandlers.has(E)||this.eventHandlers.set(E,new PI),this.eventHandlers.get(E).add(o)}notifyListeners(E,...o){const k=this.eventHandlers.get(E);k&&k.notify(...o)}hasListeners(E){return this.eventHandlers.has(E)}mount(E,o=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=iZ(E),this.instance=E;const{layoutId:k,layout:L,visualElement:N}=this.options;if(N&&!N.current&&N.mount(E),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),o&&(L||k)&&(this.isLayoutDirty=!0),t){let V;const H=()=>this.root.updateBlockedByResize=!1;t(E,()=>{this.root.updateBlockedByResize=!0,V&&V(),V=oZ(H,250),H0.hasAnimatedSinceResize&&(H0.hasAnimatedSinceResize=!1,this.nodes.forEach($D))})}k&&this.root.registerSharedNode(k,this),this.options.animate!==!1&&N&&(k||L)&&this.addEventListener("didUpdate",({delta:V,hasLayoutChanged:H,hasRelativeTargetChanged:ne,layout:ce})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const K=this.options.transition||N.getDefaultTransition()||kZ,{onLayoutAnimationStart:se,onLayoutAnimationComplete:Y}=N.getProps(),Q=!this.targetLayout||!eN(this.targetLayout,ce)||ne,ae=!H&&ne;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||ae||H&&(Q||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(V,ae);const Te={...TI(K,"layout"),onPlay:se,onComplete:Y};(N.shouldReduceMotion||this.options.layoutRoot)&&(Te.delay=0,Te.type=!1),this.startAnimation(Te)}else H||$D(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=ce})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const E=this.getStack();E&&E.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,ch(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(CZ),this.animationId++)}getTransformTemplate(){const{visualElement:E}=this.options;return E&&E.getProps().transformTemplate}willUpdate(E=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&tN(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let N=0;N<this.path.length;N++){const V=this.path[N];V.shouldResetTransform=!0,V.updateScroll("snapshot"),V.options.layoutRoot&&V.willUpdate(!1)}const{layoutId:o,layout:k}=this.options;if(o===void 0&&!k)return;const L=this.getTransformTemplate();this.prevTransformTemplateValue=L?L(this.latestValues,""):void 0,this.updateSnapshot(),E&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(GD);return}this.isUpdating||this.nodes.forEach(SZ),this.isUpdating=!1,this.nodes.forEach(EZ),this.nodes.forEach(vZ),this.nodes.forEach(xZ),this.clearAllSnapshots();const o=$l.now();Ds.delta=Bc(0,1e3/60,o-Ds.timestamp),Ds.timestamp=o,Ds.isProcessing=!0,XT.update.process(Ds),XT.preRender.process(Ds),XT.render.process(Ds),Ds.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,fI.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(TZ),this.sharedNodes.forEach(PZ)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Er.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Er.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let k=0;k<this.path.length;k++)this.path[k].updateScroll();const E=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Zr(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,E?E.layoutBox:void 0)}updateScroll(E="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===E&&(o=!1),o){const k=f(this.instance);this.scroll={animationId:this.root.animationId,phase:E,isRoot:k,offset:c(this.instance),wasRoot:this.scroll?this.scroll.isRoot:k}}}resetTransform(){if(!_)return;const E=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!QF(this.projectionDelta),k=this.getTransformTemplate(),L=k?k(this.latestValues,""):void 0,N=L!==this.prevTransformTemplateValue;E&&(o||pd(this.latestValues)||N)&&(_(this.instance,L),this.shouldResetTransform=!1,this.scheduleRender())}measure(E=!0){const o=this.measurePageBox();let k=this.removeElementScroll(o);return E&&(k=this.removeTransform(k)),DZ(k),{animationId:this.root.animationId,measuredBox:o,layoutBox:k,latestValues:{},source:this.id}}measurePageBox(){var E;const{visualElement:o}=this.options;if(!o)return Zr();const k=o.measureViewportBox();if(!(((E=this.scroll)===null||E===void 0?void 0:E.wasRoot)||this.path.some(LZ))){const{scroll:N}=this.root;N&&($p(k.x,N.offset.x),$p(k.y,N.offset.y))}return k}removeElementScroll(E){var o;const k=Zr();if(xa(k,E),!((o=this.scroll)===null||o===void 0)&&o.wasRoot)return k;for(let L=0;L<this.path.length;L++){const N=this.path[L],{scroll:V,options:H}=N;N!==this.root&&V&&H.layoutScroll&&(V.wasRoot&&xa(k,E),$p(k.x,V.offset.x),$p(k.y,V.offset.y))}return k}applyTransform(E,o=!1){const k=Zr();xa(k,E);for(let L=0;L<this.path.length;L++){const N=this.path[L];!o&&N.options.layoutScroll&&N.scroll&&N!==N.root&&Hp(k,{x:-N.scroll.offset.x,y:-N.scroll.offset.y}),pd(N.latestValues)&&Hp(k,N.latestValues)}return pd(this.latestValues)&&Hp(k,this.latestValues),k}removeTransform(E){const o=Zr();xa(o,E);for(let k=0;k<this.path.length;k++){const L=this.path[k];if(!L.instance||!pd(L.latestValues))continue;F2(L.latestValues)&&L.updateSnapshot();const N=Zr(),V=L.measurePageBox();xa(N,V),OD(o,L.latestValues,L.snapshot?L.snapshot.layoutBox:void 0,N)}return pd(this.latestValues)&&OD(o,this.latestValues),o}setTargetDelta(E){this.targetDelta=E,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(E){this.options={...this.options,...E,crossfade:E.crossfade!==void 0?E.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ds.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(E=!1){var o;const k=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=k.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=k.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=k.isSharedProjectionDirty);const L=!!this.resumingFrom||this!==k;if(!(E||L&&this.isSharedProjectionDirty||this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:V,layoutId:H}=this.options;if(!(!this.layout||!(V||H))){if(this.resolvedRelativeTargetAt=Ds.timestamp,!this.targetDelta&&!this.relativeTarget){const ne=this.getClosestProjectingParent();ne&&ne.layout&&this.animationProgress!==1?(this.relativeParent=ne,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Zr(),this.relativeTargetOrigin=Zr(),hy(this.relativeTargetOrigin,this.layout.layoutBox,ne.layout.layoutBox),xa(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Zr(),this.targetWithTransforms=Zr()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),F9(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):xa(this.target,this.layout.layoutBox),qF(this.target,this.targetDelta)):xa(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const ne=this.getClosestProjectingParent();ne&&!!ne.resumingFrom==!!this.resumingFrom&&!ne.options.layoutScroll&&ne.target&&this.animationProgress!==1?(this.relativeParent=ne,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Zr(),this.relativeTargetOrigin=Zr(),hy(this.relativeTargetOrigin,this.target,ne.target),xa(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}q_&&md.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||F2(this.parent.latestValues)||WF(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var E;const o=this.getLead(),k=!!this.resumingFrom||this!==o;let L=!0;if((this.isProjectionDirty||!((E=this.parent)===null||E===void 0)&&E.isProjectionDirty)&&(L=!1),k&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(L=!1),this.resolvedRelativeTargetAt===Ds.timestamp&&(L=!1),L)return;const{layout:N,layoutId:V}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(N||V))return;xa(this.layoutCorrected,this.layout.layoutBox);const H=this.treeScale.x,ne=this.treeScale.y;W9(this.layoutCorrected,this.treeScale,this.path,k),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=Zr());const{target:ce}=o;if(!ce){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(DD(this.prevProjectionDelta.x,this.projectionDelta.x),DD(this.prevProjectionDelta.y,this.projectionDelta.y)),uy(this.projectionDelta,this.layoutCorrected,ce,this.latestValues),(this.treeScale.x!==H||this.treeScale.y!==ne||!VD(this.projectionDelta.x,this.prevProjectionDelta.x)||!VD(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",ce)),q_&&md.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(E=!0){var o;if((o=this.options.visualElement)===null||o===void 0||o.scheduleRender(),E){const k=this.getStack();k&&k.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Gp(),this.projectionDelta=Gp(),this.projectionDeltaWithTransform=Gp()}setAnimationOrigin(E,o=!1){const k=this.snapshot,L=k?k.latestValues:{},N={...this.latestValues},V=Gp();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const H=Zr(),ne=k?k.source:void 0,ce=this.layout?this.layout.source:void 0,K=ne!==ce,se=this.getStack(),Y=!se||se.members.length<=1,Q=!!(K&&!Y&&this.options.crossfade===!0&&!this.path.some(RZ));this.animationProgress=0;let ae;this.mixTargetDelta=Te=>{const Be=Te/1e3;HD(V.x,E.x,Be),HD(V.y,E.y,Be),this.setTargetDelta(V),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(hy(H,this.layout.layoutBox,this.relativeParent.layout.layoutBox),MZ(this.relativeTarget,this.relativeTargetOrigin,H,Be),ae&&pZ(this.relativeTarget,ae)&&(this.isProjectionDirty=!1),ae||(ae=Zr()),xa(ae,this.relativeTarget)),K&&(this.animationValues=N,lZ(N,L,this.latestValues,Be,Q,Y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Be},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(E){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(ch(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Er.update(()=>{H0.hasAnimatedSinceResize=!0,this.currentAnimation=nZ(0,UD,{...E,onUpdate:o=>{this.mixTargetDelta(o),E.onUpdate&&E.onUpdate(o)},onComplete:()=>{E.onComplete&&E.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const E=this.getStack();E&&E.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(UD),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const E=this.getLead();let{targetWithTransforms:o,target:k,layout:L,latestValues:N}=E;if(!(!o||!k||!L)){if(this!==E&&this.layout&&L&&iN(this.options.animationType,this.layout.layoutBox,L.layoutBox)){k=this.target||Zr();const V=ta(this.layout.layoutBox.x);k.x.min=E.target.x.min,k.x.max=k.x.min+V;const H=ta(this.layout.layoutBox.y);k.y.min=E.target.y.min,k.y.max=k.y.min+H}xa(o,k),Hp(o,N),uy(this.projectionDeltaWithTransform,this.layoutCorrected,o,N)}}registerSharedNode(E,o){this.sharedNodes.has(E)||this.sharedNodes.set(E,new mZ),this.sharedNodes.get(E).add(o);const L=o.options.initialPromotionConfig;o.promote({transition:L?L.transition:void 0,preserveFollowOpacity:L&&L.shouldPreserveFollowOpacity?L.shouldPreserveFollowOpacity(o):void 0})}isLead(){const E=this.getStack();return E?E.lead===this:!0}getLead(){var E;const{layoutId:o}=this.options;return o?((E=this.getStack())===null||E===void 0?void 0:E.lead)||this:this}getPrevLead(){var E;const{layoutId:o}=this.options;return o?(E=this.getStack())===null||E===void 0?void 0:E.prevLead:void 0}getStack(){const{layoutId:E}=this.options;if(E)return this.root.sharedNodes.get(E)}promote({needsReset:E,transition:o,preserveFollowOpacity:k}={}){const L=this.getStack();L&&L.promote(this,k),E&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const E=this.getStack();return E?E.relegate(this):!1}resetSkewAndRotation(){const{visualElement:E}=this.options;if(!E)return;let o=!1;const{latestValues:k}=E;if((k.z||k.rotate||k.rotateX||k.rotateY||k.rotateZ||k.skewX||k.skewY)&&(o=!0),!o)return;const L={};k.z&&sS("z",E,L,this.animationValues);for(let N=0;N<rS.length;N++)sS(`rotate${rS[N]}`,E,L,this.animationValues),sS(`skew${rS[N]}`,E,L,this.animationValues);E.render();for(const N in L)E.setStaticValue(N,L[N]),this.animationValues&&(this.animationValues[N]=L[N]);E.scheduleRender()}getProjectionStyles(E){var o,k;if(!this.instance||this.isSVG)return;if(!this.isVisible)return _Z;const L={visibility:""},N=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,L.opacity="",L.pointerEvents=G0(E==null?void 0:E.pointerEvents)||"",L.transform=N?N(this.latestValues,""):"none",L;const V=this.getLead();if(!this.projectionDelta||!this.layout||!V.target){const K={};return this.options.layoutId&&(K.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,K.pointerEvents=G0(E==null?void 0:E.pointerEvents)||""),this.hasProjected&&!pd(this.latestValues)&&(K.transform=N?N({},""):"none",this.hasProjected=!1),K}const H=V.animationValues||V.latestValues;this.applyTransformsToTarget(),L.transform=gZ(this.projectionDeltaWithTransform,this.treeScale,H),N&&(L.transform=N(H,L.transform));const{x:ne,y:ce}=this.projectionDelta;L.transformOrigin=`${ne.origin*100}% ${ce.origin*100}% 0`,V.animationValues?L.opacity=V===this?(k=(o=H.opacity)!==null&&o!==void 0?o:this.latestValues.opacity)!==null&&k!==void 0?k:1:this.preserveOpacity?this.latestValues.opacity:H.opacityExit:L.opacity=V===this?H.opacity!==void 0?H.opacity:"":H.opacityExit!==void 0?H.opacityExit:0;for(const K in I1){if(H[K]===void 0)continue;const{correct:se,applyTo:Y}=I1[K],Q=L.transform==="none"?H[K]:se(H[K],V);if(Y){const ae=Y.length;for(let Te=0;Te<ae;Te++)L[Y[Te]]=Q}else L[K]=Q}return this.options.layoutId&&(L.pointerEvents=V===this?G0(E==null?void 0:E.pointerEvents)||"":"none"),L}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(E=>{var o;return(o=E.currentAnimation)===null||o===void 0?void 0:o.stop()}),this.root.nodes.forEach(GD),this.root.sharedNodes.clear()}}}function vZ(t){t.updateLayout()}function xZ(t){var i;const c=((i=t.resumeFrom)===null||i===void 0?void 0:i.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&c&&t.hasListeners("didUpdate")){const{layoutBox:f,measuredBox:_}=t.layout,{animationType:w}=t.options,E=c.source!==t.layout.source;w==="size"?wa(V=>{const H=E?c.measuredBox[V]:c.layoutBox[V],ne=ta(H);H.min=f[V].min,H.max=H.min+ne}):iN(w,c.layoutBox,f)&&wa(V=>{const H=E?c.measuredBox[V]:c.layoutBox[V],ne=ta(f[V]);H.max=H.min+ne,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[V].max=t.relativeTarget[V].min+ne)});const o=Gp();uy(o,f,c.layoutBox);const k=Gp();E?uy(k,t.applyTransform(_,!0),c.measuredBox):uy(k,f,c.layoutBox);const L=!QF(o);let N=!1;if(!t.resumeFrom){const V=t.getClosestProjectingParent();if(V&&!V.resumeFrom){const{snapshot:H,layout:ne}=V;if(H&&ne){const ce=Zr();hy(ce,c.layoutBox,H.layoutBox);const K=Zr();hy(K,f,ne.layoutBox),eN(ce,K)||(N=!0),V.options.layoutRoot&&(t.relativeTarget=K,t.relativeTargetOrigin=ce,t.relativeParent=V)}}}t.notifyListeners("didUpdate",{layout:f,snapshot:c,delta:k,layoutDelta:o,hasLayoutChanged:L,hasRelativeTargetChanged:N})}else if(t.isLead()){const{onExitComplete:f}=t.options;f&&f()}t.options.transition=void 0}function wZ(t){q_&&md.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function bZ(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function TZ(t){t.clearSnapshot()}function GD(t){t.clearMeasurements()}function SZ(t){t.isLayoutDirty=!1}function EZ(t){const{visualElement:i}=t.options;i&&i.getProps().onBeforeLayoutMeasure&&i.notify("BeforeLayoutMeasure"),t.resetTransform()}function $D(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function IZ(t){t.resolveTargetDelta()}function AZ(t){t.calcProjection()}function CZ(t){t.resetSkewAndRotation()}function PZ(t){t.removeLeadSnapshot()}function HD(t,i,c){t.translate=Lr(i.translate,0,c),t.scale=Lr(i.scale,1,c),t.origin=i.origin,t.originPoint=i.originPoint}function WD(t,i,c,f){t.min=Lr(i.min,c.min,f),t.max=Lr(i.max,c.max,f)}function MZ(t,i,c,f){WD(t.x,i.x,c.x,f),WD(t.y,i.y,c.y,f)}function RZ(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const kZ={duration:.45,ease:[.4,0,.1,1]},qD=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),ZD=qD("applewebkit/")&&!qD("chrome/")?Math.round:Qo;function XD(t){t.min=ZD(t.min),t.max=ZD(t.max)}function DZ(t){XD(t.x),XD(t.y)}function iN(t,i,c){return t==="position"||t==="preserve-aspect"&&!O9(jD(i),jD(c),.2)}function LZ(t){var i;return t!==t.root&&((i=t.scroll)===null||i===void 0?void 0:i.wasRoot)}const zZ=nN({attachResizeListener:(t,i)=>jy(t,"resize",i),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),oS={current:void 0},rN=nN({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!oS.current){const t=new zZ({});t.mount(window),t.setOptions({layoutScroll:!0}),oS.current=t}return oS.current},resetTransform:(t,i)=>{t.style.transform=i!==void 0?i:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),OZ={pan:{Feature:J9},drag:{Feature:Y9,ProjectionNode:rN,MeasureLayout:KF}};function KD(t,i,c){const{props:f}=t;t.animationState&&f.whileHover&&t.animationState.setActive("whileHover",c==="Start");const _="onHover"+c,w=f[_];w&&Er.postRender(()=>w(i,rv(i)))}class FZ extends gh{mount(){const{current:i}=this.node;i&&(this.unmount=OW(i,c=>(KD(this.node,c,"Start"),f=>KD(this.node,f,"End"))))}unmount(){}}class NZ extends gh{constructor(){super(...arguments),this.isActive=!1}onFocus(){let i=!1;try{i=this.node.current.matches(":focus-visible")}catch{i=!0}!i||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=iv(jy(this.node.current,"focus",()=>this.onFocus()),jy(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function YD(t,i,c){const{props:f}=t;t.animationState&&f.whileTap&&t.animationState.setActive("whileTap",c==="Start");const _="onTap"+(c==="End"?"":c),w=f[_];w&&Er.postRender(()=>w(i,rv(i)))}class BZ extends gh{mount(){const{current:i}=this.node;i&&(this.unmount=jW(i,c=>(YD(this.node,c,"Start"),(f,{success:_})=>YD(this.node,f,_?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const B2=new WeakMap,aS=new WeakMap,jZ=t=>{const i=B2.get(t.target);i&&i(t)},VZ=t=>{t.forEach(jZ)};function UZ({root:t,...i}){const c=t||document;aS.has(c)||aS.set(c,{});const f=aS.get(c),_=JSON.stringify(i);return f[_]||(f[_]=new IntersectionObserver(VZ,{root:t,...i})),f[_]}function GZ(t,i,c){const f=UZ(i);return B2.set(t,c),f.observe(t),()=>{B2.delete(t),f.unobserve(t)}}const $Z={some:0,all:1};class HZ extends gh{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:i={}}=this.node.getProps(),{root:c,margin:f,amount:_="some",once:w}=i,E={root:c?c.current:void 0,rootMargin:f,threshold:typeof _=="number"?_:$Z[_]},o=k=>{const{isIntersecting:L}=k;if(this.isInView===L||(this.isInView=L,w&&!L&&this.hasEnteredView))return;L&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",L);const{onViewportEnter:N,onViewportLeave:V}=this.node.getProps(),H=L?N:V;H&&H(k)};return GZ(this.node.current,E,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:i,prevProps:c}=this.node;["amount","margin","root"].some(WZ(i,c))&&this.startObserver()}unmount(){}}function WZ({viewport:t={}},{viewport:i={}}={}){return c=>t[c]!==i[c]}const qZ={inView:{Feature:HZ},tap:{Feature:BZ},focus:{Feature:NZ},hover:{Feature:FZ}},ZZ={layout:{ProjectionNode:rN,MeasureLayout:KF}},j2={current:null},sN={current:!1};function XZ(){if(sN.current=!0,!!lI)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),i=()=>j2.current=t.matches;t.addListener(i),i()}else j2.current=!1}const KZ=[...MF,Zs,uh],YZ=t=>KZ.find(PF(t)),JD=new WeakMap;function JZ(t,i,c){for(const f in i){const _=i[f],w=c[f];if(Ys(_))t.addValue(f,_);else if(Ys(w))t.addValue(f,Ny(_,{owner:t}));else if(w!==_)if(t.hasValue(f)){const E=t.getValue(f);E.liveStyle===!0?E.jump(_):E.hasAnimated||E.set(_)}else{const E=t.getStaticValue(f);t.addValue(f,Ny(E!==void 0?E:_,{owner:t}))}}for(const f in c)i[f]===void 0&&t.removeValue(f);return i}const QD=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class QZ{scrapeMotionValuesFromProps(i,c,f){return{}}constructor({parent:i,props:c,presenceContext:f,reducedMotionConfig:_,blockInitialAnimation:w,visualState:E},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=zI,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const ne=$l.now();this.renderScheduledAt<ne&&(this.renderScheduledAt=ne,Er.render(this.render,!1,!0))};const{latestValues:k,renderState:L,onUpdate:N}=E;this.onUpdate=N,this.latestValues=k,this.baseTarget={...k},this.initialValues=c.initial?{...k}:{},this.renderState=L,this.parent=i,this.props=c,this.presenceContext=f,this.depth=i?i.depth+1:0,this.reducedMotionConfig=_,this.options=o,this.blockInitialAnimation=!!w,this.isControllingVariants=aw(c),this.isVariantNode=N3(c),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(i&&i.current);const{willChange:V,...H}=this.scrapeMotionValuesFromProps(c,{},this);for(const ne in H){const ce=H[ne];k[ne]!==void 0&&Ys(ce)&&ce.set(k[ne],!1)}}mount(i){this.current=i,JD.set(i,this),this.projection&&!this.projection.instance&&this.projection.mount(i),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((c,f)=>this.bindToMotionValue(f,c)),sN.current||XZ(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:j2.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){JD.delete(this.current),this.projection&&this.projection.unmount(),ch(this.notifyUpdate),ch(this.render),this.valueSubscriptions.forEach(i=>i()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const i in this.events)this.events[i].clear();for(const i in this.features){const c=this.features[i];c&&(c.unmount(),c.isMounted=!1)}this.current=null}bindToMotionValue(i,c){this.valueSubscriptions.has(i)&&this.valueSubscriptions.get(i)();const f=$d.has(i),_=c.on("change",o=>{this.latestValues[i]=o,this.props.onUpdate&&Er.preRender(this.notifyUpdate),f&&this.projection&&(this.projection.isTransformDirty=!0)}),w=c.on("renderRequest",this.scheduleRender);let E;window.MotionCheckAppearSync&&(E=window.MotionCheckAppearSync(this,i,c)),this.valueSubscriptions.set(i,()=>{_(),w(),E&&E(),c.owner&&c.stop()})}sortNodePosition(i){return!this.current||!this.sortInstanceNodePosition||this.type!==i.type?0:this.sortInstanceNodePosition(this.current,i.current)}updateFeatures(){let i="animation";for(i in vm){const c=vm[i];if(!c)continue;const{isEnabled:f,Feature:_}=c;if(!this.features[i]&&_&&f(this.props)&&(this.features[i]=new _(this)),this.features[i]){const w=this.features[i];w.isMounted?w.update():(w.mount(),w.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Zr()}getStaticValue(i){return this.latestValues[i]}setStaticValue(i,c){this.latestValues[i]=c}update(i,c){(i.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=i,this.prevPresenceContext=this.presenceContext,this.presenceContext=c;for(let f=0;f<QD.length;f++){const _=QD[f];this.propEventSubscriptions[_]&&(this.propEventSubscriptions[_](),delete this.propEventSubscriptions[_]);const w="on"+_,E=i[w];E&&(this.propEventSubscriptions[_]=this.on(_,E))}this.prevMotionValues=JZ(this,this.scrapeMotionValuesFromProps(i,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(i){return this.props.variants?this.props.variants[i]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(i){const c=this.getClosestVariantNode();if(c)return c.variantChildren&&c.variantChildren.add(i),()=>c.variantChildren.delete(i)}addValue(i,c){const f=this.values.get(i);c!==f&&(f&&this.removeValue(i),this.bindToMotionValue(i,c),this.values.set(i,c),this.latestValues[i]=c.get())}removeValue(i){this.values.delete(i);const c=this.valueSubscriptions.get(i);c&&(c(),this.valueSubscriptions.delete(i)),delete this.latestValues[i],this.removeValueFromRenderState(i,this.renderState)}hasValue(i){return this.values.has(i)}getValue(i,c){if(this.props.values&&this.props.values[i])return this.props.values[i];let f=this.values.get(i);return f===void 0&&c!==void 0&&(f=Ny(c===null?void 0:c,{owner:this}),this.addValue(i,f)),f}readValue(i,c){var f;let _=this.latestValues[i]!==void 0||!this.current?this.latestValues[i]:(f=this.getBaseTargetFromProps(this.props,i))!==null&&f!==void 0?f:this.readValueFromInstance(this.current,i,this.options);return _!=null&&(typeof _=="string"&&(AF(_)||yF(_))?_=parseFloat(_):!YZ(_)&&uh.test(c)&&(_=SF(i,c)),this.setBaseTarget(i,Ys(_)?_.get():_)),Ys(_)?_.get():_}setBaseTarget(i,c){this.baseTarget[i]=c}getBaseTarget(i){var c;const{initial:f}=this.props;let _;if(typeof f=="string"||typeof f=="object"){const E=mI(this.props,f,(c=this.presenceContext)===null||c===void 0?void 0:c.custom);E&&(_=E[i])}if(f&&_!==void 0)return _;const w=this.getBaseTargetFromProps(this.props,i);return w!==void 0&&!Ys(w)?w:this.initialValues[i]!==void 0&&_===void 0?void 0:this.baseTarget[i]}on(i,c){return this.events[i]||(this.events[i]=new PI),this.events[i].add(c)}notify(i,...c){this.events[i]&&this.events[i].notify(...c)}}class oN extends QZ{constructor(){super(...arguments),this.KeyframeResolver=RF}sortInstanceNodePosition(i,c){return i.compareDocumentPosition(c)&2?1:-1}getBaseTargetFromProps(i,c){return i.style?i.style[c]:void 0}removeValueFromRenderState(i,{vars:c,style:f}){delete c[i],delete f[i]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:i}=this.props;Ys(i)&&(this.childSubscription=i.on("change",c=>{this.current&&(this.current.textContent=`${c}`)}))}}function e7(t){return window.getComputedStyle(t)}class t7 extends oN{constructor(){super(...arguments),this.type="html",this.renderInstance=q3}readValueFromInstance(i,c){if($d.has(c)){const f=LI(c);return f&&f.default||0}else{const f=e7(i),_=($3(c)?f.getPropertyValue(c):f[c])||0;return typeof _=="string"?_.trim():_}}measureInstanceViewportBox(i,{transformPagePoint:c}){return ZF(i,c)}build(i,c,f){yI(i,c,f.transformTemplate)}scrapeMotionValuesFromProps(i,c,f){return bI(i,c,f)}}class n7 extends oN{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Zr}getBaseTargetFromProps(i,c){return i[c]}readValueFromInstance(i,c){if($d.has(c)){const f=LI(c);return f&&f.default||0}return c=Z3.has(c)?c:dI(c),i.getAttribute(c)}scrapeMotionValuesFromProps(i,c,f){return Y3(i,c,f)}build(i,c,f){vI(i,c,this.isSVGTag,f.transformTemplate)}renderInstance(i,c,f,_){X3(i,c,f,_)}mount(i){this.isSVGTag=wI(i.tagName),super.mount(i)}}const i7=(t,i)=>pI(t)?new n7(i):new t7(i,{allowProjection:t!==fe.Fragment}),r7=PW({...A9,...qZ,...OZ,...ZZ},i7),di=$H(r7);function s7(){const{loginWithRedirect:t,isAuthenticated:i,isLoading:c}=ev(),f=Gd();fe.useEffect(()=>{i&&!c&&f("/dashboard")},[i,c,f]);const _=[{icon:oy,title:"Location-Based Recommendations",description:"Get instant card recommendations based on where you shop"},{icon:oh,title:"AI-Powered Insights",description:"Smart recommendations powered by advanced AI technology"},{icon:Nd,title:"Maximize Rewards",description:"Never miss out on earning maximum points and cash back"},{icon:T1,title:"Secure & Private",description:"Your financial data is encrypted and never sold"}];return c?B.jsx("div",{className:"min-h-screen flex items-center justify-center",children:B.jsx("div",{className:"text-center",children:B.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"})})}):B.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-purple-50",children:[B.jsxs("div",{className:"container mx-auto px-4 py-12 md:py-20",children:[B.jsxs(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center max-w-5xl mx-auto",children:[B.jsx(di.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"flex justify-center mb-8",children:B.jsxs("div",{className:"relative",children:[B.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl blur-2xl opacity-40 animate-pulse"}),B.jsx("div",{className:"relative w-24 h-24 bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 rounded-3xl flex items-center justify-center shadow-2xl",children:B.jsx(tm,{className:"w-12 h-12 text-white"})})]})}),B.jsxs(di.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"flex flex-wrap justify-center gap-2 mb-6",children:[B.jsxs(Ks,{variant:"secondary",className:"px-4 py-1.5 text-sm font-medium",children:[B.jsx(ay,{className:"w-3 h-3 mr-1 inline fill-current"}),"AI-Powered"]}),B.jsxs(Ks,{variant:"secondary",className:"px-4 py-1.5 text-sm font-medium",children:[B.jsx(em,{className:"w-3 h-3 mr-1 inline"}),"Smart Rewards"]}),B.jsxs(Ks,{variant:"secondary",className:"px-4 py-1.5 text-sm font-medium",children:[B.jsx(CH,{className:"w-3 h-3 mr-1 inline"}),"100% Secure"]})]}),B.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-gray-900 mb-6 leading-tight",children:["Maximize Every"," ",B.jsx("span",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Purchase"}),B.jsx("br",{}),"with SwipeRight"]}),B.jsxs("p",{className:"text-xl md:text-2xl text-gray-600 mb-10 leading-relaxed max-w-3xl mx-auto",children:["Stop leaving money on the table. Get instant, AI-powered credit card recommendations based on your location and spending patterns. ",B.jsx("span",{className:"font-semibold text-primary",children:"Make every swipe count."})]}),B.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center",children:[B.jsxs($r,{onClick:()=>t(),size:"lg",className:"text-lg px-10 py-7 w-full sm:w-auto shadow-xl hover:shadow-2xl transition-all duration-300 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:[B.jsx(S1,{className:"w-5 h-5 mr-2"}),"Start Earning More"]}),B.jsx($r,{variant:"outline",size:"lg",className:"text-lg px-10 py-7 w-full sm:w-auto border-2 hover:bg-gray-50",onClick:()=>{var w;return(w=document.getElementById("features"))==null?void 0:w.scrollIntoView({behavior:"smooth"})},children:"See How It Works"})]}),B.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-6 mt-8 text-sm text-gray-500",children:[B.jsxs("span",{className:"flex items-center gap-2",children:[B.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Free to use"]}),B.jsx("span",{children:""}),B.jsx("span",{children:"No credit card required"}),B.jsx("span",{children:""}),B.jsx("span",{children:"2-minute setup"})]})]}),B.jsx(di.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2},className:"mt-20 max-w-5xl mx-auto",children:B.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl p-8 border border-gray-200/50 relative overflow-hidden",children:[B.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-gradient-to-bl from-blue-100/50 to-transparent rounded-full -translate-y-48 translate-x-48"}),B.jsxs("div",{className:"aspect-video bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 rounded-2xl flex items-center justify-center relative overflow-hidden shadow-inner",children:[B.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-5"}),B.jsxs("div",{className:"text-center relative z-10",children:[B.jsxs("div",{className:"flex justify-center gap-4 mb-6",children:[B.jsx("div",{className:"w-16 h-16 bg-white rounded-2xl shadow-lg flex items-center justify-center animate-bounce",children:B.jsx(oy,{className:"w-8 h-8 text-blue-600"})}),B.jsx("div",{className:"w-16 h-16 bg-white rounded-2xl shadow-lg flex items-center justify-center animate-bounce",style:{animationDelay:"0.2s"},children:B.jsx(tm,{className:"w-8 h-8 text-purple-600"})}),B.jsx("div",{className:"w-16 h-16 bg-white rounded-2xl shadow-lg flex items-center justify-center animate-bounce",style:{animationDelay:"0.4s"},children:B.jsx(oh,{className:"w-8 h-8 text-pink-600"})})]}),B.jsx("p",{className:"text-gray-700 font-semibold text-lg",children:"Interactive Map & Smart Recommendations"}),B.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Real-time insights for every location"})]})]})]})})]}),B.jsxs("div",{id:"features",className:"container mx-auto px-4 py-16",children:[B.jsxs(di.div,{initial:{opacity:0},whileInView:{opacity:1},viewport:{once:!0},transition:{duration:.6},className:"text-center mb-12",children:[B.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Why SwipeRight?"}),B.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Make every swipe count with intelligent, personalized recommendations"})]}),B.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-7xl mx-auto",children:_.map((w,E)=>{const o=w.icon,k=["from-blue-500 to-blue-600","from-purple-500 to-purple-600","from-pink-500 to-pink-600","from-indigo-500 to-indigo-600"];return B.jsxs(di.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.5,delay:E*.1},whileHover:{y:-8,transition:{duration:.2}},className:"bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-lg border border-gray-100 hover:shadow-2xl transition-all group",children:[B.jsx("div",{className:`w-14 h-14 bg-gradient-to-br ${k[E]} rounded-xl flex items-center justify-center mb-4 shadow-lg group-hover:scale-110 transition-transform`,children:B.jsx(o,{className:"w-7 h-7 text-white"})}),B.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2 group-hover:text-primary transition-colors",children:w.title}),B.jsx("p",{className:"text-gray-600 leading-relaxed",children:w.description})]},w.title)})})]}),B.jsx("div",{className:"container mx-auto px-4 py-20",children:B.jsxs(di.div,{initial:{opacity:0,scale:.95},whileInView:{opacity:1,scale:1},viewport:{once:!0},transition:{duration:.6},className:"relative bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 rounded-3xl p-12 md:p-16 text-center text-white overflow-hidden shadow-2xl",children:[B.jsx("div",{className:"absolute inset-0 bg-grid-white/10"}),B.jsx("div",{className:"absolute top-10 left-10 w-32 h-32 bg-white/10 rounded-full blur-3xl"}),B.jsx("div",{className:"absolute bottom-10 right-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"}),B.jsxs("div",{className:"relative z-10",children:[B.jsxs(di.div,{initial:{scale:0},whileInView:{scale:1},viewport:{once:!0},transition:{delay:.2,type:"spring"},className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full mb-6",children:[B.jsx(oh,{className:"w-4 h-4"}),B.jsx("span",{className:"text-sm font-medium",children:"Limited Time: Get Premium Free for 3 Months"})]}),B.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Ready to Maximize Your Rewards?"}),B.jsx("p",{className:"text-xl md:text-2xl mb-8 opacity-95 max-w-2xl mx-auto",children:"Join thousands of smart spenders already earning 3x more with optimized card usage"}),B.jsxs($r,{onClick:()=>t(),size:"lg",variant:"secondary",className:"text-lg px-10 py-7 hover:scale-105 transition-transform shadow-xl",children:[B.jsx(S1,{className:"w-5 h-5 mr-2"}),"Start Earning More Today"]}),B.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-8 mt-10 text-sm",children:[B.jsxs("span",{className:"flex items-center gap-2",children:[B.jsx(T1,{className:"w-5 h-5"}),"Bank-level security"]}),B.jsxs("span",{className:"flex items-center gap-2",children:[B.jsx(ay,{className:"w-5 h-5 fill-current"}),"4.9/5 rating"]}),B.jsxs("span",{className:"flex items-center gap-2",children:[B.jsx(Nd,{className:"w-5 h-5"}),"Average 3x rewards boost"]})]})]})]})}),B.jsx("footer",{className:"container mx-auto px-4 py-12 border-t border-gray-300",children:B.jsxs("div",{className:"max-w-4xl mx-auto",children:[B.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-6",children:[B.jsxs("div",{className:"flex items-center gap-3",children:[B.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center",children:B.jsx(tm,{className:"w-5 h-5 text-white"})}),B.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"SwipeRight"})]}),B.jsxs("div",{className:"flex gap-6 text-sm text-gray-600",children:[B.jsx("a",{href:"#",className:"hover:text-primary transition-colors",children:"Privacy Policy"}),B.jsx("a",{href:"#",className:"hover:text-primary transition-colors",children:"Terms of Service"}),B.jsx("a",{href:"#",className:"hover:text-primary transition-colors",children:"Contact"})]})]}),B.jsx("div",{className:"text-center text-gray-500 text-sm mt-8",children:B.jsx("p",{children:" 2024 SwipeRight. All rights reserved. Made with  for smart spenders."})})]})})]})}const Xr=fe.forwardRef(({className:t,...i},c)=>B.jsx("div",{ref:c,className:or("rounded-lg border bg-card text-card-foreground shadow-sm",t),...i}));Xr.displayName="Card";const wo=fe.forwardRef(({className:t,...i},c)=>B.jsx("div",{ref:c,className:or("flex flex-col space-y-1.5 p-6",t),...i}));wo.displayName="CardHeader";const bo=fe.forwardRef(({className:t,...i},c)=>B.jsx("h3",{ref:c,className:or("text-2xl font-semibold leading-none tracking-tight",t),...i}));bo.displayName="CardTitle";const Vy=fe.forwardRef(({className:t,...i},c)=>B.jsx("p",{ref:c,className:or("text-sm text-muted-foreground",t),...i}));Vy.displayName="CardDescription";const Kr=fe.forwardRef(({className:t,...i},c)=>B.jsx("div",{ref:c,className:or("p-6 pt-0",t),...i}));Kr.displayName="CardContent";const o7=fe.forwardRef(({className:t,...i},c)=>B.jsx("div",{ref:c,className:or("flex items-center p-6 pt-0",t),...i}));o7.displayName="CardFooter";function a7(){const{user:t}=ev(),i=Gd(),c=["Automatic transaction categorization","Real spending pattern analysis","More accurate card recommendations","No manual data entry required"],f=["Full privacy control","Set your own budget categories","Faster setup process","Focus on goals, not history"];return B.jsx("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 to-white py-12 px-4",children:B.jsxs("div",{className:"max-w-5xl mx-auto",children:[B.jsxs(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center mb-12",children:[B.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:["Welcome, ",(t==null?void 0:t.name)||"there","! "]}),B.jsx("p",{className:"text-xl text-gray-600",children:"How would you like to set up your profile?"}),B.jsxs("div",{className:"mt-6 flex items-center justify-center gap-2",children:[B.jsx("div",{className:"w-8 h-2 rounded-full bg-primary"}),B.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-300"}),B.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-300"})]})]}),B.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[B.jsx(di.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:B.jsxs(Xr,{className:"h-full hover:shadow-lg transition-shadow border-2 hover:border-primary",children:[B.jsxs(wo,{children:[B.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center mb-4",children:B.jsx(AH,{className:"w-8 h-8 text-blue-600"})}),B.jsx(bo,{className:"text-2xl",children:"Link Bank Account"}),B.jsx(Vy,{className:"text-base",children:"Connect your bank for personalized insights"})]}),B.jsxs(Kr,{children:[B.jsx("ul",{className:"space-y-3 mb-6",children:c.map(_=>B.jsxs("li",{className:"flex items-start gap-2",children:[B.jsx(S2,{className:"w-5 h-5 text-green-500 mt-0.5 flex-shrink-0"}),B.jsx("span",{className:"text-gray-700",children:_})]},_))}),B.jsx($r,{onClick:()=>i("/onboarding/link-bank"),className:"w-full",size:"lg",children:"Link Bank Account"}),B.jsx("p",{className:"text-xs text-gray-500 mt-3 text-center",children:" Secured with bank-level encryption"})]})]})}),B.jsx(di.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.3},children:B.jsxs(Xr,{className:"h-full hover:shadow-lg transition-shadow border-2 hover:border-primary",children:[B.jsxs(wo,{children:[B.jsx("div",{className:"w-16 h-16 bg-purple-100 rounded-xl flex items-center justify-center mb-4",children:B.jsx(RH,{className:"w-8 h-8 text-purple-600"})}),B.jsx(bo,{className:"text-2xl",children:"Manual Setup"}),B.jsx(Vy,{className:"text-base",children:"Enter your spending preferences manually"})]}),B.jsxs(Kr,{children:[B.jsx("ul",{className:"space-y-3 mb-6",children:f.map(_=>B.jsxs("li",{className:"flex items-start gap-2",children:[B.jsx(S2,{className:"w-5 h-5 text-green-500 mt-0.5 flex-shrink-0"}),B.jsx("span",{className:"text-gray-700",children:_})]},_))}),B.jsx($r,{onClick:()=>i("/onboarding/manual-setup"),className:"w-full",size:"lg",variant:"outline",children:"Manual Setup"}),B.jsx("p",{className:"text-xs text-gray-500 mt-3 text-center",children:" Takes less than 3 minutes"})]})]})})]}),B.jsxs(di.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.5},className:"text-center mt-8",children:[B.jsx("p",{className:"text-sm text-gray-500",children:"You can always change this later in your profile settings"}),B.jsx("button",{onClick:()=>i("/home"),className:"text-sm text-gray-400 hover:text-gray-600 underline mt-4 transition-colors",children:"Skip for now (not recommended for accurate results)"})]})]})})}function l7(t=30){const i=[],c=["dining","gas","groceries","travel","shopping","entertainment"],f={dining:["Chipotle","Starbucks","McDonald's","Panera Bread","Local Restaurant","Pizza Place"],gas:["Shell","Chevron","BP","ExxonMobil","7-Eleven Gas"],groceries:["Whole Foods","Trader Joe's","Safeway","Walmart Grocery","Target"],travel:["United Airlines","Marriott Hotel","Hertz Rental","Uber","Airbnb"],shopping:["Amazon","Best Buy","Apple Store","Nordstrom","Target"],entertainment:["Netflix","Spotify","AMC Theatres","Concert Tickets","Gym Membership"]},_={dining:[8,75],gas:[30,80],groceries:[50,200],travel:[100,800],shopping:[20,500],entertainment:[10,150]};for(let w=0;w<t;w++){const E=new Date;E.setDate(E.getDate()-w);const o=Math.floor(Math.random()*4)+1;for(let k=0;k<o;k++){const L=c[Math.floor(Math.random()*c.length)],N=f[L],V=N[Math.floor(Math.random()*N.length)],[H,ne]=_[L],ce=Math.random()*(ne-H)+H;i.push({id:`tx-${w}-${k}-${Date.now()}`,amount:Math.round(ce*100)/100,date:E.toISOString().split("T")[0],merchant:V,category:L,account:"Checking Account"})}}return i.sort((w,E)=>new Date(E.date).getTime()-new Date(w.date).getTime())}function c7(t){const i={dining:0,gas:0,groceries:0,travel:0,shopping:0,entertainment:0};return t.forEach(c=>{i[c.category]!==void 0&&(i[c.category]+=c.amount)}),i}const u7={},eL=t=>{let i;const c=new Set,f=(N,V)=>{const H=typeof N=="function"?N(i):N;if(!Object.is(H,i)){const ne=i;i=V??(typeof H!="object"||H===null)?H:Object.assign({},i,H),c.forEach(ce=>ce(i,ne))}},_=()=>i,k={setState:f,getState:_,getInitialState:()=>L,subscribe:N=>(c.add(N),()=>c.delete(N)),destroy:()=>{(u7?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),c.clear()}},L=i=t(f,_,k);return k},h7=t=>t?eL(t):eL;var aN={exports:{}},lN={},cN={exports:{}},uN={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wm=fe;function d7(t,i){return t===i&&(t!==0||1/t===1/i)||t!==t&&i!==i}var f7=typeof Object.is=="function"?Object.is:d7,p7=wm.useState,m7=wm.useEffect,g7=wm.useLayoutEffect,_7=wm.useDebugValue;function y7(t,i){var c=i(),f=p7({inst:{value:c,getSnapshot:i}}),_=f[0].inst,w=f[1];return g7(function(){_.value=c,_.getSnapshot=i,lS(_)&&w({inst:_})},[t,c,i]),m7(function(){return lS(_)&&w({inst:_}),t(function(){lS(_)&&w({inst:_})})},[t]),_7(c),c}function lS(t){var i=t.getSnapshot;t=t.value;try{var c=i();return!f7(t,c)}catch{return!0}}function v7(t,i){return i()}var x7=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?v7:y7;uN.useSyncExternalStore=wm.useSyncExternalStore!==void 0?wm.useSyncExternalStore:x7;cN.exports=uN;var hN=cN.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uw=fe,w7=hN;function b7(t,i){return t===i&&(t!==0||1/t===1/i)||t!==t&&i!==i}var T7=typeof Object.is=="function"?Object.is:b7,S7=w7.useSyncExternalStore,E7=uw.useRef,I7=uw.useEffect,A7=uw.useMemo,C7=uw.useDebugValue;lN.useSyncExternalStoreWithSelector=function(t,i,c,f,_){var w=E7(null);if(w.current===null){var E={hasValue:!1,value:null};w.current=E}else E=w.current;w=A7(function(){function k(ne){if(!L){if(L=!0,N=ne,ne=f(ne),_!==void 0&&E.hasValue){var ce=E.value;if(_(ce,ne))return V=ce}return V=ne}if(ce=V,T7(N,ne))return ce;var K=f(ne);return _!==void 0&&_(ce,K)?(N=ne,ce):(N=ne,V=K)}var L=!1,N,V,H=c===void 0?null:c;return[function(){return k(i())},H===null?void 0:function(){return k(H())}]},[i,c,f,_]);var o=S7(t,w[0],w[1]);return I7(function(){E.hasValue=!0,E.value=o},[o]),C7(o),o};aN.exports=lN;var P7=aN.exports;const M7=O1(P7),dN={},{useDebugValue:R7}=Ka,{useSyncExternalStoreWithSelector:k7}=M7;let tL=!1;const D7=t=>t;function L7(t,i=D7,c){(dN?"production":void 0)!=="production"&&c&&!tL&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),tL=!0);const f=k7(t.subscribe,t.getState,t.getServerState||t.getInitialState,i,c);return R7(f),f}const z7=t=>{(dN?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const i=typeof t=="function"?h7(t):t,c=(f,_)=>L7(i,f,_);return Object.assign(c,i),c},O7=t=>z7,F7={};function N7(t,i){let c;try{c=t()}catch{return}return{getItem:_=>{var w;const E=k=>k===null?null:JSON.parse(k,void 0),o=(w=c.getItem(_))!=null?w:null;return o instanceof Promise?o.then(E):E(o)},setItem:(_,w)=>c.setItem(_,JSON.stringify(w,void 0)),removeItem:_=>c.removeItem(_)}}const Uy=t=>i=>{try{const c=t(i);return c instanceof Promise?c:{then(f){return Uy(f)(c)},catch(f){return this}}}catch(c){return{then(f){return this},catch(f){return Uy(f)(c)}}}},B7=(t,i)=>(c,f,_)=>{let w={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:se=>se,version:0,merge:(se,Y)=>({...Y,...se}),...i},E=!1;const o=new Set,k=new Set;let L;try{L=w.getStorage()}catch{}if(!L)return t((...se)=>{console.warn(`[zustand persist middleware] Unable to update item '${w.name}', the given storage is currently unavailable.`),c(...se)},f,_);const N=Uy(w.serialize),V=()=>{const se=w.partialize({...f()});let Y;const Q=N({state:se,version:w.version}).then(ae=>L.setItem(w.name,ae)).catch(ae=>{Y=ae});if(Y)throw Y;return Q},H=_.setState;_.setState=(se,Y)=>{H(se,Y),V()};const ne=t((...se)=>{c(...se),V()},f,_);let ce;const K=()=>{var se;if(!L)return;E=!1,o.forEach(Q=>Q(f()));const Y=((se=w.onRehydrateStorage)==null?void 0:se.call(w,f()))||void 0;return Uy(L.getItem.bind(L))(w.name).then(Q=>{if(Q)return w.deserialize(Q)}).then(Q=>{if(Q)if(typeof Q.version=="number"&&Q.version!==w.version){if(w.migrate)return w.migrate(Q.state,Q.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return Q.state}).then(Q=>{var ae;return ce=w.merge(Q,(ae=f())!=null?ae:ne),c(ce,!0),V()}).then(()=>{Y==null||Y(ce,void 0),E=!0,k.forEach(Q=>Q(ce))}).catch(Q=>{Y==null||Y(void 0,Q)})};return _.persist={setOptions:se=>{w={...w,...se},se.getStorage&&(L=se.getStorage())},clearStorage:()=>{L==null||L.removeItem(w.name)},getOptions:()=>w,rehydrate:()=>K(),hasHydrated:()=>E,onHydrate:se=>(o.add(se),()=>{o.delete(se)}),onFinishHydration:se=>(k.add(se),()=>{k.delete(se)})},K(),ce||ne},j7=(t,i)=>(c,f,_)=>{let w={storage:N7(()=>localStorage),partialize:K=>K,version:0,merge:(K,se)=>({...se,...K}),...i},E=!1;const o=new Set,k=new Set;let L=w.storage;if(!L)return t((...K)=>{console.warn(`[zustand persist middleware] Unable to update item '${w.name}', the given storage is currently unavailable.`),c(...K)},f,_);const N=()=>{const K=w.partialize({...f()});return L.setItem(w.name,{state:K,version:w.version})},V=_.setState;_.setState=(K,se)=>{V(K,se),N()};const H=t((...K)=>{c(...K),N()},f,_);_.getInitialState=()=>H;let ne;const ce=()=>{var K,se;if(!L)return;E=!1,o.forEach(Q=>{var ae;return Q((ae=f())!=null?ae:H)});const Y=((se=w.onRehydrateStorage)==null?void 0:se.call(w,(K=f())!=null?K:H))||void 0;return Uy(L.getItem.bind(L))(w.name).then(Q=>{if(Q)if(typeof Q.version=="number"&&Q.version!==w.version){if(w.migrate)return[!0,w.migrate(Q.state,Q.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,Q.state];return[!1,void 0]}).then(Q=>{var ae;const[Te,Be]=Q;if(ne=w.merge(Be,(ae=f())!=null?ae:H),c(ne,!0),Te)return N()}).then(()=>{Y==null||Y(ne,void 0),ne=f(),E=!0,k.forEach(Q=>Q(ne))}).catch(Q=>{Y==null||Y(void 0,Q)})};return _.persist={setOptions:K=>{w={...w,...K},K.storage&&(L=K.storage)},clearStorage:()=>{L==null||L.removeItem(w.name)},getOptions:()=>w,rehydrate:()=>ce(),hasHydrated:()=>E,onHydrate:K=>(o.add(K),()=>{o.delete(K)}),onFinishHydration:K=>(k.add(K),()=>{k.delete(K)})},w.skipHydration||ce(),ne||H},V7=(t,i)=>"getStorage"in i||"serialize"in i||"deserialize"in i?((F7?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),B7(t,i)):j7(t,i),U7=V7,nL={location:null,budget:null,currentCards:[],onboardingCompleted:!1,linkedBank:!1},sv=O7()(U7(t=>({...nL,setLocation:i=>t({location:i}),setBudget:i=>t({budget:i}),setCurrentCards:i=>t({currentCards:i}),setOnboardingCompleted:i=>t({onboardingCompleted:i}),setLinkedBank:i=>t({linkedBank:i}),reset:()=>t(nL)}),{name:"user-storage"})),iL=[{id:"chase",name:"Chase",logo:""},{id:"bofa",name:"Bank of America",logo:""},{id:"wells",name:"Wells Fargo",logo:""},{id:"citi",name:"Citibank",logo:""}];function G7(){var H;const t=Gd(),[i,c]=fe.useState(null),[f,_]=fe.useState(!1),[w,E]=fe.useState("select"),{setBudget:o,setLinkedBank:k,setOnboardingCompleted:L}=sv(),N=ne=>{c(ne),E("login")},V=async ne=>{ne.preventDefault(),_(!0),E("processing"),await new Promise(se=>setTimeout(se,2e3));const ce=l7(30),K=c7(ce);o({dining:Math.round(K.dining),gas:Math.round(K.gas),groceries:Math.round(K.groceries),travel:Math.round(K.travel),shopping:Math.round(K.shopping),entertainment:Math.round(K.entertainment)}),k(!0),E("success"),_(!1),setTimeout(()=>{L(!0),t("/dashboard")},2e3)};return B.jsx("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 to-white py-12 px-4",children:B.jsxs("div",{className:"max-w-3xl mx-auto",children:[B.jsxs(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[B.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Link Your Bank Account"}),B.jsx("p",{className:"text-gray-600",children:"Securely connect your bank to analyze spending patterns"}),B.jsxs("div",{className:"mt-6 flex items-center justify-center gap-2",children:[B.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-300"}),B.jsx("div",{className:"w-8 h-2 rounded-full bg-primary"}),B.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-300"})]})]}),w==="select"&&B.jsx(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"grid grid-cols-2 gap-4",children:iL.map(ne=>B.jsx(Xr,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>N(ne.id),children:B.jsxs(Kr,{className:"pt-6 text-center",children:[B.jsx("div",{className:"text-5xl mb-3",children:ne.logo}),B.jsx("p",{className:"font-semibold",children:ne.name})]})},ne.id))}),w==="login"&&B.jsx(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:B.jsxs(Xr,{children:[B.jsx(wo,{children:B.jsxs(bo,{children:["Login to ",(H=iL.find(ne=>ne.id===i))==null?void 0:H.name]})}),B.jsx(Kr,{children:B.jsxs("form",{onSubmit:V,className:"space-y-4",children:[B.jsxs("div",{children:[B.jsx("label",{className:"block text-sm font-medium mb-2",children:"Username"}),B.jsx("input",{type:"text",defaultValue:"demo_user",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary",required:!0})]}),B.jsxs("div",{children:[B.jsx("label",{className:"block text-sm font-medium mb-2",children:"Password"}),B.jsx("input",{type:"password",defaultValue:"demo_pass",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary",required:!0})]}),B.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-800",children:[B.jsx("p",{className:"font-semibold mb-1",children:" Demo Mode"}),B.jsx("p",{children:"This is a simulation. No real bank connection is made."})]}),B.jsxs("div",{className:"flex gap-3",children:[B.jsx($r,{type:"button",variant:"outline",onClick:()=>E("select"),className:"flex-1",children:"Back"}),B.jsx($r,{type:"submit",className:"flex-1",disabled:f,children:"Connect Account"})]})]})})]})}),w==="processing"&&B.jsx(di.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:B.jsx(Xr,{children:B.jsxs(Kr,{className:"pt-12 pb-12",children:[B.jsx(oI,{className:"w-16 h-16 text-primary animate-spin mx-auto mb-6"}),B.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Analyzing Your Spending"}),B.jsx("p",{className:"text-gray-600",children:"Processing your transactions..."})]})})}),w==="success"&&B.jsx(di.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:B.jsx(Xr,{children:B.jsxs(Kr,{className:"pt-12 pb-12",children:[B.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:B.jsx(S2,{className:"w-10 h-10 text-green-600"})}),B.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Successfully Connected!"}),B.jsx("p",{className:"text-gray-600",children:"Redirecting to your dashboard..."})]})})})]})})}function fN(t,[i,c]){return Math.min(c,Math.max(i,t))}function Rr(t,i,{checkForDefaultPrevented:c=!0}={}){return function(_){if(t==null||t(_),c===!1||!_.defaultPrevented)return i==null?void 0:i(_)}}function rL(t,i){if(typeof t=="function")return t(i);t!=null&&(t.current=i)}function pN(...t){return i=>{let c=!1;const f=t.map(_=>{const w=rL(_,i);return!c&&typeof w=="function"&&(c=!0),w});if(c)return()=>{for(let _=0;_<f.length;_++){const w=f[_];typeof w=="function"?w():rL(t[_],null)}}}}function Fs(...t){return fe.useCallback(pN(...t),t)}function $7(t,i){const c=fe.createContext(i),f=w=>{const{children:E,...o}=w,k=fe.useMemo(()=>o,Object.values(o));return B.jsx(c.Provider,{value:k,children:E})};f.displayName=t+"Provider";function _(w){const E=fe.useContext(c);if(E)return E;if(i!==void 0)return i;throw new Error(`\`${w}\` must be used within \`${t}\``)}return[f,_]}function Rm(t,i=[]){let c=[];function f(w,E){const o=fe.createContext(E),k=c.length;c=[...c,E];const L=V=>{var Y;const{scope:H,children:ne,...ce}=V,K=((Y=H==null?void 0:H[t])==null?void 0:Y[k])||o,se=fe.useMemo(()=>ce,Object.values(ce));return B.jsx(K.Provider,{value:se,children:ne})};L.displayName=w+"Provider";function N(V,H){var K;const ne=((K=H==null?void 0:H[t])==null?void 0:K[k])||o,ce=fe.useContext(ne);if(ce)return ce;if(E!==void 0)return E;throw new Error(`\`${V}\` must be used within \`${w}\``)}return[L,N]}const _=()=>{const w=c.map(E=>fe.createContext(E));return function(o){const k=(o==null?void 0:o[t])||w;return fe.useMemo(()=>({[`__scope${t}`]:{...o,[t]:k}}),[o,k])}};return _.scopeName=t,[f,H7(_,...i)]}function H7(...t){const i=t[0];if(t.length===1)return i;const c=()=>{const f=t.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(w){const E=f.reduce((o,{useScope:k,scopeName:L})=>{const V=k(w)[`__scope${L}`];return{...o,...V}},{});return fe.useMemo(()=>({[`__scope${i.scopeName}`]:E}),[E])}};return c.scopeName=i.scopeName,c}var Hl=globalThis!=null&&globalThis.document?fe.useLayoutEffect:()=>{},W7=nE[" useInsertionEffect ".trim().toString()]||Hl;function BI({prop:t,defaultProp:i,onChange:c=()=>{},caller:f}){const[_,w,E]=q7({defaultProp:i,onChange:c}),o=t!==void 0,k=o?t:_;{const N=fe.useRef(t!==void 0);fe.useEffect(()=>{const V=N.current;V!==o&&console.warn(`${f} is changing from ${V?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),N.current=o},[o,f])}const L=fe.useCallback(N=>{var V;if(o){const H=Z7(N)?N(t):N;H!==t&&((V=E.current)==null||V.call(E,H))}else w(N)},[o,t,w,E]);return[k,L]}function q7({defaultProp:t,onChange:i}){const[c,f]=fe.useState(t),_=fe.useRef(c),w=fe.useRef(i);return W7(()=>{w.current=i},[i]),fe.useEffect(()=>{var E;_.current!==c&&((E=w.current)==null||E.call(w,c),_.current=c)},[c,_]),[c,f,w]}function Z7(t){return typeof t=="function"}var X7=fe.createContext(void 0);function K7(t){const i=fe.useContext(X7);return t||i||"ltr"}function Y7(t){const i=fe.useRef({value:t,previous:t});return fe.useMemo(()=>(i.current.value!==t&&(i.current.previous=i.current.value,i.current.value=t),i.current.previous),[t])}function J7(t){const[i,c]=fe.useState(void 0);return Hl(()=>{if(t){c({width:t.offsetWidth,height:t.offsetHeight});const f=new ResizeObserver(_=>{if(!Array.isArray(_)||!_.length)return;const w=_[0];let E,o;if("borderBoxSize"in w){const k=w.borderBoxSize,L=Array.isArray(k)?k[0]:k;E=L.inlineSize,o=L.blockSize}else E=t.offsetWidth,o=t.offsetHeight;c({width:E,height:o})});return f.observe(t,{box:"border-box"}),()=>f.unobserve(t)}else c(void 0)},[t]),i}function k1(t){const i=Q7(t),c=fe.forwardRef((f,_)=>{const{children:w,...E}=f,o=fe.Children.toArray(w),k=o.find(tX);if(k){const L=k.props.children,N=o.map(V=>V===k?fe.Children.count(L)>1?fe.Children.only(null):fe.isValidElement(L)?L.props.children:null:V);return B.jsx(i,{...E,ref:_,children:fe.isValidElement(L)?fe.cloneElement(L,void 0,N):null})}return B.jsx(i,{...E,ref:_,children:w})});return c.displayName=`${t}.Slot`,c}function Q7(t){const i=fe.forwardRef((c,f)=>{const{children:_,...w}=c;if(fe.isValidElement(_)){const E=iX(_),o=nX(w,_.props);return _.type!==fe.Fragment&&(o.ref=f?pN(f,E):E),fe.cloneElement(_,o)}return fe.Children.count(_)>1?fe.Children.only(null):null});return i.displayName=`${t}.SlotClone`,i}var eX=Symbol("radix.slottable");function tX(t){return fe.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===eX}function nX(t,i){const c={...i};for(const f in i){const _=t[f],w=i[f];/^on[A-Z]/.test(f)?_&&w?c[f]=(...o)=>{const k=w(...o);return _(...o),k}:_&&(c[f]=_):f==="style"?c[f]={..._,...w}:f==="className"&&(c[f]=[_,w].filter(Boolean).join(" "))}return{...t,...c}}function iX(t){var f,_;let i=(f=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:f.get,c=i&&"isReactWarning"in i&&i.isReactWarning;return c?t.ref:(i=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,c=i&&"isReactWarning"in i&&i.isReactWarning,c?t.props.ref:t.props.ref||t.ref)}var rX=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ar=rX.reduce((t,i)=>{const c=k1(`Primitive.${i}`),f=fe.forwardRef((_,w)=>{const{asChild:E,...o}=_,k=E?c:i;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),B.jsx(k,{...o,ref:w})});return f.displayName=`Primitive.${i}`,{...t,[i]:f}},{});function mN(t,i){t&&Q1.flushSync(()=>t.dispatchEvent(i))}function gN(t){const i=t+"CollectionProvider",[c,f]=Rm(i),[_,w]=c(i,{collectionRef:{current:null},itemMap:new Map}),E=K=>{const{scope:se,children:Y}=K,Q=Ka.useRef(null),ae=Ka.useRef(new Map).current;return B.jsx(_,{scope:se,itemMap:ae,collectionRef:Q,children:Y})};E.displayName=i;const o=t+"CollectionSlot",k=k1(o),L=Ka.forwardRef((K,se)=>{const{scope:Y,children:Q}=K,ae=w(o,Y),Te=Fs(se,ae.collectionRef);return B.jsx(k,{ref:Te,children:Q})});L.displayName=o;const N=t+"CollectionItemSlot",V="data-radix-collection-item",H=k1(N),ne=Ka.forwardRef((K,se)=>{const{scope:Y,children:Q,...ae}=K,Te=Ka.useRef(null),Be=Fs(se,Te),et=w(N,Y);return Ka.useEffect(()=>(et.itemMap.set(Te,{ref:Te,...ae}),()=>void et.itemMap.delete(Te))),B.jsx(H,{[V]:"",ref:Be,children:Q})});ne.displayName=N;function ce(K){const se=w(t+"CollectionConsumer",K);return Ka.useCallback(()=>{const Q=se.collectionRef.current;if(!Q)return[];const ae=Array.from(Q.querySelectorAll(`[${V}]`));return Array.from(se.itemMap.values()).sort((et,nt)=>ae.indexOf(et.ref.current)-ae.indexOf(nt.ref.current))},[se.collectionRef,se.itemMap])}return[{Provider:E,Slot:L,ItemSlot:ne},ce,f]}var _N=["PageUp","PageDown"],yN=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],vN={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},km="Slider",[V2,sX,oX]=gN(km),[xN]=Rm(km,[oX]),[aX,hw]=xN(km),wN=fe.forwardRef((t,i)=>{const{name:c,min:f=0,max:_=100,step:w=1,orientation:E="horizontal",disabled:o=!1,minStepsBetweenThumbs:k=0,defaultValue:L=[f],value:N,onValueChange:V=()=>{},onValueCommit:H=()=>{},inverted:ne=!1,form:ce,...K}=t,se=fe.useRef(new Set),Y=fe.useRef(0),ae=E==="horizontal"?lX:cX,[Te=[],Be]=BI({prop:N,defaultProp:L,onChange:xt=>{var ln;(ln=[...se.current][Y.current])==null||ln.focus(),V(xt)}}),et=fe.useRef(Te);function nt(xt){const qt=pX(Te,xt);wt(xt,qt)}function Je(xt){wt(xt,Y.current)}function Dt(){const xt=et.current[Y.current];Te[Y.current]!==xt&&H(Te)}function wt(xt,qt,{commit:ln}={commit:!1}){const Ht=yX(w),cn=vX(Math.round((xt-f)/w)*w+f,Ht),pn=fN(cn,[f,_]);Be((Rn=[])=>{const Nt=dX(Rn,pn,qt);if(_X(Nt,k*w)){Y.current=Nt.indexOf(pn);const sn=String(Nt)!==String(Rn);return sn&&ln&&H(Nt),sn?Nt:Rn}else return Rn})}return B.jsx(aX,{scope:t.__scopeSlider,name:c,disabled:o,min:f,max:_,valueIndexToChangeRef:Y,thumbs:se.current,values:Te,orientation:E,form:ce,children:B.jsx(V2.Provider,{scope:t.__scopeSlider,children:B.jsx(V2.Slot,{scope:t.__scopeSlider,children:B.jsx(ae,{"aria-disabled":o,"data-disabled":o?"":void 0,...K,ref:i,onPointerDown:Rr(K.onPointerDown,()=>{o||(et.current=Te)}),min:f,max:_,inverted:ne,onSlideStart:o?void 0:nt,onSlideMove:o?void 0:Je,onSlideEnd:o?void 0:Dt,onHomeKeyDown:()=>!o&&wt(f,0,{commit:!0}),onEndKeyDown:()=>!o&&wt(_,Te.length-1,{commit:!0}),onStepKeyDown:({event:xt,direction:qt})=>{if(!o){const cn=_N.includes(xt.key)||xt.shiftKey&&yN.includes(xt.key)?10:1,pn=Y.current,Rn=Te[pn],Nt=w*cn*qt;wt(Rn+Nt,pn,{commit:!0})}}})})})})});wN.displayName=km;var[bN,TN]=xN(km,{startEdge:"left",endEdge:"right",size:"width",direction:1}),lX=fe.forwardRef((t,i)=>{const{min:c,max:f,dir:_,inverted:w,onSlideStart:E,onSlideMove:o,onSlideEnd:k,onStepKeyDown:L,...N}=t,[V,H]=fe.useState(null),ne=Fs(i,ae=>H(ae)),ce=fe.useRef(void 0),K=K7(_),se=K==="ltr",Y=se&&!w||!se&&w;function Q(ae){const Te=ce.current||V.getBoundingClientRect(),Be=[0,Te.width],nt=jI(Be,Y?[c,f]:[f,c]);return ce.current=Te,nt(ae-Te.left)}return B.jsx(bN,{scope:t.__scopeSlider,startEdge:Y?"left":"right",endEdge:Y?"right":"left",direction:Y?1:-1,size:"width",children:B.jsx(SN,{dir:K,"data-orientation":"horizontal",...N,ref:ne,style:{...N.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:ae=>{const Te=Q(ae.clientX);E==null||E(Te)},onSlideMove:ae=>{const Te=Q(ae.clientX);o==null||o(Te)},onSlideEnd:()=>{ce.current=void 0,k==null||k()},onStepKeyDown:ae=>{const Be=vN[Y?"from-left":"from-right"].includes(ae.key);L==null||L({event:ae,direction:Be?-1:1})}})})}),cX=fe.forwardRef((t,i)=>{const{min:c,max:f,inverted:_,onSlideStart:w,onSlideMove:E,onSlideEnd:o,onStepKeyDown:k,...L}=t,N=fe.useRef(null),V=Fs(i,N),H=fe.useRef(void 0),ne=!_;function ce(K){const se=H.current||N.current.getBoundingClientRect(),Y=[0,se.height],ae=jI(Y,ne?[f,c]:[c,f]);return H.current=se,ae(K-se.top)}return B.jsx(bN,{scope:t.__scopeSlider,startEdge:ne?"bottom":"top",endEdge:ne?"top":"bottom",size:"height",direction:ne?1:-1,children:B.jsx(SN,{"data-orientation":"vertical",...L,ref:V,style:{...L.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:K=>{const se=ce(K.clientY);w==null||w(se)},onSlideMove:K=>{const se=ce(K.clientY);E==null||E(se)},onSlideEnd:()=>{H.current=void 0,o==null||o()},onStepKeyDown:K=>{const Y=vN[ne?"from-bottom":"from-top"].includes(K.key);k==null||k({event:K,direction:Y?-1:1})}})})}),SN=fe.forwardRef((t,i)=>{const{__scopeSlider:c,onSlideStart:f,onSlideMove:_,onSlideEnd:w,onHomeKeyDown:E,onEndKeyDown:o,onStepKeyDown:k,...L}=t,N=hw(km,c);return B.jsx(ar.span,{...L,ref:i,onKeyDown:Rr(t.onKeyDown,V=>{V.key==="Home"?(E(V),V.preventDefault()):V.key==="End"?(o(V),V.preventDefault()):_N.concat(yN).includes(V.key)&&(k(V),V.preventDefault())}),onPointerDown:Rr(t.onPointerDown,V=>{const H=V.target;H.setPointerCapture(V.pointerId),V.preventDefault(),N.thumbs.has(H)?H.focus():f(V)}),onPointerMove:Rr(t.onPointerMove,V=>{V.target.hasPointerCapture(V.pointerId)&&_(V)}),onPointerUp:Rr(t.onPointerUp,V=>{const H=V.target;H.hasPointerCapture(V.pointerId)&&(H.releasePointerCapture(V.pointerId),w(V))})})}),EN="SliderTrack",IN=fe.forwardRef((t,i)=>{const{__scopeSlider:c,...f}=t,_=hw(EN,c);return B.jsx(ar.span,{"data-disabled":_.disabled?"":void 0,"data-orientation":_.orientation,...f,ref:i})});IN.displayName=EN;var U2="SliderRange",AN=fe.forwardRef((t,i)=>{const{__scopeSlider:c,...f}=t,_=hw(U2,c),w=TN(U2,c),E=fe.useRef(null),o=Fs(i,E),k=_.values.length,L=_.values.map(H=>MN(H,_.min,_.max)),N=k>1?Math.min(...L):0,V=100-Math.max(...L);return B.jsx(ar.span,{"data-orientation":_.orientation,"data-disabled":_.disabled?"":void 0,...f,ref:o,style:{...t.style,[w.startEdge]:N+"%",[w.endEdge]:V+"%"}})});AN.displayName=U2;var G2="SliderThumb",CN=fe.forwardRef((t,i)=>{const c=sX(t.__scopeSlider),[f,_]=fe.useState(null),w=Fs(i,o=>_(o)),E=fe.useMemo(()=>f?c().findIndex(o=>o.ref.current===f):-1,[c,f]);return B.jsx(uX,{...t,ref:w,index:E})}),uX=fe.forwardRef((t,i)=>{const{__scopeSlider:c,index:f,name:_,...w}=t,E=hw(G2,c),o=TN(G2,c),[k,L]=fe.useState(null),N=Fs(i,Q=>L(Q)),V=k?E.form||!!k.closest("form"):!0,H=J7(k),ne=E.values[f],ce=ne===void 0?0:MN(ne,E.min,E.max),K=fX(f,E.values.length),se=H==null?void 0:H[o.size],Y=se?mX(se,ce,o.direction):0;return fe.useEffect(()=>{if(k)return E.thumbs.add(k),()=>{E.thumbs.delete(k)}},[k,E.thumbs]),B.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[o.startEdge]:`calc(${ce}% + ${Y}px)`},children:[B.jsx(V2.ItemSlot,{scope:t.__scopeSlider,children:B.jsx(ar.span,{role:"slider","aria-label":t["aria-label"]||K,"aria-valuemin":E.min,"aria-valuenow":ne,"aria-valuemax":E.max,"aria-orientation":E.orientation,"data-orientation":E.orientation,"data-disabled":E.disabled?"":void 0,tabIndex:E.disabled?void 0:0,...w,ref:N,style:ne===void 0?{display:"none"}:t.style,onFocus:Rr(t.onFocus,()=>{E.valueIndexToChangeRef.current=f})})}),V&&B.jsx(PN,{name:_??(E.name?E.name+(E.values.length>1?"[]":""):void 0),form:E.form,value:ne},f)]})});CN.displayName=G2;var hX="RadioBubbleInput",PN=fe.forwardRef(({__scopeSlider:t,value:i,...c},f)=>{const _=fe.useRef(null),w=Fs(_,f),E=Y7(i);return fe.useEffect(()=>{const o=_.current;if(!o)return;const k=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(k,"value").set;if(E!==i&&N){const V=new Event("input",{bubbles:!0});N.call(o,i),o.dispatchEvent(V)}},[E,i]),B.jsx(ar.input,{style:{display:"none"},...c,ref:w,defaultValue:i})});PN.displayName=hX;function dX(t=[],i,c){const f=[...t];return f[c]=i,f.sort((_,w)=>_-w)}function MN(t,i,c){const w=100/(c-i)*(t-i);return fN(w,[0,100])}function fX(t,i){return i>2?`Value ${t+1} of ${i}`:i===2?["Minimum","Maximum"][t]:void 0}function pX(t,i){if(t.length===1)return 0;const c=t.map(_=>Math.abs(_-i)),f=Math.min(...c);return c.indexOf(f)}function mX(t,i,c){const f=t/2,w=jI([0,50],[0,f]);return(f-w(i)*c)*c}function gX(t){return t.slice(0,-1).map((i,c)=>t[c+1]-i)}function _X(t,i){if(i>0){const c=gX(t);return Math.min(...c)>=i}return!0}function jI(t,i){return c=>{if(t[0]===t[1]||i[0]===i[1])return i[0];const f=(i[1]-i[0])/(t[1]-t[0]);return i[0]+f*(c-t[0])}}function yX(t){return(String(t).split(".")[1]||"").length}function vX(t,i){const c=Math.pow(10,i);return Math.round(t*c)/c}var RN=wN,xX=IN,wX=AN,bX=CN;const kN=fe.forwardRef(({className:t,...i},c)=>B.jsxs(RN,{ref:c,className:or("relative flex w-full touch-none select-none items-center",t),...i,children:[B.jsx(xX,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:B.jsx(wX,{className:"absolute h-full bg-primary"})}),B.jsx(bX,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));kN.displayName=RN.displayName;const TX=[{key:"dining",label:"Dining & Restaurants",icon:""},{key:"gas",label:"Gas & Fuel",icon:""},{key:"groceries",label:"Groceries",icon:""},{key:"travel",label:"Travel & Hotels",icon:""},{key:"shopping",label:"Shopping & Retail",icon:""},{key:"entertainment",label:"Entertainment",icon:""}];function SX(){const t=Gd(),{setBudget:i,setLinkedBank:c,setOnboardingCompleted:f}=sv(),[_,w]=fe.useState({dining:300,gas:150,groceries:400,travel:200,shopping:250,entertainment:100}),E=(L,N)=>{w(V=>({...V,[L]:N[0]}))},o=L=>{L.preventDefault(),i(_),c(!1),f(!0),t("/dashboard")},k=Object.values(_).reduce((L,N)=>L+N,0);return B.jsx("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 to-white py-12 px-4 pb-24",children:B.jsxs("div",{className:"max-w-3xl mx-auto",children:[B.jsxs(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[B.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Set Your Monthly Budget"}),B.jsx("p",{className:"text-gray-600",children:"Adjust the sliders to match your typical monthly spending"}),B.jsxs("div",{className:"mt-6 flex items-center justify-center gap-2",children:[B.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-300"}),B.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-300"}),B.jsx("div",{className:"w-8 h-2 rounded-full bg-primary"})]})]}),B.jsx(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:B.jsxs(Xr,{className:"mb-6",children:[B.jsx(wo,{children:B.jsxs(bo,{className:"flex justify-between items-center",children:[B.jsx("span",{children:"Monthly Budget Categories"}),B.jsx("span",{className:"text-2xl text-primary",children:Fd(k)})]})}),B.jsx(Kr,{children:B.jsxs("form",{onSubmit:o,className:"space-y-8",children:[TX.map((L,N)=>B.jsxs(di.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3+N*.1},className:"space-y-2",children:[B.jsxs("div",{className:"flex justify-between items-center",children:[B.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[B.jsx("span",{className:"text-2xl",children:L.icon}),L.label]}),B.jsx("span",{className:"text-lg font-bold text-primary",children:Fd(_[L.key])})]}),B.jsx(kN,{value:[_[L.key]],onValueChange:V=>E(L.key,V),min:0,max:1e3,step:25,className:"w-full"}),B.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[B.jsx("span",{children:"$0"}),B.jsx("span",{children:"$1,000"})]})]},L.key)),B.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[B.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:" Pro Tip"}),B.jsx("p",{className:"text-sm text-blue-800",children:"Be honest about your spending! More accurate budgets lead to better card recommendations."})]}),B.jsxs("div",{className:"flex gap-3 pt-4",children:[B.jsx($r,{type:"button",variant:"outline",onClick:()=>t("/onboarding/choice"),className:"flex-1",children:"Back"}),B.jsx($r,{type:"submit",className:"flex-1 text-lg",size:"lg",children:"Complete Setup"})]})]})})]})})]})})}var DN={exports:{}};(function(t,i){(function(c,f){t.exports=f()})(GV,function(){var c,f,_;function w(o,k){if(!c)c=k;else if(!f)f=k;else{var L="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+f+")(sharedChunk); self.onerror = null;",N={};c(N),_=k(N),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([L],{type:"text/javascript"})))}}w(["exports"],function(o){var k=1e-6,L=typeof Float32Array<"u"?Float32Array:Array;function N(s,e){var r=e[0],l=e[1],u=e[2],p=e[3],m=r*p-u*l;return m?(s[0]=p*(m=1/m),s[1]=-l*m,s[2]=-u*m,s[3]=r*m,s):null}function V(){var s=new L(9);return L!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function H(s,e){var r=e[0],l=e[1],u=e[2],p=e[3],m=e[4],v=e[5],b=e[6],S=e[7],A=e[8];return s[0]=m*A-v*S,s[1]=u*S-l*A,s[2]=l*v-u*m,s[3]=v*b-p*A,s[4]=r*A-u*b,s[5]=u*p-r*v,s[6]=p*S-m*b,s[7]=l*b-r*S,s[8]=r*m-l*p,s}function ne(s,e,r){var l=e[0],u=e[1],p=e[2],m=e[3],v=e[4],b=e[5],S=e[6],A=e[7],C=e[8],M=r[0],z=r[1],O=r[2],$=r[3],W=r[4],q=r[5],ie=r[6],re=r[7],le=r[8];return s[0]=M*l+z*m+O*S,s[1]=M*u+z*v+O*A,s[2]=M*p+z*b+O*C,s[3]=$*l+W*m+q*S,s[4]=$*u+W*v+q*A,s[5]=$*p+W*b+q*C,s[6]=ie*l+re*m+le*S,s[7]=ie*u+re*v+le*A,s[8]=ie*p+re*b+le*C,s}function ce(){var s=new L(16);return L!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s}function K(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function se(s,e){var r=e[0],l=e[1],u=e[2],p=e[3],m=e[4],v=e[5],b=e[6],S=e[7],A=e[8],C=e[9],M=e[10],z=e[11],O=e[12],$=e[13],W=e[14],q=e[15],ie=r*v-l*m,re=r*b-u*m,le=r*S-p*m,we=l*b-u*v,be=l*S-p*v,Ie=u*S-p*b,Pe=A*$-C*O,Me=A*W-M*O,Ye=A*q-z*O,ze=C*W-M*$,Qe=C*q-z*$,lt=M*q-z*W,tt=ie*lt-re*Qe+le*ze+we*Ye-be*Me+Ie*Pe;return tt?(s[0]=(v*lt-b*Qe+S*ze)*(tt=1/tt),s[1]=(u*Qe-l*lt-p*ze)*tt,s[2]=($*Ie-W*be+q*we)*tt,s[3]=(M*be-C*Ie-z*we)*tt,s[4]=(b*Ye-m*lt-S*Me)*tt,s[5]=(r*lt-u*Ye+p*Me)*tt,s[6]=(W*le-O*Ie-q*re)*tt,s[7]=(A*Ie-M*le+z*re)*tt,s[8]=(m*Qe-v*Ye+S*Pe)*tt,s[9]=(l*Ye-r*Qe-p*Pe)*tt,s[10]=(O*be-$*le+q*ie)*tt,s[11]=(C*le-A*be-z*ie)*tt,s[12]=(v*Me-m*ze-b*Pe)*tt,s[13]=(r*ze-l*Me+u*Pe)*tt,s[14]=($*re-O*we-W*ie)*tt,s[15]=(A*we-C*re+M*ie)*tt,s):null}function Y(s,e,r){var l=e[0],u=e[1],p=e[2],m=e[3],v=e[4],b=e[5],S=e[6],A=e[7],C=e[8],M=e[9],z=e[10],O=e[11],$=e[12],W=e[13],q=e[14],ie=e[15],re=r[0],le=r[1],we=r[2],be=r[3];return s[0]=re*l+le*v+we*C+be*$,s[1]=re*u+le*b+we*M+be*W,s[2]=re*p+le*S+we*z+be*q,s[3]=re*m+le*A+we*O+be*ie,s[4]=(re=r[4])*l+(le=r[5])*v+(we=r[6])*C+(be=r[7])*$,s[5]=re*u+le*b+we*M+be*W,s[6]=re*p+le*S+we*z+be*q,s[7]=re*m+le*A+we*O+be*ie,s[8]=(re=r[8])*l+(le=r[9])*v+(we=r[10])*C+(be=r[11])*$,s[9]=re*u+le*b+we*M+be*W,s[10]=re*p+le*S+we*z+be*q,s[11]=re*m+le*A+we*O+be*ie,s[12]=(re=r[12])*l+(le=r[13])*v+(we=r[14])*C+(be=r[15])*$,s[13]=re*u+le*b+we*M+be*W,s[14]=re*p+le*S+we*z+be*q,s[15]=re*m+le*A+we*O+be*ie,s}function Q(s,e,r){var l,u,p,m,v,b,S,A,C,M,z,O,$=r[0],W=r[1],q=r[2];return e===s?(s[12]=e[0]*$+e[4]*W+e[8]*q+e[12],s[13]=e[1]*$+e[5]*W+e[9]*q+e[13],s[14]=e[2]*$+e[6]*W+e[10]*q+e[14],s[15]=e[3]*$+e[7]*W+e[11]*q+e[15]):(u=e[1],p=e[2],m=e[3],v=e[4],b=e[5],S=e[6],A=e[7],C=e[8],M=e[9],z=e[10],O=e[11],s[0]=l=e[0],s[1]=u,s[2]=p,s[3]=m,s[4]=v,s[5]=b,s[6]=S,s[7]=A,s[8]=C,s[9]=M,s[10]=z,s[11]=O,s[12]=l*$+v*W+C*q+e[12],s[13]=u*$+b*W+M*q+e[13],s[14]=p*$+S*W+z*q+e[14],s[15]=m*$+A*W+O*q+e[15]),s}function ae(s,e,r){var l=r[0],u=r[1],p=r[2];return s[0]=e[0]*l,s[1]=e[1]*l,s[2]=e[2]*l,s[3]=e[3]*l,s[4]=e[4]*u,s[5]=e[5]*u,s[6]=e[6]*u,s[7]=e[7]*u,s[8]=e[8]*p,s[9]=e[9]*p,s[10]=e[10]*p,s[11]=e[11]*p,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s}function Te(s,e,r){var l=Math.sin(r),u=Math.cos(r),p=e[4],m=e[5],v=e[6],b=e[7],S=e[8],A=e[9],C=e[10],M=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=p*u+S*l,s[5]=m*u+A*l,s[6]=v*u+C*l,s[7]=b*u+M*l,s[8]=S*u-p*l,s[9]=A*u-m*l,s[10]=C*u-v*l,s[11]=M*u-b*l,s}function Be(s,e,r){var l=Math.sin(r),u=Math.cos(r),p=e[0],m=e[1],v=e[2],b=e[3],S=e[8],A=e[9],C=e[10],M=e[11];return e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=p*u-S*l,s[1]=m*u-A*l,s[2]=v*u-C*l,s[3]=b*u-M*l,s[8]=p*l+S*u,s[9]=m*l+A*u,s[10]=v*l+C*u,s[11]=b*l+M*u,s}function et(s,e,r){var l=Math.sin(r),u=Math.cos(r),p=e[0],m=e[1],v=e[2],b=e[3],S=e[4],A=e[5],C=e[6],M=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=p*u+S*l,s[1]=m*u+A*l,s[2]=v*u+C*l,s[3]=b*u+M*l,s[4]=S*u-p*l,s[5]=A*u-m*l,s[6]=C*u-v*l,s[7]=M*u-b*l,s}function nt(s,e){return s[0]=e[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=e[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Je(s,e,r){var l,u,p,m=r[0],v=r[1],b=r[2],S=Math.sqrt(m*m+v*v+b*b);return S<k?null:(m*=S=1/S,v*=S,b*=S,l=Math.sin(e),u=Math.cos(e),s[0]=m*m*(p=1-u)+u,s[1]=v*m*p+b*l,s[2]=b*m*p-v*l,s[3]=0,s[4]=m*v*p-b*l,s[5]=v*v*p+u,s[6]=b*v*p+m*l,s[7]=0,s[8]=m*b*p+v*l,s[9]=v*b*p-m*l,s[10]=b*b*p+u,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}function Dt(s,e){var r=e[0],l=e[1],u=e[2],p=e[3],m=r+r,v=l+l,b=u+u,S=r*m,A=l*m,C=l*v,M=u*m,z=u*v,O=u*b,$=p*m,W=p*v,q=p*b;return s[0]=1-C-O,s[1]=A+q,s[2]=M-W,s[3]=0,s[4]=A-q,s[5]=1-S-O,s[6]=z+$,s[7]=0,s[8]=M+W,s[9]=z-$,s[10]=1-S-C,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}var wt=Y;function xt(){var s=new L(3);return L!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function qt(s){var e=new L(3);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e}function ln(s){var e=s[0],r=s[1],l=s[2];return Math.sqrt(e*e+r*r+l*l)}function Ht(s,e,r){var l=new L(3);return l[0]=s,l[1]=e,l[2]=r,l}function cn(s,e,r,l){return s[0]=e,s[1]=r,s[2]=l,s}function pn(s,e,r){return s[0]=e[0]+r[0],s[1]=e[1]+r[1],s[2]=e[2]+r[2],s}function Rn(s,e,r){return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],s}function Nt(s,e,r){return s[0]=e[0]*r[0],s[1]=e[1]*r[1],s[2]=e[2]*r[2],s}function sn(s,e,r){return s[0]=Math.min(e[0],r[0]),s[1]=Math.min(e[1],r[1]),s[2]=Math.min(e[2],r[2]),s}function Tn(s,e,r){return s[0]=Math.max(e[0],r[0]),s[1]=Math.max(e[1],r[1]),s[2]=Math.max(e[2],r[2]),s}function on(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s[2]=e[2]*r,s}function Xn(s,e,r,l){return s[0]=e[0]+r[0]*l,s[1]=e[1]+r[1]*l,s[2]=e[2]+r[2]*l,s}function _r(s,e){var r=e[0]-s[0],l=e[1]-s[1],u=e[2]-s[2];return r*r+l*l+u*u}function ir(s){var e=s[0],r=s[1],l=s[2];return e*e+r*r+l*l}function Qr(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s}function Vn(s,e){var r=e[0],l=e[1],u=e[2],p=r*r+l*l+u*u;return p>0&&(p=1/Math.sqrt(p)),s[0]=e[0]*p,s[1]=e[1]*p,s[2]=e[2]*p,s}function Wn(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]}function ci(s,e,r){var l=e[0],u=e[1],p=e[2],m=r[0],v=r[1],b=r[2];return s[0]=u*b-p*v,s[1]=p*m-l*b,s[2]=l*v-u*m,s}function rr(s,e,r,l){var u=e[0],p=e[1],m=e[2];return s[0]=u+l*(r[0]-u),s[1]=p+l*(r[1]-p),s[2]=m+l*(r[2]-m),s}function ui(s,e,r){var l=e[0],u=e[1],p=e[2],m=r[3]*l+r[7]*u+r[11]*p+r[15];return s[0]=(r[0]*l+r[4]*u+r[8]*p+r[12])/(m=m||1),s[1]=(r[1]*l+r[5]*u+r[9]*p+r[13])/m,s[2]=(r[2]*l+r[6]*u+r[10]*p+r[14])/m,s}function Bi(s,e,r){var l=e[0],u=e[1],p=e[2];return s[0]=l*r[0]+u*r[3]+p*r[6],s[1]=l*r[1]+u*r[4]+p*r[7],s[2]=l*r[2]+u*r[5]+p*r[8],s}function Sn(s,e,r){var l=r[0],u=r[1],p=r[2],m=r[3],v=e[0],b=e[1],S=e[2],A=u*S-p*b,C=p*v-l*S,M=l*b-u*v;return s[0]=v+m*(A+=A)+u*(M+=M)-p*(C+=C),s[1]=b+m*C+p*A-l*M,s[2]=S+m*M+l*C-u*A,s}function ji(s){return s[0]=0,s[1]=0,s[2]=0,s}function Li(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]}var ii=Rn,fs=Nt,es=ln;function Qs(){var s=new L(4);return L!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0,s[3]=0),s}function lr(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s[2]=e[2]*r,s[3]=e[3]*r,s}function ps(s,e){var r=e[0],l=e[1],u=e[2],p=e[3],m=r*r+l*l+u*u+p*p;return m>0&&(m=1/Math.sqrt(m)),s[0]=r*m,s[1]=l*m,s[2]=u*m,s[3]=p*m,s}function Nr(s,e,r){var l=e[0],u=e[1],p=e[2],m=e[3];return s[0]=r[0]*l+r[4]*u+r[8]*p+r[12]*m,s[1]=r[1]*l+r[5]*u+r[9]*p+r[13]*m,s[2]=r[2]*l+r[6]*u+r[10]*p+r[14]*m,s[3]=r[3]*l+r[7]*u+r[11]*p+r[15]*m,s}function eo(){var s=new L(4);return L!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function to(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function ra(s,e,r){r*=.5;var l=e[0],u=e[1],p=e[2],m=e[3],v=Math.sin(r),b=Math.cos(r);return s[0]=l*b+m*v,s[1]=u*b+p*v,s[2]=p*b-u*v,s[3]=m*b-l*v,s}function sa(s,e,r){r*=.5;var l=e[0],u=e[1],p=e[2],m=e[3],v=Math.sin(r),b=Math.cos(r);return s[0]=l*b-p*v,s[1]=u*b+m*v,s[2]=p*b+l*v,s[3]=m*b-u*v,s}xt(),Qs();var os,ms,ql,no=ps,io=(os=xt(),ms=Ht(1,0,0),ql=Ht(0,1,0),function(s,e,r){var l=Wn(e,r);return l<-.999999?(ci(os,ms,e),es(os)<1e-6&&ci(os,ql,e),Vn(os,os),function(u,p,m){m*=.5;var v=Math.sin(m);u[0]=v*p[0],u[1]=v*p[1],u[2]=v*p[2],u[3]=Math.cos(m)}(s,os,Math.PI),s):l>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(ci(os,e,r),s[0]=os[0],s[1]=os[1],s[2]=os[2],s[3]=1+l,no(s,s))});function yr(){var s=new L(2);return L!=Float32Array&&(s[0]=0,s[1]=0),s}function Cs(s,e){var r=new L(2);return r[0]=s,r[1]=e,r}function oa(s,e,r){return s[0]=e,s[1]=r,s}function aa(s,e,r){return s[0]=e[0]+r[0],s[1]=e[1]+r[1],s}function Io(s,e,r){return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s}function zo(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s}function Pa(s){var e=s[0],r=s[1];return Math.sqrt(e*e+r*r)}function Ri(s,e){var r=e[0],l=e[1],u=r*r+l*l;return u>0&&(u=1/Math.sqrt(u)),s[0]=e[0]*u,s[1]=e[1]*u,s}function vr(s,e){return s[0]*e[0]+s[1]*e[1]}eo(),eo(),V();var Zl,la,Ns=Io;function rl(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}yr();var Xl=function(){if(la)return Zl;function s(e,r,l,u){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=l,this.p2y=u}return la=1,Zl=s,s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,u=0;u<8;u++){var p=this.sampleCurveX(l)-e;if(Math.abs(p)<r)return l;var m=this.sampleCurveDerivativeX(l);if(Math.abs(m)<1e-6)break;l-=p/m}var v=0,b=1;for(l=e,u=0;u<20&&(p=this.sampleCurveX(l),!(Math.abs(p-e)<r));u++)e>p?v=l:b=l,l=.5*(b-v)+v;return l},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},Zl}(),Kl=rl(Xl);function ct(s,e){this.x=s,this.y=e}function Oo(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let r=0;r<s.length;r++)if(!Oo(s[r],e[r]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(const r in s)if(!Oo(s[r],e[r]))return!1;return!0}return s===e}ct.prototype={clone(){return new ct(this.x,this.y)},add(s){return this.clone()._add(s)},sub(s){return this.clone()._sub(s)},multByPoint(s){return this.clone()._multByPoint(s)},divByPoint(s){return this.clone()._divByPoint(s)},mult(s){return this.clone()._mult(s)},div(s){return this.clone()._div(s)},rotate(s){return this.clone()._rotate(s)},rotateAround(s,e){return this.clone()._rotateAround(s,e)},matMult(s){return this.clone()._matMult(s)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(s){return this.x===s.x&&this.y===s.y},dist(s){return Math.sqrt(this.distSqr(s))},distSqr(s){const e=s.x-this.x,r=s.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith(s){return this.angleWithSep(s.x,s.y)},angleWithSep(s,e){return Math.atan2(this.x*e-this.y*s,this.x*s+this.y*e)},_matMult(s){const e=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=e,this},_add(s){return this.x+=s.x,this.y+=s.y,this},_sub(s){return this.x-=s.x,this.y-=s.y,this},_mult(s){return this.x*=s,this.y*=s,this},_div(s){return this.x/=s,this.y/=s,this},_multByPoint(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint(s){return this.x/=s.x,this.y/=s.y,this},_unit(){return this._div(this.mag()),this},_perp(){const s=this.y;return this.y=this.x,this.x=-s,this},_rotate(s){const e=Math.cos(s),r=Math.sin(s),l=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=l,this},_rotateAround(s,e){const r=Math.cos(s),l=Math.sin(s),u=e.y+l*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-l*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ct},ct.convert=function(s){if(s instanceof ct)return s;if(Array.isArray(s))return new ct(+s[0],+s[1]);if(s.x!==void 0&&s.y!==void 0)return new ct(+s.x,+s.y);throw new Error("Expected [x, y] or {x, y} point format")};const Dm=Math.PI/180,Vc=180/Math.PI;function De(s){return s*Dm}function X(s){return s*Vc}const te=[[0,0],[1,0],[1,1],[0,1]];function pe(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,r=e*s;return 4*(s<.5?r:3*(s-e)+r-.75)}function Ae(s,e,r,l){const u=new Kl(s,e,r,l);return function(p){return u.solve(p)}}const Ee=Ae(.25,.1,.25,1);function Se(s,e,r){return Math.min(r,Math.max(e,s))}function $e(s,e,r){return(r=Se((r-s)/(e-s),0,1))*r*(3-2*r)}function ke(s,e,r){const l=r-e,u=((s-e)%l+l)%l+e;return u===e?r:u}function He(s,e,r){if(!s.length)return r(null,[]);let l=s.length;const u=new Array(s.length);let p=null;s.forEach((m,v)=>{e(m,(b,S)=>{b&&(p=b),u[v]=S,--l==0&&r(p,u)})})}let _t=1;function st(){return _t++}function $t(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log2(s)))}function tn(s,e){s.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function un(s,e,r){const l={};for(const u in s)l[u]=e.call(this,s[u],u,s);return l}function kn(s,e,r){const l={};for(const u in s)e.call(this,s[u],u,s)&&(l[u]=s[u]);return l}function Mn(s){return Array.isArray(s)?s.map(Mn):typeof s=="object"&&s?un(s,Mn):s}function On(s,e){for(let r=0;r<s.length;r++)if(e.indexOf(s[r])>=0)return!0;return!1}const pi={};function Dn(s){pi[s]||(typeof console<"u"&&console.warn(s),pi[s]=!0)}function Zi(s,e,r){return(r.y-s.y)*(e.x-s.x)>(e.y-s.y)*(r.x-s.x)}function cr(s){let e=0;for(let r,l,u=0,p=s.length,m=p-1;u<p;m=u++)r=s[u],l=s[m],e+=(l.x-r.x)*(r.y+l.y);return e}function ur([s,e,r]){const l=De(e+90),u=De(r);return{x:s*Math.cos(l)*Math.sin(u),y:s*Math.sin(l)*Math.sin(u),z:s*Math.cos(u),azimuthal:e,polar:r}}function fi(s){return(typeof self<"u"||s!==void 0)&&typeof WorkerGlobalScope<"u"&&(s!==void 0?s:self)instanceof WorkerGlobalScope}function Kn(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,l,u,p)=>{const m=u||p;return e[l]=!m||m.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Hi=null;function Wi(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}function Ti(s,e,r,l){for(;e<r;){const u=e+r>>1;s[u]<l?e=u+1:r=u}return e}function Hr(s,e,r,l){for(;e<r;){const u=e+r>>1;s[u]<=l?e=u+1:r=u}return e}function gs(s){return s>0?1/(1.001-s):1+s}function ro(s){return s>0?1-1/(1.001-s):-s}function Ma(s,e,r){return(s-e.min)*(r.max-r.min)/(e.max-e.min)+r.min}const as={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!as.API_URL)return null;try{const s=new URL(as.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Uc(s){return as.API_URL_REGEX.test(s)}function cv(s){return as.API_SPRITE_REGEX.test(s)}let sl,Gc,_h,yh,ol,vh;function Lm(){return sl==null&&(sl=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),sl}const ca={now:()=>yh!==void 0?yh:performance.now(),setNow(s){yh=s},restoreNow(){yh=void 0},frame(s){const e=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:r,height:l}=s;ol||(ol=document.createElement("canvas"));const u=ol.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(r>ol.width||l>ol.height)&&(ol.width=r,ol.height=l),u.clearRect(-e,-e,r+2*e,l+2*e),u.drawImage(s,0,0,r,l),u.getImageData(-e,-e,r+2*e,l+2*e)},resolveURL:s=>(Gc||(Gc=document.createElement("a")),Gc.href=s,Gc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(_h==null&&(_h=window.matchMedia("(prefers-reduced-motion: reduce)")),_h.matches)},hasCanvasFingerprintNoise(){if(vh!==void 0)return vh;if(!Lm())return vh=!1,!1;const s=new OffscreenCanvas(85,1),e=s.getContext("2d",{willReadFrequently:!0});let r=0;for(let u=0;u<s.width;++u)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(u,0,1,1);const l=e.getImageData(0,0,s.width,s.height);r=0;for(let u=0;u<l.data.length;++u)if(u%4!=3&&r++!==l.data[u])return vh=!0,!0;return vh=!1,!1}};function zm(s,e){const r=s.indexOf("?");if(r<0)return`${s}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(s.slice(r));for(const u in e)l.set(u,e[u]);return`${s.slice(0,r)}?${l.toString()}`}function Hd(s,e={persistentParams:[]}){const r=s.indexOf("?");if(r<0)return s;const l=new URLSearchParams,u=new URLSearchParams(s.slice(r));for(const m of e.persistentParams){const v=u.get(m);v&&l.set(m,v)}const p=l.toString();return`${s.slice(0,r)}${p.length>0?`?${p}`:""}`}const so="mapbox-tiles";let Fo=500,Ra=50;const No=["language","worldview","jobid"];let _s,Yl;function Om(){try{return caches}catch{}}function xh(){const s=Om();s&&_s==null&&(_s=s.open(so))}let al=1/0;const wh={supported:!1,testSupport:function(s){!oo&&$c&&(Fm?Hc(s):bh=s)}};let bh,$c,oo=!1,Fm=!1;const Wd=typeof self<"u"?self:{};function Hc(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,$c),s.isContextLost())return;wh.supported=!0}catch{}s.deleteTexture(e),oo=!0}Wd.document&&($c=Wd.document.createElement("img"),$c.onload=function(){bh&&Hc(bh),bh=null,Fm=!0},$c.onerror=function(){oo=!0,bh=null},$c.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const qd={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(qd);class Nm extends Error{constructor(e,r,l){r===401&&Uc(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Zd=fi()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Nn=function(s,e){if(!(/^file:/.test(r=s.url)||/^file:/.test(Zd())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(l,u){const p=new AbortController,m=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Zd(),referrerPolicy:l.referrerPolicy,signal:p.signal});let v=!1,b=!1;const S=(A=m.url).indexOf("sku=")>0&&Uc(A);var A;l.type==="json"&&m.headers.set("Accept","application/json");const C=(z,O,$)=>{if(b)return;if(z&&z.message!=="SecurityError"&&Dn(z.toString()),O&&$)return M(O);const W=Date.now();fetch(m).then(q=>{if(q.ok){const ie=S?q.clone():null;return M(q,ie,W)}return u(new Nm(q.statusText,q.status,l.url))}).catch(q=>{q.name!=="AbortError"&&u(new Error(`${q.message} ${l.url}`))})},M=(z,O,$)=>{(l.type==="arrayBuffer"?z.arrayBuffer():l.type==="json"?z.json():z.text()).then(W=>{b||(O&&$&&function(q,ie,re){if(xh(),_s==null)return;const le=Kn(ie.headers.get("Cache-Control")||"");if(le["no-store"])return;const we={status:ie.status,statusText:ie.statusText,headers:new Headers};ie.headers.forEach((Pe,Me)=>we.headers.set(Me,Pe)),le["max-age"]&&we.headers.set("Expires",new Date(re+1e3*le["max-age"]).toUTCString());const be=we.headers.get("Expires");if(!be||new Date(be).getTime()-re<42e4)return;let Ie=Hd(q.url,{persistentParams:No});if(ie.status===206){const Pe=q.headers.get("Range");if(!Pe)return;we.status=200,Ie=zm(Ie,{range:Pe})}(function(Pe,Me){if(Yl===void 0)try{new Response(new ReadableStream),Yl=!0}catch{Yl=!1}Yl?Me(Pe.body):Pe.blob().then(Me).catch(Ye=>Dn(Ye.message))})(ie,Pe=>{const Me=new Response((Ye=ie.status)!==200&&Ye!==404&&[101,103,204,205,304].includes(Ye)?null:Pe,we);var Ye;xh(),_s!=null&&_s.then(ze=>ze.put(Ie,Me)).catch(ze=>Dn(ze.message))})}(m,O,$),v=!0,u(null,W,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(W=>{b||u(new Error(W.message))})};return S?function(z,O){if(xh(),_s==null)return O(null);_s.then($=>{let W=Hd(z.url,{persistentParams:No});const q=z.headers.get("Range");q&&(W=zm(W,{range:q})),$.match(W).then(ie=>{const re=function(le){if(!le)return!1;const we=new Date(le.headers.get("Expires")||0),be=Kn(le.headers.get("Cache-Control")||"");return Number(we)>Date.now()&&!be["no-cache"]}(ie);$.delete(W).catch(O),re&&$.put(W,ie.clone()).catch(O),O(null,ie,re)}).catch(O)}).catch(O)}(m,C):C(null,null),{cancel:()=>{b=!0,v||p.abort()}}}(s,e);if(fi(self)&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var r;return function(l,u){const p=new XMLHttpRequest;p.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const m in l.headers)p.setRequestHeader(m,l.headers[m]);return l.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=l.credentials==="include",p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(l.type==="json")try{m=JSON.parse(p.response)}catch(v){return u(v)}u(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else u(new Nm(p.statusText,p.status,l.url))},p.send(l.body),{cancel:()=>p.abort()}}(s,e)},Wc=function(s,e){return Nn(Object.assign(s,{type:"arrayBuffer"}),e)};function uv(s){const e=document.createElement("a");return e.href=s,e.protocol===location.protocol&&e.host===location.host}const hv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Xd,ll;Xd=[],ll=0;const qc=function(s,e){if(wh.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),ll>=as.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Xd.push(p),p}ll++;let r=!1;const l=()=>{if(!r)for(r=!0,ll--;Xd.length&&ll<as.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Xd.shift(),{requestParameters:m,callback:v,cancelled:b}=p;b||(p.cancel=qc(m,v).cancel)}},u=Wc(s,(p,m,v,b)=>{l(),p?e(p):m&&(self.createImageBitmap?function(S,A){const C=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(C).then(M=>{A(null,M)}).catch(M=>{A(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(S,A)=>e(S,A,v,b)):function(S,A){const C=new Image;C.onload=()=>{A(null,C),URL.revokeObjectURL(C.src),C.onload=null,requestAnimationFrame(()=>{C.src=hv})},C.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(S)],{type:"image/png"});C.src=S.byteLength?URL.createObjectURL(M):hv}(m,(S,A)=>e(S,A,v,b)))});return{cancel:()=>{u.cancel(),l()}}};var Th,Kd,dv,Jl={exports:{}},fv={exports:{}},Bm={exports:{}},Zc=function(){if(dv)return Jl.exports;dv=1;var s=(Th||(Th=1,fv.exports=function(r,l){var u,p,m,v,b,S,A,C;for(p=r.length-(u=3&r.length),m=l,b=3432918353,S=461845907,C=0;C<p;)A=255&r.charCodeAt(C)|(255&r.charCodeAt(++C))<<8|(255&r.charCodeAt(++C))<<16|(255&r.charCodeAt(++C))<<24,++C,m=27492+(65535&(v=5*(65535&(m=(m^=A=(65535&(A=(A=(65535&A)*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*S+(((A>>>16)*S&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(A=0,u){case 3:A^=(255&r.charCodeAt(C+2))<<16;case 2:A^=(255&r.charCodeAt(C+1))<<8;case 1:m^=A=(65535&(A=(A=(65535&(A^=255&r.charCodeAt(C)))*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*S+(((A>>>16)*S&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),fv.exports),e=(Kd||(Kd=1,Bm.exports=function(r,l){for(var u,p=r.length,m=l^p,v=0;p>=4;)u=1540483477*(65535&(u=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++v;switch(p){case 3:m^=(255&r.charCodeAt(v+2))<<16;case 2:m^=(255&r.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),Bm.exports);return Jl.exports=s,Jl.exports.murmur3=s,Jl.exports.murmur2=e,Jl.exports}(),Yd=rl(Zc);class Bo{constructor(e,...r){Object.assign(this,r[0]||{}),this.type=e}}class Sh extends Bo{constructor(e,r={}){super("error",Object.assign({error:e},r))}}function Jd(s,e,r){r[s]&&r[s].indexOf(e)!==-1||(r[s]=r[s]||[],r[s].push(e))}function ao(s,e,r){if(r&&r[s]){const l=r[s].indexOf(e);l!==-1&&r[s].splice(l,1)}}class Ql{on(e,r){return this._listeners=this._listeners||{},Jd(e,r,this._listeners),this}off(e,r){return ao(e,r,this._listeners),ao(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Jd(e,r,this._oneTimeListeners),this):new Promise(l=>{this.once(e,l)})}fire(e,r){const l=typeof e=="string"?new Bo(e,r):e,u=l.type;if(this.listens(u)){l.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const b of p)b.call(this,l);const m=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const b of m)ao(u,b,this._oneTimeListeners),b.call(this,l);const v=this._eventedParent;if(v){const b=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(l,b),v.fire(l)}}else l instanceof Sh&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}class lo{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new lo(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[r,l]=e.split("");return new lo({name:r,iconsetId:l})}static isEqual(e,r){return e.name===r.name&&e.iconsetId===r.iconsetId}toString(){return lo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var jm,Qd={},Vm=function(){if(jm)return Qd;jm=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(p){return(p=Math.round(p))<0?0:p>255?255:p}function r(p){return e(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function l(p){return(m=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:m>1?1:m;var m}function u(p,m,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?p+(m-p)*v*6:2*v<1?m:3*v<2?p+(m-p)*(2/3-v)*6:p}try{Qd.parseCSSColor=function(p){var m,v=p.replace(/ /g,"").toLowerCase();if(v in s)return s[v].slice();if(v[0]==="#")return v.length===4?(m=parseInt(v.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:v.length===7&&(m=parseInt(v.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var b=v.indexOf("("),S=v.indexOf(")");if(b!==-1&&S+1===v.length){var A=v.substr(0,b),C=v.substr(b+1,S-(b+1)).split(","),M=1;switch(A){case"rgba":if(C.length!==4)return null;M=l(C.pop());case"rgb":return C.length!==3?null:[r(C[0]),r(C[1]),r(C[2]),M];case"hsla":if(C.length!==4)return null;M=l(C.pop());case"hsl":if(C.length!==3)return null;var z=(parseFloat(C[0])%360+360)%360/360,O=l(C[1]),$=l(C[2]),W=$<=.5?$*(O+1):$+O-$*O,q=2*$-W;return[e(255*u(q,W,z+1/3)),e(255*u(q,W,z)),e(255*u(q,W,z-1/3)),M];default:return null}}return null}}catch{}return Qd}();class Jn{constructor(e,r,l,u=1){this.r=e,this.g=r,this.b=l,this.a=u}static parse(e){if(!e)return;if(e instanceof Jn)return e;if(typeof e!="string")return;const r=Vm.parseCSSColor(e);return r?new Jn(r[0]/255,r[1]/255,r[2]/255,r[3]):void 0}toString(){const[e,r,l,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*r)},${Math.round(255*l)},${u})`}toNonPremultipliedRenderColor(e){const{r,g:l,b:u,a:p}=this;return new pv(e,r,l,u,p)}toPremultipliedRenderColor(e){const{r,g:l,b:u,a:p}=this;return new ef(e,r*p,l*p,u*p,p)}clone(){return new Jn(this.r,this.g,this.b,this.a)}}class Um{constructor(e,r,l,u,p,m=!1){if(this.premultiplied=!1,this.premultiplied=m,e){const v=e.image.height,b=v*v;this.premultiplied?(r=p===0?0:r/p*(v-1),l=p===0?0:l/p*(v-1),u=p===0?0:u/p*(v-1)):(r*=v-1,l*=v-1,u*=v-1);const S=Math.floor(r),A=Math.floor(l),C=Math.floor(u),M=Math.ceil(r),z=Math.ceil(l),O=Math.ceil(u),$=r-S,W=l-A,q=u-C,ie=e.image.data,re=4*(S+A*b+C*v),le=4*(S+A*b+O*v),we=4*(S+z*b+C*v),be=4*(S+z*b+O*v),Ie=4*(M+A*b+C*v),Pe=4*(M+A*b+O*v),Me=4*(M+z*b+C*v),Ye=4*(M+z*b+O*v);if(re<0||Ye>=ie.length)throw new Error("out of range");this.r=Kt(Kt(Kt(ie[re],ie[le],q),Kt(ie[we],ie[be],q),W),Kt(Kt(ie[Ie],ie[Pe],q),Kt(ie[Me],ie[Ye],q),W),$)/255*(this.premultiplied?p:1),this.g=Kt(Kt(Kt(ie[re+1],ie[le+1],q),Kt(ie[we+1],ie[be+1],q),W),Kt(Kt(ie[Ie+1],ie[Pe+1],q),Kt(ie[Me+1],ie[Ye+1],q),W),$)/255*(this.premultiplied?p:1),this.b=Kt(Kt(Kt(ie[re+2],ie[le+2],q),Kt(ie[we+2],ie[be+2],q),W),Kt(Kt(ie[Ie+2],ie[Pe+2],q),Kt(ie[Me+2],ie[Ye+2],q),W),$)/255*(this.premultiplied?p:1),this.a=p}else this.r=r,this.g=l,this.b=u,this.a=p}toArray(){const{r:e,g:r,b:l,a:u}=this;return[255*e,255*r,255*l,u]}toHslaArray(){let{r:e,g:r,b:l,a:u}=this;if(this.premultiplied){if(u===0)return[0,0,0,0];const O=1/u;e*=O,r*=O,l*=O}const p=Math.min(Math.max(e,0),1),m=Math.min(Math.max(r,0),1),v=Math.min(Math.max(l,0),1),b=Math.min(p,m,v),S=Math.max(p,m,v),A=S-b,C=.5*(b+S);if(A===0)return[0,0,100*C,u];const M=C>.5?A/(2-S-b):A/(S+b);let z;switch(S){case p:z=60*((m-v)/A+(m<v?6:0));break;case m:z=60*((v-p)/A+2);break;default:z=60*((p-m)/A+4)}return[z,100*M,100*C,u]}toArray01(){const{r:e,g:r,b:l,a:u}=this;return[e,r,l,u]}toArray01Scaled(e){const{r,g:l,b:u}=this;return[r*e,l*e,u*e]}toArray01Linear(){const{r:e,g:r,b:l,a:u}=this;return[Math.pow(e,2.2),Math.pow(r,2.2),Math.pow(l,2.2),u]}}class pv extends Um{constructor(e,r,l,u,p){super(e,r,l,u,p,!1)}}class ef extends Um{constructor(e,r,l,u,p){super(e,r,l,u,p,!0)}}function Kt(s,e,r){return s*(1-r)+e*r}function Gm(s,e,r){return s.map((l,u)=>Kt(l,e[u],r))}Jn.black=new Jn(0,0,0,1),Jn.white=new Jn(1,1,1,1),Jn.transparent=new Jn(0,0,0,0),Jn.red=new Jn(1,0,0,1),Jn.blue=new Jn(0,0,1,1);var co=Object.freeze({__proto__:null,array:Gm,color:function(s,e,r){return new Jn(Kt(s.r,e.r,r),Kt(s.g,e.g,r),Kt(s.b,e.b,r),Kt(s.a,e.a,r))},number:Kt});class jo extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class tf{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[l,u]of r)this.bindings[l]=u}concat(e){return new tf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ua={kind:"null"},Ut={kind:"number"},Qn={kind:"string"},ri={kind:"boolean"},Bs={kind:"color"},ec={kind:"object"},qn={kind:"value"},nf={kind:"collator"},cl={kind:"formatted"},Eh={kind:"resolvedImage"};function ls(s,e){return{kind:"array",itemType:s,N:e}}function hr(s){if(s.kind==="array"){const e=hr(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const gw=[ua,Ut,Qn,ri,Bs,cl,ec,ls(qn),Eh];function Ih(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ih(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const r of gw)if(!Ih(r,e))return null}}return`Expected ${hr(s)} but found ${hr(e)} instead.`}function $m(s,e){return e.some(r=>r.kind===s.kind)}function Ah(s,e){return e.some(r=>r==="null"?s===null:r==="array"?Array.isArray(s):r==="object"?s&&!Array.isArray(s)&&typeof s=="object":r===typeof s)}function Ch(s,e){return s.kind==="array"&&e.kind==="array"?s.N===e.N&&Ch(s.itemType,e.itemType):s.kind===e.kind}class ul{constructor(e,r,l){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class rf{constructor(e,r,l,u,p){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=l,this.fontStack=u,this.textColor=p}}class ys{constructor(e){this.sections=e}static fromString(e){return new ys([new rf(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof ys?e:ys.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){const u=r.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(r.text);const l={};r.fontStack&&(l["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(l["font-scale"]=r.scale),r.textColor&&(l["text-color"]=["rgba"].concat(r.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(l)}return e}}class Vo{constructor(e,r={}){if(this.id=lo.from(e),this.options=Object.assign({},r),r.transform){const{a:l,b:u,c:p,d:m,e:v,f:b}=r.transform;this.options.transform=new DOMMatrix([l,u,p,m,v,b])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:r,c:l,d:u,e:p,f:m}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:r,c:l,d:u,e:p,f:m}})}static parse(e){let r,l,u,p;try{({name:r,iconsetId:l,params:u,transform:p}=JSON.parse(e)||{})}catch{return null}if(!r)return null;const{a:m,b:v,c:b,d:S,e:A,f:C}=p||{};return new Vo({name:r,iconsetId:l},{params:u,transform:new DOMMatrix([m,v,b,S,A,C])})}scaleSelf(e,r){return this.options.transform.scaleSelf(e,r),this}}class Ps{constructor(e,r,l,u,p=!1){this.primaryId=lo.from(e),this.primaryOptions=r,l&&(this.secondaryId=lo.from(l)),this.secondaryOptions=u,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Vo(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Vo(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Ps.build({name:e}):e}static build(e,r,l,u){return!e||typeof e=="object"&&!("name"in e)?null:new Ps(e,l,r,u)}}function mv(s,e,r,l){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[s,e,r,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[s,e,r,l]:[s,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xc(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Jn||s instanceof ul||s instanceof ys||s instanceof Ps)return!0;if(Array.isArray(s)){for(const e of s)if(!Xc(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!Xc(s[e]))return!1;return!0}return!1}function Ir(s){if(s===null)return ua;if(typeof s=="string")return Qn;if(typeof s=="boolean")return ri;if(typeof s=="number")return Ut;if(s instanceof Jn)return Bs;if(s instanceof ul)return nf;if(s instanceof ys)return cl;if(s instanceof Ps)return Eh;if(Array.isArray(s)){const e=s.length;let r;for(const l of s){const u=Ir(l);if(r){if(r===u)continue;r=qn;break}r=u}return ls(r||qn,e)}return ec}function Ms(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof ys||s instanceof Ps||s instanceof Jn?s.toString():JSON.stringify(s)}class yn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Xc(e[1]))return r.error("invalid value");const l=e[1];let u=Ir(l);const p=r.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new yn(u,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Jn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ys?this.value.serialize():this.value}}class Ct{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ph={string:Qn,number:Ut,boolean:ri,object:ec};class Jt{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l,u=1;const p=e[0];if(p==="array"){let v,b;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in Ph)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=Ph[S],u++}else v=qn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}l=ls(v,b)}else l=Ph[p];const m=[];for(;u<e.length;u++){const v=r.parse(e[u],u,qn);if(!v)return null;m.push(v)}return new Jt(l,m)}evaluate(e){for(let r=0;r<this.args.length;r++){const l=this.args[r].evaluate(e);if(!Ih(this.type,Ir(l)))return l;if(r===this.args.length-1)throw new Ct(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${hr(Ir(l))} but was expected to be of type ${hr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){r.push(l.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&r.push(u)}}return r.concat(this.args.map(l=>l.serialize()))}}class tc{constructor(e){this.type=cl,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return r.error("First argument must be an image or text section.");const u=[];let p=!1;for(let m=1;m<=e.length-1;++m){const v=e[m];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let b=null;if(v["font-scale"]&&(b=r.parseObjectValue(v["font-scale"],m,"font-scale",Ut),!b))return null;let S=null;if(v["text-font"]&&(S=r.parseObjectValue(v["text-font"],m,"text-font",ls(Qn)),!S))return null;let A=null;if(v["text-color"]&&(A=r.parseObjectValue(v["text-color"],m,"text-color",Bs),!A))return null;const C=u[u.length-1];C.scale=b,C.font=S,C.textColor=A}else{const b=r.parse(e[m],m,qn);if(!b)return null;const S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new tc(u)}evaluate(e){return new ys(this.sections.map(r=>{const l=r.content.evaluate(e);return Ch(Ir(l),Eh)?new rf("",l,null,null,null):new rf(Ms(l),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const l={};r.scale&&(l["font-scale"]=r.scale.serialize()),r.font&&(l["text-font"]=r.font.serialize()),r.textColor&&(l["text-color"]=r.textColor.serialize()),e.push(l)}return e}}class Kc{constructor(e,r,l,u){this._imageWarnHistory={},this.type=Eh,this.namePrimary=e,this.nameSecondary=r,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let l=1;const u=[];function p(){if(l<e.length){const v=r.parse(e[l],l++,Qn);return v?(u.push({image:v,options:{}}),!0):(r.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function m(){if(l<e.length){const b=e[l];if((v=b)===null||typeof v!="object"||Array.isArray(v))return!0;const S=b.params,A=b.iconset,C=r.concat(l);if(!S&&!A)return l++,!0;if(S){if(typeof S!="object"||S.constructor!==Object)return C.error('Image options "params" should be an object'),!1;const M={},z=C.concat(void 0,"params");for(const O in S){if(!O)return z.error("Image parameter name should be non-empty"),!1;const $=z.concat(void 0,O).parse(S[O],void 0,Bs,void 0,{typeAnnotation:"coerce"});if(!$)return!1;M[O]=$}u[u.length-1].options.params=M}if(A){if(typeof A!="object"||A.constructor!==Object)return C.error('Image options "iconset" should be an object'),!1;if(!A.id)return C.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=A}return l++,!0}var v;return!0}for(let v=0;v<2;v++)if(!p()||!m())return;return new Kc(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,r){const l={};if(r){for(const u in r)if(r[u])try{l[u]=r[u].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const r={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=Ps.build(r,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const p=u.getPrimary().id;if(u.available=e.availableImages.some(m=>lo.isEqual(m,p)),u.available){const m=u.getSecondary()?u.getSecondary().id:null;m&&(u.available=e.availableImages.some(v=>lo.isEqual(v,m)))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const r in this.paramsPrimary)this.paramsPrimary[r]&&e(this.paramsPrimary[r]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const r in this.paramsSecondary)this.paramsSecondary[r]&&e(this.paramsSecondary[r])}outputDefined(){return!1}serializeOptions(e,r){const l={};if(r&&(l.iconset={id:r}),e){l.params={};for(const u in e)e[u]&&(l.params[u]=e[u].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const r=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);r&&e.push(r)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const r=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);r&&e.push(r)}return e}}function nn(s){return Mh(s)?"string":Rh(s)?"number":Wm(s)?"boolean":Array.isArray(s)?"array":s===null?"null":Hm(s)?"object":typeof s}function Hm(s){return s!=null&&!Array.isArray(s)&&typeof s!="function"&&!(s instanceof String||s instanceof Number||s instanceof Boolean)&&typeof s=="object"}function Mh(s){return typeof s=="string"||s instanceof String}function Rh(s){return typeof s=="number"||s instanceof Number}function Wm(s){return typeof s=="boolean"||s instanceof Boolean}const sf={"to-boolean":ri,"to-color":Bs,"to-number":Ut,"to-string":Qn};class er{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[0],u=[];let p=ua;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const m=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);p=ls(r.expectedType.itemType,m)}else{if(!(m>0&&Xc(e[1][0])))return null;p=ls(Ir(e[1][0]),m)}for(let v=0;v<m;v++){const b=e[1][v];let S;if(Array.isArray(b))S=r.parse(b,void 0,p.itemType);else{const A=nn(b);if(A!==p.itemType.kind)return r.error(`Expected ${p.itemType.kind} but found ${A}.`);S=r.registry.literal.parse(["literal",b===void 0?null:b],r)}if(!S)return null;u.push(S)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return r.error("Expected one argument.");p=sf[l];for(let m=1;m<e.length;m++){const v=r.parse(e[m],m,qn);if(!v)return null;u.push(v)}}return new er(p,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,l;for(const u of this.args){if(r=u.evaluate(e),l=null,r instanceof Jn)return r;if(typeof r=="string"){const p=e.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(l=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:mv(r[0],r[1],r[2],r[3]),!l))return new Jn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ct(l||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const l of this.args){if(r=l.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new Ct(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?ys.fromString(Ms(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ps.build(Ms(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):Ms(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new tc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Kc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const qm=["Unknown","Point","LineString","Polygon"];class ka{constructor(e,r,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r,this.iconImageUseTheme=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?qm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*r-e[0])+this.featureDistanceData.bearing[1]*(u*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Jn.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class vs{constructor(e,r,l,u,p){this.name=e,this.type=r,this._evaluate=l,this.args=u,this._overloadIndex=p}evaluate(e){if(!this._evaluate){const r=vs.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const l=e[0],u=vs.definitions[l];if(!u)return r.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=[];let b=null,S=-1;for(const[A,C]of m){if(Array.isArray(A)&&A.length!==e.length-1)continue;v.push(A),S++,b=new xf(r.registry,r.path,null,r.scope,void 0,r._scope,r.options,r.iconImageUseTheme);const M=[];let z=!1;for(let O=1;O<e.length;O++){const $=e[O],W=Array.isArray(A)?A[O-1]:A.type,q=b.parse($,1+M.length,W);if(!q){z=!0;break}M.push(q)}if(!z)if(Array.isArray(A)&&A.length!==M.length)b.error(`Expected ${A.length} arguments, but found ${M.length} instead.`);else{for(let O=0;O<M.length;O++){const $=Array.isArray(A)?A[O]:A.type,W=M[O];b.concat(O+1).checkSubtype($,W.type)}if(b.errors.length===0)return new vs(l,p,C,M,S)}}if(v.length===1)r.errors.push(...b.errors);else{const A=(v.length?v:m.map(([M])=>M)).map(hl).join(" | "),C=[];for(let M=1;M<e.length;M++){const z=r.parse(e[M],1+C.length);if(!z)return null;C.push(hr(z.type))}r.error(`Expected arguments of type ${A}, but found (${C.join(", ")}) instead.`)}return null}static register(e,r){vs.definitions=r;for(const l in r)e[l]=vs}}function hl(s){return Array.isArray(s)?`(${s.map(hr).join(", ")})`:`(${hr(s.type)}...)`}class Wr{constructor(e,r,l){this.type=nf,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return r.error("Collator options argument must be an object.");const u=l["case-sensitive"]===void 0?r.parse(!1,1,ri):r.parseObjectValue(l["case-sensitive"],1,"case-sensitive",ri);if(!u)return null;const p=l["diacritic-sensitive"]===void 0?r.parse(!1,1,ri):r.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",ri);if(!p)return null;let m=null;return l.locale&&(m=r.parseObjectValue(l.locale,1,"locale",Qn),!m)?null:new Wr(u,p,m)}evaluate(e){return new ul(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function gv(s,e,r=0,l=s.length-1,u=_w){for(;l>r;){if(l-r>600){const b=l-r+1,S=e-r+1,A=Math.log(b),C=.5*Math.exp(2*A/3),M=.5*Math.sqrt(A*C*(b-C)/b)*(S-b/2<0?-1:1);gv(s,e,Math.max(r,Math.floor(e-S*C/b+M)),Math.min(l,Math.floor(e+(b-S)*C/b+M)),u)}const p=s[e];let m=r,v=l;for(kh(s,r,e),u(s[l],p)>0&&kh(s,r,l);m<v;){for(kh(s,m,v),m++,v--;u(s[m],p)<0;)m++;for(;u(s[v],p)>0;)v--}u(s[r],p)===0?kh(s,r,v):(v++,kh(s,v,l)),v<=e&&(r=v+1),e<=v&&(l=v-1)}}function kh(s,e,r){const l=s[e];s[e]=s[r],s[r]=l}function _w(s,e){return s<e?-1:s>e?1:0}function of(s){let e=0;for(let r,l,u=0,p=s.length,m=p-1;u<p;m=u++)r=s[u],l=s[m],e+=(l.x-r.x)*(r.y+l.y);return e}function Yc(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function Uo(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function yw(s,e,r){const l=s[0]-e[0],u=s[1]-e[1],p=s[0]-r[0],m=s[1]-r[1];return l*m-p*u==0&&l*p<=0&&u*m<=0}function Jc(s,e,r=!1){let l=!1;for(let v=0,b=e.length;v<b;v++){const S=e[v];for(let A=0,C=S.length,M=C-1;A<C;M=A++){const z=S[M],O=S[A];if(yw(s,z,O))return r;(p=z)[1]>(u=s)[1]!=(m=O)[1]>u[1]&&u[0]<(m[0]-p[0])*(u[1]-p[1])/(m[1]-p[1])+p[0]&&(l=!l)}}var u,p,m;return l}function _v(s,e,r,l){const u=l[0]-r[0],p=l[1]-r[1],m=(s[0]-r[0])*p-u*(s[1]-r[1]),v=(e[0]-r[0])*p-u*(e[1]-r[1]);return m>0&&v<0||m<0&&v>0}function af(s,e,r,l){return(u=[l[0]-r[0],l[1]-r[1]])[0]*(p=[e[0]-s[0],e[1]-s[1]])[1]-u[1]*p[0]!=0&&!(!_v(s,e,r,l)||!_v(r,l,s,e));var u,p}function lf(s){const e=new ct(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new ct(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const l of s[0])e.x>l.x&&(e.x=l.x),e.y>l.y&&(e.y=l.y),r.x<l.x&&(r.x=l.x),r.y<l.y&&(r.y=l.y);return{min:e,max:r}}const dl=8192;function nc(s,e){const r=(180+s[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*dl),Math.round(l*u*dl)]}function vw(s,e){for(let r=0;r<e.length;r++)if(Jc(s,e[r]))return!0;return!1}function xw(s,e,r){for(const l of r)for(let u=0,p=l.length,m=p-1;u<p;m=u++)if(af(s,e,l[m],l[u]))return!0;return!1}function cf(s,e){for(let r=0;r<s.length;++r)if(!Jc(s[r],e))return!1;for(let r=0;r<s.length-1;++r)if(xw(s[r],s[r+1],e))return!1;return!0}function yv(s,e){for(let r=0;r<e.length;r++)if(cf(s,e[r]))return!0;return!1}function uf(s,e,r){const l=[];for(let u=0;u<s.length;u++){const p=[];for(let m=0;m<s[u].length;m++){const v=nc(s[u][m],r);Yc(e,v),p.push(v)}l.push(p)}return l}function Ao(s,e,r){const l=[];for(let u=0;u<s.length;u++){const p=uf(s[u],e,r);l.push(p)}return l}function vv(s,e,r,l){if(s[0]<r[0]||s[0]>r[2]){const u=.5*l;let p=s[0]-r[0]>u?-l:r[0]-s[0]>u?l:0;p===0&&(p=s[0]-r[2]>u?-l:r[2]-s[0]>u?l:0),s[0]+=p}Yc(e,s)}function xv(s,e,r,l){const u=Math.pow(2,l.z)*dl,p=[l.x*dl,l.y*dl],m=[];if(!s)return m;for(const v of s)for(const b of v){const S=[b.x+p[0],b.y+p[1]];vv(S,e,r,u),m.push(S)}return m}function wv(s,e,r,l){const u=Math.pow(2,l.z)*dl,p=[l.x*dl,l.y*dl],m=[];if(!s)return m;for(const b of s){const S=[];for(const A of b){const C=[A.x+p[0],A.y+p[1]];Yc(e,C),S.push(C)}m.push(S)}if(e[2]-e[0]<=u/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of m)for(const S of b)vv(S,e,r,u)}var v;return m}class ic{constructor(e,r){this.type=ri,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Xc(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let u=0;u<l.features.length;++u){const p=l.features[u].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new ic(l,l.features[u].geometry)}else if(l.type==="Feature"){const u=l.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new ic(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new ic(l,l)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,l){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const v=uf(l.coordinates,p,m),b=xv(r.geometry(),u,p,m);if(!Uo(u,p))return!1;for(const S of b)if(!Jc(S,v))return!1}if(l.type==="MultiPolygon"){const v=Ao(l.coordinates,p,m),b=xv(r.geometry(),u,p,m);if(!Uo(u,p))return!1;for(const S of b)if(!vw(S,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,l){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const v=uf(l.coordinates,p,m),b=wv(r.geometry(),u,p,m);if(!Uo(u,p))return!1;for(const S of b)if(!cf(S,v))return!1}if(l.type==="MultiPolygon"){const v=Ao(l.coordinates,p,m),b=wv(r.geometry(),u,p,m);if(!Uo(u,p))return!1;for(const S of b)if(!yv(S,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Dh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Zm=1/298.257223563,Xm=Zm*(2-Zm),Qc=Math.PI/180;class eu{static fromTile(e,r,l){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),p=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Qc;return new eu(p,l)}static get units(){return Dh}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!Dh[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(Dh).join(", ")}`);const l=6378.137*Qc*(r?Dh[r]:1),u=Math.cos(e*Qc),p=1/(1-Xm*(1-u*u)),m=Math.sqrt(p);this.kx=l*m*u,this.ky=l*m*p*(1-Xm)}distance(e,r){const l=uo(e[0]-r[0])*this.kx,u=(e[1]-r[1])*this.ky;return Math.sqrt(l*l+u*u)}bearing(e,r){const l=uo(r[0]-e[0])*this.kx;return Math.atan2(l,(r[1]-e[1])*this.ky)/Qc}destination(e,r,l){const u=l*Qc;return this.offset(e,Math.sin(u)*r,Math.cos(u)*r)}offset(e,r,l){return[e[0]+r/this.kx,e[1]+l/this.ky]}lineDistance(e){let r=0;for(let l=0;l<e.length-1;l++)r+=this.distance(e[l],e[l+1]);return r}area(e){let r=0;for(let l=0;l<e.length;l++){const u=e[l];for(let p=0,m=u.length,v=m-1;p<m;v=p++)r+=uo(u[p][0]-u[v][0])*(u[p][1]+u[v][1])*(l?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let l=0;if(r<=0)return e[0];for(let u=0;u<e.length-1;u++){const p=e[u],m=e[u+1],v=this.distance(p,m);if(l+=v,l>r)return hf(p,m,(r-(l-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,r,l){let[u,p]=r,m=uo(l[0]-u)*this.kx,v=(l[1]-p)*this.ky;if(m!==0||v!==0){const b=(uo(e[0]-u)*this.kx*m+(e[1]-p)*this.ky*v)/(m*m+v*v);b>1?(u=l[0],p=l[1]):b>0&&(u+=m/this.kx*b,p+=v/this.ky*b)}return m=uo(e[0]-u)*this.kx,v=(e[1]-p)*this.ky,Math.sqrt(m*m+v*v)}pointOnLine(e,r){let l=1/0,u=e[0][0],p=e[0][1],m=0,v=0;for(let b=0;b<e.length-1;b++){let S=e[b][0],A=e[b][1],C=uo(e[b+1][0]-S)*this.kx,M=(e[b+1][1]-A)*this.ky,z=0;C===0&&M===0||(z=(uo(r[0]-S)*this.kx*C+(r[1]-A)*this.ky*M)/(C*C+M*M),z>1?(S=e[b+1][0],A=e[b+1][1]):z>0&&(S+=C/this.kx*z,A+=M/this.ky*z)),C=uo(r[0]-S)*this.kx,M=(r[1]-A)*this.ky;const O=C*C+M*M;O<l&&(l=O,u=S,p=A,m=b,v=z)}return{point:[u,p],index:m,t:Math.max(0,Math.min(1,v))}}lineSlice(e,r,l){let u=this.pointOnLine(l,e),p=this.pointOnLine(l,r);if(u.index>p.index||u.index===p.index&&u.t>p.t){const S=u;u=p,p=S}const m=[u.point],v=u.index+1,b=p.index;!Km(l[v],m[0])&&v<=b&&m.push(l[v]);for(let S=v+1;S<=b;S++)m.push(l[S]);return Km(l[b],p.point)||m.push(p.point),m}lineSliceAlong(e,r,l){let u=0;const p=[];for(let m=0;m<l.length-1;m++){const v=l[m],b=l[m+1],S=this.distance(v,b);if(u+=S,u>e&&p.length===0&&p.push(hf(v,b,(e-(u-S))/S)),u>=r)return p.push(hf(v,b,(r-(u-S))/S)),p;u>e&&p.push(b)}return p}bufferPoint(e,r){const l=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-l,e[0]+u,e[1]+l]}bufferBBox(e,r){const l=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-l,e[2]+u,e[3]+l]}insideBBox(e,r){return uo(e[0]-r[0])>=0&&uo(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function Km(s,e){return s[0]===e[0]&&s[1]===e[1]}function hf(s,e,r){const l=uo(e[0]-s[0]);return[s[0]+l*r,s[1]+(e[1]-s[1])*r]}function uo(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class df{constructor(e=[],r=(l,u)=>l<u?-1:l>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:l}=this,u=r[e];for(;e>0;){const p=e-1>>1,m=r[p];if(l(u,m)>=0)break;r[e]=m,e=p}r[e]=u}_down(e){const{data:r,compare:l}=this,u=this.length>>1,p=r[e];for(;e<u;){let m=1+(e<<1);const v=m+1;if(v<this.length&&l(r[v],r[m])<0&&(m=v),l(r[m],p)>=0)break;r[e]=r[m],e=m}r[e]=p}}var vt=8192;function Ym(s,e){return e.dist-s.dist}const tu=100,nu=50;function Lh(s){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==s.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==s[r])return!1;return!0}function zh(s){return s[1]-s[0]+1}function ha(s,e){const r=s[1]>=s[0]&&s[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function ff(s,e){if(s[0]>s[1])return[null,null];const r=zh(s);if(e){if(r===2)return[s,null];const l=Math.floor(r/2);return[[s[0],s[0]+l],[s[0]+l,s[1]]]}{if(r===1)return[s,null];const l=Math.floor(r/2)-1;return[[s[0],s[0]+l],[s[0]+l+1,s[1]]]}}function Co(s,e){const r=[1/0,1/0,-1/0,-1/0];if(!ha(e,s.length))return r;for(let l=e[0];l<=e[1];++l)Yc(r,s[l]);return r}function Ln(s){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<s.length;++r)for(let l=0;l<s[r].length;++l)Yc(e,s[r][l]);return e}function iu(s,e,r){if(Lh(s)||Lh(e))return NaN;let l=0,u=0;return s[2]<e[0]&&(l=e[0]-s[2]),s[0]>e[2]&&(l=s[0]-e[2]),s[1]>e[3]&&(u=s[1]-e[3]),s[3]<e[1]&&(u=e[1]-s[3]),r.distance([0,0],[l,u])}function ww(s){return 360*s-180}function bw(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function pf(s,e){const r=Math.pow(2,e.z),l=(s.y/vt+e.y)/r;return[ww((s.x/vt+e.x)/r),bw(l)]}function Tw(s,e){const r=[];for(let l=0;l<s.length;++l)r.push(pf(s[l],e));return r}function zi(s,e,r){const l=r.pointOnLine(e,s).point;return r.distance(s,l)}function bv(s,e,r,l,u){const p=r.slice(l[0],l[1]+1);let m=1/0;for(let v=e[0];v<=e[1];++v)if((m=Math.min(m,zi(s[v],p,u)))===0)return 0;return m}function Jm(s,e,r,l,u){const p=Math.min(u.pointToSegmentDistance(s,r,l),u.pointToSegmentDistance(e,r,l)),m=Math.min(u.pointToSegmentDistance(r,s,e),u.pointToSegmentDistance(l,s,e));return Math.min(p,m)}function Sw(s,e,r,l,u){if(!ha(e,s.length)||!ha(l,r.length))return NaN;let p=1/0;for(let m=e[0];m<e[1];++m)for(let v=l[0];v<l[1];++v){if(af(s[m],s[m+1],r[v],r[v+1]))return 0;p=Math.min(p,Jm(s[m],s[m+1],r[v],r[v+1],u))}return p}function Ew(s,e,r,l,u){if(!ha(e,s.length)||!ha(l,r.length))return NaN;let p=1/0;for(let m=e[0];m<=e[1];++m)for(let v=l[0];v<=l[1];++v)if((p=Math.min(p,u.distance(s[m],r[v])))===0)return p;return p}function Iw(s,e,r){if(Jc(s,e,!0))return 0;let l=1/0;for(const u of e){const p=u.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[p-1]&&(l=Math.min(l,r.pointToSegmentDistance(s,u[p-1],u[0])))===0||(l=Math.min(l,zi(s,u,r)))===0)return l}return l}function Aw(s,e,r,l){if(!ha(e,s.length))return NaN;for(let p=e[0];p<=e[1];++p)if(Jc(s[p],r,!0))return 0;let u=1/0;for(let p=e[0];p<e[1];++p)for(const m of r)for(let v=0,b=m.length,S=b-1;v<b;S=v++){if(af(s[p],s[p+1],m[S],m[v]))return 0;u=Math.min(u,Jm(s[p],s[p+1],m[S],m[v],l))}return u}function Tv(s,e){for(const r of s)for(let l=0;l<=r.length-1;++l)if(Jc(r[l],e,!0))return!0;return!1}function Cw(s,e,r,l=1/0){const u=Ln(s),p=Ln(e);if(l!==1/0&&iu(u,p,r)>=l)return l;if(Uo(u,p)){if(Tv(s,e))return 0}else if(Tv(e,s))return 0;let m=l;for(const v of s)for(let b=0,S=v.length,A=S-1;b<S;A=b++)for(const C of e)for(let M=0,z=C.length,O=z-1;M<z;O=M++){if(af(v[A],v[b],C[O],C[M]))return 0;m=Math.min(m,Jm(v[A],v[b],C[O],C[M],r))}return m}function mf(s,e,r,l,u,p,m){if(p===null||m===null)return;const v=iu(Co(l,p),Co(u,m),r);v<e&&s.push({dist:v,range1:p,range2:m})}function Pw(s,e,r,l,u=1/0){let p=Math.min(l.distance(s[0],r[0][0]),u);if(p===0)return p;const m=new df([{dist:0,range1:[0,s.length-1],range2:[0,0]}],Ym),v=e?nu:tu,b=Ln(r);for(;m.length;){const S=m.pop();if(S.dist>=p)continue;const A=S.range1;if(zh(A)<=v){if(!ha(A,s.length))return NaN;if(e){const C=Aw(s,A,r,l);if((p=Math.min(p,C))===0)return p}else for(let C=A[0];C<=A[1];++C){const M=Iw(s[C],r,l);if((p=Math.min(p,M))===0)return p}}else{const C=ff(A,e);if(C[0]!==null){const M=iu(Co(s,C[0]),b,l);M<p&&m.push({dist:M,range1:C[0],range2:[0,0]})}if(C[1]!==null){const M=iu(Co(s,C[1]),b,l);M<p&&m.push({dist:M,range1:C[1],range2:[0,0]})}}}return p}function Sv(s,e,r,l,u,p=1/0){let m=Math.min(p,u.distance(s[0],r[0]));if(m===0)return m;const v=new df([{dist:0,range1:[0,s.length-1],range2:[0,r.length-1]}],Ym),b=e?nu:tu,S=l?nu:tu;for(;v.length;){const A=v.pop();if(A.dist>=m)continue;const C=A.range1,M=A.range2;if(zh(C)<=b&&zh(M)<=S){if(!ha(C,s.length)||!ha(M,r.length))return NaN;if(e&&l?m=Math.min(m,Sw(s,C,r,M,u)):e||l?e&&!l?m=Math.min(m,bv(r,M,s,C,u)):!e&&l&&(m=Math.min(m,bv(s,C,r,M,u))):m=Math.min(m,Ew(s,C,r,M,u)),m===0)return m}else{const z=ff(C,e),O=ff(M,l);mf(v,m,u,s,r,z[0],O[0]),mf(v,m,u,s,r,z[0],O[1]),mf(v,m,u,s,r,z[1],O[0]),mf(v,m,u,s,r,z[1],O[1])}}return m}function Qm(s,e,r,l,u=1/0){let p=u;const m=Co(s,[0,s.length-1]);for(const v of r)if(!(p!==1/0&&iu(m,Co(v,[0,v.length-1]),l)>=p)&&(p=Math.min(p,Sv(s,e,v,!0,l,p)),p===0))return p;return p}function gf(s,e,r,l,u=1/0){let p=u;const m=Co(s,[0,s.length-1]);for(const v of r){if(p!==1/0&&iu(m,Ln(v),l)>=p)continue;const b=Pw(s,e,v,l,p);if(isNaN(b))return b;if((p=Math.min(p,b))===0)return p}return p}function eg(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class rc{constructor(e,r){this.type=Ut,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Xc(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let u=0;u<l.features.length;++u)if(eg(l.features[u].geometry.type))return new rc(l,l.features[u].geometry)}else if(l.type==="Feature"){if(eg(l.geometry.type))return new rc(l,l.geometry)}else if(eg(l.type))return new rc(l,l)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),l=e.canonicalID();if(r!=null&&l!=null){if(e.geometryType()==="Point")return function(u,p,m){const v=[];for(const S of u)for(const A of S)v.push(pf(A,p));const b=new eu(v[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Sv(v,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",b):m.type==="MultiLineString"?Qm(v,!1,m.coordinates,b):m.type==="Polygon"||m.type==="MultiPolygon"?gf(v,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,b):null}(r,l,this.geometries);if(e.geometryType()==="LineString")return function(u,p,m){const v=[];for(const S of u){const A=[];for(const C of S)A.push(pf(C,p));v.push(A)}const b=new eu(v[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Qm(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,b);if(m.type==="MultiLineString"){let S=1/0;for(let A=0;A<m.coordinates.length;A++){const C=Qm(m.coordinates[A],!0,v,b,S);if(isNaN(C))return C;if((S=Math.min(S,C))===0)return S}return S}if(m.type==="Polygon"||m.type==="MultiPolygon"){let S=1/0;for(let A=0;A<v.length;A++){const C=gf(v[A],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,b,S);if(isNaN(C))return C;if((S=Math.min(S,C))===0)return S}return S}return null}(r,l,this.geometries);if(e.geometryType()==="Polygon")return function(u,p,m){const v=[];for(const S of function(A,C){const M=A.length;if(M<=1)return[A];const z=[];let O,$;for(let W=0;W<M;W++){const q=of(A[W]);q!==0&&(A[W].area=Math.abs(q),$===void 0&&($=q<0),$===q<0?(O&&z.push(O),O=[A[W]]):O.push(A[W]))}return O&&z.push(O),z}(u)){const A=[];for(let C=0;C<S.length;++C)A.push(Tw(S[C],p));v.push(A)}const b=new eu(v[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return gf(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,b);if(m.type==="MultiLineString"){let S=1/0;for(let A=0;A<m.coordinates.length;A++){const C=gf(m.coordinates[A],!0,v,b,S);if(isNaN(C))return C;if((S=Math.min(S,C))===0)return S}return S}return m.type==="Polygon"||m.type==="MultiPolygon"?function(S,A,C){let M=1/0;for(const z of S)for(const O of A){const $=Cw(z,O,C,M);if(isNaN($))return $;if((M=Math.min(M,$))===0)return M}return M}(m.type==="Polygon"?[m.coordinates]:m.coordinates,v,b):null}(r,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ru(s){if(s instanceof vs&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof ic||s instanceof rc)return!1;if(s instanceof ou)return s.featureConstant;let e=!0;return s.eachChild(r=>{e&&!ru(r)&&(e=!1)}),e}function _f(s){if(s instanceof vs&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(r=>{e&&!_f(r)&&(e=!1)}),e}function yf(s){if(s instanceof ou)return new Set([s.key]);let e=new Set;return s.eachChild(r=>{e=new Set([...e,...yf(r)])}),e}function su(s,e){if(s instanceof vs&&e.indexOf(s.name)>=0)return!1;let r=!0;return s.eachChild(l=>{r&&!su(l,e)&&(r=!1)}),r}function Ev(s,e,r){return[s,e,r].filter(Boolean).join("")}function tg(s,e){switch(s){case"string":return Ms(e);case"number":return+e;case"boolean":return!!e;case"color":return Jn.parse(e);case"formatted":return ys.fromString(Ms(e));case"resolvedImage":return Ps.build(Ms(e))}return e}function Iv(s,e,r,l){return l!==void 0&&(s=l*Math.round(s/l)),e!==void 0&&s<e&&(s=e),r!==void 0&&s>r&&(s=r),s}class ou{constructor(e,r,l,u=!1){this.type=e,this.key=r,this.scope=l,this.featureConstant=u}static parse(e,r){let l=r.expectedType;if(l==null&&(l=qn),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");const u=r.parse(e[1],1);if(!(u instanceof yn))return r.error("Key name of 'config' expression must be a string literal.");let p,m=!0;const v=Ms(u.value);if(e.length>=3){const b=r.parse(e[2],2);if(!(b instanceof yn))return r.error("Scope of 'config' expression must be a string literal.");p=Ms(b.value)}if(r.options){const b=Ev(v,p,r._scope),S=r.options.get(b);S&&(m=ru(S.value||S.default))}return new ou(l,v,p,m)}evaluate(e){const r=Ev(this.key,this.scope,e.scope),l=e.getConfig(r);if(!l)return null;const{type:u,value:p,values:m,minValue:v,maxValue:b,stepValue:S}=l,A=l.default.evaluate(e);let C=A;if(p){const M=e.scope;e.scope=(M||"").split("").slice(1).join(""),C=p.evaluate(e),e.scope=M}return u&&(C=tg(u,C)),C===void 0||v===void 0&&b===void 0&&S===void 0||(typeof C=="number"?C=Iv(C,v,b,S):Array.isArray(C)&&(C=C.map(M=>typeof M=="number"?Iv(M,v,b,S):M))),p!==void 0&&C!==void 0&&m&&!m.includes(C)&&(C=A,u&&(C=tg(u,C))),(u&&u!==this.type||C!==void 0&&!Ch(Ir(C),this.type))&&(C=tg(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class vf{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const l=e[1];return r.scope.has(l)?new vf(l,r.scope.get(l)):r.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class xf{constructor(e,r=[],l,u=new tf,p=[],m,v,b){this.registry=e,this.path=r,this.key=r.map(S=>typeof S=="string"?`['${S}']`:`[${S}]`).join(""),this.scope=u,this.errors=p,this.expectedType=l,this._scope=m,this.options=v,this.iconImageUseTheme=b}parse(e,r,l,u,p={}){return r||l?this.concat(r,null,l,u)._parse(e,p):this._parse(e,p)}parseObjectValue(e,r,l,u,p,m={}){return this.concat(r,l,u,p)._parse(e,m)}_parse(e,r){function l(u,p,m){return m==="assert"?new Jt(p,[u]):m==="coerce"?new er(p,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let p=u.parse(e,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,v=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||v.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(m,v))return null}else p=l(p,m,r.typeAnnotation||"coerce");else p=l(p,m,r.typeAnnotation||"assert")}if(!(p instanceof yn)&&p.type.kind!=="resolvedImage"&&ng(p)){const m=new ka(this._scope,this.options,this.iconImageUseTheme);try{p=new yn(p.type,p.evaluate(m))}catch(v){return this.error(v.message),null}}return p}return er.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,l,u){let p=typeof e=="number"?this.path.concat(e):this.path;p=typeof r=="string"?p.concat(r):p;const m=u?this.scope.concat(u):this.scope;return new xf(this.registry,p,l||null,m,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...r){const l=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new jo(l,e))}checkSubtype(e,r){const l=Ih(e,r);return l&&this.error(l),l}}function ng(s){if(s instanceof vf)return ng(s.boundExpression);if(s instanceof vs&&s.name==="error"||s instanceof Wr||s instanceof ic||s instanceof rc||s instanceof ou)return!1;const e=s instanceof er||s instanceof Jt;let r=!0;return s.eachChild(l=>{r=e?r&&ng(l):r&&l instanceof yn}),!!r&&ru(s)&&su(s,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function wf(s,e){const r=s.length-1;let l,u,p=0,m=r,v=0;for(;p<=m;)if(v=Math.floor((p+m)/2),l=s[v],u=s[v+1],l<=e){if(v===r||e<u)return v;p=v+1}else{if(!(l>e))throw new Ct("Input is not a number.");m=v-1}return 0}class Oh{constructor(e,r,l){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,p]of l)this.labels.push(u),this.outputs.push(p)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const l=r.parse(e[1],1,Ut);if(!l)return null;const u=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let m=1;m<e.length;m+=2){const v=m===1?-1/0:e[m],b=e[m+1],S=m,A=m+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(u.length&&u[u.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const C=r.parse(b,A,p);if(!C)return null;p=p||C.type,u.push([v,C])}return new Oh(p,l,u)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return l[0].evaluate(e);const p=r.length;return u>=r[p-1]?l[p-1].evaluate(e):l[wf(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}const Av=.95047,Cv=1.08883,Pv=4/29,fl=6/29,Mv=3*fl*fl,Rv=fl*fl*fl,Mw=Math.PI/180,Rw=180/Math.PI;function ig(s){return s>Rv?Math.pow(s,1/3):s/Mv+Pv}function bf(s){return s>fl?s*s*s:Mv*(s-Pv)}function Tf(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function pl(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function rg(s){const e=pl(s.r),r=pl(s.g),l=pl(s.b),u=ig((.4124564*e+.3575761*r+.1804375*l)/Av),p=ig((.2126729*e+.7151522*r+.072175*l)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-ig((.0193339*e+.119192*r+.9503041*l)/Cv)),alpha:s.a}}function sg(s){let e=(s.l+16)/116,r=isNaN(s.a)?e:e+s.a/500,l=isNaN(s.b)?e:e-s.b/200;return e=1*bf(e),r=Av*bf(r),l=Cv*bf(l),new Jn(Tf(3.2404542*r-1.5371385*e-.4985314*l),Tf(-.969266*r+1.8760108*e+.041556*l),Tf(.0556434*r-.2040259*e+1.0572252*l),s.alpha)}function kw(s,e,r){const l=e-s;return s+r*(l>180||l<-180?l-360*Math.round(l/360):l)}const sc={forward:rg,reverse:sg,interpolate:function(s,e,r){return{l:Kt(s.l,e.l,r),a:Kt(s.a,e.a,r),b:Kt(s.b,e.b,r),alpha:Kt(s.alpha,e.alpha,r)}}},oc={forward:function(s){const{l:e,a:r,b:l}=rg(s),u=Math.atan2(l,r)*Rw;return{h:u<0?u+360:u,c:Math.sqrt(r*r+l*l),l:e,alpha:s.a}},reverse:function(s){const e=s.h*Mw,r=s.c;return sg({l:s.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:s.alpha})},interpolate:function(s,e,r){return{h:kw(s.h,e.h,r),c:Kt(s.c,e.c,r),l:Kt(s.l,e.l,r),alpha:Kt(s.alpha,e.alpha,r)}}};var kv=Object.freeze({__proto__:null,hcl:oc,lab:sc});class ho{constructor(e,r,l,u,p){this.type=e,this.operator=r,this.interpolation=l,this.input=u,this.labels=[],this.outputs=[];for(const[m,v]of p)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(e,r,l,u){let p=0;if(e.name==="exponential")p=Sf(r,e.base,l,u);else if(e.name==="linear")p=Sf(r,1,l,u);else if(e.name==="cubic-bezier"){const m=e.controlPoints;p=new Kl(m[0],m[1],m[2],m[3]).solve(Sf(r,1,l,u))}return p}static parse(e,r){let[l,u,p,...m]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const S=u[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:S}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const S=u.slice(1);if(S.length!==4||S.some(A=>typeof A!="number"||A<0||A>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,Ut),!p)return null;const v=[];let b=null;l==="interpolate-hcl"||l==="interpolate-lab"?b=Bs:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let S=0;S<m.length;S+=2){const A=m[S],C=m[S+1],M=S+3,z=S+4;if(typeof A!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(v.length&&v[v.length-1][0]>=A)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const O=r.parse(C,z,b);if(!O)return null;b=b||O.type,v.push([A,O])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new ho(b,l,u,p,v):r.error(`Type ${hr(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return l[0].evaluate(e);const p=r.length;if(u>=r[p-1])return l[p-1].evaluate(e);const m=wf(r,u),v=ho.interpolationFactor(this.interpolation,u,r[m],r[m+1]),b=l[m].evaluate(e),S=l[m+1].evaluate(e);return this.operator==="interpolate"?co[this.type.kind.toLowerCase()](b,S,v):this.operator==="interpolate-hcl"?oc.reverse(oc.interpolate(oc.forward(b),oc.forward(S),v)):sc.reverse(sc.interpolate(sc.forward(b),sc.forward(S),v))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const r=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)r.push(this.labels[l],this.outputs[l].serialize());return r}}function Sf(s,e,r,l){const u=l-r,p=s-r;return u===0?0:e===1?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}class Fh{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let l=null;const u=r.expectedType;u&&u.kind!=="value"&&(l=u);const p=[];for(const v of e.slice(1)){const b=r.parse(v,1+p.length,l,void 0,{typeAnnotation:"omit"});if(!b)return null;l=l||b.type,p.push(b)}const m=u&&p.some(v=>Ih(u,v.type));return new Fh(m?qn:l,p)}evaluate(e){let r,l=null,u=0;for(const p of this.args){if(u++,l=p.evaluate(e),l&&l instanceof Ps&&!l.available&&(r||(r=l),l=null,u===this.args.length))return r;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Ef{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let p=1;p<e.length-1;p+=2){const m=e[p];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=r.parse(e[p+1],p+1);if(!v)return null;l.push([m,v])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,l);return u?new Ef(l,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,l]of this.bindings)e.push(r,l.serialize());return e.push(this.result.serialize()),e}}class og{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Ut),u=r.parse(e[2],2,ls(r.expectedType||qn));return l&&u?new og(u.type.itemType,l,u):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new Ct("Array index out of bounds: negative index");if(r>=l.length)throw new Ct("Array index out of bounds: index exceeds array size");if(r!==Math.floor(r))throw new Ct("Array index must be an integer. Use at-interpolated for fractional indices");return l[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ag{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Ut),u=r.parse(e[2],2,ls(r.expectedType||qn));return l&&u?new ag(u.type.itemType,l,u):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new Ct(`Array index out of bounds: ${r} < 0.`);if(r>l.length-1)throw new Ct(`Array index out of bounds: ${r} > ${l.length-1}.`);if(r===Math.floor(r))return l[r];const u=Math.floor(r),p=Math.ceil(r),m=l[u],v=l[p];if(typeof m!="number"||typeof v!="number")throw new Ct(`Cannot interpolate between non-number values at index ${r}.`);const b=r-u;return m*(1-b)+v*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class If{constructor(e,r){this.type=ri,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,qn),u=r.parse(e[2],2,qn);return l&&u?$m(l.type,[ri,Qn,Ut,ua,qn])?new If(l,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${hr(l.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Ah(r,["boolean","string","number","null"]))throw new Ct(`Expected first argument to be of type boolean, string, number or null, but found ${hr(Ir(r))} instead.`);if(!Ah(l,["string","array"]))throw new Ct(`Expected second argument to be of type array or string, but found ${hr(Ir(l))} instead.`);return l.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Nh{constructor(e,r,l){this.type=Ut,this.needle=e,this.haystack=r,this.fromIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,qn),u=r.parse(e[2],2,qn);if(!l||!u)return null;if(!$m(l.type,[ri,Qn,Ut,ua,qn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${hr(l.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,Ut);return p?new Nh(l,u,p):null}return new Nh(l,u)}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Ah(r,["boolean","string","number","null"]))throw new Ct(`Expected first argument to be of type boolean, string, number or null, but found ${hr(Ir(r))} instead.`);if(!Ah(l,["string","array"]))throw new Ct(`Expected second argument to be of type array or string, but found ${hr(Ir(l))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return l.indexOf(r,u)}return l.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class au{constructor(e,r,l,u,p,m){this.inputType=e,this.type=r,this.input=l,this.cases=u,this.outputs=p,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let l,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const p={},m=[];for(let S=2;S<e.length-1;S+=2){let A=e[S];const C=e[S+1];Array.isArray(A)||(A=[A]);const M=r.concat(S);if(A.length===0)return M.error("Expected at least one branch label.");for(const O of A){if(typeof O!="number"&&typeof O!="string")return M.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return M.error("Numeric branch labels must be integer values.");if(l){if(M.checkSubtype(l,Ir(O)))return null}else l=Ir(O);if(p[String(O)]!==void 0)return M.error("Branch labels must be unique.");p[String(O)]=m.length}const z=r.parse(C,S,u);if(!z)return null;u=u||z.type,m.push(z)}const v=r.parse(e[1],1,qn);if(!v)return null;const b=r.parse(e[e.length-1],e.length-1,u);return b?v.type.kind!=="value"&&r.concat(1).checkSubtype(l,v.type)?null:new au(l,u,v,p,m,b):null}evaluate(e){const r=this.input.evaluate(e);return(Ch(Ir(r),this.inputType)&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),l=[],u={};for(const m of r){const v=u[this.cases[m]];v===void 0?(u[this.cases[m]]=l.length,l.push([this.cases[m],[m]])):l[v][1].push(m)}const p=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,v]of l)e.push(v.length===1?p(v[0]):v.map(p)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class lg{constructor(e,r,l){this.type=e,this.branches=r,this.otherwise=l}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const u=[];for(let m=1;m<e.length-1;m+=2){const v=r.parse(e[m],m,ri);if(!v)return null;const b=r.parse(e[m+1],m+1,l);if(!b)return null;u.push([v,b]),l=l||b.type}const p=r.parse(e[e.length-1],e.length-1,l);return p?new lg(l,u,p):null}evaluate(e){for(const[r,l]of this.branches)if(r.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,l]of this.branches)e(r),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Bh{constructor(e,r,l,u){this.type=e,this.input=r,this.beginIndex=l,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,qn),u=r.parse(e[2],2,Ut);if(!l||!u)return null;if(!$m(l.type,[ls(qn),Qn,qn]))return r.error(`Expected first argument to be of type array or string, but found ${hr(l.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,Ut);return p?new Bh(l.type,l,u,p):null}return new Bh(l.type,l,u)}evaluate(e){const r=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Ah(r,["string","array"]))throw new Ct(`Expected first argument to be of type array or string, but found ${hr(Ir(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(l,u)}return r.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class cg{constructor(e,r){this.type=ls(Qn),this.str=e,this.delimiter=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Qn),u=r.parse(e[2],2,Qn);return l&&u?new cg(l,u):void 0}evaluate(e){const r=this.str.evaluate(e),l=this.delimiter.evaluate(e);return r.split(l)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Dv(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ug(s,e,r,l){return l.compare(e,r)===0}function ac(s,e,r){const l=s!=="=="&&s!=="!=";return class LN{constructor(p,m,v){this.type=ri,this.lhs=p,this.rhs=m,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const v=p[0];let b=m.parse(p[1],1,qn);if(!b)return null;if(!Dv(v,b.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${hr(b.type)}'.`);let S=m.parse(p[2],2,qn);if(!S)return null;if(!Dv(v,S.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${hr(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return m.error(`Cannot compare types '${hr(b.type)}' and '${hr(S.type)}'.`);l&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new Jt(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new Jt(b.type,[S])));let A=null;if(p.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(A=m.parse(p[3],3,nf),!A)return null}return new LN(b,S,A)}evaluate(p){const m=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(l&&this.hasUntypedArgument){const b=Ir(m),S=Ir(v);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new Ct(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const b=Ir(m),S=Ir(v);if(b.kind!=="string"||S.kind!=="string")return e(p,m,v)}return this.collator?r(p,m,v,this.collator.evaluate(p)):e(p,m,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[s];return this.eachChild(m=>{p.push(m.serialize())}),p}}}const Dw=ac("==",function(s,e,r){return e===r},ug),Lw=ac("!=",function(s,e,r){return e!==r},function(s,e,r,l){return!ug(0,e,r,l)}),zw=ac("<",function(s,e,r){return e<r},function(s,e,r,l){return l.compare(e,r)<0}),Af=ac(">",function(s,e,r){return e>r},function(s,e,r,l){return l.compare(e,r)>0}),Ow=ac("<=",function(s,e,r){return e<=r},function(s,e,r,l){return l.compare(e,r)<=0}),Fw=ac(">=",function(s,e,r){return e>=r},function(s,e,r,l){return l.compare(e,r)>=0});class hg{constructor(e,r,l,u,p,m){this.type=Qn,this.number=e,this.locale=r,this.currency=l,this.unit=u,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const l=r.parse(e[1],1,Ut);if(!l)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=r.parseObjectValue(u.locale,2,"locale",Qn),!p))return null;let m=null;if(u.currency&&(m=r.parseObjectValue(u.currency,2,"currency",Qn),!m))return null;let v=null;if(u.unit&&(v=r.parseObjectValue(u.unit,2,"unit",Qn),!v))return null;let b=null;if(u["min-fraction-digits"]&&(b=r.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",Ut),!b))return null;let S=null;return u["max-fraction-digits"]&&(S=r.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",Ut),!S)?null:new hg(l,p,m,v,b,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class dg{constructor(e){this.type=Ut,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=r.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${hr(l.type)} instead.`):new dg(l):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Ct(`Expected value to be of type string or array, but found ${hr(Ir(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function fg(s){return function(){s=1831565813+(s|=0)|0;let e=Math.imul(s^s>>>15,1|s);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const lu={"==":Dw,"!=":Lw,">":Af,"<":zw,">=":Fw,"<=":Ow,array:Jt,at:og,"at-interpolated":ag,boolean:Jt,case:lg,coalesce:Fh,collator:Wr,format:tc,image:Kc,in:If,"index-of":Nh,interpolate:ho,"interpolate-hcl":ho,"interpolate-lab":ho,length:dg,let:Ef,literal:yn,match:au,number:Jt,"number-format":hg,object:Jt,slice:Bh,step:Oh,string:Jt,"to-boolean":er,"to-color":er,"to-number":er,"to-string":er,var:vf,within:ic,distance:rc,config:ou,split:cg};function Lv(s,[e,r,l,u]){e=e.evaluate(s),r=r.evaluate(s),l=l.evaluate(s);const p=u?u.evaluate(s):1,m=mv(e,r,l,p);if(m)throw new Ct(m);return new Jn(e/255,r/255,l/255,p)}function pg(s,[e,r,l,u]){e=e.evaluate(s),r=r.evaluate(s),l=l.evaluate(s);const p=u?u.evaluate(s):1,m=function(S,A,C,M){return typeof S=="number"&&S>=0&&S<=360?typeof A=="number"&&A>=0&&A<=100&&typeof C=="number"&&C>=0&&C<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[S,A,C,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[S,A,C,M]:[S,A,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[S,A,C,M]:[S,A,C]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,l,p);if(m)throw new Ct(m);const v=`hsla(${e}, ${r}%, ${l}%, ${p})`,b=Jn.parse(v);if(!b)throw new Ct(`Failed to parse HSLA color: ${v}`);return b}function mg(s,e){return s in e}function Cf(s,e){const r=e[s];return r===void 0?null:r}function lc(s){return{type:s}}function cc(s){return{result:"success",value:s}}function ml(s){return{result:"error",value:s}}function gg(s,e){return!!s&&!!s.parameters&&s.parameters.indexOf(e)>-1}function Pf(s){return s["property-type"]==="data-driven"}function _g(s){return gg(s.expression,"measure-light")}function yg(s){return gg(s.expression,"zoom")}function Mf(s){return!!s.expression&&s.expression.interpolated}function Rf(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function vg(s){return s}function kf(s,e){const r=e.type==="color",l=s.stops&&typeof s.stops[0][0]=="object",u=l||!(l||s.property!==void 0),p=s.type||(Mf(e)?"exponential":"interval");if(r&&((s=Object.assign({},s)).stops&&(s.stops=s.stops.map(S=>[S[0],Jn.parse(S[1])])),s.default=Jn.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!kv[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let m,v,b;if(p==="exponential")m=zv;else if(p==="interval")m=gl;else if(p==="categorical"){m=Nw,v=Object.create(null);for(const S of s.stops)v[S[0]]=S[1];b=typeof s.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=Bw}if(l){const S={},A=[];for(let z=0;z<s.stops.length;z++){const O=s.stops[z],$=O[0].zoom;S[$]===void 0&&(S[$]={zoom:$,type:s.type,property:s.property,default:s.default,stops:[]},A.push($)),S[$].stops.push([O[0].value,O[1]])}const C=[];for(const z of A)C.push([S[z].zoom,kf(S[z],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:ho.interpolationFactor.bind(void 0,M),zoomStops:C.map(z=>z[0]),evaluate:({zoom:z},O)=>zv({stops:C,base:s.base},e,z).evaluate(z,O)}}if(u){const S=p==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:ho.interpolationFactor.bind(void 0,S),zoomStops:s.stops.map(A=>A[0]),evaluate:({zoom:A})=>m(s,e,A,v,b)}}return{kind:"source",evaluate(S,A){const C=A&&A.properties?A.properties[s.property]:void 0;return C===void 0?cu(s.default,e.default):m(s,e,C,v,b)}}}function cu(s,e,r){return s!==void 0?s:e!==void 0?e:r!==void 0?r:void 0}function Nw(s,e,r,l,u){return cu(typeof r===u?l[r]:void 0,s.default,e.default)}function gl(s,e,r){if(!Rh(r))return cu(s.default,e.default);const l=s.stops.length;if(l===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[l-1][0])return s.stops[l-1][1];const u=wf(s.stops.map(p=>p[0]),r);return s.stops[u][1]}function zv(s,e,r){const l=s.base!==void 0?s.base:1;if(!Rh(r))return cu(s.default,e.default);const u=s.stops.length;if(u===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[u-1][0])return s.stops[u-1][1];const p=wf(s.stops.map(A=>A[0]),r),m=function(A,C,M,z){const O=z-M,$=A-M;return O===0?0:C===1?$/O:(Math.pow(C,$)-1)/(Math.pow(C,O)-1)}(r,l,s.stops[p][0],s.stops[p+1][0]),v=s.stops[p][1],b=s.stops[p+1][1];let S=co[e.type]||vg;if(s.colorSpace&&s.colorSpace!=="rgb"){const A=kv[s.colorSpace];S=(C,M)=>A.reverse(A.interpolate(A.forward(C),A.forward(M),m))}return typeof v.evaluate=="function"?{evaluate(...A){const C=v.evaluate.apply(void 0,A),M=b.evaluate.apply(void 0,A);if(C!==void 0&&M!==void 0)return S(C,M,m)}}:S(v,b,m)}function Bw(s,e,r){return e.type==="color"?r=Jn.parse(r):e.type==="formatted"?r=ys.fromString(r.toString()):e.type==="resolvedImage"?r=Ps.build(r.toString()):nn(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),cu(r,s.default,e.default)}vs.register(lu,{error:[{kind:"error"},[Qn],(s,[e])=>{throw new Ct(e.evaluate(s))}],typeof:[Qn,[qn],(s,[e])=>hr(Ir(e.evaluate(s)))],"to-rgba":[ls(Ut,4),[Bs],(s,[e])=>e.evaluate(s).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[ls(Ut,4),[Bs],(s,[e])=>e.evaluate(s).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Bs,[Ut,Ut,Ut],Lv],rgba:[Bs,[Ut,Ut,Ut,Ut],Lv],hsl:[Bs,[Ut,Ut,Ut],pg],hsla:[Bs,[Ut,Ut,Ut,Ut],pg],has:{type:ri,overloads:[[[Qn],(s,[e])=>mg(e.evaluate(s),s.properties())],[[Qn,ec],(s,[e,r])=>mg(e.evaluate(s),r.evaluate(s))]]},get:{type:qn,overloads:[[[Qn],(s,[e])=>Cf(e.evaluate(s),s.properties())],[[Qn,ec],(s,[e,r])=>Cf(e.evaluate(s),r.evaluate(s))]]},"feature-state":[qn,[Qn],(s,[e])=>Cf(e.evaluate(s),s.featureState||{})],properties:[ec,[],s=>s.properties()],"geometry-type":[Qn,[],s=>s.geometryType()],worldview:[Qn,[],s=>s.globals.worldview||""],id:[qn,[],s=>s.id()],zoom:[Ut,[],s=>s.globals.zoom],pitch:[Ut,[],s=>s.globals.pitch||0],"distance-from-center":[Ut,[],s=>s.distanceFromCenter()],"measure-light":[Ut,[Qn],(s,[e])=>s.measureLight(e.evaluate(s))],"heatmap-density":[Ut,[],s=>s.globals.heatmapDensity||0],"line-progress":[Ut,[],s=>s.globals.lineProgress||0],"raster-value":[Ut,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[Ut,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ut,[],s=>s.globals.skyRadialProgress||0],accumulated:[qn,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Ut,lc(Ut),(s,e)=>{let r=0;for(const l of e)r+=l.evaluate(s);return r}],"*":[Ut,lc(Ut),(s,e)=>{let r=1;for(const l of e)r*=l.evaluate(s);return r}],"-":{type:Ut,overloads:[[[Ut,Ut],(s,[e,r])=>e.evaluate(s)-r.evaluate(s)],[[Ut],(s,[e])=>-e.evaluate(s)]]},"/":[Ut,[Ut,Ut],(s,[e,r])=>e.evaluate(s)/r.evaluate(s)],"%":[Ut,[Ut,Ut],(s,[e,r])=>e.evaluate(s)%r.evaluate(s)],ln2:[Ut,[],()=>Math.LN2],pi:[Ut,[],()=>Math.PI],e:[Ut,[],()=>Math.E],"^":[Ut,[Ut,Ut],(s,[e,r])=>Math.pow(e.evaluate(s),r.evaluate(s))],sqrt:[Ut,[Ut],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[Ut,[Ut],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[Ut,[Ut],(s,[e])=>Math.log(e.evaluate(s))],log2:[Ut,[Ut],(s,[e])=>Math.log2(e.evaluate(s))],sin:[Ut,[Ut],(s,[e])=>Math.sin(e.evaluate(s))],cos:[Ut,[Ut],(s,[e])=>Math.cos(e.evaluate(s))],tan:[Ut,[Ut],(s,[e])=>Math.tan(e.evaluate(s))],asin:[Ut,[Ut],(s,[e])=>Math.asin(e.evaluate(s))],acos:[Ut,[Ut],(s,[e])=>Math.acos(e.evaluate(s))],atan:[Ut,[Ut],(s,[e])=>Math.atan(e.evaluate(s))],min:[Ut,lc(Ut),(s,e)=>Math.min(...e.map(r=>r.evaluate(s)))],max:[Ut,lc(Ut),(s,e)=>Math.max(...e.map(r=>r.evaluate(s)))],abs:[Ut,[Ut],(s,[e])=>Math.abs(e.evaluate(s))],round:[Ut,[Ut],(s,[e])=>{const r=e.evaluate(s);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ut,[Ut],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[Ut,[Ut],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[ri,[Qn,qn],(s,[e,r])=>s.properties()[e.value]===r.value],"filter-id-==":[ri,[qn],(s,[e])=>s.id()===e.value],"filter-type-==":[ri,[Qn],(s,[e])=>s.geometryType()===e.value],"filter-<":[ri,[Qn,qn],(s,[e,r])=>{const l=s.properties()[e.value],u=r.value;return typeof l==typeof u&&l<u}],"filter-id-<":[ri,[qn],(s,[e])=>{const r=s.id(),l=e.value;return typeof r==typeof l&&r<l}],"filter->":[ri,[Qn,qn],(s,[e,r])=>{const l=s.properties()[e.value],u=r.value;return typeof l==typeof u&&l>u}],"filter-id->":[ri,[qn],(s,[e])=>{const r=s.id(),l=e.value;return typeof r==typeof l&&r>l}],"filter-<=":[ri,[Qn,qn],(s,[e,r])=>{const l=s.properties()[e.value],u=r.value;return typeof l==typeof u&&l<=u}],"filter-id-<=":[ri,[qn],(s,[e])=>{const r=s.id(),l=e.value;return typeof r==typeof l&&r<=l}],"filter->=":[ri,[Qn,qn],(s,[e,r])=>{const l=s.properties()[e.value],u=r.value;return typeof l==typeof u&&l>=u}],"filter-id->=":[ri,[qn],(s,[e])=>{const r=s.id(),l=e.value;return typeof r==typeof l&&r>=l}],"filter-has":[ri,[qn],(s,[e])=>e.value in s.properties()],"filter-has-id":[ri,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[ri,[ls(Qn)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[ri,[ls(qn)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[ri,[Qn,ls(qn)],(s,[e,r])=>r.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[ri,[Qn,ls(qn)],(s,[e,r])=>function(l,u,p,m){for(;p<=m;){const v=p+m>>1;if(u[v]===l)return!0;u[v]>l?m=v-1:p=v+1}return!1}(s.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ri,overloads:[[[ri,ri],(s,[e,r])=>e.evaluate(s)&&r.evaluate(s)],[lc(ri),(s,e)=>{for(const r of e)if(!r.evaluate(s))return!1;return!0}]]},any:{type:ri,overloads:[[[ri,ri],(s,[e,r])=>e.evaluate(s)||r.evaluate(s)],[lc(ri),(s,e)=>{for(const r of e)if(r.evaluate(s))return!0;return!1}]]},"!":[ri,[ri],(s,[e])=>!e.evaluate(s)],"is-supported-script":[ri,[Qn],(s,[e])=>{const r=s.globals&&s.globals.isSupportedScript;return!r||r(e.evaluate(s))}],upcase:[Qn,[Qn],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[Qn,[Qn],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[Qn,lc(qn),(s,e)=>e.map(r=>Ms(r.evaluate(s))).join("")],"resolved-locale":[Qn,[nf],(s,[e])=>e.evaluate(s).resolvedLocale()],random:[Ut,[Ut,Ut,qn],(s,e)=>{const[r,l,u]=e.map(m=>m.evaluate(s));if(r>l||r===l)return r;let p;if(typeof u=="string")p=function(m){let v=0;if(m.length===0)return v;for(let b=0;b<m.length;b++)v=(v<<5)-v+m.charCodeAt(b),v|=0;return v}(u);else{if(typeof u!="number")throw new Ct(`Invalid seed input: ${u}`);p=u}return r+fg(p)()*(l-r)}]});class Df{constructor(e,r,l,u,p){this.expression=e,this._warningHistory={},this._evaluator=new ka(l,u,p),this._defaultValue=r?function(m){return m.type==="color"&&(Rf(m.default)||Array.isArray(m.default))?new Jn(0,0,0,0):m.type==="color"?Jn.parse(m.default)||null:m.default===void 0?null:m.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=yf(e)}evaluateWithoutErrorHandling(e,r,l,u,p,m,v,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=l,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,l,u,p,m,v,b,S){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=l||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this._evaluator.iconImageUseTheme=S||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Ct(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${A.message}`)),this._defaultValue}}}function xg(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in lu}function da(s,e,r,l,u){const p=new xf(lu,[],e?function(v){const b={color:Bs,string:Qn,number:Ut,enum:Qn,boolean:ri,formatted:cl,resolvedImage:Eh};return v.type==="array"?ls(b[v.value]||qn,v.length):b[v.type]}(e):void 0,void 0,void 0,r,l,u),m=p.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?cc(new Df(m,e,r,l,u)):ml(p.errors)}class jh{constructor(e,r,l,u){this.kind=e,this._styleExpression=r,this.isLightConstant=l,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!_f(r.expression),this.configDependencies=yf(r.expression)}evaluateWithoutErrorHandling(e,r,l,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,u,p,m)}evaluate(e,r,l,u,p,m,v){return this._styleExpression.evaluate(e,r,l,u,p,m,void 0,void 0,v)}}class _l{constructor(e,r,l,u,p,m){this.kind=e,this.zoomStops=l,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!_f(r.expression),this.isLightConstant=p,this.isLineProgressConstant=m,this.configDependencies=yf(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,l,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,u,p,m)}evaluate(e,r,l,u,p,m){return this._styleExpression.evaluate(e,r,l,u,p,m)}interpolationFactor(e,r,l){return this.interpolationType?ho.interpolationFactor(this.interpolationType,e,r,l):0}}function wg(s,e,r,l,u){if((s=da(s,e,r,l,u)).result==="error")return s;const p=s.value.expression,m=ru(p);if(!m&&!Pf(e))return ml([new jo("","data expressions not supported")]);const v=su(p,["zoom","pitch","distance-from-center"]);if(!v&&!yg(e))return ml([new jo("","zoom expressions not supported")]);const b=su(p,["measure-light"]);if(!b&&!_g(e))return ml([new jo("","measure-light expression not supported")]);const S=su(p,["line-progress"]);if(!S&&!function(M){return gg(M.expression,"line-progress")}(e))return ml([new jo("","line-progress expression not supported")]);const A=e.expression&&e.expression.relaxZoomRestriction,C=zf(p);return C||v||A?C instanceof jo?ml([C]):C instanceof ho&&!Mf(e)?ml([new jo("",'"interpolate" expressions cannot be used with this property')]):cc(C?new _l(m&&S?"camera":"composite",s.value,C.labels,C instanceof ho?C.interpolation:void 0,b,S):new jh(m&&S?"constant":"source",s.value,b,S)):ml([new jo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Lf{constructor(e,r){this._parameters=e,this._specification=r,Object.assign(this,kf(this._parameters,this._specification))}static deserialize(e){return new Lf(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function zf(s){let e=null;if(s instanceof Ef)e=zf(s.result);else if(s instanceof Fh){for(const r of s.args)if(e=zf(r),e)break}else(s instanceof Oh||s instanceof ho)&&s.input instanceof vs&&s.input.name==="zoom"&&(e=s);return e instanceof jo||s.eachChild(r=>{const l=zf(r);l instanceof jo?e=l:e&&l&&e!==l&&(e=new jo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Vh,Of,Ov=function(){if(Of)return Vh;Of=1,Vh=e;var s=3;function e(r,l,u){var p=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var m=new Int32Array(this.arrayBuffer);r=m[0],this.d=(l=m[1])+2*(u=m[2]);for(var v=0;v<this.d*this.d;v++){var b=m[s+v],S=m[s+v+1];p.push(b===S?null:m.subarray(b,S))}var A=m[s+p.length+1];this.keys=m.subarray(m[s+p.length],A),this.bboxes=m.subarray(A),this.insert=this._insertReadonly}else{this.d=l+2*u;for(var C=0;C<this.d*this.d;C++)p.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=r,this.padding=u,this.scale=l/r,this.uid=0;var M=u/l*r;this.min=-M,this.max=r+M}return e.prototype.insert=function(r,l,u,p,m){this._forEachCell(l,u,p,m,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(r,l,u,p,m,v){this.cells[m].push(v)},e.prototype.query=function(r,l,u,p,m){var v=this.min,b=this.max;if(r<=v&&l<=v&&b<=u&&b<=p&&!m)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(r,l,u,p,this._queryCell,S,{},m),S},e.prototype._queryCell=function(r,l,u,p,m,v,b,S){var A=this.cells[m];if(A!==null)for(var C=this.keys,M=this.bboxes,z=0;z<A.length;z++){var O=A[z];if(b[O]===void 0){var $=4*O;(S?S(M[$+0],M[$+1],M[$+2],M[$+3]):r<=M[$+2]&&l<=M[$+3]&&u>=M[$+0]&&p>=M[$+1])?(b[O]=!0,v.push(C[O])):b[O]=!1}}},e.prototype._forEachCell=function(r,l,u,p,m,v,b,S){for(var A=this._convertToCellCoord(r),C=this._convertToCellCoord(l),M=this._convertToCellCoord(u),z=this._convertToCellCoord(p),O=A;O<=M;O++)for(var $=C;$<=z;$++){var W=this.d*$+O;if((!S||S(this._convertFromCellCoord(O),this._convertFromCellCoord($),this._convertFromCellCoord(O+1),this._convertFromCellCoord($+1)))&&m.call(this,r,l,u,p,W,v,b,S))return}},e.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},e.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,l=s+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var m=new Int32Array(l+u+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var v=l,b=0;b<r.length;b++){var S=r[b];m[s+b]=v,m.set(S,v),v+=S.length}return m[s+r.length]=v,m.set(this.keys,v),m[s+r.length+1]=v+=this.keys.length,m.set(this.bboxes,v),v+=this.bboxes.length,m.buffer},Vh}(),uc=rl(Ov);const uu={};function Pt(s,e,r={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writable:!1}),uu[e]={klass:s,omit:r.omit||[]}}Pt(Object,"Object"),uc.serialize=function(s,e){const r=s.toArrayBuffer();return e&&e.add(r),{buffer:r}},uc.deserialize=function(s){return new uc(s.buffer)},Object.defineProperty(uc,"name",{value:"Grid"}),Pt(uc,"Grid"),delete ct.prototype.constructor,typeof DOMMatrix<"u"&&Pt(DOMMatrix,"DOMMatrix"),Pt(Jn,"Color"),Pt(Error,"Error"),Pt(ys,"Formatted"),Pt(rf,"FormattedSection"),Pt(Nm,"AJAXError"),Pt(Ps,"ResolvedImage"),Pt(Lf,"StylePropertyFunction"),Pt(Df,"StyleExpression",{omit:["_evaluator"]}),Pt(lo,"ImageId"),Pt(Vo,"ImageVariant"),Pt(_l,"ZoomDependentExpression"),Pt(jh,"ZoomConstantExpression"),Pt(vs,"CompoundExpression",{omit:["_evaluate"]});for(const s in lu)uu[lu[s]._classRegistryKey]||Pt(lu[s],`Expression${s}`);function bg(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Da(s){return self.ImageBitmap&&s instanceof ImageBitmap}function yl(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(bg(s)||Da(s))return e&&e.add(s),s;if(ArrayBuffer.isView(s))return e&&e.add(s.buffer),s;if(s instanceof ImageData)return e&&e.add(s.data.buffer),s;if(Array.isArray(s)){const r=[];for(const l of s)r.push(yl(l,e));return r}if(s instanceof Map){const r={$name:"Map",entries:[]};for(const[l,u]of s.entries())r.entries.push(yl(l),yl(u,e));return r}if(s instanceof Set){const r={$name:"Set"};let l=0;for(const u of s.values())r[++l]=yl(u);return r}if(s instanceof DOMMatrix){const r={$name:"DOMMatrix"},l=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const u of l)r[u]=s[u];return r}if(typeof s=="bigint")return{$name:"BigInt",value:s.toString()};if(typeof s=="object"){const r=s.constructor,l=r._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${r.name}".`);const u=r.serialize?r.serialize(s,e):{};if(!r.serialize){for(const p in s)s.hasOwnProperty(p)&&(uu[l].omit.indexOf(p)>=0||(u[p]=yl(s[p],e)));s instanceof Error&&(u.message=s.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof s)}function vl(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||bg(s)||Da(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(vl);if(typeof s=="object"){const e=s.$name||"Object";if(e==="Map"){const u=s.entries||[],p=new Map;for(let m=0;m<u.length;m+=2)p.set(vl(u[m]),vl(u[m+1]));return p}if(e==="Set"){const u=new Set;for(const p of Object.keys(s))p!=="$name"&&u.add(vl(s[p]));return u}if(e==="DOMMatrix"){let u;return u=s.is2D?[s.a,s.b,s.c,s.d,s.e,s.f]:[s.m11,s.m12,s.m13,s.m14,s.m21,s.m22,s.m23,s.m24,s.m31,s.m32,s.m33,s.m34,s.m41,s.m42,s.m43,s.m44],new DOMMatrix(u)}if(e==="BigInt")return BigInt(s.value);const{klass:r}=uu[e];if(!r)throw new Error(`Can't deserialize unregistered class "${e}".`);if(r.deserialize)return r.deserialize(s);const l=Object.create(r.prototype);for(const u of Object.keys(s))u!=="$name"&&(l[u]=vl(s[u]));return l}throw new Error("can't deserialize object of type "+typeof s)}const Xt={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519,Osage:s=>s>=66736&&s<=66815,"CJK Unified Ideographs Extension B":s=>s>=131072&&s<=173791};function Tg(s){for(const e of s)if(Nf(e.charCodeAt(0)))return!0;return!1}function Fv(s){for(const e of s)if(!Ff(e.charCodeAt(0)))return!1;return!0}function Ff(s){return!(Xt.Arabic(s)||Xt["Arabic Supplement"](s)||Xt["Arabic Extended-A"](s)||Xt["Arabic Presentation Forms-A"](s)||Xt["Arabic Presentation Forms-B"](s))}function Nf(s){return!(s!==746&&s!==747&&(s<4352||!(Xt["Bopomofo Extended"](s)||Xt.Bopomofo(s)||Xt["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Xt["CJK Compatibility Ideographs"](s)||Xt["CJK Compatibility"](s)||Xt["CJK Radicals Supplement"](s)||Xt["CJK Strokes"](s)||!(!Xt["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Xt["CJK Unified Ideographs Extension A"](s)||Xt["CJK Unified Ideographs"](s)||Xt["Enclosed CJK Letters and Months"](s)||Xt["Hangul Compatibility Jamo"](s)||Xt["Hangul Jamo Extended-A"](s)||Xt["Hangul Jamo Extended-B"](s)||Xt["Hangul Jamo"](s)||Xt["Hangul Syllables"](s)||Xt.Hiragana(s)||Xt["Ideographic Description Characters"](s)||Xt.Kanbun(s)||Xt["Kangxi Radicals"](s)||Xt["Katakana Phonetic Extensions"](s)||Xt.Katakana(s)&&s!==12540||!(!Xt["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Xt["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Xt["Unified Canadian Aboriginal Syllabics"](s)||Xt["Unified Canadian Aboriginal Syllabics Extended"](s)||Xt["Vertical Forms"](s)||Xt["Yijing Hexagram Symbols"](s)||Xt["Yi Syllables"](s)||Xt["Yi Radicals"](s))))}function Bf(s){return!(Nf(s)||function(e){return!!(Xt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Xt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Xt["Letterlike Symbols"](e)||Xt["Number Forms"](e)||Xt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Xt["Control Pictures"](e)&&e!==9251||Xt["Optical Character Recognition"](e)||Xt["Enclosed Alphanumerics"](e)||Xt["Geometric Shapes"](e)||Xt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Xt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Xt["CJK Symbols and Punctuation"](e)||Xt.Katakana(e)||Xt["Private Use Area"](e)||Xt["CJK Compatibility Forms"](e)||Xt["Small Form Variants"](e)||Xt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function jw(s){return Xt.Arabic(s)||Xt["Arabic Supplement"](s)||Xt["Arabic Extended-A"](s)||Xt["Arabic Presentation Forms-A"](s)||Xt["Arabic Presentation Forms-B"](s)}function Nv(s){return s>=1424&&s<=2303||Xt["Arabic Presentation Forms-A"](s)||Xt["Arabic Presentation Forms-B"](s)}function Vw(s,e){return!(!e&&Nv(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Xt.Khmer(s))}function Uw(s){for(const e of s)if(Nv(e.charCodeAt(0)))return!0;return!1}const js={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Sg=null,xs=js.unavailable,xl=null;const Bv=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(xs=js.error),Sg&&Sg(s)};function Eg(){Ig.fire(new Bo("pluginStateChange",{pluginStatus:xs,pluginURL:xl}))}const Ig=new Ql,jf=function(){return xs},hc=function(){if(xs!==js.deferred||!xl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");xs=js.loading,Eg(),xl&&Wc({url:xl},s=>{s?Bv(s):(xs=js.loaded,Eg())})},fa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>xs===js.loaded||fa.applyArabicShaping!=null,isLoading:()=>xs===js.loading,setState(s){xs=s.pluginStatus,xl=s.pluginURL},isParsing:()=>xs===js.parsing,isParsed:()=>xs===js.parsed,getPluginURL:()=>xl};class _i{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness,this.worldview=r.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,l){for(const u of r)if(!Vw(u.charCodeAt(0),l))return!1;return!0}(e,fa.isLoaded())}}class dc{constructor(e,r,l,u,p){this.property=e,this.value=r,this.expression=function(m,v,b,S,A){if(Rf(m))return new Lf(m,v);if(xg(m)||Array.isArray(m)&&m.length>0){const C=wg(m,v,b,S,A);if(C.result==="error")throw new Error(C.value.map(M=>`${M.key}: ${M.message}`).join(", "));return C.value}{let C=m;return typeof m=="string"&&v.type==="color"&&(C=Jn.parse(m)),{kind:"constant",configDependencies:new Set,evaluate:()=>C}}}(r===void 0?e.specification.default:r,e.specification,l,u,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,l,u){return this.property.possiblyEvaluate(this,e,r,l,u)}}class Ag{constructor(e,r,l,u){this.property=e,this.value=new dc(e,void 0,r,l,u)}transitioned(e,r){return new La(this.property,this.value,r,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new La(this.property,this.value,null,{},0)}}class jv{constructor(e,r,l,u){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=l,this._iconImageUseTheme=u,this.configDependencies=new Set}getValue(e){return Mn(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Ag(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new dc(this._values[e].property,r===null?void 0:Mn(r),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,r){r&&(this._options=r);const l=this._properties.properties;if(e)for(const u in e){const p=e[u];if(u.endsWith("-transition")){const m=u.slice(0,-11);l[m]&&this.setTransition(m,p)}else l.hasOwnProperty(u)&&this.setValue(u,p)}}getTransition(e){return Mn(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Ag(this._values[e].property)),this._values[e].transition=Mn(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const l=new Cg(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].transitioned(e,r._values[u]);return l}untransitioned(){const e=new Cg(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class La{constructor(e,r,l,u,p){const m=u.delay||0,v=u.duration||0;p=p||0,this.property=e,this.value=r,this.begin=p+m,this.end=this.begin+v,e.specification.transition&&(u.delay||u.duration)&&(this.prior=l)}possiblyEvaluate(e,r,l){const u=e.now||0,p=this.value.possiblyEvaluate(e,r,l),m=this.prior;if(m){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return m.possiblyEvaluate(e,r,l);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,l),p,pe(v))}}return p}}class Cg{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,l){const u=new mc(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,r,l);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class fc{constructor(e,r,l,u){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=l,this._iconImageUseTheme=u,this.configDependencies=new Set}getValue(e){return Mn(this._values[e].value)}setValue(e,r){this._values[e]=new dc(this._values[e].property,r===null?void 0:Mn(r),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l)}return e}possiblyEvaluate(e,r,l,u){const p=new mc(this._properties);for(const m of Object.keys(this._values))p._values[m]=this._values[m].possiblyEvaluate(e,r,l,u);return p}}class pc{constructor(e,r,l,u){this.property=e,this.value=r,this.parameters=l,this.iconImageUseTheme=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,l,u){return this.property.evaluate(this.value,this.parameters,e,r,l,u,this.iconImageUseTheme)}}class mc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class pt{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,l){const u=co[this.specification.type];return u?u(e,r,l):e}}class Et{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,l,u,p){return e.expression.kind==="constant"||e.expression.kind==="camera"?new pc(this,{kind:"constant",value:e.expression.evaluate(r,null,{},l,u,void 0,p)},r):new pc(this,e.expression,r,p)}interpolate(e,r,l){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new pc(this,{kind:"constant",value:void 0},e.parameters);const u=co[this.specification.type];return u?new pc(this,{kind:"constant",value:u(e.value.value,r.value.value,l)},e.parameters):e}evaluate(e,r,l,u,p,m,v){return e.kind==="constant"?e.value:e.evaluate(r,l,u,p,m,void 0,v)}}class hu{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,u){return!!e.expression.evaluate(r,null,{},l,u)}interpolate(){return!1}}class Vi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new _i(0,{});for(const l in e){const u=e[l];u.specification.overridable&&this.overridableProperties.push(l);const p=this.defaultPropertyValues[l]=new dc(u,void 0),m=this.defaultTransitionablePropertyValues[l]=new Ag(u);this.defaultTransitioningPropertyValues[l]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=p.possiblyEvaluate(r)}}}Pt(Et,"DataDrivenProperty"),Pt(pt,"DataConstantProperty"),Pt(hu,"ColorRampProperty");var Le=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Vf(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function gc(s){if(Array.isArray(s))return s.map(gc);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const r in s)e[r]=gc(s[r]);return e}return Vf(s)}function Uf(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!Uf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Uh(s,e="",r=null,l="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Uf(s)||(s=Gf(s));const u=s;let p=!0;try{p=function(A){if(!du(A))return A;let C=gc(A);return Go(C),C=Vv(C),C}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let m=null,v=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){v=Le[`filter_${l}`];const A=da(p,v,e,r);if(A.result==="error")throw new Error(A.value.map(C=>`${C.key}: ${C.message}`).join(", "));m=(C,M,z)=>A.value.evaluate(C,M,{},z)}let b=null,S=null;if(p!==u){const A=da(u,v,e,r);if(A.result==="error")throw new Error(A.value.map(C=>`${C.key}: ${C.message}`).join(", "));b=(C,M,z,O,$)=>A.value.evaluate(C,M,{},z,void 0,void 0,O,$),S=!ru(A.value.expression)}return{filter:m,dynamicFilter:b||void 0,needGeometry:Gv(p),needFeature:!!S}}function Vv(s){if(!Array.isArray(s))return s;const e=function(r){if(Uv.has(r[0])){for(let l=1;l<r.length;l++)if(du(r[l]))return!0}return r}(s);return e===!0?e:e.map(r=>Vv(r))}function Go(s){let e=!1;const r=[];if(s[0]==="case"){for(let l=1;l<s.length-1;l+=2)e=e||du(s[l]),r.push(s[l+1]);r.push(s[s.length-1])}else if(s[0]==="match"){e=e||du(s[1]);for(let l=2;l<s.length-1;l+=2)r.push(s[l+1]);r.push(s[s.length-1])}else if(s[0]==="step"){e=e||du(s[1]);for(let l=1;l<s.length-1;l+=2)r.push(s[l+1])}e&&(s.length=0,s.push("any",...r));for(let l=1;l<s.length;l++)Go(s[l])}function du(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<s.length;r++)if(du(s[r]))return!0;return!1}const Uv=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Gw(s,e){return s<e?-1:s>e?1:0}function Gv(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let e=1;e<s.length;e++)if(Gv(s[e]))return!0;return!1}function Gf(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?Pg(s[1],s[2],"=="):e==="!="?$f(Pg(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Pg(s[1],s[2],e):e==="any"?(r=s.slice(1),["any"].concat(r.map(Gf))):e==="all"?["all"].concat(s.slice(1).map(Gf)):e==="none"?["all"].concat(s.slice(1).map(Gf).map($f)):e==="in"?$v(s[1],s.slice(2)):e==="!in"?$f($v(s[1],s.slice(2))):e==="has"?Hv(s[1]):e!=="!has"||$f(Hv(s[1]));var r}function Pg(s,e,r){switch(s){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,s,e]}}function $v(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",s,["literal",e.sort(Gw)]]:["filter-in-small",s,["literal",e]]}}function Hv(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function $f(s){return["!",s]}const Gh="";function fu(s,e){return e?`${s}${Gh}${e}`:s}let Mg;const Wv=()=>Mg||(Mg=new Vi({"icon-size":new Et(Le.layout_symbol["icon-size"]),"icon-image":new Et(Le.layout_symbol["icon-image"]),"icon-rotate":new Et(Le.layout_symbol["icon-rotate"]),"icon-offset":new Et(Le.layout_symbol["icon-offset"])}));class $w{constructor(e,r,l,u,p,m){const v=da(e,Le.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=r,l){this.properties=new mc(Wv()),this.unevaluatedLayout=new fc(Wv(),u,p,m);for(const b in l)this.unevaluatedLayout.setValue(b,l[b])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.properties&&(e.properties=this.properties),e}}const qv="-transition",Zv=new Set(["fill","line","background","hillshade","raster"]);class cs extends Ql{constructor(e,r,l,u,p,m){if(super(),this.id=e.id,this.fqid=fu(this.id,l),this.type=e.type,this.scope=l,this.lut=u,this.options=p,this.iconImageUseTheme=m,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const v=da(this.filter,Le[`filter_${e.type}`]);v.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...v.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),e.appearances&&e.appearances.forEach(v=>{this.appearances.push(new $w(v.condition,v.name,v.properties,this.scope,p,this.iconImageUseTheme))}),r.layout&&(this._unevaluatedLayout=new fc(r.layout,this.scope,p,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),r.paint){this._transitionablePaint=new jv(r.paint,this.scope,p);for(const v in e.paint)this.setPaintProperty(v,e.paint[v]);for(const v in e.layout)this.setLayoutProperty(v,e.layout[v]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mc(r.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Zv.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(qv)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){const l=this._transitionablePaint,u=l._properties.properties;if(e.endsWith(qv)){const C=e.slice(0,-11);return u[C]&&l.setTransition(C,r||void 0),!1}if(!u[e])return!1;const p=l._values[e],m=p.value.isDataDriven(),v=p.value;l.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const b=l._values[e].value,S=b.isDataDriven(),A=e.endsWith("pattern")||e==="line-dasharray";return S||m||A||this._handleOverridablePaintPropertyUpdate(e,v,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,l){return null}_handleOverridablePaintPropertyUpdate(e,r,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(r=>r.serialize())),kn(e,(r,l)=>!(r===void 0||l==="layout"&&!Object.keys(r).length||l==="paint"&&!Object.keys(r).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof pc&&Pf(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Uh(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(e){}queryIntersectsFeature(e,r,l,u,p,m,v,b,S){}}const wl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class pu{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Si{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&r.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function zn(s,e=1){let r=0,l=0;return{members:s.map(u=>{const p=wl[u.type].BYTES_PER_ELEMENT,m=r=Xv(r,Math.max(e,p)),v=u.components||1;return l=Math.max(l,p),r+=p*v,{name:u.name,type:u.type,components:v,offset:m}}),size:Xv(r,Math.max(l,e)),alignment:e}}function Xv(s,e){return Math.ceil(s/e)*e}class bl extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=l,e}}bl.prototype.bytesPerElement=4,Pt(bl,"StructArrayLayout2i4");class _c extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const p=3*e;return this.int16[p+0]=r,this.int16[p+1]=l,this.int16[p+2]=u,e}}_c.prototype.bytesPerElement=6,Pt(_c,"StructArrayLayout3i6");class yc extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,l,u)}emplace(e,r,l,u,p){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=l,this.int16[m+2]=u,this.int16[m+3]=p,e}}yc.prototype.bytesPerElement=8,Pt(yc,"StructArrayLayout4i8");class Tl extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Tl.prototype.bytesPerElement=4,Pt(Tl,"StructArrayLayout1f4");class Rg extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const p=4*e,m=2*e;return this.int16[p+0]=r,this.int16[p+1]=l,this.float32[m+1]=u,e}}Rg.prototype.bytesPerElement=8,Pt(Rg,"StructArrayLayout2i1f8");class Hf extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=l,this.int16[p+2]=u,e}}Hf.prototype.bytesPerElement=8,Pt(Hf,"StructArrayLayout3i8");class kg extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,u,p)}emplace(e,r,l,u,p,m){const v=5*e;return this.int16[v+0]=r,this.int16[v+1]=l,this.int16[v+2]=u,this.int16[v+3]=p,this.int16[v+4]=m,e}}kg.prototype.bytesPerElement=10,Pt(kg,"StructArrayLayout5i10");class Wf extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,l,u,p,m,v)}emplace(e,r,l,u,p,m,v,b){const S=6*e,A=12*e,C=3*e;return this.int16[S+0]=r,this.int16[S+1]=l,this.uint8[A+4]=u,this.uint8[A+5]=p,this.uint8[A+6]=m,this.uint8[A+7]=v,this.float32[C+2]=b,e}}Wf.prototype.bytesPerElement=12,Pt(Wf,"StructArrayLayout2i4ub1f12");class Rs extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const p=3*e;return this.float32[p+0]=r,this.float32[p+1]=l,this.float32[p+2]=u,e}}Rs.prototype.bytesPerElement=12,Pt(Rs,"StructArrayLayout3f12");class Sl extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,u,p)}emplace(e,r,l,u,p,m){const v=6*e,b=3*e;return this.uint16[v+0]=r,this.uint16[v+1]=l,this.uint16[v+2]=u,this.uint16[v+3]=p,this.float32[b+2]=m,e}}Sl.prototype.bytesPerElement=12,Pt(Sl,"StructArrayLayout4ui1f12");class mu extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,l,u)}emplace(e,r,l,u,p){const m=4*e;return this.uint16[m+0]=r,this.uint16[m+1]=l,this.uint16[m+2]=u,this.uint16[m+3]=p,e}}mu.prototype.bytesPerElement=8,Pt(mu,"StructArrayLayout4ui8");class qf extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,u,p,m)}emplace(e,r,l,u,p,m,v){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=l,this.int16[b+2]=u,this.int16[b+3]=p,this.int16[b+4]=m,this.int16[b+5]=v,e}}qf.prototype.bytesPerElement=12,Pt(qf,"StructArrayLayout6i12");class Dg extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m,v,b,S,A,C,M){const z=this.length;return this.resize(z+1),this.emplace(z,e,r,l,u,p,m,v,b,S,A,C,M)}emplace(e,r,l,u,p,m,v,b,S,A,C,M,z){const O=12*e;return this.int16[O+0]=r,this.int16[O+1]=l,this.int16[O+2]=u,this.int16[O+3]=p,this.uint16[O+4]=m,this.uint16[O+5]=v,this.uint16[O+6]=b,this.uint16[O+7]=S,this.int16[O+8]=A,this.int16[O+9]=C,this.int16[O+10]=M,this.int16[O+11]=z,e}}Dg.prototype.bytesPerElement=24,Pt(Dg,"StructArrayLayout4i4ui4i24");class Lg extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,u,p,m)}emplace(e,r,l,u,p,m,v){const b=10*e,S=5*e;return this.int16[b+0]=r,this.int16[b+1]=l,this.int16[b+2]=u,this.float32[S+2]=p,this.float32[S+3]=m,this.float32[S+4]=v,e}}Lg.prototype.bytesPerElement=20,Pt(Lg,"StructArrayLayout3i3f20");class $o extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,l,u)}emplace(e,r,l,u,p){const m=4*e;return this.float32[m+0]=r,this.float32[m+1]=l,this.float32[m+2]=u,this.float32[m+3]=p,e}}$o.prototype.bytesPerElement=16,Pt($o,"StructArrayLayout4f16");class gu extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}gu.prototype.bytesPerElement=4,Pt(gu,"StructArrayLayout1ul4");class dr extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=l,e}}dr.prototype.bytesPerElement=4,Pt(dr,"StructArrayLayout2ui4");class _u extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m,v,b,S,A,C,M,z){const O=this.length;return this.resize(O+1),this.emplace(O,e,r,l,u,p,m,v,b,S,A,C,M,z)}emplace(e,r,l,u,p,m,v,b,S,A,C,M,z,O){const $=20*e,W=10*e;return this.int16[$+0]=r,this.int16[$+1]=l,this.int16[$+2]=u,this.int16[$+3]=p,this.int16[$+4]=m,this.float32[W+3]=v,this.float32[W+4]=b,this.float32[W+5]=S,this.float32[W+6]=A,this.int16[$+14]=C,this.uint32[W+8]=M,this.uint16[$+18]=z,this.uint16[$+19]=O,e}}_u.prototype.bytesPerElement=40,Pt(_u,"StructArrayLayout5i4f1i1ul2ui40");class Zf extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,l,u,p,m,v)}emplace(e,r,l,u,p,m,v,b){const S=8*e;return this.int16[S+0]=r,this.int16[S+1]=l,this.int16[S+2]=u,this.int16[S+4]=p,this.int16[S+5]=m,this.int16[S+6]=v,this.int16[S+7]=b,e}}Zf.prototype.bytesPerElement=16,Pt(Zf,"StructArrayLayout3i2i2i16");class zg extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,u,p)}emplace(e,r,l,u,p,m){const v=4*e,b=8*e;return this.float32[v+0]=r,this.float32[v+1]=l,this.float32[v+2]=u,this.int16[b+6]=p,this.int16[b+7]=m,e}}zg.prototype.bytesPerElement=16,Pt(zg,"StructArrayLayout2f1f2i16");class Og extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,u,p,m)}emplace(e,r,l,u,p,m,v){const b=20*e,S=5*e;return this.uint8[b+0]=r,this.uint8[b+1]=l,this.float32[S+1]=u,this.float32[S+2]=p,this.float32[S+3]=m,this.float32[S+4]=v,e}}Og.prototype.bytesPerElement=20,Pt(Og,"StructArrayLayout2ub4f20");class xr extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,l)}emplace(e,r,l,u){const p=3*e;return this.uint16[p+0]=r,this.uint16[p+1]=l,this.uint16[p+2]=u,e}}xr.prototype.bytesPerElement=6,Pt(xr,"StructArrayLayout3ui6");class $h extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m,v,b,S,A,C,M,z,O,$,W,q,ie,re,le,we){const be=this.length;return this.resize(be+1),this.emplace(be,e,r,l,u,p,m,v,b,S,A,C,M,z,O,$,W,q,ie,re,le,we)}emplace(e,r,l,u,p,m,v,b,S,A,C,M,z,O,$,W,q,ie,re,le,we,be){const Ie=30*e,Pe=15*e,Me=60*e;return this.int16[Ie+0]=r,this.int16[Ie+1]=l,this.int16[Ie+2]=u,this.float32[Pe+2]=p,this.float32[Pe+3]=m,this.uint16[Ie+8]=v,this.uint16[Ie+9]=b,this.uint32[Pe+5]=S,this.uint32[Pe+6]=A,this.uint32[Pe+7]=C,this.uint16[Ie+16]=M,this.uint16[Ie+17]=z,this.uint16[Ie+18]=O,this.float32[Pe+10]=$,this.float32[Pe+11]=W,this.uint8[Me+48]=q,this.uint8[Me+49]=ie,this.uint8[Me+50]=re,this.uint32[Pe+13]=le,this.int16[Ie+28]=we,this.uint8[Me+58]=be,e}}$h.prototype.bytesPerElement=60,Pt($h,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Fg extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m,v,b,S,A,C,M,z,O,$,W,q,ie,re,le,we,be,Ie,Pe,Me,Ye,ze,Qe,lt,tt,rt,dt,Xe){const ot=this.length;return this.resize(ot+1),this.emplace(ot,e,r,l,u,p,m,v,b,S,A,C,M,z,O,$,W,q,ie,re,le,we,be,Ie,Pe,Me,Ye,ze,Qe,lt,tt,rt,dt,Xe)}emplace(e,r,l,u,p,m,v,b,S,A,C,M,z,O,$,W,q,ie,re,le,we,be,Ie,Pe,Me,Ye,ze,Qe,lt,tt,rt,dt,Xe,ot){const Ge=20*e,je=40*e,ft=80*e;return this.float32[Ge+0]=r,this.float32[Ge+1]=l,this.int16[je+4]=u,this.int16[je+5]=p,this.int16[je+6]=m,this.int16[je+7]=v,this.int16[je+8]=b,this.int16[je+9]=S,this.int16[je+10]=A,this.int16[je+11]=C,this.int16[je+12]=M,this.uint16[je+13]=z,this.uint16[je+14]=O,this.uint16[je+15]=$,this.uint16[je+16]=W,this.uint16[je+17]=q,this.uint16[je+18]=ie,this.uint16[je+19]=re,this.uint16[je+20]=le,this.uint16[je+21]=we,this.uint16[je+22]=be,this.uint16[je+23]=Ie,this.uint16[je+24]=Pe,this.uint16[je+25]=Me,this.uint16[je+26]=Ye,this.uint16[je+27]=ze,this.uint32[Ge+14]=Qe,this.float32[Ge+15]=lt,this.float32[Ge+16]=tt,this.float32[Ge+17]=rt,this.float32[Ge+18]=dt,this.uint8[ft+76]=Xe,this.uint16[je+39]=ot,e}}Fg.prototype.bytesPerElement=80,Pt(Fg,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Hh extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,u,p,m)}emplace(e,r,l,u,p,m,v){const b=6*e;return this.float32[b+0]=r,this.float32[b+1]=l,this.float32[b+2]=u,this.float32[b+3]=p,this.float32[b+4]=m,this.float32[b+5]=v,e}}Hh.prototype.bytesPerElement=24,Pt(Hh,"StructArrayLayout6f24");class vc extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,u,p)}emplace(e,r,l,u,p,m){const v=5*e;return this.float32[v+0]=r,this.float32[v+1]=l,this.float32[v+2]=u,this.float32[v+3]=p,this.float32[v+4]=m,e}}vc.prototype.bytesPerElement=20,Pt(vc,"StructArrayLayout5f20");class Ng extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,l,u,p,m,v)}emplace(e,r,l,u,p,m,v,b){const S=7*e;return this.float32[S+0]=r,this.float32[S+1]=l,this.float32[S+2]=u,this.float32[S+3]=p,this.float32[S+4]=m,this.float32[S+5]=v,this.float32[S+6]=b,e}}Ng.prototype.bytesPerElement=28,Pt(Ng,"StructArrayLayout7f28");class Xf extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m,v,b,S,A,C){const M=this.length;return this.resize(M+1),this.emplace(M,e,r,l,u,p,m,v,b,S,A,C)}emplace(e,r,l,u,p,m,v,b,S,A,C,M){const z=11*e;return this.float32[z+0]=r,this.float32[z+1]=l,this.float32[z+2]=u,this.float32[z+3]=p,this.float32[z+4]=m,this.float32[z+5]=v,this.float32[z+6]=b,this.float32[z+7]=S,this.float32[z+8]=A,this.float32[z+9]=C,this.float32[z+10]=M,e}}Xf.prototype.bytesPerElement=44,Pt(Xf,"StructArrayLayout11f44");class Wh extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m,v,b,S){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,l,u,p,m,v,b,S)}emplace(e,r,l,u,p,m,v,b,S,A){const C=9*e;return this.float32[C+0]=r,this.float32[C+1]=l,this.float32[C+2]=u,this.float32[C+3]=p,this.float32[C+4]=m,this.float32[C+5]=v,this.float32[C+6]=b,this.float32[C+7]=S,this.float32[C+8]=A,e}}Wh.prototype.bytesPerElement=36,Pt(Wh,"StructArrayLayout9f36");class yu extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=l,e}}yu.prototype.bytesPerElement=8,Pt(yu,"StructArrayLayout2f8");class Kf extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,l,u)}emplace(e,r,l,u,p){const m=6*e;return this.uint32[3*e+0]=r,this.uint16[m+2]=l,this.uint16[m+3]=u,this.uint16[m+4]=p,e}}Kf.prototype.bytesPerElement=12,Pt(Kf,"StructArrayLayout1ul3ui12");class Yf extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Yf.prototype.bytesPerElement=2,Pt(Yf,"StructArrayLayout1ui2");class Bg extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m,v,b,S,A,C,M,z,O,$,W){const q=this.length;return this.resize(q+1),this.emplace(q,e,r,l,u,p,m,v,b,S,A,C,M,z,O,$,W)}emplace(e,r,l,u,p,m,v,b,S,A,C,M,z,O,$,W,q){const ie=16*e;return this.float32[ie+0]=r,this.float32[ie+1]=l,this.float32[ie+2]=u,this.float32[ie+3]=p,this.float32[ie+4]=m,this.float32[ie+5]=v,this.float32[ie+6]=b,this.float32[ie+7]=S,this.float32[ie+8]=A,this.float32[ie+9]=C,this.float32[ie+10]=M,this.float32[ie+11]=z,this.float32[ie+12]=O,this.float32[ie+13]=$,this.float32[ie+14]=W,this.float32[ie+15]=q,e}}Bg.prototype.bytesPerElement=64,Pt(Bg,"StructArrayLayout16f64");class vu extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,u,p,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,l,u,p,m,v)}emplace(e,r,l,u,p,m,v,b){const S=10*e,A=5*e;return this.uint16[S+0]=r,this.uint16[S+1]=l,this.uint16[S+2]=u,this.uint16[S+3]=p,this.float32[A+2]=m,this.float32[A+3]=v,this.float32[A+4]=b,e}}vu.prototype.bytesPerElement=20,Pt(vu,"StructArrayLayout4ui3f20");class xu extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}xu.prototype.bytesPerElement=2,Pt(xu,"StructArrayLayout1i2");class Jf extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}Jf.prototype.bytesPerElement=1,Pt(Jf,"StructArrayLayout1ub1");class Kv extends pu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Kv.prototype.size=40;class jg extends _u{get(e){return new Kv(this,e)}}Pt(jg,"CollisionBoxArray");class Yv extends pu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Yv.prototype.size=60;class Qf extends $h{get(e){return new Yv(this,e)}}Pt(Qf,"PlacedSymbolArray");class Jv extends pu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Jv.prototype.size=80;class Qv extends Fg{get(e){return new Jv(this,e)}}Pt(Qv,"SymbolInstanceArray");class ex extends Tl{getoffsetX(e){return this.float32[1*e+0]}}Pt(ex,"GlyphOffsetArray");class tx extends bl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Pt(tx,"SymbolLineVertexArray");class Vg extends pu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Vg.prototype.size=12;class nx extends Kf{get(e){return new Vg(this,e)}}Pt(nx,"FeatureIndexArray");class ix extends dr{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Pt(ix,"FillExtrusionCentroidArray");class rx extends pu{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}rx.prototype.size=6;class sx extends _c{get(e){return new rx(this,e)}}Pt(sx,"FillExtrusionWallArray");const Hw=zn([{name:"a_pos",components:2,type:"Int16"}],4),Ww=zn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),qw=zn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Oi{constructor(e=[]){this.segments=e}_prepareSegment(e,r,l,u){let p=this.segments[this.segments.length-1];return e>Oi.MAX_VERTEX_ARRAY_LENGTH&&Dn(`Max vertices per segment is ${Oi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Oi.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:r,primitiveOffset:l,vertexLength:0,primitiveLength:0},u!==void 0&&(p.sortKey=u),this.segments.push(p)),p}prepareSegment(e,r,l,u){return this._prepareSegment(e,r.length,l.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,l,u){return new Oi([{vertexOffset:e,primitiveOffset:r,vertexLength:l,primitiveLength:u,vaos:{},sortKey:0}])}}function qh(s,e){return 256*(s=Se(Math.floor(s),0,255))+Se(Math.floor(e),0,255)}Oi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pt(Oi,"SegmentVector");const Zw=zn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Xw=zn([{name:"a_pattern_b",components:4,type:"Uint16"}]),ep=zn([{name:"a_dash",components:4,type:"Uint16"}]);class Zh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,l,u){this.ids.push(Ug(e)),this.positions.push(r,l,u)}eachPosition(e,r){const l=Ug(e);let u=0,p=this.ids.length-1;for(;u<p;){const m=u+p>>1;this.ids[m]>=l?p=m:u=m+1}for(;this.ids[u]===l;)r(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,r){const l=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Gg(l,u,0,l.length-1),r&&(r.add(l.buffer),r.add(u.buffer)),{ids:l,positions:u}}static deserialize(e){const r=new Zh;let l;r.ids=e.ids,r.positions=e.positions;for(const u of r.ids)u!==l&&r.uniqueIds.push(u),l=u;return r.indexed=!0,r}}function Ug(s){const e=+s;return Number.isSafeInteger(e)?e:Yd(String(s))}function Gg(s,e,r,l){for(;r<l;){const u=s[r+l>>1];let p=r-1,m=l+1;for(;;){do p++;while(s[p]<u);do m--;while(s[m]>u);if(p>=m)break;Xh(s,p,m),Xh(e,3*p,3*m),Xh(e,3*p+1,3*m+1),Xh(e,3*p+2,3*m+2)}m-r<l-m?(Gg(s,e,r,m),r=m+1):(Gg(s,e,m+1,l),l=m)}}function Xh(s,e,r){const l=s[e];s[e]=s[r],s[r]=l}Pt(Zh,"FeaturePositionMap");class pa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Kh extends pa{constructor(e){super(e),this.current=0}set(e,r,l){this.fetchUniformLocation(e,r)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class Yi extends pa{constructor(e){super(e),this.current=0}set(e,r,l){this.fetchUniformLocation(e,r)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class ma extends pa{constructor(e){super(e),this.current=[0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class Yh extends pa{constructor(e){super(e),this.current=[0,0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class Jh extends pa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class ox extends pa{constructor(e){super(e),this.current=Jn.transparent.toPremultipliedRenderColor(null)}set(e,r,l){this.fetchUniformLocation(e,r)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const Kw=new Float32Array(16);class Qh extends pa{constructor(e){super(e),this.current=Kw}set(e,r,l){if(this.fetchUniformLocation(e,r)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const Yw=new Float32Array(9),Jw=new Float32Array(4);class tp extends pa{constructor(e){super(e),this.current=Jw}set(e,r,l){if(this.fetchUniformLocation(e,r)){for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function ed(s){return[qh(255*s.r,255*s.g),qh(255*s.b,255*s.a)]}class fo{constructor(e,r,l,u){this.value=e,this.uniformNames=r.map(p=>`u_${p}`),this.type=l,this.context=u}setUniform(e,r,l,u,p){const m=u.constantOr(this.value);r.set(e,p,m instanceof Jn?m.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):m)}getBinding(e,r){return this.type==="color"?new ox(e):new Yi(e)}}class xc{constructor(e,r){this.uniformNames=r.map(l=>`u_${l}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,r){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=r?r.tl.concat(r.br):this.pattern}setUniform(e,r,l,u,p){let m=null;p!=="u_pattern"&&p!=="u_dash"||(m=this.pattern),p==="u_pattern_b"&&(m=this.patternTransition),p==="u_pixel_ratio"&&(m=this.pixelRatio),m&&r.set(e,p,m)}getBinding(e,r){return r==="u_pattern"||r==="u_pattern_b"||r==="u_dash"?new Jh(e):new Yi(e)}}class El{constructor(e,r,l,u){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,l,u,p,m,v,b){const S=this.paintVertexArray.length,A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new _i(0,{brightness:m,worldview:b}),r,{},p,u,v):this.expression.kind==="constant"&&this.expression.value,C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new _i(0,{brightness:m,worldview:b}),r,{},p,u,v):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(S,e,A,C?null:this.context.lut)}updatePaintArray(e,r,l,u,p,m,v,b){const S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:b},l,u,void 0,p):this.expression.kind==="constant"&&this.expression.value,A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new _i(0,{brightness:v,worldview:b}),l,u,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,r,S,A?null:this.context.lut)}_setPaintValue(e,r,l,u){if(this.type==="color"){const p=ed(l.toPremultipliedRenderColor(u));for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class za{constructor(e,r,l,u,p,m){this.expression=e,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=l,this.useIntegerZoom=u,this.context=p,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,r,l,u,p,m,v,b){const S=this.expression.evaluate(new _i(this.context.zoom,{brightness:m,worldview:b}),r,{},p,u,v),A=this.expression.evaluate(new _i(this.context.zoom+1,{brightness:m,worldview:b}),r,{},p,u,v),C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new _i(0,{brightness:m,worldview:b}),r,{},p,u,v):this.lutExpression.value)==="none",M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,S,A,C?null:this.context.lut)}updatePaintArray(e,r,l,u,p,m,v,b){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:b},l,u,void 0,p),A=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:b},l,u,void 0,p),C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new _i(0,{brightness:v,worldview:b}),l,u,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,r,S,A,C?null:this.context.lut)}_setPaintValue(e,r,l,u,p){if(this.type==="color"){const m=ed(l.toPremultipliedRenderColor(p)),v=ed(l.toPremultipliedRenderColor(p));for(let b=e;b<r;b++)this.paintVertexArray.emplace(b,m[0],m[1],v[0],v[1])}else{for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,l,u);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,l,u,p){const m=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,v=Se(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);r.set(e,p,v)}getBinding(e,r){return new Yi(e)}}class Oa{constructor(e,r,l,u,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(l==="array"?ep:Zw).members;for(let m=0;m<r.length;++m);this.paintVertexArray=new u,this.paintTransitionVertexArray=new mu}populatePaintArray(e,r,l,u){const p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,r.patterns&&r.patterns[this.layerId],l)}updatePaintArray(e,r,l,u,p,m,v){this._setPaintValues(e,r,l.patterns&&l.patterns[this.layerId],m)}_setPaintValues(e,r,l,u){if(!u||!l)return;const p=u[l[0]],m=u[l[1]];if(p){if(p){const{tl:v,br:b,pixelRatio:S}=p;for(let A=e;A<r;A++)this.paintVertexArray.emplace(A,v[0],v[1],b[0],b[1],S)}if(m){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:v,br:b}=m;for(let S=e;S<r;S++)this.paintTransitionVertexArray.emplace(S,v[0],v[1],b[0],b[1])}}}upload(e){const r=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,r)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Xw.members,r))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class wc{constructor(e,r,l=()=>!0){this.binders={},this._buffers=[],this.context=r;const u=[];for(const p in e.paint._values){const m=e.paint.get(p);if(p.endsWith("-use-theme")||!l(p)||!(m instanceof pc&&Pf(m.property.specification)))continue;const v=oA(p,e.type),b=m.value,S=m.property.specification.type,A=!!m.property.useIntegerZoom,C=p==="line-dasharray"||p.endsWith("pattern"),M=e.paint.get(`${p}-use-theme`),z=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||M&&M.value.kind!=="constant";if(b.kind!=="constant"||z)if(b.kind==="source"||z||C){const O=a(p,S,"source");this.binders[p]=C?new Oa(b,v,S,O,e.id):new El(b,v,S,O),u.push(`/a_${p}`)}else{const O=a(p,S,"composite");this.binders[p]=new za(b,v,S,A,r,O),u.push(`/z_${p}`)}else this.binders[p]=C?new xc(b.value,v):new fo(b.value,v,S,r),u.push(`/u_${p}`);M&&(this.binders[p].lutExpression=M.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof El||r instanceof za?r.maxValue:0}populatePaintArrays(e,r,l,u,p,m,v,b){for(const S in this.binders){const A=this.binders[S];A.context=this.context,(A instanceof El||A instanceof za||A instanceof Oa)&&A.populatePaintArray(e,r,l,u,p,m,v,b)}}setConstantPatternPositions(e,r){for(const l in this.binders){const u=this.binders[l];u instanceof xc&&u.setConstantPatternPositions(e,r)}}getPatternTransitionVertexBuffer(e){const r=this.binders[e];return r instanceof Oa?r.paintTransitionVertexBuffer:null}updatePaintArrays(e,r,l,u,p,m,v,b,S,A){let C=!1;const M=Object.keys(e),z=M.length!==0&&!b,O=z?M:r.uniqueIds;this.context.lut=p.lut;for(const $ in this.binders){const W=this.binders[$];if(W.context=this.context,(W instanceof El||W instanceof za||W instanceof Oa)&&W.expression&&W.expression.kind&&W.expression.kind!=="constant"&&(W.expression.isStateDependent===!0||W.expression.isLightConstant===!1)){const q=p.paint.get($);W.expression=q.value;for(const ie of O){const re=e[ie.toString()];r.eachPosition(ie,(le,we,be)=>{const Ie=u.feature(le);W.updatePaintArray(we,be,Ie,re,m,v,S,A)})}if(!z)for(const ie of l.uniqueIds){const re=e[ie.toString()];l.eachPosition(ie,(le,we,be)=>{const Ie=u.feature(le);W.updatePaintArray(we,be,Ie,re,m,v,S,A)})}C=!0}}return C}defines(){const e=[];for(const r in this.binders){const l=this.binders[r];(l instanceof fo||l instanceof xc)&&e.push(...l.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof fo||u instanceof xc||u instanceof za)for(const p of u.uniformNames)r.push({name:p,property:l,binding:u.getBinding(e,p)})}return r}setUniforms(e,r,l,u,p){for(const{name:m,property:v,binding:b}of l)this.binders[v].setUniform(e,b,p,u.get(v),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof El||r instanceof za||r instanceof Oa)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer),r instanceof Oa&&r.paintTransitionVertexBuffer&&this._buffers.push(r.paintTransitionVertexBuffer)}}upload(e){for(const r in this.binders){const l=this.binders[r];(l instanceof El||l instanceof za||l instanceof Oa)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof El||r instanceof za||r instanceof Oa)&&r.destroy()}}}class Ho{constructor(e,r,l=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new wc(u,r,l);this.needsUpload=!1,this._featureMap=new Zh,this._featureMapWithoutIds=new Zh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,l,u,p,m,v,b,S){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(e,r,u,p,m,v,b,S);r.id!==void 0?this._featureMap.add(r.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,l,u,p,m,v,b){for(const S of l)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,S,u,p,m,v||0,b)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ax={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function oA(s,e){return ax[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const d={"line-pattern":{source:Sl,composite:Sl},"fill-pattern":{source:Sl,composite:Sl},"fill-extrusion-pattern":{source:Sl,composite:Sl},"line-dasharray":{source:mu,composite:mu}},n={color:{source:yu,composite:$o},number:{source:Tl,composite:yu}};function a(s,e,r){const l=d[s];return l&&l[r]||n[e][r]}Pt(fo,"ConstantBinder"),Pt(xc,"PatternConstantBinder"),Pt(El,"SourceExpressionBinder"),Pt(Oa,"PatternCompositeBinder"),Pt(za,"CompositeExpressionBinder"),Pt(wc,"ProgramConfiguration",{omit:["_buffers"]}),Pt(Ho,"ProgramConfigurationSet");const h=vt/Math.PI/2,g=5,y=6,x=16383,T=64,I=[T,32,16],P=-h,R=h;function F(s,e,r,l=h){return r=De(r),[s*Math.sin(r)*l,-e*l,s*Math.cos(r)*l]}function D(s,e,r){return F(Math.cos(De(s)),Math.sin(De(s)),e,r)}const j=63710088e-1,U=2*Math.PI*j;class G{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new G(ke(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,l=this.lat*r,u=e.lat*r,p=Math.sin(l)*Math.sin(u)+Math.cos(l)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return j*Math.acos(Math.min(p,1))}toBounds(e=0){const r=360*e/40075017,l=r/Math.cos(Math.PI/180*this.lat);return new J({lng:this.lng-l,lat:this.lat-r},{lng:this.lng+l,lat:this.lat+r})}toEcef(e){return D(this.lat,this.lng,h+e*h/j)}static convert(e){if(e instanceof G)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new G(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new G(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class J{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof G?new G(e.lng,e.lat):G.convert(e),this}setSouthWest(e){return this._sw=e instanceof G?new G(e.lng,e.lat):G.convert(e),this}extend(e){const r=this._sw,l=this._ne;let u,p;if(e instanceof G)u=e,p=e;else{if(!(e instanceof J))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(J.convert(e)):this.extend(G.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(G.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return r||l?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new G(u.lng,u.lat),this._ne=new G(p.lng,p.lat)),this}getCenter(){return new G((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new G(this.getWest(),this.getNorth())}getSouthEast(){return new G(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:l}=G.convert(e);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){if(e)return e instanceof J?e:new J(e)}}const Z=0,ee=25.5;function oe(s){return U*Math.cos(s*Math.PI/180)}function ue(s){return(180+s)/360}function ye(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function ge(s,e){return s/oe(e)}function ve(s){return 360*s-180}function _e(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function me(s,e){return s*oe(_e(e))}const xe=85.051129;function Ne(s){return Math.cos(De(Se(s,-xe,xe)))}function Re(s,e){const r=Se(e,Z,ee),l=Math.pow(2,r);return Ne(s)*U/(512*l)}function qe(s){return 1/Math.cos(s*Math.PI/180)}function Oe(s,e=0){const r=Math.exp(Math.PI*(1-(s.y+e/vt)/(1<<s.z)*2));return 80150034*r/(r*r+1)/vt/(1<<s.z)}class We{constructor(e,r,l=0){this.x=+e,this.y=+r,this.z=+l}static fromLngLat(e,r=0){const l=G.convert(e);return new We(ue(l.lng),ye(l.lat),ge(r,l.lat))}toLngLat(){return new G(ve(this.x),_e(this.y))}toAltitude(){return me(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/U*qe(_e(this.y))}}function gt(s,e,r,l,u,p,m,v,b){const S=(e+l)/2,A=(r+u)/2,C=new ct(S,A);v(C),function(M,z,O,$,W,q){const ie=O-W,re=$-q;return Math.abs(($-z)*ie-(O-M)*re)/Math.hypot(ie,re)}(C.x,C.y,p.x,p.y,m.x,m.y)>=b?(gt(s,e,r,S,A,p,C,v,b),gt(s,S,A,l,u,C,m,v,b)):s.push(m)}function Fe(s,e,r){let l=s[0],u=l.x,p=l.y;e(l);const m=[l];for(let v=1;v<s.length;v++){const b=s[v],{x:S,y:A}=b;e(b),gt(m,u,p,S,A,l,b,e,r),u=S,p=A,l=b}return m}function Ce(s,e,r,l){if(l(e,r)){const u=e.add(r)._mult(.5);Ce(s,e,u,l),Ce(s,u,r,l)}else s.push(r)}function Ze(s,e){let r=s[0];const l=[r];for(let u=1;u<s.length;u++){const p=s[u];Ce(l,r,p,e),r=p}return l}const Ve=Math.pow(2,14)-1,it=-Ve-1;function mt(s,e){const r=Math.round(s.x*e),l=Math.round(s.y*e);return s.x=Se(r,it,Ve),s.y=Se(l,it,Ve),(r<s.x||r>s.x+1||l<s.y||l>s.y+1)&&Dn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function It(s,e,r){const l=s.loadGeometry(),u=s.extent,p=vt/u;if(e&&r&&r.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:v,x:b,y:S,projection:A}=r,C=M=>{const z=ve((e.x+M.x/u)/m),O=_e((e.y+M.y/u)/m),$=A.project(z,O);M.x=($.x*v-b)*u,M.y=($.y*v-S)*u};for(let M=0;M<l.length;M++)if(s.type!==1)l[M]=Fe(l[M],C,1);else{const z=[];for(const O of l[M])O.x<0||O.x>=u||O.y<0||O.y>=u||(C(O),z.push(O));l[M]=z}}for(const m of l)for(const v of m)mt(v,p);return l}function ht(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?It(s):[]}}class at{constructor(e,r,l,u,p){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=p,e.readFields(jt,this,r)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos,l=[];let u,p=1,m=0,v=0,b=0;for(;e.pos<r;){if(m<=0){const S=e.readVarint();p=7&S,m=S>>3}if(m--,p===1||p===2)v+=e.readSVarint(),b+=e.readSVarint(),p===1&&(u&&l.push(u),u=[]),u&&u.push(new ct(v,b));else{if(p!==7)throw new Error(`unknown command ${p}`);u&&u.push(u[0].clone())}}return u&&l.push(u),l}bbox(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let l=1,u=0,p=0,m=0,v=1/0,b=-1/0,S=1/0,A=-1/0;for(;e.pos<r;){if(u<=0){const C=e.readVarint();l=7&C,u=C>>3}if(u--,l===1||l===2)p+=e.readSVarint(),m+=e.readSVarint(),p<v&&(v=p),p>b&&(b=p),m<S&&(S=m),m>A&&(A=m);else if(l!==7)throw new Error(`unknown command ${l}`)}return[v,S,b,A]}toGeoJSON(e,r,l){const u=this.extent*Math.pow(2,l),p=this.extent*e,m=this.extent*r,v=this.loadGeometry();function b(M){return[360*(M.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(M.y+m)/u)*Math.PI))-90]}function S(M){return M.map(b)}let A;if(this.type===1){const M=[];for(const O of v)M.push(O[0]);const z=S(M);A=M.length===1?{type:"Point",coordinates:z[0]}:{type:"MultiPoint",coordinates:z}}else if(this.type===2){const M=v.map(S);A=M.length===1?{type:"LineString",coordinates:M[0]}:{type:"MultiLineString",coordinates:M}}else{if(this.type!==3)throw new Error("unknown feature type");{const M=function(O){const $=O.length;if($<=1)return[O];const W=[];let q,ie;for(let re=0;re<$;re++){const le=Ot(O[re]);le!==0&&(ie===void 0&&(ie=le<0),ie===le<0?(q&&W.push(q),q=[O[re]]):q&&q.push(O[re]))}return q&&W.push(q),W}(v),z=[];for(const O of M)z.push(O.map(S));A=z.length===1?{type:"Polygon",coordinates:z[0]}:{type:"MultiPolygon",coordinates:z}}}const C={type:"Feature",geometry:A,properties:this.properties};return this.id!=null&&(C.id=this.id),C}}function jt(s,e,r){s===1?e.id=r.readVarint():s===2?function(l,u){const p=l.readVarint()+l.pos;for(;l.pos<p;){const m=u._keys[l.readVarint()],v=u._values[l.readVarint()];u.properties[m]=v}}(r,e):s===3?e.type=r.readVarint():s===4&&(e._geometry=r.pos)}function Ot(s){let e=0;for(let r,l,u=0,p=s.length,m=p-1;u<p;m=u++)r=s[u],l=s[m],e+=(l.x-r.x)*(r.y+l.y);return e}at.types=["Unknown","Point","LineString","Polygon"];class Bt{constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(zt,this,r),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new at(this._pbf,r,this.extent,this._keys,this._values)}}function zt(s,e,r){s===15?e.version=r.readVarint():s===1?e.name=r.readString():s===5?e.extent=r.readVarint():s===2?e._features.push(r.pos):s===3?e._keys.push(r.readString()):s===4&&e._values.push(function(l){let u=null;const p=l.readVarint()+l.pos;for(;l.pos<p;){const m=l.readVarint()>>3;u=m===1?l.readString():m===2?l.readFloat():m===3?l.readDouble():m===4?l.readVarint64():m===5?l.readVarint():m===6?l.readSVarint():m===7?l.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u}(r))}class rn{constructor(e,r){this.layers=e.readFields(gn,{},r)}}function gn(s,e,r){if(s===3){const l=new Bt(r,r.readVarint()+r.pos);l.length&&(e[l.name]=l)}}const vn="3d_elevation_id",ei="level";class hn{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,r){return this._valid&&e(r(this._geometry)),this}require(e,r,l){return this.get(e,!0,r,l)}optional(e,r,l){return this.get(e,!1,r,l)}success(){return this._valid}get(e,r,l,u){const p=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&p!==void 0&&!Number.isNaN(p)?l(u?u(p):p):r&&(this._valid=!1),this}}class jn{constructor(e,r){this.featureFunc=e,this.vertexFunc=r}parseFeature(e,r,l){return this.featureFunc(e,r,l)}parseVertex(e,r,l){return this.vertexFunc(e,r,l)}}const Yn=new jn((s,e,r)=>s.reset(e).require(vn,l=>{r.id=l}).optional("fixed_height_relative",l=>{r.constantHeight=l},_n.decodeRelativeHeight).geometry(l=>{r.bounds=l},lf).success(),(s,e,r)=>s.reset(e).require(vn,l=>{r.id=l}).require("elevation_idx",l=>{r.idx=l}).require("extent",l=>{r.extent=l}).require("height_relative",l=>{r.height=l},_n.decodeRelativeHeight).geometry(l=>{r.position=l},_n.getPoint).success()),Ei=new jn((s,e,r)=>s.reset(e).require(vn,l=>{r.id=l}).optional("fixed_height",l=>{r.constantHeight=l},_n.decodeMetricHeight).geometry(l=>{r.bounds=l},lf).success(),(s,e,r)=>s.reset(e).require(vn,l=>{r.id=l}).require("elevation_idx",l=>{r.idx=l}).require("extent",l=>{r.extent=l}).require("height",l=>{r.height=l},_n.decodeMetricHeight).geometry(l=>{r.position=l},_n.getPoint).success());class _n{static getPoint(e){return Cs(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Ei:void 0:Yn}static parse(e){const r=[],l=[],u=e.length,p=new hn;for(let m=0;m<u;m++){const v=e.feature(m),b=v.properties.version,S=_n.getVersionSchema(b);if(S===void 0){Dn(`Unknown elevation feature version number ${b||"(unknown)"}`);continue}const A=v.properties.type;if(!A)continue;const C=at.types[v.type];if(C==="Point"&&A==="curve_point"){const M={};S.parseVertex(p,v,M)&&r.push(M)}else if(C==="Polygon"&&A==="curve_meta"){const M={};S.parseFeature(p,v,M)&&l.push(M)}}return{vertices:r,features:l}}}class $n{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,l){const u=vr(r,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1])/u;return l[0]=this.pos[0]+this.dir[0]*p,l[1]=this.pos[1]+this.dir[1]*p,!0}}class Un{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,l){const u=Wn(r,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/u;return l[0]=this.pos[0]+this.dir[0]*p,l[1]=this.pos[1]+this.dir[1]*p,l[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,r,l){if(function(z,O){var $=z[0],W=z[1],q=z[2],ie=O[0],re=O[1],le=O[2];return Math.abs($-ie)<=k*Math.max(1,Math.abs($),Math.abs(ie))&&Math.abs(W-re)<=k*Math.max(1,Math.abs(W),Math.abs(re))&&Math.abs(q-le)<=k*Math.max(1,Math.abs(q),Math.abs(le))}(this.pos,e)||r===0)return l[0]=l[1]=l[2]=0,!1;const[u,p,m]=this.dir,v=this.pos[0]-e[0],b=this.pos[1]-e[1],S=this.pos[2]-e[2],A=u*u+p*p+m*m,C=2*(v*u+b*p+S*m),M=C*C-4*A*(v*v+b*b+S*S-r*r);if(M<0){const z=Math.max(-C/2,0),O=v+u*z,$=b+p*z,W=S+m*z,q=Math.hypot(O,$,W);return l[0]=O*r/q,l[1]=$*r/q,l[2]=W*r/q,!1}{const z=(-C-Math.sqrt(M))/(2*A);if(z<0){const O=Math.hypot(v,b,S);return l[0]=v*r/O,l[1]=b*r/O,l[2]=S*r/O,!1}return l[0]=v+u*z,l[1]=b+p*z,l[2]=S+m*z,!0}}}class Zn{constructor(e,r,l,u,p){this.TL=e,this.TR=r,this.BR=l,this.BL=u,this.horizon=p}static fromInvProjectionMatrix(e,r,l){const u=[-1,1,1],p=[1,1,1],m=[1,-1,1],v=[-1,-1,1],b=ui(u,u,e),S=ui(p,p,e),A=ui(m,m,e),C=ui(v,v,e);return new Zn(b,S,A,C,r/l)}}function Ai(s,e,r){let l=1/0,u=-1/0;const p=[];for(const m of s){ii(p,m,e);const v=Wn(p,r);l=Math.min(l,v),u=Math.max(u,v)}return[l,u]}function Xi(s,e){let r=!0;for(let l=0;l<s.planes.length;l++){const u=s.planes[l];let p=0;for(let m=0;m<e.length;m++)p+=+(Wn(u,e[m])+u[3]>=0);if(p===0)return 0;p!==e.length&&(r=!1)}return r?2:1}function Ar(s,e){for(const r of s.projections){const l=Ai(e,s.points[0],r.axis);if(r.projection[1]<l[0]||r.projection[0]>l[1])return 0}return 1}function Ci(s,e){let r=0;const l=[0,0,0,0];for(let m=0;m<s.length;m++)l[0]=s[m][0],l[1]=s[m][1],l[2]=s[m][2],l[3]=1,(u=l)[0]*(p=e)[0]+u[1]*p[1]+u[2]*p[2]+u[3]*p[3]>=0&&r++;var u,p;return r}class xn{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=Qt.fromPoints(this.points),this.projections=[],this.frustumEdges=[ii([],this.points[2],this.points[3]),ii([],this.points[0],this.points[3]),ii([],this.points[4],this.points[0]),ii([],this.points[5],this.points[1]),ii([],this.points[6],this.points[2]),ii([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const u=[0,-l[2],l[1]],p=[l[2],0,-l[0]];this.projections.push({axis:u,projection:Ai(this.points,this.points[0],u)}),this.projections.push({axis:p,projection:Ai(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,r,l,u){const p=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const A=Nr([],S,e),C=1/A[3]/r*p;return(M=A)[0]=(z=A)[0]*(O=[C,C,u?1/A[3]:C,C])[0],M[1]=z[1]*O[1],M[2]=z[2]*O[2],M[3]=z[3]*O[3],M;var M,z,O}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const A=Vn([],ci([],ii([],m[S[0]],m[S[1]]),ii([],m[S[2]],m[S[1]]))),C=-Wn(A,m[S[1]]);return A.concat(C)}),b=[];for(let S=0;S<m.length;S++)b.push([m[S][0],m[S][1],m[S][2]]);return new xn(b,v)}intersectsPrecise(e,r,l){for(let u=0;u<r.length;u++)if(!Ci(e,r[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!Ci(e,this.planes[u]))return 0;for(const u of l)for(const p of this.frustumEdges){const m=ci([],u,p),v=ln(m);if(v===0)continue;on(m,m,1/v);const b=Ai(this.points,this.points[0],m),S=Ai(e,this.points[0],m);if(b[0]>S[1]||S[0]>b[1])return 0}return 1}containsPoint(e){for(const r of this.planes){const l=r[3];if(Wn([r[0],r[1],r[2]],e)+l<0)return!1}return!0}}class Qt{static fromPoints(e){const r=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const u of e)sn(r,r,u),Tn(l,l,u);return new Qt(r,l)}static fromTileIdAndHeight(e,r,l){const u=1<<e.canonical.z,p=e.canonical.x,m=e.canonical.y;return new Qt([p/u,m/u,r],[(p+1)/u,(m+1)/u,l])}static applyTransform(e,r){const l=e.getCorners();for(let u=0;u<l.length;++u)ui(l[u],l[u],r);return Qt.fromPoints(l)}static applyTransformFast(e,r){const l=[r[12],r[13],r[14]],u=[...l];for(let p=0;p<3;p++)for(let m=0;m<3;m++){const v=r[4*m+p],b=v*e.min[m],S=v*e.max[m];l[p]+=Math.min(b,S),u[p]+=Math.max(b,S)}return new Qt(l,u)}static projectAabbCorners(e,r){const l=e.getCorners();for(let u=0;u<l.length;++u)ui(l[u],l[u],r);return l}constructor(e,r){this.min=e,this.max=r,this.center=on([],pn([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],l=qt(this.min),u=qt(this.max);for(let p=0;p<r.length;p++)l[p]=r[p]?this.min[p]:this.center[p],u[p]=r[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new Qt(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Xi(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Xi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?Ar(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?Ar(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Pt(Qt,"Aabb");class ti{constructor(e,r){this.feature=e,this.metersToTile=r,this.index=0}get(){const e=this.feature.vertices[this.index],r=this.feature.vertexProps[this.index].dir,l=r[1],u=-r[0],p=(e.extent+1)*this.metersToTile;return[new ct(Math.trunc(e.position[0]+l*p),Math.trunc(e.position[1]+u*p)),new ct(Math.trunc(e.position[0]-l*p),Math.trunc(e.position[1]-u*p))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Ui{constructor(e,r,l,u,p,m){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[yr(),yr(),yr(),yr(),yr(),yr(),yr()],this.id=e,this.heightRange={min:l,max:l},this.safeArea=r,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=p,this.edges=this.edges.filter(v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((b=this.vertices[v.a].position)[0]===(S=this.vertices[v.b].position)[0]&&b[1]===S[1]);var b,S}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const v of this.vertices)this.vertexProps.push({dir:Cs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(const v of this.edges){const b=this.vertices[v.a].position,S=this.vertices[v.b].position,A=Io(yr(),S,b),C=Pa(A),M=zo(yr(),A,1/C);this.edgeProps.push({vec:A,dir:M,len:C});const z=this.vertexProps[v.a].dir,O=this.vertexProps[v.b].dir;aa(z,z,M),aa(O,O,M)}for(const v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||Ri(v.dir,v.dir);this.tessellate(m)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const r=this.getClosestEdge(e);if(r==null)return 0;const[l,u]=r;return Kt(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,u)}computeSlopeNormal(e,r){const l=this.getClosestEdge(e);if(!l)return Ht(0,0,1);const u=l[0],p=this.edges[u],m=this.edgeProps[u].vec,v=Ht(m[0],m[1],(this.vertices[p.b].height-this.vertices[p.a].height)*r),b=Ht(v[1],-v[0],0);ci(b,b,v);const S=ln(b);return S>0?on(b,b,1/S):cn(b,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let r=0,l=Number.POSITIVE_INFINITY,u=0;const[p,m,v,b,S,A,C]=this._tmpVec2;oa(C,e.x,e.y);const M=new $n(C,null);for(let z=0;z<this.edges.length;z++){const O=this.edges[z],$=this.edgeProps[z].dir;M.dir=$;const W=this.vertices[O.a].position,q=this.vertices[O.b].position,ie=M.intersectsPlane(W,this.vertexProps[O.a].dir,p),re=M.intersectsPlane(q,this.vertexProps[O.b].dir,m);if(!ie||!re)continue;Io(v,m,p),Io(b,C,p);const le=vr(v,v),we=le>0?vr(b,v)/le:0,be=Se(we,0,1),Ie=Math.abs((we-be)*this.edgeProps[z].len);Io(S,C,W),oa(A,$[1],-$[0]);const Pe=Ie+Math.abs(vr(S,A));Pe<l&&(r=z,l=Pe,u=be)}return[r,u]}tessellate(e){const r=xt(),l=xt(),u=xt(),p=xt();for(let m=this.edges.length-1;m>=0;--m){const v=this.edges[m].a,b=this.edges[m].b,{position:S,height:A,extent:C}=this.vertices[v],{position:M,height:z,extent:O}=this.vertices[b],$=this.vertexProps[v].dir,W=this.vertexProps[b].dir;if(cn(r,S[0]/e,S[1]/e,A),cn(l,M[0]/e,M[1]/e,z),cn(u,$[1],-$[0],0),on(u,u,C),cn(p,W[1],-W[0],0),on(p,p,O),this.distSqLines(Ht(r[0]+.5*u[0],r[1]+.5*u[1],r[2]+.5*u[2]),Ht(l[0]-.5*p[0],l[1]-.5*p[1],l[2]-.5*p[2]),Ht(r[0]-.5*u[0],r[1]-.5*u[1],r[2]-.5*u[2]),Ht(l[0]+.5*p[0],l[1]+.5*p[1],l[2]+.5*p[2]))<=.0025000000000000005)continue;const q=this.vertices.length,ie=aa(yr(),S,M);this.vertices.push({position:zo(ie,ie,.5),height:.5*(A+z),extent:.5*(C+O)});const re=aa(yr(),$,W);this.vertexProps.push({dir:Ri(re,re)}),this.edges.splice(m,1),this.edgeProps.splice(m,1),this.edges.push({a:v,b:q}),this.edges.push({a:q,b});const le=Io(yr(),this.vertices[q].position,S),we=Pa(le),be={vec:le,dir:zo(yr(),le,1/we),len:we};this.edgeProps.push(be),this.edgeProps.push(be)}}distSqLines(e,r,l,u){const p=Rn(xt(),r,e),m=Rn(xt(),u,l),v=Rn(xt(),e,l),b=Wn(p,p),S=Wn(p,m),A=Wn(p,v),C=Wn(m,m),M=Wn(m,v),z=b*C-S*S;if(z===0)return _r(rr(p,l,u,Wn(v,m)/Wn(m,m)),e);const O=(b*M-S*A)/z;return _r(rr(p,e,r,(S*M-A*C)/z),rr(m,l,u,O))}}class ki{static parseFrom(e,r){const l=_n.parse(e);if(!l)return[];let{vertices:u,features:p}=l;const m=1/Oe(r);p.sort((A,C)=>A.id-C.id),u.sort((A,C)=>A.id-C.id||A.idx-C.idx),u=u.filter((A,C,M)=>C===M.findIndex(z=>z.id===A.id&&z.idx===A.idx));const v=new Array;let b=0;const S=u.length;for(const A of p){if(A.constantHeight){v.push(new Ui(A.id,A.bounds,A.constantHeight));continue}for(;b!==S&&u[b].id<A.id;)b++;if(b===S||u[b].id!==A.id)continue;const C=new Array,M=new Array,z=b;for(;b!==S&&u[b].id===A.id;){const O=u[b];if(C.push({position:O.position,height:O.height,extent:O.extent}),b!==z&&u[b-1].idx===O.idx-1){const $=b-z;M.push({a:$-1,b:$})}b++}v.push(new Ui(A.id,A.bounds,void 0,C,M,m))}return v}static getElevationFeature(e,r){if(!r)return;const l=+e.properties[vn];return Number.isNaN(l)?void 0:r.find(u=>u.id===l)}}class tr{constructor(e,r){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(r)||(this.zScale=Math.pow(2,r.z-e.z),this.xOffset=(e.x*this.zScale-r.x)*vt,this.yOffset=(e.y*this.zScale-r.y)*vt)}constantElevation(e,r){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,r)}pointElevation(e,r,l){const u=this.constantElevation(r,l);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(r.pointElevation(e),l))}computeBiasedHeight(e,r){return r<=0?e:e+r*$e(0,r,e>=0?e:Math.abs(.5*e))}}Pt(Ui,"ElevationFeature");class Br{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new bl,this.indexArray=new xr,this.segments=new Oi,this.programConfigurations=new Ho(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Tl),this.worldview=e.worldview}updateFootprints(e,r){}populate(e,r,l,u){const p=this.layers[0],m=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:S,id:A,index:C,sourceLayerIndex:M}of e){const z=this.layers[0]._featureFilter.needGeometry,O=ht(S,z);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom,{worldview:this.worldview}),O,l))continue;const $=v?v.evaluate(O,{},l):void 0,W={id:A,properties:S.properties,type:S.type,sourceLayerIndex:M,index:C,geometry:z?O.geometry:It(S,l,u),patterns:{},sortKey:$};m.push(W)}v&&m.sort((S,A)=>S.sortKey-A.sortKey);let b=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new qf,b=u.projection);for(const S of m){const{geometry:A,index:C,sourceLayerIndex:M}=S,z=e[C].feature;this.addFeature(S,A,C,r.availableImages,l,b,r.brightness,r.elevationFeatures),r.featureIndex.insert(z,A,C,M,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,r,l,u,p,m,v){this.programConfigurations.updatePaintArrays(e,r,p,l,u,m,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,qw.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Ww.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,r,l,u,p,m,v,b){let S;this.elevationMode!=="none"&&(S=ki.getElevationFeature(e,b));for(const A of r)for(const C of A){const M=C.x,z=C.y;if(M<0||M>=vt||z<0||z>=vt)continue;if(m){const W=m.projectTilePoint(M,z,p),q=m.upVector(p,M,z);this.addGlobeExtVertex(W,q),this.addGlobeExtVertex(W,q),this.addGlobeExtVertex(W,q),this.addGlobeExtVertex(W,q)}const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),$=O.vertexLength;if(this.addCircleVertex(M,z,-1,-1),this.addCircleVertex(M,z,1,-1),this.addCircleVertex(M,z,1,1),this.addCircleVertex(M,z,-1,1),this.elevationMode!=="none"){const W=S?S.pointElevation(new ct(M,z)):0;this.hasElevation=this.hasElevation||W!==0;for(let q=0;q<4;q++)this.elevatedLayoutVertexArray.emplaceBack(W)}this.indexArray.emplaceBack($,$+1,$+2),this.indexArray.emplaceBack($,$+2,$+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},u,p,v,void 0,this.worldview)}addCircleVertex(e,r,l,u){this.layoutVertexArray.emplaceBack(2*e+(l+1)/2,2*r+(u+1)/2)}addGlobeExtVertex(e,r){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}}function po(s,e){for(let r=0;r<s.length;r++)if(Cr(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(Cr(s,e[r]))return!0;return!!ws(s,e)}function mo(s,e,r){return!!Cr(s,e)||!!Ki(e,s,r)}function Vs(s,e){if(s.length===1)return fr(e,s[0]);for(let r=0;r<e.length;r++){const l=e[r];for(let u=0;u<l.length;u++)if(Cr(s,l[u]))return!0}for(let r=0;r<s.length;r++)if(fr(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(ws(s,e[r]))return!0;return!1}function Us(s,e,r){if(s.length>1){if(ws(s,e))return!0;for(let l=0;l<e.length;l++)if(Ki(e[l],s,r))return!0}for(let l=0;l<s.length;l++)if(Ki(s[l],e,r))return!0;return!1}function ws(s,e){if(s.length===0||e.length===0)return!1;for(let r=0;r<s.length-1;r++){const l=s[r],u=s[r+1];for(let p=0;p<e.length-1;p++)if(Po(l,u,e[p],e[p+1]))return!0}return!1}function Po(s,e,r,l){return Zi(s,r,l)!==Zi(e,r,l)&&Zi(s,e,r)!==Zi(s,e,l)}function Wo(s,e,r){return(s.x-r.x)*(e.y-r.y)-(s.y-r.y)*(e.x-r.x)}function qi(s,e,r,l){const u=Wo(s,e,l),p=Wo(s,e,r);if(Math.sign(u)===Math.sign(p))return;const m=Wo(r,l,s),v=m+p-u;return Math.sign(m)!==Math.sign(v)?[m/(m-v),p/(p-u)]:void 0}function Ki(s,e,r){const l=r*r;if(e.length===1)return s.distSqr(e[0])<l;for(let u=1;u<e.length;u++)if(Di(s,e[u-1],e[u])<l)return!0;return!1}function Di(s,e,r){const l=e.distSqr(r);if(l===0)return s.distSqr(e);const u=((s.x-e.x)*(r.x-e.x)+(s.y-e.y)*(r.y-e.y))/l;return s.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function fr(s,e){let r,l,u,p=!1;for(let m=0;m<s.length;m++){r=s[m];for(let v=0,b=r.length-1;v<r.length;b=v++)l=r[v],u=r[b],l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(p=!p)}return p}function Cr(s,e){let r=!1;for(let l=0,u=s.length-1;l<s.length;u=l++){const p=s[l],m=s[u];p.y>e.y!=m.y>e.y&&e.x<(m.x-p.x)*(e.y-p.y)/(m.y-p.y)+p.x&&(r=!r)}return r}function Ji(s,e,r,l,u){for(const m of s)if(e<=m.x&&r<=m.y&&l>=m.x&&u>=m.y)return!0;const p=[new ct(e,r),new ct(e,u),new ct(l,u),new ct(l,r)];if(s.length>2){for(const m of p)if(Cr(s,m))return!0}for(let m=0;m<s.length-1;m++)if(ts(s[m],s[m+1],p))return!0;return!1}function ts(s,e,r){const l=r[0],u=r[2];if(s.x<l.x&&e.x<l.x||s.x>u.x&&e.x>u.x||s.y<l.y&&e.y<l.y||s.y>u.y&&e.y>u.y)return!1;const p=Zi(s,e,r[0]);return p!==Zi(s,e,r[1])||p!==Zi(s,e,r[2])||p!==Zi(s,e,r[3])}function ga(s,e,r,l,u,p){let m=e.y-s.y,v=s.x-e.x;if(p=p||0){const b=m*m+v*v;if(b===0)return!0;const S=Math.sqrt(b);m/=S,v/=S}return!((r.x-s.x)*m+(r.y-s.y)*v-p<0||(l.x-s.x)*m+(l.y-s.y)*v-p<0||(u.x-s.x)*m+(u.y-s.y)*v-p<0)}function Fa(s,e,r,l,u,p,m){return!(ga(s,e,l,u,p,m)||ga(e,r,l,u,p,m)||ga(r,s,l,u,p,m)||ga(l,u,s,e,r,m)||ga(u,p,s,e,r,m)||ga(p,l,s,e,r,m))}function qo(s,e,r){const l=e.paint.get(s).value;return l.kind==="constant"?l.value:r.programConfigurations.get(e.id).getMaxValue(s)}function Il(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Al(s,e,r,l,u){if(!e[0]&&!e[1])return s;const p=ct.convert(e)._mult(u);r==="viewport"&&p._rotate(-l);const m=[];for(let v=0;v<s.length;v++)m.push(s[v].sub(p));return m}function _a(s,e,r,l){const u=ct.convert(s)._mult(l);return e==="viewport"&&u._rotate(-r),u}let wu,Na;function ya(s,e,r){var l=2*Math.PI*6378137/256/Math.pow(2,r);return[s*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}Pt(Br,"CircleBucket",{omit:["layers"]});class Ba{constructor(e,r,l){this.z=e,this.x=r,this.y=l,this.key=ip(0,e,e,r,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const r=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>r&&e.y===this.y>>r}url(e,r){const l=function(p,m,v){var b=ya(256*p,256*(m=Math.pow(2,v)-m-1),v),S=ya(256*(p+1),256*(m+1),v);return b[0]+","+b[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),u=function(p,m,v){let b,S="";for(let A=p;A>0;A--)b=1<<A-1,S+=(m&b?1:0)+(v&b?2:0);return S}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class np{constructor(e,r){this.wrap=e,this.canonical=r,this.key=ip(e,r.z,r.z,r.x,r.y)}}class bs{constructor(e,r,l,u,p){this.overscaledZ=e,this.wrap=r,this.canonical=new Ba(l,+u,+p),this.key=r===0&&e===l?this.canonical.key:ip(r,e,l,u,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new bs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new bs(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return ip(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return ip(this.wrap*+r,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new bs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,l=2*this.canonical.x,u=2*this.canonical.y;return[new bs(r,this.wrap,r,l,u),new bs(r,this.wrap,r,l+1,u),new bs(r,this.wrap,r,l,u+1),new bs(r,this.wrap,r,l+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new bs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new bs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new np(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ip(s,e,r,l,u){const p=1<<Math.min(r,22);let m=p*(u%p)+l%p;return s&&r<22&&(m+=p*p*((s<0?-2*s-1:2*s)%(1<<2*(22-r)))),16*(32*m+r)+(e-r)}const u5=[s=>{let e=s.canonical.x-1,r=s.wrap;return e<0&&(e=(1<<s.canonical.z)-1,r--),new bs(s.overscaledZ,r,s.canonical.z,e,s.canonical.y)},s=>{let e=s.canonical.x+1,r=s.wrap;return e===1<<s.canonical.z&&(e=0,r++),new bs(s.overscaledZ,r,s.canonical.z,e,s.canonical.y)},s=>new bs(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new bs(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];Pt(Ba,"CanonicalTileID"),Pt(bs,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const h5=zn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:lx}=h5,d5=zn([{name:"a_pos_3",components:3,type:"Int16"}]);var aA=zn([{name:"a_pos",type:"Int16",components:2}]);function cx(s){return s*h/j}const f5=[new Qt([P,P,P],[R,R,R]),new Qt([P,P,P],[0,0,R]),new Qt([0,P,P],[R,0,R]),new Qt([P,0,P],[0,R,R]),new Qt([0,0,P],[R,R,R])];function lA(s,e,r,l=!0){const u=on([],s._camera.position,s.worldSize),p=[e,r,1,1];Nr(p,p,s.pixelMatrixInverse),lr(p,p,1/p[3]);const m=Vn([],ii([],p,u)),v=s.globeMatrix,b=[v[12],v[13],v[14]],S=ii([],b,u),A=ln(S),C=Vn([],S),M=s.worldSize/(2*Math.PI),z=Wn(C,m),O=Math.asin(M/A);if(O<Math.acos(z)){if(!l)return null;const Ye=[],ze=[];on(Ye,m,A/z),Vn(ze,ii(ze,Ye,S)),Vn(m,pn(m,S,on(m,ze,Math.tan(O)*A)))}const $=[];new Un(u,m).closestPointOnSphere(b,M,$);const W=Vn([],Wi(v,0)),q=Vn([],Wi(v,1)),ie=Vn([],Wi(v,2)),re=Wn(W,$),le=Wn(q,$),we=Wn(ie,$),be=X(Math.asin(-le/M));let Ie=X(Math.atan2(re,we));Ie=s.center.lng+function(Ye,ze){const Qe=(ze-Ye+180)%360-180;return Qe<-180?Qe+360:Qe}(s.center.lng,Ie);const Pe=ue(Ie),Me=Se(ye(be),0,1);return new We(Pe,Me)}class p5{constructor(e,r,l){this.a=ii([],e,l),this.b=ii([],r,l),this.center=l;const u=Vn([],this.a),p=Vn([],this.b);this.angle=Math.acos(Wn(u,p))}}function Qw(s,e){if(s.angle===0)return null;let r;return r=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),r<0||r>1?null:function(l,u,p,m){const v=Math.sin(p);return l*(Math.sin((1-m)*p)/v)+u*(Math.sin(m*p)/v)}(s.a[e],s.b[e],s.angle,Se(r,0,1))+s.center[e]}function Cl(s){if(s.z<=1)return f5[s.z+2*s.y+s.x];const e=eb(ux(s));return Qt.fromPoints(e)}function bc(s,e,r){return on(s,s,1-r),Xn(s,s,e,r)}function cA(s,e,r){for(const l of s)ui(l,l,e),on(l,l,r)}function uA(s,e,r,l){const u=e/s.worldSize,p=s.globeMatrix;if(r.z<=1){const Me=Cl(r).getCorners();return cA(Me,p,u),Qt.fromPoints(Me)}const m=ux(r,l),v=eb(m,h+cx(s._tileCoverLift));cA(v,p,u);const b=Number.MAX_VALUE,S=[-b,-b,-b],A=[b,b,b];if(m.contains(s.center)){for(const ze of v)sn(A,A,ze),Tn(S,S,ze);S[2]=0;const Me=s.point,Ye=[Me.x*u,Me.y*u,0];return sn(A,A,Ye),Tn(S,S,Ye),new Qt(A,S)}if(s._tileCoverLift>0){for(const Me of v)sn(A,A,Me),Tn(S,S,Me);return new Qt(A,S)}const C=[p[12]*u,p[13]*u,p[14]*u],M=m.getCenter(),z=Se(s.center.lat,-xe,xe),O=Se(M.lat,-xe,xe),$=ue(s.center.lng),W=ye(z);let q=$-ue(M.lng);const ie=W-ye(O);q>.5?q-=1:q<-.5&&(q+=1);let re=0;Math.abs(q)>Math.abs(ie)?re=q>=0?1:3:(re=ie>=0?0:2,Xn(C,C,[p[4]*u,p[5]*u,p[6]*u],-Math.sin(De(ie>=0?m.getSouth():m.getNorth()))*h));const le=v[re],we=v[(re+1)%4],be=new p5(le,we,C),Ie=[Qw(be,0)||le[0],Qw(be,1)||le[1],Qw(be,2)||le[2]],Pe=bu(s.zoom);if(Pe>0){const Me=function({x:ze,y:Qe,z:lt},tt,rt,dt,Xe){const ot=1/(1<<lt);let Ge=ze*ot,je=Ge+ot,ft=Qe*ot,ut=ft+ot,Gt=0;const At=(Ge+je)/2-dt;return At>.5?Gt=-1:At<-.5&&(Gt=1),Ge=((Ge+Gt)*tt-(dt*=tt))*rt+dt,je=((je+Gt)*tt-dt)*rt+dt,ft=(ft*tt-(Xe*=tt))*rt+Xe,ut=(ut*tt-Xe)*rt+Xe,[[Ge,ut,0],[je,ut,0],[je,ft,0],[Ge,ft,0]]}(r,e,s._pixelsPerMercatorPixel,$,W);for(let ze=0;ze<v.length;ze++)bc(v[ze],Me[ze],Pe);const Ye=pn([],Me[re],Me[(re+1)%4]);on(Ye,Ye,.5),bc(Ie,Ye,Pe)}for(const Me of v)sn(A,A,Me),Tn(S,S,Me);return A[2]=Math.min(le[2],we[2]),sn(A,A,Ie),Tn(S,S,Ie),new Qt(A,S)}function ux({x:s,y:e,z:r},l=!1){const u=1/(1<<r),p=new G(ve(s*u),e===(1<<r)-1&&l?-90:_e((e+1)*u)),m=new G(ve((s+1)*u),e===0&&l?90:_e(e*u));return new J(p,m)}function eb(s,e=h){const r=De(s.getNorth()),l=De(s.getSouth()),u=Math.cos(r),p=Math.cos(l),m=Math.sin(r),v=Math.sin(l),b=s.getWest(),S=s.getEast();return[F(p,v,b,e),F(p,v,S,e),F(u,m,S,e),F(u,m,b,e)]}function $g(s,e,r,l){const u=1<<r.z,p=(s/vt+r.x)/u;return D(_e((e/vt+r.y)/u),ve(p),l)}function hx({min:s,max:e}){return x/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const hA=new Float64Array(16);function dx(s){const e=hx(s),r=nt(hA,[e,e,e]);return Q(r,r,Qr([],s.min))}function tb(s){const e=(l=s.min,(r=hA)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=l[0],r[13]=l[1],r[14]=l[2],r[15]=1,r);var r,l;const u=1/hx(s);return ae(e,e,[u,u,u])}function nb(s){const e=vt/(2*Math.PI);return s/(2*Math.PI)/e}function dA(s,e){return vt/(512*Math.pow(2,s))*hx(Cl(e))}function fA(s,e,r,l,u){const p=nb(r),m=[s,e,-r/(2*Math.PI)],v=K(new Float64Array(16));return Q(v,v,m),ae(v,v,[p,p,p]),Te(v,v,De(-u)),Be(v,v,De(-l)),v}function bu(s){return $e(g,y,s)}function pA(s,e){const r=D(e.lat,e.lng),l=function(O){const $=D(O._center.lat,O._center.lng);let W=ci([],Ht(0,1,0),$);const q=Je([],-O.angle,$);W=ui(W,W,q),Je(q,-O._pitch,W);const ie=Vn([],$);return on(ie,ie,cx(O.cameraToCenterDistance/O.pixelsPerMeter)),ui(ie,ie,q),pn([],$,ie)}(s);return m=(u=Rn([],l,r))[0],v=u[1],b=u[2],S=(p=r)[0],A=p[1],C=p[2],z=(M=Math.sqrt((m*m+v*v+b*b)*(S*S+A*A+C*C)))&&Wn(u,p)/M,Math.acos(Math.min(Math.max(z,-1),1));var u,p,m,v,b,S,A,C,M,z}function ib(s,e){return pA(s,e)>Math.PI/2*1.01}const mA=De(85),m5=Math.cos(mA),g5=Math.sin(mA),_5=ce(),gA=s=>{const e=[];return s.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function _A(s,e,r,l,u,p,m,v,b){if(p&&s.queryGeometry.isAboveHorizon)return!1;p&&(b*=s.pixelToTileUnitsFactor);const S=s.tileID.canonical,A=r.projection.upVectorScale(S,r.center.lat,r.worldSize).metersToTile;for(const C of e)for(const M of C){const z=M.add(v),O=u&&r.elevation?r.elevation.exaggeration()*u.getElevationAt(z.x,z.y,!0):0,$=r.projection.projectTilePoint(z.x,z.y,S);if(O>0){const re=r.projection.upVector(S,z.x,z.y);$.x+=re[0]*A*O,$.y+=re[1]*A*O,$.z+=re[2]*A*O}const W=p?z:y5($.x,$.y,$.z,l),q=p?s.tilespaceRays.map(re=>x5(re,O)):s.queryGeometry.screenGeometry,ie=Nr([],[$.x,$.y,$.z,1],l);if(!m&&p?b*=ie[3]/r.cameraToCenterDistance:m&&!p&&(b*=r.cameraToCenterDistance/ie[3]),p){const re=_e((M.y/vt+S.y)/(1<<S.z));b/=r.projection.pixelsPerMeter(re,1)/ge(1,re)}if(mo(q,W,b))return!0}return!1}function y5(s,e,r,l){const u=Nr([],[s,e,r,1],l);return new ct(u[0]/u[3],u[1]/u[3])}const yA=Ht(0,0,0),v5=Ht(0,0,1);function x5(s,e){const r=xt();return yA[2]=e,s.intersectsPlane(yA,v5,r),new ct(r[0],r[1])}class vA extends Br{}let xA,wA,bA,TA;function SA(s,{width:e,height:r},l,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*l)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*r*l);return s.width=e,s.height=r,s.data=u,s}function EA(s,e,r){const{width:l,height:u}=e;l===s.width&&u===s.height||(rb(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,l),height:Math.min(s.height,u)},r,null),s.width=l,s.height=u,s.data=e.data)}function rb(s,e,r,l,u,p,m,v){if(u.width===0||u.height===0)return e;if(u.width>s.width||u.height>s.height||r.x>s.width-u.width||r.y>s.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||l.x>e.width-u.width||l.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const b=s.data,S=e.data,A=p===4&&v;for(let C=0;C<u.height;C++){const M=((r.y+C)*s.width+r.x)*p,z=((l.y+C)*e.width+l.x)*p;if(A)for(let O=0;O<u.width;O++){const $=M+O*p+3,W=z+O*p;S[W+0]=255,S[W+1]=255,S[W+2]=255,S[W+3]=b[$]}else if(m)for(let O=0;O<u.width;O++){const $=M+O*p,W=z+O*p,q=new Jn(b[$+0]/255,b[$+1]/255,b[$+2]/255,b[$+3]).toNonPremultipliedRenderColor(m).toArray();S[W+0]=q[0],S[W+1]=q[1],S[W+2]=q[2],S[W+3]=q[3]}else for(let O=0;O<u.width*p;O++)S[z+O]=b[M+O]}return e}Pt(vA,"HeatmapBucket",{omit:["layers"]});class Tu{constructor(e,r){SA(this,e,1,r)}resize(e){EA(this,new Tu(e),1)}clone(){return new Tu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,u,p){rb(e,r,l,u,p,1,null)}}class ns{constructor(e,r){SA(this,e,4,r)}resize(e){EA(this,new ns(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ns({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,u,p,m,v){rb(e,r,l,u,p,4,m,v)}}class IA{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function Hg(s){const e={},r=s.resolution||256,l=s.clips?s.clips.length:1,u=s.image||new ns({width:r,height:l}),p=(m,v,b)=>{e[s.evaluationKey]=b;const S=s.expression.evaluate(e),A=S?S.toNonPremultipliedRenderColor(null):null;A&&(u.data[m+v+0]=Math.floor(255*A.r),u.data[m+v+1]=Math.floor(255*A.g),u.data[m+v+2]=Math.floor(255*A.b),u.data[m+v+3]=Math.floor(255*A.a))};if(s.clips)for(let m=0,v=0;m<l;++m,v+=4*r)for(let b=0,S=0;b<r;b++,S+=4){const A=b/(r-1),{start:C,end:M}=s.clips[m];p(v,S,C*(1-A)+M*A)}else for(let m=0,v=0;m<r;m++,v+=4)p(0,v,m/(r-1));return u}Pt(Tu,"AlphaImage"),Pt(ns,"RGBAImage");const w5=zn([{name:"a_pos",components:2,type:"Int16"}],4),b5=zn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),T5=zn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),S5=zn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function rp(s,e,r=2){const l=e&&e.length,u=l?e[0]*r:s.length;let p=AA(s,0,u,r,!0);const m=[];if(!p||p.next===p.prev)return m;let v,b,S;if(l&&(p=function(A,C,M,z){const O=[];for(let $=0,W=C.length;$<W;$++){const q=AA(A,C[$]*z,$<W-1?C[$+1]*z:A.length,z,!1);q===q.next&&(q.steiner=!0),O.push(k5(q))}O.sort(P5);for(let $=0;$<O.length;$++)M=M5(O[$],M);return M}(s,e,p,r)),s.length>80*r){v=s[0],b=s[1];let A=v,C=b;for(let M=r;M<u;M+=r){const z=s[M],O=s[M+1];z<v&&(v=z),O<b&&(b=O),z>A&&(A=z),O>C&&(C=O)}S=Math.max(A-v,C-b),S=S!==0?32767/S:0}return Wg(p,m,r,v,b,S,0),m}function AA(s,e,r,l,u){let p;if(u===function(m,v,b,S){let A=0;for(let C=v,M=b-S;C<b;C+=S)A+=(m[M]-m[C])*(m[C+1]+m[M+1]),M=C;return A}(s,e,r,l)>0)for(let m=e;m<r;m+=l)p=RA(m/l|0,s[m],s[m+1],p);else for(let m=r-l;m>=e;m-=l)p=RA(m/l|0,s[m],s[m+1],p);return p&&sp(p,p.next)&&(Xg(p),p=p.next),p}function td(s,e){if(!s)return s;e||(e=s);let r,l=s;do if(r=!1,l.steiner||!sp(l,l.next)&&kr(l.prev,l,l.next)!==0)l=l.next;else{if(Xg(l),l=e=l.prev,l===l.next)break;r=!0}while(r||l!==e);return e}function Wg(s,e,r,l,u,p,m){if(!s)return;!m&&p&&function(b,S,A,C){let M=b;do M.z===0&&(M.z=sb(M.x,M.y,S,A,C)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==b);M.prevZ.nextZ=null,M.prevZ=null,function(z){let O,$=1;do{let W,q=z;z=null;let ie=null;for(O=0;q;){O++;let re=q,le=0;for(let be=0;be<$&&(le++,re=re.nextZ,re);be++);let we=$;for(;le>0||we>0&&re;)le!==0&&(we===0||!re||q.z<=re.z)?(W=q,q=q.nextZ,le--):(W=re,re=re.nextZ,we--),ie?ie.nextZ=W:z=W,W.prevZ=ie,ie=W;q=re}ie.nextZ=null,$*=2}while(O>1)}(M)}(s,l,u,p);let v=s;for(;s.prev!==s.next;){const b=s.prev,S=s.next;if(p?I5(s,l,u,p):E5(s))e.push(b.i,s.i,S.i),Xg(s),s=S.next,v=S.next;else if((s=S)===v){m?m===1?Wg(s=A5(td(s),e),e,r,l,u,p,2):m===2&&C5(s,e,r,l,u,p):Wg(td(s),e,r,l,u,p,1);break}}}function E5(s){const e=s.prev,r=s,l=s.next;if(kr(e,r,l)>=0)return!1;const u=e.x,p=r.x,m=l.x,v=e.y,b=r.y,S=l.y,A=Math.min(u,p,m),C=Math.min(v,b,S),M=Math.max(u,p,m),z=Math.max(v,b,S);let O=l.next;for(;O!==e;){if(O.x>=A&&O.x<=M&&O.y>=C&&O.y<=z&&qg(u,v,p,b,m,S,O.x,O.y)&&kr(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function I5(s,e,r,l){const u=s.prev,p=s,m=s.next;if(kr(u,p,m)>=0)return!1;const v=u.x,b=p.x,S=m.x,A=u.y,C=p.y,M=m.y,z=Math.min(v,b,S),O=Math.min(A,C,M),$=Math.max(v,b,S),W=Math.max(A,C,M),q=sb(z,O,e,r,l),ie=sb($,W,e,r,l);let re=s.prevZ,le=s.nextZ;for(;re&&re.z>=q&&le&&le.z<=ie;){if(re.x>=z&&re.x<=$&&re.y>=O&&re.y<=W&&re!==u&&re!==m&&qg(v,A,b,C,S,M,re.x,re.y)&&kr(re.prev,re,re.next)>=0||(re=re.prevZ,le.x>=z&&le.x<=$&&le.y>=O&&le.y<=W&&le!==u&&le!==m&&qg(v,A,b,C,S,M,le.x,le.y)&&kr(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;re&&re.z>=q;){if(re.x>=z&&re.x<=$&&re.y>=O&&re.y<=W&&re!==u&&re!==m&&qg(v,A,b,C,S,M,re.x,re.y)&&kr(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;le&&le.z<=ie;){if(le.x>=z&&le.x<=$&&le.y>=O&&le.y<=W&&le!==u&&le!==m&&qg(v,A,b,C,S,M,le.x,le.y)&&kr(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function A5(s,e){let r=s;do{const l=r.prev,u=r.next.next;!sp(l,u)&&PA(l,r,r.next,u)&&Zg(l,u)&&Zg(u,l)&&(e.push(l.i,r.i,u.i),Xg(r),Xg(r.next),r=s=u),r=r.next}while(r!==s);return td(r)}function C5(s,e,r,l,u,p){let m=s;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&D5(m,v)){let b=MA(m,v);return m=td(m,m.next),b=td(b,b.next),Wg(m,e,r,l,u,p,0),void Wg(b,e,r,l,u,p,0)}v=v.next}m=m.next}while(m!==s)}function P5(s,e){let r=s.x-e.x;return r===0&&(r=s.y-e.y,r===0)&&(r=(s.next.y-s.y)/(s.next.x-s.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function M5(s,e){const r=function(u,p){let m=p;const v=u.x,b=u.y;let S,A=-1/0;if(sp(u,m))return m;do{if(sp(u,m.next))return m.next;if(b<=m.y&&b>=m.next.y&&m.next.y!==m.y){const $=m.x+(b-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if($<=v&&$>A&&(A=$,S=m.x<m.next.x?m:m.next,$===v))return S}m=m.next}while(m!==p);if(!S)return null;const C=S,M=S.x,z=S.y;let O=1/0;m=S;do{if(v>=m.x&&m.x>=M&&v!==m.x&&CA(b<z?v:A,b,M,z,b<z?A:v,b,m.x,m.y)){const $=Math.abs(b-m.y)/(v-m.x);Zg(m,u)&&($<O||$===O&&(m.x>S.x||m.x===S.x&&R5(S,m)))&&(S=m,O=$)}m=m.next}while(m!==C);return S}(s,e);if(!r)return e;const l=MA(r,s);return td(l,l.next),td(r,r.next)}function R5(s,e){return kr(s.prev,s,e.prev)<0&&kr(e.next,s,s.next)<0}function sb(s,e,r,l,u){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-r)*u|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function k5(s){let e=s,r=s;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==s);return r}function CA(s,e,r,l,u,p,m,v){return(u-m)*(e-v)>=(s-m)*(p-v)&&(s-m)*(l-v)>=(r-m)*(e-v)&&(r-m)*(p-v)>=(u-m)*(l-v)}function qg(s,e,r,l,u,p,m,v){return!(s===m&&e===v)&&CA(s,e,r,l,u,p,m,v)}function D5(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(r,l){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==l.i&&u.next.i!==l.i&&PA(u,u.next,r,l))return!0;u=u.next}while(u!==r);return!1}(s,e)&&(Zg(s,e)&&Zg(e,s)&&function(r,l){let u=r,p=!1;const m=(r.x+l.x)/2,v=(r.y+l.y)/2;do u.y>v!=u.next.y>v&&u.next.y!==u.y&&m<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==r);return p}(s,e)&&(kr(s.prev,s,e.prev)||kr(s,e.prev,e))||sp(s,e)&&kr(s.prev,s,s.next)>0&&kr(e.prev,e,e.next)>0)}function kr(s,e,r){return(e.y-s.y)*(r.x-e.x)-(e.x-s.x)*(r.y-e.y)}function sp(s,e){return s.x===e.x&&s.y===e.y}function PA(s,e,r,l){const u=px(kr(s,e,r)),p=px(kr(s,e,l)),m=px(kr(r,l,s)),v=px(kr(r,l,e));return u!==p&&m!==v||!(u!==0||!fx(s,r,e))||!(p!==0||!fx(s,l,e))||!(m!==0||!fx(r,s,l))||!(v!==0||!fx(r,e,l))}function fx(s,e,r){return e.x<=Math.max(s.x,r.x)&&e.x>=Math.min(s.x,r.x)&&e.y<=Math.max(s.y,r.y)&&e.y>=Math.min(s.y,r.y)}function px(s){return s>0?1:s<0?-1:0}function Zg(s,e){return kr(s.prev,s,s.next)<0?kr(s,e,s.next)>=0&&kr(s,s.prev,e)>=0:kr(s,e,s.prev)<0||kr(s,s.next,e)<0}function MA(s,e){const r=ob(s.i,s.x,s.y),l=ob(e.i,e.x,e.y),u=s.next,p=e.prev;return s.next=e,e.prev=s,r.next=u,u.prev=r,l.next=r,r.prev=l,p.next=l,l.prev=p,l}function RA(s,e,r,l){const u=ob(s,e,r);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function Xg(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function ob(s,e,r){return{i:s,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Kg(s,e){const r=s.length;if(r<=1)return[s];const l=[];let u,p;for(let m=0;m<r;m++){const v=cr(s[m]);v!==0&&(s[m].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(u&&l.push(u),u=[s[m]]):u.push(s[m]))}if(u&&l.push(u),e>1)for(let m=0;m<l.length;m++)l[m].length<=e||(gv(l[m],e,1,l[m].length-1,L5),l[m]=l[m].slice(0,e));return l}function L5(s,e){return e.area-s.area}function kA(s,e,r=1){if(!s)return null;const l=typeof s=="string"?Ps.from(s).getPrimary():s.getPrimary(),u=typeof s=="string"?null:s.getSecondary();for(const p of[l,u]){if(!p)continue;const m=p.id.toString();e.has(m)||e.set(m,[]),p.scaleSelf(r),e.get(m).push(p)}return{primary:l.toString(),secondary:u?u.toString():null}}function ab(s,e,r,l){const u=l.patternDependencies;let p=!1;for(const m of e){const v=m.paint.get(`${s}-pattern`);v.isConstant()||(p=!0),kA(v.constantOr(null),u,r)&&(p=!0)}return p}function lb(s,e,r,l,u,p){const m=p.patternDependencies;for(const v of e){const b=v.paint.get(`${s}-pattern`).value;if(b.kind!=="constant"){let S=b.evaluate({zoom:l},r,{},p.availableImages);S=S&&S.name?S.name:S;const A=kA(S,m,u);if(!A)continue;const{primary:C,secondary:M}=A;C&&(r.patterns[v.id]=[C,M].filter(Boolean))}}return r}class DA{constructor(){this.polygons=new Map}add(e,...r){const l=this.polygons.get(e);l?l.push(...r):this.polygons.set(e,r)}merge(e){for(const[r,l]of e.polygons)this.add(r,...l)}}class Tc{constructor(){this.portals=[]}static isOnBorder(e,r){return e<=0&&r<=0||e>=vt&&r>=vt}static evaluate(e){if(e.length===0)return new Tc;let r=[];for(const b of e)r.push(...b.portals);if(r.length===0)return new Tc;for(const b of r){const S=b.va,A=b.vb;(Tc.isOnBorder(S.x,A.x)||Tc.isOnBorder(S.y,A.y))&&(b.type="border")}const l=r.filter(b=>b.type!=="unevaluated"),u=r.filter(b=>b.type==="unevaluated");if(u.length===0)return new Tc;u.sort((b,S)=>b.hash===S.hash?b.isTunnel===S.isTunnel?0:b.isTunnel?-1:1:b.hash<S.hash?1:-1),r=l.concat(u);let p=l.length,m=p,v=p;do if(m++,m===r.length||r[p].hash!==r[m].hash){if(m-p==2){v<p&&(r[v]=r[p],r[p]=null);const b=r[v],S=r[m-1];b.type=b.isTunnel!==S.isTunnel?"tunnel":"polygon",b.connection={a:b.connection.a,b:S.connection.a},v++}p=m}while(p!==r.length);return r.splice(v),r.sort((b,S)=>b.hash<S.hash?1:-1),{portals:r}}}Pt(Tc,"ElevationPortalGraph"),Pt(DA,"ElevationPolygons");class z5{constructor(e,r,l){this.outPositions=e,this.outNormals=r,this.outIndices=l,this.vertexLookup=new Map}addVertex(e,r,l){let u=e[2];l!=null&&(u*=l);const p=`${e[0]},${e[1]},${e[2]},${r[0]},${r[1]},${r[2]}`,m=this.vertexLookup.get(p);if(m!=null)return m;const v=this.outPositions.length;this.vertexLookup.set(p,v);const b=Math.trunc(16384*r[0]),S=Math.trunc(16384*r[1]),A=Math.trunc(16384*r[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(b,S,A),v}addTriangle(e,r,l){this.outIndices.emplaceBack(e,r,l)}addTriangles(e,r,l){if(e.length===0)return;const u=l.length===1,p=xt(),m=xt();for(let v=0;v<e.length;v+=3){const b=r[e[v+0]],S=r[e[v+1]],A=r[e[v+2]],C=u?l[0]:l[e[v+1]],M=u?l[0]:l[e[v+2]];cn(p,b.x,b.y,u?l[0]:l[e[v+0]]);const z=this.addVertex(p,m);cn(p,S.x,S.y,C);const O=this.addVertex(p,m);cn(p,A.x,A.y,M);const $=this.addVertex(p,m);this.outIndices.emplaceBack(z,O,$)}}addQuad(e,r,l,u,p,m){const v=this.addVertex(e,p,m),b=this.addVertex(r,p,m),S=this.addVertex(l,p,m),A=this.addVertex(u,p,m);this.addTriangle(v,b,S),this.addTriangle(S,A,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class go{constructor(e,r,l,u){this.unevaluatedPortals=new Tc,this.portalPolygons=new DA,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Rg,this.vertexNormals=new Hf,this.indexArray=new xr,this.tileToMeters=Oe(e),this.bridgeProgramConfigurations=new Ho(r,{zoom:l,lut:u},p=>p!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Ho(r,{zoom:l,lut:u},p=>p!=="fill-bridge-guard-rail-color")}addVertices(e,r){const l=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(r[u]);return l}addTriangles(e,r,l){const u=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of e)u.push(p+r)}addRenderableRing(e,r,l,u,p,m){const v=[new ct(p.min.x,p.min.y),new ct(p.max.x,p.min.y),new ct(p.max.x,p.max.y),new ct(p.min.x,p.max.y)];for(let b=0;b<l-1;b++){const S=r+b,A=S+1,C=this.unevalVertices[S],M=this.unevalVertices[A];if(!(C.x>=p.min.x&&C.x<=p.max.x&&C.y>=p.min.y&&C.y<=p.max.y||M.x>=p.min.x&&M.x<=p.max.x&&M.y>=p.min.y&&M.y<=p.max.y||ts(C,M,v))||this.isOnBorder(C.x,M.x)||this.isOnBorder(C.y,M.y))continue;const z=go.computeEdgeHash(this.unevalVertices[S],this.unevalVertices[A]);let O,$=this.vertexHashLookup.get(go.computePosHash(C));$!=null?O=$.next:($=this.vertexHashLookup.get(go.computePosHash(M)),O=$!=null?$.prev:z),this.unevalEdges.push({polygonIdx:e,a:S,b:A,hash:z,portalHash:O,isTunnel:u,type:"unevaluated",featureInfo:m})}}addPortalCandidates(e,r,l,u,p){if(r.length===0)return;this.portalPolygons.add(e,{geometry:r,zLevel:p});const m=r[0];this.vertexHashLookup.clear();let v=go.computeEdgeHash(m[m.length-2],m[m.length-1]);for(let b=0;b<m.length-1;b++){const S=m[b+0],A=m[b+1],C=Cs(A.x-S.x,A.y-S.y),M=Pa(C);if(M===0)continue;let z="unevaluated";const O=u.pointElevation(S),$=u.pointElevation(A);Math.abs(O)<.01&&Math.abs($)<.01?z="entrance":(this.isOnBorder(S.x,A.x)||this.isOnBorder(S.y,A.y))&&(z="border");const W=go.computeEdgeHash(S,A);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:S,vb:A,vab:C,length:M,hash:W,isTunnel:l,type:z});const q=go.computePosHash(S);this.vertexHashLookup.set(q,{prev:v,next:W}),v=W}}construct(e){if(this.unevalVertices.length===0)return;const r=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=M=>{M.primitiveLength=this.indexArray.length-M.primitiveOffset},u=new z5(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const p=r(),m=r(),v=r(),b=(M,z)=>{M.sort(($,W)=>$.type===z&&W.type!==z?-1:$.type!==z&&W.type===z?1:0);const O=M.findIndex($=>$.type!==z);return O>=0?O:M.length};let S=0;this.unevalEdges.length>0&&(S=b(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},this.tileToMeters)),l(v);const A=r(),C=r();if(this.unevalEdges.length>0){const M=this.unevalEdges.splice(S),z=b(M,"tunnel")+S;this.unevalEdges.push(...M),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},{min:S,max:z})}l(A),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(C),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(m),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(p),this.maskSegments=Oi.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.depthSegments=Oi.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength),this.renderableBridgeSegments=Oi.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=Oi.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.shadowCasterSegments=Oi.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}update(e,r,l,u,p,m,v,b){this.bridgeProgramConfigurations.updatePaintArrays(e,r,p,l,u,m,v,b),this.tunnelProgramConfigurations.updatePaintArrays(e,r,p,l,u,m,v,b)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,T5.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,S5.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,r,l,u,p){const m=(v,b)=>{for(let S=0;S<b.length-1;S++){const A=b[S].featureIndex,C=b[S+1].vertexStart,M=e.feature(A);v.populatePaintArrays(C,M,A,{},l,r,u,void 0,p)}};m(this.bridgeProgramConfigurations,this.bridgeFeatureSections),m(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,r,l,u,p){const m=new Map;for(let v=u;v<p;v++){const b=l[v],S=b.a,A=b.b,C=go.computePosHash(e[S]),M=go.computePosHash(e[A]);let z=m.get(C);z||(z={},m.set(C,z));let O=m.get(M);O||(O={},m.set(M,O)),r[S]<=0&&r[A]<=0||(z.to=A,O.from=S)}return m}isTerminalVertex(e,r){const l=go.computePosHash(this.unevalVertices[e]),u=r.get(l);return!u||!u.from||!u.to}constructBridgeStructures(e,r,l,u,p,m){e.clearVertexLookup();const v=this.computeVertexConnections(r,l,u,p.min,p.max),b=1/m,S=.5*b,A=(rt,dt)=>cn(rt,r[dt].x,r[dt].y,l[dt]*b),C=xt(),M=xt(),z=xt(),O=xt(),$=xt(),W=(rt,dt)=>{const Xe=v.get(go.computePosHash(r[dt])),ot=Xe.from,Ge=Xe.to;if(!ot||!Ge)return;A(C,ot),A(M,dt),A(z,Ge),ji(O),Li(C,M)||(ii($,M,C),Vn(O,$)),Li(z,M)||(ii($,z,M),pn(O,O,Vn($,$)));const je=es(O);return je>0?on(rt,O,1/je):void 0};let q=Number.POSITIVE_INFINITY;this.sortSubarray(u,p.min,p.max,(rt,dt)=>rt.featureInfo.featureIndex-dt.featureInfo.featureIndex);const ie=xt(),re=xt(),le=xt(),we=xt(),be=xt(),Ie=xt(),Pe=xt(),Me=xt(),Ye=xt(),ze=[xt(),xt(),xt(),xt()],Qe=[xt(),xt(),xt(),xt()],lt=[{coord:new ct(0,0),height:0},{coord:new ct(0,0),height:0}],tt=(rt,dt)=>rt>dt;for(let rt=p.min;rt<p.max;rt++){const dt=u[rt];if(!dt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(lt,r,l,dt,tt))continue;const[Xe,ot]=lt;if(cn(ie,Xe.coord.x,Xe.coord.y,b*Xe.height),cn(re,ot.coord.x,ot.coord.y,b*ot.height),Li(ie,re))continue;ii(le,re,ie),Vn(le,le);const Ge=W(Me,dt.a)||le,je=W(Ye,dt.b)||le;cn(we,Ge[1],-Ge[0],0),Vn(we,we),cn(be,je[1],-je[0],0),Vn(be,be),ci(Me,we,Ge),Vn(Ie,Me),ci(Me,be,je),Vn(Pe,Me),pn(ze[0],ie,on(Me,ii(Me,we,Ie),S)),pn(ze[1],ie,on(Me,pn(Me,we,Ie),S)),pn(ze[2],ie,on(Me,Ie,S)),ze[3]=ie,pn(Qe[0],re,on(Me,ii(Me,be,Pe),S)),pn(Qe[1],re,on(Me,pn(Me,be,Pe),S)),pn(Qe[2],re,on(Me,Pe,S)),Qe[3]=re,q=this.addFeatureSection(dt.featureInfo.featureIndex,q,this.bridgeFeatureSections,e);const ft=e.addVertex(ze[0],we,m),ut=e.addVertex(ze[1],we,m),Gt=e.addVertex(Qe[0],be,m),At=e.addVertex(Qe[1],be,m);e.addTriangle(ft,ut,Gt),e.addTriangle(ut,At,Gt);const Lt=e.addVertex(ze[1],Ie,m),yt=e.addVertex(ze[2],Ie,m),Vt=e.addVertex(Qe[1],Pe,m),an=e.addVertex(Qe[2],Pe,m);e.addTriangle(Lt,yt,Vt),e.addTriangle(yt,an,Vt),Qr(we,we),Qr(be,be);const St=e.addVertex(ze[2],we,m),Ft=e.addVertex(ze[3],we,m),Yt=e.addVertex(Qe[2],be,m),dn=e.addVertex(Qe[3],be,m);e.addTriangle(St,Ft,Yt),e.addTriangle(Ft,dn,Yt);const En=this.isTerminalVertex(dt.a,v),mn=this.isTerminalVertex(dt.b,v);Xe.height<.01&&En&&e.addQuad(ze[3],ze[2],ze[1],ze[0],Qr(Ge,Ge),m),ot.height<.01&&mn&&e.addQuad(Qe[0],Qe[1],Qe[2],Qe[3],je,m)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,r,l,u,p,m){e.clearVertexLookup();let v=Number.POSITIVE_INFINITY;const b=(q,ie)=>q.featureInfo.featureIndex-ie.featureInfo.featureIndex;this.sortSubarray(u,p.min,p.max,b),this.sortSubarray(u,m.min,m.max,b);const S=q=>Vn(q,q),A=[{coord:new ct(0,0),height:0},{coord:new ct(0,0),height:0}],C=(q,ie)=>q<ie,M=xt(),z=xt(),O=xt(),$=xt(),W=xt();for(let q=p.min;q<p.max;q++){if(!this.prepareEdgePoints(A,r,l,u[q],C))continue;const[ie,re]=A,le=S(cn(W,-(re.coord.y-ie.coord.y),re.coord.x-ie.coord.x,0));v=this.addFeatureSection(u[q].featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(cn(M,ie.coord.x,ie.coord.y,ie.height),cn(z,re.coord.x,re.coord.y,re.height),cn(O,re.coord.x,re.coord.y,u[q].isTunnel?-.1:0),cn($,ie.coord.x,ie.coord.y,u[q].isTunnel?-.1:0),le)}for(let q=m.min;q<m.max;q++){const ie=u[q];ie.isTunnel&&([ie.a,ie.b]=[ie.b,ie.a]);const re=r[ie.a],le=r[ie.b],we=S(cn(W,-(le.y-re.y),le.x-re.x,0));v=this.addFeatureSection(ie.featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(cn(M,le.x,le.y,0),cn(z,re.x,re.y,0),cn(O,re.x,re.y,l[ie.a]+4),cn($,le.x,le.y,l[ie.b]+4),we),e.addQuad(cn(M,re.x,re.y,0),cn(z,le.x,le.y,0),cn(O,le.x,le.y,l[ie.b]+4),cn($,re.x,re.y,l[ie.a]+4),we)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,r,l,u){e.coord.x=r,e.coord.y=l,e.height=u}prepareEdgePoints(e,r,l,u,p){let m=r[u.a].x,v=r[u.a].y,b=r[u.b].x,S=r[u.b].y,A=l[u.a],C=l[u.b];const M=p(A,0),z=p(C,0);if(M&&z)return this.setElevatedPoint(e[0],m,v,A),this.setElevatedPoint(e[1],b,S,C),!0;if(!M&&!z)return!1;if(M){if(!z){const O=C/(C-A);b=Kt(b,m,O),S=Kt(S,v,O),C=Kt(C,A,O)}}else{const O=A/(A-C);m=Kt(m,b,O),v=Kt(v,S,O),A=Kt(A,C,O)}return this.setElevatedPoint(e[0],m,v,A),this.setElevatedPoint(e[1],b,S,C),!0}prepareEdges(e,r){if(r.length===0)return;r.sort((v,b)=>v.hash===b.hash?b.polygonIdx-v.polygonIdx:b.hash>v.hash?1:-1);let l=0,u=0,p=0,m=r[l].polygonIdx;do u++,(u===r.length||r[l].hash!==r[u].hash)&&((u-l==1||r[u-1].polygonIdx!==m)&&(p<l&&(r[p]=r[l],r[l]=null),r[p].type="none",p++),l=u,l!==r.length&&(m=r[l].polygonIdx));while(l!==r.length);if(r.splice(p),r.length!==0&&e.length!==0){r.sort((S,A)=>S.portalHash<A.portalHash?1:-1);let v=0,b=0;for(;v!==r.length&&b!==e.length;){const S=r[v],A=e[b];S.portalHash>A.hash?v++:A.hash>S.portalHash?b++:(S.type=A.type,v++)}}}isOnBorder(e,r){return e<=0&&r<=0||e>=vt&&r>=vt}addFeatureSection(e,r,l,u){return e!==r&&(r=e,l.push({featureIndex:e,vertexStart:u.getVertexCount()}),u.clearVertexLookup()),r}sortSubarray(e,r,l,u){const p=e.slice(r,l);p.sort(u),e.splice(r,p.length,...p)}static computeEdgeHash(e,r){return(e.y===r.y&&e.x>r.x||e.y>r.y)&&([e,r]=[r,e]),BigInt(go.computePosHash(e))<<32n|BigInt(go.computePosHash(r))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var LA,zA={exports:{}},OA=(LA||(LA=1,function(s,e){(function(r){function l(he,de){return he>de?1:he<de?-1:0}var u=function(he,de){he===void 0&&(he=l),de===void 0&&(de=!1),this._compare=he,this._root=null,this._size=0,this._noDuplicates=!!de},p={size:{configurable:!0}};function m(he,de,Ue,Ke,Tt){var bt=Tt-Ke;if(bt>0){var Rt=Ke+Math.floor(bt/2),Wt={key:de[Rt],data:Ue[Rt],parent:he};return Wt.left=m(Wt,de,Ue,Ke,Rt),Wt.right=m(Wt,de,Ue,Rt+1,Tt),Wt}return null}function v(he,de,Ue,Ke,Tt){if(!(Ue>=Ke)){for(var bt=he[Ue+Ke>>1],Rt=Ue-1,Wt=Ke+1;;){do Rt++;while(Tt(he[Rt],bt)<0);do Wt--;while(Tt(he[Wt],bt)>0);if(Rt>=Wt)break;var In=he[Rt];he[Rt]=he[Wt],he[Wt]=In,In=de[Rt],de[Rt]=de[Wt],de[Wt]=In}v(he,de,Ue,Wt,Tt),v(he,de,Wt+1,Ke,Tt)}}u.prototype.rotateLeft=function(he){var de=he.right;de&&(he.right=de.left,de.left&&(de.left.parent=he),de.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=de:he.parent.right=de:this._root=de,de&&(de.left=he),he.parent=de},u.prototype.rotateRight=function(he){var de=he.left;de&&(he.left=de.right,de.right&&(de.right.parent=he),de.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=de:he.parent.right=de:this._root=de,de&&(de.right=he),he.parent=de},u.prototype._splay=function(he){for(;he.parent;){var de=he.parent;de.parent?de.left===he&&de.parent.left===de?(this.rotateRight(de.parent),this.rotateRight(de)):de.right===he&&de.parent.right===de?(this.rotateLeft(de.parent),this.rotateLeft(de)):de.left===he&&de.parent.right===de?(this.rotateRight(de),this.rotateLeft(de)):(this.rotateLeft(de),this.rotateRight(de)):de.left===he?this.rotateRight(de):this.rotateLeft(de)}},u.prototype.splay=function(he){for(var de,Ue,Ke,Tt,bt;he.parent;)(Ue=(de=he.parent).parent)&&Ue.parent?((Ke=Ue.parent).left===Ue?Ke.left=he:Ke.right=he,he.parent=Ke):(he.parent=null,this._root=he),Tt=he.left,bt=he.right,he===de.left?(Ue&&(Ue.left===de?(de.right?(Ue.left=de.right,Ue.left.parent=Ue):Ue.left=null,de.right=Ue,Ue.parent=de):(Tt?(Ue.right=Tt,Tt.parent=Ue):Ue.right=null,he.left=Ue,Ue.parent=he)),bt?(de.left=bt,bt.parent=de):de.left=null,he.right=de,de.parent=he):(Ue&&(Ue.right===de?(de.left?(Ue.right=de.left,Ue.right.parent=Ue):Ue.right=null,de.left=Ue,Ue.parent=de):(bt?(Ue.left=bt,bt.parent=Ue):Ue.left=null,he.right=Ue,Ue.parent=he)),Tt?(de.right=Tt,Tt.parent=de):de.right=null,he.left=de,de.parent=he)},u.prototype.replace=function(he,de){he.parent?he===he.parent.left?he.parent.left=de:he.parent.right=de:this._root=de,de&&(de.parent=he.parent)},u.prototype.minNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.left;)he=he.left;return he},u.prototype.maxNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.right;)he=he.right;return he},u.prototype.insert=function(he,de){var Ue=this._root,Ke=null,Tt=this._compare;if(this._noDuplicates)for(;Ue;){if(Ke=Ue,Tt(Ue.key,he)===0)return;Ue=Tt(Ue.key,he)<0?Ue.right:Ue.left}else for(;Ue;)Ke=Ue,Ue=Tt(Ue.key,he)<0?Ue.right:Ue.left;return Ue={key:he,data:de,left:null,right:null,parent:Ke},Ke?Tt(Ke.key,Ue.key)<0?Ke.right=Ue:Ke.left=Ue:this._root=Ue,this.splay(Ue),this._size++,Ue},u.prototype.find=function(he){for(var de=this._root,Ue=this._compare;de;){var Ke=Ue(de.key,he);if(Ke<0)de=de.right;else{if(!(Ke>0))return de;de=de.left}}return null},u.prototype.contains=function(he){for(var de=this._root,Ue=this._compare;de;){var Ke=Ue(he,de.key);if(Ke===0)return!0;de=Ke<0?de.left:de.right}return!1},u.prototype.remove=function(he){var de=this.find(he);if(!de)return!1;if(this.splay(de),de.left)if(de.right){var Ue=this.minNode(de.right);Ue.parent!==de&&(this.replace(Ue,Ue.right),Ue.right=de.right,Ue.right.parent=Ue),this.replace(de,Ue),Ue.left=de.left,Ue.left.parent=Ue}else this.replace(de,de.left);else this.replace(de,de.right);return this._size--,!0},u.prototype.removeNode=function(he){if(!he)return!1;if(this.splay(he),he.left)if(he.right){var de=this.minNode(he.right);de.parent!==he&&(this.replace(de,de.right),de.right=he.right,de.right.parent=de),this.replace(he,de),de.left=he.left,de.left.parent=de}else this.replace(he,he.left);else this.replace(he,he.right);return this._size--,!0},u.prototype.erase=function(he){var de=this.find(he);if(de){this.splay(de);var Ue=de.left,Ke=de.right,Tt=null;Ue&&(Ue.parent=null,Tt=this.maxNode(Ue),this.splay(Tt),this._root=Tt),Ke&&(Ue?Tt.right=Ke:this._root=Ke,Ke.parent=Tt),this._size--}},u.prototype.pop=function(){var he=this._root,de=null;if(he){for(;he.left;)he=he.left;de={key:he.key,data:he.data},this.remove(he.key)}return de},u.prototype.next=function(he){var de=he;if(de)if(de.right)for(de=de.right;de&&de.left;)de=de.left;else for(de=he.parent;de&&de.right===he;)he=de,de=de.parent;return de},u.prototype.prev=function(he){var de=he;if(de)if(de.left)for(de=de.left;de&&de.right;)de=de.right;else for(de=he.parent;de&&de.left===he;)he=de,de=de.parent;return de},u.prototype.forEach=function(he){for(var de=this._root,Ue=[],Ke=!1,Tt=0;!Ke;)de?(Ue.push(de),de=de.left):Ue.length>0?(he(de=Ue.pop(),Tt++),de=de.right):Ke=!0;return this},u.prototype.range=function(he,de,Ue,Ke){for(var Tt=[],bt=this._compare,Rt=this._root;Tt.length!==0||Rt;)if(Rt)Tt.push(Rt),Rt=Rt.left;else{if(bt((Rt=Tt.pop()).key,de)>0)break;if(bt(Rt.key,he)>=0&&Ue.call(Ke,Rt))return this;Rt=Rt.right}return this},u.prototype.keys=function(){for(var he=this._root,de=[],Ue=[],Ke=!1;!Ke;)he?(de.push(he),he=he.left):de.length>0?(he=de.pop(),Ue.push(he.key),he=he.right):Ke=!0;return Ue},u.prototype.values=function(){for(var he=this._root,de=[],Ue=[],Ke=!1;!Ke;)he?(de.push(he),he=he.left):de.length>0?(he=de.pop(),Ue.push(he.data),he=he.right):Ke=!0;return Ue},u.prototype.at=function(he){for(var de=this._root,Ue=[],Ke=!1,Tt=0;!Ke;)if(de)Ue.push(de),de=de.left;else if(Ue.length>0){if(de=Ue.pop(),Tt===he)return de;Tt++,de=de.right}else Ke=!0;return null},u.prototype.load=function(he,de,Ue){if(he===void 0&&(he=[]),de===void 0&&(de=[]),Ue===void 0&&(Ue=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Ke=he.length;return Ue&&v(he,de,0,Ke-1,this._compare),this._root=m(null,he,de,0,Ke),this._size=Ke,this},u.prototype.min=function(){var he=this.minNode(this._root);return he?he.key:null},u.prototype.max=function(){var he=this.maxNode(this._root);return he?he.key:null},u.prototype.isEmpty=function(){return this._root===null},p.size.get=function(){return this._size},u.createTree=function(he,de,Ue,Ke,Tt){return new u(Ue,Tt).load(he,de,Ke)},Object.defineProperties(u.prototype,p);var b=0,S=1,A=2,C=3,M=0,z=1,O=2,$=3;function W(he,de,Ue){de===null?(he.inOut=!1,he.otherInOut=!0):(he.isSubject===de.isSubject?(he.inOut=!de.inOut,he.otherInOut=de.otherInOut):(he.inOut=!de.otherInOut,he.otherInOut=de.isVertical()?!de.inOut:de.inOut),de&&(he.prevInResult=!q(de,Ue)||de.isVertical()?de.prevInResult:de));var Ke=q(he,Ue);he.resultTransition=Ke?function(Tt,bt){var Rt,Wt=!Tt.inOut,In=!Tt.otherInOut;switch(bt){case M:Rt=Wt&&In;break;case z:Rt=Wt||In;break;case $:Rt=Wt^In;break;case O:Rt=Tt.isSubject?Wt&&!In:In&&!Wt}return Rt?1:-1}(he,Ue):0}function q(he,de){switch(he.type){case b:switch(de){case M:return!he.otherInOut;case z:return he.otherInOut;case O:return he.isSubject&&he.otherInOut||!he.isSubject&&!he.otherInOut;case $:return!0}break;case A:return de===M||de===z;case C:return de===O;case S:return!1}return!1}var ie=function(he,de,Ue,Ke,Tt){this.left=de,this.point=he,this.otherEvent=Ue,this.isSubject=Ke,this.type=Tt||b,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},re={inResult:{configurable:!0}};function le(he,de){return he[0]===de[0]&&he[1]===de[1]}ie.prototype.isBelow=function(he){var de=this.point,Ue=this.otherEvent.point;return this.left?(de[0]-he[0])*(Ue[1]-he[1])-(Ue[0]-he[0])*(de[1]-he[1])>0:(Ue[0]-he[0])*(de[1]-he[1])-(de[0]-he[0])*(Ue[1]-he[1])>0},ie.prototype.isAbove=function(he){return!this.isBelow(he)},ie.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},re.inResult.get=function(){return this.resultTransition!==0},ie.prototype.clone=function(){var he=new ie(this.point,this.left,this.otherEvent,this.isSubject,this.type);return he.contourId=this.contourId,he.resultTransition=this.resultTransition,he.prevInResult=this.prevInResult,he.isExteriorRing=this.isExteriorRing,he.inOut=this.inOut,he.otherInOut=this.otherInOut,he},Object.defineProperties(ie.prototype,re);var we=11102230246251565e-32,be=134217729,Ie=(3+8*we)*we;function Pe(he,de,Ue,Ke,Tt){var bt,Rt,Wt,In,An=de[0],bn=Ke[0],ni=0,Pi=0;bn>An==bn>-An?(bt=An,An=de[++ni]):(bt=bn,bn=Ke[++Pi]);var wn=0;if(ni<he&&Pi<Ue)for(bn>An==bn>-An?(Wt=bt-((Rt=An+bt)-An),An=de[++ni]):(Wt=bt-((Rt=bn+bt)-bn),bn=Ke[++Pi]),bt=Rt,Wt!==0&&(Tt[wn++]=Wt);ni<he&&Pi<Ue;)bn>An==bn>-An?(Wt=bt-((Rt=bt+An)-(In=Rt-bt))+(An-In),An=de[++ni]):(Wt=bt-((Rt=bt+bn)-(In=Rt-bt))+(bn-In),bn=Ke[++Pi]),bt=Rt,Wt!==0&&(Tt[wn++]=Wt);for(;ni<he;)Wt=bt-((Rt=bt+An)-(In=Rt-bt))+(An-In),An=de[++ni],bt=Rt,Wt!==0&&(Tt[wn++]=Wt);for(;Pi<Ue;)Wt=bt-((Rt=bt+bn)-(In=Rt-bt))+(bn-In),bn=Ke[++Pi],bt=Rt,Wt!==0&&(Tt[wn++]=Wt);return bt===0&&wn!==0||(Tt[wn++]=bt),wn}function Me(he){return new Float64Array(he)}var Ye=33306690738754716e-32,ze=22204460492503146e-32,Qe=11093356479670487e-47,lt=Me(4),tt=Me(8),rt=Me(12),dt=Me(16),Xe=Me(4);function ot(he,de,Ue){var Ke=function(Tt,bt,Rt,Wt,In,An){var bn=(bt-An)*(Rt-In),ni=(Tt-In)*(Wt-An),Pi=bn-ni;if(bn===0||ni===0||bn>0!=ni>0)return Pi;var wn=Math.abs(bn+ni);return Math.abs(Pi)>=Ye*wn?Pi:-function(yi,oi,Gn,xi,wi,mi,vi){var ai,Cn,li,Fi,en,Bn,bi,Gi,Ii,pr,hi,sr,Gs,is,qr,$s,Rl,mr,Pr=yi-wi,rs=Gn-wi,Ts=oi-mi,us=xi-mi;lt[0]=(qr=(Gi=Pr-(bi=(Bn=be*Pr)-(Bn-Pr)))*(pr=us-(Ii=(Bn=be*us)-(Bn-us)))-((is=Pr*us)-bi*Ii-Gi*Ii-bi*pr))-((hi=qr-(Rl=(Gi=Ts-(bi=(Bn=be*Ts)-(Bn-Ts)))*(pr=rs-(Ii=(Bn=be*rs)-(Bn-rs)))-(($s=Ts*rs)-bi*Ii-Gi*Ii-bi*pr)))+(en=qr-hi))+(en-Rl),lt[1]=(Gs=is-((sr=is+hi)-(en=sr-is))+(hi-en))-((hi=Gs-$s)+(en=Gs-hi))+(en-$s),lt[2]=sr-((mr=sr+hi)-(en=mr-sr))+(hi-en),lt[3]=mr;var Mu=function(jJ,KM){for(var YM=KM[0],pT=1;pT<4;pT++)YM+=KM[pT];return YM}(0,lt),A_=ze*vi;if(Mu>=A_||-Mu>=A_||(ai=yi-(Pr+(en=yi-Pr))+(en-wi),li=Gn-(rs+(en=Gn-rs))+(en-wi),Cn=oi-(Ts+(en=oi-Ts))+(en-mi),Fi=xi-(us+(en=xi-us))+(en-mi),ai===0&&Cn===0&&li===0&&Fi===0)||(A_=Qe*vi+Ie*Math.abs(Mu),(Mu+=Pr*Fi+us*ai-(Ts*li+rs*Cn))>=A_||-Mu>=A_))return Mu;Xe[0]=(qr=(Gi=ai-(bi=(Bn=be*ai)-(Bn-ai)))*(pr=us-(Ii=(Bn=be*us)-(Bn-us)))-((is=ai*us)-bi*Ii-Gi*Ii-bi*pr))-((hi=qr-(Rl=(Gi=Cn-(bi=(Bn=be*Cn)-(Bn-Cn)))*(pr=rs-(Ii=(Bn=be*rs)-(Bn-rs)))-(($s=Cn*rs)-bi*Ii-Gi*Ii-bi*pr)))+(en=qr-hi))+(en-Rl),Xe[1]=(Gs=is-((sr=is+hi)-(en=sr-is))+(hi-en))-((hi=Gs-$s)+(en=Gs-hi))+(en-$s),Xe[2]=sr-((mr=sr+hi)-(en=mr-sr))+(hi-en),Xe[3]=mr;var BV=Pe(4,lt,4,Xe,tt);Xe[0]=(qr=(Gi=Pr-(bi=(Bn=be*Pr)-(Bn-Pr)))*(pr=Fi-(Ii=(Bn=be*Fi)-(Bn-Fi)))-((is=Pr*Fi)-bi*Ii-Gi*Ii-bi*pr))-((hi=qr-(Rl=(Gi=Ts-(bi=(Bn=be*Ts)-(Bn-Ts)))*(pr=li-(Ii=(Bn=be*li)-(Bn-li)))-(($s=Ts*li)-bi*Ii-Gi*Ii-bi*pr)))+(en=qr-hi))+(en-Rl),Xe[1]=(Gs=is-((sr=is+hi)-(en=sr-is))+(hi-en))-((hi=Gs-$s)+(en=Gs-hi))+(en-$s),Xe[2]=sr-((mr=sr+hi)-(en=mr-sr))+(hi-en),Xe[3]=mr;var jV=Pe(BV,tt,4,Xe,rt);Xe[0]=(qr=(Gi=ai-(bi=(Bn=be*ai)-(Bn-ai)))*(pr=Fi-(Ii=(Bn=be*Fi)-(Bn-Fi)))-((is=ai*Fi)-bi*Ii-Gi*Ii-bi*pr))-((hi=qr-(Rl=(Gi=Cn-(bi=(Bn=be*Cn)-(Bn-Cn)))*(pr=li-(Ii=(Bn=be*li)-(Bn-li)))-(($s=Cn*li)-bi*Ii-Gi*Ii-bi*pr)))+(en=qr-hi))+(en-Rl),Xe[1]=(Gs=is-((sr=is+hi)-(en=sr-is))+(hi-en))-((hi=Gs-$s)+(en=Gs-hi))+(en-$s),Xe[2]=sr-((mr=sr+hi)-(en=mr-sr))+(hi-en),Xe[3]=mr;var VV=Pe(jV,rt,4,Xe,dt);return dt[VV-1]}(Tt,bt,Rt,Wt,In,An,wn)}(he[0],he[1],de[0],de[1],Ue[0],Ue[1]);return Ke>0?-1:Ke<0?1:0}function Ge(he,de){var Ue=he.point,Ke=de.point;return Ue[0]>Ke[0]?1:Ue[0]<Ke[0]?-1:Ue[1]!==Ke[1]?Ue[1]>Ke[1]?1:-1:function(Tt,bt,Rt,Wt){return Tt.left!==bt.left?Tt.left?1:-1:ot(Rt,Tt.otherEvent.point,bt.otherEvent.point)!==0?Tt.isBelow(bt.otherEvent.point)?-1:1:!Tt.isSubject&&bt.isSubject?1:-1}(he,de,Ue)}function je(he,de,Ue){var Ke=new ie(de,!1,he,he.isSubject),Tt=new ie(de,!0,he.otherEvent,he.isSubject);return le(he.point,he.otherEvent.point)&&console.warn("what is that, a collapsed segment?",he),Ke.contourId=Tt.contourId=he.contourId,Ge(Tt,he.otherEvent)>0&&(he.otherEvent.left=!0,Tt.left=!1),he.otherEvent.otherEvent=Tt,he.otherEvent=Ke,Ue.push(Tt),Ue.push(Ke),Ue}function ft(he,de){return he[0]*de[1]-he[1]*de[0]}function ut(he,de){return he[0]*de[0]+he[1]*de[1]}function Gt(he,de,Ue){var Ke=function(In,An,bn,ni,Pi){var wn=[An[0]-In[0],An[1]-In[1]],yi=[ni[0]-bn[0],ni[1]-bn[1]];function oi(Bn,bi,Gi){return[Bn[0]+bi*Gi[0],Bn[1]+bi*Gi[1]]}var Gn=[bn[0]-In[0],bn[1]-In[1]],xi=ft(wn,yi),wi=xi*xi,mi=ut(wn,wn);if(wi>0){var vi=ft(Gn,yi)/xi;if(vi<0||vi>1)return null;var ai=ft(Gn,wn)/xi;return ai<0||ai>1?null:vi===0||vi===1?[oi(In,vi,wn)]:ai===0||ai===1?[oi(bn,ai,yi)]:[oi(In,vi,wn)]}if((wi=(xi=ft(Gn,wn))*xi)>0)return null;var Cn=ut(wn,Gn)/mi,li=Cn+ut(wn,yi)/mi,Fi=Math.min(Cn,li),en=Math.max(Cn,li);return Fi<=1&&en>=0?Fi===1?[oi(In,Fi>0?Fi:0,wn)]:en===0?[oi(In,en<1?en:1,wn)]:[oi(In,Fi>0?Fi:0,wn),oi(In,en<1?en:1,wn)]:null}(he.point,he.otherEvent.point,de.point,de.otherEvent.point),Tt=Ke?Ke.length:0;if(Tt===0||Tt===1&&(le(he.point,de.point)||le(he.otherEvent.point,de.otherEvent.point))||Tt===2&&he.isSubject===de.isSubject)return 0;if(Tt===1)return le(he.point,Ke[0])||le(he.otherEvent.point,Ke[0])||je(he,Ke[0],Ue),le(de.point,Ke[0])||le(de.otherEvent.point,Ke[0])||je(de,Ke[0],Ue),1;var bt=[],Rt=!1,Wt=!1;return le(he.point,de.point)?Rt=!0:Ge(he,de)===1?bt.push(de,he):bt.push(he,de),le(he.otherEvent.point,de.otherEvent.point)?Wt=!0:Ge(he.otherEvent,de.otherEvent)===1?bt.push(de.otherEvent,he.otherEvent):bt.push(he.otherEvent,de.otherEvent),Rt&&Wt||Rt?(de.type=S,he.type=de.inOut===he.inOut?A:C,Rt&&!Wt&&je(bt[1].otherEvent,bt[0].point,Ue),2):Wt?(je(bt[0],bt[1].point,Ue),3):bt[0]!==bt[3].otherEvent?(je(bt[0],bt[1].point,Ue),je(bt[1],bt[2].point,Ue),3):(je(bt[0],bt[1].point,Ue),je(bt[3].otherEvent,bt[2].point,Ue),3)}function At(he,de){if(he===de)return 0;if(ot(he.point,he.otherEvent.point,de.point)!==0||ot(he.point,he.otherEvent.point,de.otherEvent.point)!==0)return le(he.point,de.point)?he.isBelow(de.otherEvent.point)?-1:1:he.point[0]===de.point[0]?he.point[1]<de.point[1]?-1:1:Ge(he,de)===1?de.isAbove(he.point)?-1:1:he.isBelow(de.point)?-1:1;if(he.isSubject!==de.isSubject)return he.isSubject?-1:1;var Ue=he.point,Ke=de.point;return Ue[0]===Ke[0]&&Ue[1]===Ke[1]?(Ue=he.otherEvent.point)[0]===(Ke=de.otherEvent.point)[0]&&Ue[1]===Ke[1]?0:he.contourId>de.contourId?1:-1:Ge(he,de)===1?1:-1}var Lt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function yt(he,de,Ue,Ke){var Tt,bt=he+1,Rt=de[he].point,Wt=de.length;for(bt<Wt&&(Tt=de[bt].point);bt<Wt&&Tt[0]===Rt[0]&&Tt[1]===Rt[1];){if(!Ue[bt])return bt;++bt<Wt&&(Tt=de[bt].point)}for(bt=he-1;Ue[bt]&&bt>Ke;)bt--;return bt}Lt.prototype.isExterior=function(){return this.holeOf==null};var Vt=St,an=St;function St(he,de){if(!(this instanceof St))return new St(he,de);if(this.data=he||[],this.length=this.data.length,this.compare=de||Ft,this.length>0)for(var Ue=(this.length>>1)-1;Ue>=0;Ue--)this._down(Ue)}function Ft(he,de){return he<de?-1:he>de?1:0}St.prototype={push:function(he){this.data.push(he),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var he=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),he}},peek:function(){return this.data[0]},_up:function(he){for(var de=this.data,Ue=this.compare,Ke=de[he];he>0;){var Tt=he-1>>1,bt=de[Tt];if(Ue(Ke,bt)>=0)break;de[he]=bt,he=Tt}de[he]=Ke},_down:function(he){for(var de=this.data,Ue=this.compare,Ke=this.length>>1,Tt=de[he];he<Ke;){var bt=1+(he<<1),Rt=bt+1,Wt=de[bt];if(Rt<this.length&&Ue(de[Rt],Wt)<0&&(bt=Rt,Wt=de[Rt]),Ue(Wt,Tt)>=0)break;de[he]=Wt,he=bt}de[he]=Tt}},Vt.default=an;var Yt=Math.max,dn=Math.min,En=0;function mn(he,de,Ue,Ke,Tt,bt){var Rt,Wt,In,An,bn,ni;for(Rt=0,Wt=he.length-1;Rt<Wt;Rt++)if(An=he[Rt+1],bn=new ie(In=he[Rt],!1,void 0,de),ni=new ie(An,!1,bn,de),bn.otherEvent=ni,In[0]!==An[0]||In[1]!==An[1]){bn.contourId=ni.contourId=Ue,bt||(bn.isExteriorRing=!1,ni.isExteriorRing=!1),Ge(bn,ni)>0?ni.left=!0:bn.left=!0;var Pi=In[0],wn=In[1];Tt[0]=dn(Tt[0],Pi),Tt[1]=dn(Tt[1],wn),Tt[2]=Yt(Tt[2],Pi),Tt[3]=Yt(Tt[3],wn),Ke.push(bn),Ke.push(ni)}}var kt=[];function fn(he,de,Ue){typeof he[0][0][0]=="number"&&(he=[he]),typeof de[0][0][0]=="number"&&(de=[de]);var Ke=function(wn,yi,oi){var Gn=null;return wn.length*yi.length==0&&(oi===M?Gn=kt:oi===O?Gn=wn:oi!==z&&oi!==$||(Gn=wn.length===0?yi:wn)),Gn}(he,de,Ue);if(Ke)return Ke===kt?null:Ke;var Tt=[1/0,1/0,-1/0,-1/0],bt=[1/0,1/0,-1/0,-1/0],Rt=function(wn,yi,oi,Gn,xi){var wi,mi,vi,ai,Cn,li,Fi=new Vt(null,Ge);for(vi=0,ai=wn.length;vi<ai;vi++)for(Cn=0,li=(wi=wn[vi]).length;Cn<li;Cn++)(mi=Cn===0)&&En++,mn(wi[Cn],!0,En,Fi,oi,mi);for(vi=0,ai=yi.length;vi<ai;vi++)for(Cn=0,li=(wi=yi[vi]).length;Cn<li;Cn++)mi=Cn===0,xi===O&&(mi=!1),mi&&En++,mn(wi[Cn],!1,En,Fi,Gn,mi);return Fi}(he,de,Tt,bt,Ue);if(Ke=function(wn,yi,oi,Gn,xi){var wi=null;return(oi[0]>Gn[2]||Gn[0]>oi[2]||oi[1]>Gn[3]||Gn[1]>oi[3])&&(xi===M?wi=kt:xi===O?wi=wn:xi!==z&&xi!==$||(wi=wn.concat(yi))),wi}(he,de,Tt,bt,Ue))return Ke===kt?null:Ke;for(var Wt=function(wn){var yi,oi,Gn=function(vi){var ai,Cn,li,Fi,en=[];for(Cn=0,li=vi.length;Cn<li;Cn++)((ai=vi[Cn]).left&&ai.inResult||!ai.left&&ai.otherEvent.inResult)&&en.push(ai);for(var Bn=!1;!Bn;)for(Bn=!0,Cn=0,li=en.length;Cn<li;Cn++)Cn+1<li&&Ge(en[Cn],en[Cn+1])===1&&(Fi=en[Cn],en[Cn]=en[Cn+1],en[Cn+1]=Fi,Bn=!1);for(Cn=0,li=en.length;Cn<li;Cn++)(ai=en[Cn]).otherPos=Cn;for(Cn=0,li=en.length;Cn<li;Cn++)(ai=en[Cn]).left||(Fi=ai.otherPos,ai.otherPos=ai.otherEvent.otherPos,ai.otherEvent.otherPos=Fi);return en}(wn),xi={},wi=[],mi=function(){if(!xi[yi]){var vi=wi.length,ai=function(en,Bn,bi){var Gi=new Lt;if(en.prevInResult!=null){var Ii=en.prevInResult,pr=Ii.outputContourId;if(Ii.resultTransition>0){var hi=Bn[pr];if(hi.holeOf!=null){var sr=hi.holeOf;Bn[sr].holeIds.push(bi),Gi.holeOf=sr,Gi.depth=Bn[pr].depth}else Bn[pr].holeIds.push(bi),Gi.holeOf=pr,Gi.depth=Bn[pr].depth+1}else Gi.holeOf=null,Gi.depth=Bn[pr].depth}else Gi.holeOf=null,Gi.depth=0;return Gi}(Gn[yi],wi,vi),Cn=function(en){xi[en]=!0,en<Gn.length&&Gn[en]&&(Gn[en].outputContourId=vi)},li=yi,Fi=yi;for(ai.points.push(Gn[yi].point);Cn(li),Cn(li=Gn[li].otherPos),ai.points.push(Gn[li].point),!((li=yt(li,Gn,xi,Fi))==Fi||li>=Gn.length)&&Gn[li];);wi.push(ai)}};for(yi=0,oi=Gn.length;yi<oi;yi++)mi();return wi}(function(wn,yi,oi,Gn,xi,wi){for(var mi,vi,ai,Cn=new u(At),li=[],Fi=Math.min(Gn[2],xi[2]);wn.length!==0;){var en=wn.pop();if(li.push(en),wi===M&&en.point[0]>Fi||wi===O&&en.point[0]>Gn[2])break;if(en.left){vi=mi=Cn.insert(en),mi=mi!==(ai=Cn.minNode())?Cn.prev(mi):null,vi=Cn.next(vi);var Bn=mi?mi.key:null;if(W(en,Bn,wi),vi&&Gt(en,vi.key,wn)===2&&(W(en,Bn,wi),W(vi.key,en,wi)),mi&&Gt(mi.key,en,wn)===2){var bi=mi;W(Bn,(bi=bi!==ai?Cn.prev(bi):null)?bi.key:null,wi),W(en,Bn,wi)}}else vi=mi=Cn.find(en=en.otherEvent),mi&&vi&&(mi=mi!==ai?Cn.prev(mi):null,vi=Cn.next(vi),Cn.remove(en),vi&&mi&&Gt(mi.key,vi.key,wn))}return li}(Rt,0,0,Tt,bt,Ue)),In=[],An=0;An<Wt.length;An++){var bn=Wt[An];if(bn.isExterior()){for(var ni=[bn.points],Pi=0;Pi<bn.holeIds.length;Pi++)ni.push(Wt[bn.holeIds[Pi]].points);In.push(ni)}}return In}var Fn={UNION:z,DIFFERENCE:O,INTERSECTION:M,XOR:$};r.diff=function(he,de){return fn(he,de,O)},r.intersection=function(he,de){return fn(he,de,M)},r.operations=Fn,r.union=function(he,de){return fn(he,de,z)},r.xor=function(he,de){return fn(he,de,$)},Object.defineProperty(r,"__esModule",{value:!0})})(e)}(0,zA.exports)),zA.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function mx(s,e,r,l){const u=[],p=l===0?(m,v,b,S,A,C)=>{m.push(new ct(C,b+(C-v)/(S-v)*(A-b)))}:(m,v,b,S,A,C)=>{m.push(new ct(v+(C-b)/(A-b)*(S-v),C))};for(const m of s){const v=[];for(const b of m){if(b.length<=2)continue;const S=[];for(let M=0;M<b.length-1;M++){const z=b[M].x,O=b[M].y,$=b[M+1].x,W=b[M+1].y,q=l===0?z:O,ie=l===0?$:W;q<e?ie>e&&p(S,z,O,$,W,e):q>r?ie<r&&p(S,z,O,$,W,r):S.push(b[M]),ie<e&&q>=e&&p(S,z,O,$,W,e),ie>r&&q<=r&&p(S,z,O,$,W,r)}let A=b[b.length-1];const C=l===0?A.x:A.y;C>=e&&C<=r&&S.push(A),S.length&&(A=S[S.length-1],S[0].x===A.x&&S[0].y===A.y||S.push(S[0]),v.push(S))}v.length&&u.push(v)}return u}function O5(s,e){const r=cb(s),l=cb([e]),u=OA.intersection(r,l);return u==null?[]:FA(u)}function F5(s,e){let l=cb(s,65536);const u=[];for(;e.valid();e.next()){const[p,m]=e.get(),v=p.x*65536,b=p.y*65536,S=m.x*65536,A=m.y*65536,C=S-v,M=A-b,z=Math.hypot(C,M);if(z===0)continue;const O=Math.trunc(M/z*3),$=-Math.trunc(C/z*3);u.push([[[v,b],[S,A],[S+O,A+$],[v+O,b+$],[v,b]]])}return u.length>0&&(l=OA.diff(l,u)),FA(l,1/65536)}function cb(s,e=1){return[s.map(r=>r.map(l=>[l.x*e,l.y*e]))]}function FA(s,e=1){return s.map(r=>r.map((l,u)=>{const p=l.map(m=>new ct(m[0]*e,m[1]*e).round());return u>0&&p.reverse(),p}))}class ub{constructor(e,r){this.layoutVertexArray=new bl,this.indexArray=new xr,this.lineIndexArray=new dr,this.triangleSegments=new Oi,this.lineSegments=new Oi,this.programConfigurations=new Ho(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,r&&(this.elevatedLayoutVertexArray=new Tl)}update(e,r,l,u,p,m,v,b){this.programConfigurations.updatePaintArrays(e,r,p,l,u,m,v,b)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,w5.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,b5.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,r,l,u,p,m,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,l,u,p,m,void 0,v)}}class hb{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new ub(e,!1),this.elevationBufferData=new ub(e,!0),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,r){}populate(e,r,l,u){this.hasPattern=ab("fill",this.layers,this.pixelRatio,r);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:v,id:b,index:S,sourceLayerIndex:A}of e){const C=this.layers[0]._featureFilter.needGeometry,M=ht(v,C);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom,{worldview:this.worldview}),M,l))continue;const z=p?p.evaluate(M,{},l,r.availableImages):void 0,O={id:b,properties:v.properties,type:v.type,sourceLayerIndex:A,index:S,geometry:C?M.geometry:It(v,l,u),patterns:{},sortKey:z};m.push(O)}p&&m.sort((v,b)=>v.sortKey-b.sortKey);for(const v of m){const{geometry:b,index:S,sourceLayerIndex:A}=v;if(this.hasPattern){const C=lb("fill",this.layers,v,this.zoom,this.pixelRatio,r);this.patternFeatures.push(C)}else this.addFeature(v,b,S,l,{},r.availableImages,r.brightness,r.elevationFeatures);r.featureIndex.insert(e[S].feature,b,S,A,this.index)}}update(e,r,l,u,p,m,v){this.bufferData.update(e,r,l,u,p,m,v,this.worldview),this.elevationBufferData.update(e,r,l,u,p,m,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,r,l,u,p,m,v,this.worldview)}addFeatures(e,r,l,u,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,l,u,m,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,r,l,u,p,m=[],v,b){const S=Kg(r,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,S,u,l,b):this.addGeometry(S,this.bufferData),this.bufferData.populatePaintArrays(e,l,p,m,u,v,this.worldview),this.elevationBufferData.populatePaintArrays(e,l,p,m,u,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,r,l,u,p){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(r,l,u,p,this.worldview))}addElevatedRoadFeature(e,r,l,u,p){const m=new Array,v=ki.getElevationFeature(e,p);if(!v)return void this.addGeometry(r,this.bufferData);{const S=this.clipPolygonsToTile(r,1);S.length>0&&m.push({polygons:S,elevationFeature:v,elevationTileID:l})}const b={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},l),featureIndex:u};for(const S of m)if(S.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new go(S.elevationTileID,this.layers,this.zoom,this.lut));const C=S.elevationFeature.isTunnel();let M=0;e.properties.hasOwnProperty(ei)&&(M=+e.properties[ei]);for(const z of S.polygons)this.elevatedStructures.addPortalCandidates(S.elevationFeature.id,z,C,S.elevationFeature,M)}S.elevationFeature.constantHeight==null&&(S.polygons=this.prepareElevatedPolygons(S.polygons,S.elevationFeature,S.elevationTileID));const A=new tr(l,S.elevationTileID);this.addElevatedGeometry(S.polygons,A,S.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u,b)}}addElevatedGeometry(e,r,l,u,p,m){const v={elevation:l,elevationSampler:r,bias:u,index:p,featureInfo:m},[b,S]=this.addGeometry(e,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:b,max:S}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,b),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,S))}addGeometry(e,r,l){let u=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,m=null;l&&(m=l.elevationSampler.constantElevation(l.elevation,l.bias),m!=null&&(u=m,p=m));const v=(b,S,A)=>{if(l!=null)if(S.push(b),m!=null)r.elevatedLayoutVertexArray.emplaceBack(m),A.push(m);else{const C=l.elevationSampler.pointElevation(b,l.elevation,l.bias);r.elevatedLayoutVertexArray.emplaceBack(C),A.push(C),u=Math.min(u,C),p=Math.max(p,C)}};for(const b of e){let S=0;for(const re of b)S+=re.length;const A=r.triangleSegments.prepareSegment(S,r.layoutVertexArray,r.indexArray),C=A.vertexLength,M=[],z=[],O=[],$=[],W=[],q=r.layoutVertexArray.length;for(const re of b){if(re.length===0)continue;re!==b[0]&&z.push(M.length/2);const le=r.lineSegments.prepareSegment(re.length,r.layoutVertexArray,r.lineIndexArray),we=le.vertexLength;l&&W.push(r.layoutVertexArray.length-q),v(re[0],O,$),r.layoutVertexArray.emplaceBack(re[0].x,re[0].y),r.lineIndexArray.emplaceBack(we+re.length-1,we),M.push(re[0].x),M.push(re[0].y);for(let be=1;be<re.length;be++)v(re[be],O,$),r.layoutVertexArray.emplaceBack(re[be].x,re[be].y),r.lineIndexArray.emplaceBack(we+be-1,we+be),M.push(re[be].x),M.push(re[be].y);le.vertexLength+=re.length,le.primitiveLength+=re.length}const ie=rp(M,z);for(let re=0;re<ie.length;re+=3)r.indexArray.emplaceBack(C+ie[re],C+ie[re+1],C+ie[re+2]);if(ie.length>0&&l&&this.elevationMode==="hd-road-base"){const re=l.elevation.isTunnel(),le=l.elevation.safeArea,we=this.elevatedStructures.addVertices(O,$);this.elevatedStructures.addTriangles(ie,we,re);const be=W.length;if(be>0){for(let Ie=0;Ie<be-1;Ie++)this.elevatedStructures.addRenderableRing(l.index,W[Ie]+we,W[Ie+1]-W[Ie],re,le,l.featureInfo);this.elevatedStructures.addRenderableRing(l.index,W[be-1]+we,O.length-W[be-1],re,le,l.featureInfo)}}A.vertexLength+=S,A.primitiveLength+=ie.length/3}return[u,p]}prepareElevatedPolygons(e,r,l){const u=1/Oe(l),p=[];for(const m of e){const v=F5(m,new ti(r,u));p.push(...v)}return p}clipPolygonsToTile(e,r){const l=-r,u=-r,p=vt+r,m=vt+r;let v=0;const b=[],S=[];for(;v<e.length;v++){const M=e[v],z=lf(M);(z.min.x>=l&&z.max.x<=p&&z.min.y>=u&&z.max.y<=m?b:S).push(M)}if(b.length===e.length)return e;const A=[new ct(l,u),new ct(p,u),new ct(p,m),new ct(l,m),new ct(l,u)],C=b;for(const M of S)C.push(...O5(M,A));return C}}let NA,BA,jA,VA;Pt(hb,"FillBucket",{omit:["layers","patternFeatures"]}),Pt(ub,"FillBufferData"),Pt(go,"ElevatedStructures");class gx{constructor(e,r,l,u){if(this.triangleCount=r.length/3,this.min=new ct(0,0),this.max=new ct(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[p,m]=[e[0].clone(),e[0].clone()];for(let C=1;C<e.length;++C){const M=e[C];p.x=Math.min(p.x,M.x),p.y=Math.min(p.y,M.y),m.x=Math.max(m.x,M.x),m.y=Math.max(m.y,M.y)}if(u){const C=Math.ceil(Math.max(m.x-p.x,m.y-p.y)/u);l=Math.max(l,C)}if(l===0)return;this.min=p,this.max=m;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const b=Math.max(v.x,v.y)/l;this.cellsX=Math.max(1,Math.ceil(v.x/b)),this.cellsY=Math.max(1,Math.ceil(v.y/b)),this.xScale=1/b,this.yScale=1/b;const S=[];for(let C=0;C<this.triangleCount;C++){const M=e[r[3*C+0]].sub(this.min),z=e[r[3*C+1]].sub(this.min),O=e[r[3*C+2]].sub(this.min),$=Pl(Math.floor(Math.min(M.x,z.x,O.x)),this.xScale,this.cellsX),W=Pl(Math.floor(Math.max(M.x,z.x,O.x)),this.xScale,this.cellsX),q=Pl(Math.floor(Math.min(M.y,z.y,O.y)),this.yScale,this.cellsY),ie=Pl(Math.floor(Math.max(M.y,z.y,O.y)),this.yScale,this.cellsY),re=new ct(0,0),le=new ct(0,0),we=new ct(0,0),be=new ct(0,0);for(let Ie=q;Ie<=ie;++Ie){re.y=le.y=Ie*b,we.y=be.y=(Ie+1)*b;for(let Pe=$;Pe<=W;++Pe)re.x=we.x=Pe*b,le.x=be.x=(Pe+1)*b,(Fa(M,z,O,re,le,be)||Fa(M,z,O,re,be,we))&&S.push({cellIdx:Ie*this.cellsX+Pe,triIdx:C})}}if(S.length===0)return;S.sort((C,M)=>C.cellIdx-M.cellIdx||C.triIdx-M.triIdx);let A=0;for(;A<S.length;){const C=S[A].cellIdx,M={start:this.payload.length,len:0};for(;A<S.length&&S[A].cellIdx===C;)++M.len,this.payload.push(S[A++].triIdx);this.cells[C]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=Pl(e.x-this.min.x,this.xScale,this.cellsX),u=Pl(e.y-this.min.y,this.yScale,this.cellsY),p=this.cells[u*this.cellsX+l];if(p){this._lazyInitLookup();for(let m=0;m<p.len;m++){const v=this.payload[p.start+m],b=Math.floor(v/8),S=1<<v%8;if(!(this.lookup[b]&S)&&(this.lookup[b]|=S,r.push(v),r.length===this.triangleCount))return}}}query(e,r,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const u=Pl(e.x-this.min.x,this.xScale,this.cellsX),p=Pl(r.x-this.min.x,this.xScale,this.cellsX),m=Pl(e.y-this.min.y,this.yScale,this.cellsY),v=Pl(r.y-this.min.y,this.yScale,this.cellsY);for(let b=m;b<=v;b++)for(let S=u;S<=p;S++){const A=this.cells[b*this.cellsX+S];if(A)for(let C=0;C<A.len;C++){const M=this.payload[A.start+C],z=Math.floor(M/8),O=1<<M%8;if(!(this.lookup[z]&O)&&(this.lookup[z]|=O,l.push(M),l.length===this.triangleCount))return}}}}function Pl(s,e,r){return Math.max(0,Math.min(r-1,Math.floor(s*e)))}Pt(gx,"TriangleGridIndex");class UA{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,r){for(const l of this.footprints)r.push({footprint:l,id:e})}populate(e,r,l,u){const p=[];for(const{feature:m,id:v,index:b,sourceLayerIndex:S}of e){const A=this.layers[0]._featureFilter.needGeometry,C=ht(m,A);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom,{worldview:this.worldview}),C,l))continue;const M={id:v,properties:m.properties,type:m.type,sourceLayerIndex:S,index:b,geometry:A?C.geometry:It(m,l,u),patterns:{}};p.push(M)}for(const m of p){const{geometry:v,index:b,sourceLayerIndex:S}=m;this.addFeature(m,v,b,l,{},r.availableImages,r.brightness),r.featureIndex.insert(e[b].feature,v,b,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,l,u,p,m,v){}destroy(){}addFeature(e,r,l,u,p,m=[],v){for(const b of Kg(r,2)){const S=[],A=[],C=[],M=new ct(1/0,1/0),z=new ct(-1/0,-1/0);for(const W of b)if(W.length!==0){W!==b[0]&&C.push(A.length/2);for(let q=0;q<W.length;q++)A.push(W[q].x),A.push(W[q].y),S.push(W[q]),M.x=Math.min(M.x,W[q].x),M.y=Math.min(M.y,W[q].y),z.x=Math.max(z.x,W[q].x),z.y=Math.max(z.y,W[q].y)}const O=rp(A,C),$=new gx(S,O,8,256);this.footprints.push({vertices:S,indices:O,grid:$,min:M,max:z})}}}Pt(UA,"ClipBucket",{omit:["layers"]});const N5=zn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),B5=zn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),j5=zn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),V5=zn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),U5=zn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),G5=zn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:$5}=N5,Yg=Number.MAX_SAFE_INTEGER,GA=Yg-1;function $A(s,e,r,l){return s.order<e||s.order===Yg||!(s.clipMask&r)||function(u,p){return p.length!==0&&p.find(m=>m===u)===void 0}(l,s.clipScope)}function _x(s,e){return s.x-e.x||s.y-e.y}function HA(s,e){return _x(s.min,e.min)===0&&_x(s.max,e.max)===0}function db(s,e){return!(s.min.x>e.max.x||s.max.x<e.min.x||s.min.y>e.max.y||s.max.y<e.min.y)}function yx(s,e){if(s.length!==e.length)return!1;for(let r=0;r<s.length;r++)if(s[r].sourceId!==e[r].sourceId||!HA(s[r],e[r])||s[r].order!==e[r].order||s[r].clipMask!==e[r].clipMask||!Oo(s[r].clipScope,e[r].clipScope))return!1;return!0}function WA(s,e,r){const l=1/vt,u=1/(1<<r.canonical.z),p=(e.x*l+r.canonical.x)*u+r.wrap,m=(e.y*l+r.canonical.y)*u;return{min:new ct((s.x*l+r.canonical.x)*u+r.wrap,(s.y*l+r.canonical.y)*u),max:new ct(p,m)}}function H5(s,e,r){const l=1<<r.canonical.z,u=((e.x-r.wrap)*l-r.canonical.x)*vt,p=(e.y*l-r.canonical.y)*vt;return{min:new ct(((s.x-r.wrap)*l-r.canonical.x)*vt,(s.y*l-r.canonical.y)*vt),max:new ct(u,p)}}function fb(s,e,r,l,u,p,m){const v=s.indices,b=s.vertices,S=[];for(let A=l;A<l+u;A+=3){const C=e[r[A+0]+p],M=e[r[A+1]+p],z=e[r[A+2]+p],O=Math.min(C.x,M.x,z.x),$=Math.max(C.x,M.x,z.x),W=Math.min(C.y,M.y,z.y),q=Math.max(C.y,M.y,z.y);S.length=0,s.grid.query(new ct(O,W),new ct($,q),S);for(let ie=0;ie<S.length;ie++){const re=S[ie];if(Fa(b[v[3*re+0]],b[v[3*re+1]],b[v[3*re+2]],C,M,z,m))return!0}}return!1}function qA(s,e,r,l){if(!s||!r)return!1;let u=s.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(r.vertices.length<s.vertices.length)return qA(r,l,s,e);const p=e.canonical,m=l.canonical,v=Math.pow(2,m.z-p.z);u=s.vertices.map(b=>new ct((b.x+p.x*vt)*v-m.x*vt,(b.y+p.y*vt)*v-m.y*vt))}return fb(r,u,s.indices,0,s.indices.length,0,0)}function ZA(s,e,r,l){const u=Math.pow(2,l.z-r.z);return new ct((s+r.x*vt)*u-l.x*vt,(e+r.y*vt)*u-l.y*vt)}function pb(s,e){const r=[];e.grid.queryPoint(s,r);const l=e.indices,u=e.vertices;for(let p=0;p<r.length;p++){const m=r[p];if(Cr([u[l[3*m+0]],u[l[3*m+1]],u[l[3*m+2]]],s))return!0}return!1}const mb=[new ct(0,0),new ct(vt,0),new ct(vt,vt),new ct(0,vt)];function XA(s,e){const r=[];let l=[];if(!e||s.length<2)return[s];if(s.length===2)return ts(s[0],s[1],mb)?[s]:[];for(let u=0;u<s.length+2;u++){const p=s[u%s.length],m=s[(u+1)%s.length],v=ts(u===0?s[s.length-1]:s[(u-1)%s.length],p,mb),b=ts(p,m,mb),S=v||b;S&&l.push(p),S&&b||l.length>0&&(l.length>1&&r.push(l),l=[])}return l.length>1&&r.push(l),r}const gb=at.types,W5=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],q5=["fill-extrusion-flood-light-ground-radius"],Z5=Math.pow(2,13),X5=Math.pow(2,15)-1,KA=new ct(0,1),Su=2147483648;function Jg(s,e,r,l,u,p,m,v){s.emplaceBack((e<<1)+m,(r<<1)+p,(Math.floor(l*Z5)<<1)+u,Math.round(v))}function Qg(s,e,r){s.emplaceBack(e.x*vt,e.y*vt,r?1:0)}function vx(s,e,r,l,u,p){s.emplaceBack(e.x,e.y,(r.x<<1)+l,(r.y<<1)+u,p)}function e_(s,e,r){s.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class YA{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class JA{constructor(){this.centroidXY=new ct(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ct(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ct(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new ct(this.max.x-this.min.x,this.max.y-this.min.y)}}class QA{constructor(){this.acc=new ct(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,l){this.accCount++,this.acc._add(r);let u=!!this.borders;r.x<e.min.x?(e.min.x=r.x,u=!0):r.x>e.max.x&&(e.max.x=r.x,u=!0),r.y<e.min.y?(e.min.y=r.y,u=!0):r.y>e.max.y&&(e.max.y=r.y,u=!0),((r.x===0||r.x===vt)&&r.x===l.x)!=((r.y===0||r.y===vt)&&r.y===l.y)&&this.processBorderOverlap(r,l),u&&this.checkBorderIntersection(r,l)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,Kt(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>vt!=e.x>vt&&this.addBorderIntersection(1,Kt(r.y,e.y,(vt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Kt(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>vt!=e.y>vt&&this.addBorderIntersection(3,Kt(r.x,e.x,(vt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];r<l[0]&&(l[0]=r),r>l[1]&&(l[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,r.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,r.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new ct(0,0):new ct(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function eC(s,e){const r=s.add(e)._unit(),l=Se(s.x*r.x+s.y*r.y,-1,1);var u,p,m;return u=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(u)))/4*X5*((p=s).x*(m=e).y-p.y*m.x<0?-1:1)}const K5=[s=>s.x<0,s=>s.x>vt,s=>s.y<0,s=>s.y>vt];function Y5(s,e,r,l){const u=[4];if(l===0)return u;r._mult(l);const p=s.sub(r),m=e.sub(r),v=[s,e,p,m];for(let b=0;b<4;b++)for(const S of v)if(K5[b](S)){u.push(b);break}return u}class _b{constructor(e){this.vertexArray=new kg,this.indexArray=new xr,this.programConfigurations=new Ho(e.layers,{zoom:e.zoom,lut:e.lut},r=>q5.includes(r)),this._segments=new Oi,this.hiddenByLandmarkVertexArray=new Jf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Oi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,l,u=!1){const p=e.length;if(p>2){let m=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let b;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const S=e[0],A=e[1];b=eC(S.sub(e[p-1])._perp()._unit(),A.sub(S)._perp()._unit())}for(let S=0;S<p;S++){const A=S===p-1?0:S+1,C=e[S],M=e[A],z=e[A===p-1?0:A+1],O=M.sub(C)._perp()._unit(),$=eC(O,z.sub(M)._perp()._unit()),W=b,q=$;if(yb(C,M,r)||u&&iC(C,r)&&iC(M,r)){b=$;continue}const ie=v.vertexLength;vx(this.vertexArray,C,M,1,1,W),vx(this.vertexArray,C,M,1,0,W),vx(this.vertexArray,C,M,0,1,q),vx(this.vertexArray,C,M,0,0,q),v.vertexLength+=4;const re=Y5(C,M,O,l);for(const le of re)this._segmentToGroundQuads[m].push({id:ie,region:le}),this._segmentToRegionTriCounts[m][le]+=2,v.primitiveLength+=2;b=$}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let l=0;l<r;l++)this._segmentToGroundQuads[l].sort((u,p)=>u.region-p.region);for(let l=0;l<r;l++){const u=this._segmentToGroundQuads[l],p=e[l],m=this._segmentToRegionTriCounts[l];m.reduce((b,S)=>b+S,0);let v=0;for(let b=0;b<=4;b++){const S=m[b];if(S!==0){let A=this.regionSegments[b];A||(A=this.regionSegments[b]=new Oi);const C={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+v,vertexLength:p.vertexLength,primitiveLength:S};A.get().push(C)}v+=S}for(let b=0;b<u.length;b++){const S=u[b].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,l,u,p,m,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,l,u,p,m,void 0,v)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,B5.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,l,u,p,m,v,b){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,l,u,p,m,v,b)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Su))}updateHiddenByLandmarkRange(e,r,l){if(!this.hasData())return;const u=r+e;if(r!==0){for(let p=e;p<u;++p)this.hiddenByLandmarkVertexArray.emplace(p,l?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,U5.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class xx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new xr,this.footprintVertices=new bl,this.footprintSegments=[],this.layoutVertexArray=new yc,this.centroidVertexArray=new ix,this.wallVertexArray=new sx,this.indexArray=new xr,this.programConfigurations=new Ho(e.layers,{zoom:e.zoom,lut:e.lut},r=>W5.includes(r)),this.segments=new Oi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new _b(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,r){}populate(e,r,l,u){this.features=[],this.hasPattern=ab("fill-extrusion",this.layers,this.pixelRatio,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Oe(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:m,index:v,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,A=ht(p,S);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom,{worldview:this.worldview}),A,l))continue;const C={id:m,sourceLayerIndex:b,index:v,geometry:S?A.geometry:It(p,l,u),properties:p.properties,type:p.type,patterns:{}},M=this.layoutVertexArray.length,z=gb[C.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:p.id,feature:lb("fill-extrusion",this.layers,C,this.zoom,this.pixelRatio,r)});else if(this.wallMode)for(const O of C.geometry)for(const $ of XA(O,z))this.addFeature(p.id,C,[$],v,l,{},r.availableImages,u,r.brightness);else this.addFeature(p.id,C,C.geometry,v,l,{},r.availableImages,u,r.brightness);r.featureIndex.insert(p,C.geometry,v,b,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,l,u,p,m){for(const{featureId:v,feature:b}of this.features){const S=gb[b.type]==="Polygon",{geometry:A}=b;if(this.wallMode)for(const C of A)for(const M of XA(C,S))this.addFeature(v,b,[M],b.index,r,l,u,p,m);else this.addFeature(v,b,A,b.index,r,l,u,p,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,l,u,p,m,v){this.programConfigurations.updatePaintArrays(e,r,p,l,u,m,v,this.worldview),this.groundEffect.update(e,r,p,l,u,m,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$5),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,V5.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,G5.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,j5.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,l,u,p,m,v,b,S){const A=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(r,{})/this.tileToMeter,C=[new ct(0,0),new ct(vt,vt)],M=b.projection,z=M.name==="globe",O=this.wallMode||gb[r.type]==="Polygon",$=new QA;$.centroidDataIndex=this.centroidData.length;const W=new JA;W.buildingId=e,r.properties&&r.properties.hasOwnProperty("building_id")&&(W.buildingId=r.properties.building_id);const q=this.layers[0].paint.get("fill-extrusion-base").evaluate(r,{},p)<=0,ie=this.layers[0].paint.get("fill-extrusion-height").evaluate(r,{},p);let re;if(W.height=ie,W.vertexArrayOffset=this.layoutVertexArray.length,W.groundVertexArrayOffset=this.groundEffect.vertexArray.length,z&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new qf),this.wallMode){if(z)return void Dn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;re=function(ze){const Qe=ze[0].x===ze[ze.length-1].x&&ze[0].y===ze[ze.length-1].y;(function(yt){let Vt=0;const an=yt.length;for(let St=0;St<an;St++)Vt+=(yt[(St+1)%an].x-yt[St].x)*(yt[(St+1)%an].y+yt[St].y);return Vt>=0})(ze)||(ze=ze.reverse());const tt={geometry:[],joinNormals:[],indices:[]},rt=[],dt=[],Xe=[];let ot=ze.length;for(;ot>=2&&ze[ot-1].equals(ze[ot-2]);)ot--;if(ot<(Qe?3:2))return tt;let Ge,je,ft,ut,Gt,At=0;for(;At<ot-1&&ze[At].equals(ze[At+1]);)At++;Qe&&(Ge=ze[ot-2],Gt=ze[At].sub(Ge)._unit()._perp());for(let yt=At;yt<ot;yt++){if(ft=yt===ot-1?Qe?ze[At+1]:void 0:ze[yt+1],ft&&ze[yt].equals(ft))continue;Gt&&(ut=Gt),Ge&&(je=Ge),Ge=ze[yt],Gt=ft?ft.sub(Ge)._unit()._perp():ut,ut=ut||Gt;let Vt=ut.add(Gt);Vt.x===0&&Vt.y===0||Vt._unit();const an=Vt.x*Gt.x+Vt.y*Gt.y,St=an!==0?1/an:1/0,Ft=ut.x*Gt.y-ut.y*Gt.x>0;let Yt="miter";const dn=2;Yt==="miter"&&St>dn&&(Yt="bevel"),Yt==="bevel"&&(St>100&&(Yt="flipbevel"),St<dn&&(Yt="miter"));const En=(mn,kt,fn,Fn)=>{const he=new ct(mn.x,mn.y),de=new ct(mn.x,mn.y);he.x+=kt.x*Fn,he.y+=kt.y*Fn,de.x-=kt.x*Math.max(fn,1),de.y-=kt.y*Math.max(fn,1),Xe.push(kt),rt.push(he),dt.push(de)};if(Yt==="miter")Vt._mult(St),En(Ge,Vt,0,0);else if(Yt==="flipbevel")Vt=Gt.mult(-1),En(Ge,Vt,0,0),En(Ge,Vt.mult(-1),0,0);else{const mn=-Math.sqrt(St*St-1),kt=Ft?mn:0,fn=Ft?0:mn;je&&En(Ge,ut,kt,fn),ft&&En(Ge,Gt,kt,fn)}}tt.geometry=[...rt,...dt.reverse(),rt[0]],tt.joinNormals=[...Xe,...Xe.reverse(),Xe[Xe.length-1]];const Lt=tt.geometry.length-1;for(let yt=0;yt<Lt/2;yt++)if(yt+1<Lt/2){let Vt=yt,an=yt+1,St=Lt-1-yt,Ft=Lt-2-yt;Vt=Vt===0?Lt-1:Vt-1,an=an===0?Lt-1:an-1,St=St===0?Lt-1:St-1,Ft=Ft===0?Lt-1:Ft-1,tt.indices.push(St),tt.indices.push(an),tt.indices.push(Vt),tt.indices.push(St),tt.indices.push(Ft),tt.indices.push(an)}return tt}(l[0]),l=[re.geometry]}const le=(ze,Qe)=>ze<(Qe.length-1)/2||ze===Qe.length-1,we=this.wallMode?[l]:Kg(l,500);for(let ze=we.length-1;ze>=0;ze--){const Qe=we[ze];(Qe.length===0||(be=Qe[0]).every(lt=>lt.x<=0)||be.every(lt=>lt.x>=vt)||be.every(lt=>lt.y<=0)||be.every(lt=>lt.y>=vt))&&we.splice(ze,1)}var be;let Ie;if(z)Ie=aC(we,C,p);else{Ie=[];for(const ze of we)Ie.push({polygon:ze,bounds:C})}const Pe=O?this.edgeRadius:0,Me=Pe>0&&this.zoom<17,Ye=(ze,Qe)=>{if(ze.length===0)return!1;const lt=ze[ze.length-1];return Qe.x===lt.x&&Qe.y===lt.y};for(const{polygon:ze,bounds:Qe}of Ie){let lt=0,tt=0;for(const ot of ze)O&&!ot[0].equals(ot[ot.length-1])&&ot.push(ot[0]),tt+=O?ot.length-1:ot.length;const rt=this.segments.prepareSegment((O?5:4)*tt,this.layoutVertexArray,this.indexArray);W.footprintSegIdx<0&&(W.footprintSegIdx=this.footprintSegments.length),W.polygonSegIdx<0&&(W.polygonSegIdx=this.polygonSegments.length);const dt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Xe=new YA;if(Xe.vertexOffset=this.footprintVertices.length,Xe.indexOffset=3*this.footprintIndices.length,Xe.ringIndices=[],O){const ot=[],Ge=[];lt=rt.vertexLength;for(let ft=0;ft<ze.length;ft++){const ut=ze[ft];ut.length&&ft!==0&&Ge.push(ot.length/2);const Gt=[];let At,Lt;At=ut[1].sub(ut[0])._perp()._unit(),Xe.ringIndices.push(ut.length-1);for(let yt=1;yt<ut.length;yt++){const Vt=ut[yt],an=ut[yt===ut.length-1?1:yt+1],St=Vt.clone();if(Pe){Lt=an.sub(Vt)._perp()._unit();const Ft=At.add(Lt)._unit(),Yt=Pe*Math.min(4,1/(At.x*Ft.x+At.y*Ft.y));St.x+=Yt*Ft.x,St.y+=Yt*Ft.y,St.x=Math.round(St.x),St.y=Math.round(St.y),At=Lt}if(!q||Pe!==0&&!Me||Ye(Gt,St)||Gt.push(St),Jg(this.layoutVertexArray,St.x,St.y,0,0,1,1,0),this.wallMode){const Ft=le(yt,ut);Qg(this.wallVertexArray,re.joinNormals[yt],!Ft)}rt.vertexLength++,this.footprintVertices.emplaceBack(Vt.x,Vt.y),ot.push(Vt.x,Vt.y),z&&e_(this.layoutVertexExtArray,M.projectTilePoint(St.x,St.y,p),M.upVector(p,St.x,St.y))}q&&(Pe===0||Me)&&(Gt.length!==0&&Ye(Gt,Gt[0])&&Gt.pop(),this.groundEffect.addData(Gt,Qe,A))}const je=this.wallMode?re.indices:rp(ot,Ge);for(let ft=0;ft<je.length;ft+=3)this.footprintIndices.emplaceBack(Xe.vertexOffset+je[ft+0],Xe.vertexOffset+je[ft+1],Xe.vertexOffset+je[ft+2]),this.indexArray.emplaceBack(lt+je[ft],lt+je[ft+2],lt+je[ft+1]),rt.primitiveLength++;Xe.indexCount+=je.length,Xe.vertexCount+=this.footprintVertices.length-Xe.vertexOffset}for(let ot=0;ot<ze.length;ot++){const Ge=ze[ot];$.startRing(W,Ge[0]);let je=Ge.length>4&&rC(Ge[Ge.length-2],Ge[0],Ge[1]),ft=Pe?J5(Ge[Ge.length-2],Ge[0],Ge[1],Pe):0;const ut=[];let Gt,At,Lt;At=Ge[1].sub(Ge[0])._perp()._unit();let yt=!0;for(let Vt=1,an=0;Vt<Ge.length;Vt++){let St=Ge[Vt-1],Ft=Ge[Vt];const Yt=Ge[Vt===Ge.length-1?1:Vt+1];if($.appendEdge(W,Ft,St),yb(Ft,St,Qe)){Pe&&(At=Yt.sub(Ft)._perp()._unit(),yt=!yt);continue}const dn=Ft.sub(St)._perp(),En=dn.x/(Math.abs(dn.x)+Math.abs(dn.y)),mn=dn.y>0?1:0,kt=St.dist(Ft);if(an+kt>32768&&(an=0),Pe){Lt=Yt.sub(Ft)._perp()._unit();let de=nC(St,Ft,Yt,tC(At,Lt),Pe);isNaN(de)&&(de=0);const Ue=Ft.sub(St)._unit();St=St.add(Ue.mult(ft))._round(),Ft=Ft.add(Ue.mult(-de))._round(),ft=de,At=Lt,q&&this.zoom>=17&&(Ye(ut,St)||ut.push(St),Ye(ut,Ft)||ut.push(Ft))}const fn=rt.vertexLength,Fn=Ge.length>4&&rC(St,Ft,Yt);let he=sC(an,je,yt);if(Jg(this.layoutVertexArray,St.x,St.y,En,mn,0,0,he),Jg(this.layoutVertexArray,St.x,St.y,En,mn,0,1,he),this.wallMode){const de=le(Vt-1,Ge),Ue=re.joinNormals[Vt-1];Qg(this.wallVertexArray,Ue,de),Qg(this.wallVertexArray,Ue,de)}if(an+=kt,he=sC(an,Fn,!yt),je=Fn,Jg(this.layoutVertexArray,Ft.x,Ft.y,En,mn,0,0,he),Jg(this.layoutVertexArray,Ft.x,Ft.y,En,mn,0,1,he),this.wallMode){const de=le(Vt,Ge),Ue=re.joinNormals[Vt];Qg(this.wallVertexArray,Ue,de),Qg(this.wallVertexArray,Ue,de)}if(rt.vertexLength+=4,this.indexArray.emplaceBack(fn+0,fn+1,fn+2),this.indexArray.emplaceBack(fn+1,fn+3,fn+2),rt.primitiveLength+=2,Pe){const de=lt+(Vt===1?Ge.length-2:Vt-2),Ue=Vt===1?lt:de+1;if(this.indexArray.emplaceBack(fn+1,de,fn+3),this.indexArray.emplaceBack(de,Ue,fn+3),rt.primitiveLength+=2,Gt===void 0&&(Gt=fn),!yb(Yt,Ge[Vt],Qe)){const Ke=Vt===Ge.length-1?Gt:rt.vertexLength;this.indexArray.emplaceBack(fn+2,fn+3,Ke),this.indexArray.emplaceBack(fn+3,Ke+1,Ke),this.indexArray.emplaceBack(fn+3,Ue,Ke+1),rt.primitiveLength+=3}yt=!yt}if(z){const de=this.layoutVertexExtArray,Ue=M.projectTilePoint(St.x,St.y,p),Ke=M.projectTilePoint(Ft.x,Ft.y,p),Tt=M.upVector(p,St.x,St.y),bt=M.upVector(p,Ft.x,Ft.y);e_(de,Ue,Tt),e_(de,Ue,Tt),e_(de,Ke,bt),e_(de,Ke,bt)}}O&&(lt+=Ge.length-1),q&&Pe&&this.zoom>=17&&(ut.length!==0&&Ye(ut,ut[0])&&ut.pop(),this.groundEffect.addData(ut,Qe,A,Pe>0))}this.footprintSegments.push(Xe),dt.triangleCount=this.indexArray.length-dt.triangleArrayOffset,this.polygonSegments.push(dt),++W.footprintSegLen,++W.polygonSegLen}if(W.vertexCount=this.layoutVertexArray.length-W.vertexArrayOffset,W.groundVertexCount=this.groundEffect.vertexArray.length-W.groundVertexArrayOffset,W.vertexCount!==0){if(W.centroidXY=$.borders?KA:this.encodeCentroid($,W),this.centroidData.push(W),$.borders){this.featuresOnBorder.push($);const ze=this.featuresOnBorder.length-1;for(let Qe=0;Qe<$.borders.length;Qe++)$.borders[Qe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Qe].push(ze)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,m,v,p,S,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(r,u,m,v,p,S,this.worldview),this.maxHeight=Math.max(this.maxHeight,ie)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,l)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}splitToSubtiles(){const e=[];for(let v=0;v<this.centroidData.length;v++){const b=this.centroidData[v],S=+(b.min.y+b.max.y>vt),A=2*S+(+(b.min.x+b.max.x>vt)^S);for(let C=0;C<b.polygonSegLen;C++){const M=b.polygonSegIdx+C;e.push({centroidIdx:v,subtile:A,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const r=new xr;e.sort((v,b)=>v.triangleSegmentIdx===b.triangleSegmentIdx?v.subtile-b.subtile:v.triangleSegmentIdx-b.triangleSegmentIdx);let l=0,u=0,p=0;for(const v of e){if(v.triangleSegmentIdx!==l)break;p++}const m=e.length;for(;u!==e.length;){l=e[u].triangleSegmentIdx;let v=0,b=u,S=u;for(let A=b;A<p&&e[A].subtile===v;A++)S++;for(;b!==p;){const A=e[b];v=A.subtile;const C=this.centroidData[A.centroidIdx].min.clone(),M=this.centroidData[A.centroidIdx].max.clone(),z={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let O=b;O<S;O++){const $=e[O],W=this.polygonSegments[$.polygonSegmentIdx],q=this.centroidData[$.centroidIdx].min,ie=this.centroidData[$.centroidIdx].max,re=this.indexArray.uint16;for(let le=W.triangleArrayOffset;le<W.triangleArrayOffset+W.triangleCount;le++)r.emplaceBack(re[3*le],re[3*le+1],re[3*le+2]);z.primitiveLength+=W.triangleCount,C.x=Math.min(C.x,q.x),C.y=Math.min(C.y,q.y),M.x=Math.max(M.x,ie.x),M.y=Math.max(M.y,ie.y)}z.primitiveLength>0&&this.triangleSubSegments.push({segment:z,min:C,max:M}),b=S;for(let O=b;O<p&&e[O].subtile===e[b].subtile;O++)S++}u=p;for(let A=u;A<m&&e[A].triangleSegmentIdx===e[u].triangleSegmentIdx;A++)p++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,l){const u=new Oi;if(this.wallMode){for(const $ of this.triangleSubSegments)u.segments.push($.segment);return u}let p=0,m=0;const v=1<<e.canonical.z;if(r){const $=r.getMinMaxForTile(e);$&&(p=$.min,m=$.max)}m+=this.maxHeight;const b=e.toUnwrapped();let S;const A=[b.canonical.x/v+b.wrap,b.canonical.y/v],C=[(b.canonical.x+1)/v+b.wrap,(b.canonical.y+1)/v],M=($,W,q)=>[$[0]*(1-q[0])+W[0]*q[0],$[1]*(1-q[1])+W[1]*q[1]],z=[],O=[];for(const $ of this.triangleSubSegments){z[0]=$.min.x/vt,z[1]=$.min.y/vt,O[0]=$.max.x/vt,O[1]=$.max.y/vt;const W=M(A,C,z),q=M(A,C,O);if(new Qt([W[0],W[1],p],[q[0],q[1],m]).intersectsPrecise(l)===0){S&&(u.segments.push(S),S=void 0);continue}const ie=$.segment;S&&S.vertexOffset!==ie.vertexOffset&&(u.segments.push(S),S=void 0),S?(S.vertexLength+=ie.vertexLength,S.primitiveLength+=ie.primitiveLength):S={vertexOffset:ie.vertexOffset,primitiveLength:ie.primitiveLength,vertexLength:ie.vertexLength,primitiveOffset:ie.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&u.segments.push(S),u}encodeCentroid(e,r){const l=e.centroid(),u=r.span(),p=Math.min(7,Math.round(u.x*this.tileToMeter/10)),m=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new ct(Se(l.x,1,vt-1)<<3|p,Se(l.y,1,vt-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new ct(0,0);const r=e.borders,l=Number.MAX_VALUE;if(r[0][0]!==l||r[1][0]!==l){const u=r[0][0]!==l?0:1;return new ct(6|(r[0][0]!==l?0:65528),(r[u][0]+r[u][1])/2<<3|6)}{const u=r[2][0]!==l?2:3;return new ct((r[u][0]+r[u][1])/2<<3|6,6|(r[2][0]!==l?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=2147483647,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,u=e.flags&Su?KA:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==u.y||p!==u.x){for(let m=r;m<l;++m)this.centroidVertexArray.emplace(m,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,l){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const u=r.getReplacementRegionsForTile(e.toUnwrapped());if(yx(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const p=[];for(const m of this.activeReplacements){if(m.order<l)continue;const v=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));if(m.footprint.buildingId){const b=m.footprint.buildingId;for(const S of this.centroidData)S.buildingId===b&&(S.flags|=Su)}else for(const b of this.centroidData)if(!(b.flags&Su||m.min.x>b.max.x||b.min.x>m.max.x||m.min.y>b.max.y||b.min.y>m.max.y))for(let S=0;S<b.footprintSegLen;S++){const A=this.footprintSegments[b.footprintSegIdx+S];if(p.length=0,Q5(this.footprintVertices,A.vertexOffset,A.vertexCount,m.footprintTileId.canonical,e.canonical,p),fb(m.footprint,p,this.footprintIndices.uint16,A.indexOffset,A.indexCount,-A.vertexOffset,-v)){b.flags|=Su;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,l){let u=!1;for(let p=0;p<l.footprintSegLen;p++){const m=this.footprintSegments[l.footprintSegIdx+p];let v=0;for(const b of m.ringIndices){for(let S=v,A=b+v-1;S<b+v;A=S++){const C=this.footprintVertices.int16[2*(S+m.vertexOffset)+0],M=this.footprintVertices.int16[2*(S+m.vertexOffset)+1],z=this.footprintVertices.int16[2*(A+m.vertexOffset)+1];M>r!=z>r&&e<(this.footprintVertices.int16[2*(A+m.vertexOffset)+0]-C)*(r-M)/(z-M)+C&&(u=!u)}v=b}}return u}getHeightAtTileCoord(e,r){let l=Number.NEGATIVE_INFINITY,u=!0;const p=4*(e+vt)*vt+(r+vt);if(this.partLookup.hasOwnProperty(p)){const m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&Su)}:void 0}for(const m of this.centroidData)e>m.max.x||m.min.x>e||r>m.max.y||m.min.y>r||m.height<=l||this.footprintContainsPoint(e,r,m)&&(l=m.height,this.partLookup[p]=m,u=!!(m.flags&Su));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.partLookup[p]=void 0}}function tC(s,e){const r=s.add(e)._unit();return s.x*r.x+s.y*r.y}function J5(s,e,r,l){const u=e.sub(s)._perp()._unit(),p=r.sub(e)._perp()._unit();return nC(s,e,r,tC(u,p),l)}function nC(s,e,r,l,u){const p=Math.sqrt(1-l*l);return Math.min(s.dist(e)/3,e.dist(r)/3,u*p/l)}function yb(s,e,r){return s.x<r[0].x&&e.x<r[0].x||s.x>r[1].x&&e.x>r[1].x||s.y<r[0].y&&e.y<r[0].y||s.y>r[1].y&&e.y>r[1].y}function iC(s,e){return s.x<e[0].x||s.x>e[1].x||s.y<e[0].y||s.y>e[1].y}function rC(s,e,r){if(s.x<0||s.x>=vt||e.x<0||e.x>=vt||r.x<0||r.x>=vt)return!1;const l=r.sub(e),u=l.perp(),p=s.sub(e);return(l.x*p.x+l.y*p.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(p.x*p.x+p.y*p.y))>-.866&&u.x*p.x+u.y*p.y<0}function sC(s,e,r){const l=e?2|s:-3&s;return r?1|l:-2&l}function oC(){const s=Math.PI/32,e=Math.tan(s),r=j;return r*Math.sqrt(1+2*e*e)-r}function aC(s,e,r){const l=1<<r.z,u=ve(r.x/l),p=ve((r.x+1)/l),m=_e(r.y/l),v=_e((r.y+1)/l);return function(b,S,A,C,M=0,z){const O=[];if(!b.length||!A||!C)return O;const $=(be,Ie)=>{for(const Pe of be)O.push({polygon:Pe,bounds:Ie})},W=Math.ceil(Math.log2(A)),q=Math.ceil(Math.log2(C)),ie=W-q,re=[];for(let be=0;be<Math.abs(ie);be++)re.push(ie>0?0:1);for(let be=0;be<Math.min(W,q);be++)re.push(0),re.push(1);let le=b;if(le=mx(le,S[0].y-M,S[1].y+M,1),le=mx(le,S[0].x-M,S[1].x+M,0),!le.length)return O;const we=[];for(re.length?we.push({polygons:le,bounds:S,depth:0}):$(le,S);we.length;){const be=we.pop(),Ie=be.depth,Pe=re[Ie],Me=be.bounds[0],Ye=be.bounds[1],ze=Pe===0?Me.x:Me.y,Qe=Pe===0?Ye.x:Ye.y,lt=z?z(Pe,ze,Qe):.5*(ze+Qe),tt=mx(be.polygons,ze-M,lt+M,Pe),rt=mx(be.polygons,lt-M,Qe+M,Pe);if(tt.length){const dt=[Me,new ct(Pe===0?lt:Ye.x,Pe===1?lt:Ye.y)];re.length>Ie+1?we.push({polygons:tt,bounds:dt,depth:Ie+1}):$(tt,dt)}if(rt.length){const dt=[new ct(Pe===0?lt:Me.x,Pe===1?lt:Me.y),Ye];re.length>Ie+1?we.push({polygons:rt,bounds:dt,depth:Ie+1}):$(rt,dt)}}return O}(s,e,Math.ceil((p-u)/11.25),Math.ceil((m-v)/11.25),1,(b,S,A)=>{if(b===0)return .5*(S+A);{const C=_e((r.y+S/vt)/l);return(ye(.5*(_e((r.y+A/vt)/l)+C))*l-r.y)*vt}})}function Q5(s,e,r,l,u,p){const m=Math.pow(2,l.z-u.z);for(let v=0;v<r;v++){let b=s.int16[2*(v+e)+0],S=s.int16[2*(v+e)+1];b=(b+u.x*vt)*m-l.x*vt,S=(S+u.y*vt)*m-l.y*vt,p.push(new ct(b,S))}}let lC,cC;Pt(xx,"FillExtrusionBucket",{omit:["layers","features"]}),Pt(JA,"PartData"),Pt(YA,"FootprintSegment"),Pt(QA,"BorderCentroidData"),Pt(_b,"GroundEffect");class nd extends ct{constructor(e,r,l){super(e,r),this.z=l}}class uC extends nd{constructor(e,r,l,u){super(e,r,l),this.w=u}}function hC(s,e,r,l){const u=r==="x"?"y":"x",p=(l-s[r])/(e[r]-s[r]);s[u]=Math.round(s[u]+(e[u]-s[u])*p),s[r]=l,s.hasOwnProperty("z")&&(s.z=Kt(s.z,e.z,p)),s.hasOwnProperty("w")&&(s.w=Kt(s.w,e.w,p))}function dC(s,e,r,l){const u=r,p=l;for(const m of["x","y"]){let v=s,b=e;v[m]>=b[m]&&(v=e,b=s),v[m]<u&&b[m]>u&&hC(v,b,m,u),v[m]<p&&b[m]>p&&hC(b,v,m,p)}}function wx(s,e,r,l,u,p){const m=[];for(let v=0;v<s.length;v++){const b=s[v];let S;const A=m.length;let C=0;for(let M=0;M<b.length-1;M++){let z=b[M],O=b[M+1],$=0;const W=C;let q,ie;p&&($=Math.hypot(O.x-z.x,O.y-z.y),C+=$,q=z,ie=O),z.x<e&&O.x<e||(z.x<e?z=new ct(e,z.y+(e-z.x)/(O.x-z.x)*(O.y-z.y))._round():O.x<e&&(O=new ct(e,z.y+(e-z.x)/(O.x-z.x)*(O.y-z.y))._round()),z.y<r&&O.y<r||(z.y<r?z=new ct(z.x+(r-z.y)/(O.y-z.y)*(O.x-z.x),r)._round():O.y<r&&(O=new ct(z.x+(r-z.y)/(O.y-z.y)*(O.x-z.x),r)._round()),z.x>=l&&O.x>=l||(z.x>=l?z=new ct(l,z.y+(l-z.x)/(O.x-z.x)*(O.y-z.y))._round():O.x>=l&&(O=new ct(l,z.y+(l-z.x)/(O.x-z.x)*(O.y-z.y))._round()),z.y>=u&&O.y>=u||(z.y>=u?z=new ct(z.x+(u-z.y)/(O.y-z.y)*(O.x-z.x),u)._round():O.y>=u&&(O=new ct(z.x+(u-z.y)/(O.y-z.y)*(O.x-z.x),u)._round()),S&&z.equals(S[S.length-1])||(S=[z],m.push(S),p&&p.push({progress:{min:W+fC(q,ie,z)*$,max:1},parentIndex:v,prevPoint:q,nextPoint:ie})),S.push(O),p&&(p[p.length-1].progress.max=W+fC(q,ie,O)*$,p[p.length-1].nextPoint=ie)))))}if(p&&C>0)for(let M=A;M<m.length;M++)p[M].progress.min/=C,p[M].progress.max/=C}return m}function ej(s,e,r,l,u){if(s.length<2)return void l.push(s);const p=[];for(;e.valid();){const[S,A]=e.get();for(let C=0;C<s.length-1;C++){const M=s[C],z=s[C+1],O=qi(M,z,S,A);if(O){const[$]=O,W=new ct(Kt(M.x,z.x,$),Kt(M.y,z.y,$));p.push({t:C+$,distance:0,point:W})}}e.next()}if(p.length===0)return void l.push(s);p.sort((S,A)=>S.t-A.t);let m=0,v=0,b=[];for(l.push(b);m!==s.length;){if(v===p.length){for(;m!==s.length;)b.length!==0&&b[b.length-1].equals(s[m])||b.push(s[m]),m++;break}p[v].t<=m?(b.length!==0&&b[b.length-1].equals(p[v].point)||b.push(p[v].point),Math.trunc(p[v].t),v++):(b.length!==0&&b[b.length-1].equals(s[m])||b.push(s[m]),m++)}}function fC(s,e,r){return s.x!==e.x?(r.x-s.x)/(e.x-s.x):s.y!==e.y?(r.y-s.y)/(e.y-s.y):0}function t_(s,e){return s.x*e.x+s.y*e.y}function pC(s,e){if(s.length===1){let r=0;const l=e[r++];let u;for(;!u||l.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const p=e[r],m=s[0],v=u.sub(l),b=p.sub(l),S=m.sub(l),A=t_(v,v),C=t_(v,b),M=t_(b,b),z=t_(S,v),O=t_(S,b),$=A*M-C*C,W=(M*z-C*O)/$,q=(A*O-C*z)/$,ie=l.z*(1-W-q)+u.z*W+p.z*q;if(isFinite(ie))return ie}return 1/0}{let r=1/0;for(const l of e)r=Math.min(r,l.z);return r}}function mC(s,e,r,l,u,p,m,v){const b=m*u.getElevationAt(s,e,!0,!0),S=p[0]!==0,A=S?p[1]===0?m*(p[0]/7-450):m*function(C,M,z){const O=Math.floor(M[0]/8),$=Math.floor(M[1]/8),W=10*(M[0]-8*O),q=10*(M[1]-8*$),ie=C.getElevationAt(O,$,!0,!0),re=C.getMeterToDEM(z),le=Math.floor(.5*(W*re-1)),we=Math.floor(.5*(q*re-1)),be=C.tileCoordToPixel(O,$),Ie=2*le+1,Pe=2*we+1,Me=function(rt,dt,Xe,ot,Ge){return[rt.getElevationAtPixel(dt,Xe,!0),rt.getElevationAtPixel(dt+Ge,Xe,!0),rt.getElevationAtPixel(dt,Xe+Ge,!0),rt.getElevationAtPixel(dt+ot,Xe+Ge,!0)]}(C,be.x-le,be.y-we,Ie,Pe),Ye=Math.abs(Me[0]-Me[1]),ze=Math.abs(Me[2]-Me[3]),Qe=Math.abs(Me[0]-Me[2])+Math.abs(Me[1]-Me[3]),lt=Math.min(.25,.5*re*(Ye+ze)/Ie),tt=Math.min(.25,.5*re*Qe/Pe);return ie+Math.max(lt*W,tt*q)}(u,p,v):b;return{base:b+(r===0?-1:r),top:S?Math.max(A+l,b+r+2):b+l}}class tj{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class nj{constructor(){this.tasks={},this.taskQueue=[],tn(["process"],this),this.invoker=new tj(this.process),this.nextId=0}add(e,r){const l=this.nextId++,u=function({type:p,isSymbolTile:m,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||m?p!=="parseTile"||m?p==="parseTile"&&m?300-v:p==="maybePrepare"&&m?400-v:500:200-v:100-v}(r);if(u===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:r,priority:u,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<r&&(r=p.priority,e=u)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class gC{constructor(e,r,l){this.target=e,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},tn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new nj}send(e,r,l,u,p=!1,m){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=m,this.callbacks[v]=l);const b=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!l,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:yl(r,b)},b),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const r=e.data;if(!r)return;const l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(r.mustQueue||fi(self)){const u=this.callbacks[l],p=this.scheduler.add(()=>this.processTask(l,r),u&&u.metadata||{type:"message"});p&&(this.cancelCallbacks[l]=p)}else this.processTask(l,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(r.error?l(vl(r.error)):l(null,vl(r.data)))}else{const l=new Set,u=r.hasCallback?(m,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?yl(m):null,data:yl(v,l)},l)}:()=>{},p=vl(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,p,u);else if(this.parent.getWorkerSource){const m=r.type.split("."),{source:v,scope:b}=p;this.parent.getWorkerSource(r.sourceMapId,m[0],v,b)[m[1]](p,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var n_={workerUrl:"",workerClass:null,workerParams:void 0};const vb="mapboxgl_preloaded_worker_pool";class id{constructor(){this.active={}}acquire(e,r=id.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<r;)this.workers.push(n_.workerClass!=null?new n_.workerClass:new self.Worker(n_.workerUrl,n_.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[vb]}numActive(){return Object.keys(this.active).length}}id.workerCount=2;class op{constructor(e,r,l="Worker",u=id.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=st();const p=this.workerPool.acquire(this.id,u);for(let m=0;m<p.length;m++){const v=new op.Actor(p[m],r,this.id);v.name=`${l} ${m}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,l){He(this.actors,(u,p)=>{u.send(e,r,p)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let i_,xb;function bx(){return i_||(i_=new id),i_}op.Actor=gC;class ij{constructor(e){this.module=e}createIntArray(e){const r=new Int32Array(e),l=this.module.malloc(r.length*r.BYTES_PER_ELEMENT);return this.module.heap32.set(r,l/r.BYTES_PER_ELEMENT),l}createFloatArray(e){const r=new Float32Array(e),l=this.module.malloc(r.length*r.BYTES_PER_ELEMENT);return this.module.heapF32.set(r,l/r.BYTES_PER_ELEMENT),l}createStringBuffer(e){const r=this.module.malloc(e.length+1);for(let l=0;l<e.length;++l)this.module.heapU8[r+l]=e.charCodeAt(l);return this.module.heapU8[r+e.length]=0,r}readStringBuffer(e){let r="";for(;this.module.heapU8[e]!==0;)r+=String.fromCharCode(this.module.heapU8[e]),++e;return r}setStyle(e){const r=e.entranceColorRgb,l=e.facadeGlazingColorRgb,u=e.roofColorRgb,p=e.wallColorRgb,m=e.normalScale;this.module.setStyle(r[0],r[1],r[2],l[0],l[1],l[2],u[0],u[1],u[2],p[0],p[1],p[2],m[0],m[1],m[2],e.tileToMeters)}setAOOptions(e,r){this.module.setAOOptions(e?1:0,r)}setMetricOptions(e,r){this.module.setMetricOptions(e?1:0,r)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,r){this.module.setFacadeOptions(e,r?1:0)}setFauxFacadeOptions(e,r,l){this.module.setFauxFacadeOptions(e?1:0,r?1:0,l)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,r){for(const v of e){const b=this.createStringBuffer(v.roofType),S=[0],A=[];for(const z of v.coordinates)if(Array.isArray(z)){for(const O of z)A.push(O.x),A.push(O.y);S.push(A.length)}const C=this.createIntArray(S),M=this.createFloatArray(A);this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,b,v.roofType.length,M,C,S.length-1),this.module.free(b),this.module.free(C),this.module.free(M)}for(const v of r){let b;b=v.entrances?JSON.parse(v.entrances):[];const S=this.createFloatArray(b),A=[];for(const M of v.coordinates)A.push(M.x),A.push(M.y);const C=this.createFloatArray(A);this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,S,b.length,C,A.length),this.module.free(S),this.module.free(C)}if(!this.module.generateMesh()){const v=this.module.getLastError();return this.readStringBuffer(v)}const l=this.module.getMeshCount(),u=new Array(l);for(let v=0;v<l;v++){const b=this.module.getPositionsPtr(v),S=this.module.getPositionsLength(v),A=new Float32Array(this.module.heapF32.buffer,b,S),C=this.module.getNormalsPtr(v),M=this.module.getNormalsLength(v),z=new Float32Array(this.module.heapF32.buffer,C,M),O=this.module.getColorsPtr(v),$=this.module.getColorsLength(v),W=new Uint8Array(this.module.heapU8.buffer,O,$),q=this.module.getAOPtr(v),ie=this.module.getAOLength(v),re=new Float32Array(this.module.heapF32.buffer,q,ie),le=this.module.getUVPtr(v),we=this.module.getUVLength(v),be=new Float32Array(this.module.heapF32.buffer,le,we),Ie=this.module.getFauxFacadePtr(v),Pe=this.module.getFauxFacadeLength(v),Me=new Uint8Array(this.module.heapU8.buffer,Ie,Pe),Ye=this.module.getIndicesPtr(v),ze=this.module.getIndicesLength(v),Qe=new Int32Array(this.module.heap32.buffer,Ye,ze),lt=this.module.getBuildingPart(v),tt=this.readStringBuffer(lt);u[v]={positions:A,normals:z,colors:W,ao:re,uv:be,isFauxFacade:Me,indices:Qe,buildingPart:tt}}const p=this.module.getRingCount(),m=[];for(let v=0;v<p;v++){const b=this.module.getRingPtr(v),S=this.module.getRingLength(v),A=new Float32Array(this.module.heapF32.buffer,b,S);m.push(A)}return{meshes:u,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:m}}}let r_,wb,ja,ap,bb,lp=null,cp=null,_C=null,Tx=null;function yC(){return fi(self)&&self.worker.dracoUrl?self.worker.dracoUrl:wb||as.DRACO_URL}function vC(){if(fi(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(ap)return ap;const s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return ap=WebAssembly.validate(s)?as.MESHOPT_SIMD_URL:as.MESHOPT_URL,ap}function rj(){return Tx}const Sx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},sj={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},s_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function xC(s,e,r){const l=r.json.bufferViews.length,u=r.buffers.length;e.bufferView=l,r.json.bufferViews[l]={buffer:u,byteLength:s.byteLength},r.buffers[u]=s}const Tb="KHR_draco_mesh_compression";function oj(s,e){const r=s.extensions&&s.extensions[Tb];if(!r)return;const l=new ja.Decoder,u=SC(e,r.bufferView),p=new ja.Mesh;if(!l.DecodeArrayToMesh(u,u.byteLength,p))throw new Error("Failed to decode Draco mesh");const m=e.json.accessors[s.indices],v=Sx[m.componentType],b=m.count*v.BYTES_PER_ELEMENT,S=ja._malloc(b);v===Uint16Array?l.GetTrianglesUInt16Array(p,b,S):l.GetTrianglesUInt32Array(p,b,S),xC(ja.memory.buffer.slice(S,S+b),m,e),ja._free(S);for(const A of Object.keys(r.attributes)){const C=l.GetAttributeByUniqueId(p,r.attributes[A]),M=e.json.accessors[s.attributes[A]],z=sj[M.componentType],O=M.count*s_[M.type]*Sx[M.componentType].BYTES_PER_ELEMENT,$=ja._malloc(O);l.GetAttributeDataArrayForAllPoints(p,C,ja[z],O,$),xC(ja.memory.buffer.slice($,$+O),M,e),ja._free($)}l.destroy(),p.destroy(),delete s.extensions[Tb]}const Ex="EXT_meshopt_compression";function aj(s,e){if(!s.extensions||!s.extensions[Ex])return;const r=s.extensions[Ex],l=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),u=new Uint8Array(r.count*r.byteStride);bb.decodeGltfBuffer(u,r.count,r.byteStride,l,r.mode,r.filter),s.buffer=e.buffers.length,s.byteOffset=0,e.buffers[s.buffer]=u.buffer,delete s.extensions[Ex]}const wC=1179937895,bC=new TextDecoder("utf8");function TC(s,e){return new URL(s,e).href}function lj(s,e,r,l){return fetch(TC(s.uri,l)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[r]=u})}function SC(s,e){const r=s.json.bufferViews[e];return new Uint8Array(s.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function cj(s,e,r,l){if(s.uri){const u=TC(s.uri,l);return fetch(u).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{e.images[r]=p})}if(s.bufferView!==void 0){const u=SC(e,s.bufferView),p=new Blob([u],{type:s.mimeType});return createImageBitmap(p).then(m=>{e.images[r]=m})}}function EC(s,e=0,r){const l={json:null,images:[],buffers:[]};if(new Uint32Array(s,e,1)[0]===wC){const A=new Uint32Array(s,e);let C=2;const M=(A[C++]>>2)-3,z=A[C++]>>2;if(C++,l.json=JSON.parse(bC.decode(A.subarray(C,C+z))),C+=z,C<M){const O=A[C++];C++;const $=e+(C<<2);l.buffers[0]=s.slice($,$+O)}}else l.json=JSON.parse(bC.decode(new Uint8Array(s,e)));const{buffers:u,images:p,meshes:m,extensionsUsed:v,bufferViews:b}=l.json;let S=Promise.resolve();if(u){const A=[];for(let C=0;C<u.length;C++){const M=u[C];M.uri?A.push(lj(M,l,C,r)):l.buffers[C]||(l.buffers[C]=null)}S=Promise.all(A)}return S.then(()=>{const A=[],C=v&&v.includes(Tb),M=v&&v.includes(Ex);if(C&&A.push(function(){if(!ja)return r_??(r_=function(z){let O,$=null;function W(){O=new Uint8Array($.buffer)}function q(){throw new Error("Unexpected Draco error.")}const ie={a:{a:q,d:function(re,le,we){return O.copyWithin(re,le,le+we)},c:function(re){const le=O.length,we=Math.max(re>>>0,Math.ceil(1.2*le)),be=Math.ceil((we-le)/65536);try{return $.grow(be),W(),!0}catch{return!1}},b:q}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(z,ie):z.then(re=>re.arrayBuffer()).then(re=>WebAssembly.instantiate(re,ie))).then(re=>{const{Rb:le,Qb:we,P:be,T:Ie,X:Pe,Ja:Me,La:Ye,Qa:ze,Va:Qe,Wa:lt,eb:tt,jb:rt,f:dt,e:Xe,yb:ot,zb:Ge,Ab:je,Bb:ft,Db:ut,Gb:Gt}=re.instance.exports;$=Xe;const At=(()=>{let Lt=0,yt=0,Vt=0,an=0;return St=>{Vt&&(le(an),le(Lt),yt+=Vt,Vt=Lt=0),Lt||(yt+=128,Lt=we(yt));const Ft=St.length+7&-8;let Yt=Lt;Ft>=yt&&(Vt=Ft,Yt=an=we(Ft));for(let dn=0;dn<St.length;dn++)O[Yt+dn]=St[dn];return Yt}})();return W(),dt(),{memory:Xe,_free:le,_malloc:we,Mesh:class{constructor(){this.ptr=be()}destroy(){Ie(this.ptr)}},Decoder:class{constructor(){this.ptr=Me()}destroy(){rt(this.ptr)}DecodeArrayToMesh(Lt,yt,Vt){const an=At(Lt),St=Ye(this.ptr,an,yt,Vt.ptr);return!!Pe(St)}GetAttributeByUniqueId(Lt,yt){return{ptr:ze(this.ptr,Lt.ptr,yt)}}GetTrianglesUInt16Array(Lt,yt,Vt){Qe(this.ptr,Lt.ptr,yt,Vt)}GetTrianglesUInt32Array(Lt,yt,Vt){lt(this.ptr,Lt.ptr,yt,Vt)}GetAttributeDataArrayForAllPoints(Lt,yt,Vt,an,St){tt(this.ptr,Lt.ptr,yt.ptr,Vt,an,St)}},DT_INT8:ot(),DT_UINT8:Ge(),DT_INT16:je(),DT_UINT16:ft(),DT_UINT32:ut(),DT_FLOAT32:Gt()}})}(fetch(yC())),r_.then(z=>{ja=z,r_=void 0}))}()),M&&A.push(function(){if(bb)return;const z=function(O){let $;const W=WebAssembly.instantiateStreaming(O,{}).then(re=>{$=re.instance,$.exports.__wasm_call_ctors()}),q={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ie={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:W,supported:!0,decodeGltfBuffer(re,le,we,be,Ie,Pe){(function(Me,Ye,ze,Qe,lt,tt,rt){const dt=Me.exports.sbrk,Xe=Qe+3&-4,ot=dt(Xe*lt),Ge=dt(tt.length),je=new Uint8Array(Me.exports.memory.buffer);je.set(tt,Ge);const ft=Ye(ot,Qe,lt,Ge,tt.length);if(ft===0&&rt&&rt(ot,Xe,lt),ze.set(je.subarray(ot,ot+Qe*lt)),dt(ot-dt(0)),ft!==0)throw new Error(`Malformed buffer data: ${ft}`)})($,$.exports[ie[Ie]],re,le,we,be,$.exports[q[Pe]])}}}(fetch(vC()));return z.ready.then(()=>{bb=z})}()),p)for(let z=0;z<p.length;z++)A.push(cj(p[z],l,z,r));return(A.length?Promise.all(A):Promise.resolve()).then(()=>{if(C&&m)for(const{primitives:z}of m)for(const O of z)oj(O,l);if(M&&m&&b)for(const z of b)aj(z,l);return l})})}function Sb(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Eb(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Ib{constructor(e,r,l,u){this.context=e,this.format=l,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(r,{premultiply:u&&u.premultiply})}update(e,r){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:p}=this,{gl:m}=p,{x:v,y:b}=r&&r.position?r.position:{x:0,y:0},S=v+l,A=b+u;!this.size||this.size[0]===S&&this.size[1]===A||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!r||r.premultiply!==!1));const C=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&S>0&&A>0){const M=this.useMipmap?Math.floor(Math.log2(Math.max(S,A)))+1:1;m.texStorage2D(m.TEXTURE_2D,M,this.format,S,A),this.size=[S,A]}this.size&&(C?m.texSubImage2D(m.TEXTURE_2D,0,v,b,Sb(this.format),Eb(this.format),e):"data"in e&&e.data&&m.texSubImage2D(m.TEXTURE_2D,0,v,b,l,u,Sb(this.format),Eb(this.format),e.data)),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,r,l=!1){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,l,u,p){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),r!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?e===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,l),this.wrapS=l),u!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,u),this.wrapT=u),p!==this.compareMode&&(p?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,p)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class o_{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}}const uj=zn([{name:"a_pos_3f",components:3,type:"Float32"}]),hj=zn([{name:"a_color_3f",components:3,type:"Float32"}]),dj=zn([{name:"a_color_4f",components:4,type:"Float32"}]),fj=zn([{name:"a_uv_2f",components:2,type:"Float32"}]),pj=zn([{name:"a_normal_3f",components:3,type:"Float32"}]),mj=zn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),gj=zn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function IC(s,e){const r=Ix(s.projection,s.zoom,s.width,s.height),l=function(p,m,v,b,S){const A=new G(v.lng-180*Eu,v.lat),C=new G(v.lng+180*Eu,v.lat),M=p.project(A.lng,A.lat),z=p.project(C.lng,C.lat),O=-Math.atan2(z.y-M.y,z.x-M.x),$=We.fromLngLat(v);$.y=Se($.y,-1+Eu,1-Eu);const W=$.toLngLat(),q=p.project(W.lng,W.lat),ie=We.fromLngLat(W);ie.x+=Eu;const re=ie.toLngLat(),le=p.project(re.lng,re.lat),we=CC(le.x-q.x,le.y-q.y,O),be=We.fromLngLat(W);be.y+=Eu;const Ie=be.toLngLat(),Pe=p.project(Ie.lng,Ie.lat),Me=CC(Pe.x-q.x,Pe.y-q.y,O),Ye=Math.abs(we.x)/Math.abs(Me.y),ze=K([]);et(ze,ze,-O*(1-(S?0:b)));const Qe=K([]);return ae(Qe,Qe,[1,1-(1-Ye)*b,1]),Qe[4]=-Me.x/Me.y*b,et(Qe,Qe,O),Y(Qe,ze,Qe),Qe}(s.projection,0,s.center,r,e),u=AC(s);return ae(l,l,[u,u,1]),l}function AC(s){const e=s.projection,r=Ix(s.projection,s.zoom,s.width,s.height),l=Ab(e,s.center),u=Ab(e,G.convert(e.center));return Math.pow(2,l*r+(1-r)*u)}function Ix(s,e,r,l,u=1/0){const p=s.range;if(!p)return 0;const m=Math.min(u,Math.max(r,l)),v=Math.log2(m/1024);return $e(p[0]+v,p[1]+v,e)}const Eu=1/4e4;function Ab(s,e){const r=Se(e.lat,-xe,xe),l=new G(e.lng-180*Eu,r),u=new G(e.lng+180*Eu,r),p=s.project(l.lng,r),m=s.project(u.lng,r),v=We.fromLngLat(l),b=We.fromLngLat(u),S=m.x-p.x,A=m.y-p.y,C=b.x-v.x,M=b.y-v.y,z=Math.sqrt((C*C+M*M)/(S*S+A*A));return Math.log2(z)}function CC(s,e,r){const l=Math.cos(r),u=Math.sin(r);return{x:s*l-e*u,y:s*u+e*l}}function PC(s,e,r){K(s),et(s,s,De(e[2])),Te(s,s,De(e[0])),Be(s,s,De(e[1])),ae(s,s,r),Y(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ax(s,e,r,l,u,p,m,v){const b=[r[0]-e[0],r[1]-e[1],0],S=[l[0]-e[0],l[1]-e[1],0];if(ln(b)<1e-12||ln(S)<1e-12)return to(s);const A=ci([],b,S);Vn(A,A),Rn(S,l,e),b[2]=(p-u)*v,S[2]=(m-u)*v;const C=b;return ci(C,b,S),Vn(C,C),io(s,A,C)}function Cb(s,e,r=!1){const l=bu(e.zoom),u=function(p,m,v){const b=m.worldSize,S=[p[12],p[13],p[14]],A=_e(S[1]/b),C=ve(S[0]/b),M=K([]),z=ge(1,A)*b,O=ge(1,0)*b*Re(A,m.zoom),$=1/nb(b);let W=O*$;if(v){const le=Ix(m.projection,m.zoom,m.width,m.height,1024);W=$*m.projection.pixelSpaceConversion(m.center.lat,b,le)}const q=D(A,C);pn(q,q,on([],Vn([],q),z*W*S[2]));const ie=function(le){const we=[le[0],le[1],le[2]];let be=[0,1,0];const Ie=ci([],be,we);return ci(be,we,Ie),ir(be)===0&&(be=[0,1,0],ci(Ie,we,be)),Vn(Ie,Ie),Vn(be,be),Vn(we,we),[Ie[0],Ie[1],Ie[2],0,be[0],be[1],be[2],0,we[0],we[1],we[2],0,le[0],le[1],le[2],1]}(q);ae(M,M,[W,W,W*z]),Q(M,M,[-S[0],-S[1],-S[2]]);const re=Y([],m.globeMatrix,ie);return Y(re,re,M),Y(re,re,p),re}(s,e,r);if(l>0){const p=function(m,v){const b=v.worldSize,S=ge(1,0)*b*Re(v.center.lat,v.zoom)/nb(b),A=ge(1,v.center.lat)*b,C=K([]);Be(C,C,De(v.center.lng)),Te(C,C,De(v.center.lat)),Q(C,C,[0,0,h]),ae(C,C,[S,S,S*A]);const M=v.point;return Q(C,C,[-M.x,-M.y,0]),Y(C,C,m),Y(C,v.globeMatrix,C)}(s,e);return function(m,v,b){const S=(O,$,W)=>{const q=ln(O),ie=ln($),re=bc(O,$,W);return on(re,re,1/ln(re)*Kt(q,ie,W))},A=S([m[0],m[1],m[2]],[v[0],v[1],v[2]],b),C=S([m[4],m[5],m[6]],[v[4],v[5],v[6]],b),M=S([m[8],m[9],m[10]],[v[8],v[9],v[10]],b),z=bc([m[12],m[13],m[14]],[v[12],v[13],v[14]],b);return[A[0],A[1],A[2],0,C[0],C[1],C[2],0,M[0],M[1],M[2],0,z[0],z[1],z[2],1]}(u,p,l)}return u}function MC(s,e,r,l){const u=Qt.projectAabbCorners(l,r);let p=Number.MAX_VALUE,m=-1;for(let S=0;S<u.length;++S){const A=u[S];A[0]=(.5*A[0]+.5)*e.width,A[1]=(.5-.5*A[1])*e.height,A[2]<p&&(m=S,p=A[2])}const v=S=>new ct(u[S][0],u[S][1]);let b;switch(m){case 0:case 6:b=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:b=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:b=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:b=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(po(s,b))return p}const rd=64,up={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function RC(s,e,r,l,u,p,m,v,b,S=!1){const A=r.zoom,C=r.project(l),M=Re(l.lat,A),z=1/M;K(s),Q(s,s,[C.x+m[0]*z,C.y+m[1]*z,m[2]]);let O=1,$=1;const W=r.worldSize;if(S){if(r.projection.name==="mercator"){let le=0;r.elevation&&(le=r.elevation.getAtPointOrZero(new We(C.x/W,C.y/W),0));const we=Nr([],[C.x,C.y,le,1],r.projMatrix)[3]/r.cameraToCenterDistance;O=we,$=we*Re(r.center.lat,A)}else if(r.projection.name==="globe"){const le=Cb(s,r),we=[0,0,0,1];Nr(we,we,Y([],r.projMatrix,le));const be=we[3]/r.cameraToCenterDistance,Ie=bu(A),Pe=r.projection.pixelsPerMeter(l.lat,W)*Re(l.lat,A),Me=r.projection.pixelsPerMeter(r.center.lat,W)*Re(r.center.lat,A);O=be/Kt(Pe,Ne(r.center.lat),Ie),$=be*M/Pe,O*=Me,$*=Me}}else O=z;ae(s,s,[O,O,$]);const q=[...s],ie=e.orientation,re=[];if(PC(re,[ie[0]+u[0],ie[1]+u[1],ie[2]+u[2]],p),Y(s,q,re),v&&r.elevation){let le=0;const we=[];if(b&&r.elevation){le=function(Ie,Pe,Me,Ye,ze){const Qe=Pe.elevation;if(!Qe)return 0;const lt=Qt.projectAabbCorners(Me,Ye),tt=ge(1,ze.lat)*Pe.worldSize,rt=function(yt,Vt){const an=[0,0,1],St=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ft of St){const Yt=yt[Ft.corners[0]],dn=yt[Ft.corners[1]],En=yt[Ft.corners[2]],mn=[dn[0]-Yt[0],dn[1]-Yt[1],Vt*(dn[2]-Yt[2])],kt=ci(mn,mn,[En[0]-Yt[0],En[1]-Yt[1],Vt*(En[2]-Yt[2])]);Vn(kt,kt),Ft.dotProductWithUp=Wn(kt,an)}return St.sort((Ft,Yt)=>Ft.dotProductWithUp-Yt.dotProductWithUp),St[0].corners}(lt,tt),dt=lt[rt[0]],Xe=lt[rt[1]],ot=lt[rt[2]],Ge=lt[rt[3]],je=Qe.getAtPointOrZero(new We(dt[0]/Pe.worldSize,dt[1]/Pe.worldSize),0),ft=Qe.getAtPointOrZero(new We(Xe[0]/Pe.worldSize,Xe[1]/Pe.worldSize),0),ut=Qe.getAtPointOrZero(new We(ot[0]/Pe.worldSize,ot[1]/Pe.worldSize),0),Gt=Qe.getAtPointOrZero(new We(Ge[0]/Pe.worldSize,Ge[1]/Pe.worldSize),0),At=(je+Gt)/2,Lt=(ft+ut)/2;return At>Lt?ft<ut?Ax(Ie,Xe,Ge,dt,ft,Gt,je,tt):Ax(Ie,ot,dt,Ge,ut,je,Gt,tt):je<Gt?Ax(Ie,dt,Xe,ot,je,ft,ut,tt):Ax(Ie,Ge,ot,Xe,Gt,ut,ft,tt),Math.max(At,Lt)}(we,r,e.aabb,s,l);const be=Y([],Dt([],we),re);Y(s,q,be)}else le=r.elevation.getAtPointOrZero(new We(C.x/W,C.y/W),0);le!==0&&(s[14]+=le)}}function a_(s,e,r=!1){s.uploaded||(s.gfxTexture=new Ib(e,s.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:s.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function _j(s,e,r){s.indexBuffer=e.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=e.createVertexBuffer(s.vertexArray,uj.members,!1,!0),s.normalArray&&(s.normalBuffer=e.createVertexBuffer(s.normalArray,pj.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=e.createVertexBuffer(s.texcoordArray,fj.members,!1,!0)),s.colorArray&&(s.colorBuffer=e.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?hj:dj).members,!1,!0)),s.featureArray&&(s.pbrBuffer=e.createVertexBuffer(s.featureArray,gj.members,!0)),s.segments=Oi.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);const l=s.material;l.pbrMetallicRoughness.baseColorTexture&&a_(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&a_(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&a_(l.normalTexture,e),l.occlusionTexture&&a_(l.occlusionTexture,e,r),l.emissionTexture&&a_(l.emissionTexture,e)}function Pb(s,e,r){if(s.meshes)for(const l of s.meshes)_j(l,e,r);if(s.children)for(const l of s.children)Pb(l,e,r)}function Cx(s){if(s.meshes)for(const e of s.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(s.children)for(const e of s.children)Cx(e)}function Mb(s){if(s.meshes)for(const r of s.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(s.children)for(const r of s.children)Mb(r)}function sd(s,e){const r=s.json.bufferViews[e.bufferView],l=Sx[e.componentType];return new l(s.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==s_[e.type]*l.BYTES_PER_ELEMENT?r.byteStride/l.BYTES_PER_ELEMENT:s_[e.type]))}function Rb(s,e,r,l){const u=Sx[e.componentType],p=function(A){switch(A){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),m=s.json.bufferViews[e.bufferView],v=m.byteStride?m.byteStride/u.BYTES_PER_ELEMENT:s_[e.type],b=r.float32,S=b.length/r.capacity;for(let A=0,C=0;A<e.count*v;A+=v,C+=S)for(let M=0;M<S;M++)b[C+M]=l[A+M]*p;r._trim()}function yj(s,e,r){const l=s.indices,u=s.attributes,p={};p.indexArray=new xr;const m=e.json.accessors[l],v=m.count/3;p.indexArray.reserve(v);const b=sd(e,m);for(let M=0;M<v;M++)p.indexArray.emplaceBack(b[3*M],b[3*M+1],b[3*M+2]);p.indexArray._trim(),p.vertexArray=new Rs;const S=e.json.accessors[u.POSITION];p.vertexArray.reserve(S.count);const A=sd(e,S);for(let M=0;M<S.count;M++)p.vertexArray.emplaceBack(A[3*M],A[3*M+1],A[3*M+2]);if(p.vertexArray._trim(),p.aabb=new Qt(S.min,S.max),p.centroid=function(M,z){const O=[0,0,0],$=M.length;if($>0){for(let W=0;W<$;W++){const q=3*M[W];O[0]+=z[q],O[1]+=z[q+1],O[2]+=z[q+2]}O[0]/=$,O[1]/=$,O[2]/=$}return O}(b,A),u.COLOR_0!==void 0){const M=e.json.accessors[u.COLOR_0],z=s_[M.type],O=sd(e,M);p.colorArray=z===3?new Rs:new $o,p.colorArray.resize(M.count),Rb(e,M,p.colorArray,O)}if(u.NORMAL!==void 0){p.normalArray=new Rs;const M=e.json.accessors[u.NORMAL];p.normalArray.resize(M.count);const z=sd(e,M);Rb(e,M,p.normalArray,z)}if(u.TEXCOORD_0!==void 0&&r.length>0){p.texcoordArray=new yu;const M=e.json.accessors[u.TEXCOORD_0];p.texcoordArray.resize(M.count);const z=sd(e,M);Rb(e,M,p.texcoordArray,z)}if(u._FEATURE_ID_RGBA4444!==void 0){const M=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=sd(e,M))}u._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(sd(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const C=s.material;return p.material=function(M,z){const{emissiveFactor:O=[0,0,0],alphaMode:$="OPAQUE",alphaCutoff:W=.5,normalTexture:q,occlusionTexture:ie,emissiveTexture:re,doubleSided:le}=M,{baseColorFactor:we=[1,1,1,1],metallicFactor:be=1,roughnessFactor:Ie=1,baseColorTexture:Pe,metallicRoughnessTexture:Me}=M.pbrMetallicRoughness||{},Ye=ie?z[ie.index]:void 0;if(ie&&ie.extensions&&ie.extensions.KHR_texture_transform&&Ye){const ze=ie.extensions.KHR_texture_transform;Ye.offsetScale=[ze.offset[0],ze.offset[1],ze.scale[0],ze.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Jn(...we),metallicFactor:be,roughnessFactor:Ie,baseColorTexture:Pe?z[Pe.index]:void 0,metallicRoughnessTexture:Me?z[Me.index]:void 0},doubleSided:le,emissiveFactor:new Jn(...O),alphaMode:$,alphaCutoff:W,normalTexture:q?z[q.index]:void 0,occlusionTexture:Ye,emissionTexture:re?z[re.index]:void 0,defined:M.defined===void 0}}(C!==void 0?e.json.materials[C]:{defined:!1},r),p}function kC(s,e,r){const{matrix:l,rotation:u,translation:p,scale:m,mesh:v,extras:b,children:S}=s,A={};if(A.matrix=l||function(C,M,z,O){var $=M[0],W=M[1],q=M[2],ie=M[3],re=$+$,le=W+W,we=q+q,be=$*re,Ie=$*le,Pe=$*we,Me=W*le,Ye=W*we,ze=q*we,Qe=ie*re,lt=ie*le,tt=ie*we,rt=O[0],dt=O[1],Xe=O[2];return C[0]=(1-(Me+ze))*rt,C[1]=(Ie+tt)*rt,C[2]=(Pe-lt)*rt,C[3]=0,C[4]=(Ie-tt)*dt,C[5]=(1-(be+ze))*dt,C[6]=(Ye+Qe)*dt,C[7]=0,C[8]=(Pe+lt)*Xe,C[9]=(Ye-Qe)*Xe,C[10]=(1-(be+Me))*Xe,C[11]=0,C[12]=z[0],C[13]=z[1],C[14]=z[2],C[15]=1,C}([],u||[0,0,0,1],p||[0,0,0],m||[1,1,1]),v!==void 0){A.meshes=r[v];const C=A.anchor=[0,0];for(const M of A.meshes){const{min:z,max:O}=M.aabb;C[0]+=z[0]+O[0],C[1]+=z[1]+O[1]}C[0]=Math.floor(C[0]/A.meshes.length/2),C[1]=Math.floor(C[1]/A.meshes.length/2)}if(b&&(b.id&&(A.id=b.id),b.lights&&(A.lights=function(C){if(!C.length)return[];const M=function(q){const ie=atob(q),re=new Uint8Array(ie.length);for(let le=0;le<ie.length;le++)re[le]=ie.codePointAt(le);return re}(C),z=[],O=M.length/24,$=new Uint16Array(M.buffer),W=new Float32Array(M.buffer);for(let q=0;q<O;q++){const ie=$[2*q*6]/30,re=$[2*q*6+1]/30,le=$[2*q*6+10]/100,we=W[6*q+1],be=W[6*q+2],Ie=W[6*q+3],Pe=W[6*q+4],Me=Ie-we,Ye=Pe-be,ze=Math.hypot(Me,Ye);z.push({pos:[we+.5*Me,be+.5*Ye,re],normal:[Ye/ze,-Me/ze,0],width:ze,height:ie,depth:le,points:[we,be,Ie,Pe]})}return z}(b.lights))),S){const C=[];for(const M of S)C.push(kC(e.json.nodes[M],e,r));A.children=C}return A}function vj(s){if(s.vertices.length===0||s.indices.length===0)return null;const e=new gx(s.vertices,s.indices,8,256),[r,l]=[e.min.clone(),e.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:e,min:r,max:l}}function xj(s){if(!s.extras||!s.extras.ground)return null;const e=s.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const l=[];for(const m of r){if(!Array.isArray(m)||m.length!==2)continue;const v=m[0],b=m[1];typeof v=="number"&&typeof b=="number"&&l.push(new ct(v,b))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let u=0;for(let m=0;m<l.length;m++){const v=l[m],b=l[(m+1)%l.length],S=l[(m+2)%l.length];u+=(v.x-b.x)*(S.y-b.y)-(S.x-b.x)*(v.y-b.y)}u>0&&l.reverse();const p=rp(l.flatMap(m=>[m.x,m.y]),[]);return p.length===0?null:{vertices:l,indices:p}}function wj(s,e){const r=[],l=[];let u=0;const p=[];for(const m of s){u=r.length;const v=m.vertexArray.float32,b=m.indexArray.uint16;for(let S=0;S<m.vertexArray.length;S++)p[0]=v[3*S+0],p[1]=v[3*S+1],p[2]=v[3*S+2],ui(p,p,e),r.push(new ct(p[0],p[1]));for(let S=0;S<3*m.indexArray.length;S++)l.push(b[S]+u)}if(l.length%3!=0)return null;for(let m=0;m<l.length;m+=3){const v=r[l[m+0]],b=r[l[m+1]],S=r[l[m+2]];(v.x-b.x)*(S.y-b.y)-(S.x-b.x)*(v.y-b.y)>0&&([l[m+1],l[m+2]]=[l[m+2],l[m+1]])}return{vertices:r,indices:l}}function DC(s){const e=function(b,S){const A=[],C=WebGL2RenderingContext;if(b.json.textures)for(const M of b.json.textures){const z={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};M.sampler!==void 0&&Object.assign(z,b.json.samplers[M.sampler]),A.push({image:S[M.source],sampler:z,uploaded:!1})}return A}(s,s.images),r=function(b,S){const A=[];for(const C of b.json.meshes){const M=[];for(const z of C.primitives)M.push(yj(z,b,S));A.push(M)}return A}(s,e),{scenes:l,scene:u,nodes:p}=s.json,m=l?l[u||0].nodes:[...p.keys()],v=[];for(const b of m)v.push(kC(p[b],s,r));return function(b,S,A){const C={},M=new Set;for(let z=0;z<b.length;z++){const O=A[S[z]];if(!O.extras)continue;const $=O.extras["mapbox:footprint:version"],W=O.extras["mapbox:footprint:id"];($||W)&&M.add(z),$==="1.0.0"&&W&&(C[W]=z)}for(let z=0;z<b.length;z++){if(M.has(z))continue;const O=b[z],$=A[S[z]];if(!$.extras)continue;let W=null;O.id in C&&(W=wj(b[C[O.id]].meshes,O.matrix)),W||(W=xj($)),W&&(O.footprint=vj(W))}if(M.size>0){const z=Array.from(M.values()).sort((O,$)=>O-$);for(let O=z.length-1;O>=0;O--)b.splice(z[O],1)}}(v,m,s.json.nodes),v}function bj(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);const e=s.vertexArray.float32,r=s.aabb.min[0]-1,l=s.aabb.min[1]-1,u=rd/(s.aabb.max[0]-r+2),p=rd/(s.aabb.max[1]-l+2);for(let m=0;m<e.length;m+=3){const v=e[m+2],b=(e[m+0]-r)*u|0,S=(e[m+1]-l)*p|0;v>s.heightmap[S*rd+b]&&(s.heightmap[S*rd+b]=v)}}function LC(s,e,r,l,u){r.reserve(r.length+4*s.length),l.reserve(l.length+10*s.length),u.reserve(u.length+10*s.length);let p=l.length;for(const m of s){const v=Math.min(10,Math.max(4,1.3*m.height))*e,b=[-m.normal[1],m.normal[0],0],S=Math.min(.29,.1*m.width/m.depth),A=m.width-2*m.depth*e*(S+.01),C=Xn([],m.pos,b,A/2),M=Xn([],m.pos,b,-A/2),z=[C[0],C[1],C[2]+m.height],O=[M[0],M[1],M[2]+m.height],$=Xn([],m.normal,b,S);on($,$,v);const W=Xn([],m.normal,b,-S);on(W,W,v),pn($,C,$),pn(W,M,W),C[2]+=.1,M[2]+=.1,l.emplaceBack($[0],$[1],$[2]),l.emplaceBack(W[0],W[1],W[2]),l.emplaceBack(C[0],C[1],C[2]),l.emplaceBack(M[0],M[1],M[2]),l.emplaceBack(z[0],z[1],z[2]),l.emplaceBack(O[0],O[1],O[2]),l.emplaceBack(C[0],C[1],C[2]),l.emplaceBack(M[0],M[1],M[2]),l.emplaceBack($[0],$[1],$[2]),l.emplaceBack(W[0],W[1],W[2]);const q=A/v/2;u.emplaceBack(-q-S,-1,q,.8),u.emplaceBack(q+S,-1,q,.8),u.emplaceBack(-q,0,q,1.3),u.emplaceBack(q,0,q,1.3),u.emplaceBack(q+S,-.8,q,.7),u.emplaceBack(q+S,-.8,q,.7),u.emplaceBack(0,0,q,1.3),u.emplaceBack(0,0,q,1.3),u.emplaceBack(q+S,-1.2,q,.8),u.emplaceBack(q+S,-1.2,q,.8),r.emplaceBack(6+p,4+p,8+p),r.emplaceBack(7+p,9+p,5+p),r.emplaceBack(0+p,1+p,2+p),r.emplaceBack(1+p,3+p,2+p),p+=10}}function Tj(s,e){const r={};r.indexArray=new xr,r.vertexArray=new Rs,r.colorArray=new $o,LC(s,e,r.indexArray,r.vertexArray,r.colorArray);const l={defined:!0};l.emissiveFactor=Jn.black;const u={};return u.baseColorFactor=Jn.white,l.pbrMetallicRoughness=u,r.material=l,r.aabb=new Qt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}const zC=zn([{name:"a_pos_3f",components:3,type:"Float32"}]),Sj=zn([{name:"a_normal_3",components:3,type:"Int16"}]),Ej=zn([{name:"a_centroid_3",components:3,type:"Int16"}]),OC=zn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Ij=zn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),Aj=zn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Cj=zn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Pj=zn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),FC=at.types,kb=32767;function Mj(s,e){const r=vt+e;for(const l of s)for(const u of l)if(u.x<-e||u.x>r||u.y<-e||u.y>r)return!1;return!0}class NC{constructor(){this.layoutVertexArray=new Rs,this.layoutAttenuationArray=new $o,this.layoutColorArray=new dr,this.indexArray=new xr,this.indexArrayForConflation=new xr,this.segmentsBucket=new Oi}}class Db{constructor(){this.layoutVertexArray=new Rs,this.layoutNormalArray=new _c,this.layoutCentroidArray=new _c,this.layoutColorArray=new dr,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new xr,this.indexArrayForConflation=new xr,this.segmentsBucket=new Oi,this.entranceBloom=new NC}}class BC{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new Db,this.buildingWithFacade=new Db,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new dr,this.buildingWithFacade.layoutFacadeDataArray=new mu,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new dr,this.programConfigurations=new Ho(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection,this.groundEffect=new _b(e)}updateFootprints(e,r){for(const l of this.footprints)r.push({footprint:l,id:e})}prepare(){return function(){if(Tx!=null||_C!=null)return null;if(cp!=null)return cp;const e=fetch(as.BUILDING_GEN_URL);return cp=function(r){let l,u,p,m;function v(){l=new Uint8Array(m.buffer),u=new Int32Array(m.buffer),p=new Float32Array(m.buffer)}function b(){throw new Error("Unexpected BuildingGen error.")}const S=()=>{},A={a:{a:b,f:function(C){const M=l.length,z=Math.max(C>>>0,Math.ceil(1.2*M)),O=Math.ceil((z-M)/65536);try{return m.grow(O),v(),!0}catch{return!1}},g:b,b:S,c:S,d:S,e:S}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(r,A):r.then(C=>C.arrayBuffer()).then(C=>WebAssembly.instantiate(C,A))).then(C=>{const M=C.instance.exports;return(0,M.g)(),m=M.f,v(),new ij({setStyle:M.h,setAOOptions:M.i,setMetricOptions:M.j,setStructuralOptions:M.k,setFacadeOptions:M.l,setFauxFacadeOptions:M.m,setFacadeClassifierOptions:M.n,addFeature:M.o,addFacade:M.p,generateMesh:M.q,getLastError:M.r,getOuterRingLength:M.s,getMeshCount:M.t,getPositionsPtr:M.u,getPositionsLength:M.v,getNormalsPtr:M.w,getNormalsLength:M.x,getColorsPtr:M.y,getColorsLength:M.z,getAOPtr:M.A,getAOLength:M.B,getUVPtr:M.C,getUVLength:M.D,getFauxFacadePtr:M.E,getFauxFacadeLength:M.F,getIndicesPtr:M.G,getIndicesLength:M.H,getBuildingPart:M.I,getRingCount:M.J,getRingPtr:M.K,getRingLength:M.L,free:M.M,malloc:M.N,heapU8:l,heap32:u,heapF32:p})})}(e).then(r=>(cp=null,Tx=r,Tx)).catch(r=>{Dn("Could not load building-gen"),cp=null,_C=r}),cp}()}populate(e,r,l,u){const p=rj();if(!p)return;const m=Oe(l);this.tileToMeter=m,this.brightness=r.brightness,p.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,m],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:m,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),p.setAOOptions(!1,.3),p.setMetricOptions(!1,16),p.setStructuralOptions(!0),p.setFacadeClassifierOptions(3);const v=new Map;for(const{feature:b}of e){if(FC[b.type]!=="LineString")continue;const S=this.layers[0]._featureFilter.needGeometry,A=ht(b,S);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom),A,l))continue;const C=S?A.geometry:It(b,l,u),M=[];for(const W of C)for(const q of W)M.push({x:q.x,y:q.y});const z={coordinates:M,crossPerc:b.properties.cross_perc,distanceToRoad:b.properties.distance_to_road,entrances:b.properties.entrances,sourceId:0},O=b.properties.source_id;let $=v.get(O);$||($=[],v.set(O,$)),$.push(z)}this.maxHeight=0;for(const{feature:b,index:S}of e){if(FC[b.type]==="LineString")continue;const A=this.layers[0]._featureFilter.needGeometry,C=ht(b,A);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom),C,l))continue;const M=A?C.geometry:It(b,l,u),z=Kg(M,500);if(!Mj(M,163))continue;const O=this.layers[0],$=O.layout.get("building-base").evaluate(b,{},l),W=O.layout.get("building-height").evaluate(b,{},l),q=O.layout.get("building-roof-shape").evaluate(b,{},l),ie=O.paint.get("building-ambient-occlusion-intensity"),re=O.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(q==="flat")continue;const le=O.layout.get("building-facade").evaluate(b,{},l);p.setFacadeOptions(4,!0),p.setFauxFacadeOptions(le,!1,1);const we=b.properties.source_id;let be;be=v.has(we)?v.get(we):[];let Ie=0,Pe=0,Me=0,Ye=0,ze=0,Qe=0;if(le){let kt=Math.round(O.layout.get("building-facade-floors").evaluate(b,{},l));if($===0){kt=Math.max(1,kt-(be.length>0?1:0));let Fn=4;if(W>100){const he=[10,13,15];Fn=he[b.id?b.id%he.length:0],p.setFacadeOptions(Fn,!0)}ze=1.6803*Fn/m}else ze=$/m;Qe=W/m,ze=Math.min(ze,Qe),Me=O.layout.get("building-facade-unit-width").evaluate(b,{},l)/m,Ye=(Qe-ze)/kt,p.setFauxFacadeOptions(!0,!0,Me);const fn=O.layout.get("building-facade-window").evaluate(b,{},l);Ie=fn[0],Pe=fn[1]}const lt=[],tt=new ct(1/0,1/0),rt=new ct(-1/0,-1/0),dt=new ct(0,0);let Xe=0;for(const kt of z)if(kt.length>0){const fn=[];for(const Fn of kt){const he=[];for(let de=Fn.length-1;de>=0;de--){const Ue=Fn[de];he.push({x:Ue.x,y:Ue.y}),tt.x=Math.min(tt.x,Ue.x),tt.y=Math.min(tt.y,Ue.y),rt.x=Math.max(rt.x,Ue.x),rt.y=Math.max(rt.y,Ue.y),dt.x+=Ue.x,dt.y+=Ue.y,Xe++}fn.push(he)}lt.push({id:b.id?b.id:0,height:W,minHeight:$,sourceId:0,roofType:q,coordinates:fn})}dt.x/=Xe||1,dt.y/=Xe||1;const ot=p.generateMesh(lt,be);if(typeof ot=="string"){Dn(`Unable to generate building ${b.id}: ${ot}`);continue}if(ot.meshes.length===0||ot.modifiedPolygonRings.length===0)continue;let Ge=0;for(const kt of ot.meshes)Ge+=kt.positions.length/3;const je=le?this.buildingWithFacade:this.buildingWithoutFacade,ft=je.segmentsBucket.prepareSegment(Ge,je.layoutVertexArray,je.indexArray),ut=[];let Gt=null,At=0,Lt=-1;const yt=je.indexArray.length;let Vt=0;for(const kt of ot.meshes){const fn=je.layoutVertexArray.length;if(kt.buildingPart==="entrance"){const Ke=new Array;for(let Wt=0;Wt<kt.indices.length;Wt+=12){const In=kt.positions[Wt+0],An=kt.positions[Wt+1],bn=kt.positions[Wt+3],ni=kt.positions[Wt+4],Pi=kt.positions[Wt+2],wn=kt.positions[Wt+8]-Pi,yi=1,oi=bn-In,Gn=ni-An,xi=Math.hypot(oi,Gn);Ke.push({pos:[In+.5*oi,An+.5*Gn,Pi],normal:[Gn/xi,-oi/xi,0],width:xi,height:wn,depth:yi,points:[In,An,bn,ni]})}const Tt=je.entranceBloom.segmentsBucket.prepareSegment(10*Ke.length,je.entranceBloom.layoutVertexArray,je.entranceBloom.indexArray),bt=je.entranceBloom.layoutVertexArray.length;At=je.entranceBloom.indexArray.length,LC(Ke,.5/this.tileToMeter,je.entranceBloom.indexArray,je.entranceBloom.layoutVertexArray,je.entranceBloom.layoutAttenuationArray);const Rt=je.entranceBloom.layoutVertexArray.length-bt;Lt=je.entranceBloom.indexArray.length-At;for(let Wt=0;Wt<Rt;Wt++)je.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Tt.vertexLength+=Rt,Tt.primitiveLength+=Lt,Gt={part:kt.buildingPart,vertexOffset:bt,vertexLength:Rt}}for(let Ke=0;Ke<kt.positions.length;Ke+=3)Vt=Math.max(Vt,kt.positions[Ke+2]),je.layoutVertexArray.emplaceBack(kt.positions[Ke],kt.positions[Ke+1],kt.positions[Ke+2]);const Fn=Math.floor(dt.x),he=Math.floor(dt.y),de=Math.floor(Vt);for(let Ke=0;Ke<kt.positions.length;Ke+=3)je.layoutCentroidArray.emplaceBack(Fn,he,de);for(let Ke=0;Ke<kt.normals.length;Ke+=3)je.layoutNormalArray.emplaceBack(kt.normals[Ke+0]*kb,kt.normals[Ke+1]*kb,kt.normals[Ke+2]*kb);for(let Ke=0;Ke<kt.ao.length;Ke++)je.layoutAOArray.push(kt.ao[Ke]);for(let Ke=0;Ke<kt.colors.length;Ke+=3){const Tt=1+(kt.ao[Ke/3]-1)*ie;je.layoutColorArray.emplaceBack(kt.colors[Ke]*Tt<<8|kt.colors[Ke+1]*Tt,kt.colors[Ke+2]*Tt<<8)}if(le){for(let Ke=0;Ke<kt.positions.length;Ke+=3)je.layoutFacadePaintArray.emplaceBack(65535,255);for(let Ke=0;Ke<kt.isFauxFacade.length;Ke++)if(kt.isFauxFacade[Ke]){const Tt=1|Math.min(65535,Math.floor(kt.uv[2*Ke]*ot.outerRingLength)),bt=Math.floor(255*Ie)<<8|Math.floor(255*Pe),Rt=Math.floor(65535*Math.min(1,Me/vt)),Wt=Math.floor(65535*Math.min(1,Ye/vt));je.layoutFacadeDataArray.emplaceBack(Tt,bt,Rt,Wt);const In=Math.floor(65535*Math.min(1,ze/vt)),An=Math.floor(65535*Math.min(1,Qe/vt));je.layoutFacadeVerticalRangeArray.emplaceBack(In,An)}else je.layoutFacadeDataArray.emplaceBack(0,0,0,0),je.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Ue=ft.vertexLength;for(let Ke=0;Ke<kt.indices.length;Ke+=3)je.indexArray.emplaceBack(Ue+kt.indices[Ke],Ue+kt.indices[Ke+1],Ue+kt.indices[Ke+2]);ft.vertexLength+=kt.positions.length/3,ft.primitiveLength+=kt.indices.length/3,(kt.buildingPart==="roof"||kt.buildingPart==="wall"||kt.buildingPart==="facade_glazing"||kt.buildingPart==="entrance")&&ut.push({part:kt.buildingPart,vertexOffset:fn,vertexLength:kt.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Vt),this.buildingFeatures.push({feature:C,hasFauxFacade:le,segment:ft,parts:ut,buildingBloom:Gt});const an=je.indexArray.length-yt,St=[],Ft=[],Yt=new ct(1/0,1/0),dn=new ct(-1/0,-1/0),En=this.groundEffect.vertexArray.length;for(const kt of ot.modifiedPolygonRings){const fn=[],Fn=new ct(1/0,1/0),he=new ct(-1/0,-1/0);for(let de=0;de<kt.length;de+=2){const Ue=kt.length-de-2;Fn.x=Math.min(Fn.x,kt[Ue]),Fn.y=Math.min(Fn.y,kt[Ue+1]),he.x=Math.max(he.x,kt[Ue]),he.y=Math.max(he.y,kt[Ue+1]);const Ke=new ct(kt[Ue],kt[Ue+1]);fn.push(Ke),St.push(Ke.x,Ke.y),Ft.push(Ke.clone())}Yt.x=Math.min(Yt.x,Fn.x),Yt.y=Math.min(Yt.y,Fn.y),dn.x=Math.max(dn.x,he.x),dn.y=Math.max(dn.y,he.y),this.groundEffect.addData(fn,[Fn,he],re)}const mn=this.groundEffect.vertexArray.length-En;(tt.x<0||rt.x>vt||tt.y<0||rt.y>vt)&&this.featuresOnBorder.push({featureId:b.id,footprintIndex:this.footprints.length});{const kt=rp(St,null,2),fn=new gx(Ft,kt,8,256);let Fn=b.id;b.properties&&b.properties.hasOwnProperty("building_id")&&(Fn=b.properties.building_id),this.footprints.push({vertices:Ft,indices:kt,grid:fn,min:Yt,max:dn,buildingId:Fn,hiddenFlags:0,indicesOffset:yt,indicesLength:an,bloomIndicesOffset:At,bloomIndicesLength:Lt,groundEffectVertexOffset:En,groundEffectVertexLength:mn,hasFauxFacade:le,segment:ft,height:Vt})}this.programConfigurations.populatePaintArrays(je.layoutVertexArray.length,b,S,{},r.availableImages,l,r.brightness),this.groundEffect.addPaintPropertiesData(b,S,{},r.availableImages,l,r.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,r,l,u,p,m,v){this.programConfigurations.updatePaintArrays(e,r,p,l,u,m,v),this.groundEffect.update(e,r,p,l,u,m,v),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const r=l=>{l.layoutVertexBuffer=e.createVertexBuffer(l.layoutVertexArray,zC.members),l.layoutNormalBuffer=e.createVertexBuffer(l.layoutNormalArray,Sj.members),l.layoutCentroidBuffer=e.createVertexBuffer(l.layoutCentroidArray,Ej.members),l.layoutFacadeDataArray&&l.layoutFacadeDataArray.length&&(l.layoutFacadeDataBuffer=e.createVertexBuffer(l.layoutFacadeDataArray,Aj.members)),l.layoutFacadeVerticalRangeArray&&l.layoutFacadeVerticalRangeArray.length&&(l.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(l.layoutFacadeVerticalRangeArray,Cj.members)),l.entranceBloom.layoutVertexArray.length&&(l.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(l.entranceBloom.layoutVertexArray,zC.members),l.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(l.entranceBloom.layoutAttenuationArray,Pj.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=r=>{r.layoutVertexBuffer&&(r.layoutVertexBuffer.destroy(),r.layoutNormalBuffer.destroy(),r.layoutColorBuffer.destroy(),r.segmentsBucket.destroy(),r.indexBuffer&&r.indexBuffer.destroy(),r.entranceBloom.layoutVertexBuffer&&(r.entranceBloom.layoutVertexBuffer.destroy(),r.entranceBloom.layoutColorBuffer.destroy(),r.entranceBloom.layoutAttenuationBuffer.destroy(),r.entranceBloom.indexBuffer.destroy(),r.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,r,l=!0){let u=!1;const p=l?r:0,m=0|(l?-1:~r);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of e){const b=this.footprints[v],S=b.hiddenFlags&m|p;b.hiddenFlags!==S&&(b.hiddenFlags=S,u=!0,this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0))}return u&&(this.indexArrayForConflationUploaded=!1),u}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const r=u=>{u.indexArray.length!==0&&(u.indexArrayForConflation.resize(u.indexArray.length),u.indexArrayForConflation.uint16.set(u.indexArray.uint16),u.entranceBloom.indexArrayForConflation.resize(u.entranceBloom.indexArray.length),u.entranceBloom.indexArrayForConflation.uint16.set(u.entranceBloom.indexArray.uint16))};r(this.buildingWithoutFacade),r(this.buildingWithFacade);for(const u of this.footprints){const p=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,m=u.indicesOffset+u.indicesLength;if(u.hiddenFlags!==0){for(let b=u.indicesOffset;b<m;b++)p.indexArrayForConflation.uint16[3*b+0]=0,p.indexArrayForConflation.uint16[3*b+1]=0,p.indexArrayForConflation.uint16[3*b+2]=0;const v=u.bloomIndicesOffset+u.bloomIndicesLength;for(let b=u.bloomIndicesOffset;b<v;b++)p.entranceBloom.indexArrayForConflation.uint16[3*b+0]=0,p.entranceBloom.indexArrayForConflation.uint16[3*b+1]=0,p.entranceBloom.indexArrayForConflation.uint16[3*b+2]=0}}const l=u=>{u.indexArray.length!==0&&(u.indexBuffer?u.indexBuffer.updateData(u.indexArrayForConflation):u.indexBuffer=e.createIndexBuffer(u.indexArrayForConflation,!0),u.entranceBloom.indexBuffer?u.entranceBloom.indexBuffer.updateData(u.entranceBloom.indexArrayForConflation):u.entranceBloom.indexBuffer=e.createIndexBuffer(u.entranceBloom.indexArrayForConflation,!0))};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const r=l=>{l.layoutColorBuffer?l.layoutColorBuffer.updateData(l.layoutColorArray):l.layoutColorBuffer=e.createVertexBuffer(l.layoutColorArray,OC.members,!0),l.layoutFacadePaintArray&&(l.layoutFacadePaintBuffer?l.layoutFacadePaintBuffer.updateData(l.layoutFacadePaintArray):l.layoutFacadePaintBuffer=e.createVertexBuffer(l.layoutFacadePaintArray,Ij.members,!0)),l.entranceBloom.layoutColorBuffer?l.entranceBloom.layoutColorBuffer.updateData(l.entranceBloom.layoutColorArray):l.entranceBloom.layoutColorBuffer=e.createVertexBuffer(l.entranceBloom.layoutColorArray,OC.members,!0)};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,r){const l=e.paint.get("building-ambient-occlusion-intensity");for(const u of this.buildingFeatures){const p=r[u.feature.id],m=u.feature;m.properties["building-part"]="roof";const v=e.paint.get("building-color").evaluate(m,p,this.canonical).toPremultipliedRenderColor(this.lut),b=e.paint.get("building-emissive-strength").evaluate(m,p,this.canonical);m.properties["building-part"]="wall";const S=e.paint.get("building-color").evaluate(m,p,this.canonical).toPremultipliedRenderColor(this.lut),A=e.paint.get("building-emissive-strength").evaluate(m,p,this.canonical);m.properties["building-part"]="window";const C=e.paint.get("building-color").evaluate(m,p,this.canonical).toPremultipliedRenderColor(this.lut),M=e.paint.get("building-emissive-strength").evaluate(m,p,this.canonical);m.properties["building-part"]="door";const z=e.paint.get("building-color").evaluate(m,p,this.canonical).toPremultipliedRenderColor(this.lut),O=e.paint.get("building-emissive-strength").evaluate(m,p,this.canonical),$=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const q of u.parts){let ie,re=v;q.part==="roof"?(re=v,ie=b):q.part==="wall"?(re=S,ie=A):q.part==="facade_glazing"?(re=C,ie=M):q.part==="entrance"&&(re=z,ie=O),ie=Se(ie,0,1);for(let le=0;le<q.vertexLength;le++){const we=q.vertexOffset+le,be=1+($.layoutAOArray[we]-1)*l;$.layoutColorArray.emplace(we,re.r*be*255<<8|re.g*be*255,re.b*be*255<<8|255*ie),u.hasFauxFacade&&$.layoutFacadePaintArray.emplace(we,255*C.r<<8|255*C.g,255*C.b<<8|255*M)}}const W=u.buildingBloom;if(W)for(let q=0;q<W.vertexLength;q++)$.entranceBloom.layoutColorArray.emplace(W.vertexOffset+q,255*z.r<<8|255*z.g,255*z.b<<8|51*O)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,r,l){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const u=r.getReplacementRegionsForTile(e.toUnwrapped());if(yx(this.activeReplacements,u))return;this.activeReplacements=u;for(const m of this.footprints)m.hiddenFlags&=-2;const p=[];for(const m of this.activeReplacements){if(m.order<=GA)continue;const v=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));for(const b of this.footprints)b.min.x>m.max.x||b.max.x<m.min.x||b.min.y>m.max.y||b.max.y<m.min.y||(p.length=0,Rj(b.vertices,0,b.vertices.length,m.footprintTileId.canonical,e.canonical,p),fb(m.footprint,p,b.indices,0,b.indices.length,0,-v)&&(b.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const m of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(m.groundEffectVertexOffset,m.groundEffectVertexLength,m.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,r){let l=Number.NEGATIVE_INFINITY,u=!0;const p=4*(e+vt)*vt+(r+vt);if(this.footprintLookup.hasOwnProperty(p)){const v=this.footprintLookup[p];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}const m=new ct(e,r);for(const v of this.footprints)e>v.max.x||v.min.x>e||r>v.max.y||v.min.y>r||v.height<=l||pb(m,v)&&(l=v.height,this.footprintLookup[p]=v,u=v.hiddenFlags!==0);if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:u};this.footprintLookup[p]=void 0}}function Rj(s,e,r,l,u,p){const m=Math.pow(2,l.z-u.z);for(let v=0;v<r;v++){let b=s[v+e].x,S=s[v+e].y;b=(b+u.x*vt)*m-l.x*vt,S=(S+u.y*vt)*m-l.y*vt,p.push(new ct(b,S))}}let jC,VC;Pt(BC,"BuildingBucket",{omit:["layers"]}),Pt(Db,"BuildingGeometry"),Pt(NC,"BuildingBloomGeometry");const kj=zn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Dj=zn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Lj}=kj,zj=zn([{name:"a_packed",components:3,type:"Float32"}]),{members:Oj}=zj,Fj=zn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Nj}=Fj;class UC{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Tu({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const l=this.getKey(e,r);return this.positions[l]}trim(){const e=this.width,r=this.height=$t(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,l){const u=[];let p=e.length%2==1?-e[e.length-1]*l:0,m=e[0]*l,v=!0;u.push({left:p,right:m,isDash:v,zeroLength:e[0]===0});let b=e[0];for(let S=1;S<e.length;S++){v=!v;const A=e[S];p=b*l,b+=A,m=b*l,u.push({left:p,right:m,isDash:v,zeroLength:A===0})}return u}addRoundDash(e,r,l){const u=r/2;for(let p=-l;p<=l;p++){const m=this.width*(this.nextRow+l+p);let v=0,b=e[v];for(let S=0;S<this.width;S++){S/b.right>1&&(b=e[++v]);const A=Math.abs(S-b.left),C=Math.abs(S-b.right),M=Math.min(A,C);let z;const O=p/l*(u+1);if(b.isDash){const $=u-Math.abs(O);z=Math.sqrt(M*M+$*$)}else z=u-Math.sqrt(M*M+O*O);this.image.data[m+S]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(e,r){for(let b=e.length-1;b>=0;--b){const S=e[b],A=e[b+1];S.zeroLength?e.splice(b,1):A&&A.isDash===S.isDash&&(A.left=S.left,e.splice(b,1))}const l=e[0],u=e[e.length-1];l.isDash===u.isDash&&(l.left=u.left-this.width,u.right=l.right+this.width);const p=this.width*this.nextRow;let m=0,v=e[m];for(let b=0;b<this.width;b++){b/v.right>1&&(v=e[++m]);const S=Math.abs(b-v.left),A=Math.abs(b-v.right),C=Math.min(S,A);this.image.data[p+b]=Math.max(0,Math.min(255,(v.isDash?C:-C)+r+128))}}addDash(e,r){const l=this.getKey(e,r);if(this.positions[l])return this.positions[l];const u=r==="round",p=u?7:0,m=2*p+1;if(this.nextRow+m>this.height)return Dn("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let A=0;A<e.length;A++)e[A]<0&&(Dn("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),v+=e[A];if(v!==0){const A=this.width/v,C=this.getDashRanges(e,this.width,A);u?this.addRoundDash(C,A,p):this.addRegularDash(C,r==="square"?.5*A:0)}const b=this.nextRow+p;this.nextRow+=m;const S={tl:[b,p],br:[v,0]};return this.positions[l]=S,S}}Pt(UC,"LineAtlas");const Bj=at.types,jj=Math.cos(Math.PI/180*37.5),Vj=Math.cos(Math.PI/180*5);class Lb{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Wf,this.layoutVertexArray2=new Rs,this.patternVertexArray=new Rs,this.indexArray=new xr,this.programConfigurations=new Ho(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Oi,this.maxLineLength=0,this.zOffsetVertexArray=new Rs,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:vt/64,this.worldview=e.worldview}updateFootprints(e,r){}populate(e,r,l,u){this.hasPattern=ab("line",this.layers,this.pixelRatio,r);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Oe(l);const m=this.layers[0].layout.get("line-elevation-reference");if(m==="hd-road-markup")this.elevationType="road";else{const M=this.layers[0].layout.get("line-z-offset"),z=M.isConstant()&&!M.constantOr(0);this.elevationType=m!=="sea"&&m!=="ground"&&z?"none":"offset",this.elevationType==="offset"&&m==="none"&&Dn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;const b=[];for(const{feature:M,id:z,index:O,sourceLayerIndex:$}of e){const W=this.layers[0]._featureFilter.needGeometry,q=ht(M,W);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom,{worldview:this.worldview}),q,l))continue;const ie=p?p.evaluate(q,{},l):void 0,re={id:z,properties:M.properties,type:M.type,sourceLayerIndex:$,index:O,geometry:W?q.geometry:It(M,l,u),patterns:{},sortKey:ie};b.push(re)}p&&b.sort((M,z)=>M.sortKey-z.sortKey);const{lineAtlas:S,featureIndex:A}=r,C=this.addConstantDashes(S);for(const M of b){const{geometry:z,index:O,sourceLayerIndex:$}=M;if(C&&this.addFeatureDashes(M,S),this.hasPattern){const W=lb("line",this.layers,M,this.zoom,this.pixelRatio,r);this.patternFeatures.push(W)}else this.addFeature(M,z,O,l,S.positions,r.availableImages,r.brightness,r.elevationFeatures);A.insert(e[O].feature,z,O,$,this.index)}}addConstantDashes(e){let r=!1;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(u.kind!=="constant"||p.kind!=="constant")r=!0;else{const m=p.value,v=u.value;if(!v)continue;e.addDash(v,m)}}return r}addFeatureDashes(e,r){const l=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(p.kind==="constant"&&m.kind==="constant")continue;let v,b;if(p.kind==="constant"){if(v=p.value,!v)continue}else v=p.evaluate({zoom:l},e);b=m.kind==="constant"?m.value:m.evaluate({zoom:l},e),r.addDash(v,b),e.patterns[u.id]=[r.getKey(v,b)]}}update(e,r,l,u,p,m,v,b){this.programConfigurations.updatePaintArrays(e,r,p,l,u,m,v,b)}addFeatures(e,r,l,u,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,l,u,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Oj)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Nj)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Dj.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lj),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,r){let l,u;if(r&&r>0?(l=`mapbox_clip_start_${r}`,u=`mapbox_clip_end_${r}`):(l="mapbox_clip_start",u="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(l)&&e.properties.hasOwnProperty(u))return{start:+e.properties[l],end:+e.properties[u]}}addFeature(e,r,l,u,p,m,v,b){const S=this.layers[0].layout,A=S.get("line-join").evaluate(e,{}),C=S.get("line-cap").evaluate(e,{}),M=S.get("line-miter-limit"),z=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const O=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=S.get("line-z-offset").value;const $=this.layers[0].paint.get("line-width").value;if($.kind!=="constant"&&$.isLineProgressConstant===!1&&(this.variableWidthValue=$),this.elevationType==="road"){const W=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,r,u,b,A,C,M,z)){const[q,ie]=this.clipRuntimeLinesToTile(r,1);for(let re=0;re<q.length;re++){const le=q[re],we=ie[re],be={progress:{min:we.progress.min,max:we.progress.max},nextDir:this.computeSegNextDir(we,le),prevDir:this.computeSegPrevDir(we,le)};this.addLine(le,e,u,A,C,M,z,be,O&&we.parentIndex>0?we.parentIndex:null)}this.fillNonElevatedRoadSegment(W)}}else for(let W=0;W<r.length;W++)this.addLine(r[W],e,u,A,C,M,z,void 0,O&&W>0?W:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,m,u,v,void 0,this.worldview)}computeSegNextDir(e,r){return e.nextPoint.sub(r.at(-2)).unit()}computeSegPrevDir(e,r){return r[1].sub(e.prevPoint).unit()}clipLinesToTile(e,r){return wx(e,-r,-r,vt+r,vt+r)}clipRuntimeLinesToTile(e,r){const l=[];return[wx(e,-r,-r,vt+r,vt+r,l),l]}addElevatedRoadFeature(e,r,l,u,p,m,v,b){const S=[],A=ki.getElevationFeature(e,u);if(A){const C=this.clipLinesToTile(r,1),M=this.prepareElevatedLines(C,A,l);for(const z of M)S.push({geometry:z,elevation:A,elevationTileID:l,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(S.length===0)return!1;for(const C of S){const M=this.layoutVertexArray.length;this.addLine(C.geometry,e,l,p,m,v,b);const z=new tr(l,C.elevationTileID);if(C.elevation)for(let O=M;O<this.layoutVertexArray.length;O++){const $=new ct(this.layoutVertexArray.int16[6*O]>>1,this.layoutVertexArray.int16[6*O+1]>>1),W=z.pointElevation($,C.elevation,.05);this.updateHeightRange(W),this.zOffsetVertexArray.emplaceBack(W,0,0)}else this.fillNonElevatedRoadSegment(M)}return!0}prepareElevatedLines(e,r,l){if(r.constantHeight!=null)return e;const u=[],p=1/Oe(l);for(const m of e)ej(m,new ti(r,p),0,u);return u}fillNonElevatedRoadSegment(e){for(let r=e;r<this.layoutVertexArray.length;r++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,r,l,u,p,m,v,b,S){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=S?this.lineFeatureClips(r,S):this.lineClips;const A=u==="none";this.patternJoinNone=this.hasPattern&&A,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const C=b&&b.progress.min>0,M=b&&b.progress.max<1;if(this.lineClips){let Me={min:this.lineClips.start,max:this.lineClips.end},Ye=1;if(b){const lt=this.lineClips.end-this.lineClips.start;Me=function(tt,rt,dt){return{min:Ma(tt.min,rt,dt),max:Ma(tt.max,rt,dt)}}(b.progress,{min:0,max:1},Me),lt>0&&(Ye=(Me.max-Me.min)/lt)}const ze=+r.properties.mapbox_clip_feature_len,Qe=+r.properties.mapbox_clip_seg_len;if(Number.isNaN(ze)||Number.isNaN(Qe)){for(let tt=0;tt<e.length-1;tt++)this.totalDistance+=e[tt].dist(e[tt+1]);const lt=this.totalDistance/(Me.max-Me.min);this.totalFeatureLength=Number.isFinite(lt)?lt:0,this.lineClips.start=Me.min,this.lineClips.end=Me.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ze,this.distance=Qe*Ye,this.lineClips.start=Me.min,this.lineClips.end=Me.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const z=Bj[r.type]==="Polygon";let O=e.length;for(;O>=2&&e[O-1].equals(e[O-2]);)O--;let $=0;for(;$<O-1&&e[$].equals(e[$+1]);)$++;if(O<(z?3:2))return;u==="bevel"&&(m=1.05);const W=this.segments.prepareSegment(10*O,this.layoutVertexArray,this.indexArray);let q,ie,re,le,we,be,Ie,Pe;b&&b.prevDir&&(be=b.prevDir.perp()),b&&b.nextDir&&(Ie=b.nextDir.perp()),this.e1=this.e2=-1,z&&(q=e[O-2],we=e[$].sub(q)._unit()._perp());for(let Me=$;Me<O;Me++){if(re=Me===O-1?z?e[$+1]:void 0:e[Me+1],re&&e[Me].equals(re))continue;we&&(le=we),q&&(ie=q),q=e[Me],Pe=this.evaluateLineProgressFeatures(ie?ie.dist(q):0),we=re?re.sub(q)._unit()._perp():le,le=le||we;const Ye=ie&&re;let ze=Ye?u:z||A?"butt":p;const Qe=le.x*we.x+le.y*we.y;if(A){const je=function(ft){if(ft.patternJoinNone){const ut=ft.segmentPoints.length/2,Gt=ft.lineSoFar-ft.segmentStart;for(let At=0;At<ut;++At){const Lt=ft.segmentPoints[2*At+1],yt=Math.round(ft.segmentPoints[2*At])+.5+.25*Lt;ft.patternVertexArray.emplaceBack(yt,Gt,ft.segmentStart),ft.patternVertexArray.emplaceBack(yt,Gt,ft.segmentStart)}ft.segmentPoints.length=0}ft.e1=ft.e2=-1};if(Ye&&Qe<Vj){this.updateDistance(ie,q),this.addCurrentVertex(q,le,1,1,W,Pe),je(this),this.addCurrentVertex(q,we,-1,-1,W,Pe);continue}if(ie){if(!re){this.updateDistance(ie,q),this.addCurrentVertex(q,le,1,1,W,Pe),je(this);continue}ze="miter"}}let lt=le.add(we);lt.x===0&&lt.y===0||lt._unit();const tt=lt.x*we.x+lt.y*we.y,rt=tt!==0?1/tt:1/0,dt=2*Math.sqrt(2-2*tt),Xe=tt<jj&&ie&&re,ot=le.x*we.y-le.y*we.x>0,Ge=this.overscaling<=16?15*vt/(512*this.overscaling):0;if(Ye&&ze==="round"){if(rt<v)ze="miter";else if(rt<=2){const je=zb(q,-10,vt+10);ze=this.elevationType==="offset"&&(je||this.hasCrossSlope)?"miter":"fakeround"}}if(ze==="miter"&&rt>m&&(ze="bevel"),ze==="bevel"&&(rt>2&&(ze="flipbevel"),rt<m&&(ze="miter")),ie&&!(ze==="miter"&&Xe)&&this.updateDistance(ie,q),ze==="miter")if(Xe){const je=q.dist(ie);if(je>2*Ge){const ut=q.sub(q.sub(ie)._mult(Ge/je)._round());this.updateDistance(ie,ut),this.addCurrentVertex(ut,le,0,0,W,Pe),ie=ut}this.updateDistance(ie,q),lt._mult(rt),this.addCurrentVertex(q,lt,0,0,W,Pe);const ft=q.dist(re);if(ft>2*Ge){const ut=q.add(re.sub(q)._mult(Ge/ft)._round());this.updateDistance(q,ut),this.addCurrentVertex(ut,we,0,0,W,Pe),q=ut}}else lt._mult(rt),this.addCurrentVertex(q,lt,0,0,W,Pe);else if(ze==="flipbevel"){if(rt>100)lt=we.mult(-1);else{const je=rt*le.add(we).mag()/le.sub(we).mag();lt._perp()._mult(je*(ot?-1:1))}this.addCurrentVertex(q,lt,0,0,W,Pe),this.addCurrentVertex(q,lt.mult(-1),0,0,W,Pe)}else if(ze==="bevel"||ze==="fakeround"){Pe!=null&&ie&&this.addCurrentVertex(q,Ie||le,-1,-1,W,Pe);const je=q.dist(ie)<=2*Ge&&ze!=="bevel",ft=lt.mult(ot?1:-1);ft._mult(rt);const ut=we.mult(ot?-1:1),Gt=le.mult(ot?-1:1),At=this.evaluateLineProgressFeatures(this.distance);if(Pe==null&&(this.addHalfVertex(q,ft.x,ft.y,!1,!ot,0,W,At),je||this.addHalfVertex(q,ft.x+2*Gt.x,ft.y+2*Gt.y,!1,ot,0,W,At)),ze==="fakeround"){const Lt=Math.round(180*dt/Math.PI/20);this.addHalfVertex(q,Gt.x,Gt.y,!1,ot,0,W,At);for(let yt=0;yt<Lt;yt++){let Vt=yt/Lt;if(Vt!==.5){const St=Vt-.5;Vt+=Vt*St*(Vt-1)*((1.0904+Qe*(Qe*(3.55645-1.43519*Qe)-3.2452))*St*St+(.848013+Qe*(.215638*Qe-1.06021)))}const an=ut.sub(Gt)._mult(Vt)._add(Gt)._unit();this.addHalfVertex(q,an.x,an.y,!1,ot,0,W,At)}this.addHalfVertex(q,ut.x,ut.y,!1,ot,0,W,At)}je||Pe!=null||this.addHalfVertex(q,ft.x+2*ut.x,ft.y+2*ut.y,!1,ot,0,W,At),Pe!=null&&re&&this.addCurrentVertex(q,be||we,1,1,W,Pe)}else if(ze==="butt")this.addCurrentVertex(q,lt,0,0,W,Pe);else if(ze==="square"){if(!ie){const je=C?0:-1;this.addCurrentVertex(q,lt,je,je,W,Pe)}if(this.addCurrentVertex(q,lt,0,0,W,Pe),ie){const je=M?0:1;this.addCurrentVertex(q,lt,je,je,W,Pe)}}else if(ze==="round"){if(ie){const je=!Ye&&Ie?Ie:le;this.addCurrentVertex(q,je,0,0,W,Pe),!Ye&&M||this.addCurrentVertex(q,je,1,1,W,Pe,!0)}if(re){const je=!Ye&&be?be:we;!Ye&&C||this.addCurrentVertex(q,je,-1,-1,W,Pe,!0),this.addCurrentVertex(q,je,0,0,W,Pe)}}}}addVerticesTo(e,r,l,u,p,m,v,b,S,A){const C=(r.w-e.w)/this.tessellationStep|0;let M=0;const z=this.scaledDistance;if(C>1){this.lineSoFar=e.w;const $=(r.x-e.x)/C,W=(r.y-e.y)/C,q=(r.z-e.z)/C,ie=(r.w-e.w)/C;for(let re=1;re<C;++re){e.x+=$,e.y+=W,e.z+=q,this.lineSoFar+=ie,M+=ie;const le=this.evaluateLineProgressFeatures(this.prevDistance+M);this.scaledDistance=(this.prevDistance+M)/this.totalDistance,this.addHalfVertex(e,l,u,A,!1,v,S,le),this.addHalfVertex(e,p,m,A,!0,-b,S,le)}}this.lineSoFar=r.w,this.scaledDistance=z;const O=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(r,l,u,A,!1,v,S,O),this.addHalfVertex(r,p,m,A,!0,-b,S,O)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Dn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let r=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(r=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:r}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:r}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:r}}addCurrentVertex(e,r,l,u,p,m,v=!1){const b=r.x+r.y*l,S=r.y-r.x*l,A=r.y*u-r.x,C=-r.y-r.x*u;if(m!=null){const M=this.elevationType==="offset",z=-10,O=vt+10,$=m.zOffset,W=new uC(e.x,e.y,$,this.lineSoFar),q=!!M&&zb(e,z,O),ie=this.lineSoFar,re=this.distance;if(this.currentVertex)if(q){const le=this.currentVertexIsOutside,we=this.currentVertex,be=new uC(e.x,e.y,$,this.lineSoFar);if(dC(we,be,z,O),!zb(be,z,O)){if(le){this.e1=this.e2=-1,this.distance-=we.dist(W),this.lineSoFar=we.w;const Ie=this.evaluateLineProgressFeatures(we.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(we,b,S,v,!1,l,p,Ie),this.addHalfVertex(we,A,C,v,!0,-u,p,Ie),this.prevDistance=this.distance}this.distance=this.prevDistance+we.dist(be),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(we,be,b,S,A,C,l,u,p,v),this.distance=re,this.scaledDistance=this.distance/this.totalDistance}}else{const le=this.currentVertex;if(this.currentVertexIsOutside){dC(le,W,z,O),this.e1=this.e2=-1,this.distance-=le.dist(W),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=le.w;const we=this.evaluateLineProgressFeatures(le.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(le,b,S,v,!1,l,p,we),this.addHalfVertex(le,A,C,v,!0,-u,p,we),this.prevDistance=this.distance,this.distance=re,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(le,W,b,S,A,C,l,u,p,v)}else q||(this.addHalfVertex(e,b,S,v,!1,l,p,m),this.addHalfVertex(e,A,C,v,!0,-u,p,m));this.currentVertex=W,this.currentVertexIsOutside=q,this.lineSoFar=ie}else this.addHalfVertex(e,b,S,v,!1,l,p,m),this.addHalfVertex(e,A,C,v,!0,-u,p,m)}addHalfVertex({x:e,y:r},l,u,p,m,v,b,S){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(r<<1)+(m?1:0),Math.round(63*l)+128,Math.round(63*u)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const C=Kt(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,C)}const A=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),b.primitiveLength++),m?this.e2=A:this.e1=A,S!=null&&this.zOffsetVertexArray.emplaceBack(S.zOffset,S.variableWidth,S.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,r){this.prevDistance=this.distance,this.distance+=e.dist(r),this.updateScaledDistance()}}function zb(s,e,r){return s.x<e||s.x>r||s.y<e||s.y>r}let GC,$C;function HC(s,e,r){return e*(vt/(s.tileSize*Math.pow(2,r-s.tileID.overscaledZ)))}Pt(Lb,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const WC=(s,e,r)=>(1-r)*s+r*e;function qC(s,e){return 1/HC(s,1,e.tileZoom)}function ZC(s,e,r,l){return s.translatePosMatrix(l||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const XC=s=>{const e=[];KC(s)&&e.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=s.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=s.layout.get("line-join").constantOr("miter")==="none",u=!!s.paint.get("line-pattern").constantOr(1);return l&&u&&e.push("LINE_JOIN_NONE"),e};function KC(s){const e=s.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let Ob;const YC=()=>Ob||(Ob={layout:GC||(GC=new Vi({"line-cap":new Et(Le.layout_line["line-cap"]),"line-join":new Et(Le.layout_line["line-join"]),"line-miter-limit":new pt(Le.layout_line["line-miter-limit"]),"line-round-limit":new pt(Le.layout_line["line-round-limit"]),"line-sort-key":new Et(Le.layout_line["line-sort-key"]),"line-z-offset":new Et(Le.layout_line["line-z-offset"]),"line-elevation-reference":new pt(Le.layout_line["line-elevation-reference"]),"line-cross-slope":new pt(Le.layout_line["line-cross-slope"]),visibility:new pt(Le.layout_line.visibility),"line-width-unit":new pt(Le.layout_line["line-width-unit"])})),paint:$C||($C=new Vi({"line-opacity":new Et(Le.paint_line["line-opacity"]),"line-color":new Et(Le.paint_line["line-color"]),"line-translate":new pt(Le.paint_line["line-translate"]),"line-translate-anchor":new pt(Le.paint_line["line-translate-anchor"]),"line-width":new Et(Le.paint_line["line-width"]),"line-gap-width":new Et(Le.paint_line["line-gap-width"]),"line-offset":new Et(Le.paint_line["line-offset"]),"line-blur":new Et(Le.paint_line["line-blur"]),"line-dasharray":new Et(Le.paint_line["line-dasharray"]),"line-pattern":new Et(Le.paint_line["line-pattern"]),"line-pattern-cross-fade":new pt(Le.paint_line["line-pattern-cross-fade"]),"line-gradient":new hu(Le.paint_line["line-gradient"]),"line-trim-offset":new pt(Le.paint_line["line-trim-offset"]),"line-trim-fade-range":new pt(Le.paint_line["line-trim-fade-range"]),"line-trim-color":new pt(Le.paint_line["line-trim-color"]),"line-emissive-strength":new pt(Le.paint_line["line-emissive-strength"]),"line-border-width":new Et(Le.paint_line["line-border-width"]),"line-border-color":new Et(Le.paint_line["line-border-color"]),"line-occlusion-opacity":new pt(Le.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},Ob);class Uj extends Et{possiblyEvaluate(e,r){return r=new _i(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition,worldview:r.worldview}),super.possiblyEvaluate(e,r)}evaluate(e,r,l,u){return r=Object.assign({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,l,u)}}let l_;function JC(s,e){return e>0?e+2*s:s}const Gj=zn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$j=zn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Hj=zn([{name:"a_projected_pos",components:4,type:"Float32"}],4);zn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Wj=zn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),qj=zn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Zj=zn([{name:"a_texb",components:2,type:"Uint16"}]),Xj=zn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Kj=zn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);zn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const QC=zn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Yj=zn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);zn([{name:"triangle",components:3,type:"Uint16"}]),zn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),zn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),zn([{type:"Float32",name:"offsetX"}]),zn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var jr=24;function Jj(s,e,r){return s.sections.forEach(l=>{l.text=function(u,p,m){const v=p.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?u=u.toLocaleUpperCase():v==="lowercase"&&(u=u.toLocaleLowerCase()),fa.applyArabicShaping&&(u=fa.applyArabicShaping(u)),u}(l.text,e,r)}),s}const c_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Qj(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function e4(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}const Fb=4294967296,eP=1/Fb,tP=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Px=class{constructor(s=new Uint8Array(16)){this.buf=ArrayBuffer.isView(s)?s:new Uint8Array(s),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(s,e,r=this.length){for(;this.pos<r;){const l=this.readVarint(),u=l>>3,p=this.pos;this.type=7&l,s(u,e,this),this.pos===p&&this.skip(l)}return e}readMessage(s,e){return this.readFields(s,e,this.readVarint()+this.pos)}readFixed32(){const s=this.dataView.getUint32(this.pos,!0);return this.pos+=4,s}readSFixed32(){const s=this.dataView.getInt32(this.pos,!0);return this.pos+=4,s}readFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Fb;return this.pos+=8,s}readSFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Fb;return this.pos+=8,s}readFloat(){const s=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,s}readDouble(){const s=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,s}readVarint(s){const e=this.buf;let r,l;return l=e[this.pos++],r=127&l,l<128?r:(l=e[this.pos++],r|=(127&l)<<7,l<128?r:(l=e[this.pos++],r|=(127&l)<<14,l<128?r:(l=e[this.pos++],r|=(127&l)<<21,l<128?r:(l=e[this.pos],r|=(15&l)<<28,function(u,p,m){const v=m.buf;let b,S;if(S=v[m.pos++],b=(112&S)>>4,S<128||(S=v[m.pos++],b|=(127&S)<<3,S<128)||(S=v[m.pos++],b|=(127&S)<<10,S<128)||(S=v[m.pos++],b|=(127&S)<<17,S<128)||(S=v[m.pos++],b|=(127&S)<<24,S<128)||(S=v[m.pos++],b|=(1&S)<<31,S<128))return hp(u,b,p);throw new Error("Expected varint not more than 10 bytes")}(r,s,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const s=this.readVarint();return s%2==1?(s+1)/-2:s/2}readBoolean(){return!!this.readVarint()}readString(){const s=this.readVarint()+this.pos,e=this.pos;return this.pos=s,s-e>=12&&tP?tP.decode(this.buf.subarray(e,s)):function(r,l,u){let p="",m=l;for(;m<u;){const v=r[m];let b,S,A,C=null,M=v>239?4:v>223?3:v>191?2:1;if(m+M>u)break;M===1?v<128&&(C=v):M===2?(b=r[m+1],(192&b)==128&&(C=(31&v)<<6|63&b,C<=127&&(C=null))):M===3?(b=r[m+1],S=r[m+2],(192&b)==128&&(192&S)==128&&(C=(15&v)<<12|(63&b)<<6|63&S,(C<=2047||C>=55296&&C<=57343)&&(C=null))):M===4&&(b=r[m+1],S=r[m+2],A=r[m+3],(192&b)==128&&(192&S)==128&&(192&A)==128&&(C=(15&v)<<18|(63&b)<<12|(63&S)<<6|63&A,(C<=65535||C>=1114112)&&(C=null))),C===null?(C=65533,M=1):C>65535&&(C-=65536,p+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),p+=String.fromCharCode(C),m+=M}return p}(this.buf,e,s)}readBytes(){const s=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,s);return this.pos=s,e}readPackedVarint(s=[],e){const r=this.readPackedEnd();for(;this.pos<r;)s.push(this.readVarint(e));return s}readPackedSVarint(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readSVarint());return s}readPackedBoolean(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readBoolean());return s}readPackedFloat(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readFloat());return s}readPackedDouble(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readDouble());return s}readPackedFixed32(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readFixed32());return s}readPackedSFixed32(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readSFixed32());return s}readPackedFixed64(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readFixed64());return s}readPackedSFixed64(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readSFixed64());return s}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(s){const e=7&s;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(s,e){this.writeVarint(s<<3|e)}realloc(s){let e=this.length||16;for(;e<this.pos+s;)e*=2;if(e!==this.length){const r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeSFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*eP),!0),this.pos+=8}writeSFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*eP),!0),this.pos+=8}writeVarint(s){(s=+s||0)>268435455||s<0?function(e,r){let l,u;if(e>=0?(l=e%4294967296|0,u=e/4294967296|0):(l=~(-e%4294967296),u=~(-e/4294967296),4294967295^l?l=l+1|0:(l=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(p,m,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)}(l,0,r),function(p,m){const v=(7&p)<<4;m.buf[m.pos++]|=v|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(u,r)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))}writeSVarint(s){this.writeVarint(s<0?2*-s-1:2*s)}writeBoolean(s){this.writeVarint(+s)}writeString(s){s=String(s),this.realloc(4*s.length),this.pos++;const e=this.pos;this.pos=function(l,u,p){for(let m,v,b=0;b<u.length;b++){if(m=u.charCodeAt(b),m>55295&&m<57344){if(!v){m>56319||b+1===u.length?(l[p++]=239,l[p++]=191,l[p++]=189):v=m;continue}if(m<56320){l[p++]=239,l[p++]=191,l[p++]=189,v=m;continue}m=v-55296<<10|m-56320|65536,v=null}else v&&(l[p++]=239,l[p++]=191,l[p++]=189,v=null);m<128?l[p++]=m:(m<2048?l[p++]=m>>6|192:(m<65536?l[p++]=m>>12|224:(l[p++]=m>>18|240,l[p++]=m>>12&63|128),l[p++]=m>>6&63|128),l[p++]=63&m|128)}return p}(this.buf,s,this.pos);const r=this.pos-e;r>=128&&nP(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r}writeFloat(s){this.realloc(4),this.dataView.setFloat32(this.pos,s,!0),this.pos+=4}writeDouble(s){this.realloc(8),this.dataView.setFloat64(this.pos,s,!0),this.pos+=8}writeBytes(s){const e=s.length;this.writeVarint(e),this.realloc(e);for(let r=0;r<e;r++)this.buf[this.pos++]=s[r]}writeRawMessage(s,e){this.pos++;const r=this.pos;s(e,this);const l=this.pos-r;l>=128&&nP(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l}writeMessage(s,e,r){this.writeTag(s,2),this.writeRawMessage(e,r)}writePackedVarint(s,e){e.length&&this.writeMessage(s,t4,e)}writePackedSVarint(s,e){e.length&&this.writeMessage(s,n4,e)}writePackedBoolean(s,e){e.length&&this.writeMessage(s,s4,e)}writePackedFloat(s,e){e.length&&this.writeMessage(s,i4,e)}writePackedDouble(s,e){e.length&&this.writeMessage(s,r4,e)}writePackedFixed32(s,e){e.length&&this.writeMessage(s,o4,e)}writePackedSFixed32(s,e){e.length&&this.writeMessage(s,a4,e)}writePackedFixed64(s,e){e.length&&this.writeMessage(s,l4,e)}writePackedSFixed64(s,e){e.length&&this.writeMessage(s,c4,e)}writeBytesField(s,e){this.writeTag(s,2),this.writeBytes(e)}writeFixed32Field(s,e){this.writeTag(s,5),this.writeFixed32(e)}writeSFixed32Field(s,e){this.writeTag(s,5),this.writeSFixed32(e)}writeFixed64Field(s,e){this.writeTag(s,1),this.writeFixed64(e)}writeSFixed64Field(s,e){this.writeTag(s,1),this.writeSFixed64(e)}writeVarintField(s,e){this.writeTag(s,0),this.writeVarint(e)}writeSVarintField(s,e){this.writeTag(s,0),this.writeSVarint(e)}writeStringField(s,e){this.writeTag(s,2),this.writeString(e)}writeFloatField(s,e){this.writeTag(s,5),this.writeFloat(e)}writeDoubleField(s,e){this.writeTag(s,1),this.writeDouble(e)}writeBooleanField(s,e){this.writeVarintField(s,+e)}};function hp(s,e,r){return r?4294967296*e+(s>>>0):4294967296*(e>>>0)+(s>>>0)}function nP(s,e,r){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(l);for(let u=r.pos-1;u>=s;u--)r.buf[u+l]=r.buf[u]}function t4(s,e){for(let r=0;r<s.length;r++)e.writeVarint(s[r])}function n4(s,e){for(let r=0;r<s.length;r++)e.writeSVarint(s[r])}function i4(s,e){for(let r=0;r<s.length;r++)e.writeFloat(s[r])}function r4(s,e){for(let r=0;r<s.length;r++)e.writeDouble(s[r])}function s4(s,e){for(let r=0;r<s.length;r++)e.writeBoolean(s[r])}function o4(s,e){for(let r=0;r<s.length;r++)e.writeFixed32(s[r])}function a4(s,e){for(let r=0;r<s.length;r++)e.writeSFixed32(s[r])}function l4(s,e){for(let r=0;r<s.length;r++)e.writeFixed64(s[r])}function c4(s,e){for(let r=0;r<s.length;r++)e.writeSFixed64(s[r])}const Nb=3;function u4(s,e,r){e.glyphs=[],s===1&&r.readMessage(h4,e)}function h4(s,e,r){if(s===3){const{id:l,bitmap:u,width:p,height:m,left:v,top:b,advance:S}=r.readMessage(d4,{});e.glyphs.push({id:l,bitmap:new Tu({width:p+2*Nb,height:m+2*Nb},u),metrics:{width:p,height:m,left:v,top:b,advance:S}})}else s===4?e.ascender=r.readSVarint():s===5&&(e.descender=r.readSVarint())}function d4(s,e,r){s===1?e.id=r.readVarint():s===2?e.bitmap=r.readBytes():s===3?e.width=r.readVarint():s===4?e.height=r.readVarint():s===5?e.left=r.readSVarint():s===6?e.top=r.readSVarint():s===7&&(e.advance=r.readVarint())}const iP=Nb,_o={horizontal:1,vertical:2,horizontalOnly:3};class u_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,r){const l=new u_;return l.scale=e||1,l.fontStack=r,l}static forImage(e){const r=new u_;return r.image=e,r}}class dp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r,l){const u=new dp;for(let p=0;p<e.sections.length;p++){const m=e.sections[p];m.image?u.addImageSection(m,l):u.addTextSection(m,r)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,l){let u="";for(let p=0;p<r.length;p++){const m=r.charCodeAt(p+1)||null,v=r.charCodeAt(p-1)||null;u+=!l&&(m&&Bf(m)&&!c_[r[p+1]]||v&&Bf(v)&&!c_[r[p-1]])||!c_[r[p]]?r[p]:c_[r[p]]}return u}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Mx[this.text.charCodeAt(l)];l++)e++;let r=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Mx[this.text.charCodeAt(l)];l--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const l=new dp;return l.text=this.text.substring(e,r),l.sectionIndex=this.sectionIndex.slice(e,r),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(u_.forText(e.scale,e.fontStack||r));const l=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(l)}addImageSection(e,r){const l=e.image?e.image.getPrimary():null;if(!l)return void Dn("Can't add FormattedSection with an empty image.");l.scaleSelf(r);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(u_.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Dn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Bb(s,e,r,l,u,p,m,v,b,S,A,C,M,z,O,$=1){const W=dp.fromFeature(s,u,$);C===_o.vertical&&W.verticalizePunctuation(M);let q=[];const ie=function(Ie,Pe,Me,Ye,ze,Qe){if(!Ie)return[];const lt=[],tt=function(ot,Ge,je,ft,ut,Gt){let At=0;for(let Lt=0;Lt<ot.length();Lt++){const yt=ot.getSection(Lt);At+=rP(ot.getCodePoint(Lt),yt,ft,ut,Ge,Gt)}return At/Math.max(1,Math.ceil(At/je))}(Ie,Pe,Me,Ye,ze,Qe),rt=Ie.text.indexOf("")>=0;let dt=0;for(let ot=0;ot<Ie.length();ot++){const Ge=Ie.getSection(ot),je=Ie.getCodePoint(ot);if(Mx[je]||(dt+=rP(je,Ge,Ye,ze,Pe,Qe)),ot<Ie.length()-1){const ft=!((Xe=je)<11904||!(Xt["Bopomofo Extended"](Xe)||Xt.Bopomofo(Xe)||Xt["CJK Compatibility Forms"](Xe)||Xt["CJK Compatibility Ideographs"](Xe)||Xt["CJK Compatibility"](Xe)||Xt["CJK Radicals Supplement"](Xe)||Xt["CJK Strokes"](Xe)||Xt["CJK Symbols and Punctuation"](Xe)||Xt["CJK Unified Ideographs Extension A"](Xe)||Xt["CJK Unified Ideographs"](Xe)||Xt["Enclosed CJK Letters and Months"](Xe)||Xt["Halfwidth and Fullwidth Forms"](Xe)||Xt.Hiragana(Xe)||Xt["Ideographic Description Characters"](Xe)||Xt["Kangxi Radicals"](Xe)||Xt["Katakana Phonetic Extensions"](Xe)||Xt.Katakana(Xe)||Xt["Vertical Forms"](Xe)||Xt["Yi Radicals"](Xe)||Xt["Yi Syllables"](Xe)));(f4[je]||ft||Ge.image)&&lt.push(oP(ot+1,dt,tt,lt,p4(je,Ie.getCodePoint(ot+1),ft&&rt),!1))}}var Xe;return aP(oP(Ie.length(),dt,tt,lt,0,!0))}(W,S,p,e,l,z),{processBidirectionalText:re,processStyledBidirectionalText:le}=fa;if(re&&W.sections.length===1){const Ie=re(W.toString(),ie);for(const Pe of Ie){const Me=new dp;Me.text=Pe,Me.sections=W.sections;for(let Ye=0;Ye<Pe.length;Ye++)Me.sectionIndex.push(0);q.push(Me)}}else if(le){const Ie=le(W.text,W.sectionIndex,ie);for(const Pe of Ie){const Me=new dp;Me.text=Pe[0],Me.sectionIndex=Pe[1],Me.sections=W.sections,q.push(Me)}}else q=function(Ie,Pe){const Me=[],Ye=Ie.text;let ze=0;for(const Qe of Pe)Me.push(Ie.substring(ze,Qe)),ze=Qe;return ze<Ye.length&&Me.push(Ie.substring(ze,Ye.length)),Me}(W,ie);const we=[],be={positionedLines:we,text:W.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ie,Pe,Me,Ye,ze,Qe,lt,tt,rt,dt,Xe,ot){let Ge=0,je=0,ft=0;const ut=tt==="right"?1:tt==="left"?0:.5;let Gt=!1;for(const St of ze){const Ft=St.getSections();for(const Yt of Ft){if(Yt.image)continue;const dn=Pe[Yt.fontStack];if(dn&&(Gt=dn.ascender!==void 0&&dn.descender!==void 0,!Gt))break}if(!Gt)break}let At=0;for(const St of ze){St.trim();const Ft=St.getMaxScale(),Yt=(Ft-1)*jr,dn={positionedGlyphs:[],lineOffset:0};Ie.positionedLines[At]=dn;const En=dn.positionedGlyphs;let mn=0;if(!St.length()){je+=Qe,++At;continue}let kt=0,fn=0;for(let he=0;he<St.length();he++){const de=St.getSection(he),Ue=St.getSectionIndex(he),Ke=St.getCodePoint(he);let Tt=de.scale,bt=null,Rt=null,Wt=null,In=jr,An=0,bn=rt;bn===_o.vertical&&((Lt=Ke)===12312||Lt===12313||Lt===12316||Lt===12540||Lt===12448)&&(bn=_o.horizontal);const ni=!(bn===_o.horizontal||!Xe&&!Nf(Ke)||Xe&&(Mx[Ke]||jw(Ke)));if(de.image){const Pi=Ye.get(de.image.toString());if(!Pi)continue;Wt=de.image,Ie.iconsInText=Ie.iconsInText||!0,Rt=Pi.paddedRect;const wn=Pi.displaySize;Tt=Tt*jr/ot,bt={width:wn[0],height:wn[1],left:0,top:-iP,advance:ni?wn[1]:wn[0],localGlyph:!1},An=Gt?-bt.height*Tt:Ft*jr-17-wn[1]*Tt,In=bt.advance;const yi=(ni?wn[0]:wn[1])*Tt-jr*Ft;yi>0&&yi>mn&&(mn=yi)}else{const Pi=Me[de.fontStack];if(!Pi)continue;Pi[Ke]&&(Rt=Pi[Ke]);const wn=Pe[de.fontStack];if(!wn)continue;const yi=wn.glyphs[Ke];if(!yi)continue;if(bt=yi.metrics,In=Ke!==8203?jr:0,Gt){const oi=wn.ascender!==void 0?Math.abs(wn.ascender):0,Gn=wn.descender!==void 0?Math.abs(wn.descender):0,xi=(oi+Gn)*Tt;kt<xi&&(kt=xi,fn=(oi-Gn)/2*Tt),An=-oi*Tt}else An=(Ft-Tt)*jr-17}ni?(Ie.verticalizable=!0,En.push({glyph:Ke,image:Wt,x:Ge,y:je+An,vertical:ni,scale:Tt,localGlyph:bt.localGlyph,fontStack:de.fontStack,sectionIndex:Ue,metrics:bt,rect:Rt}),Ge+=In*Tt+dt):(En.push({glyph:Ke,image:Wt,x:Ge,y:je+An,vertical:ni,scale:Tt,localGlyph:bt.localGlyph,fontStack:de.fontStack,sectionIndex:Ue,metrics:bt,rect:Rt}),Ge+=bt.advance*Tt+dt)}En.length!==0&&(ft=Math.max(Ge-dt,ft),Gt?lP(En,ut,mn,fn,Qe*Ft/2):lP(En,ut,mn,0,Qe/2)),Ge=0;const Fn=Qe*Ft+mn;dn.lineOffset=Math.max(mn,Yt),je+=Fn,++At}var Lt;const yt=je,{horizontalAlign:Vt,verticalAlign:an}=jb(lt);(function(St,Ft,Yt,dn,En,mn){const kt=(Ft-Yt)*En,fn=-mn*dn;for(const Fn of St)for(const he of Fn.positionedGlyphs)he.x+=kt,he.y+=fn})(Ie.positionedLines,ut,Vt,an,ft,yt),Ie.top+=-an*yt,Ie.bottom=Ie.top+yt,Ie.left+=-Vt*ft,Ie.right=Ie.left+ft,Ie.hasBaseline=Gt}(be,e,r,l,q,m,v,b,C,S,M,O),!function(Ie){for(const Pe of Ie)if(Pe.positionedGlyphs.length!==0)return!1;return!0}(we))return be}const Mx={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},f4={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function rP(s,e,r,l,u,p){if(e.image){const m=l.get(e.image.toString());return m?m.displaySize[0]*e.scale*jr/p+u:0}{const m=r[e.fontStack],v=m&&m.glyphs[s];return v?v.metrics.advance*e.scale+u:0}}function sP(s,e,r,l){const u=Math.pow(s-e,2);return l?s<e?u/2:2*u:u+Math.abs(r)*r}function p4(s,e,r){let l=0;return s===10&&(l-=1e4),r&&(l+=150),s!==40&&s!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function oP(s,e,r,l,u,p){let m=null,v=sP(e,r,u,p);for(const b of l){const S=sP(e-b.x,r,u,p)+b.badness;S<=v&&(m=b,v=S)}return{index:s,x:e,priorBreak:m,badness:v}}function aP(s){return s?aP(s.priorBreak).concat(s.index):[]}function jb(s){let e=.5,r=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function lP(s,e,r,l,u){if(!(e||r||l||u))return;const p=s.length-1,m=s[p],v=(m.x+m.metrics.advance*m.scale)*e;for(let b=0;b<=p;b++)s[b].x-=v,s[b].y+=r+l+u}function cP(s){return s.imagePrimary!==void 0&&s.top!==void 0&&s.bottom!==void 0&&s.left!==void 0&&s.right!==void 0}function m4(s,e,r,l){const{horizontalAlign:u,verticalAlign:p}=jb(l),m=r[0]-s.displaySize[0]*u,v=r[1]-s.displaySize[1]*p;return{imagePrimary:s,imageSecondary:e,top:v,bottom:v+s.displaySize[1],left:m,right:m+s.displaySize[0]}}function uP(s,e,r,l,u,p){const m=s.imagePrimary;let v;if(m.content){const W=m.content,q=m.pixelRatio||1;v=[W[0]/q,W[1]/q,m.displaySize[0]-W[2]/q,m.displaySize[1]-W[3]/q]}const b=e.left*p,S=e.right*p;let A,C,M,z;r==="width"||r==="both"?(z=u[0]+b-l[3],C=u[0]+S+l[1]):(z=u[0]+(b+S-m.displaySize[0])/2,C=z+m.displaySize[0]);const O=e.top*p,$=e.bottom*p;return r==="height"||r==="both"?(A=u[1]+O-l[0],M=u[1]+$+l[2]):(A=u[1]+(O+$-m.displaySize[1])/2,M=A+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:A,right:C,bottom:M,left:z,collisionPadding:v}}function hP(s){return!s.imagePrimary.stretchX}function dP(s){return!s.imagePrimary.stretchY}function fP(s){return{width:s.right-s.left,height:s.bottom-s.top}}const Ml=128;function pP(s,e,r){const{expression:l}=e;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new _i(s+1,{worldview:r}))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:p}=l;let m=0;for(;m<u.length&&u[m]<=s;)m++;m=Math.max(0,m-1);let v=m;for(;v<u.length&&u[v]<s+1;)v++;v=Math.min(u.length-1,v);const b=u[m],S=u[v];return l.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:S,interpolationType:p}:{kind:"camera",minZoom:b,maxZoom:S,minSize:l.evaluate(new _i(b,{worldview:r})),maxSize:l.evaluate(new _i(S,{worldview:r})),interpolationType:p}}}function Vb(s,{uSize:e,uSizeT:r},{lowerSize:l,upperSize:u}){return s.kind==="source"?l/Ml:s.kind==="composite"?Kt(l/Ml,u/Ml,r):e}function h_(s,e,r=1){let l=0,u=0;if(s.kind==="constant")u=s.layoutSize*r;else if(s.kind!=="source"){const{interpolationType:p,minZoom:m,maxZoom:v}=s,b=p?Se(ho.interpolationFactor(p,e,m,v),0,1):0;s.kind==="camera"?u=Kt(s.minSize,s.maxSize,b)*r:l=b*r}return{uSizeT:l,uSize:u}}class Sc extends ct{constructor(e,r,l,u,p){super(e,r),this.angle=u,this.z=l,p!==void 0&&(this.segment=p)}clone(){return new Sc(this.x,this.y,this.z,this.angle,this.segment)}}function mP(s,e,r,l,u){if(e.segment===void 0)return!0;let p=e,m=e.segment+1,v=0;for(;v>-r/2;){if(m--,m<0)return!1;v-=s[m].dist(p),p=s[m]}v+=s[m].dist(s[m+1]),m++;const b=[];let S=0;for(;v<r/2;){const A=s[m],C=s[m+1];if(!C)return!1;let M=s[m-1].angleTo(A)-A.angleTo(C);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:M}),S+=M;v-b[0].distance>l;)S-=b.shift().angleDelta;if(S>u)return!1;m++,v+=A.dist(C)}return!0}function gP(s){let e=0;for(let r=0;r<s.length-1;r++)e+=s[r].dist(s[r+1]);return e}function _P(s,e,r){return s?.6*e*r:0}function yP(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function g4(s,e,r,l,u,p){const m=_P(r,u,p),v=yP(r,l)*p;let b=0;const S=gP(s)/2;for(let A=0;A<s.length-1;A++){const C=s[A],M=s[A+1],z=C.dist(M);if(b+z>S){const O=(S-b)/z,$=Kt(C.x,M.x,O),W=Kt(C.y,M.y,O),q=new Sc($,W,0,M.angleTo(C),A);return!m||mP(s,q,v,m,e)?q:void 0}b+=z}}function _4(s,e,r,l,u,p,m,v,b){const S=_P(l,p,m),A=yP(l,u),C=A*m,M=s[0].x===0||s[0].x===b||s[0].y===0||s[0].y===b;return e-C<e/4&&(e=C+e/4),vP(s,M?e/2*v%e:(A/2+2*p)*m*v%e,e,S,r,C,M,!1,b)}function vP(s,e,r,l,u,p,m,v,b){const S=p/2,A=gP(s);let C=0,M=e-r,z=[];for(let O=0;O<s.length-1;O++){const $=s[O],W=s[O+1],q=$.dist(W),ie=W.angleTo($);for(;M+r<C+q;){M+=r;const re=(M-C)/q,le=Kt($.x,W.x,re),we=Kt($.y,W.y,re);if(le>=0&&le<b&&we>=0&&we<b&&M-S>=0&&M+S<=A){const be=new Sc(le,we,0,ie,O);l&&!mP(s,be,p,l,u)||z.push(be)}}C+=q}return v||z.length||m||(z=vP(s,C/2,r,l,u,p,m,!0,b)),z}function xP(s){let e=0,r=0;for(const m of s)e+=m.w*m.h,r=Math.max(r,m.w);s.sort((m,v)=>v.h-m.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,p=0;for(const m of s)for(let v=l.length-1;v>=0;v--){const b=l[v];if(!(m.w>b.w||m.h>b.h)){if(m.x=b.x,m.y=b.y,p=Math.max(p,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===b.w&&m.h===b.h){const S=l.pop();S&&v<l.length&&(l[v]=S)}else m.h===b.h?(b.x+=m.w,b.w-=m.w):m.w===b.w?(b.y+=m.h,b.h-=m.h):(l.push({x:b.x+m.w,y:b.y,w:b.w-m.w,h:m.h}),b.y+=m.h,b.h-=m.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}Pt(Sc,"Anchor");const od=1;class d_{static getImagePositionScale(e,r,l){if(r&&e&&e.options&&e.options.transform){const u=e.options.transform;return{x:u.a,y:u.d}}return{x:l,y:l}}constructor(e,r,l,u){this.paddedRect=e;const{pixelRatio:p,version:m,stretchX:v,stretchY:b,content:S,sdf:A,usvg:C}=r;this.pixelRatio=p,this.stretchX=v,this.stretchY=b,this.content=S,this.version=m,this.padding=l,this.sdf=A,this.usvg=C,this.scale=d_.getImagePositionScale(u,C,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Ub(s,e,r){const l=Vo.parse(s),u=function(p,m,v=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*v[0])+2*m,h:(p.data?p.data.height:p.height*v[1])+2*m}}(e,r,[l.options.transform.a,l.options.transform.d]);return{bin:u,imagePosition:new d_(u,e,r,l),imageVariant:l}}class wP{constructor(e,r,l){const u=new Map,p=new Map;this.haveRenderCallbacks=[];const m=[];this.addImages(e,u,od,m),this.addImages(r,p,2,m);const{w:v,h:b}=xP(m),S=new ns({width:v||1,height:b||1});for(const[A,C]of e.entries()){const M=u.get(A).paddedRect;ns.copy(C.data,S,{x:0,y:0},{x:M.x+od,y:M.y+od},C.data,null,C.sdf)}for(const[A,C]of r.entries()){const M=p.get(A),z=M.paddedRect;let O=M.padding;const $=z.x+O,W=z.y+O,q=C.data.width,ie=C.data.height;O=O>1?O-1:O,ns.copy(C.data,S,{x:0,y:0},{x:$,y:W},C.data,l),ns.copy(C.data,S,{x:0,y:ie-O},{x:$,y:W-O},{width:q,height:O},l),ns.copy(C.data,S,{x:0,y:0},{x:$,y:W+ie},{width:q,height:O},l),ns.copy(C.data,S,{x:q-O,y:0},{x:$-O,y:W},{width:O,height:ie},l),ns.copy(C.data,S,{x:0,y:0},{x:$+q,y:W},{width:O,height:ie},l),ns.copy(C.data,S,{x:q-O,y:ie-O},{x:$-O,y:W-O},{width:O,height:O},l),ns.copy(C.data,S,{x:0,y:ie-O},{x:$+q,y:W-O},{width:O,height:O},l),ns.copy(C.data,S,{x:0,y:0},{x:$+q,y:W+ie},{width:O,height:O},l),ns.copy(C.data,S,{x:q-O,y:0},{x:$-O,y:W+ie},{width:O,height:O},l)}this.lut=l,this.image=S,this.iconPositions=u,this.patternPositions=p}addImages(e,r,l,u){for(const[p,m]of e.entries()){const{bin:v,imagePosition:b,imageVariant:S}=Ub(p,m,l);r.set(p,b),u.push(v),m.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(e,r,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const u of e.getUpdatedImages(l)){for(const p of this.iconPositions.keys()){const m=Vo.parse(p);if(lo.isEqual(m.id,u)){const v=e.getImage(u,l);this.patchUpdatedImage(this.iconPositions.get(p),v,r,null)}}for(const p of this.patternPositions.keys()){const m=Vo.parse(p);if(lo.isEqual(m.id,u)){const v=e.getImage(u,l);this.patchUpdatedImage(this.patternPositions.get(p),v,r,this.lut)}}}}patchUpdatedImage(e,r,l,u=null){if(!e||!r||e.version===r.version)return;e.version=r.version;const[p,m]=e.tl,v=e.sdf;if(this.lut||v){const b={width:r.data.width,height:r.data.height},S=new ns(b);ns.copy(r.data,S,{x:0,y:0},{x:0,y:0},b,u,v),l.update(S,{position:{x:p,y:m}})}else l.update(r.data,{position:{x:p,y:m}})}}Pt(d_,"ImagePosition"),Pt(wP,"ImageAtlas");const f_=1e20;function bP(s,e,r,l,u,p,m,v,b){for(let S=e;S<e+l;S++)TP(s,r*p+S,p,u,m,v,b);for(let S=r;S<r+u;S++)TP(s,S*p+e,1,l,m,v,b)}function TP(s,e,r,l,u,p,m){p[0]=0,m[0]=-f_,m[1]=f_,u[0]=s[e];for(let v=1,b=0,S=0;v<l;v++){u[v]=s[e+v*r];const A=v*v;do{const C=p[b];S=(u[v]-u[C]+A-C*C)/(v-C)/2}while(S<=m[b]&&--b>-1);b++,p[b]=v,m[b]=S,m[b+1]=f_}for(let v=0,b=0;v<l;v++){for(;m[b+1]<v;)b++;const S=p[b],A=v-S;s[e+v*r]=u[S]+A*A}}const Va=2,Gb={none:0,ideographs:1,all:2};class fp{constructor(e,r,l){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=l,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const l=[],u=this.url||as.GLYPHS_URL;for(const p in e)for(const m of e[p])l.push({stack:p,id:m});He(l,({stack:p,id:m},v)=>{let b=this.entries[p];b||(b=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=b.glyphs[m];if(S!==void 0)return void v(null,{stack:p,id:m,glyph:S});if(S=this._tinySDF(b,p,m),S)return b.glyphs[m]=S,void v(null,{stack:p,id:m,glyph:S});const A=Math.floor(m/256);if(256*A>65535)return Dn("glyphs > 65535 not supported"),void v(null,{stack:p,id:m,glyph:S});if(b.ranges[A])return void v(null,{stack:p,id:m,glyph:S});let C=b.requests[A];C||(C=b.requests[A]=[],fp.loadGlyphRange(p,A,u,this.requestManager,(M,z)=>{if(z){b.ascender=z.ascender,b.descender=z.descender;for(const O in z.glyphs)this._doesCharSupportLocalGlyph(+O)||(b.glyphs[+O]=z.glyphs[+O]);b.ranges[A]=!0}for(const O of C)O(M,z);delete b.requests[A]})),C.push((M,z)=>{M?v(M):z&&v(null,{stack:p,id:m,glyph:z.glyphs[m]||null})})},(p,m)=>{if(p)r(p);else if(m){const v={};for(const{stack:b,id:S,glyph:A}of m)v[b]===void 0&&(v[b]={}),v[b].glyphs===void 0&&(v[b].glyphs={}),v[b].glyphs[S]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},v[b].ascender=this.entries[b].ascender,v[b].descender=this.entries[b].descender;r(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Gb.none&&(this.localGlyphMode===Gb.all?!!this.localFontFamily:!!this.localFontFamily&&(Xt["CJK Unified Ideographs"](e)||Xt["Hangul Syllables"](e)||Xt.Hiragana(e)||Xt.Katakana(e)||Xt["CJK Symbols and Punctuation"](e)||Xt["CJK Unified Ideographs Extension A"](e)||Xt["CJK Unified Ideographs Extension B"](e)||Xt.Osage(e)))}_tinySDF(e,r,l){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let $="400";/bold/i.test(r)?$="900":/medium/i.test(r)?$="500":/light/i.test(r)&&($="200"),p=e.tinySDF=new fp.TinySDF({fontFamily:u,fontWeight:$,fontSize:24*Va,buffer:3*Va,radius:8*Va}),p.fontWeight=$}if(this.localGlyphs[p.fontWeight][l])return this.localGlyphs[p.fontWeight][l];const m=String.fromCodePoint(l),{data:v,width:b,height:S,glyphWidth:A,glyphHeight:C,glyphLeft:M,glyphTop:z,glyphAdvance:O}=p.draw(m);return this.localGlyphs[p.fontWeight][l]={id:l,bitmap:new Tu({width:b,height:S},v),metrics:{width:A/Va,height:C/Va,left:M/Va,top:z/Va-27,advance:O/Va,localGlyph:!0}}}}fp.loadGlyphRange=function(s,e,r,l,u){const p=256*e,m=p+255,v=l.transformRequest(l.normalizeGlyphsURL(r).replace("{fontstack}",s).replace("{range}",`${p}-${m}`),qd.Glyphs);Wc(v,(b,S)=>{if(b)u(b);else if(S){const A={},C=function(M){return new Px(M).readFields(u4,{})}(S);for(const M of C.glyphs)A[M.id]=M;u(null,{glyphs:A,ascender:C.ascender,descender:C.descender})}})},fp.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:r=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:m="normal",lang:v=null}={}){this.buffer=e,this.cutoff=l,this.radius=r,this.lang=v;const b=this.size=s+4*e,S=this._createCanvas(b),A=this.ctx=S.getContext("2d",{willReadFrequently:!0});A.font=`${m} ${p} ${s}px ${u}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(s),m=Math.ceil(r),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),b=Math.min(this.size-this.buffer,m+Math.ceil(l)),S=v+2*this.buffer,A=b+2*this.buffer,C=Math.max(S*A,0),M=new Uint8ClampedArray(C),z={data:M,width:S,height:A,glyphWidth:v,glyphHeight:b,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(v===0||b===0)return z;const{ctx:O,buffer:$,gridInner:W,gridOuter:q}=this;this.lang&&(O.lang=this.lang),O.clearRect($,$,v,b),O.fillText(s,$,$+m);const ie=O.getImageData($,$,v,b);q.fill(f_,0,C),W.fill(0,0,C);for(let re=0;re<b;re++)for(let le=0;le<v;le++){const we=ie.data[4*(re*v+le)+3]/255;if(we===0)continue;const be=(re+$)*S+le+$;if(we===1)q[be]=0,W[be]=f_;else{const Ie=.5-we;q[be]=Ie>0?Ie*Ie:0,W[be]=Ie<0?Ie*Ie:0}}bP(q,0,0,S,A,S,this.f,this.v,this.z),bP(W,$,$,v,b,S,this.f,this.v,this.z);for(let re=0;re<C;re++){const le=Math.sqrt(q[re])-Math.sqrt(W[re]);M[re]=Math.round(255-255*(le/this.radius+this.cutoff))}return z}};const Iu=od;function SP(s,e){return s+e[1]-e[0]}function EP(s,e,r,l,u=1){const p=[],m=s.imagePrimary,v=m.pixelRatio,b=m.paddedRect.w-2*Iu,S=m.paddedRect.h-2*Iu,A=(s.right-s.left)*u,C=(s.bottom-s.top)*u,M=m.stretchX||[[0,b]],z=m.stretchY||[[0,S]],O=M.reduce(SP,0),$=z.reduce(SP,0),W=b-O,q=S-$;let ie=0,re=O,le=0,we=$,be=0,Ie=W,Pe=0,Me=q;if(m.content&&l){const ze=m.content;ie=Rx(M,0,ze[0]),le=Rx(z,0,ze[1]),re=Rx(M,ze[0],ze[2]),we=Rx(z,ze[1],ze[3]),be=ze[0]-ie,Pe=ze[1]-le,Ie=ze[2]-ze[0]-re,Me=ze[3]-ze[1]-we}const Ye=(ze,Qe,lt,tt)=>{const rt=kx(ze.stretch-ie,re,A,s.left*u),dt=Dx(ze.fixed-be,Ie,ze.stretch,O),Xe=kx(Qe.stretch-le,we,C,s.top*u),ot=Dx(Qe.fixed-Pe,Me,Qe.stretch,$),Ge=kx(lt.stretch-ie,re,A,s.left*u),je=Dx(lt.fixed-be,Ie,lt.stretch,O),ft=kx(tt.stretch-le,we,C,s.top*u),ut=Dx(tt.fixed-Pe,Me,tt.stretch,$),Gt=new ct(rt,Xe),At=new ct(Ge,Xe),Lt=new ct(Ge,ft),yt=new ct(rt,ft),Vt=new ct(dt/v,ot/v),an=new ct(je/v,ut/v),St=e*Math.PI/180;if(St){const kt=Math.sin(St),fn=Math.cos(St),Fn=[fn,-kt,kt,fn];Gt._matMult(Fn),At._matMult(Fn),yt._matMult(Fn),Lt._matMult(Fn)}const Ft=ze.stretch+ze.fixed,Yt=lt.stretch+lt.fixed,dn=Qe.stretch+Qe.fixed,En=tt.stretch+tt.fixed,mn=s.imageSecondary;return{tl:Gt,tr:At,bl:yt,br:Lt,texPrimary:{x:m.paddedRect.x+Iu+Ft,y:m.paddedRect.y+Iu+dn,w:Yt-Ft,h:En-dn},texSecondary:mn?{x:mn.paddedRect.x+Iu+Ft,y:mn.paddedRect.y+Iu+dn,w:Yt-Ft,h:En-dn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vt,pixelOffsetBR:an,minFontScaleX:Ie/v/A,minFontScaleY:Me/v/C,isSDF:r}};if(l&&(m.stretchX||m.stretchY)){const ze=IP(M,W,O),Qe=IP(z,q,$);for(let lt=0;lt<ze.length-1;lt++){const tt=ze[lt],rt=ze[lt+1];for(let dt=0;dt<Qe.length-1;dt++)p.push(Ye(tt,Qe[dt],rt,Qe[dt+1]))}}else p.push(Ye({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return p}function Rx(s,e,r){let l=0;for(const u of s)l+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return l}function IP(s,e,r){const l=[{fixed:-Iu,stretch:0}];for(const[u,p]of s){const m=l[l.length-1];l.push({fixed:u-m.stretch,stretch:m.stretch}),l.push({fixed:u-m.stretch,stretch:m.stretch+(p-u)})}return l.push({fixed:e+Iu,stretch:r}),l}function kx(s,e,r,l){return s/e*r+l}function Dx(s,e,r,l){return s-e*r/l}function y4(s,e,r,l){const u=e+s.positionedLines[l].lineOffset;return l===0?r+u/2:r+(u+(e+s.positionedLines[l-1].lineOffset))/2}function v4(s,e=1,r=!1){let l=1/0,u=1/0,p=-1/0,m=-1/0;const v=s[0];for(let z=0;z<v.length;z++){const O=v[z];(!z||O.x<l)&&(l=O.x),(!z||O.y<u)&&(u=O.y),(!z||O.x>p)&&(p=O.x),(!z||O.y>m)&&(m=O.y)}const b=Math.min(p-l,m-u);let S=b/2;const A=new df([],x4);if(b===0)return new ct(l,u);for(let z=l;z<p;z+=b)for(let O=u;O<m;O+=b)A.push(new pp(z+S,O+S,S,s));let C=function(z){let O=0,$=0,W=0;const q=z[0];for(let ie=0,re=q.length,le=re-1;ie<re;le=ie++){const we=q[ie],be=q[le],Ie=we.x*be.y-be.x*we.y;$+=(we.x+be.x)*Ie,W+=(we.y+be.y)*Ie,O+=3*Ie}return new pp($/O,W/O,0,z)}(s),M=A.length;for(;A.length;){const z=A.pop();(z.d>C.d||!C.d)&&(C=z,r&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,M)),z.max-C.d<=e||(S=z.h/2,A.push(new pp(z.p.x-S,z.p.y-S,S,s)),A.push(new pp(z.p.x+S,z.p.y-S,S,s)),A.push(new pp(z.p.x-S,z.p.y+S,S,s)),A.push(new pp(z.p.x+S,z.p.y+S,S,s)),M+=4)}return r&&(console.log(`num probes: ${M}`),console.log(`best distance: ${C.d}`)),C.p}function x4(s,e){return e.max-s.max}class pp{constructor(e,r,l,u){this.p=new ct(e,r),this.h=l,this.d=function(p,m){let v=!1,b=1/0;for(let S=0;S<m.length;S++){const A=m[S];for(let C=0,M=A.length,z=M-1;C<M;z=C++){const O=A[C],$=A[z];O.y>p.y!=$.y>p.y&&p.x<($.x-O.x)*(p.y-O.y)/($.y-O.y)+O.x&&(v=!v),b=Math.min(b,Di(p,O,$))}}return(v?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const w4=Object.keys,$b=Number.POSITIVE_INFINITY,b4=Math.sqrt(2);function AP(s,[e,r]){let l=0,u=0;if(r===$b){e<0&&(e=0);const p=e/b4;switch(s){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(s){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),s){case"top-right":case"top-left":case"top":u=r-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-r}switch(s){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,u]}function Lx(s,e,r,l,u,p,m,v,b){if(!e||!e.usvg)return;const S=fP(l),A=fP(u),C=p!=="both"&&p!=="width"||!hP(l)?1:A.width/S.width,M=p!=="both"&&p!=="height"||!dP(l)?1:A.height/S.height;r.scaleSelf(C,M);const z=r.toString();m.set(z,r),v.set(z,e);const{imagePosition:O}=Ub(z,e,od);b.set(z,O)}function CP(s,e,r,l,u,p,m,v,b){if(!s)return;const S=function(A,C,M,z,O,$){if(A.kind==="camera")return A.maxSize;if(A.kind==="composite"){const W=C.possiblyEvaluate(new _i(A.maxZoom,{worldview:$}),M).evaluate(O,{},M),q=C.possiblyEvaluate(new _i(A.minZoom,{worldview:$}),M).evaluate(O,{},M);return Math.max(W,q)}return C.possiblyEvaluate(new _i(z,{worldview:$})).evaluate(O,{},M)}(e,r,l,u,p,b);return s.scaleSelf(S*v*m)}function PP(s,e,r,l,u,p,m,v,b){return{iconPrimary:CP(s.getPrimary(),e,r,l,u,p,m,v,b),iconSecondary:CP(s.getSecondary(),e,r,l,u,p,m,v,b)}}function T4(s,e,r){if(!e)return;const l=r.get(s.toString()),u=r.get(e.toString());l&&u&&(l.paddedRect.w===u.paddedRect.w&&l.paddedRect.h===u.paddedRect.h||Dn(`Mismatch in icon variant sizes: ${s.toString()} and ${e.toString()}`),l.usvg!==u.usvg&&Dn(`Mismatch in icon variant image types: ${s.id} and ${e.id}`))}function MP(s,e,r,l){if(!s)return;const u=e.get(r.toString());if(s.imagePrimary=u,l){const p=e.get(l.toString());s.imageSecondary=p}}function S4(s,e){for(const r in s.horizontal)RP(s.horizontal[r],e);RP(s.vertical,e)}function RP(s,e){if(s){for(const r of s.positionedLines)for(const l of r.positionedGlyphs)if(l.image!==null){const u=l.image.toString();l.rect=e.get(u).paddedRect}}}function Hb(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function E4(s,e,r,l,u,p,m,v,b){const S=Wb(p.horizontal)||p.vertical,A=r.get("icon-text-fit-padding").evaluate(l,{},u);let C,M=e;return e&&b!=="none"&&(s.allowVerticalPlacement&&p.vertical&&(C=uP(e,p.vertical,b,A,v,m)),S&&(M=uP(e,S,b,A,v,m))),{defaultShapedIcon:M,verticallyShapedIcon:C}}function I4(s,e,r,l,u,p,m,v,b,S,A,C,M,z,O,$,W,q,ie,re){let le=m.textMaxSize.evaluate(e,{},M);le===void 0?le=v*m.textScaleFactor:le*=m.textScaleFactor;const we=s.layers[0].layout,be=Wb(r.horizontal)||r.vertical,Ie=z.name==="globe",Pe=jr,Me=s.tilePixelRatio*le/Pe,Ye=(dt=s.overscaling,s.zoom>18&&dt>2&&(dt>>=1),Math.max(vt/(512*dt),1)*we.get("symbol-spacing")),ze=we.get("text-padding")*s.tilePixelRatio,Qe=we.get("icon-padding")*s.tilePixelRatio,lt=De(we.get("text-max-angle")),tt=we.get("icon-rotation-alignment")==="map"&&re!=="point",rt=Ye/2;var dt;s.hasAnyIconTextFit===!1&&W!=="none"&&(s.hasAnyIconTextFit=!0);const Xe=e.properties?+e.properties[vn]:null,ot=Xe&&s.elevationFeatureIdToIndex?s.elevationFeatureIdToIndex.get(Xe):65535,Ge=(je,ft,ut)=>{if(ft.x<0||ft.x>=vt||ft.y<0||ft.y>=vt)return;let Gt=null;if(Ie){const{x:At,y:Lt,z:yt}=z.projectTilePoint(ft.x,ft.y,ut);Gt={anchor:new Sc(At,Lt,yt,0,void 0),up:z.upVector(ut,ft.x,ft.y)}}(function(At,Lt,yt,Vt,an,St,Ft,Yt,dn,En,mn,kt,fn,Fn,he,de,Ue,Ke,Tt,bt,Rt,Wt,In,An,bn,ni,Pi,wn,yi){const oi=At.addToLineVertexArray(Lt,Vt);let Gn,xi,wi,mi,vi,ai,Cn,li=0,Fi=0,en=0,Bn=0,bi=-1,Gi=-1;const Ii={};let pr=Yd("");const hi=yt?yt.anchor:Lt,sr=wn!=="none";let Gs=0,is=0;if(dn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const mr=dn.layout.get("text-offset").evaluate(Rt,{},bn);Gs=mr[0]*jr,is=mr[1]*jr}else Gs=dn.layout.get("text-radial-offset").evaluate(Rt,{},bn)*jr,is=$b;if(At.allowVerticalPlacement&&an.vertical){const mr=an.vertical;if(he)ai=qb(mr),Yt&&(Cn=qb(Yt));else{const Pr=dn.layout.get("text-rotate").evaluate(Rt,{},bn)+90;wi=zx(En,hi,Lt,mn,kt,fn,mr,Fn,Pr,de),Yt&&(mi=zx(En,hi,Lt,mn,kt,fn,Yt,Ke,Pr))}}if(St){const mr=At.iconSizeData,Pr=dn.layout.get("icon-rotate").evaluate(Rt,{},bn),rs=EP(St,Pr,In,sr,Wt.iconScaleFactor),Ts=Yt?EP(Yt,Pr,In,sr,Wt.iconScaleFactor):void 0;xi=zx(En,hi,Lt,mn,kt,fn,St,Ke,Pr,null),li=4*rs.length;let us=null;mr.kind==="source"?(us=[Ml*dn.layout.get("icon-size").evaluate(Rt,{},bn)*Wt.iconScaleFactor],us[0]>Au&&Dn(`${At.layerIds[0]}: Value for "icon-size" is >= ${p_}. Reduce your "icon-size".`)):mr.kind==="composite"&&(us=[Ml*Wt.compositeIconSizes[0].evaluate(Rt,{},bn)*Wt.iconScaleFactor,Ml*Wt.compositeIconSizes[1].evaluate(Rt,{},bn)*Wt.iconScaleFactor],(us[0]>Au||us[1]>Au)&&Dn(`${At.layerIds[0]}: Value for "icon-size" is >= ${p_}. Reduce your "icon-size".`)),At.addSymbols(At.icon,rs,us,bt,Tt,Rt,void 0,yt,Lt,oi.lineStartIndex,oi.lineLength,-1,An,bn,ni,Pi),bi=At.icon.placedSymbolArray.length-1,Ts&&(Fi=4*Ts.length,At.addSymbols(At.icon,Ts,us,bt,Tt,Rt,_o.vertical,yt,Lt,oi.lineStartIndex,oi.lineLength,-1,An,bn,ni,Pi),Gi=At.icon.placedSymbolArray.length-1)}for(const mr in an.horizontal){const Pr=mr,rs=an.horizontal[Pr];Gn||(pr=Yd(rs.text),he?vi=qb(rs):Gn=zx(En,hi,Lt,mn,kt,fn,rs,Fn,dn.layout.get("text-rotate").evaluate(Rt,{},bn),de));const Ts=rs.positionedLines.length===1;if(en+=kP(At,yt,Lt,rs,Ft,dn,he,Rt,de,oi,an.vertical?_o.horizontal:_o.horizontalOnly,Ts?w4(an.horizontal):[Pr],Ii,bi,Wt,An,bn,ni),Ts)break}an.vertical&&(Bn+=kP(At,yt,Lt,an.vertical,Ft,dn,he,Rt,de,oi,_o.vertical,["vertical"],Ii,Gi,Wt,An,bn,ni));let qr=-1;const $s=(mr,Pr)=>mr?Math.max(mr,Pr):Pr;qr=$s(vi,qr),qr=$s(ai,qr),qr=$s(Cn,qr);const Rl=qr>-1?1:0;At.glyphOffsetArray.length>=65535&&Dn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Rt.sortKey!==void 0&&At.addToSortKeyRanges(At.symbolInstances.length,Rt.sortKey),At.symbolInstances.emplaceBack(Lt.x,Lt.y,hi.x,hi.y,hi.z,Ii.right>=0?Ii.right:-1,Ii.center>=0?Ii.center:-1,Ii.left>=0?Ii.left:-1,Ii.vertical>=0?Ii.vertical:-1,bi,Gi,pr,Gn!==void 0?Gn:At.collisionBoxArray.length,Gn!==void 0?Gn+1:At.collisionBoxArray.length,wi!==void 0?wi:At.collisionBoxArray.length,wi!==void 0?wi+1:At.collisionBoxArray.length,xi!==void 0?xi:At.collisionBoxArray.length,xi!==void 0?xi+1:At.collisionBoxArray.length,mi||At.collisionBoxArray.length,mi?mi+1:At.collisionBoxArray.length,mn,en,Bn,li,Fi,Rl,0,Gs,is,qr,0,sr?1:0,yi)})(s,ft,Gt,je,r,l,p,u,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,ze,ie,S,0,Qe,tt,q,e,m,A,C,M,O,$,W,ot)};if(re==="line")for(const je of wx(e.geometry,0,0,vt,vt)){const ft=_4(je,Ye,lt,r.vertical||be,l,Pe,Me,s.overscaling,vt);for(const ut of ft)be&&A4(s,be.text,rt,ut)||Ge(je,ut,M)}else if(re==="line-center"){for(const je of e.geometry)if(je.length>1){const ft=g4(je,lt,r.vertical||be,l,Pe,Me);ft&&Ge(je,ft,M)}}else if(e.type==="Polygon")for(const je of Kg(e.geometry,0)){const ft=v4(je,16);Ge(je[0],new Sc(ft.x,ft.y,0,0,void 0),M)}else if(e.type==="LineString")for(const je of e.geometry)Ge(je,new Sc(je[0].x,je[0].y,0,0,void 0),M);else if(e.type==="Point")for(const je of e.geometry)for(const ft of je)Ge([ft],new Sc(ft.x,ft.y,0,0,void 0),M)}const p_=255,Au=p_*Ml;function kP(s,e,r,l,u,p,m,v,b,S,A,C,M,z,O,$,W,q){const ie=function(we,be,Ie,Pe,Me,Ye,ze,Qe){const lt=[];if(be.positionedLines.length===0)return lt;const tt=Pe.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,rt=function(je){const ft=je[0],ut=je[1],Gt=ft*ut;return Gt>0?[ft,-ut]:Gt<0?[-ft,ut]:ft===0?[ut,ft]:[ut,-ft]}(Ie);let dt=Math.abs(be.top-be.bottom);for(const je of be.positionedLines)dt-=je.lineOffset;const Xe=be.positionedLines.length,ot=dt/Xe;let Ge=be.top-Ie[1];for(let je=0;je<Xe;++je){const ft=be.positionedLines[je];Ge=y4(be,ot,Ge,je);for(const ut of ft.positionedGlyphs){if(!ut.rect)continue;const Gt=ut.rect||{};let At=iP+1,Lt=!0,yt=1,Vt=0;if(ut.image){const Rt=ze.get(ut.image.toString());if(!Rt)continue;if(Rt.sdf){Dn("SDF images are not supported in formatted text and will be ignored.");continue}Lt=!1,yt=Rt.pixelRatio,At=od/yt}const an=(Me||Qe)&&ut.vertical,St=ut.metrics.advance*ut.scale/2,Ft=ut.metrics,Yt=ut.rect;if(Yt===null)continue;Qe&&be.verticalizable&&(Vt=ut.image?St-ut.metrics.width*ut.scale/2:0);const dn=Me?[ut.x+St,ut.y]:[0,0];let En=[0,0],mn=[0,0],kt=!1;Me||(an?(mn=[ut.x+St+rt[0],ut.y+rt[1]-Vt],kt=!0):En=[ut.x+St+Ie[0],ut.y+Ie[1]-Vt]);const fn=Yt.w*ut.scale/(yt*(ut.localGlyph?Va:1)),Fn=Yt.h*ut.scale/(yt*(ut.localGlyph?Va:1));let he,de,Ue,Ke;if(an){const Rt=ut.y-Ge,Wt=new ct(-St,St-Rt),In=-Math.PI/2,An=new ct(...mn);he=new ct(-St+En[0],En[1]),he._rotateAround(In,Wt)._add(An),he.x+=-Rt+St,he.y-=(Ft.left-At)*ut.scale;const bn=ut.image?Ft.advance*ut.scale:jr*ut.scale,ni=String.fromCodePoint(ut.glyph);Qj(ni)?he.x+=(1-At)*ut.scale:e4(ni)?he.x+=bn-Ft.height*ut.scale+(-At-1)*ut.scale:he.x+=ut.image||Ft.width+2*At===Yt.w&&Ft.height+2*At===Yt.h?(bn-Fn)/2:(bn-(Ft.height+2*At)*ut.scale)/2,de=new ct(he.x,he.y-fn),Ue=new ct(he.x+Fn,he.y),Ke=new ct(he.x+Fn,he.y-fn)}else{const Rt=(Ft.left-At)*ut.scale-St+En[0],Wt=(-Ft.top-At)*ut.scale+En[1],In=Rt+fn,An=Wt+Fn;he=new ct(Rt,Wt),de=new ct(In,Wt),Ue=new ct(Rt,An),Ke=new ct(In,An)}if(tt){let Rt;Rt=Me?new ct(0,0):kt?new ct(rt[0],rt[1]):new ct(Ie[0],Ie[1]),he._rotateAround(tt,Rt),de._rotateAround(tt,Rt),Ue._rotateAround(tt,Rt),Ke._rotateAround(tt,Rt)}const Tt=new ct(0,0),bt=new ct(0,0);lt.push({tl:he,tr:de,bl:Ue,br:Ke,texPrimary:Gt,texSecondary:void 0,writingMode:be.writingMode,glyphOffset:dn,sectionIndex:ut.sectionIndex,isSDF:Lt,pixelOffsetTL:Tt,pixelOffsetBR:bt,minFontScaleX:0,minFontScaleY:0})}}return lt}(0,l,b,p,m,v,u,s.allowVerticalPlacement),re=s.textSizeData;let le=null;re.kind==="source"?(le=[Ml*p.layout.get("text-size").evaluate(v,{},W)*O.textScaleFactor],le[0]>Au&&Dn(`${s.layerIds[0]}: Value for "text-size" is >= ${p_}. Reduce your "text-size".`)):re.kind==="composite"&&(le=[Ml*O.compositeTextSizes[0].evaluate(v,{},W)*O.textScaleFactor,Ml*O.compositeTextSizes[1].evaluate(v,{},W)*O.textScaleFactor],(le[0]>Au||le[1]>Au)&&Dn(`${s.layerIds[0]}: Value for "text-size" is >= ${p_}. Reduce your "text-size".`)),s.addSymbols(s.text,ie,le,b,m,v,A,e,r,S.lineStartIndex,S.lineLength,z,$,W,q,!1);for(const we of C)M[we]=s.text.placedSymbolArray.length-1;return 4*ie.length}function Wb(s){for(const e in s)return s[e];return null}function zx(s,e,r,l,u,p,m,v,b,S){let A=m.top,C=m.bottom,M=m.left,z=m.right;if(cP(m)&&m.collisionPadding){const O=m.collisionPadding;M-=O[0],A-=O[1],z+=O[2],C+=O[3]}if(b){const O=new ct(M,A),$=new ct(z,A),W=new ct(M,C),q=new ct(z,C),ie=De(b);let re=new ct(0,0);S&&(re=new ct(S[0],S[1])),O._rotateAround(ie,re),$._rotateAround(ie,re),W._rotateAround(ie,re),q._rotateAround(ie,re),M=Math.min(O.x,$.x,W.x,q.x),z=Math.max(O.x,$.x,W.x,q.x),A=Math.min(O.y,$.y,W.y,q.y),C=Math.max(O.y,$.y,W.y,q.y)}return s.emplaceBack(e.x,e.y,e.z,r.x,r.y,M,A,z,C,v,l,u,p),s.length-1}function qb(s){cP(s)&&s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function A4(s,e,r,l){const u=s.compareText;if(e in u){const p=u[e];for(let m=p.length-1;m>=0;m--)if(l.dist(p[m])<r)return!0}else u[e]=[];return u[e].push(l),!1}function DP(s,e){const r=s.fovAboveCenter,l=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,u=(s._camera.position[2]*s.worldSize-l)/Math.cos(s._pitch),p=Math.sin(r)*u/Math.sin(Math.max(Math.PI/2-s._pitch-r,.01));let m=Math.sin(s._pitch)*p+u;const v=u*(1/s._horizonShift);if(!s.elevation||s.elevation.exaggeration()===0){let b=Math.max(s.zoom-17,0);s.isOrthographic&&(b/=10),m*=1+b}return Math.min(1.01*m,v)}function m_(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const r=Math.pow(2,-s.z),l=s.x*r,u=(s.x+1)*r,p=s.y*r,m=(s.y+1)*r,v=ve(l),b=ve(u),S=_e(p),A=_e(m),C=e.project(v,S),M=e.project(b,S),z=e.project(b,A),O=e.project(v,A);let $=Math.min(C.x,M.x,z.x,O.x),W=Math.min(C.y,M.y,z.y,O.y),q=Math.max(C.x,M.x,z.x,O.x),ie=Math.max(C.y,M.y,z.y,O.y);const re=r/16;function le(be,Ie,Pe,Me,Ye,ze){const Qe=(Pe+Ye)/2,lt=(Me+ze)/2,tt=e.project(ve(Qe),_e(lt)),rt=Math.max(0,$-tt.x,W-tt.y,tt.x-q,tt.y-ie);$=Math.min($,tt.x),q=Math.max(q,tt.x),W=Math.min(W,tt.y),ie=Math.max(ie,tt.y),rt>re&&(le(be,tt,Pe,Me,Qe,lt),le(tt,Ie,Qe,lt,Ye,ze))}le(C,M,l,p,u,p),le(M,z,u,p,u,m),le(z,O,u,m,l,m),le(O,C,l,m,l,p),$-=re,W-=re,q+=re,ie+=re;const we=1/Math.max(q-$,ie-W);return{scale:we,x:$*we,y:W*we,x2:q*we,y2:ie*we,projection:e}}function LP(s,{x:e,y:r},l=0){return new ct(((e-l)*s.scale-s.x)*vt,(r*s.scale-s.y)*vt)}const C4=K(new Float32Array(16));class Cu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new G(0,0)}projectTilePoint(e,r,l){return{x:e,y:r,z:0}}locationPoint(e,r,l,u=!0){return e._coordinatePoint(e.locationCoordinate(r,l),u)}pixelsPerMeter(e,r){return ge(1,e)*r}pixelSpaceConversion(e,r,l){return 1}farthestPixelDistance(e){return DP(e,e.pixelsPerMeter)}pointCoordinate(e,r,l,u){const p=e.horizonLineFromTop(!1),m=new ct(r,Math.max(p,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,u))}pointCoordinate3D(e,r,l){const u=new ct(r,l);if(e.elevation)return e.elevation.pointCoordinate(u);{const p=this.pointCoordinate(e,u.x,u.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);const l=e.horizonLineFromTop();return r.y<l}createInversionMatrix(e,r){return C4}createTileMatrix(e,r,l){let u,p,m;const v=l.canonical,b=K(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=m_(v,this);u=1,p=S.x+l.wrap*S.scale,m=S.y,ae(b,b,[u/S.scale,u/S.scale,e.pixelsPerMeter/r])}else u=r/e.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*l.wrap)*u,m=v.y*u;return Q(b,b,[p,m,0]),ae(b,b,[u/vt,u/vt,1]),b}upVector(e,r,l){return[0,0,1]}upVectorScale(e,r,l){return{metersToTile:1}}}class P4 extends Cu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,l]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(De(r));this.n=(u+Math.sin(De(l)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:l,c:u,r0:p}=this,m=De(e-this.center[0]),v=De(r),b=Math.sqrt(u-2*l*Math.sin(v))/l;return{x:b*Math.sin(m*l),y:b*Math.cos(m*l)-p,z:0}}unproject(e,r){const{n:l,c:u,r0:p}=this,m=p+r;let v=Math.atan2(e,Math.abs(m))*Math.sign(m);m*l<0&&(v-=Math.PI*Math.sign(e)*Math.sign(m));const b=De(this.center[0])*l;v=ke(v,-Math.PI-b,Math.PI-b);const S=Se(X(v/l)+this.center[0],-180,180),A=Math.asin(Se((u-(e*e+m*m)*l*l)/(2*l),-1,1)),C=Se(X(A),-xe,xe);return new G(S,C)}}const g_=1.340264,__=-.081106,y_=893e-6,v_=.003796,Ox=Math.sqrt(3)/2;class M4 extends Cu{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(Ox*Math.sin(r)),u=l*l,p=u*u*u;return{x:.5*(e*Math.cos(l)/(Ox*(g_+3*__*u+p*(7*y_+9*v_*u)))/Math.PI+.5),y:1-.5*(l*(g_+__*u+p*(y_+v_*u))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,u=l*l,p=u*u*u;for(let A,C,M,z=0;z<12&&(C=l*(g_+__*u+p*(y_+v_*u))-r,M=g_+3*__*u+p*(7*y_+9*v_*u),A=C/M,l=Se(l-A,-Math.PI/3,Math.PI/3),u=l*l,p=u*u*u,!(Math.abs(A)<1e-12));++z);const m=Ox*e*(g_+3*__*u+p*(7*y_+9*v_*u))/Math.cos(l),v=Math.asin(Math.sin(l)/Ox),b=Se(180*m/Math.PI,-180,180),S=Se(180*v/Math.PI,-xe,xe);return new G(b,S)}}class R4 extends Cu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const l=360*(e-.5),u=Se(360*(.5-r),-xe,xe);return new G(l,u)}}const mp=Math.PI/2;function Fx(s){return Math.tan((mp+s)/2)}class k4 extends Cu{constructor(e){super(e),this.center=e.center||[0,30];const[r,l]=this.parallels=e.parallels||[30,30];let u=De(r),p=De(l);this.southernCenter=u+p<0,this.southernCenter&&(u=-u,p=-p);const m=Math.cos(u),v=Fx(u);this.n=u===p?Math.sin(u):Math.log(m/Math.cos(p))/Math.log(Fx(p)/v),this.f=m*Math.pow(Fx(u),this.n)/this.n}project(e,r){r=De(r),this.southernCenter&&(r=-r),e=De(e-this.center[0]);const l=1e-6,{n:u,f:p}=this;p>0?r<-mp+l&&(r=-mp+l):r>mp-l&&(r=mp-l);const m=p/Math.pow(Fx(r),u);let v=m*Math.sin(u*e),b=p-m*Math.cos(u*e);return v=.5*(v/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:v,y:this.southernCenter?b:1-b,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:l,f:u}=this,p=u-r,m=Math.sign(p),v=Math.sign(l)*Math.sqrt(e*e+p*p);let b=Math.atan2(e,Math.abs(p))*m;p*l<0&&(b-=Math.PI*Math.sign(e)*m);const S=Se(X(b/l)+this.center[0],-180,180),A=Se(X(2*Math.atan(Math.pow(u/v,1/l))-mp),-xe,xe);return new G(S,this.southernCenter?-A:A)}}class zP extends Cu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:ue(e),y:ye(r),z:0}}unproject(e,r){const l=ve(e),u=_e(r);return new G(l,u)}}const OP=De(xe);class D4 extends Cu{project(e,r){const l=(r=De(r))*r,u=l*l;return{x:.5*((e=De(e))*(.8707-.131979*l+u*(u*(.003971*l-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+l*(.015085+u*(.028874*l-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,u=25,p=0,m=l*l;do{m=l*l;const S=m*m;p=(l*(1.007226+m*(.015085+S*(.028874*m-.044475-.005916*S)))-r)/(1.007226+m*(.045255+S*(.259866*m-.311325-.005916*11*S))),l=Se(l-p,-OP,OP)}while(Math.abs(p)>1e-6&&--u>0);m=l*l;const v=Se(X(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),b=X(l);return new G(v,b)}}const FP=De(xe);class L4 extends Cu{project(e,r){r=De(r),e=De(e);const l=Math.cos(r),u=2/Math.PI,p=Math.acos(l*Math.cos(e/2)),m=Math.sin(p)/p,v=.5*(e*u+2*l*Math.sin(e/2)/m)||0,b=.5*(r+Math.sin(r)/m)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,r){let l=e=(2*e-.5)*Math.PI,u=r=(2*(1-r)-1)*Math.PI,p=25;const m=1e-6;let v=0,b=0;do{const S=Math.cos(u),A=Math.sin(u),C=2*A*S,M=A*A,z=S*S,O=Math.cos(l/2),$=Math.sin(l/2),W=2*O*$,q=$*$,ie=1-z*O*O,re=ie?1/ie:0,le=ie?Math.acos(S*O)*Math.sqrt(1/ie):0,we=.5*(2*le*S*$+2*l/Math.PI)-e,be=.5*(le*A+u)-r,Ie=.5*re*(z*q+le*S*O*M)+1/Math.PI,Pe=re*(W*C/4-le*A*$),Me=.125*re*(C*$-le*A*z*W),Ye=.5*re*(M*O+le*q*S)+.5,ze=Pe*Me-Ye*Ie;v=(be*Pe-we*Ye)/ze,b=(we*Me-be*Ie)/ze,l=Se(l-v,-Math.PI,Math.PI),u=Se(u-b,-FP,FP)}while((Math.abs(v)>m||Math.abs(b)>m)&&--p>0);return new G(X(l),X(u))}}class NP extends Cu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(De(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:l,cosPhi:u}=this;return{x:De(e)*u*l+.5,y:-Math.sin(De(r))/u*l+.5,z:0}}unproject(e,r){const{scale:l,cosPhi:u}=this,p=-(r-.5)/l,m=Se(X((e-.5)/l)/u,-180,180),v=Math.asin(Se(p*u,-1,1)),b=Se(X(v),-xe,xe);return new G(m,b)}}class z4 extends zP{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,l){const u=$g(e,r,l);return ui(u,u,dx(Cl(l))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,r,l){const u=D(r.lat,r.lng),p=Vn([],u),m=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;Xn(u,u,p,ge(1,0)*vt*m);const v=K(new Float64Array(16));return Y(v,e.pixelMatrix,e.globeMatrix),ui(u,u,v),new ct(u[0],u[1])}pixelsPerMeter(e,r){return ge(1,0)*r}pixelSpaceConversion(e,r,l){const u=ge(1,e)*r,p=Kt(ge(1,45)*r,u,l);return this.pixelsPerMeter(e,r)/p}createTileMatrix(e,r,l){const u=tb(Cl(l.canonical));return Y(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,r){const{center:l}=e,u=dx(Cl(r));return Be(u,u,De(l.lng)),Te(u,u,De(l.lat)),ae(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,r,l,u){return lA(e,r,l,!0)||new We(0,0)}pointCoordinate3D(e,r,l){const u=this.pointCoordinate(e,r,l,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,r){return!lA(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(u,p){const m=u.cameraToCenterDistance,v=u._centerAltitude*p,b=u._camera,S=u._camera.forward(),A=pn([],on([],S,-m),[0,0,v]),C=u.worldSize/(2*Math.PI),M=[0,0,-C],z=u.width/u.height,O=Math.tan(u.fovAboveCenter),$=on([],b.up(),O),W=on([],b.right(),O*z),q=Vn([],pn([],pn([],S,$),W)),ie=[];let re;if(new Un(A,q).closestPointOnSphere(M,C,ie)){const le=pn([],ie,M),we=ii([],le,A);re=Math.cos(u.fovAboveCenter)*ln(we)}else{const le=ii([],A,M),we=ii([],M,A);Vn(we,we);const be=ln(le)-C;re=Math.sqrt(be*(be+2*C));const Ie=Math.acos(re/(C+be))-Math.acos(Wn(S,we));re*=Math.cos(Ie)}return 1.01*re}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=bu(e.zoom);if(l>0){const u=DP(e,ge(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Kt(r,u+p*(1-Math.cos(m)),Math.pow(l,10))}return r}upVector(e,r,l){return $g(r,l,e,1)}upVectorScale(e){return{metersToTile:cx(hx(Cl(e)))}}}function BP(s){const e=s.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new zP(s);case"equirectangular":return new R4(s);case"naturalEarth":return new D4(s);case"equalEarth":return new M4(s);case"winkelTripel":return new L4(s);case"albers":return r?new NP(s):new P4(s);case"lambertConformalConic":return r?new NP(s):new k4(s);case"globe":return new z4(s)}throw new Error(`Invalid projection name: ${s.name}`)}const O4=at.types,F4=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nx(s,e,r,l,u,p,m,v,b,S,A,C,M){const z=v?Math.min(Au,Math.round(v[0])):0,O=v?Math.min(Au,Math.round(v[1])):0;s.emplaceBack(e,r,Math.round(32*l),Math.round(32*u),p,m,(z<<1)+(b?1:0),O,16*S,16*A,256*C,256*M)}function Bx(s,e,r){s.emplaceBack(e,r)}function jx(s,e,r,l,u,p,m){s.emplaceBack(e,r,l,u,p,m)}const Vx=(s,e,r,l)=>{for(let u=0;u<e;u++)s.emplaceBack(r[0],r[1],r[2],l[0],l[1],l[2])};function Ux(s,e,r,l,u){s.emplaceBack(e,r,l,u),s.emplaceBack(e,r,l,u),s.emplaceBack(e,r,l,u),s.emplaceBack(e,r,l,u)}function N4(s){for(const e of s.sections)if(Uw(e.text))return!0;return!1}class Zb{constructor(e){this.layoutVertexArray=new Dg,this.indexArray=new xr,this.programConfigurations=e,this.segments=new Oi,this.dynamicLayoutVertexArray=new $o,this.opacityVertexArray=new gu,this.placedSymbolArray=new Qf,this.iconTransitioningVertexArray=new dr,this.globeExtVertexArray=new Lg,this.zOffsetVertexArray=new Tl,this.orientationVertexArray=new Hh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,l,u,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gj.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Hj.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,F4,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Zj.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,$j.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Wj.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,qj.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Pt(Zb,"SymbolBuffers");class Xb{constructor(e,r,l){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new l,this.segments=new Oi,this.collisionVertexArray=new Og,this.collisionVertexArrayExt=new $o}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Xj.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Kj.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Pt(Xb,"CollisionBuffers");class Gx{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=K([]),this.placementViewportMatrix=K([]);const r=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=pP(this.zoom,r["text-size"],this.worldview),this.iconSizeData=pP(this.zoom,r["icon-size"],this.worldview);const l=this.layers[0].layout,u=l.get("symbol-sort-key"),p=l.get("symbol-z-order");this.lut=e.lut,this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(m=>_o[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new Zb(new Ho(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Zb(new Ho(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new ex,this.lineVertexArray=new tx,this.symbolInstances=new Qv}calculateGlyphDependencies(e,r,l,u,p){for(const m of e){const v=m.codePointAt(0);if(v===void 0)break;if(r[v]=!0,u&&p&&v<=65535){const b=c_[m];b&&(r[b.charCodeAt(0)]=!0)}}}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const l=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!yx(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}populate(e,r,l,u){const p=this.layers[0],m=p.layout,v=this.projection.name==="globe",b=m.get("text-font"),S=m.get("text-field"),A=m.get("icon-image"),[C,M]=m.get("icon-size-scale-range"),z=Se(r.scaleFactor||1,C,M),O=(S.value.kind!=="constant"||S.value.value instanceof ys&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),$=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,W=m.get("symbol-sort-key");if(this.features=[],!O&&!$)return;const q=r.iconDependencies,ie=r.glyphDependencies,re=r.availableImages,le=new _i(this.zoom,{worldview:this.worldview});for(const{feature:we,id:be,index:Ie,sourceLayerIndex:Pe}of e){const Me=p._featureFilter.needGeometry,Ye=ht(we,Me);if(!p._featureFilter.filter(le,Ye,l))continue;if(Me||(Ye.geometry=It(we,l,u)),v&&we.type!==1&&l.z<=5){const rt=Ye.geometry,dt=.98078528056,Xe=(ot,Ge)=>Wn($g(ot.x,ot.y,l,1),$g(Ge.x,Ge.y,l,1))<dt;for(let ot=0;ot<rt.length;ot++)rt[ot]=Ze(rt[ot],Xe)}let ze,Qe;if(O){const rt=p.getValueAndResolveTokens("text-field",Ye,l,re),dt=ys.factory(rt);N4(dt)&&(this.hasRTLText=!0),(!this.hasRTLText||jf()==="unavailable"||this.hasRTLText&&fa.isParsed())&&(ze=Jj(dt,p,Ye))}if($){const rt=p.getValueAndResolveTokens("icon-image",Ye,l,re);Qe=typeof rt=="string"?Ps.build(rt):rt}if(!ze&&!Qe)continue;const lt=this.sortFeaturesByKey?W.evaluate(Ye,{},l):void 0,tt={id:be,text:ze,icon:Qe,index:Ie,sourceLayerIndex:Pe,geometry:Ye.geometry,properties:we.properties,type:O4[we.type],sortKey:lt};if(this.features.push(tt),Qe){const rt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:dt,iconSecondary:Xe}=PP(Qe,this.iconSizeData,rt["icon-size"],l,this.zoom,tt,this.pixelRatio,z,this.worldview),ot=dt.id.toString();if(q.has(ot)?q.get(ot).push(dt):q.set(ot,[dt]),Xe){this.hasAnySecondaryIcon=!0;const Ge=Xe.id.toString();q.has(Ge)?q.get(Ge).push(Xe):q.set(Ge,[Xe])}}if(ze){const rt=b.evaluate(Ye,{},l).join(","),dt=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_o.vertical)>=0;for(const Xe of ze.sections)if(Xe.image){const ot=Xe.image.getPrimary().scaleSelf(this.pixelRatio),Ge=ot.id.toString(),je=q.get(Ge)||[];je.push(ot),q.set(Ge,je)}else{const ot=Tg(ze.toString()),Ge=Xe.fontStack||rt,je=ie[Ge]=ie[Ge]||{};this.calculateGlyphDependencies(Xe.text,je,dt,this.allowVerticalPlacement,ot)}}}if(m.get("symbol-placement")==="line"&&(this.features=function(we){const be={},Ie={},Pe=[];let Me=0;function Ye(tt){Pe.push(we[tt]),Me++}function ze(tt,rt,dt){const Xe=Ie[tt];return delete Ie[tt],Ie[rt]=Xe,Pe[Xe].geometry[0].pop(),Pe[Xe].geometry[0]=Pe[Xe].geometry[0].concat(dt[0]),Xe}function Qe(tt,rt,dt){const Xe=be[rt];return delete be[rt],be[tt]=Xe,Pe[Xe].geometry[0].shift(),Pe[Xe].geometry[0]=dt[0].concat(Pe[Xe].geometry[0]),Xe}function lt(tt,rt,dt){const Xe=dt?rt[0][rt[0].length-1]:rt[0][0];return`${tt}:${Xe.x}:${Xe.y}`}for(let tt=0;tt<we.length;tt++){const rt=we[tt],dt=rt.geometry,Xe=rt.text?rt.text.toString():null;if(!Xe){Ye(tt);continue}const ot=lt(Xe,dt),Ge=lt(Xe,dt,!0);if(ot in Ie&&Ge in be&&Ie[ot]!==be[Ge]){const je=Qe(ot,Ge,dt),ft=ze(ot,Ge,Pe[je].geometry);delete be[ot],delete Ie[Ge],Ie[lt(Xe,Pe[ft].geometry,!0)]=ft,Pe[je].geometry=null}else ot in Ie?ze(ot,Ge,dt):Ge in be?Qe(ot,Ge,dt):(Ye(tt),be[ot]=Me-1,Ie[Ge]=Me-1)}return Pe.filter(tt=>tt.geometry)}(this.features)),m.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",r.elevationFeatures){!this.elevationFeatures&&r.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const we of r.elevationFeatures)this.elevationFeatureIdToIndex.set(we.id,this.elevationFeatures.length),this.elevationFeatures.push(we)}}else m.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((we,be)=>we.sortKey-be.sortKey)}update(e,r,l,u,p,m,v){this.text.programConfigurations.updatePaintArrays(e,r,p,l,u,m,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,r,p,l,u,m,v,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let r=!1;const l=Oe(e),u=1/l;let p=!1,m=!1;for(let v=0;v<this.symbolInstances.length;v++){const b=this.symbolInstances.get(v),S=Ht(1,0,0),A=Ht(0,1,0),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:M,numIconVertices:z,numVerticalIconVertices:O}=b,$=C>0||M>0,W=z>0,q=this.elevationFeatures[b.elevationFeatureIndex];if(q){const ie=new ct(b.tileAnchorX,b.tileAnchorY),re=.075+q.pointElevation(ie);b.zOffset!==re&&(r=!0,b.zOffset=re);const le=q.computeSlopeNormal(ie,u),we=io(eo(),Ht(0,0,1),le);Sn(S,S,we),Sn(A,A,we),S[2]*=l,A[2]*=l,S[0]===1&&S[1]===0&&S[2]===0&&A[0]===0&&A[1]===1&&A[2]===0||(p=p||$,m=m||W)}if($&&(Vx(this.text.orientationVertexArray,C,S,A),Vx(this.text.orientationVertexArray,M,S,A)),W){const{placedIconSymbolIndex:ie,verticalPlacedIconSymbolIndex:re}=b;ie>=0&&Vx(this.icon.orientationVertexArray,z,S,A),re>=0&&Vx(this.icon.orientationVertexArray,O,S,A)}}p||(this.text.orientationVertexArray=void 0),m||(this.icon.orientationVertexArray=void 0),r&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(p,m,v)=>{l+=m,l>p.length&&p.resize(l);for(let b=-m;b<0;b++)p.emplace(b+l,v)},r=(p,m,v)=>{u+=m,u>p.length&&p.resize(u);for(let b=-m;b<0;b++)p.emplace(b+u,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,u=0;for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:b,numIconVertices:S}=m,A=m.zOffset,C=S>0;if((v>0||b>0)&&(e(this.text.zOffsetVertexArray,v,A),e(this.text.zOffsetVertexArray,b,A)),C){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:z}=m;M>=0&&r(this.icon.zOffsetVertexArray,S,A),z>=0&&r(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,A)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=BP(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:p}of r)this.lineVertexArray.emplaceBack(u,p);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,r,l,u,p,m,v,b,S,A,C,M,z,O,$,W){const q=e.indexArray,ie=e.layoutVertexArray,re=e.globeExtVertexArray,le=e.segments.prepareSegment(4*r.length,ie,q,this.canOverlap?m.sortKey:void 0),we=this.glyphOffsetArray.length,be=le.vertexLength,Ie=this.allowVerticalPlacement&&v===_o.vertical?Math.PI/2:0,Pe=m.text&&m.text.sections;for(let Ye=0;Ye<r.length;Ye++){const{tl:ze,tr:Qe,bl:lt,br:tt,texPrimary:rt,texSecondary:dt,pixelOffsetTL:Xe,pixelOffsetBR:ot,minFontScaleX:Ge,minFontScaleY:je,glyphOffset:ft,isSDF:ut,sectionIndex:Gt}=r[Ye],At=le.vertexLength,Lt=ft[1];if(Nx(ie,S.x,S.y,ze.x,Lt+ze.y,rt.x,rt.y,l,ut,Xe.x,Xe.y,Ge,je),Nx(ie,S.x,S.y,Qe.x,Lt+Qe.y,rt.x+rt.w,rt.y,l,ut,ot.x,Xe.y,Ge,je),Nx(ie,S.x,S.y,lt.x,Lt+lt.y,rt.x,rt.y+rt.h,l,ut,Xe.x,ot.y,Ge,je),Nx(ie,S.x,S.y,tt.x,Lt+tt.y,rt.x+rt.w,rt.y+rt.h,l,ut,ot.x,ot.y,Ge,je),b){const{x:yt,y:Vt,z:an}=b.anchor,[St,Ft,Yt]=b.up;jx(re,yt,Vt,an,St,Ft,Yt),jx(re,yt,Vt,an,St,Ft,Yt),jx(re,yt,Vt,an,St,Ft,Yt),jx(re,yt,Vt,an,St,Ft,Yt),Ux(e.dynamicLayoutVertexArray,yt,Vt,an,Ie)}else Ux(e.dynamicLayoutVertexArray,S.x,S.y,S.z,Ie);if(W){const yt=dt||rt;Bx(e.iconTransitioningVertexArray,yt.x,yt.y),Bx(e.iconTransitioningVertexArray,yt.x+yt.w,yt.y),Bx(e.iconTransitioningVertexArray,yt.x,yt.y+yt.h),Bx(e.iconTransitioningVertexArray,yt.x+yt.w,yt.y+yt.h)}q.emplaceBack(At,At+1,At+2),q.emplaceBack(At+1,At+2,At+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ft[0]),Ye!==r.length-1&&Gt===r[Ye+1].sectionIndex||e.programConfigurations.populatePaintArrays(ie.length,m,m.index,{},z,O,$,Pe&&Pe[Gt],this.worldview)}const Me=b?b.anchor:S;e.placedSymbolArray.emplaceBack(Me.x,Me.y,Me.z,S.x,S.y,we,this.glyphOffsetArray.length-we,be,A,C,S.segment,l?l[0]:0,l?l[1]:0,u[0],u[1],v,0,0,0,M,0)}_commitLayoutVertex(e,r,l,u,p,m,v){e.emplaceBack(r,l,u,p,m,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,r,l,u,p,m,v){const b=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),S=b.vertexLength,A=v.tileAnchorX,C=v.tileAnchorY;for(let z=0;z<4;z++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,r,e.padding,v.zOffset),this._commitLayoutVertex(l.layoutVertexArray,u,p,m,A,C,new ct(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,p,m,A,C,new ct(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,p,m,A,C,new ct(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,u,p,m,A,C,new ct(e.x1,e.y2)),b.vertexLength+=4;const M=l.indexArray;M.emplaceBack(S,S+1),M.emplaceBack(S+1,S+2),M.emplaceBack(S+2,S+3),M.emplaceBack(S+3,S),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,l,u,p,m){for(let v=u;v<p;v++){const b=l.get(v),S=this.getSymbolInstanceTextSize(e,m,r,v);this._addCollisionDebugVertices(b,S,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,r,l,u,p,m){for(let v=u;v<p;v++){const b=l.get(v),S=this.getSymbolInstanceIconSize(e,r,m.placedIconSymbolIndex);this._addCollisionDebugVertices(b,S,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xb(Zf,QC.members,dr),this.iconCollisionBox=new Xb(Zf,QC.members,dr);const u=h_(this.iconSizeData,e),p=h_(this.textSizeData,e,l);for(let m=0;m<this.symbolInstances.length;m++){const v=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(p,e,r,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(p,e,r,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,e,r,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,e,r,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,r,l,u){const p=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:u),m=Vb(this.textSizeData,e,p)/jr;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,r,l){const u=this.icon.placedSymbolArray.get(l),p=Vb(this.iconSizeData,e,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,r,l,u){e.emplaceBack(r,-l,-l,u),e.emplaceBack(r,l,-l,u),e.emplaceBack(r,l,l,u),e.emplaceBack(r,-l,l,u)}_updateTextDebugCollisionBoxes(e,r,l,u,p,m,v){for(let b=u;b<p;b++){const S=l.get(b),A=this.getSymbolInstanceTextSize(e,m,r,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,S.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,r,l,u,p,m,v){for(let b=u;b<p;b++){const S=l.get(b),A=this.getSymbolInstanceIconSize(e,r,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,S.padding,m.zOffset)}}updateCollisionDebugBuffers(e,r,l,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=h_(this.iconSizeData,e,u),m=h_(this.textSizeData,e,l);for(let v=0;v<this.symbolInstances.length;v++){const b=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(m,e,r,b.textBoxStartIndex,b.textBoxEndIndex,b,l),this._updateTextDebugCollisionBoxes(m,e,r,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,l),this._updateIconDebugCollisionBoxes(p,e,r,b.iconBoxStartIndex,b.iconBoxEndIndex,b,u),this._updateIconDebugCollisionBoxes(p,e,r,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,l,u,p,m,v,b,S){const A={};if(r<l){const{x1:C,y1:M,x2:z,y2:O,padding:$,projectedAnchorX:W,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:le,featureIndex:we}=e.get(r);A.textBox={x1:C,y1:M,x2:z,y2:O,padding:$,projectedAnchorX:W,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:le},A.textFeatureIndex=we}if(u<p){const{x1:C,y1:M,x2:z,y2:O,padding:$,projectedAnchorX:W,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:le,featureIndex:we}=e.get(u);A.verticalTextBox={x1:C,y1:M,x2:z,y2:O,padding:$,projectedAnchorX:W,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:le},A.verticalTextFeatureIndex=we}if(m<v){const{x1:C,y1:M,x2:z,y2:O,padding:$,projectedAnchorX:W,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:le,featureIndex:we}=e.get(m);A.iconBox={x1:C,y1:M,x2:z,y2:O,padding:$,projectedAnchorX:W,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:le},A.iconFeatureIndex=we}if(b<S){const{x1:C,y1:M,x2:z,y2:O,padding:$,projectedAnchorX:W,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:le,featureIndex:we}=e.get(b);A.verticalIconBox={x1:C,y1:M,x2:z,y2:O,padding:$,projectedAnchorX:W,projectedAnchorY:q,projectedAnchorZ:ie,tileAnchorX:re,tileAnchorY:le},A.verticalIconFeatureIndex=we}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const l=e.placedSymbolArray.get(r),u=l.vertexStartIndex+4*l.numGlyphs;for(let p=l.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),l=Math.cos(e),u=[],p=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const b=this.symbolInstances.get(v);u.push(0|Math.round(r*b.tileAnchorX+l*b.tileAnchorY)),p.push(b.featureIndex)}return m.sort((v,b)=>u[v]-u[b]||p[b]-p[v]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===r?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const l=this.symbolInstances.get(r);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:S}=l;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let jP,VP,Kb;Pt(Gx,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Gx.addDynamicAttributes=Ux;class UP{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ua,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pt(UP,"FormatSectionOverride",{omit:["defaultValue"]});const Yb=()=>Kb||(Kb={layout:jP||(jP=new Vi({"symbol-placement":new pt(Le.layout_symbol["symbol-placement"]),"symbol-spacing":new pt(Le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pt(Le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Et(Le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pt(Le.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new pt(Le.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new pt(Le.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new pt(Le.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new pt(Le.layout_symbol["icon-ignore-placement"]),"icon-optional":new pt(Le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pt(Le.layout_symbol["icon-rotation-alignment"]),"icon-size":new Et(Le.layout_symbol["icon-size"]),"icon-size-scale-range":new pt(Le.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Et(Le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Et(Le.layout_symbol["icon-text-fit-padding"]),"icon-image":new Et(Le.layout_symbol["icon-image"]),"icon-image-use-theme":new pt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Et(Le.layout_symbol["icon-rotate"]),"icon-padding":new pt(Le.layout_symbol["icon-padding"]),"icon-keep-upright":new pt(Le.layout_symbol["icon-keep-upright"]),"icon-offset":new Et(Le.layout_symbol["icon-offset"]),"icon-anchor":new Et(Le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pt(Le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pt(Le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pt(Le.layout_symbol["text-rotation-alignment"]),"text-field":new Et(Le.layout_symbol["text-field"]),"text-font":new Et(Le.layout_symbol["text-font"]),"text-size":new Et(Le.layout_symbol["text-size"]),"text-size-scale-range":new pt(Le.layout_symbol["text-size-scale-range"]),"text-max-width":new Et(Le.layout_symbol["text-max-width"]),"text-line-height":new Et(Le.layout_symbol["text-line-height"]),"text-letter-spacing":new Et(Le.layout_symbol["text-letter-spacing"]),"text-justify":new Et(Le.layout_symbol["text-justify"]),"text-radial-offset":new Et(Le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pt(Le.layout_symbol["text-variable-anchor"]),"text-anchor":new Et(Le.layout_symbol["text-anchor"]),"text-max-angle":new pt(Le.layout_symbol["text-max-angle"]),"text-writing-mode":new pt(Le.layout_symbol["text-writing-mode"]),"text-rotate":new Et(Le.layout_symbol["text-rotate"]),"text-padding":new pt(Le.layout_symbol["text-padding"]),"text-keep-upright":new pt(Le.layout_symbol["text-keep-upright"]),"text-transform":new Et(Le.layout_symbol["text-transform"]),"text-offset":new Et(Le.layout_symbol["text-offset"]),"text-allow-overlap":new pt(Le.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new pt(Le.layout_symbol["text-ignore-placement"]),"text-optional":new pt(Le.layout_symbol["text-optional"]),visibility:new pt(Le.layout_symbol.visibility)})),paint:VP||(VP=new Vi({"icon-opacity":new Et(Le.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Et(Le.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Et(Le.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Et(Le.paint_symbol["text-emissive-strength"]),"icon-color":new Et(Le.paint_symbol["icon-color"]),"icon-halo-color":new Et(Le.paint_symbol["icon-halo-color"]),"icon-halo-width":new Et(Le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Et(Le.paint_symbol["icon-halo-blur"]),"icon-translate":new pt(Le.paint_symbol["icon-translate"]),"icon-translate-anchor":new pt(Le.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new pt(Le.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Et(Le.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Et(Le.paint_symbol["text-occlusion-opacity"]),"text-color":new Et(Le.paint_symbol["text-color"],{runtimeType:Bs,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Et(Le.paint_symbol["text-halo-color"]),"text-halo-width":new Et(Le.paint_symbol["text-halo-width"]),"text-halo-blur":new Et(Le.paint_symbol["text-halo-blur"]),"text-translate":new pt(Le.paint_symbol["text-translate"]),"text-translate-anchor":new pt(Le.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new pt(Le.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new pt(Le.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new pt(Le.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new pt(Le.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Et(Le.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},Kb);class $x extends cs{constructor(e,r,l,u){super(e,Yb(),r,l,u,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=K([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const u=[];for(const p of l)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,l,u){return this._saturation===e&&this._contrast===r&&this._brightnessMin===l&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(p,m,v,b){p=ro(p),m=gs(m);const S=ce(),A=p/3,C=1-2*A,M=[C,A,A,0,A,C,A,0,A,A,C,0,0,0,0,1],z=.5-.5*m,O=b-v;return Y(S,[O,0,0,0,0,O,0,0,0,0,O,0,v,v,v,1],[m,0,0,0,0,m,0,0,0,0,m,0,z,z,z,1]),Y(S,S,M),S}(e,r,l,u),this._saturation=e,this._contrast=r,this._brightnessMin=l,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,l,u){const p=this.layout.get(e).evaluate(r,{},l,u),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||xg(m.value)||!p?p:function(v,b){return b.replace(/{([^{}]+)}/g,(S,A)=>A in v?String(v[A]):"")}(r.properties,p)}createBucket(e){return new Gx(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Yb().paint.overridableProperties){if(!$x.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),l=new UP(r),u=new Df(l,r.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new jh("source",u):new _l("composite",u,r.value.zoomStops,r.value.interpolationType),this.paint._values[e]=new pc(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,l){return!(!this.layout||r.isDataDriven()||l.isDataDriven())&&$x.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const l=e.get("text-field"),u=Yb().paint.properties[r];let p=!1;const m=v=>{for(const b of v)if(u.overrides&&u.overrides.hasOverride(b))return void(p=!0)};if(l.value.kind==="constant"&&l.value.value instanceof ys)m(l.value.value.sections);else if(l.value.kind==="source"){const v=S=>{p||(S instanceof yn&&Ir(S.value)===cl?m(S.value.sections):S instanceof tc?m(S.sections):S.eachChild(v))},b=l.value;b._styleExpression&&v(b._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,r,l){return{config:new wc(this,{zoom:r,lut:l}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let GP,$P,HP,WP;var Jb=zn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Hx(s,e,r,l,u,p,m,v){const b=[s,e,1,r,l,1,u,p,1],S=[m,v,1],A=H([],b),[C,M,z]=Bi(S,S,A);return ne(b,b,[C,0,0,0,M,0,0,0,z])}function qP(s,e,r,l,u,p,m,v){const b=function(S,A,C,M,z,O,$,W){const q=Hx(0,0,1,0,1,1,0,1),ie=Hx(S,A,C,M,z,O,$,W);return ne(ie,ie,H([],q))}(s,e,r,l,u,p,m,v);return[b[2]/b[8]/vt,b[5]/b[8]/vt]}function Wx(s){return[s[0],Math.min(Math.max(s[1],-xe),xe)]}class ZP extends Ql{constructor(e,r,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new Bo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=qc(this.map._requestManager.transformRequest(this.url,qd.Image),(l,u)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new Sh(l)):u&&(this.image=u instanceof HTMLImageElement?ca.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new o_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Bo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof o_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],l=e[0][1];for(const p of e)p[1]>l&&(l=p[1]),p[1]<r&&(r=p[1]);const u=(l+r)/2;if(u>xe?this.onNorthPole=!0:u<-xe&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=e.map(We.fromLngLat);this.tileID=function(m){let v=1/0,b=1/0,S=-1/0,A=-1/0;for(const $ of m)v=Math.min(v,$.x),b=Math.min(b,$.y),S=Math.max(S,$.x),A=Math.max(A,$.y);const C=Math.max(S-v,A-b),M=Math.max(0,Math.floor(-Math.log2(C))),z=Math.pow(2,M);let O=Math.floor((v+S)/2*z);return O>1&&(O-=1),new Ba(M,O,Math.floor((b+A)/2*z))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Bo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof o_||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const q in this.tiles){const ie=this.tiles[q];ie.state!=="loaded"&&(ie.state="loaded",ie.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=m_(new Ba(0,0,0),this.map.transform.projection),l=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(q){const ie=q[1].x-q[0].x,re=q[1].y-q[0].y,le=q[2].x-q[1].x,we=q[2].y-q[1].y,be=q[3].x-q[2].x,Ie=q[3].y-q[2].y,Pe=q[0].x-q[3].x,Me=q[0].y-q[3].y,Ye=ie*we-le*re,ze=le*Ie-be*we,Qe=be*Me-Pe*Ie,lt=Pe*re-ie*Me;return Ye>0&&ze>0&&Qe>0&&lt>0||Ye<0&&ze<0&&Qe<0&&lt<0}(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=m_(this.tileID,this.map.transform.projection),[p,m,v,b]=this.coordinates.map(q=>{const ie=u.projection.project(q[0],q[1]);return LP(u,ie)._round()});this.perspectiveTransform=qP(p.x,p.y,m.x,m.y,v.x,v.y,b.x,b.y);const S=this._boundsArray=new yc;S.emplaceBack(p.x,p.y,0,0),S.emplaceBack(m.x,m.y,vt,0),S.emplaceBack(b.x,b.y,0,vt),S.emplaceBack(v.x,v.y,vt,vt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(S,Jb.members),this.boundsSegments=Oi.simpleSegment(0,0,4,2);const A=[],C=[Wx((M=this.coordinates)[0]),Wx(M[1]),Wx(M[2]),Wx(M[3])];var M;const[z,O,$,W]=function(q){let ie=q[0][0],re=ie,le=q[0][1],we=le;for(let be=1;be<q.length;be++)q[be][0]<ie?ie=q[be][0]:q[be][0]>re&&(re=q[be][0]),q[be][1]<le?le=q[be][1]:q[be][1]>we&&(we=q[be][1]);return[ie,le,re-ie,we-le]}(C);{const q=new yc,[ie,re,le,we]=function(Xe){let ot=Xe[0].x,Ge=ot,je=Xe[0].y,ft=je;for(let ut=1;ut<Xe.length;ut++)Xe[ut].x<ot?ot=Xe[ut].x:Xe[ut].x>Ge&&(Ge=Xe[ut].x),Xe[ut].y<je?je=Xe[ut].y:Xe[ut].y>ft&&(ft=Xe[ut].y);return[ot,je,Ge-ot,ft-je]}(l),be=Xe=>[(Xe.x-ie)/le,(Xe.y-re)/we],[Ie,Pe,Me,Ye]=l.map(be),ze=function(Xe,ot,Ge,je,ft,ut,Gt,At){const Lt=Hx(0,0,1,0,1,1,0,1);return ne(Lt,Lt,H([],Hx(Xe,ot,Ge,je,ft,ut,Gt,At)))}(Ie[0],Ie[1],Pe[0],Pe[1],Me[0],Me[1],Ye[0],Ye[1]);this.elevatedGlobePerspectiveTransform=qP(Ie[0],Ie[1],Pe[0],Pe[1],Me[0],Me[1],Ye[0],Ye[1]);const Qe=(Xe,ot)=>{A.push(Xe.lng);const Ge=Math.round((Xe.lng-z)/$*vt),je=Math.round((Xe.lat-O)/W*vt),ft=be(ot),ut=Bi([],[ft[0],ft[1],1],ze),Gt=Math.round(ut[0]/ut[2]*vt),At=Math.round(ut[1]/ut[2]*vt);q.emplaceBack(Ge,je,Gt,At)},lt=l[3].x-l[0].x,tt=l[3].y-l[0].y,rt=l[2].x-l[1].x,dt=l[2].y-l[1].y;for(let Xe=0;Xe<65;Xe++){const ot=Xe/64,Ge=[l[0].x+ot*lt,l[0].y+ot*tt],je=[l[1].x+ot*rt,l[1].y+ot*dt],ft=je[0]-Ge[0],ut=je[1]-Ge[1];for(let Gt=0;Gt<65;Gt++){const At=Gt/64,Lt={x:Ge[0]+ft*At,y:Ge[1]+ut*At};Qe(r.projection.unproject(Lt.x,Lt.y),Lt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(q,Jb.members)}{this.maxLongitudeTriangleSize=0;let q=[],ie=new xr;const re=(le,we,be)=>{ie.emplaceBack(le,we,be);const Ie=A[le],Pe=A[we],Me=A[be],Ye=Math.min(Math.min(Ie,Pe),Me),ze=Math.max(Math.max(Ie,Pe),Me)-Ye;ze>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ze),q.push(Ye+ze/2)};for(let le=0;le<64;le++)for(let we=0;we<64;we++){const be=65*le+we,Ie=be+1,Pe=be+65,Me=Pe+1;re(be,Pe,Ie),re(Ie,Pe,Me)}[q,ie]=function(le,we){const be=Array.from({length:le.length},(Me,Ye)=>Ye);be.sort((Me,Ye)=>le[Me]-le[Ye]);const Ie=[],Pe=new xr;for(let Me=0;Me<be.length;Me++){const Ye=be[Me];Ie.push(le[Ye]);const ze=3*Ye,Qe=ze+1;Pe.emplaceBack(we.uint16[ze],we.uint16[Qe],we.uint16[Qe+1])}return[Ie,Pe]}(q,ie),this.elevatedGlobeTrianglesCenterLongitudes=q,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ie)}this.elevatedGlobeSegments=Oi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,$/vt,0,W/vt,0,0,O,z,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,l=r.gl;!this._dirty||this.texture instanceof o_||(this.texture?this.texture.update(this.image):(this.texture=new Ib(r,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let u=(p=e+180)+360*Math.round((l[0]-p)/360);var p;const m=new Oi,v=(C,M)=>{m.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:r.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-u)<=b){const C=Hr(l,0,l.length,u+b);return C===l.length||v(C,Ti(l,C+1,l.length,u+360-b)-C),m}u<l[0]&&(u+=360);const S=Ti(l,0,l.length,u-b);if(S===l.length)return v(0,l.length),m;v(0,S-0);const A=Hr(l,S+1,l.length,u+b);return A!==l.length&&v(A,l.length-A),m}}const B4=(Math.pow(256,2)-1)/16907520;class XP extends cs{constructor(e,r,l,u){super(e,{layout:HP||(HP=new Vi({visibility:new pt(Le.layout_raster.visibility)})),paint:WP||(WP=new Vi({"raster-opacity":new pt(Le.paint_raster["raster-opacity"]),"raster-color":new hu(Le.paint_raster["raster-color"]),"raster-color-mix":new pt(Le.paint_raster["raster-color-mix"]),"raster-color-range":new pt(Le.paint_raster["raster-color-range"]),"raster-hue-rotate":new pt(Le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pt(Le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pt(Le.paint_raster["raster-brightness-max"]),"raster-saturation":new pt(Le.paint_raster["raster-saturation"]),"raster-contrast":new pt(Le.paint_raster["raster-contrast"]),"raster-resampling":new pt(Le.paint_raster["raster-resampling"]),"raster-fade-duration":new pt(Le.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new pt(Le.paint_raster["raster-emissive-strength"]),"raster-array-band":new pt(Le.paint_raster["raster-array-band"]),"raster-elevation":new pt(Le.paint_raster["raster-elevation"]),"raster-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof ZP&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[l,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(u)||l===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=Hg({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,u])}}let KP,YP,JP,QP,eM;class tM extends cs{constructor(e,r,l,u){super(e,{layout:KP||(KP=new Vi({visibility:new pt(Le["layout_raster-particle"].visibility)})),paint:YP||(YP=new Vi({"raster-particle-array-band":new pt(Le["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new pt(Le["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new hu(Le["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new pt(Le["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new pt(Le["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new pt(Le["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new pt(Le["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new pt(Le["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},r,l,u),this._updateColorRamp(),this.lastInvalidatedAt=ca.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Hg({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ca.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class j4 extends cs{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Qb(s,e,r){const l=[0,0,1],u=to([]);return sa(u,u,r?-De(s)+Math.PI:De(s)),ra(u,u,-De(e)),Sn(l,l,u),Vn(l,l)}const nM={None:0,Model:1,Symbol:2,FillExtrusion:4};class qx{constructor(e,r,l,u){this.message=(e?`${e}: `:"")+l,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function eT(s,e){const r=s.indexOf("://")===-1;try{return new URL(s,r&&e?"http://example.com":void 0),!0}catch{return!1}}class iM{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class rM{constructor(){this.instancedDataArray=new Bg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class tT{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,r){}populate(e,r,l,u){this.tileToMeter=Oe(l);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:v,index:b,sourceLayerIndex:S}of e){const A=v??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),C=ht(m,p);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom,{worldview:this.worldview}),C,l))continue;const M={id:A,sourceLayerIndex:S,index:b,geometry:p?C.geometry:It(m,l,u),properties:m.properties,type:m.type,patterns:{}},z=this.addFeature(M,M.geometry,C);z&&r.featureIndex.insert(m,M.geometry,b,S,this.index,this.instancesPerModel[z].instancedDataArray.length,vt/32)}this.lookup=null}update(e,r,l,u){for(const p in this.instancesPerModel){const m=this.instancesPerModel[p];for(const v in e)m.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(m.features[m.idToFeaturesIndex[v]],e[v],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];for(const u of l.features){const p=this.layers[0],m=u.feature,v=this.canonical,b=p.paint.get("model-rotation").evaluate(m,{},v),S=p.paint.get("model-scale").evaluate(m,{},v),A=p.paint.get("model-translation").evaluate(m,{},v);Li(u.rotation,b)&&Li(u.scale,S)&&Li(u.translation,A)||(this.evaluate(u,u.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,r,l,u){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const p=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(yx(this.activeReplacements,p))return!1;this.activeReplacements=p;let m=!1;for(const v in this.instancesPerModel){const b=this.instancesPerModel[v],S=b.instancedDataArray;for(const A of b.features){const C=A.instancedDataOffset,M=A.instancedDataCount;for(let z=0;z<M;z++){const O=16*(z+C);let $=S.float32[O+0];const W=$>vt;$=W?$-vt:$;const q=Math.floor($),ie=S.float32[O+1];let re=!1;for(const le of this.activeReplacements)if(!$A(le,l,nM.Model,u)&&!(le.min.x>q||q>le.max.x||le.min.y>ie||ie>le.max.y)&&(re=pb(ZA(q,ie,e.canonical,le.footprintTileId.canonical),le.footprint),re))break;S.float32[O]=re?$+vt:$,m=m||re!==W}}}return m}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,mj.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];l.instancedDataArray.length!==0&&l.instancedDataBuffer&&l.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const r of this.modelUris)e.removeModel(r,"",!0)}addFeature(e,r,l){const u=this.layers[0],p=u.layout.get("model-id").evaluate(l,{},this.canonical);if(!p)return Dn(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),p;(eT(p,!1)||this.styleDefinedModelURLs[p]!==void 0)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new rM);const m=this.instancesPerModel[p],v=m.instancedDataArray,b=new iM(l,v.length);for(const S of r)for(const A of S){if(A.x<0||A.x>=vt||A.y<0||A.y>=vt)continue;if(this.lookupDim!==0){const M=(this.lookupDim-1)/vt,z=this.lookupDim*(A.y*M|0)+A.x*M|0;if(this.lookup){if(this.lookup[z]!==0)continue;this.lookup[z]=1}}this.instanceCount++;const C=v.length;v.resize(C+1),m.instancesEvaluatedElevation.push(0),v.float32[16*C]=A.x,v.float32[16*C+1]=A.y}return b.instancedDataCount=m.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(b),this.evaluate(b,{},m,!1)),p}getModelUris(){return this.modelUris}evaluate(e,r,l,u){const p=this.layers[0],m=e.feature,v=this.canonical,b=e.rotation=p.paint.get("model-rotation").evaluate(m,r,v),S=e.scale=p.paint.get("model-scale").evaluate(m,r,v),A=e.translation=p.paint.get("model-translation").evaluate(m,r,v),C=p.paint.get("model-color").evaluate(m,r,v);C.a=p.paint.get("model-color-mix-intensity").evaluate(m,r,v);const M=[];this.maxVerticalOffset<A[2]&&(this.maxVerticalOffset=A[2]),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),PC(M,b,S);const z=Math.round(100*C.a)+C.b/1.05;for(let O=0;O<e.instancedDataCount;++O){const $=e.instancedDataOffset+O,W=16*$,q=l.instancedDataArray.float32;let ie=0;u&&(ie=q[W+6]-l.instancesEvaluatedElevation[$]);const re=0|q[W+1];q[W]=(0|q[W])+C.r/1.05,q[W+1]=re+C.g/1.05,q[W+2]=z,q[W+3]=1/(v.z>10?this.tileToMeter:Oe(v,re)),q[W+4]=A[0],q[W+5]=A[1],q[W+6]=A[2]+ie,q[W+7]=M[0],q[W+8]=M[1],q[W+9]=M[2],q[W+10]=M[4],q[W+11]=M[5],q[W+12]=M[6],q[W+13]=M[8],q[W+14]=M[9],q[W+15]=M[10],l.instancesEvaluatedElevation[$]=A[2]}}}let sM,oM;Pt(tT,"ModelBucket",{omit:["layers"]}),Pt(rM,"PerModelAttributes"),Pt(iM,"ModelFeature");class gp{constructor(e,r,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=l}static create(e,r,l){const u=l||e.findDEMTileFor(r);if(!u||!u.dem)return;const p=u.dem,m=u.tileID,v=1<<r.canonical.z-m.canonical.z;return new gp(u,p.dim/vt/v,[(r.canonical.x/v-m.canonical.x)*p.dim,(r.canonical.y/v-m.canonical.y)*p.dim])}tileCoordToPixel(e,r){const l=r*this._scale+this._offset[1];return new ct(Math.floor(e*this._scale+this._offset[0]),Math.floor(l))}getElevationAt(e,r,l,u){const p=e*this._scale+this._offset[0],m=r*this._scale+this._offset[1],v=Math.floor(p),b=Math.floor(m),S=this._dem;return u=!!u,l?Kt(Kt(S.get(v,b,u),S.get(v,b+1,u),m-b),Kt(S.get(v+1,b,u),S.get(v+1,b+1,u),m-b),p-v):S.get(v,b,u)}getElevationAtPixel(e,r,l){return this._dem.get(e,r,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ge(1,e)*this._dem.stride}}const nT=new Float32Array(262144),ad=new Uint8Array(262144);function aM(s){let e=0;if(s.meshes)for(const r of s.meshes)e=Math.max(e,r.aabb.max[2]);if(s.children)for(const r of s.children)e=Math.max(e,aM(r));return e}function lM(s,e,r){if(s.meshes)for(const l of s.meshes){if(l.aabb.min[0]===1/0)continue;const u=Qt.applyTransform(l.aabb,s.matrix);r.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(s.children)for(const l of s.children)lM(l,e,r)}const cM=["","wall","door","roof","window","lamp","logo"];class uM{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:aM(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Qt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const r=new Qt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=Qt.applyTransformFast(l.aabb,this.node.matrix),r.encapsulate(l.transformedAabb)),e++;this.aabb=r}return this.aabb}}class Zx{constructor(e,r,l,u,p,m,v,b){this.id=l,this.layers=e,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=up.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=up.HasMapboxMeshFeatures),p&&(this.modelTraits|=up.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.worldview=b,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const S of r)this.nodesInfo.push(new uM(S)),lM(S,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,r){for(const l of this.getNodesInfo()){const u=l.node;u.footprint&&r.push({footprint:u.footprint,id:e})}}update(e){const r=Object.keys(e).length!==0;if(r&&!this.stateDependentLayers.length)return;const l=r?this.stateDependentLayers:this.layers;if(!Oo(e,this.states))for(const u of l)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const l of r){const u=l.node;this.uploaded?this.updatePbrBuffer(u):Pb(u,e,!0)}for(const l of r)Cx(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),r=!0);return r}needsReEvaluation(e,r,l){const u=e.transform.projectionOptions,p=e.style.getBrightness(),m=this.brightness!==p;if(!this.uploaded||this.dirty||u.name!==this.projection.name||x_(l.paint.get("model-color").value,m)||x_(l.paint.get("model-color-mix-intensity").value,m)||x_(l.paint.get("model-roughness").value,m)||x_(l.paint.get("model-emissive-strength").value,m)||x_(l.paint.get("model-height-based-emissive-strength-multiplier").value,m)){this.projection=u,this.brightness=p;const v=this.getNodesInfo();for(const b of v)b.state=null;return!0}return!1}evaluateTransform(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),u=this.id.canonical;for(const p of l){const m=p.feature;p.evaluatedTranslation=r.paint.get("model-translation").evaluate(m,{},u),p.evaluatedScale=r.paint.get("model-scale").evaluate(m,{},u)}}evaluate(e,r){const l=this.getNodesInfo();for(const u of l){if(!u.node.meshes)continue;const p=u.feature,m=r&&r[p.id];if(Oo(m,u.state))continue;u.state=structuredClone(m);const v=u.node.meshes&&u.node.meshes[0].featureData,b=u.evaluatedColor[2],S=u.evaluatedRMEA[2],A=this.id.canonical;if(u.hasTranslucentParts=!1,v){for(let C=0;C<cM.length;C++){const M=cM[C];M.length&&(p.properties.part=M);const z=e.paint.get("model-color").evaluate(p,m,A).toPremultipliedRenderColor(null),O=e.paint.get("model-color-mix-intensity").evaluate(p,m,A);u.evaluatedColor[C]=[z.r,z.g,z.b,O],u.evaluatedRMEA[C][0]=e.paint.get("model-roughness").evaluate(p,m,A),u.evaluatedRMEA[C][2]=e.paint.get("model-emissive-strength").evaluate(p,m,A),u.evaluatedRMEA[C][3]=z.a,u.emissionHeightBasedParams[C]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,m,A),!u.hasTranslucentParts&&z.a<1&&(u.hasTranslucentParts=!0)}delete p.properties.part,U4(u,b!==u.evaluatedColor[2]||S!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(p,m,A);u.evaluatedTranslation=e.paint.get("model-translation").evaluate(p,m,A),u.evaluatedScale=e.paint.get("model-scale").evaluate(p,m,A),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,l,u){const p=e.findDEMTileFor(l);if(p&&(p.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const m=gp.create(e,l,p);if(!m)return;this.modelTraits&up.HasMapboxMeshFeatures&&this.updateDEM(e,m,l,u);for(const v of this.getNodesInfo()){const b=v.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const S=b.footprint.vertices;let A=m.getElevationAt(S[0].x,S[0].y,!0,!0);for(let C=1;C<S.length;C++)A=Math.min(A,m.getElevationAt(S[C].x,S[C].y,!0,!0));b.elevation=A}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,l,u){let p=r._dem._modifiedForSources[u];if(p===void 0&&(r._dem._modifiedForSources[u]=[],p=r._dem._modifiedForSources[u]),p.includes(l.canonical))return;const m=r._dem.dim;p.push(l.canonical);let v=!1;for(const b of this.getNodesInfo()){const S=b.node;if(!S.footprint||!S.footprint.grid)continue;const A=S.footprint.grid,C=r.tileCoordToPixel(A.min.x,A.min.y),M=r.tileCoordToPixel(A.max.x,A.max.y),z=Math.min(Math.min(m-M.y,C.x),Math.min(C.y,m-M.x));if(z<0)continue;const O=Se(z,2,5);let $=Math.max(0,C.x-O),W=Math.max(0,C.y-O),q=Math.min(M.x+O,m-1),ie=Math.min(M.y+O,m-1);for(let be=W;be<=ie;++be)for(let Ie=$;Ie<=q;++Ie)ad[be*m+Ie]=255;let re=0,le=0;for(let be=0;be<A.cellsY;++be)for(let Ie=0;Ie<A.cellsX;++Ie){if(!A.cells[be*A.cellsX+Ie])continue;const Pe=r.tileCoordToPixel(A.min.x+Ie/A.xScale,A.min.y+be/A.yScale),Me=r.tileCoordToPixel(A.min.x+(Ie+1)/A.xScale,A.min.y+(be+1)/A.yScale);for(let Ye=Pe.y;Ye<=Math.min(Me.y+1,m-1);++Ye)for(let ze=Pe.x;ze<=Math.min(Me.x+1,m-1);++ze)ad[Ye*m+ze]===255&&(ad[Ye*m+ze]=0,re+=r.getElevationAtPixel(ze,Ye),le++)}const we=re/le;$=Math.max(1,C.x-O),W=Math.max(1,C.y-O),q=Math.min(M.x+O,m-2),ie=Math.min(M.y+O,m-2),v=!0;for(let be=W;be<=ie;++be)for(let Ie=$;Ie<=q;++Ie)ad[be*m+Ie]===0&&(nT[be*m+Ie]=r._dem.set(Ie,be,we));for(let be=1;be<O;++be){$=Math.max(1,C.x-be),W=Math.max(1,C.y-be),q=Math.min(M.x+be,m-2),ie=Math.min(M.y+be,m-2);for(let Ie=W;Ie<=ie;++Ie)for(let Pe=$;Pe<=q;++Pe){const Me=Ie*m+Pe;if(ad[Me]===255){let Ye=0,ze=0,Qe=-1,lt=-1;for(let tt=-1;tt<=1;++tt)for(let rt=-1;rt<=1;++rt){const dt=(Ie+tt)*m+Pe+rt;if(ad[dt]>=be)continue;const Xe=nT[dt],ot=Math.abs(Xe);ot>ze&&(Ye=Xe,ze=ot,Qe=rt,lt=tt)}if(ze>.1){const tt=1-(be+.5*Math.abs(Qe*lt))/O;let rt=r._dem.get(Pe,Ie)+Ye*tt;const dt=r._dem.get(Pe+Qe,Ie+lt),Xe=r._dem.get(Pe-Qe,Ie-lt,!0);(rt-dt)*(rt-Xe)>0&&(rt=(dt+Xe)/2),nT[Me]=r._dem.set(Pe,Ie,rt),ad[Me]=be}}}}}v&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=ca.now())}setFilter(e){this.filter=e?Uh(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new _i(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const r of e)Cx(r.node),Mb(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const l=r.getReplacementRegionsForTile(e.toUnwrapped());for(const u of this.getNodesInfo()){const p=u.node.footprint;u.hiddenByReplacement=!!p&&!l.find(m=>m.footprint===p)}}getHeightAtTileCoord(e,r){const l=[],u=[0,0,0],p=K([]);for(const m of this.getNodesInfo()){const v=m.node.meshes[0],b=v.transformedAabb;if(e<b.min[0]||r<b.min[1]||e>b.max[0]||r>b.max[1])continue;if(m.node.hidden===!0)return{height:1/0,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};se(p,m.node.matrix),u[0]=e,u[1]=r,ui(u,u,p);const S=(u[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*rd|0,A=Math.min(63,(u[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*rd|0)*rd+Math.min(63,S),C=v.heightmap[A];if(!(C<0&&m.node.footprint))return m.hiddenByReplacement?void 0:{height:C,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};if(m.node.footprint.grid.query(new ct(e,r),new ct(e,r),l),l.length>0)return{height:void 0,maxHeight:m.feature.properties.height,hidden:m.hiddenByReplacement,verticalScale:m.evaluatedScale[2]}}}}function x_(s,e){return s instanceof jh&&!s.isLightConstant&&e}function V4(s,e,r,l,u,p,m,v){let b=(61440&e|(61440&e)>>4)>>8,S=(3840&e|(3840&e)>>4)>>4,A=240&e|(240&e)>>4;r[3]>0&&(b=Kt(b,255*r[0],r[3]),S=Kt(S,255*r[1],r[3]),A=Kt(A,255*r[2],r[3]));const C=b<<8|S,M=A<<8|Math.floor(255*l[3]),z=function(be){const Ie=Se(be,0,2);return Math.min(Math.round(.5*Ie*255),255)}(l[2])<<8|15*l[0]<<4|15*l[1],O=Se(u[0],0,1),$=Se(u[1],0,1),W=Se(u[2],0,1),q=Se(u[3],0,1);let ie,re,le,we;if(O!==$&&m!==p&&$!==O){const be=m-p;re=1/(be*($-O)),le=-(p+be*O)/(be*($-O));const Ie=Se(u[4],-1,1);we=Math.pow(10,Ie),ie=255*W<<8|255*q}else ie=65535,re=0,le=1,we=1;if(s.emplaceBack(C,M,z,ie,re,le,we),v){const be=v.length;v.clear();for(let Ie=0;Ie<be;Ie++)v.emplaceBack(C,M,z,ie,re,le,we)}}function U4(s,e,r){const l=s.node;let u=0;const p=r&up.HasMeshoptCompression;for(const m of l.meshes){if(l.lights&&l.lightMeshIndex===u||!m.featureData)continue;m.featureArray=new vu,m.featureArray.reserve(m.featureData.length);let v=e;for(const b of m.featureData){const S=p?65535&b:b>>16&65535,A=p?b>>16&65535:65535&b,C=(15&A)<8?15&A:0,M=s.evaluatedRMEA[C],z=s.evaluatedColor[C],O=s.emissionHeightBasedParams[C];let $;if(v&&C===2&&l.lights&&($=new vu,$.resize(10*l.lights.length)),V4(m.featureArray,S,z,M,O,m.aabb.min[2],m.aabb.max[2],$),$&&v){v=!1;const W=l.meshes[l.lightMeshIndex];W.featureArray=$,W.featureArray._trim()}}m.featureArray._trim(),u++}}function hM(s,e,r,l){const u=1<<s.z;e.lat=_e((l/vt+s.y)/u),e.lng=ve((r/vt+s.x)/u)}function G4(s,e,r,l){const u=s.getNodesInfo()[e];if(!u||u.hiddenByReplacement||!u.node.meshes)return;let p=Number.MAX_VALUE;const m=u.node,v=r.tile,b=l.calculatePosMatrix(v.tileID.toUnwrapped(),l.worldSize),S=u.evaluatedScale;let A=0;l.elevation&&m.elevation&&(A=m.elevation*l.elevation.exaggeration()),Q(b,b,[(m.anchor?m.anchor[0]:0)*(S[0]-1),(m.anchor?m.anchor[1]:0)*(S[1]-1),A]),ae(b,b,S);const C=r.queryGeometry,M=C.isPointQuery()?C.screenBounds:C.screenGeometry,z=function($){const W=Y([],b,$.matrix);Y(W,l.expandedFarZProjMatrix,W);for(let q=0;q<$.meshes.length;++q){const ie=$.meshes[q];if(q===$.lightMeshIndex)continue;const re=MC(M,l,W,ie.aabb);re!=null&&(p=Math.min(re,p))}if($.children)for(const q of $.children)z(q)};if(z(m),p===Number.MAX_VALUE)return;const O=new G(0,0);return hM(v.tileID.canonical,O,u.node.anchor[0],u.node.anchor[1]),{intersectionZ:p,position:O,feature:u.feature}}Pt(Zx,"Tiled3dModelBucket",{omit:["layers"]}),Pt(uM,"Tiled3dModelFeature");const $4={circle:class extends cs{constructor(s,e,r,l){super(s,{layout:wu||(wu=new Vi({"circle-sort-key":new Et(Le.layout_circle["circle-sort-key"]),"circle-elevation-reference":new pt(Le.layout_circle["circle-elevation-reference"]),visibility:new pt(Le.layout_circle.visibility)})),paint:Na||(Na=new Vi({"circle-radius":new Et(Le.paint_circle["circle-radius"]),"circle-color":new Et(Le.paint_circle["circle-color"]),"circle-blur":new Et(Le.paint_circle["circle-blur"]),"circle-opacity":new Et(Le.paint_circle["circle-opacity"]),"circle-translate":new pt(Le.paint_circle["circle-translate"]),"circle-translate-anchor":new pt(Le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pt(Le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pt(Le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Et(Le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Et(Le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Et(Le.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new pt(Le.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}createBucket(s){return new Br(s)}queryRadius(s){const e=s;return qo("circle-radius",this,e)+qo("circle-stroke-width",this,e)+Il(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,r,l,u,p,m,v){const b=_a(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,s.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return _A(s,l,p,m,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,e,r){const l=gA(this);return{config:new wc(this,{zoom:e,lut:r}),defines:l,overrideFog:!1}}is3D(s){return!s&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends cs{createBucket(s){return new vA(s)}constructor(s,e,r,l){super(s,{layout:xA||(xA=new Vi({visibility:new pt(Le.layout_heatmap.visibility)})),paint:wA||(wA=new Vi({"heatmap-radius":new Et(Le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Et(Le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pt(Le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new hu(Le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pt(Le.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Hg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(s){return qo("heatmap-radius",this,s)}queryIntersectsFeature(s,e,r,l,u,p,m,v){const b=this.paint.get("heatmap-radius").evaluate(e,r);return _A(s,l,p,m,v,!0,!0,new ct(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,e,r){return s==="heatmap"?{config:new wc(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends cs{constructor(s,e,r,l){super(s,{layout:bA||(bA=new Vi({visibility:new pt(Le.layout_hillshade.visibility)})),paint:TA||(TA=new Vi({"hillshade-illumination-direction":new pt(Le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pt(Le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pt(Le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pt(Le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pt(Le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pt(Le.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new pt(Le.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,e,r){return{overrideFog:!1}}},fill:class extends cs{constructor(s,e,r,l){super(s,{layout:NA||(NA=new Vi({"fill-sort-key":new Et(Le.layout_fill["fill-sort-key"]),visibility:new pt(Le.layout_fill.visibility),"fill-elevation-reference":new pt(Le.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Et(Le.layout_fill["fill-construct-bridge-guard-rail"])})),paint:BA||(BA=new Vi({"fill-antialias":new pt(Le.paint_fill["fill-antialias"]),"fill-opacity":new Et(Le.paint_fill["fill-opacity"]),"fill-color":new Et(Le.paint_fill["fill-color"]),"fill-outline-color":new Et(Le.paint_fill["fill-outline-color"]),"fill-translate":new pt(Le.paint_fill["fill-translate"]),"fill-translate-anchor":new pt(Le.paint_fill["fill-translate-anchor"]),"fill-pattern":new Et(Le.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new pt(Le.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new pt(Le.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Et(Le.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Et(Le.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Et(Le.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(s,e,r){return{config:new wc(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(s,e){super.recalculate(s,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new hb(s)}queryRadius(){return Il(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,r,l,u,p){return!s.queryGeometry.isAboveHorizon&&Vs(Al(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,s.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(s){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return s!=null?e&&!s:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends cs{constructor(s,e,r,l){super(s,{layout:lC||(lC=new Vi({visibility:new pt(Le["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new pt(Le["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:cC||(cC=new Vi({"fill-extrusion-opacity":new pt(Le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Et(Le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pt(Le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pt(Le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Et(Le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new pt(Le["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Et(Le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Et(Le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new pt(Le["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new pt(Le["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new pt(Le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new pt(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new pt(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new pt(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new pt(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new pt(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new pt(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new pt(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Et(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Et(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new pt(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new pt(Le["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new pt(Le["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new pt(Le["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Et(Le["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Et(Le["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new pt(Le["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new xx(s)}queryRadius(){return Il(this.paint.get("fill-extrusion-translate"))}is3D(s){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,e,r,l,u,p,m,v,b){const S=_a(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,s.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,r),C=this.paint.get("fill-extrusion-base").evaluate(e,r),M=[0,0],z=v&&p.elevation,O=p.elevation?p.elevation.exaggeration():1,$=s.tile.getBucket(this);if(z&&$ instanceof xx){const le=$.centroidVertexArray,we=b+1;we<le.length&&(M[0]=le.geta_centroid_pos0(we),M[1]=le.geta_centroid_pos1(we))}if(M[0]===0&&M[1]===1)return!1;p.projection.name==="globe"&&(l=aC([l],[new ct(0,0),new ct(vt,vt)],s.tileID.canonical).map(le=>le.polygon).flat());const W=z?v:null,[q,ie]=function(le,we,be,Ie,Pe,Me,Ye,ze,Qe,lt,tt){return le.projection.name==="globe"?function(rt,dt,Xe,ot,Ge,je,ft,ut,Gt,At,Lt){const yt=[],Vt=[],an=rt.projection.upVectorScale(Lt,rt.center.lat,rt.worldSize).metersToTile,St=[0,0,0,1],Ft=[0,0,0,1],Yt=(En,mn,kt,fn)=>{En[0]=mn,En[1]=kt,En[2]=fn,En[3]=1},dn=oC();Xe>0&&(Xe+=dn),ot+=dn;for(const En of dt){const mn=[],kt=[];for(const fn of En){const Fn=fn.x+Ge.x,he=fn.y+Ge.y,de=rt.projection.projectTilePoint(Fn,he,Lt),Ue=rt.projection.upVector(Lt,fn.x,fn.y);let Ke=Xe,Tt=ot;if(ft){const bt=mC(Fn,he,Xe,ot,ft,ut,Gt,At);Ke+=bt.base,Tt+=bt.top}Xe!==0?Yt(St,de.x+Ue[0]*an*Ke,de.y+Ue[1]*an*Ke,de.z+Ue[2]*an*Ke):Yt(St,de.x,de.y,de.z),Yt(Ft,de.x+Ue[0]*an*Tt,de.y+Ue[1]*an*Tt,de.z+Ue[2]*an*Tt),ui(St,St,je),ui(Ft,Ft,je),mn.push(new nd(St[0],St[1],St[2])),kt.push(new nd(Ft[0],Ft[1],Ft[2]))}yt.push(mn),Vt.push(kt)}return[yt,Vt]}(le,we,be,Ie,Pe,Me,Ye,ze,Qe,lt,tt):Ye?function(rt,dt,Xe,ot,Ge,je,ft,ut,Gt){const At=[],Lt=[],yt=[0,0,0,1];for(const Vt of rt){const an=[],St=[];for(const Ft of Vt){const Yt=Ft.x+ot.x,dn=Ft.y+ot.y,En=mC(Yt,dn,dt,Xe,je,ft,ut,Gt);yt[0]=Yt,yt[1]=dn,yt[2]=En.base,yt[3]=1,Nr(yt,yt,Ge),yt[3]=Math.max(yt[3],1e-5);const mn=new nd(yt[0]/yt[3],yt[1]/yt[3],yt[2]/yt[3]);yt[0]=Yt,yt[1]=dn,yt[2]=En.top,yt[3]=1,Nr(yt,yt,Ge),yt[3]=Math.max(yt[3],1e-5);const kt=new nd(yt[0]/yt[3],yt[1]/yt[3],yt[2]/yt[3]);an.push(mn),St.push(kt)}At.push(an),Lt.push(St)}return[At,Lt]}(we,be,Ie,Pe,Me,Ye,ze,Qe,lt):function(rt,dt,Xe,ot,Ge){const je=[],ft=[],ut=Ge[8]*dt,Gt=Ge[9]*dt,At=Ge[10]*dt,Lt=Ge[11]*dt,yt=Ge[8]*Xe,Vt=Ge[9]*Xe,an=Ge[10]*Xe,St=Ge[11]*Xe;for(const Ft of rt){const Yt=[],dn=[];for(const En of Ft){const mn=En.x+ot.x,kt=En.y+ot.y,fn=Ge[0]*mn+Ge[4]*kt+Ge[12],Fn=Ge[1]*mn+Ge[5]*kt+Ge[13],he=Ge[2]*mn+Ge[6]*kt+Ge[14],de=Ge[3]*mn+Ge[7]*kt+Ge[15],Ue=fn+ut,Ke=Fn+Gt,Tt=he+At,bt=Math.max(de+Lt,1e-5),Rt=fn+yt,Wt=Fn+Vt,In=he+an,An=Math.max(de+St,1e-5);Yt.push(new nd(Ue/bt,Ke/bt,Tt/bt)),dn.push(new nd(Rt/An,Wt/An,In/An))}je.push(Yt),ft.push(dn)}return[je,ft]}(we,be,Ie,Pe,Me)}(p,l,C,A,S,m,W,M,O,p.center.lat,s.tileID.canonical),re=s.queryGeometry;return function(le,we,be){let Ie=1/0;Vs(be,we)&&(Ie=pC(be,we[0]));for(let Pe=0;Pe<we.length;Pe++){const Me=we[Pe],Ye=le[Pe];for(let ze=0;ze<Me.length-1;ze++){const Qe=Me[ze],lt=[Qe,Me[ze+1],Ye[ze+1],Ye[ze],Qe];po(be,lt)&&(Ie=Math.min(Ie,pC(be,lt)))}}return Ie!==1/0&&Ie}(q,ie,re.isPointQuery()?re.screenBounds:re.screenGeometry)}},building:class extends cs{constructor(s,e,r,l){super(s,{layout:jC||(jC=new Vi({visibility:new pt(Le.layout_building.visibility),"building-facade":new Et(Le.layout_building["building-facade"]),"building-facade-floors":new Et(Le.layout_building["building-facade-floors"]),"building-facade-unit-width":new Et(Le.layout_building["building-facade-unit-width"]),"building-facade-window":new Et(Le.layout_building["building-facade-window"]),"building-roof-shape":new Et(Le.layout_building["building-roof-shape"]),"building-height":new Et(Le.layout_building["building-height"]),"building-base":new Et(Le.layout_building["building-base"]),"building-flood-light-wall-radius":new Et(Le.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Et(Le.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Et(Le.layout_building["building-flip-roof-orientation"])})),paint:VC||(VC=new Vi({"building-opacity":new pt(Le.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new pt(Le.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new pt(Le.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new pt(Le.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new pt(Le.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new pt(Le.paint_building["building-vertical-scale"]),"building-cast-shadows":new pt(Le.paint_building["building-cast-shadows"]),"building-color":new Et(Le.paint_building["building-color"]),"building-emissive-strength":new Et(Le.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new pt(Le.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new pt(Le.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new pt(Le.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new pt(Le.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new pt(Le.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new BC(s)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(s){return!0}},line:class extends cs{constructor(s,e,r,l){const u=YC();super(s,u,e,r,l),u.layout&&(this.layout=new mc(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Oh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=(()=>{if(l_)return l_;const r=YC();return l_=new Uj(r.paint.properties["line-width"].specification),l_.useIntegerZoom=!0,l_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Lb(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,e,r){const l=XC(this);return{config:new wc(this,{zoom:e,lut:r}),defines:l,overrideFog:!1}}queryRadius(s){const e=s,r=JC(qo("line-width",this,e),qo("line-gap-width",this,e)),l=qo("line-offset",this,e);return r/2+Math.abs(l)+Il(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,r,l,u,p){if(s.queryGeometry.isAboveHorizon)return!1;const m=Al(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,s.pixelToTileUnitsFactor),v=s.pixelToTileUnitsFactor/2*JC(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),b=this.paint.get("line-offset").evaluate(e,r);return b&&(l=function(S,A){const C=[],M=new ct(0,0);for(let z=0;z<S.length;z++){const O=S[z],$=[];for(let W=0;W<O.length;W++){const q=O[W],ie=O[W+1],re=W===0?M:q.sub(O[W-1])._unit()._perp(),le=W===O.length-1?M:ie.sub(q)._unit()._perp(),we=re._add(le)._unit();we._mult(1/(we.x*le.x+we.y*le.y)),$.push(we._mult(A)._add(q))}C.push($)}return C}(l,b*s.pixelToTileUnitsFactor)),function(S,A,C){for(let M=0;M<A.length;M++){const z=A[M];if(S.length>=3){for(let O=0;O<z.length;O++)if(Cr(S,z[O]))return!0}if(Us(S,z,C))return!0}return!1}(m,l,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(s){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:$x,background:class extends cs{constructor(s,e,r,l){super(s,{layout:GP||(GP=new Vi({visibility:new pt(Le.layout_background.visibility)})),paint:$P||($P=new Vi({"background-pitch-alignment":new pt(Le.paint_background["background-pitch-alignment"]),"background-color":new pt(Le.paint_background["background-color"]),"background-pattern":new pt(Le.paint_background["background-pattern"]),"background-opacity":new pt(Le.paint_background["background-opacity"]),"background-emissive-strength":new pt(Le.paint_background["background-emissive-strength"]),"background-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,e,r){return{overrideFog:!1}}is3D(s){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:XP,"raster-particle":tM,sky:class extends cs{constructor(s,e,r,l){super(s,{layout:JP||(JP=new Vi({visibility:new pt(Le.layout_sky.visibility)})),paint:QP||(QP=new Vi({"sky-type":new pt(Le.paint_sky["sky-type"]),"sky-atmosphere-sun":new pt(Le.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new pt(Le.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new pt(Le.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new pt(Le.paint_sky["sky-gradient-radius"]),"sky-gradient":new hu(Le.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new pt(Le.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new pt(Le.paint_sky["sky-atmosphere-color"]),"sky-opacity":new pt(Le.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Hg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),u=!l,p=s.style.light,m=p.properties.get("position");return u&&p.properties.get("anchor")==="viewport"&&Dn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Qb(m.azimuthal,90-m.polar,e):Qb(l[0],90-l[1],e)}const r=this.paint.get("sky-gradient-center");return Qb(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends cs{constructor(s,e,r,l){super(s,{paint:eM||(eM=new Vi({}))},e,null)}},model:class extends cs{constructor(s,e,r,l){super(s,{layout:sM||(sM=new Vi({visibility:new pt(Le.layout_model.visibility),"model-id":new Et(Le.layout_model["model-id"])})),paint:oM||(oM=new Vi({"model-opacity":new Et(Le.paint_model["model-opacity"]),"model-rotation":new Et(Le.paint_model["model-rotation"]),"model-scale":new Et(Le.paint_model["model-scale"]),"model-translation":new Et(Le.paint_model["model-translation"]),"model-color":new Et(Le.paint_model["model-color"]),"model-color-mix-intensity":new Et(Le.paint_model["model-color-mix-intensity"]),"model-type":new pt(Le.paint_model["model-type"]),"model-cast-shadows":new pt(Le.paint_model["model-cast-shadows"]),"model-receive-shadows":new pt(Le.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new pt(Le.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Et(Le.paint_model["model-emissive-strength"]),"model-roughness":new Et(Le.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Et(Le.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new pt(Le.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new pt(Le.paint_model["model-front-cutoff"]),"model-elevation-reference":new pt(Le.paint_model["model-elevation-reference"]),"model-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new tT(s)}getProgramIds(){return["model"]}is3D(s){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof Zx?vt-1:0}queryIntersectsFeature(s,e,r,l,u,p){if(!this.modelManager)return!1;const m=this.modelManager,v=s.tile.getBucket(this);if(!(v&&v instanceof tT))return!1;for(const b in v.instancesPerModel){const S=v.instancesPerModel[b],A=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(S.idToFeaturesIndex.hasOwnProperty(A)){const C=S.features[S.idToFeaturesIndex[A]],M=m.getModel(b,this.scope);if(!M)return!1;let z=ce();const O=new G(0,0),$=v.canonical;let W=Number.MAX_VALUE;for(let q=0;q<C.instancedDataCount;++q){const ie=16*(C.instancedDataOffset+q),re=S.instancedDataArray.float32,le=[re[ie+4],re[ie+5],re[ie+6]];hM($,O,re[ie],0|re[ie+1]),RC(z,M,p,O,C.rotation,C.scale,le,!1,!1,!1),p.projection.name==="globe"&&(z=Cb(z,p));const we=Y([],p.projMatrix,z),be=s.queryGeometry,Ie=MC(be.isPointQuery()?be.screenBounds:be.screenGeometry,p,we,M.aabb);Ie!=null&&(W=Math.min(Ie,W))}return W!==Number.MAX_VALUE&&W}}return!1}_handleOverridablePaintPropertyUpdate(s,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){const e=this._transitionablePaint._values[s];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof _l}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends cs{constructor(s,e,r,l){super(s,{layout:jA||(jA=new Vi({"clip-layer-types":new pt(Le.layout_clip["clip-layer-types"]),"clip-layer-scope":new pt(Le.layout_clip["clip-layer-scope"])})),paint:VA||(VA=new Vi({}))},e,r,l)}recalculate(s,e){super.recalculate(s,e)}createBucket(s){return new UA(s)}is3D(s){return!0}}},iT=new Jn(0,0,0),rT={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},sT={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Xx={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},H4={PAINT_ORDER_FILL_AND_STROKE:1},w_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},dM={MASK_TYPE_LUMINANCE:1};function W4(s,e,r){s===1&&e.icons.push(function(l,u){return function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:m}=p;if(m.content_area){const{content_area:v}=m;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=p.usvg_tree.width),v.height==null&&(v.height=v.width)}if(m.text_placeholder){const{text_placeholder:v}=m;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return m.stretch_x&&m.stretch_x.length&&fM(m,"x"),m.stretch_y&&m.stretch_y.length&&fM(m,"y"),p}(l.readFields(q4,{name:void 0},u))}(r,r.readVarint()+r.pos))}function fM(s,e){const r=[],l=s[`stretch_${e}`];let u=null;for(let p=0;p<l.length;p++)u===null?u=r.length===0?l[0]:r[r.length-1][1]+l[p]:(r.push([u,u+l[p]]),u=null);s[`stretch_${e}_areas`]=r}function q4(s,e,r){s===1?e.name=r.readString():s===2?e.metadata=function(l,u){return l.readFields(Z4,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)}(r,r.readVarint()+r.pos):s===3&&(e.usvg_tree=function(l,u){return l.readFields(Y4,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)}(r,r.readVarint()+r.pos),e.data="usvg_tree")}function Z4(s,e,r){s===1?e.stretch_x=r.readPackedVarint():s===2?e.stretch_y=r.readPackedVarint():s===3?e.content_area=pM(r,r.readVarint()+r.pos):s===4?e.variables.push(function(l,u){return l.readFields(K4,{name:void 0},u)}(r,r.readVarint()+r.pos)):s===5&&(e.text_placeholder=pM(r,r.readVarint()+r.pos))}function pM(s,e){return s.readFields(X4,{},e)}function X4(s,e,r){s===1?e.left=r.readVarint():s===2?e.width=r.readVarint():s===3?e.top=r.readVarint():s===4&&(e.height=r.readVarint())}function K4(s,e,r){s===1?e.name=r.readString():s===2&&(e.rgb_color=Jx(r.readVarint()),e.value="rgb_color")}function Y4(s,e,r){s===1?e.width=e.height=r.readVarint():s===2?e.height=r.readVarint():s===3?e.children.push(Kx(r,r.readVarint()+r.pos)):s===4?e.linear_gradients.push(function(l,u){return l.readFields(rV,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)}(r,r.readVarint()+r.pos)):s===5?e.radial_gradients.push(function(l,u){return l.readFields(oV,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)}(r,r.readVarint()+r.pos)):s===7?e.clip_paths.push(function(l,u){return l.readFields(aV,{children:[]},u)}(r,r.readVarint()+r.pos)):s===8&&e.masks.push(function(l,u){const p=l.readFields(lV,{left:0,width:20,mask_type:dM.MASK_TYPE_LUMINANCE,children:[]},u);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p}(r,r.readVarint()+r.pos))}function Kx(s,e){return s.readFields(J4,{},e)}function J4(s,e,r){s===1?(e.group=function(l,u){return l.readFields(Q4,{opacity:255,children:[]},u)}(r,r.readVarint()+r.pos),e.node="group"):s===2&&(e.path=function(l,u){return l.readFields(tV,{paint_order:1,commands:[],step:1,diffs:[],rule:rT.PATH_RULE_NON_ZERO},u)}(r,r.readVarint()+r.pos),e.node="path")}function Q4(s,e,r){s===1?e.transform=Yx(r,r.readVarint()+r.pos):s===2?e.opacity=r.readVarint():s===5?e.clip_path_idx=r.readVarint():s===6?e.mask_idx=r.readVarint():s===7&&e.children.push(Kx(r,r.readVarint()+r.pos))}function Yx(s,e){return s.readFields(eV,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function eV(s,e,r){s===1?e.sx=r.readFloat():s===2?e.ky=r.readFloat():s===3?e.kx=r.readFloat():s===4?e.sy=r.readFloat():s===5?e.tx=r.readFloat():s===6&&(e.ty=r.readFloat())}function tV(s,e,r){s===1?e.fill=function(l,u){return l.readFields(nV,{rgb_color:iT,paint:"rgb_color",opacity:255},u)}(r,r.readVarint()+r.pos):s===2?e.stroke=function(l,u){return l.readFields(iV,{rgb_color:iT,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)}(r,r.readVarint()+r.pos):s===3?e.paint_order=r.readVarint():s===5?r.readPackedVarint(e.commands):s===6?e.step=r.readFloat():s===7?r.readPackedSVarint(e.diffs):s===8&&(e.rule=r.readVarint())}function nV(s,e,r){s===1?(e.rgb_color=Jx(r.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):s===5&&(e.opacity=r.readVarint())}function Jx(s){return new Jn((s>>16&255)/255,(s>>8&255)/255,(255&s)/255,1)}function iV(s,e,r){s===1?(e.rgb_color=Jx(r.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):s===5?r.readPackedFloat(e.dasharray):s===6?e.dashoffset=r.readFloat():s===7?e.miterlimit=r.readFloat():s===8?e.opacity=r.readVarint():s===9?e.width=r.readFloat():s===10?e.linecap=r.readVarint():s===11&&(e.linejoin=r.readVarint())}function rV(s,e,r){s===1?e.transform=Yx(r,r.readVarint()+r.pos):s===2?e.spread_method=r.readVarint():s===3?e.stops.push(mM(r,r.readVarint()+r.pos)):s===4?e.x1=r.readFloat():s===5?e.y1=r.readFloat():s===6?e.x2=r.readFloat():s===7&&(e.y2=r.readFloat())}function mM(s,e){return s.readFields(sV,{offset:0,opacity:255,rgb_color:iT},e)}function sV(s,e,r){s===1?e.offset=r.readFloat():s===2?e.opacity=r.readVarint():s===3&&(e.rgb_color=Jx(r.readVarint()))}function oV(s,e,r){s===1?e.transform=Yx(r,r.readVarint()+r.pos):s===2?e.spread_method=r.readVarint():s===3?e.stops.push(mM(r,r.readVarint()+r.pos)):s===4?e.cx=r.readFloat():s===5?e.cy=r.readFloat():s===6?e.r=r.readFloat():s===7?e.fx=r.readFloat():s===8?e.fy=r.readFloat():s===9&&(e.fr=r.readFloat())}function aV(s,e,r){s===1?e.transform=Yx(r,r.readVarint()+r.pos):s===2?e.clip_path_idx=r.readVarint():s===3&&e.children.push(Kx(r,r.readVarint()+r.pos))}function lV(s,e,r){s===1?e.left=e.top=r.readFloat():s===2?e.width=e.height=r.readFloat():s===3?e.top=r.readFloat():s===4?e.height=r.readFloat():s===5?e.mask_type=r.readVarint():s===6?e.mask_idx=r.readVarint():s===7&&e.children.push(Kx(r,r.readVarint()+r.pos))}class cV{static calculate(e={},r=[]){const l=new Map,u=new Map;if(Object.keys(e).length===0)return l;r.forEach(p=>{u.set(p.name,p.rgb_color||new Jn(0,0,0))});for(const[p,m]of Object.entries(e))u.has(p)?l.set(u.get(p).toString(),m):console.warn(`Ignoring unknown image variable "${p}"`);return l}}function _p(s,e=255,r){const l=e/255,u=s.toString(),p=r.has(u)?r.get(u).clone():s.clone();return p.a*=l,p.toString()}function b_(s,e){if(!Lm()){const r=document.createElement("canvas");return r.width=s,r.height=e,r}return new OffscreenCanvas(s,e)}function uV(s,e){const r=cV.calculate(e.params,s.metadata?s.metadata.variables:[]),l=s.usvg_tree,u=l.width,p=l.height,m=e.transform?e.transform:new DOMMatrix,v=Math.max(1,Math.round(u*m.a)),b=Math.max(1,Math.round(p*m.d)),S=new DOMMatrix([v/u,0,0,b/p,0,0]),A=b_(v,b).getContext("2d");return oT(A,S,l,l,r),A.getImageData(0,0,v,b)}function oT(s,e,r,l,u){for(const p of l.children)gM(s,e,r,p,u)}function gM(s,e,r,l,u){l.group?(s.save(),function(p,m,v,b,S){const A=b.mask_idx!=null?v.masks[b.mask_idx]:null,C=b.clip_path_idx!=null?v.clip_paths[b.clip_path_idx]:null;if(b.transform&&(m=yp(b.transform).preMultiplySelf(m)),!function(O,$,W){return O.opacity!==255||$||W}(b,C!=null,A!=null))return void oT(p,m,v,b,S);const M=b_(p.canvas.width,p.canvas.height),z=M.getContext("2d");oT(z,m,v,b,S),C&&TM(z,m,v,C),A&&SM(z,m,v,A,S),p.globalAlpha=b.opacity/255,p.drawImage(M,0,0)}(s,e,r,l.group,u),s.restore()):l.path&&(s.save(),function(p,m,v,b,S){p.setTransform(m),b.paint_order===H4.PAINT_ORDER_FILL_AND_STROKE?(_M(p,v,b,S),vM(p,v,b,S)):(vM(p,v,b,S),_M(p,v,b,S))}(s,e,r,l.path,u),s.restore())}function _M(s,e,r,l){const u=r.fill;if(!u)return;const p=u.opacity/255;switch(s.save(),s.beginPath(),EM(r,s),u.paint){case"rgb_color":s.fillStyle=_p(u.rgb_color,u.opacity,l);break;case"linear_gradient_idx":{const m=e.linear_gradients[u.linear_gradient_idx];m.transform&&s.setTransform(yp(m.transform).preMultiplySelf(s.getTransform())),s.fillStyle=xM(s,m,p,l);break}case"radial_gradient_idx":{const m=e.radial_gradients[u.radial_gradient_idx];m.transform&&s.setTransform(yp(m.transform).preMultiplySelf(s.getTransform())),s.fillStyle=wM(s,m,p,l)}}s.fill(yM(r)),s.restore()}function yM(s){return s.rule===rT.PATH_RULE_NON_ZERO?"nonzero":s.rule===rT.PATH_RULE_EVEN_ODD?"evenodd":void 0}function vM(s,e,r,l){const u=r.stroke;if(!u)return;const p=IM(r);s.lineWidth=u.width,s.miterLimit=u.miterlimit,s.setLineDash(u.dasharray),s.lineDashOffset=u.dashoffset;const m=u.opacity/255;switch(u.paint){case"rgb_color":s.strokeStyle=_p(u.rgb_color,u.opacity,l);break;case"linear_gradient_idx":s.strokeStyle=xM(s,e.linear_gradients[u.linear_gradient_idx],m,l,!0);break;case"radial_gradient_idx":s.strokeStyle=wM(s,e.radial_gradients[u.radial_gradient_idx],m,l,!0)}switch(u.linejoin){case Xx.LINE_JOIN_MITER_CLIP:case Xx.LINE_JOIN_MITER:s.lineJoin="miter";break;case Xx.LINE_JOIN_ROUND:s.lineJoin="round";break;case Xx.LINE_JOIN_BEVEL:s.lineJoin="bevel"}switch(u.linecap){case sT.LINE_CAP_BUTT:s.lineCap="butt";break;case sT.LINE_CAP_ROUND:s.lineCap="round";break;case sT.LINE_CAP_SQUARE:s.lineCap="square"}s.stroke(p)}function xM(s,e,r,l,u=!1){if(e.stops.length===1){const M=e.stops[0];return _p(M.rgb_color,M.opacity*r,l)}const{x1:p,y1:m,x2:v,y2:b}=e;let S=new DOMPoint(p,m),A=new DOMPoint(v,b);if(u){const M=yp(e.transform);S=M.transformPoint(S),A=M.transformPoint(A)}const C=s.createLinearGradient(S.x,S.y,A.x,A.y);for(const M of e.stops)C.addColorStop(M.offset,_p(M.rgb_color,M.opacity*r,l));return C}function wM(s,e,r,l,u=!1){if(e.stops.length===1){const q=e.stops[0];return _p(q.rgb_color,q.opacity*r,l)}const p=yp(e.transform),{fx:m,fy:v,fr:b,cx:S,cy:A,r:C}=e;let M=new DOMPoint(m,v),z=new DOMPoint(S,A),O=b,$=C;if(u){M=p.transformPoint(M),z=p.transformPoint(z);const q=(p.a+p.d)/2;O=b*q,$=e.r*q}const W=s.createRadialGradient(M.x,M.y,O,z.x,z.y,$);for(const q of e.stops)W.addColorStop(q.offset,_p(q.rgb_color,q.opacity*r,l));return W}function bM(s,e,r,l){const u=l.transform?yp(l.transform).preMultiplySelf(e):e,p=b_(s.canvas.width,s.canvas.height),m=p.getContext("2d");for(const b of l.children)if(b.group)bM(m,u,r,b.group);else if(b.path){const S=b.path,A=new Path2D;A.addPath(IM(S),u),m.fill(A,yM(S))}const v=l.clip_path_idx!=null?r.clip_paths[l.clip_path_idx]:null;v&&TM(m,u,r,v),s.globalCompositeOperation="source-over",s.drawImage(p,0,0)}function TM(s,e,r,l){const u=b_(s.canvas.width,s.canvas.height);bM(u.getContext("2d"),e,r,l),s.globalCompositeOperation="destination-in",s.drawImage(u,0,0)}function SM(s,e,r,l,u){if(l.children.length===0)return;const p=l.mask_idx!=null?r.masks[l.mask_idx]:null;p&&SM(s,e,r,p,u);const m=s.canvas.width,v=s.canvas.height,b=b_(m,v),S=b.getContext("2d"),A=l.width,C=l.height,M=l.left,z=l.top,O=new Path2D,$=new Path2D;$.rect(M,z,A,C),O.addPath($,e),S.clip(O);for(const ie of l.children)gM(S,e,r,ie,u);const W=S.getImageData(0,0,m,v),q=W.data;if(l.mask_type===dM.MASK_TYPE_LUMINANCE)for(let ie=0;ie<q.length;ie+=4)q[ie+3]=q[ie+3]/255*(.2126*q[ie]+.7152*q[ie+1]+.0722*q[ie+2]);S.putImageData(W,0,0),s.globalCompositeOperation="destination-in",s.drawImage(b,0,0)}function yp(s){return s?new DOMMatrix([s.sx,s.ky,s.kx,s.sy,s.tx,s.ty]):new DOMMatrix}function EM(s,e){const r=s.step;let l=s.diffs[0]*r,u=s.diffs[1]*r;e.moveTo(l,u);for(let p=0,m=2;p<s.commands.length;p++)switch(s.commands[p]){case w_.PATH_COMMAND_MOVE:l+=s.diffs[m++]*r,u+=s.diffs[m++]*r,e.moveTo(l,u);break;case w_.PATH_COMMAND_LINE:l+=s.diffs[m++]*r,u+=s.diffs[m++]*r,e.lineTo(l,u);break;case w_.PATH_COMMAND_QUAD:{const v=l+s.diffs[m++]*r,b=u+s.diffs[m++]*r;l=v+s.diffs[m++]*r,u=b+s.diffs[m++]*r,e.quadraticCurveTo(v,b,l,u);break}case w_.PATH_COMMAND_CUBIC:{const v=l+s.diffs[m++]*r,b=u+s.diffs[m++]*r,S=v+s.diffs[m++]*r,A=b+s.diffs[m++]*r;l=S+s.diffs[m++]*r,u=A+s.diffs[m++]*r,e.bezierCurveTo(v,b,S,A,l,u);break}case w_.PATH_COMMAND_CLOSE:e.closePath()}return e}function IM(s){return EM(s,new Path2D)}class Qx{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,r)}delete(e){this.cache.delete(e)}}Pt(Qx,"LRUCache");class aT{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new ns(e,e.data)}getFromCache(e,r,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new Qx(150)),this.cacheMap.get(l).get(fu(e.toString(),r))}setInCache(e,r,l,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new Qx(150));const p=this.cacheDependenciesMap.get(u),m=fu(e.id.toString(),l);p.get(m)||p.set(m,new Set);const v=this.cacheMap.get(u),b=e.toString();p.get(m).add(b),v.put(fu(e.toString(),l),r)}removeImagesFromCacheByIds(e,r,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const u=this.cacheMap.get(l),p=this.cacheDependenciesMap.get(l);for(const m of e){const v=fu(m.toString(),r);if(p.has(v)){for(const b of p.get(v))u.delete(b);p.delete(v)}}}rasterize(e,r,l,u,p=uV){const m=this.getFromCache(e,l,u);if(m)return m.clone();const v=p(r.icon,e.options),b=aT._getImage(v);return this.setInCache(e,b,l,u),b.clone()}}class AM{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const l=this.toIdx(e,r);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function CM(s,e,r,l){let u=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(l[m])<1e-15){if(r[m]<s[m]||r[m]>e[m])return null}else{const v=1/l[m];let b=(s[m]-r[m])*v,S=(e[m]-r[m])*v;if(b>S){const A=b;b=S,S=A}if(b>u&&(u=b),S<p&&(p=S),u>p)return null}return u}function PM(s,e,r,l,u,p,m,v,b,S,A){const C=l-s,M=u-e,z=p-r,O=m-s,$=v-e,W=b-r,q=A[1]*W-A[2]*$,ie=A[2]*O-A[0]*W,re=A[0]*$-A[1]*O,le=C*q+M*ie+z*re;if(Math.abs(le)<1e-15)return null;const we=1/le,be=S[0]-s,Ie=S[1]-e,Pe=S[2]-r,Me=(be*q+Ie*ie+Pe*re)*we;if(Me<0||Me>1)return null;const Ye=Ie*z-Pe*M,ze=Pe*C-be*z,Qe=be*M-Ie*C,lt=(A[0]*Ye+A[1]*ze+A[2]*Qe)*we;return lt<0||Me+lt>1?null:(O*Ye+$*ze+W*Qe)*we}function MM(s,e,r){return(s-e)/(r-e)}function RM(s,e,r,l,u,p,m,v,b){const S=1<<r,A=p-l,C=m-u,M=(s+1)/S*A+l,z=(e+0)/S*C+u,O=(e+1)/S*C+u;v[0]=(s+0)/S*A+l,v[1]=z,b[0]=M,b[1]=O}class kM{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(p){const m=Math.ceil(Math.log2(p.dim/8)),v=[];let b=Math.ceil(Math.pow(2,m));const S=1/b,A=(z,O,$,W,q)=>{const ie=W?1:0,re=(z+1)*$-ie,le=O*$,we=(O+1)*$-ie;q[0]=z*$,q[1]=le,q[2]=re,q[3]=we};let C=new AM(b);const M=[];for(let z=0;z<b*b;z++){A(z%b,Math.floor(z/b),S,!1,M);const O=Pu(M[0],M[1],p),$=Pu(M[2],M[1],p),W=Pu(M[2],M[3],p),q=Pu(M[0],M[3],p);C.minimums.push(Math.min(O,$,W,q)),C.maximums.push(Math.max(O,$,W,q)),C.leaves.push(1)}for(v.push(C),b/=2;b>=1;b/=2){const z=v[v.length-1];C=new AM(b);for(let O=0;O<b*b;O++){A(O%b,Math.floor(O/b),2,!0,M);const $=z.getElevation(M[0],M[1]),W=z.getElevation(M[2],M[1]),q=z.getElevation(M[2],M[3]),ie=z.getElevation(M[0],M[3]),re=z.isLeaf(M[0],M[1]),le=z.isLeaf(M[2],M[1]),we=z.isLeaf(M[2],M[3]),be=z.isLeaf(M[0],M[3]),Ie=Math.min($.min,W.min,q.min,ie.min),Pe=Math.max($.max,W.max,q.max,ie.max),Me=re&&le&&we&&be;C.maximums.push(Pe),C.minimums.push(Ie),C.leaves.push(Pe-Ie<=5&&Me?1:0)}v.push(C)}return v}(this.dem),l=r.length-1,u=r[l];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(r,0,0,l,0)}raycastRoot(e,r,l,u,p,m,v=1){return CM([e,r,-100],[l,u,this.maximums[0]*v],p,m)}raycast(e,r,l,u,p,m,v=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,r,l,u,p,m,v);if(b==null)return null;const S=[],A=[],C=[],M=[],z=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:O,t:$,nodex:W,nodey:q,depth:ie}=z.pop();if(this.leaves[O]){RM(W,q,ie,e,r,l,u,C,M);const le=1<<ie,we=(W+0)/le,be=(W+1)/le,Ie=(q+0)/le,Pe=(q+1)/le,Me=Pu(we,Ie,this.dem)*v,Ye=Pu(be,Ie,this.dem)*v,ze=Pu(be,Pe,this.dem)*v,Qe=Pu(we,Pe,this.dem)*v,lt=PM(C[0],C[1],Me,M[0],C[1],Ye,M[0],M[1],ze,p,m),tt=PM(M[0],M[1],ze,C[0],M[1],Qe,C[0],C[1],Me,p,m),rt=Math.min(lt!==null?lt:Number.MAX_VALUE,tt!==null?tt:Number.MAX_VALUE);if(rt!==Number.MAX_VALUE)return rt;{const dt=Xn([],p,m,$);if(DM(Me,Ye,Qe,ze,MM(dt[0],C[0],M[0]),MM(dt[1],C[1],M[1]))>=dt[2])return $}continue}let re=0;for(let le=0;le<this._siblingOffset.length;le++){RM((W<<1)+this._siblingOffset[le][0],(q<<1)+this._siblingOffset[le][1],ie+1,e,r,l,u,C,M),C[2]=-100,M[2]=this.maximums[this.childOffsets[O]+le]*v;const we=CM(C,M,p,m);if(we!=null){const be=we;S[le]=be;let Ie=!1;for(let Pe=0;Pe<re&&!Ie;Pe++)be>=S[A[Pe]]&&(A.splice(Pe,0,le),Ie=!0);Ie||(A[re]=le),re++}}for(let le=0;le<re;le++){const we=A[le];z.push({idx:this.childOffsets[O]+we,t:S[we],nodex:(W<<1)+this._siblingOffset[we][0],nodey:(q<<1)+this._siblingOffset[we][1],depth:ie+1})}}return null}_addNode(e,r,l){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,l,u,p){if(e[u].isLeaf(r,l)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=u-1,v=e[m];let b=0,S=0;for(let A=0;A<this._siblingOffset.length;A++){const C=2*r+this._siblingOffset[A][0],M=2*l+this._siblingOffset[A][1],z=v.getElevation(C,M),O=v.isLeaf(C,M),$=this._addNode(z.min,z.max,O);O&&(b|=1<<A),S||(S=$)}for(let A=0;A<this._siblingOffset.length;A++)b&1<<A||this._construct(e,2*r+this._siblingOffset[A][0],2*l+this._siblingOffset[A][1],m,S+A)}}function DM(s,e,r,l,u,p){return Kt(Kt(s,r,p),Kt(e,l,p),u)}function Pu(s,e,r){const l=r.dim,u=Se(s*l-.5,0,l-1),p=Se(e*l-.5,0,l-1),m=Math.floor(u),v=Math.floor(p),b=Math.min(m+1,l-1),S=Math.min(v+1,l-1);return DM(r.get(m,v),r.get(b,v),r.get(m,S),r.get(b,S),u-m,p-v)}const hV={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function dV(s,e,r){return(256*s*256+256*e+r)/10-1e4}function fV(s,e,r){return 256*s+e+r/256-32768}class e0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,l,u=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void Dn(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2,m=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let b=0;b<p;b++)m[this._idx(-1,b)]=m[this._idx(0,b)],m[this._idx(p,b)]=m[this._idx(p-1,b)],m[this._idx(b,-1)]=m[this._idx(b,0)],m[this._idx(b,p)]=m[this._idx(b,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}const v=l==="terrarium"?fV:dV;for(let b=0;b<m.length;++b){const S=4*b;this.floatView[b]=v(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=ca.now()}_buildQuadTree(){this._tree=new kM(this)}get(e,r,l=!1){l&&(e=Se(e,-1,this.dim),r=Se(r,-1,this.dim));const u=this._idx(e,r);return this.floatView[u]}set(e,r,l){const u=this._idx(e,r),p=this.floatView[u];return this.floatView[u]=l,l-p}static getUnpackVector(e){return hV[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const l=[0,0,0,0],u=e0.getUnpackVector(r);let p=Math.floor((e+u[3])/u[2]);return l[2]=p%256,p=Math.floor(p/256),l[1]=p%256,p=Math.floor(p/256),l[0]=p,l}getPixels(){return new IA({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,p=r*this.dim+this.dim,m=l*this.dim,v=l*this.dim+this.dim;switch(r){case-1:u=p-1;break;case 1:p=u+1}switch(l){case-1:m=v-1;break;case 1:v=m+1}const b=-r*this.dim,S=-l*this.dim;for(let A=m;A<v;A++)for(let C=u;C<p;C++){const M=4*this._idx(C,A),z=4*this._idx(C+b,A+S);this.pixels[M+0]=e.pixels[z+0],this.pixels[M+1]=e.pixels[z+1],this.pixels[M+2]=e.pixels[z+2],this.pixels[M+3]=e.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function pV(s,e,r){s===1?e.headerLength=r.readFixed32():s===2?e.x=r.readVarint():s===3?e.y=r.readVarint():s===4?e.z=r.readVarint():s===5&&e.layers.push(function(l,u){return l.readFields(vV,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)}(r,r.readVarint()+r.pos))}function mV(s,e,r){s===1?(e.delta_filter=function(l,u){return l.readFields(gV,{blockSize:0},u)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):s===2?(r.readVarint(),e.filter="zigzag_filter"):s===3?(r.readVarint(),e.filter="bitshuffle_filter"):s===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function gV(s,e,r){s===1&&(e.blockSize=r.readVarint())}function _V(s,e,r){s===1?(r.readVarint(),e.codec="gzip_data"):s===2?(r.readVarint(),e.codec="jpeg_image"):s===3?(r.readVarint(),e.codec="webp_image"):s===4&&(r.readVarint(),e.codec="png_image")}function yV(s,e,r){let l=0,u=0;s===1?e.firstByte=r.readFixed64():s===2?e.lastByte=r.readFixed64():s===3?e.filters.push(function(p,m){return p.readFields(mV,{},m)}(r,r.readVarint()+r.pos)):s===4?e.codec=function(p,m){return p.readFields(_V,{},m)}(r,r.readVarint()+r.pos):s===5?u=r.readFloat():s===6?l=r.readFloat():s===7?e.bands.push(r.readString()):s===8?e.offset=r.readDouble():s===9&&(e.scale=r.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=l)}function vV(s,e,r){s===1?e.version=r.readVarint():s===2?e.name=r.readString():s===3?e.units=r.readString():s===4?e.tileSize=r.readVarint():s===5?e.buffer=r.readVarint():s===6?e.pixelFormat=r.readVarint():s===7&&e.dataIndex.push(function(l,u){return l.readFields(yV,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)}(r,r.readVarint()+r.pos))}function xV(s,e,r){if(s===2)(function(l,u,p){l.readFields(wV,p,u)})(r,r.readVarint()+r.pos,e);else if(s===3)throw new Error("Not implemented")}function wV(s,e,r){if(s===1){let l=0;const u=r.readVarint()+r.pos;for(;r.pos<u;)e[l++]=r.readVarint()}}function bV(s,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let l=2;l>=1;l--){const u=l===1?1:0,p=l===2?1:0;for(let m=0;m<e[0];m++){const v=e[1]*m;for(let b=u;b<e[1];b++){const S=e[2]*(b+v);for(let A=p;A<e[2];A++){const C=e[3]*(A+S);for(let M=0;M<e[3];M++){const z=C+M;s[z]+=s[z-r]}}}}r*=e[l]}return s}function TV(s){for(let e=0,r=s.length;e<r;e++)s[e]=s[e]>>>1^-(1&s[e]);return s}function SV(s,e){switch(e){case"uint32":return s;case"uint16":for(let r=0;r<s.length;r+=2){const l=s[r],u=s[r+1];s[r]=(240&l)>>4|(61440&l)>>8|(240&u)<<4|61440&u,s[r+1]=15&l|(3840&l)>>4|(15&u)<<8|(3840&u)<<4}return s;case"uint8":for(let r=0;r<s.length;r+=4){const l=s[r],u=s[r+1],p=s[r+2],m=s[r+3];s[r+0]=(192&l)>>6|(192&u)>>4|(192&p)>>2|192&m,s[r+1]=(48&l)>>4|(48&u)>>2|48&p|(48&m)<<2,s[r+2]=(12&l)>>2|12&u|(12&p)<<2|(12&m)<<4,s[r+3]=3&l|(3&u)<<2|(3&p)<<4|(3&m)<<6}return s;default:throw new Error(`Invalid pixel format, "${e}"`)}}Pt(e0,"DEMData"),Pt(kM,"DemMinMaxQuadTree",{omit:["dem"]});var Zo=Uint8Array,T_=Uint16Array,EV=Int32Array,LM=new Zo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),zM=new Zo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),IV=new Zo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),OM=function(s,e){for(var r=new T_(31),l=0;l<31;++l)r[l]=e+=1<<s[l-1];var u=new EV(r[30]);for(l=1;l<30;++l)for(var p=r[l];p<r[l+1];++p)u[p]=p-r[l]<<5|l;return{b:r,r:u}},FM=OM(LM,2),NM=FM.b,AV=FM.r;NM[28]=258,AV[258]=28;for(var CV=OM(zM,0).b,BM=new T_(32768),wr=0;wr<32768;++wr){var vp=(43690&wr)>>1|(21845&wr)<<1;BM[wr]=((65280&(vp=(61680&(vp=(52428&vp)>>2|(13107&vp)<<2))>>4|(3855&vp)<<4))>>8|(255&vp)<<8)>>1}var S_=function(s,e,r){for(var l=s.length,u=0,p=new T_(e);u<l;++u)s[u]&&++p[s[u]-1];var m,v=new T_(e);for(u=1;u<e;++u)v[u]=v[u-1]+p[u-1]<<1;m=new T_(1<<e);var b=15-e;for(u=0;u<l;++u)if(s[u])for(var S=u<<4|s[u],A=e-s[u],C=v[s[u]-1]++<<A,M=C|(1<<A)-1;C<=M;++C)m[BM[C]>>b]=S;return m},E_=new Zo(288);for(wr=0;wr<144;++wr)E_[wr]=8;for(wr=144;wr<256;++wr)E_[wr]=9;for(wr=256;wr<280;++wr)E_[wr]=7;for(wr=280;wr<288;++wr)E_[wr]=8;var jM=new Zo(32);for(wr=0;wr<32;++wr)jM[wr]=5;var PV=S_(E_,9),MV=S_(jM,5),lT=function(s){for(var e=s[0],r=1;r<s.length;++r)s[r]>e&&(e=s[r]);return e},Ua=function(s,e,r){var l=e/8|0;return(s[l]|s[l+1]<<8)>>(7&e)&r},cT=function(s,e){var r=e/8|0;return(s[r]|s[r+1]<<8|s[r+2]<<16)>>(7&e)},RV=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ga=function(s,e,r){var l=new Error(e||RV[s]);if(l.code=s,Error.captureStackTrace&&Error.captureStackTrace(l,Ga),!r)throw l;return l},kV=new Zo(0),DV=typeof TextDecoder<"u"&&new TextDecoder;try{DV.decode(kV,{stream:!0})}catch{}const LV={gzip_data:"gzip"};class va extends Error{constructor(e){super(e),this.name="MRTError"}}const zV={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},VM={uint32:1,uint16:2,uint8:4},OV={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let uT;class t0{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const r=this.layers[e];if(!r)throw new va(`Layer '${e}' not found`);return r}getHeaderLength(e){const r=new Uint8Array(e),l=new DataView(e);if(r[0]!==13)throw new va("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const r=new Uint8Array(e),l=this.getHeaderLength(e);if(r.length<l)throw new va(`Expected header with length >= ${l} but got buffer of length ${r.length}`);const u=new uT(r.subarray(0,l)).readFields(pV,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new va(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const p of u.layers)this.layers[p.name]=new UM(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const r=[],l=this.getLayer(e.layerName);for(let u of e.blockIndices){const p=l.dataIndex[u],m=p.firstByte-e.firstByte,v=p.lastByte-e.firstByte;if(l._blocksInProgress.has(u))continue;const b={layerName:l.name,firstByte:m,lastByte:v,pixelFormat:l.pixelFormat,blockIndex:u,blockShape:[p.bands.length].concat(l.bandShape),buffer:l.buffer,codec:p.codec.codec,filters:p.filters.map(S=>S.filter)};l._blocksInProgress.add(u),r.push(b)}return new GM(r,()=>{r.forEach(u=>l._blocksInProgress.delete(u.blockIndex))},(u,p)=>{if(r.forEach(m=>l._blocksInProgress.delete(m.blockIndex)),u)throw u;p.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class UM{constructor({version:e,name:r,units:l,tileSize:u,pixelFormat:p,buffer:m,dataIndex:v},b){if(this.version=e,this.version!==1)throw new va(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=l,this.tileSize=u,this.buffer=m,this.pixelFormat=zV[p],this.dataIndex=v,this.bandShape=[u+2*m,u+2*m,VM[this.pixelFormat]],this._decodedBlocks=new Qx(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return VM[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(const[l,u]of this.dataIndex.entries()){for(const[p,m]of u.bands.entries())if(m===e)return{bandIndex:r+p,blockIndex:l,blockBandIndex:p};r+=u.bands.length}break;case"number":for(const[l,u]of this.dataIndex.entries()){if(e>=r&&e<r+u.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-r};r+=u.bands.length}break;default:throw new va(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let r=1/0,l=-1/0;const u=[],p=new Set;for(const m of e){const{blockIndex:v}=this.getBlockForBand(m);if(v<0)throw new va(`Invalid band: ${JSON.stringify(m)}`);const b=this.dataIndex[v];u.includes(v)||u.push(v),p.add(v),r=Math.min(r,b.firstByte),l=Math.max(l,b.lastByte)}if(p.size>this.cacheSize)throw new va(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:l,blockIndices:u}}hasBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){const{blockIndex:r,blockBandIndex:l}=this.getBlockForBand(e);if(r<0)throw new va(`Band not found: ${JSON.stringify(e)}`);const u=this._decodedBlocks.get(r.toString());if(!u)throw new va(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[r],m=this.bandShape.reduce((S,A)=>S*A,1),v=l*m,b=u.subarray(v,v+m);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}t0.setPbf=function(s){uT=s};class GM{constructor(e,r,l){this.tasks=e,this._onCancel=r,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}t0.performDecoding=function(s,e){const r=new Uint8Array(s);return Promise.all(e.tasks.map(l=>{const{layerName:u,firstByte:p,lastByte:m,pixelFormat:v,blockShape:b,blockIndex:S,filters:A,codec:C}=l,M=r.subarray(p,m+1),z=new Uint32Array(b[0]*b[1]*b[2]);let O;if(C!=="gzip_data")throw new va(`Unhandled codec: ${C}`);return O=function($,W){if(!globalThis.DecompressionStream&&W==="gzip_data")return Promise.resolve(((le=function(Ie){Ie[0]==31&&Ie[1]==139&&Ie[2]==8||Ga(6,"invalid gzip data");var Pe=Ie[3],Me=10;4&Pe&&(Me+=2+(Ie[10]|Ie[11]<<8));for(var Ye=(Pe>>3&1)+(Pe>>4&1);Ye>0;Ye-=!Ie[Me++]);return Me+(2&Pe)}(re=$))+8>re.length&&Ga(6,"invalid gzip data"),function(Ie,Pe,Me,Ye){var ze=Ie.length;if(!ze||Pe.f&&!Pe.l)return Me||new Zo(0);var Qe=!Me,lt=Qe||Pe.i!=2,tt=Pe.i;Qe&&(Me=new Zo(3*ze));var rt,dt,Xe=function(xi){var wi=Me.length;if(xi>wi){var mi=new Zo(Math.max(2*wi,xi));mi.set(Me),Me=mi}},ot=Pe.f||0,Ge=Pe.p||0,je=Pe.b||0,ft=Pe.l,ut=Pe.d,Gt=Pe.m,At=Pe.n,Lt=8*ze;do{if(!ft){ot=Ua(Ie,Ge,1);var yt=Ua(Ie,Ge+1,3);if(Ge+=3,!yt){var Vt=Ie[(he=4+((Ge+7)/8|0))-4]|Ie[he-3]<<8,an=he+Vt;if(an>ze){tt&&Ga(0);break}lt&&Xe(je+Vt),Me.set(Ie.subarray(he,an),je),Pe.b=je+=Vt,Pe.p=Ge=8*an,Pe.f=ot;continue}if(yt==1)ft=PV,ut=MV,Gt=9,At=5;else if(yt==2){var St=Ua(Ie,Ge,31)+257,Ft=Ua(Ie,Ge+10,15)+4,Yt=St+Ua(Ie,Ge+5,31)+1;Ge+=14;for(var dn=new Zo(Yt),En=new Zo(19),mn=0;mn<Ft;++mn)En[IV[mn]]=Ua(Ie,Ge+3*mn,7);Ge+=3*Ft;var kt=lT(En),fn=(1<<kt)-1,Fn=S_(En,kt);for(mn=0;mn<Yt;){var he,de=Fn[Ua(Ie,Ge,fn)];if(Ge+=15&de,(he=de>>4)<16)dn[mn++]=he;else{var Ue=0,Ke=0;for(he==16?(Ke=3+Ua(Ie,Ge,3),Ge+=2,Ue=dn[mn-1]):he==17?(Ke=3+Ua(Ie,Ge,7),Ge+=3):he==18&&(Ke=11+Ua(Ie,Ge,127),Ge+=7);Ke--;)dn[mn++]=Ue}}var Tt=dn.subarray(0,St),bt=dn.subarray(St);Gt=lT(Tt),At=lT(bt),ft=S_(Tt,Gt),ut=S_(bt,At)}else Ga(1);if(Ge>Lt){tt&&Ga(0);break}}lt&&Xe(je+131072);for(var Rt=(1<<Gt)-1,Wt=(1<<At)-1,In=Ge;;In=Ge){var An=(Ue=ft[cT(Ie,Ge)&Rt])>>4;if((Ge+=15&Ue)>Lt){tt&&Ga(0);break}if(Ue||Ga(2),An<256)Me[je++]=An;else{if(An==256){In=Ge,ft=null;break}var bn=An-254;An>264&&(bn=Ua(Ie,Ge,(1<<(wn=LM[mn=An-257]))-1)+NM[mn],Ge+=wn);var ni=ut[cT(Ie,Ge)&Wt],Pi=ni>>4;if(ni||Ga(3),Ge+=15&ni,bt=CV[Pi],Pi>3){var wn=zM[Pi];bt+=cT(Ie,Ge)&(1<<wn)-1,Ge+=wn}if(Ge>Lt){tt&&Ga(0);break}lt&&Xe(je+131072);var yi=je+bn;if(je<bt){var oi=0-bt,Gn=Math.min(bt,yi);for(oi+je<0&&Ga(3);je<Gn;++je)Me[je]=(void 0)[oi+je]}for(;je<yi;++je)Me[je]=Me[je-bt]}}Pe.l=ft,Pe.p=In,Pe.b=je,Pe.f=ot,ft&&(ot=1,Pe.m=Gt,Pe.d=ut,Pe.n=At)}while(!ot);return je!=Me.length&&Qe?(rt=Me,((dt=je)==null||dt>rt.length)&&(dt=rt.length),new Zo(rt.subarray(0,dt))):Me.subarray(0,je)}(re.subarray(le,-8),{i:2},new Zo(((q=re)[(ie=q.length)-4]|q[ie-3]<<8|q[ie-2]<<16|q[ie-1]<<24)>>>0))));var q,ie,re,le;const we=LV[W];if(!we)throw new Error(`Unhandled codec: ${W}`);const be=new globalThis.DecompressionStream(we);return new Response(new Blob([$]).stream().pipeThrough(be)).arrayBuffer().then(Ie=>new Uint8Array(Ie))}(M,C).then($=>(function(W,q){W.readFields(xV,q)}(new uT($),z),new OV[v](z.buffer))),O.then($=>{for(let W=A.length-1;W>=0;W--)switch(A[W]){case"delta_filter":bV($,b);break;case"zigzag_filter":TV($);break;case"bitshuffle_filter":SV($,v);break;default:throw new va(`Unhandled filter "${A[W]}"`)}return{layerName:u,blockIndex:S,data:$}}).catch($=>{throw $})}))},Pt(GM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Pt(t0,"MapboxRasterTile"),Pt(UM,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class $M{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const l=e[r];this._stringToNumber[l]=r,this._numberToString[r]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const FV=["id","tile","layer","source","sourceLayer","state"];class xp{constructor(e,r,l,u,p){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=l,this._y=u,this.properties=e.properties,this.id=p}clone(){const e=new xp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of FV)this[r]!==void 0&&(e[r]=this[r]);return e}}class HM{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new uc(vt,16,0),this.featureIndexArray=new nx,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,r,l,u,p,m=0,v=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,u,p,m);const S=this.grid;for(let A=0;A<r.length;A++){const C=r[A],M=[1/0,1/0,-1/0,-1/0];for(let z=0;z<C.length;z++){const O=C[z];M[0]=Math.min(M[0],O.x),M[1]=Math.min(M[1],O.y),M[2]=Math.max(M[2],O.x),M[3]=Math.max(M[3],O.y)}v!==0&&(M[0]-=v,M[1]-=v,M[2]+=v,M[3]+=v),M[0]<vt&&M[1]<vt&&M[2]>=0&&M[3]>=0&&S.insert(b,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new rn(new Px(this.rawTileData)).layers,this.sourceLayerCoder=new $M(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r){const{tilespaceGeometry:l,transform:u,tileTransform:p,pixelPosMatrix:m,availableImages:v,worldview:b}=r;this.loadVTLayers(),this.serializedLayersCache.clear();const S=l.bufferedTilespaceBounds,A=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(O,$,W,q)=>Ji(l.bufferedTilespaceGeometry,O,$,W,q));A.sort(NV);let C=null;u.elevation&&A.length>0&&(C=gp.create(u.elevation,this.tileID));const M={};let z;for(let O=0;O<A.length;O++){const $=A[O];if($===z)continue;z=$;const W=this.featureIndexArray.get($);let q=null;this.is3DTile?this.loadMatchingModelFeature(M,W,e,l,u,b):this.loadMatchingFeature(M,W,e,v,b,(ie,re,le,we=0)=>(q||(q=It(ie,this.tileID.canonical,p)),re.queryIntersectsFeature(l,ie,le,q,this.z,u,m,C,we)))}return M}loadMatchingFeature(e,r,l,u,p,m){const{featureIndex:v,bucketIndex:b,sourceLayerIndex:S,layoutVertexArrayOffset:A}=r,C=this.bucketLayerIDs[b],M=l.layers,z=Object.keys(M);if(z.length&&!On(z,C))return;const O=l.sourceCache,$=this.sourceLayerCoder.decode(S),W=this.vtLayers[$].feature(v),q=this.getId(W,$);for(let ie=0;ie<C.length;ie++){const re=C[ie];if(!M[re])continue;const{styleLayer:le,targets:we}=M[re];let be={};q!==void 0&&(be=O.getFeatureState(le.sourceLayer,q));const Ie=!m||m(W,le,be,A);if(!Ie)continue;const Pe=new xp(W,this.z,this.x,this.y,q);Pe.tile=this.tileID.canonical,Pe.state=be;let Me=this.serializedLayersCache.get(re);Me||(Me=le.serialize(),Me.id=re,this.serializedLayersCache.set(re,Me)),Pe.source=Me.source,Pe.sourceLayer=Me["source-layer"],Pe.layer=Object.assign({},Me),Pe.layer.paint=WM(Me.paint,le.paint,W,be,u),Pe.layer.layout=WM(Me.layout,le.layout,W,be,u);let Ye=!1;for(const ze of we){this.updateFeatureProperties(Pe,ze);const{filter:Qe}=ze;if(Qe){if(W.properties=Pe.properties,Qe.needGeometry){const lt=ht(W,!0);if(!Qe.filter(new _i(this.tileID.overscaledZ,{worldview:p}),lt,this.tileID.canonical))continue}else if(!Qe.filter(new _i(this.tileID.overscaledZ,{worldview:p}),W))continue}Ye=!0,ze.targetId&&this.addFeatureVariant(Pe,ze)}Ye&&this.appendToResult(e,re,v,Pe,Ie)}}loadMatchingModelFeature(e,r,l,u,p,m){const{featureIndex:v,bucketIndex:b}=r,S=this.bucketLayerIDs[b],A=l.layers,C=Object.keys(A);if(!C.length||On(C,S))for(let M=0;M<S.length;M++){const z=S[M],{styleLayer:O,targets:$}=A[z];if(O.type!=="model")continue;const W=u.tile,q=W.getBucket(O);if(!(q&&q instanceof Zx))continue;const ie=G4(q,v,u,p);if(!ie)continue;const{z:re,x:le,y:we}=W.tileID.canonical,{feature:be,intersectionZ:Ie,position:Pe}=ie;let Me={};be.id!==void 0&&(Me=l.sourceCache.getFeatureState(O.sourceLayer,be.id));const Ye=new xp({},re,le,we,be.id);Ye.tile=this.tileID.canonical,Ye.state=Me,Ye.properties=be.properties,Ye.geometry={type:"Point",coordinates:[Pe.lng,Pe.lat]};let ze=this.serializedLayersCache.get(z);ze||(ze=O.serialize(),ze.id=z,this.serializedLayersCache.set(z,ze)),Ye.source=ze.source,Ye.sourceLayer=ze["source-layer"],Ye.layer=Object.assign({},ze);let Qe=!1;for(const lt of $){this.updateFeatureProperties(Ye,lt);const{filter:tt}=lt;if(tt){if(be.properties=Ye.properties,tt.needGeometry){if(!tt.filter(new _i(this.tileID.overscaledZ,{worldview:m}),be,this.tileID.canonical))continue}else if(!tt.filter(new _i(this.tileID.overscaledZ,{worldview:m}),be))continue}Qe=!0,lt.targetId&&this.addFeatureVariant(Ye,lt)}Qe&&this.appendToResult(e,z,v,Ye,Ie)}}updateFeatureProperties(e,r,l){if(r.properties){const u={};for(const p in r.properties){const m=r.properties[p].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);m!=null&&(u[p]=m)}e.properties=u}}addFeatureVariant(e,r,l){const u={target:r.target,namespace:r.namespace,uniqueFeatureID:r.uniqueFeatureID};r.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[r.targetId]=e.variants[r.targetId]||[],e.variants[r.targetId].push(u)}appendToResult(e,r,l,u,p){let m=e[r];m===void 0&&(m=e[r]=[]),m.push({featureIndex:l,feature:u,intersectionZ:p})}lookupSymbolFeatures(e,r,l,u,p,m){const v={};this.loadVTLayers();for(const b of e)this.loadMatchingFeature(v,{bucketIndex:r,sourceLayerIndex:l,featureIndex:b,layoutVertexArrayOffset:0},u,p,m);return v}loadFeature(e){const{featureIndex:r,sourceLayerIndex:l}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(l),p=this.vtFeatures[u];if(p[r])return p[r];const m=this.vtLayers[u].feature(r);return p[r]=m,m}hasLayer(e){for(const r of this.bucketLayerIDs)for(const l of r)if(e===l)return!0;return!1}getId(e,r){let l=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[r];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const p=da(u);if(p.result!=="success"){const m=p.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void Dn(`Failed to create expression for promoteId: ${m}`)}this.promoteIdExpression=p.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new ka),l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[u];typeof l=="boolean"&&(l=Number(l))}return l}}function WM(s,e,r,l,u){return un(s,(p,m)=>{const v=e instanceof mc?e.get(m):null;return v&&v.evaluate?v.evaluate(r,l,void 0,u):v})}function NV(s,e){return e-s}Pt(HM,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const qM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class hT{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,l]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=l>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=qM[15&l];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new hT(v,m,p,e)}constructor(e,r=64,l=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=qM.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${l}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=r,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return dT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:v}=this,b=[0,p.length-1,0],S=[];for(;b.length;){const A=b.pop()||0,C=b.pop()||0,M=b.pop()||0;if(C-M<=v){for(let W=M;W<=C;W++){const q=m[2*W],ie=m[2*W+1];q>=e&&q<=l&&ie>=r&&ie<=u&&S.push(p[W])}continue}const z=M+C>>1,O=m[2*z],$=m[2*z+1];O>=e&&O<=l&&$>=r&&$<=u&&S.push(p[z]),(A===0?e<=O:r<=$)&&(b.push(M),b.push(z-1),b.push(1-A)),(A===0?l>=O:u>=$)&&(b.push(z+1),b.push(C),b.push(1-A))}return S}within(e,r,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:m}=this,v=[0,u.length-1,0],b=[],S=l*l;for(;v.length;){const A=v.pop()||0,C=v.pop()||0,M=v.pop()||0;if(C-M<=m){for(let W=M;W<=C;W++)XM(p[2*W],p[2*W+1],e,r)<=S&&b.push(u[W]);continue}const z=M+C>>1,O=p[2*z],$=p[2*z+1];XM(O,$,e,r)<=S&&b.push(u[z]),(A===0?e-l<=O:r-l<=$)&&(v.push(M),v.push(z-1),v.push(1-A)),(A===0?e+l>=O:r+l>=$)&&(v.push(z+1),v.push(C),v.push(1-A))}return b}}function dT(s,e,r,l,u,p){if(u-l<=r)return;const m=l+u>>1;ZM(s,e,m,l,u,p),dT(s,e,r,l,m-1,1-p),dT(s,e,r,m+1,u,1-p)}function ZM(s,e,r,l,u,p){for(;u>l;){if(u-l>600){const S=u-l+1,A=r-l+1,C=Math.log(S),M=.5*Math.exp(2*C/3),z=.5*Math.sqrt(C*M*(S-M)/S)*(A-S/2<0?-1:1);ZM(s,e,r,Math.max(l,Math.floor(r-A*M/S+z)),Math.min(u,Math.floor(r+(S-A)*M/S+z)),p)}const m=e[2*r+p];let v=l,b=u;for(I_(s,e,l,r),e[2*u+p]>m&&I_(s,e,l,u);v<b;){for(I_(s,e,v,b),v++,b--;e[2*v+p]<m;)v++;for(;e[2*b+p]>m;)b--}e[2*l+p]===m?I_(s,e,l,b):(b++,I_(s,e,b,u)),b<=r&&(l=b+1),r<=b&&(u=b-1)}}function I_(s,e,r,l){fT(s,r,l),fT(e,2*r,2*l),fT(e,2*r+1,2*l+1)}function fT(s,e,r){const l=s[e];s[e]=s[r],s[r]=l}function XM(s,e,r,l){const u=s-r,p=e-l;return u*u+p*p}o.$=Wm,o.A=Vo,o.B=fu,o.C=2,o.D=op,o.E=Ql,o.F=d_,o.G=xP,o.H=Hm,o.I=lo,o.J=Vf,o.K=nn,o.L=Rh,o.M=Mf,o.N=Pf,o.O=yg,o.P=ct,o.Q=xg,o.R=qd,o.S=gc,o.T=Ib,o.U=da,o.V=qx,o.W=wg,o.X=su,o.Y=ru,o.Z=_f,o._=vs,o.a=function(s){return as.API_CDN_URL_REGEX.test(s)},o.a$=_e,o.a0=Mh,o.a1=Vm,o.a2=Uf,o.a3=class extends qx{},o.a4=Rf,o.a5=_g,o.a6=Le,o.a7=function(s){const e=s.value;return e?Mh(e)?eT(e,!0)?[]:[new qx(s.key,e,`invalid url "${e}"`)]:[new qx(s.key,e,`string expected, "${nn(e)}" found`)]:[]},o.a8=jv,o.a9=Vi,o.aA=Se,o.aB=Y,o.aC=Nr,o.aD=h,o.aE=Cr,o.aF=ue,o.aG=Fe,o.aH=function(s,e){const r={};for(let l=0;l<e.length;l++){const u=e[l];u in s&&(r[u]=s[u])}return r},o.aI=J,o.aJ=ye,o.aK=class{constructor(s){this.entries={},this.scheduler=s}request(s,e,r,l){const u=this.entries[s]=this.entries[s]||{callbacks:[]};if(u.result){const[p,m]=u.result;return this.scheduler?this.scheduler.add(()=>{l(p,m)},e):l(p,m),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=r((p,m)=>{u.result=[p,m];for(const v of u.callbacks)this.scheduler?this.scheduler.add(()=>{v(p,m)},e):v(p,m);setTimeout(()=>delete this.entries[s],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(p=>p!==l),u.callbacks.length||(u.cancel(),delete this.entries[s]))}}},o.aL=function(s,e,r){const l=JSON.stringify(s.request);return s.data&&(this.deduped.entries[l]={result:[null,s.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},u=>{const p=Wc(s.request,(m,v,b,S)=>{m?u(m):v&&u(null,{vectorTile:r?void 0:new rn(new Px(v)),rawData:v,cacheControl:b,expires:S})});return()=>{p.cancel(),u()}},e)},o.aM=function(s){al++,al>Ra&&(s.getActor().send("enforceCacheSizeLimit",Fo),al=0)},o.aN=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log2(s)))},o.aO=bs,o.aP=XP,o.aQ=tM,o.aR=G,o.aS=ZP,o.aT=function(s,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let l=0;l<s.length;l++){const u=document.createElement("source");uv(s[l])||(r.crossOrigin="Anonymous"),u.src=s[l],r.appendChild(u)}return{cancel:()=>{}}},o.aU=o_,o.aV=function(s){return fetch(s).then(e=>e.arrayBuffer()).then(e=>EC(e,0,s))},o.aW=DC,o.aX=class{constructor(s,e,r,l){this.id=s,this.position=e!=null?new G(e[0],e[1]):new G(0,0),this.orientation=r??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new Qt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,e){if(Y(s.matrix,e,s.matrix),s.meshes)for(const r of s.meshes){const l=Qt.applyTransformFast(r.aabb,s.matrix);this.aabb.encapsulate(l)}if(s.children)for(const r of s.children)this._applyTransformations(r,s.matrix)}computeBoundsAndApplyParent(){const s=K([]);for(const e of this.nodes)this._applyTransformations(e,s)}computeModelMatrix(s,e,r,l,u,p,m=!1){RC(this.matrix,this,s.transform,this.position,e,r,l,u,p,m)}upload(s){if(!this.uploaded){for(const e of this.nodes)Pb(e,s);for(const e of this.nodes)Cx(e);this.uploaded=!0}}destroy(){for(const s of this.nodes)Mb(s)}},o.aY=tn,o.aZ=m_,o.a_=ve,o.aa=pt,o.ab=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return ur(s.expression.evaluate(e))}interpolate(s,e,r){return{x:Kt(s.x,e.x,r),y:Kt(s.y,e.y,r),z:Kt(s.z,e.z,r),azimuthal:Kt(s.azimuthal,e.azimuthal,r),polar:Kt(s.polar,e.polar,r)}}},o.ac=_i,o.ad=_l,o.ae=We,o.af=ui,o.ag=ln,o.ah=$e,o.ai=mc,o.aj=bu,o.ak=Kt,o.al=vt,o.am=Gm,o.an=De,o.ao=Jn,o.ap=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return function([r,l]){const u=ur([1,r,l]);return{x:u.x,y:u.y,z:u.z}}(s.expression.evaluate(e))}interpolate(s,e,r){return{x:Kt(s.x,e.x,r),y:Kt(s.y,e.y,r),z:Kt(s.z,e.z,r)}}},o.aq=function(s,e,r=0,l=!0){const u=new ct(r,r),p=s.sub(u),m=e.add(u),v=[p,new ct(m.x,p.y),m,new ct(p.x,m.y)];return l&&v.push(p.clone()),v},o.ar=function(s,e){const r=[];for(let l=0;l<s.length;l++){const u=ke(l-1,-1,s.length-1),p=ke(l+1,-1,s.length-1),m=s[l],v=s[p],b=s[u].sub(m).unit(),S=v.sub(m).unit(),A=S.angleWithSep(b.x,b.y),C=b.add(S).unit().mult(-1*e/Math.sin(A/2));r.push(m.add(C))}return r},o.as=LP,o.at=Ji,o.au=function(s,e,r=0){return Ht(((e.x-r)*s.scale-s.x)*vt,(e.y*s.scale-s.y)*vt,me(e.z,e.y))},o.av=ii,o.aw=Vn,o.ax=Un,o.ay=HC,o.az=function(s){let e=1/0,r=1/0,l=-1/0,u=-1/0;for(const p of s)e=Math.min(e,p.x),r=Math.min(r,p.y),l=Math.max(l,p.x),u=Math.max(u,p.y);return{min:new ct(e,r),max:new ct(l,u)}},o.b=function(s){return as.API_FONTS_REGEX.test(s)},o.b$=pb,o.b0=yc,o.b1=xr,o.b2=st,o.b3=jg,o.b4=Gx,o.b5=function(){fa.isLoading()||fa.isLoaded()||jf()!=="deferred"||hc()},o.b6=Uh,o.b7=ht,o.b8=xp,o.b9=Kn,o.bA=K,o.bB=et,o.bC=ce,o.bD=function(s,e){const{x:r,y:l}=s.point,u=fA(r,l,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Y(u,u,tb(Cl(e)))},o.bE=N,o.bF=ji,o.bG=function(s,e){var r=e[0]-s[0],l=e[1]-s[1],u=e[2]-s[2];return Math.sqrt(r*r+l*l+u*u)},o.bH=Xn,o.bI=ci,o.bJ=Wn,o.bK=h_,o.bL=_o,o.bM=Vb,o.bN=function(s,e,r,l,u){const p=5*e+2;s.float32[p+0]=r,s.float32[p+1]=l,s.float32[p+2]=u},o.bO=Ux,o.bP=Cs,o.bQ=zo,o.bR=aa,o.bS=Ns,o.bT=ke,o.bU=function(s,e,r,l){var u=new L(4);return u[0]=s,u[1]=e,u[2]=r,u[3]=l,u},o.bV=wx,o.bW=po,o.bX=jr,o.bY=$A,o.bZ=nM,o.b_=ZA,o.ba=Lb,o.bb=hb,o.bc=It,o.bd=bl,o.be=Yf,o.bf=aA,o.bg=Oi,o.bh=rp,o.bi=Jb,o.bj=function(s,e){const r=bu(e.zoom);if(r===0)return Cl(s);const l=ux(s),u=eb(l),p=ue(l.getWest())*e.worldSize,m=ue(l.getEast())*e.worldSize,v=ye(l.getNorth())*e.worldSize,b=ye(l.getSouth())*e.worldSize,S=[p,v,0],A=[m,v,0],C=[p,b,0],M=[m,b,0],z=se([],e.globeMatrix);return ui(S,S,z),ui(A,A,z),ui(C,C,z),ui(M,M,z),u[0]=bc(u[0],C,r),u[1]=bc(u[1],M,r),u[2]=bc(u[2],A,r),u[3]=bc(u[3],S,r),Qt.fromPoints(u)},o.bk=dx,o.bl=se,o.bm=$g,o.bn=bc,o.bo=_c,o.bp=d5,o.bq=nt,o.br=Q,o.bs=t0,o.bt=Px,o.bu=Wc,o.bv=function(s,e){const r=[];for(const l in s)l in e||r.push(l);return r},o.bw=He,o.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.by=Oo,o.bz=function(s){var e=new L(16);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],e},o.c=cv,o.c$=function(s){return s*s*s*s*s},o.c0=jb,o.c1=AP,o.c2=Hb,o.c3=hT,o.c4=on,o.c5=es,o.c6=to,o.c7=function(s,e,r){r*=.5;var l=e[0],u=e[1],p=e[2],m=e[3],v=Math.sin(r),b=Math.cos(r);return s[0]=l*b+u*v,s[1]=u*b-l*v,s[2]=p*b+m*v,s[3]=m*b-p*v,s},o.c8=ra,o.c9=Wi,o.cA=xn,o.cB=AC,o.cC=Ba,o.cD=uA,o.cE=function(s,e,r,l,u,p,m,v,b){if(b.name==="globe")return uA(s,e,new Ba(r,l,u),!1);const S=m_({z:r,x:l,y:u},b);return new Qt([(p+S.x/S.scale)*e,e*(S.y/S.scale),m],[(p+S.x2/S.scale)*e,e*(S.y2/S.scale),v])},o.cF=function(s,e,r){return s[0]=Math.min(e[0],r[0]),s[1]=Math.min(e[1],r[1]),s[2]=Math.min(e[2],r[2]),s[3]=Math.min(e[3],r[3]),s},o.cG=function(s,e,r){return s[0]=Math.max(e[0],r[0]),s[1]=Math.max(e[1],r[1]),s[2]=Math.max(e[2],r[2]),s[3]=Math.max(e[3],r[3]),s},o.cH=function(s){const e=Math.round((s+45+360)%360/90)%4;return te[e]},o.cI=xe,o.cJ=lr,o.cK=y,o.cL=function(s){const e=K(new Float64Array(16));Y(e,s.pixelMatrix,s.globeMatrix);const r=[0,P,0],l=[0,R,0];return ui(r,r,e),ui(l,l,e),[r[0]>0&&r[0]<=s.width&&r[1]>0&&r[1]<=s.height&&!ib(s,new G(s.center.lat,90)),l[0]>0&&l[0]<=s.width&&l[1]>0&&l[1]<=s.height&&!ib(s,new G(s.center.lat,-90))]},o.cM=function(s,e){const{scale:r}=s.tileTransform,l=r*vt/(s.tileSize*Math.pow(2,e.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return function(u,p,m){var v=p[1],b=p[2],S=p[3],A=m[0],C=m[1];return u[0]=p[0]*A,u[1]=v*A,u[2]=b*C,u[3]=S*C,u}(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},o.cN=Ix,o.cO=wt,o.cP=IC,o.cQ=function(s){const e=IC(s,!0);return N([],[e[0],e[1],e[4],e[5]])},o.cR=ae,o.cS=Zn,o.cT=Te,o.cU=function(s){const{x:e,y:r}=s.point,{lng:l,lat:u}=s._center;return fA(e,r,s.worldSize,l,u)},o.cV=Nt,o.cW=X,o.cX=ip,o.cY=ts,o.cZ=g,o.c_=function(s,e,r){let l=0;for(let u=0;u<2;++u)s[u]>0&&(l+=(s[u]-0)*(s[u]-0)),e[u]<0&&(l+=(0-e[u])*(0-e[u]));return l},o.ca=function(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s[3]=e[3],s},o.cb=Dt,o.cc=function(s,e,r,l,u){var p=1/Math.tan(e/2);if(s[0]=p/r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=p,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,u!=null&&u!==1/0){var m=1/(l-u);s[10]=(u+l)*m,s[14]=2*u*l*m}else s[10]=-1,s[14]=-2*l;return s},o.cd=function(s,e,r,l,u,p,m){var v=1/(e-r),b=1/(l-u),S=1/(p-m);return s[0]=-2*v,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*b,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*S,s[11]=0,s[12]=(e+r)*v,s[13]=(u+l)*b,s[14]=(m+p)*S,s[15]=1,s},o.ce=ge,o.cf=function(s,e,r){s[4*e+0]=r[0],s[4*e+1]=r[1],s[4*e+2]=r[2],s[4*e+3]=r[3]},o.cg=Kh,o.ch=Yh,o.ci=Yi,o.cj=ma,o.ck=Qh,o.cl=BP,o.cm=function(){var s=new L(4);return L!=Float32Array&&(s[1]=0,s[2]=0),s[0]=1,s[3]=1,s},o.cn=function(s,e,r){var l=e[0],u=e[1],p=e[2],m=e[3],v=Math.sin(r),b=Math.cos(r);return s[0]=l*b+p*v,s[1]=u*b+m*v,s[2]=l*-v+p*b,s[3]=u*-v+m*b,s},o.co=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&s[3]===e[3]},o.cp=Li,o.cq=function(s){var e=s[0],r=s[1],l=s[2],u=s[3];return Math.sqrt(e*e+r*r+l*l+u*u)},o.cr=no,o.cs=Sn,o.ct=np,o.cu=3,o.cv=2,o.cw=7,o.cx=6,o.cy=rr,o.cz=xt,o.d=function(s){return as.API_TILEJSON_REGEX.test(s)},o.d$=XC,o.d0=oe,o.d1=45,o.d2=Jh,o.d3=function(s,e,r){const l=Math.sqrt(s*s+e*e+r*r),u=l>0?Math.acos(r/l)*Vc:0;let p=s!==0||e!==0?Math.atan2(-e,-s)*Vc+90:0;return p<0&&(p+=360),[l,p,u]},o.d4=Ht,o.d5=ur,o.d6=Oe,o.d7=pn,o.d8=Qt,o.d9=Rn,o.dA=function(s,e,r){const l=bu(r.zoom),u=s.style.map._antialias,p=s.terrain&&s.terrain.exaggeration()>0;return l===0&&!u&&!p},o.dB=function(s){const e=s.pixelsPerMeter,r=e/ge(1,s.center.lat),l=K(new Float64Array(16));return Q(l,l,[s.point.x,s.point.y,0]),ae(l,l,[r,r,e]),Float32Array.from(l)},o.dC=ux,o.dD=function(s){const e=xe-5;s=Se(s,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(De(s))),3);return Math.round(r*(I.length-1))},o.dE=function(s,e,r,l){const u=e.getNorth(),p=e.getSouth(),m=e.getWest(),v=e.getEast(),b=1<<s.z,S=v-m,A=u-p,C=S/T,M=-A/I[r],z=[0,C,0,M,0,0,u,m,0];if(s.z>0){const O=180/l;ne(z,z,[O/S+1,0,0,0,O/A+1,0,-.5*O/C,.5*O/M,1])}return z[2]=b,z[5]=s.x,z[8]=s.y,z},o.dF=Cl,o.dG=function(s,e,r){const l=K(new Float64Array(16)),u=(e/(1<<s)-.5)*Math.PI*2;return Be(l,r.globeMatrix,u),Float32Array.from(l)},o.dH=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const r=e.getSource().maxzoom,l=1<<r,u=Math.floor(s.x),p=Math.floor((s.x-u)*l),m=Math.floor(s.y*l),v=this.findDEMTileFor(new bs(r,u,r,p,m));return!(!v||!v.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||s.y<0||s.y>1)return e;const u=l.getSource().maxzoom,p=1<<u,m=Math.floor(s.x),v=s.x-m,b=new bs(u,m,u,Math.floor(v*p),Math.floor(s.y*p)),S=this.findDEMTileFor(b);if(!S||!S.dem)return e;const A=S.dem,C=1<<S.tileID.canonical.z,M=(v*C-S.tileID.canonical.x)*A.dim,z=(s.y*C-S.tileID.canonical.y)*A.dim,O=Math.floor(M),$=Math.floor(z);return(r?this.exaggeration():1)*Kt(Kt(A.get(O,$),A.get(O,$+1),z-$),Kt(A.get(O+1,$),A.get(O+1,$+1),z-$),M-O)}getAtTileOffset(s,e,r){const l=1<<s.canonical.z;return this.getAtPointOrZero(new We(s.wrap+(s.canonical.x+e/vt)/l,(s.canonical.y+r/vt)/l))}getAtTileOffsetFunc(s,e,r,l){return u=>{const p=this.getAtTileOffset(s,u.x,u.y),m=l.upVector(s.canonical,u.x,u.y);return on(m,m,p*l.upVectorScale(s.canonical,e,r).metersToTile),m}}getForTilePoints(s,e,r,l){if(this.isUsingMockSource())return!1;const u=gp.create(this,s,l);return!!u&&(e.forEach(p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],r)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const r=e.dem.tree,l=e.tileID,u=1<<s.canonical.z-l.canonical.z;let p=s.canonical.x/u-l.canonical.x,m=s.canonical.y/u-l.canonical.y,v=0;for(let b=0;b<s.canonical.z-l.canonical.z&&!r.leaves[v];b++){p*=2,m*=2;const S=2*Math.floor(m)+Math.floor(p);v=r.childOffsets[v]+S,p%=1,m%=1}return{min:this.exaggeration()*r.minimums[v],max:this.exaggeration()*r.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const s=this.visibleDemTiles;if(s.length===0)return null;let e=!1,r=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const u of s){const p=this.getMinMaxForTile(u.tileID);p&&(r=Math.min(r,p.min),l=Math.max(l,p.max),e=!0)}return e?{min:r,max:l}:null}},o.dI=IA,o.dJ=cx,o.dK=function(s,e){return[Math.pow(s[0],2.2)*e,Math.pow(s[1],2.2)*e,Math.pow(s[2],2.2)*e]},o.dL=V,o.dM=function(s,e){var r=Math.sin(e),l=Math.cos(e);return s[0]=l,s[1]=r,s[2]=0,s[3]=-r,s[4]=l,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},o.dN=Bi,o.dO=dA,o.dP=gs,o.dQ=ro,o.dR=256,o.dS=function(s,e){const r=[0,0,0];return ui(r,r,dx(Cl(e.canonical))),ui(r,r,s),r},o.dT=s=>({u_matrix:new Qh(s),u_texsize:new ma(s),u_pixels_to_tile_units:new tp(s),u_device_pixel_ratio:new Yi(s),u_width_scale:new Yi(s),u_floor_width_scale:new Yi(s),u_image:new Kh(s),u_units_to_pixels:new ma(s),u_tile_units_to_pixels:new Yi(s),u_alpha_discard_threshold:new Yi(s),u_trim_offset:new ma(s),u_trim_fade_range:new ma(s),u_trim_color:new Jh(s),u_emissive_strength:new Yi(s),u_zbias_factor:new Yi(s),u_tile_to_meter:new Yi(s),u_ground_shadow_factor:new Yh(s),u_pattern_transition:new Yi(s)}),o.dU=s=>({u_matrix:new Qh(s),u_pixels_to_tile_units:new tp(s),u_device_pixel_ratio:new Yi(s),u_width_scale:new Yi(s),u_floor_width_scale:new Yi(s),u_units_to_pixels:new ma(s),u_dash_image:new Kh(s),u_gradient_image:new Kh(s),u_image_height:new Yi(s),u_texsize:new ma(s),u_tile_units_to_pixels:new Yi(s),u_alpha_discard_threshold:new Yi(s),u_trim_offset:new ma(s),u_trim_fade_range:new ma(s),u_trim_color:new Jh(s),u_emissive_strength:new Yi(s),u_zbias_factor:new Yi(s),u_tile_to_meter:new Yi(s),u_ground_shadow_factor:new Yh(s)}),o.dV=s=>({u_camera_to_center_distance:new Yi(s),u_extrude_scale:new tp(s),u_device_pixel_ratio:new Yi(s),u_matrix:new Qh(s),u_inv_rot_matrix:new Qh(s),u_merc_center:new ma(s),u_tile_id:new Yh(s),u_zoom_transition:new Yi(s),u_up_dir:new Yh(s),u_emissive_strength:new Yi(s)}),o.dW=zg,o.dX=Yj,o.dY=class{constructor(s,e,r,l){this.context=s,this.format=l,this.size=r,this.texture=s.gl.createTexture();const[u,p,m]=this.size,{gl:v}=s;v.bindTexture(v.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,u,p,m,0,Sb(this.format),Eb(this.format),e.data)}bind(s,e){const{context:r}=this,{gl:l}=r;l.bindTexture(l.TEXTURE_3D,this.texture),s!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,s),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,s),this.minFilter=s),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},o.dZ=gA,o.d_=(s,e,r,l,u,p)=>{const m=s.transform,v=m.projection.name==="globe";let b;if(p.paint.get("circle-pitch-alignment")==="map")if(v){const A=dA(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;b=Float32Array.from([A,0,0,A])}else b=m.calculatePixelsToTileUnitsMatrix(r);else b=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(m.projection),u_matrix:s.translatePosMatrix(e.projMatrix,r,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ca.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:_5,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(v){S.u_inv_rot_matrix=l,S.u_merc_center=u,S.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],S.u_zoom_transition=bu(m.zoom);const A=u[0]*vt,C=u[1]*vt;S.u_up_dir=m.projection.upVector(new Ba(0,0,0),A,C)}return S},o.da=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},o.db=eT,o.dc=function(s,e){return s.readFields(W4,{icons:[]},e)},o.dd=bx,o.de=fp,o.df=Gb,o.dg=Zd,o.dh=Bv,o.di=Hd,o.dj=Yd,o.dk=Mn,o.dl=function(s){const e=s.indexOf(Gh);return e>=0?s.slice(0,e):s},o.dm=function(s){return s.indexOf(Gh)>=0},o.dn=function(s){const e=s.lastIndexOf(Gh);return e>=0?s.slice(e+1):""},o.dp=function(s){const e=[],r=s.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},o.dq=function(s,e,r,l){return s.type==="custom"?new j4(s,e):new $4[s.type](s,e,r,l)},o.dr=kn,o.ds=function(s){const e=s.indexOf(Gh);return e>=0?s.slice(e+1):""},o.dt=class extends xp{constructor(s,e){super(s._vectorTileFeature,s._z,s._x,s._y,s.id),s.state&&(this.state=Object.assign({},s.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=s.source,this.sourceLayer=s.sourceLayer,this.layer=s.layer)}toJSON(){const s=super.toJSON();return s.target=this.target,s.namespace=this.namespace,s}},o.du=Ig,o.dv=Nn,o.dw=function(s){return s({pluginStatus:xs,pluginURL:xl}),Ig.on("pluginStateChange",s),s},o.dx=ox,o.dy=class extends pa{constructor(s){super(s),this.current=Yw}set(s,e,r){if(this.fetchUniformLocation(s,e)){for(let l=0;l<9;l++)if(r[l]!==this.current[l]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},o.dz=pe,o.e=as,o.e$=function(){const s=i_;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(vb),i_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.e0=Ps,o.e1=(s,e,r,l,u,p,m,v,b,S)=>{const A=s.transform,C=A.pitch<15?WC(.07,.7,Se((14-A.zoom)/5,0,1)):.07,M=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:ZC(s,e,r,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:A.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:p,u_floor_width_scale:m,u_image:0,u_tile_units_to_pixels:qC(e,A),u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:C,u_tile_to_meter:Oe(e.tileID.canonical,0),u_ground_shadow_factor:b,u_pattern_transition:S}},o.e2=(s,e,r,l,u,p,m,v,b,S)=>{const A=s.transform,C=A.calculatePixelsToTileUnitsMatrix(e),M=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none",z=A.pitch<15?WC(.07,.7,Se((14-A.zoom)/5,0,1)):.07;return{u_matrix:ZC(s,e,r,l),u_pixels_to_tile_units:C,u_device_pixel_ratio:p,u_width_scale:m,u_floor_width_scale:v,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:KC(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:qC(e,s.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:z,u_tile_to_meter:Oe(e.tileID.canonical,0),u_ground_shadow_factor:S}},o.e3=$t,o.e4=Hg,o.e5=me,o.e6=u5,o.e7=xx,o.e8=oC,o.e9=Su,o.eA=dr,o.eB=yu,o.eC=function(s,e,r,l,u,p,m,v,b,S,A,C,M,z,O,$){var W=new L(16);return W[0]=s,W[1]=e,W[2]=r,W[3]=l,W[4]=u,W[5]=p,W[6]=m,W[7]=v,W[8]=b,W[9]=S,W[10]=A,W[11]=C,W[12]=M,W[13]=z,W[14]=O,W[15]=$,W},o.eD=j,o.eE=Wh,o.eF=Xf,o.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ct(1/0,1/0),max:new ct(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,e=!1){const r=WA(new ct(0,0),new ct(vt,vt),s),l=[];if(e&&!db(r,this._globalClipBounds))return l;for(const u of this._activeRegions){if(u.hiddenByOverlap||!db(r,u))continue;const p=H5(u.min,u.max,s);l.push({min:p.min,max:p.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return l}setSources(s){this._setSources(s.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const l of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(l).buckets[e.layer];u&&u.updateFootprints(l.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(s){const e=s.getFootprints();if(e.length===0)return;const r=s.getOrder(),l=s.getClipMask(),u=s.getClipScope();for(const p of e){if(!p.footprint)continue;const m=WA(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:r,clipMask:l,clipScope:u})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||_x(e.min,r.min)||_x(e.max,r.max)||e.order-r.order||e.clipMask-r.clipMask||function(l,u){const p=(m,v)=>m+v;return l.length-u.length||l.reduce(p,"").localeCompare(u.reduce(p,""))}(e.clipScope,r.clipScope));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let e=0;for(;!s&&e!==this._activeRegions.length;){const r=this._activeRegions[e],l=this._prevRegions[e];s=r.priority!==l.priority||!HA(r,l)||r.order!==l.order||r.clipMask!==l.clipMask||!Oo(r.clipScope,l.clipScope),++e}}if(s){++this._updateTime;for(const r of this._activeRegions)r.order!==Yg&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const e=r=>{const l=this._activeRegions;if(r>=l.length)return r;const u=l[r].priority;for(;r<l.length&&l[r].priority===u;)++r;return r};if(this._sourceIds.length>1){let r=0,l=e(r);for(;r!==l;){let u=r;const p=r;for(;u!==l;){const m=this._activeRegions[u];m.hiddenByOverlap=!1;for(let v=0;v<p;v++){const b=this._activeRegions[v];if(!b.hiddenByOverlap&&m.order===Yg&&db(m,b)&&(m.hiddenByOverlap=qA(m.footprint,m.tileId,b.footprint,b.tileId),m.hiddenByOverlap))break}++u}r=l,l=e(r)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=s.length-1;e>=0;e--)this._addSource(s[e]);this._computeReplacement()}},o.eH=Yg,o.eI=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,e){const r=new bl,l=new xr,u=[],p=s+1+2,m=e[0]+1,v=e[0]+1+(1+e.length),b=(S,A,C)=>{let M=S===p-1?S-2:S===0?S:S-1;return M+=C?24575:0,[M,A]};for(let S=0;S<p;++S)r.emplaceBack(...b(S,0,!0));for(let S=0;S<m;++S)for(let A=0;A<p;++A)r.emplaceBack(...b(A,S,(A===0||A===p-1)&&!0));for(let S=0;S<e.length;++S){const A=e[S];for(let C=0;C<p;++C)r.emplaceBack(...b(C,A,!0))}for(let S=0;S<e.length;++S){const A=l.length,C=e[S]+1+2,M=new xr;for(let $=0;$<C-1;$++){const W=$===C-2,q=W?p*(v-e.length+S-$):p;for(let ie=0;ie<p-1;ie++){const re=$*p+ie;$===0||W||ie===0||ie===p-2?(M.emplaceBack(re+1,re,re+q),M.emplaceBack(re+q,re+q+1,re+1)):(l.emplaceBack(re+1,re,re+q),l.emplaceBack(re+q,re+q+1,re+1))}}const z=Oi.simpleSegment(0,A,r.length,l.length-A);for(let $=0;$<M.uint16.length;$+=3)l.emplaceBack(M.uint16[$],M.uint16[$+1],M.uint16[$+2]);const O=Oi.simpleSegment(0,A,r.length,l.length-A);u.push({withoutSkirts:z,withSkirts:O})}return{vertices:r,indices:l,segments:u}}_createGrid(s){const e=this._fillGridMeshWithLods(T,I);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,aA.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new xr;for(let m=0;m<=T;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const r=new vc,l=new vc,u=new vc,p=new vc;this._poleSegments=[];for(let m=0,v=0;m<g;m++){const b=360/(1<<m);r.emplaceBack(0,-h,0,.5,0),l.emplaceBack(0,-h,0,.5,1),u.emplaceBack(0,-h,0,.5,.5),p.emplaceBack(0,-h,0,.5,.5);for(let S=0;S<=T;S++){let A=S/T,C=0;const M=Kt(0,b,A),[z,O,$]=F(m5,g5,M,h);r.emplaceBack(z,O,$,A,C),l.emplaceBack(z,O,$,A,1-C);const W=De(M);A=.5+.5*Math.sin(W),C=.5+.5*Math.cos(W),u.emplaceBack(z,O,$,A,C),p.emplaceBack(z,O,$,A,1-C)}this._poleSegments.push(Oi.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(r,lx,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(l,lx,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(u,lx,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(p,lx,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},o.eJ=GA,o.eK=Ae,o.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eM=Ee,o.eN=qe,o.eO=function(s,e,r){return s[0]=e[0]/r[0],s[1]=e[1]/r[1],s[2]=e[2]/r[2],s},o.eP=fs,o.eQ=D,o.eR=ir,o.eS=cn,o.eT=function([s,e,r]){const l=Math.hypot(s,e,r),u=Math.atan2(s,r),p=.5*Math.PI-Math.acos(-e/l);return new G(X(u),X(p))},o.eU=ps,o.eV=Ab,o.eW=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!function(r){if(Hi==null){const l=r.navigator?r.navigator.userAgent:null;Hi=!!r.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Hi}(s)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.eX=function(s,e){Fo=s,Ra=e},o.eY=ib,o.eZ=pA,o.e_=function(s){const e=[0,0,0],r=K(new Float64Array(16));return Y(r,s.pixelMatrix,s.globeMatrix),ui(e,e,r),new ct(e[0],e[1])},o.ea=450,o.eb=7,o.ec=Re,o.ed=function(s,e){if(s===e){var r=e[1],l=e[2],u=e[3],p=e[6],m=e[7],v=e[11];s[1]=e[4],s[2]=e[8],s[3]=e[12],s[4]=r,s[6]=e[9],s[7]=e[13],s[8]=l,s[9]=p,s[11]=e[14],s[12]=u,s[13]=m,s[14]=v}else s[0]=e[0],s[1]=e[4],s[2]=e[8],s[3]=e[12],s[4]=e[1],s[5]=e[5],s[6]=e[9],s[7]=e[13],s[8]=e[2],s[9]=e[6],s[10]=e[10],s[11]=e[14],s[12]=e[3],s[13]=e[7],s[14]=e[11],s[15]=e[15];return s},o.ee=B4,o.ef=zn,o.eg=xu,o.eh=256,o.ei=tb,o.ej=Rs,o.ek=Be,o.el=function(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[4],s[4]=e[5],s[5]=e[6],s[6]=e[8],s[7]=e[9],s[8]=e[10],s},o.em=vc,o.en=Ng,o.eo=fg,o.ep=function(s,e,r,l,u){return Se((s-e)/(r-e)*(u-l)+l,l,u)},o.eq=sa,o.er=function(s,e){var r=e[0],l=e[1],u=e[2],p=e[3],m=e[4],v=e[5],b=e[6],S=e[7],A=e[8],C=A*m-v*S,M=-A*p+v*b,z=S*p-m*b,O=r*C+l*M+u*z;return O?(s[0]=C*(O=1/O),s[1]=(-A*l+u*S)*O,s[2]=(v*l-u*m)*O,s[3]=M*O,s[4]=(A*r-u*b)*O,s[5]=(-v*r+u*p)*O,s[6]=z*O,s[7]=(-S*r+l*b)*O,s[8]=(m*r-l*p)*O,s):null},o.es=2,o.et=Qr,o.eu=Cb,o.ev=[1,1,1],o.ew=gp,o.ex=Qs,o.ey=function(s,e,r,l){var u=e[0],p=e[1],m=e[2],v=e[3];return s[0]=u+l*(r[0]-u),s[1]=p+l*(r[1]-p),s[2]=m+l*(r[2]-m),s[3]=v+l*(r[3]-v),s},o.ez=up,o.f=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(e,r)=>String.fromCharCode(+("0x"+r))))},o.f0=function(){bx().acquire(vb)},o.f1=jf,o.f2=function(s,e,r=!1){if(xs===js.deferred||xs===js.loading||xs===js.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");xl=ca.resolveURL(s),xs=js.deferred,Sg=e,Eg(),r||hc()},o.f3=function(s){ap=ca.resolveURL(s),lp||(lp=new op(bx(),new Ql)),lp.broadcast("setMeshoptUrl",ap)},o.f4=vC,o.f5=function(s){wb=ca.resolveURL(s),lp||(lp=new op(bx(),new Ql)),lp.broadcast("setDracoUrl",wb)},o.f6=yC,o.f7=n_,o.f8=function(s){const e=Om();if(!e)return;const r=e.delete(so);s&&r.then(()=>s()).catch(s)},o.f9=id,o.fA=function(s){xh(),_s!=null&&_s.then(e=>{e.keys().then(r=>{for(let l=0;l<r.length-s;l++)e.delete(r[l]).catch(u=>Dn(u.message))}).catch(r=>Dn(r.message))}).catch(e=>Dn(e.message))},o.fa=Pt,o.fb=Tu,o.fc=Va,o.fd=$M,o.fe=HM,o.ff=UC,o.fg=vn,o.fh="hd_road_elevation",o.fi=ki,o.fj=un,o.fk=Tc,o.fl=Ub,o.fm=od,o.fn=function(s,e,r,l,u,p,m,v=1,b,S,A){s.createArrays(),s.tilePixelRatio=vt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const C=s.layers[0].layout,M=s.layers[0]._unevaluatedLayout._values,z={};z.scaleFactor=v,z.textSizeScaleRange=C.get("text-size-scale-range"),z.iconSizeScaleRange=C.get("icon-size-scale-range");const[O,$]=z.textSizeScaleRange,[W,q]=z.iconSizeScaleRange;z.textScaleFactor=Se(z.scaleFactor,O,$),z.iconScaleFactor=Se(z.scaleFactor,W,q);const ie=M["text-size"],re=M["icon-size"];if(s.textSizeData.kind==="composite"){const{minZoom:Me,maxZoom:Ye}=s.textSizeData;z.compositeTextSizes=[ie.possiblyEvaluate(new _i(Me,{worldview:A}),p),ie.possiblyEvaluate(new _i(Ye,{worldview:A}),p)]}if(s.iconSizeData.kind==="composite"){const{minZoom:Me,maxZoom:Ye}=s.iconSizeData;z.compositeIconSizes=[re.possiblyEvaluate(new _i(Me,{worldview:A}),p),re.possiblyEvaluate(new _i(Ye,{worldview:A}),p)]}z.layoutTextSize=ie.possiblyEvaluate(new _i(m+1,{worldview:A}),p),z.layoutIconSize=re.possiblyEvaluate(new _i(m+1,{worldview:A}),p),z.textMaxSize=ie.possiblyEvaluate(new _i(18,{worldview:A}),p);const le=C.get("symbol-placement"),we=C.get("text-rotation-alignment")==="map"&&le!=="point",be=C.get("text-size");let Ie=!1;const Pe=[];for(const Me of s.features){const Ye=C.get("text-font").evaluate(Me,{},p).join(","),ze=be.evaluate(Me,{},p)*z.textScaleFactor,Qe=z.layoutTextSize.evaluate(Me,{},p)*z.textScaleFactor,lt=z.layoutIconSize.evaluate(Me,{},p)*z.iconScaleFactor,tt={horizontal:{},vertical:void 0},rt=Me.text;let dt,Xe=[0,0];if(rt){const Ft=rt.toString(),Yt=C.get("text-letter-spacing").evaluate(Me,{},p)*jr,dn=C.get("text-line-height").evaluate(Me,{},p)*jr,En=Fv(Ft)?Yt:0,mn=C.get("text-anchor").evaluate(Me,{},p),kt=C.get("text-variable-anchor");if(!kt){const Ue=C.get("text-radial-offset").evaluate(Me,{},p);if(Ue)Xe=AP(mn,[Ue*jr,$b]);else{const Ke=C.get("text-offset").evaluate(Me,{},p);Xe=[Ke[0]*jr,Ke[1]*jr]}}let fn=we?"center":C.get("text-justify").evaluate(Me,{},p);const Fn=le==="point",he=Fn?C.get("text-max-width").evaluate(Me,{},p)*jr:1/0,de=Ue=>{s.allowVerticalPlacement&&Tg(Ft)&&(tt.vertical=Bb(rt,e,r,u,Ye,he,dn,mn,Ue,En,Xe,_o.vertical,!0,Qe,ze,b))};if(!we&&kt){const Ue=fn==="auto"?kt.map(Tt=>Hb(Tt)):[fn];let Ke=!1;for(let Tt=0;Tt<Ue.length;Tt++){const bt=Ue[Tt];if(!tt.horizontal[bt])if(Ke)tt.horizontal[bt]=tt.horizontal[0];else{const Rt=Bb(rt,e,r,u,Ye,he,dn,"center",bt,En,Xe,_o.horizontal,!1,Qe,ze,b);Rt&&(tt.horizontal[bt]=Rt,Ke=Rt.positionedLines.length===1)}}de("left")}else{if(fn==="auto"&&(fn=Hb(mn)),Fn||C.get("text-writing-mode").indexOf("horizontal")>=0||!Tg(Ft)){const Ue=Bb(rt,e,r,u,Ye,he,dn,mn,fn,En,Xe,_o.horizontal,!1,Qe,ze,b);Ue&&(tt.horizontal[fn]=Ue)}de(Fn?"left":fn)}}let ot,Ge,je,ft,ut,Gt,At=!1;const Lt=C.get("icon-text-fit").evaluate(Me,{},p);if(Me.icon&&Me.icon.hasPrimary()){const Ft=PP(Me.icon,s.iconSizeData,M["icon-size"],p,s.zoom,Me,b,z.iconScaleFactor,A);ot=Ft.iconPrimary,je=Ft.iconSecondary;const Yt=ot.toString();if(Ge=l.get(Yt),Ge&&(ut=C.get("icon-offset").evaluate(Me,{},p),Gt=C.get("icon-anchor").evaluate(Me,{},p),dt=m4(u.get(Yt),je?u.get(je.toString()):void 0,ut,Gt),At=Ge.sdf,s.sdfIcons===void 0?s.sdfIcons=Ge.sdf:s.sdfIcons!==Ge.sdf&&Dn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ge.pixelRatio!==s.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0)),je){const dn=je.toString();ft=l.get(dn)}}Ie=Ie||!(!Me.icon||!Me.icon.hasSecondary());const yt=Wb(tt.horizontal)||tt.vertical;s.iconsInText||(s.iconsInText=!!yt&&yt.iconsInText);const Vt=Qe*z.textScaleFactor/jr,{defaultShapedIcon:an,verticallyShapedIcon:St}=E4(s,dt,C,Me,p,tt,Vt,ut,Lt);Lt!=="none"&&dt&&(hP(dt)||dP(dt))&&(Lx(0,Ge,ot,dt,an,Lt,S,l,u),Lx(0,ft,je,dt,an,Lt,S,l,u),St&&(Lx(0,Ge,ot,dt,St,Lt,S,l,u),Lx(0,ft,je,dt,St,Lt,S,l,u))),dt=an,Pe.push({feature:Me,shapedTextOrientations:tt,shapedText:yt,shapedIcon:dt,iconPrimary:ot,iconSecondary:je,iconOffset:ut,iconAnchor:Gt,verticallyShapedIcon:St,layoutTextSize:Qe,layoutIconSize:lt,textOffset:Xe,isSDFIcon:At,iconTextFit:Lt})}return{featureData:Pe,sizes:z,hasAnySecondaryIcon:Ie,textAlongLine:we,symbolPlacement:le}},o.fo=wP,o.fp=function(s,e,r,l,u,p,m,v,b,S){const{featureData:A,hasAnySecondaryIcon:C,sizes:M,textAlongLine:z,symbolPlacement:O}=e;for(const $ of A){const{shapedIcon:W,verticallyShapedIcon:q,feature:ie,shapedTextOrientations:re,shapedText:le,layoutTextSize:we,textOffset:be,isSDFIcon:Ie,iconPrimary:Pe,iconSecondary:Me,iconTextFit:Ye,iconOffset:ze}=$;MP(W,S.iconPositions,Pe,Me),MP(q,S.iconPositions,Pe,Me),S4(re,S.iconPositions),T4(Pe,Me,S.iconPositions),(le||W)&&I4(s,ie,re,W,q,b,M,we,0,be,Ie,l,u,m,v,C,Ye,ze,z,O)}r&&s.generateCollisionDebugBuffers(p,s.collisionBoxArray,M.textScaleFactor)},o.fq=rn,o.fr=e0,o.fs=at,o.ft=function(s){let e=0;if(new Uint32Array(s,0,1)[0]!==wC){const r=new Uint32Array(s,0,7),[,,l,u,p,m]=r;e=r.byteLength+u+p+m+p,(l!==s.byteLength||e>=s.byteLength)&&Dn("Invalid b3dm header information.")}return EC(s,e)},o.fu=function(s,e){const r=DC(s);for(const l of r){for(const u of l.meshes)bj(u);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(Tj(l.lights,e)))}return r},o.fv=Zx,o.fw=fi,o.fx=gC,o.fy=fa,o.fz=js,o.g=function(s,e){return Nn(Object.assign(s,{method:"GET"}),e)},o.h=function(s){return s.indexOf("mapbox:")===0},o.i=function(s){return as.API_STYLE_REGEX.test(s)&&!cv(s)},o.j=Uc,o.k=wh,o.l=function(s){return decodeURIComponent(atob(s).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.m=function(s,e){return Nn(Object.assign(s,{type:"json"}),e)},o.n=qc,o.o=ca,o.p=function(s,e){return Nn(Object.assign(s,{method:"POST"}),e)},o.q=ns,o.r=Lm,o.s=function(s){try{const e=self[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=function(){return xb||(xb=new id),xb},o.u=function(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()},o.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},o.w=Dn,o.x=aT,o.y=Sh,o.z=Bo}),w(["./shared"],function(o){function k(De){const X=De?De.url.toString():void 0;return X?performance.getEntriesByName(X):[]}function L(De){if(typeof De=="number"||typeof De=="boolean"||typeof De=="string"||De==null)return JSON.stringify(De);if(Array.isArray(De)){let te="[";for(const pe of De)te+=`${L(pe)},`;return`${te}]`}let X="{";for(const te of Object.keys(De).sort())X+=`${te}:${L(De[te])},`;return`${X}}`}function N(De){let X="";for(const te of o.bx)X+=`/${L(De[te])}`;return X}class V{constructor(X){this.keyCache={},this._layers={},this._layerConfigs={},X&&this.replace(X)}replace(X,te){this._layerConfigs={},this._layers={},this.update(X,[],te)}update(X,te,pe){this._options=pe;for(const Ee of X)this._layerConfigs[Ee.id]=Ee,(this._layers[Ee.id]=o.dq(Ee,this.scope,null,this._options)).compileFilter(pe),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id];for(const Ee of te)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const Ae=function(Ee,Se){const $e={};for(let He=0;He<Ee.length;He++){const _t=Ee[He];let st=Se&&Se[_t.id];st||(_t.type==="symbol"?st=_t.id:(st=N(_t),_t.type==="line"&&_t.paint&&function tn(un){return typeof un=="string"&&un==="line-progress"||(Array.isArray(un)?un.some(tn):!(!un||typeof un!="object")&&Object.values(un).some(tn))}(_t.paint["line-width"])&&(st+=`/${L(_t.paint["line-width"])}`))),Se&&(Se[_t.id]=st);let $t=$e[st];$t||($t=$e[st]=[]),$t.push(_t)}const ke=[];for(const He in $e)ke.push($e[He]);return ke}(Object.values(this._layerConfigs),this.keyCache);for(const Ee of Ae){const Se=Ee.map($t=>this._layers[$t.id]),$e=Se[0];if($e.visibility==="none")continue;const ke=$e.source||"";let He=this.familiesBySource[ke];He||(He=this.familiesBySource[ke]={});const _t=$e.sourceLayer||"_geojsonTileLayer";let st=He[_t];st||(st=He[_t]=[]),st.push(Se)}}}const H=1*o.fc;class ne{constructor(X){const te={},pe=[];for(const $e in X){const ke=X[$e],He=te[$e]={};for(const _t in ke.glyphs){const st=ke.glyphs[+_t];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const $t=st.metrics.localGlyph?H:1,tn={x:0,y:0,w:st.bitmap.width+2*$t,h:st.bitmap.height+2*$t};pe.push(tn),He[_t]=tn}}const{w:Ae,h:Ee}=o.G(pe),Se=new o.fb({width:Ae||1,height:Ee||1});for(const $e in X){const ke=X[$e];for(const He in ke.glyphs){const _t=ke.glyphs[+He];if(!_t||_t.bitmap.width===0||_t.bitmap.height===0)continue;const st=te[$e][He],$t=_t.metrics.localGlyph?H:1;o.fb.copy(_t.bitmap,Se,{x:0,y:0},{x:st.x+$t,y:st.y+$t},_t.bitmap)}}this.image=Se,this.positions=te}}o.fa(ne,"GlyphAtlas");class ce{constructor(X){this.tileID=new o.aO(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.tileZoom=X.tileZoom,this.uid=X.uid,this.zoom=X.zoom,this.lut=X.lut,this.canonical=X.tileID.canonical,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.scope=X.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.request&&X.request.collectResourceTiming,this.promoteId=X.promoteId,this.isSymbolTile=X.isSymbolTile,this.tileTransform=o.aZ(X.tileID.canonical,X.projection),this.projection=X.projection,this.worldview=X.worldview,this.localizableLayerIds=X.localizableLayerIds,this.brightness=X.brightness,this.extraShadowCaster=!!X.extraShadowCaster,this.tessellationStep=X.tessellationStep,this.scaleFactor=X.scaleFactor,this.worldview=X.worldview}parse(X,te,pe,Ae,Ee,Se){this.status="parsing",this.data=X,this.collisionBoxArray=new o.b3;const $e=new o.fd(Object.keys(X.layers).sort()),ke=new o.fe(this.tileID,this.promoteId);ke.bucketLayerIDs=[];const He={},_t=new o.ff(256,256),st={featureIndex:ke,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:_t,availableImages:pe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},$t=[],tn=te.familiesBySource[this.source];for(const kn in tn){const Mn=X.layers[kn];if(!Mn)continue;let On=!1,pi=!1,Dn=!1;for(const fi of tn[kn])fi[0].type==="symbol"?On=!0:pi=!0,fi[0].is3D()&&fi[0].type!=="model"&&(Dn=!0);if(this.extraShadowCaster&&!Dn||this.isSymbolTile===!0&&!On||this.isSymbolTile===!1&&!pi)continue;Mn.version===1&&o.w(`Vector tile source "${this.source}" layer "${kn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Zi=$e.encode(kn),cr=[];let ur=!1;for(let fi=0,Kn=0;fi<Mn.length;fi++){const Hi=Mn.feature(fi),Wi=ke.getId(Hi,kn);if(this.localizableLayerIds&&this.localizableLayerIds.has(kn)){const Ti=Hi.properties?Hi.properties.worldview:null;if(this.worldview&&typeof Ti=="string")if(Ti==="all")Hi.properties.$localized=!0;else{if(!Ti.split(",").includes(this.worldview))continue;Hi.properties.$localized=!0,Hi.properties.worldview=this.worldview}}!ur&&Hi.properties&&Hi.properties.hasOwnProperty(o.fg)&&(ur=!0),cr.push({feature:Hi,id:Wi,index:Kn,sourceLayerIndex:Zi}),Kn++}ur&&!st.elevationFeatures&&X.layers.hasOwnProperty(o.fh)&&(st.elevationFeatures=o.fi.parseFrom(X.layers[o.fh],this.canonical));for(const fi of tn[kn]){const Kn=fi[0];if(this.extraShadowCaster&&(!Kn.is3D()||Kn.type==="model")||this.isSymbolTile!==void 0&&Kn.type==="symbol"!==this.isSymbolTile||Kn.minzoom&&this.zoom<Math.floor(Kn.minzoom)||Kn.maxzoom&&this.zoom>=Kn.maxzoom||Kn.visibility==="none")continue;K(fi,this.zoom,st.brightness,pe,this.worldview);const Hi=He[Kn.id]=Kn.createBucket({index:ke.bucketLayerIDs.length,layers:fi,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Zi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ae,worldview:this.worldview});ke.bucketLayerIDs.push(fi.map(Ti=>o.B(Ti.id,Ti.scope)));let Wi=Hi.prepare?Hi.prepare():null;Wi!=null?(Wi=Wi.then(()=>Hi.populate(cr,st,this.tileID.canonical,this.tileTransform)),$t.push(Wi)):Hi.populate(cr,st,this.tileID.canonical,this.tileTransform)}}const un=()=>{let kn,Mn,On,pi,Dn,Zi;_t.trim();const cr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ur=()=>{if(kn)return this.status="done",Se(kn);if(this.extraShadowCaster)this.status="done",Se(null,{buckets:Object.values(He).filter(Kn=>!Kn.isEmpty()),featureIndex:ke,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:st.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Mn&&On&&pi){const Kn=new ne(Mn),Hi=new Map;for(const[Hr,gs]of On.entries()){const{imagePosition:ro}=o.fl(Hr,gs,o.fm);Hi.set(Hr,ro)}const Wi={};for(const Hr in He){const gs=He[Hr];gs instanceof o.b4&&(K(gs.layers,this.zoom,st.brightness,pe,this.worldview),Wi[Hr]=o.fn(gs,Mn,Kn.positions,On,Hi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Dn,this.worldview))}const Ti={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ee,On,Dn,()=>{Ti.iconsPending=!1,fi(Wi,Kn,Ti)}),this.rasterizeIfNeeded(Ee,pi,Zi,()=>{Ti.patternsPending=!1,fi(Wi,Kn,Ti)})}},fi=(Kn,Hi,Wi,Ti)=>{if(Wi.iconsPending||Wi.patternsPending)return;const Hr=new o.fo(On,pi,this.lut);for(const gs in He){const ro=He[gs];if(gs in Kn)o.fp(ro,Kn[gs],this.showCollisionBoxes,pe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,On,Hr);else if(ro.hasPattern&&(ro instanceof o.ba||ro instanceof o.bb||ro instanceof o.e7)){K(ro.layers,this.zoom,st.brightness,pe,this.worldview);const Ma=Object.fromEntries(Hr.patternPositions);ro.addFeatures(st,this.tileID.canonical,Ma,pe,this.tileTransform,this.brightness)}}this.status="done",Se(null,{buckets:Object.values(He).filter(gs=>!gs.isEmpty()),featureIndex:ke,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Hi.image,lineAtlas:_t,imageAtlas:Hr,brightness:st.brightness})};if(!this.extraShadowCaster){const Kn=o.fj(st.glyphDependencies,Ti=>Object.keys(Ti).map(Number));Object.keys(Kn).length?Ee.send("getGlyphs",{uid:this.uid,stacks:Kn},(Ti,Hr)=>{kn||(kn=Ti,Mn=Hr,ur())},void 0,!1,cr):Mn={};const Hi=Array.from(st.iconDependencies.keys()).map(Ti=>o.I.parse(Ti));Hi.length?Ee.send("getImages",{images:Hi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ti,Hr)=>{kn||(kn=Ti,On=new Map,Dn=this.updateImageMapAndGetImageTaskQueue(On,Hr,st.iconDependencies),ur())},void 0,!1,cr):(On=new Map,Dn=new Map);const Wi=Array.from(st.patternDependencies.keys()).map(Ti=>o.I.parse(Ti));Wi.length?Ee.send("getImages",{images:Wi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ti,Hr)=>{kn||(kn=Ti,pi=new Map,Zi=this.updateImageMapAndGetImageTaskQueue(pi,Hr,st.patternDependencies),ur())},void 0,!1,cr):(pi=new Map,Zi=new Map)}if(st.elevationFeatures&&st.elevationFeatures.length>0){const Kn=[];for(const Wi of Object.values(He))if(Wi instanceof o.bb){const Ti=Wi.getUnevaluatedPortalGraph();Ti&&Kn.push(Ti)}const Hi=o.fk.evaluate(Kn);for(const Wi of Object.values(He))if(Wi instanceof o.bb){const Ti=X.layers[$e.decode(Wi.sourceLayerIndex)];Wi.setEvaluatedPortalGraph(Hi,Ti,this.tileID.canonical,st.availableImages,st.brightness)}}ur()};$t.length>0?Promise.allSettled($t).then(un).catch(Se):un()}rasterizeIfNeeded(X,te,pe,Ae){Array.from(te.values()).some(Ee=>Ee.usvg)?this.rasterize(X,te,pe,Ae):Ae()}updateImageMapAndGetImageTaskQueue(X,te,pe){const Ae=new Map;for(const Ee of te.keys()){const Se=pe.get(Ee)||[];for(const $e of Se){const ke=$e.toString(),He=te.get($e.id.toString());He.usvg?Ae.has(ke)||(Ae.set(ke,$e),X.set(ke,Object.assign({},He))):X.set(ke,He)}}return Ae}rasterize(X,te,pe,Ae){this.rasterizeTask=X.send("rasterizeImages",{scope:this.scope,tasks:pe},(Ee,Se)=>{if(!Ee)for(const[$e,ke]of Se.entries()){const He=Object.assign(te.get($e),{data:ke});te.set($e,He)}Ae()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function K(De,X,te,pe,Ae){const Ee=new o.ac(X,{brightness:te,worldview:Ae});for(const Se of De)Se.recalculate(Ee,pe)}class se extends o.E{constructor(X,te,pe,Ae,Ee,Se,$e){super(),this.actor=X,this.layerIndex=te,this.availableImages=pe,this.availableModels=Ae,this.loadVectorData=Se||o.aL,this.loading={},this.loaded={},this.deduped=new o.aK(X.scheduler),this.isSpriteLoaded=Ee,this.scheduler=X.scheduler,this.brightness=$e}loadTile(X,te){const pe=X.uid,Ae=X&&X.request,Ee=Ae&&Ae.collectResourceTiming,Se=this.loading[pe]=new ce(X);Se.abort=this.loadVectorData(X,($e,ke)=>{const He=!this.loading[pe];if(delete this.loading[pe],Se.cancelRasterize(),He||$e||!ke)return Se.status="done",He||(this.loaded[pe]=Se),te($e);const _t=ke.rawData,st={};ke.expires&&(st.expires=ke.expires),ke.cacheControl&&(st.cacheControl=ke.cacheControl),Se.vectorTile=ke.vectorTile||new o.fq(new o.bt(_t));const $t=()=>{Se.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(tn,un)=>{if(tn||!un)return te(tn);const kn={};if(Ee){const Mn=k(Ae);Mn.length>0&&(kn.resourceTiming=JSON.parse(JSON.stringify(Mn)))}te(null,Object.assign({rawTileData:_t.slice(0)},un,st,kn))})};this.isSpriteLoaded?$t():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add($t,{type:"parseTile",isSymbolTile:X.isSymbolTile,zoom:X.tileZoom}):$t()}),this.loaded=this.loaded||{},this.loaded[pe]=Se})}reloadTile(X,te){const pe=this.loaded,Ae=X.uid;if(pe&&pe[Ae]){const Ee=pe[Ae];Ee.scaleFactor=X.scaleFactor,Ee.showCollisionBoxes=X.showCollisionBoxes,Ee.projection=X.projection,Ee.brightness=X.brightness,Ee.tileTransform=o.aZ(X.tileID.canonical,X.projection),Ee.extraShadowCaster=X.extraShadowCaster,Ee.lut=X.lut,Ee.worldview=X.worldview;const Se=($e,ke)=>{const He=Ee.reloadCallback;He&&(delete Ee.reloadCallback,Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,He)),te($e,ke)};Ee.status==="parsing"?Ee.reloadCallback=Se:Ee.status==="done"&&(Ee.vectorTile?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Se):Se())}else te(null,void 0)}abortTile(X,te){const pe=X.uid,Ae=this.loading[pe];Ae&&(Ae.abort&&Ae.abort(),delete this.loading[pe]),te()}removeTile(X,te){const pe=this.loaded,Ae=X.uid;pe&&pe[Ae]&&delete pe[Ae],te()}}class Y{loadTile(X,te){const{uid:pe,encoding:Ae,rawImageData:Ee,padding:Se}=X,$e=ImageBitmap&&Ee instanceof ImageBitmap?this.getImageData(Ee,Se):Ee;te(null,new o.fr(pe,$e,Ae,Se<1))}reloadTile(X,te){te(null,null)}abortTile(X,te){te()}removeTile(X,te){te()}getImageData(X,te){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const pe=this.offscreenCanvasContext.getImageData(-te,-te,X.width+2*te,X.height+2*te);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),pe}}o.bs.setPbf(o.bt);class Q{constructor(X){this._mrt=new o.bs(X.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=X.uid,this.tileID=X.tileID,this.source=X.source}parse(X,te){const pe=this._mrt;this.status="parsing",this._entireBuffer=X;try{pe.parseHeader(X),this._isHeaderLoaded=!0;const Ae=[];for(const Ee in pe.layers){const Se=pe.getLayer(Ee),$e=Se.getDataRange(Se.getBandList()),ke=pe.createDecodingTask($e),He=X.slice($e.firstByte,$e.lastByte+1),_t=o.bs.performDecoding(He,ke).then(st=>ke.complete(null,st)).catch(st=>ke.complete(st,null));Ae.push(_t)}Promise.allSettled(Ae).then(()=>te(null,pe)).catch(Ee=>te(Ee))}catch(Ae){te(Ae)}}}class ae{constructor(X){this.actor=X,this.loading={},this.loaded={}}loadTile(X,te){const pe=X.uid,Ae=X.request,Ee=this.loading[pe]=new Q(X),{cancel:Se}=o.bu(Ae,($e,ke,He,_t)=>{const st=!this.loading[pe];if(delete this.loading[pe],st||$e||!ke)return Ee.status="done",st||(this.loaded[pe]=Ee),te($e);Ee.parse(ke,($t,tn)=>{if($t||!tn)return te($t);te(null,tn,He,_t)}),this.loaded[pe]=Ee});Ee.abort=Se}reloadTile(X,te){te(null,void 0)}abortTile(X,te){const pe=X.uid,Ae=this.loading[pe];Ae&&(Ae.abort&&Ae.abort(),delete this.loading[pe]),te()}removeTile(X,te){const pe=X.uid;this.loaded[pe]&&delete this.loaded[pe],te()}decodeRasterArray(X,te){o.bs.performDecoding(X.buffer,X.task).then(pe=>te(null,pe)).catch(pe=>te(pe))}}const Te=o.fs.prototype.toGeoJSON;class Be{constructor(X){this._feature=X,this.extent=o.al,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))}loadGeometry(){if(this._feature.type===1){const X=[];for(const te of this._feature.geometry)X.push([new o.P(te[0],te[1])]);return X}{const X=[];for(const te of this._feature.geometry){const pe=[];for(const Ae of te)pe.push(new o.P(Ae[0],Ae[1]));X.push(pe)}return X}}toGeoJSON(X,te,pe){return Te.call(this,X,te,pe)}}class et{constructor(X,te){this.name=X,this.extent=o.al,this.length=te.length,this._jsonFeatures=te}feature(X){return new Be(this._jsonFeatures[X])}}class nt{constructor(X){this.layers={},this.extent=o.al;for(const te of Object.keys(X))this.layers[te]=new et(te,X[te])}}const Je=64/4096,Dt=128;class wt{constructor(){this.features=new Map}clear(){this.features.clear()}load(X=[],te){for(const pe of X){const Ae=pe.id;if(Ae==null)continue;let Ee=this.features.get(Ae);Ee&&this.updateCache(Ee,te),pe.geometry?(Ee=qt(pe),this.updateCache(Ee,te),this.features.set(Ae,Ee)):this.features.delete(Ae),this.updateCache(Ee,te)}}updateCache(X,te){for(const{canonical:pe,uid:Ae}of Object.values(te)){const{z:Ee,x:Se,y:$e}=pe;xt(X,Math.pow(2,Ee),Se,$e)&&delete te[Ae]}}getTile(X,te,pe){const Ae=Math.pow(2,X),Ee=[];for(const Se of this.features.values())xt(Se,Ae,te,pe)&&Ee.push(pn(Se,Ae,te,pe));return{features:Ee}}getFeatures(){return[...this.features.values()]}}function xt({minX:De,minY:X,maxX:te,maxY:pe},Ae,Ee,Se){return De<(Ee+1+Je)/Ae&&X<(Se+1+Je)/Ae&&te>(Ee-Je)/Ae&&pe>(Se-Je)/Ae}function qt(De){const{id:X,geometry:te,properties:pe}=De;if(!te)return;if(te.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ae,coordinates:Ee}=te,Se={id:X,type:1,geometry:[],tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},$e=Se.geometry;if(Ae==="Point")ln(Ee,$e,Se);else if(Ae==="MultiPoint")for(const ke of Ee)ln(ke,$e,Se);else if(Ae==="LineString")Se.type=2,Ht(Ee,$e,Se);else if(Ae==="MultiLineString")Se.type=2,cn(Ee,$e,Se);else if(Ae==="Polygon")Se.type=3,cn(Ee,$e,Se,!0);else{if(Ae!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Se.type=3;for(const ke of Ee)cn(ke,$e,Se,!0)}return Se}function ln([De,X],te,pe){const Ae=o.aF(De);let Ee=o.aJ(X);Ee=Ee<0?0:Ee>1?1:Ee,te.push(Ae,Ee),pe.minX=Math.min(pe.minX,Ae),pe.minY=Math.min(pe.minY,Ee),pe.maxX=Math.max(pe.maxX,Ae),pe.maxY=Math.max(pe.maxY,Ee)}function Ht(De,X,te,pe=!1,Ae=!1){const Ee=[];for(const Se of De)ln(Se,Ee,te);X.push(Ee),pe&&function(Se,$e){let ke=0;for(let He=0,_t=Se.length,st=_t-2;He<_t;st=He,He+=2)ke+=(Se[He]-Se[st])*(Se[He+1]+Se[st+1]);if(ke>0===$e)for(let He=0,_t=Se.length;He<_t/2;He+=2){const st=Se[He],$t=Se[He+1];Se[He]=Se[_t-2-He],Se[He+1]=Se[_t-1-He],Se[_t-2-He]=st,Se[_t-1-He]=$t}}(Ee,Ae)}function cn(De,X,te,pe=!1){for(let Ae=0;Ae<De.length;Ae++)Ht(De[Ae],X,te,pe,Ae===0)}function pn(De,X,te,pe){const{id:Ae,type:Ee,geometry:Se,tags:$e}=De,ke=[];if(Ee===1)(function(He,_t,st,$t,tn){for(let un=0;un<He.length;un+=2){const kn=Math.round(o.al*(He[un+0]*_t-st)),Mn=Math.round(o.al*(He[un+1]*_t-$t));tn.push([kn,Mn])}})(Se,X,te,pe,ke);else for(const He of Se)Rn(He,X,te,pe,ke);return{id:Ae,type:Ee,geometry:ke,tags:$e}}function Rn(De,X,te,pe,Ae){const Ee=-Dt,Se=o.al+Dt;let $e;for(let ke=0;ke<De.length-2;ke+=2){let He=Math.round(o.al*(De[ke+0]*X-te)),_t=Math.round(o.al*(De[ke+1]*X-pe)),st=Math.round(o.al*(De[ke+2]*X-te)),$t=Math.round(o.al*(De[ke+3]*X-pe));const tn=st-He,un=$t-_t;He<Ee&&st<Ee||(He<Ee?(_t+=Math.round(un*((Ee-He)/tn)),He=Ee):st<Ee&&($t=_t+Math.round(un*((Ee-He)/tn)),st=Ee),_t<Ee&&$t<Ee||(_t<Ee?(He+=Math.round(tn*((Ee-_t)/un)),_t=Ee):$t<Ee&&(st=He+Math.round(tn*((Ee-_t)/un)),$t=Ee),He>=Se&&st>=Se||(He>=Se?(_t+=Math.round(un*((Se-He)/tn)),He=Se):st>=Se&&($t=_t+Math.round(un*((Se-He)/tn)),st=Se),_t>=Se&&$t>=Se||(_t>=Se?(He+=Math.round(tn*((Se-_t)/un)),_t=Se):$t>=Se&&(st=He+Math.round(tn*((Se-_t)/un)),$t=Se),$e&&He===$e[$e.length-1][0]&&_t===$e[$e.length-1][1]||($e=[[He,_t]],Ae.push($e)),$e.push([st,$t])))))}}function Nt({name:De,features:X},te){te.writeStringField(1,De),te.writeVarintField(5,o.al);const pe=new Map,Ae=new Map,Ee={keys:pe,values:Ae,feature:null};for(const Se of X)Ee.feature=Se,te.writeMessage(2,sn,Ee);for(const Se of pe.keys())te.writeStringField(3,Se);for(const Se of Ae.keys())te.writeMessage(4,ir,Se)}function sn(De,X){const te=De.feature;te.id!==void 0&&Number.isSafeInteger(+te.id)&&X.writeVarintField(1,+te.id),te.tags&&X.writeMessage(2,Tn,De),X.writeVarintField(3,te.type),X.writeMessage(4,_r,te)}function Tn({keys:De,values:X,feature:te},pe){for(const Ae of Object.keys(te.tags)){let Ee=te.tags[Ae];if(Ee===null)continue;let Se=De.get(Ae);Se===void 0&&(Se=De.size,De.set(Ae,Se)),pe.writeVarint(Se);const $e=typeof Ee;$e!=="string"&&$e!=="boolean"&&$e!=="number"&&(Ee=JSON.stringify(Ee));let ke=X.get(Ee);ke===void 0&&(ke=X.size,X.set(Ee,ke)),pe.writeVarint(ke)}}function on(De,X){return(X<<3)+(7&De)}function Xn(De){return De<<1^De>>31}function _r(De,X){const{geometry:te,type:pe}=De;let Ae=0,Ee=0;if(pe===1){X.writeVarint(on(1,te.length));for(const Se of te){const $e=Se[0]-Ae,ke=Se[1]-Ee;X.writeVarint(Xn($e)),X.writeVarint(Xn(ke)),Ae+=$e,Ee+=ke}}else for(const Se of te){X.writeVarint(on(1,1));const $e=Se.length-(pe===3?1:0);for(let ke=0;ke<$e;ke++){ke===1&&X.writeVarint(on(2,$e-1));const He=Se[ke][0]-Ae,_t=Se[ke][1]-Ee;X.writeVarint(Xn(He)),X.writeVarint(Xn(_t)),Ae+=He,Ee+=_t}pe===3&&X.writeVarint(on(7,1))}}function ir(De,X){const te=typeof De;te==="string"?X.writeStringField(1,De):te==="boolean"?X.writeBooleanField(7,De):te==="number"&&(De%1!=0?X.writeDoubleField(3,De):De<0?X.writeSVarintField(6,De):X.writeVarintField(5,De))}const Qr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:De=>De},Vn=Math.fround||(Wn=new Float32Array(1),De=>(Wn[0]=+De,Wn[0]));var Wn;const ci=3,rr=5,ui=6;class Bi{constructor(X){this.options=Object.assign(Object.create(Qr),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:te,minZoom:pe,maxZoom:Ae}=this.options;te&&console.time("total time");const Ee=`prepare ${X.length} points`;te&&console.time(Ee),this.points=X;const Se=[];for(let ke=0;ke<X.length;ke++){const He=X[ke];if(!He.geometry)continue;const[_t,st]=He.geometry.coordinates,$t=Vn(Li(_t)),tn=Vn(ii(st));Se.push($t,tn,1/0,ke,-1,1),this.options.reduce&&Se.push(0)}let $e=this.trees[Ae+1]=this._createTree(Se);te&&console.timeEnd(Ee);for(let ke=Ae;ke>=pe;ke--){const He=+Date.now();$e=this.trees[ke]=this._createTree(this._cluster($e,ke)),te&&console.log("z%d: %d clusters in %dms",ke,$e.numItems,+Date.now()-He)}return te&&console.timeEnd("total time"),this}getClusters(X,te){let pe=((X[0]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,X[1]));let Ee=X[2]===180?180:((X[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)pe=-180,Ee=180;else if(pe>Ee){const st=this.getClusters([pe,Ae,180,Se],te),$t=this.getClusters([-180,Ae,Ee,Se],te);return st.concat($t)}const $e=this.trees[this._limitZoom(te)],ke=$e.range(Li(pe),ii(Se),Li(Ee),ii(Ae)),He=$e.data,_t=[];for(const st of ke){const $t=this.stride*st;_t.push(He[$t+rr]>1?Sn(He,$t,this.clusterProps):this.points[He[$t+ci]])}return _t}getChildren(X){const te=this._getOriginId(X),pe=this._getOriginZoom(X),Ae="No cluster with the specified id.",Ee=this.trees[pe];if(!Ee)throw new Error(Ae);const Se=Ee.data;if(te*this.stride>=Se.length)throw new Error(Ae);const $e=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),ke=Ee.within(Se[te*this.stride],Se[te*this.stride+1],$e),He=[];for(const _t of ke){const st=_t*this.stride;Se[st+4]===X&&He.push(Se[st+rr]>1?Sn(Se,st,this.clusterProps):this.points[Se[st+ci]])}if(He.length===0)throw new Error(Ae);return He}getLeaves(X,te,pe){const Ae=[];return this._appendLeaves(Ae,X,te=te||10,pe=pe||0,0),Ae}getTile(X,te,pe){const Ae=this.trees[this._limitZoom(X)],Ee=Math.pow(2,X),{extent:Se,radius:$e}=this.options,ke=$e/Se,He=(pe-ke)/Ee,_t=(pe+1+ke)/Ee,st={features:[]};return this._addTileFeatures(Ae.range((te-ke)/Ee,He,(te+1+ke)/Ee,_t),Ae.data,te,pe,Ee,st),te===0&&this._addTileFeatures(Ae.range(1-ke/Ee,He,1,_t),Ae.data,Ee,pe,Ee,st),te===Ee-1&&this._addTileFeatures(Ae.range(0,He,ke/Ee,_t),Ae.data,-1,pe,Ee,st),st.features.length?st:null}getClusterExpansionZoom(X){let te=this._getOriginZoom(X)-1;for(;te<=this.options.maxZoom;){const pe=this.getChildren(X);if(te++,pe.length!==1)break;X=pe[0].properties.cluster_id}return te}_appendLeaves(X,te,pe,Ae,Ee){const Se=this.getChildren(te);for(const $e of Se){const ke=$e.properties;if(ke&&ke.cluster?Ee+ke.point_count<=Ae?Ee+=ke.point_count:Ee=this._appendLeaves(X,ke.cluster_id,pe,Ae,Ee):Ee<Ae?Ee++:X.push($e),X.length===pe)break}return Ee}_createTree(X){const te=new o.c3(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let pe=0;pe<X.length;pe+=this.stride)te.add(X[pe],X[pe+1]);return te.finish(),te.data=X,te}_addTileFeatures(X,te,pe,Ae,Ee,Se){for(const $e of X){const ke=$e*this.stride,He=te[ke+rr]>1;let _t,st,$t;if(He)_t=ji(te,ke,this.clusterProps),st=te[ke],$t=te[ke+1];else{const kn=this.points[te[ke+ci]];_t=kn.properties;const[Mn,On]=kn.geometry.coordinates;st=Li(Mn),$t=ii(On)}const tn={type:1,geometry:[[Math.round(this.options.extent*(st*Ee-pe)),Math.round(this.options.extent*($t*Ee-Ae))]],tags:_t};let un;un=He||this.options.generateId?te[ke+ci]:this.points[te[ke+ci]].id,un!==void 0&&(tn.id=un),Se.features.push(tn)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,te){const{radius:pe,extent:Ae,reduce:Ee,minPoints:Se}=this.options,$e=pe/(Ae*Math.pow(2,te)),ke=X.data,He=[],_t=this.stride;for(let st=0;st<ke.length;st+=_t){if(ke[st+2]<=te)continue;ke[st+2]=te;const $t=ke[st],tn=ke[st+1],un=X.within(ke[st],ke[st+1],$e),kn=ke[st+rr];let Mn=kn;for(const On of un){const pi=On*_t;ke[pi+2]>te&&(Mn+=ke[pi+rr])}if(Mn>kn&&Mn>=Se){let On,pi=$t*kn,Dn=tn*kn,Zi=-1;const cr=(st/_t<<5)+(te+1)+this.points.length;for(const ur of un){const fi=ur*_t;if(ke[fi+2]<=te)continue;ke[fi+2]=te;const Kn=ke[fi+rr];pi+=ke[fi]*Kn,Dn+=ke[fi+1]*Kn,ke[fi+4]=cr,Ee&&(On||(On=this._map(ke,st,!0),Zi=this.clusterProps.length,this.clusterProps.push(On)),Ee(On,this._map(ke,fi)))}ke[st+4]=cr,He.push(pi/Mn,Dn/Mn,1/0,cr,-1,Mn),Ee&&He.push(Zi)}else{for(let On=0;On<_t;On++)He.push(ke[st+On]);if(Mn>1)for(const On of un){const pi=On*_t;if(!(ke[pi+2]<=te)){ke[pi+2]=te;for(let Dn=0;Dn<_t;Dn++)He.push(ke[pi+Dn])}}}}return He}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,te,pe){if(X[te+rr]>1){const Se=this.clusterProps[X[te+ui]];return pe?Object.assign({},Se):Se}const Ae=this.points[X[te+ci]].properties,Ee=this.options.map(Ae);return pe&&Ee===Ae?Object.assign({},Ee):Ee}}function Sn(De,X,te){return{type:"Feature",id:De[X+ci],properties:ji(De,X,te),geometry:{type:"Point",coordinates:[(pe=De[X],360*(pe-.5)),fs(De[X+1])]}};var pe}function ji(De,X,te){const pe=De[X+rr],Ae=pe>=1e4?`${Math.round(pe/1e3)}k`:pe>=1e3?Math.round(pe/100)/10+"k":pe,Ee=De[X+ui],Se=Ee===-1?{}:Object.assign({},te[Ee]);return Object.assign(Se,{cluster:!0,cluster_id:De[X+ci],point_count:pe,point_count_abbreviated:Ae})}function Li(De){return De/360+.5}function ii(De){const X=Math.sin(De*Math.PI/180),te=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return te<0?0:te>1?1:te}function fs(De){const X=(180-360*De)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function es(De,X,te,pe){let Ae=pe;const Ee=X+(te-X>>1);let Se,$e=te-X;const ke=De[X],He=De[X+1],_t=De[te],st=De[te+1];for(let $t=X+3;$t<te;$t+=3){const tn=Qs(De[$t],De[$t+1],ke,He,_t,st);if(tn>Ae)Se=$t,Ae=tn;else if(tn===Ae){const un=Math.abs($t-Ee);un<$e&&(Se=$t,$e=un)}}Ae>pe&&(Se-X>3&&es(De,X,Se,pe),De[Se+2]=Ae,te-Se>3&&es(De,Se,te,pe))}function Qs(De,X,te,pe,Ae,Ee){let Se=Ae-te,$e=Ee-pe;if(Se!==0||$e!==0){const ke=((De-te)*Se+(X-pe)*$e)/(Se*Se+$e*$e);ke>1?(te=Ae,pe=Ee):ke>0&&(te+=Se*ke,pe+=$e*ke)}return Se=De-te,$e=X-pe,Se*Se+$e*$e}function lr(De,X,te,pe){const Ae={id:De??null,type:X,geometry:te,tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(X==="Point"||X==="MultiPoint"||X==="LineString")ps(Ae,te);else if(X==="Polygon")ps(Ae,te[0]);else if(X==="MultiLineString")for(const Ee of te)ps(Ae,Ee);else if(X==="MultiPolygon")for(const Ee of te)ps(Ae,Ee[0]);return Ae}function ps(De,X){for(let te=0;te<X.length;te+=3)De.minX=Math.min(De.minX,X[te]),De.minY=Math.min(De.minY,X[te+1]),De.maxX=Math.max(De.maxX,X[te]),De.maxY=Math.max(De.maxY,X[te+1])}function Nr(De,X,te,pe){if(!X.geometry)return;const Ae=X.geometry.coordinates;if(Ae&&Ae.length===0)return;const Ee=X.geometry.type,Se=Math.pow(te.tolerance/((1<<te.maxZoom)*te.extent),2);let $e=[],ke=X.id;if(te.promoteId?ke=X.properties[te.promoteId]:te.generateId&&(ke=pe||0),Ee==="Point")eo(Ae,$e);else if(Ee==="MultiPoint")for(const He of Ae)eo(He,$e);else if(Ee==="LineString")to(Ae,$e,Se,!1);else if(Ee==="MultiLineString"){if(te.lineMetrics){for(const He of Ae)$e=[],to(He,$e,Se,!1),De.push(lr(ke,"LineString",$e,X.properties));return}ra(Ae,$e,Se,!1)}else if(Ee==="Polygon")ra(Ae,$e,Se,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const He of X.geometry.geometries)Nr(De,{id:ke,geometry:He,properties:X.properties},te,pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const He of Ae){const _t=[];ra(He,_t,Se,!0),$e.push(_t)}}De.push(lr(ke,Ee,$e,X.properties))}function eo(De,X){X.push(sa(De[0]),os(De[1]),0)}function to(De,X,te,pe){let Ae,Ee,Se=0;for(let ke=0;ke<De.length;ke++){const He=sa(De[ke][0]),_t=os(De[ke][1]);X.push(He,_t,0),ke>0&&(Se+=pe?(Ae*_t-He*Ee)/2:Math.sqrt(Math.pow(He-Ae,2)+Math.pow(_t-Ee,2))),Ae=He,Ee=_t}const $e=X.length-3;X[2]=1,es(X,0,$e,te),X[$e+2]=1,X.size=Math.abs(Se),X.start=0,X.end=X.size}function ra(De,X,te,pe){for(let Ae=0;Ae<De.length;Ae++){const Ee=[];to(De[Ae],Ee,te,pe),X.push(Ee)}}function sa(De){return De/360+.5}function os(De){const X=Math.sin(De*Math.PI/180),te=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return te<0?0:te>1?1:te}function ms(De,X,te,pe,Ae,Ee,Se,$e){if(pe/=X,Ee>=(te/=X)&&Se<pe)return De;if(Se<te||Ee>=pe)return null;const ke=[];for(const He of De){const _t=He.geometry;let st=He.type;const $t=Ae===0?He.minX:He.minY,tn=Ae===0?He.maxX:He.maxY;if($t>=te&&tn<pe){ke.push(He);continue}if(tn<te||$t>=pe)continue;let un=[];if(st==="Point"||st==="MultiPoint")ql(_t,un,te,pe,Ae);else if(st==="LineString")no(_t,un,te,pe,Ae,!1,$e.lineMetrics);else if(st==="MultiLineString")yr(_t,un,te,pe,Ae,!1);else if(st==="Polygon")yr(_t,un,te,pe,Ae,!0);else if(st==="MultiPolygon")for(const kn of _t){const Mn=[];yr(kn,Mn,te,pe,Ae,!0),Mn.length&&un.push(Mn)}if(un.length){if($e.lineMetrics&&st==="LineString"){for(const kn of un)ke.push(lr(He.id,st,kn,He.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(un.length===1?(st="LineString",un=un[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=un.length===3?"Point":"MultiPoint"),ke.push(lr(He.id,st,un,He.tags))}}return ke.length?ke:null}function ql(De,X,te,pe,Ae){for(let Ee=0;Ee<De.length;Ee+=3){const Se=De[Ee+Ae];Se>=te&&Se<=pe&&Cs(X,De[Ee],De[Ee+1],De[Ee+2])}}function no(De,X,te,pe,Ae,Ee,Se){let $e=io(De);const ke=Ae===0?oa:aa;let He,_t,st=De.start;for(let Mn=0;Mn<De.length-3;Mn+=3){const On=De[Mn],pi=De[Mn+1],Dn=De[Mn+2],Zi=De[Mn+3],cr=De[Mn+4],ur=Ae===0?On:pi,fi=Ae===0?Zi:cr;let Kn=!1;Se&&(He=Math.sqrt(Math.pow(On-Zi,2)+Math.pow(pi-cr,2))),ur<te?fi>te&&(_t=ke($e,On,pi,Zi,cr,te),Se&&($e.start=st+He*_t)):ur>pe?fi<pe&&(_t=ke($e,On,pi,Zi,cr,pe),Se&&($e.start=st+He*_t)):Cs($e,On,pi,Dn),fi<te&&ur>=te&&(_t=ke($e,On,pi,Zi,cr,te),Kn=!0),fi>pe&&ur<=pe&&(_t=ke($e,On,pi,Zi,cr,pe),Kn=!0),!Ee&&Kn&&(Se&&($e.end=st+He*_t),X.push($e),$e=io(De)),Se&&(st+=He)}let $t=De.length-3;const tn=De[$t],un=De[$t+1],kn=Ae===0?tn:un;kn>=te&&kn<=pe&&Cs($e,tn,un,De[$t+2]),$t=$e.length-3,Ee&&$t>=3&&($e[$t]!==$e[0]||$e[$t+1]!==$e[1])&&Cs($e,$e[0],$e[1],$e[2]),$e.length&&X.push($e)}function io(De){const X=[];return X.size=De.size,X.start=De.start,X.end=De.end,X}function yr(De,X,te,pe,Ae,Ee){for(const Se of De)no(Se,X,te,pe,Ae,Ee,!1)}function Cs(De,X,te,pe){De.push(X,te,pe)}function oa(De,X,te,pe,Ae,Ee){const Se=(Ee-X)/(pe-X);return Cs(De,Ee,te+(Ae-te)*Se,1),Se}function aa(De,X,te,pe,Ae,Ee){const Se=(Ee-te)/(Ae-te);return Cs(De,X+(pe-X)*Se,Ee,1),Se}function Io(De,X){const te=[];for(let pe=0;pe<De.length;pe++){const Ae=De[pe],Ee=Ae.type;let Se;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")Se=zo(Ae.geometry,X);else if(Ee==="MultiLineString"||Ee==="Polygon"){Se=[];for(const $e of Ae.geometry)Se.push(zo($e,X))}else if(Ee==="MultiPolygon"){Se=[];for(const $e of Ae.geometry){const ke=[];for(const He of $e)ke.push(zo(He,X));Se.push(ke)}}te.push(lr(Ae.id,Ee,Se,Ae.tags))}return te}function zo(De,X){const te=[];te.size=De.size,De.start!==void 0&&(te.start=De.start,te.end=De.end);for(let pe=0;pe<De.length;pe+=3)te.push(De[pe]+X,De[pe+1],De[pe+2]);return te}function Pa(De,X){if(De.transformed)return De;const te=1<<De.z,pe=De.x,Ae=De.y;for(const Ee of De.features){const Se=Ee.geometry,$e=Ee.type;if(Ee.geometry=[],$e===1)for(let ke=0;ke<Se.length;ke+=2)Ee.geometry.push(Ri(Se[ke],Se[ke+1],X,te,pe,Ae));else for(let ke=0;ke<Se.length;ke++){const He=[];for(let _t=0;_t<Se[ke].length;_t+=2)He.push(Ri(Se[ke][_t],Se[ke][_t+1],X,te,pe,Ae));Ee.geometry.push(He)}}return De.transformed=!0,De}function Ri(De,X,te,pe,Ae,Ee){return[Math.round(te*(De*pe-Ae)),Math.round(te*(X*pe-Ee))]}function vr(De,X,te,pe,Ae){const Ee=X===Ae.maxZoom?0:Ae.tolerance/((1<<X)*Ae.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:De.length,source:null,x:te,y:pe,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const $e of De)Zl(Se,$e,Ee,Ae);return Se}function Zl(De,X,te,pe){const Ae=X.geometry,Ee=X.type,Se=[];if(De.minX=Math.min(De.minX,X.minX),De.minY=Math.min(De.minY,X.minY),De.maxX=Math.max(De.maxX,X.maxX),De.maxY=Math.max(De.maxY,X.maxY),Ee==="Point"||Ee==="MultiPoint")for(let $e=0;$e<Ae.length;$e+=3)Se.push(Ae[$e],Ae[$e+1]),De.numPoints++,De.numSimplified++;else if(Ee==="LineString")la(Se,Ae,De,te,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let $e=0;$e<Ae.length;$e++)la(Se,Ae[$e],De,te,Ee==="Polygon",$e===0);else if(Ee==="MultiPolygon")for(let $e=0;$e<Ae.length;$e++){const ke=Ae[$e];for(let He=0;He<ke.length;He++)la(Se,ke[He],De,te,!0,He===0)}if(Se.length){let $e=X.tags||null;if(Ee==="LineString"&&pe.lineMetrics){$e={};for(const He in X.tags)$e[He]=X.tags[He];$e.mapbox_clip_start=Ae.start/Ae.size,$e.mapbox_clip_end=Ae.end/Ae.size}const ke={geometry:Se,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:$e};X.id!==null&&(ke.id=X.id),De.features.push(ke)}}function la(De,X,te,pe,Ae,Ee){const Se=pe*pe;if(pe>0&&X.size<(Ae?Se:pe))return void(te.numPoints+=X.length/3);const $e=[];for(let ke=0;ke<X.length;ke+=3)(pe===0||X[ke+2]>Se)&&(te.numSimplified++,$e.push(X[ke],X[ke+1])),te.numPoints++;Ae&&function(ke,He){let _t=0;for(let st=0,$t=ke.length,tn=$t-2;st<$t;tn=st,st+=2)_t+=(ke[st]-ke[tn])*(ke[st+1]+ke[tn+1]);if(_t>0===He)for(let st=0,$t=ke.length;st<$t/2;st+=2){const tn=ke[st],un=ke[st+1];ke[st]=ke[$t-2-st],ke[st+1]=ke[$t-1-st],ke[$t-2-st]=tn,ke[$t-1-st]=un}}($e,Ee),De.push($e)}const Ns={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class rl{constructor(X,te){const pe=(te=this.options=function(Ee,Se){for(const $e in Se)Ee[$e]=Se[$e];return Ee}(Object.create(Ns),te)).debug;if(pe&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ae=function(Ee,Se){const $e=[];if(Ee.type==="FeatureCollection")for(let ke=0;ke<Ee.features.length;ke++)Nr($e,Ee.features[ke],Se,ke);else Nr($e,Ee.type==="Feature"?Ee:{geometry:Ee},Se);return $e}(X,te);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ae=function(Ee,Se){const $e=Se.buffer/Se.extent;let ke=Ee;const He=ms(Ee,1,-1-$e,$e,0,-1,2,Se),_t=ms(Ee,1,1-$e,2+$e,0,-1,2,Se);return(He||_t)&&(ke=ms(Ee,1,-$e,1+$e,0,-1,2,Se)||[],He&&(ke=Io(He,1).concat(ke)),_t&&(ke=ke.concat(Io(_t,-1)))),ke}(Ae,te),Ae.length&&this.splitTile(Ae,0,0,0),pe&&(Ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(X,te,pe,Ae,Ee,Se,$e){const ke=[X,te,pe,Ae],He=this.options,_t=He.debug;for(;ke.length;){Ae=ke.pop(),pe=ke.pop(),te=ke.pop(),X=ke.pop();const st=1<<te,$t=Xl(te,pe,Ae);let tn=this.tiles[$t];if(!tn&&(_t>1&&console.time("creation"),tn=this.tiles[$t]=vr(X,te,pe,Ae,He),this.tileCoords.push({z:te,x:pe,y:Ae}),_t)){_t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,pe,Ae,tn.numFeatures,tn.numPoints,tn.numSimplified),console.timeEnd("creation"));const Kn=`z${te}`;this.stats[Kn]=(this.stats[Kn]||0)+1,this.total++}if(tn.source=X,Ee==null){if(te===He.indexMaxZoom||tn.numPoints<=He.indexMaxPoints)continue}else{if(te===He.maxZoom||te===Ee)continue;if(Ee!=null){const Kn=Ee-te;if(pe!==Se>>Kn||Ae!==$e>>Kn)continue}}if(tn.source=null,X.length===0)continue;_t>1&&console.time("clipping");const un=.5*He.buffer/He.extent,kn=.5-un,Mn=.5+un,On=1+un;let pi=null,Dn=null,Zi=null,cr=null,ur=ms(X,st,pe-un,pe+Mn,0,tn.minX,tn.maxX,He),fi=ms(X,st,pe+kn,pe+On,0,tn.minX,tn.maxX,He);X=null,ur&&(pi=ms(ur,st,Ae-un,Ae+Mn,1,tn.minY,tn.maxY,He),Dn=ms(ur,st,Ae+kn,Ae+On,1,tn.minY,tn.maxY,He),ur=null),fi&&(Zi=ms(fi,st,Ae-un,Ae+Mn,1,tn.minY,tn.maxY,He),cr=ms(fi,st,Ae+kn,Ae+On,1,tn.minY,tn.maxY,He),fi=null),_t>1&&console.timeEnd("clipping"),ke.push(pi||[],te+1,2*pe,2*Ae),ke.push(Dn||[],te+1,2*pe,2*Ae+1),ke.push(Zi||[],te+1,2*pe+1,2*Ae),ke.push(cr||[],te+1,2*pe+1,2*Ae+1)}}getTile(X,te,pe){X=+X,te=+te,pe=+pe;const Ae=this.options,{extent:Ee,debug:Se}=Ae;if(X<0||X>24)return null;const $e=1<<X,ke=Xl(X,te=te+$e&$e-1,pe);if(this.tiles[ke])return Pa(this.tiles[ke],Ee);Se>1&&console.log("drilling down to z%d-%d-%d",X,te,pe);let He,_t=X,st=te,$t=pe;for(;!He&&_t>0;)_t--,st>>=1,$t>>=1,He=this.tiles[Xl(_t,st,$t)];return He&&He.source?(Se>1&&(console.log("found parent tile z%d-%d-%d",_t,st,$t),console.time("drilling down")),this.splitTile(He.source,_t,st,$t,X,te,pe),Se>1&&console.timeEnd("drilling down"),this.tiles[ke]?Pa(this.tiles[ke],Ee):null):null}}function Xl(De,X,te){return 32*((1<<De)*te+X)+De}function Kl(De,X){const te=De.tileID.canonical;if(!this._geoJSONIndex)return void X(null,null);const pe=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!pe)return void X(null,null);const Ae=He=>He.tags&&"3d_elevation_id"in He.tags&&"source"in He.tags&&He.tags.source==="elevation",Ee=pe.features.filter(He=>Ae(He));let Se={_geojsonTileLayer:pe.features};Ee.length>0&&(Se={_geojsonTileLayer:pe.features.filter(He=>!Ae(He)),hd_road_elevation:Ee});const $e=new nt(Se),ke=function(He){const _t=new o.bt;for(const st of Object.keys(He))_t.writeMessage(3,Nt,{name:st,features:He[st]});return _t.finish()}(Se).buffer;X(null,{vectorTile:$e,rawData:ke})}class ct extends se{constructor(X,te,pe,Ae,Ee,Se,$e){super(X,te,pe,Ae,Ee,Kl,$e),Se&&(this.loadGeoJSON=Se),this._dynamicIndex=new wt}loadData(X,te){const pe=X&&X.request,Ae=pe&&pe.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(X,(Ee,Se)=>{if(Ee||!Se)return te(Ee);if(typeof Se!="object")return te(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{try{if(X.filter){const ke=o.U(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ke.result==="error")throw new Error(ke.value.map(He=>`${He.key}: ${He.message}`).join(", "));Se.features=Se.features.filter(He=>ke.value.evaluate({zoom:0},He))}X.dynamic?(Se.type==="Feature"&&(Se={type:"FeatureCollection",features:[Se]}),X.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Se.features,this.loaded),X.cluster&&(Se.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=X.cluster?new Bi(function({superclusterOptions:ke,clusterProperties:He}){if(!He||!ke)return ke;const _t={},st={},$t={accumulated:null,zoom:0},tn={properties:null},un=Object.keys(He);for(const kn of un){const[Mn,On]=He[kn],pi=o.U(On),Dn=o.U(typeof Mn=="string"?[Mn,["accumulated"],["get",kn]]:Mn);_t[kn]=pi.value,st[kn]=Dn.value}return ke.map=kn=>{tn.properties=kn;const Mn={};for(const On of un)Mn[On]=_t[On].evaluate($t,tn);return Mn},ke.reduce=(kn,Mn)=>{tn.properties=Mn;for(const On of un)$t.accumulated=kn[On],kn[On]=st[On].evaluate($t,tn)},ke}(X)).load(Se.features):X.dynamic?this._dynamicIndex:function(ke,He){return new rl(ke,He)}(Se,X.geojsonVtOptions)}catch(ke){return te(ke)}const $e={};if(Ae){const ke=k(pe);ke&&($e.resourceTiming={},$e.resourceTiming[X.source]=JSON.parse(JSON.stringify(ke)))}te(null,$e)}})}reloadTile(X,te){const pe=this.loaded;return pe&&pe[X.uid]?X.partial?te(null,void 0):super.reloadTile(X,te):this.loadTile(X,te)}loadGeoJSON(X,te){if(X.request)o.m(X.request,te);else{if(typeof X.data!="string")return te(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return te(null,JSON.parse(X.data))}catch{return te(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(X,te){try{te(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(pe){te(pe)}}getClusterChildren(X,te){try{te(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(pe){te(pe)}}getClusterLeaves(X,te){try{te(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(pe){te(pe)}}}class Oo{constructor(X,te,pe){this.tileID=new o.aO(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.tileZoom=X.tileZoom,this.uid=X.uid,this.zoom=X.zoom,this.canonical=X.tileID.canonical,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=X.projection,this.brightness=te,this.worldview=pe}parse(X,te,pe,Ae){this.status="parsing";const Ee=new o.aO(pe.tileID.overscaledZ,pe.tileID.wrap,pe.tileID.canonical.z,pe.tileID.canonical.x,pe.tileID.canonical.y),Se=[],$e=te.familiesBySource[pe.source],ke=new o.fe(Ee,pe.promoteId);ke.bucketLayerIDs=[],ke.is3DTile=!0,o.ft(X).then(He=>{if(!He)return Ae(new Error("Could not parse tile"));const _t=He.json.extensionsUsed&&He.json.extensionsUsed.includes("MAPBOX_mesh_features")||He.json.asset.extras&&He.json.asset.extras.MAPBOX_mesh_features,st=He.json.extensionsUsed&&He.json.extensionsUsed.includes("EXT_meshopt_compression"),$t=new o.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const tn in $e)for(const un of $e[tn]){const kn=un[0];ke.bucketLayerIDs.push(un.map(pi=>o.B(pi.id,pi.scope))),kn.recalculate($t,[]);const Mn=o.fu(He,1/o.d6(pe.tileID.canonical)),On=new o.fv(un,Mn,Ee,_t,st,this.brightness,ke,this.worldview);_t||(On.needsUpload=!0),Se.push(On),On.evaluate(kn)}this.status="done",Ae(null,{buckets:Se,featureIndex:ke,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(He=>Ae(new Error(He.message)))}}class Dm{constructor(X,te,pe,Ae,Ee,Se,$e,ke){this.actor=X,this.layerIndex=te,this.availableImages=pe,this.availableModels=Ae,this.brightness=$e,this.loading={},this.loaded={},this.worldview=ke}loadTile(X,te){const pe=X.uid,Ae=this.loading[pe]=new Oo(X,this.brightness,this.worldview);o.bu(X.request,(Ee,Se)=>{const $e=!this.loading[pe];return delete this.loading[pe],$e||Ee?(Ae.status="done",$e||(this.loaded[pe]=Ae),te(Ee)):Se&&Se.byteLength!==0?void Ae.parse(Se,this.layerIndex,X,(ke,He)=>{Ae.status="done",this.loaded=this.loaded||{},this.loaded[pe]=Ae,ke||!He?te(ke):te(null,He)}):(Ae.status="done",this.loaded[pe]=Ae,te())})}reloadTile(X,te){const pe=this.loaded,Ae=X.uid;if(pe&&pe[Ae]){const Ee=pe[Ae];Ee.projection=X.projection,Ee.brightness=X.brightness;const Se=($e,ke)=>{Ee.reloadCallback&&(delete Ee.reloadCallback,this.loadTile(X,te)),te($e,ke)};Ee.status==="parsing"?Ee.reloadCallback=Se:Ee.status==="done"&&this.loadTile(X,te)}}abortTile(X,te){const pe=X.uid;this.loading[pe]&&delete this.loading[pe],te()}removeTile(X,te){const pe=this.loaded,Ae=X.uid;pe&&pe[Ae]&&delete pe[Ae],te()}}class Vc{constructor(X){this.self=X,this.actor=new o.fx(X,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cl({name:"mercator"}),this.workerSourceTypes={vector:se,geojson:ct,"raster-dem":Y,"raster-array":ae,"batched-model":Dm},this.workerSources={},this.self.registerWorkerSource=(te,pe)=>{if(this.workerSourceTypes[te])throw new Error(`Worker source with name "${te}" already registered.`);this.workerSourceTypes[te]=pe},this.self.registerRTLTextPlugin=te=>{if(o.fy.isParsed())throw new Error("RTL text plugin already registered.");o.fy.setState({pluginStatus:o.fz.parsed,pluginURL:o.fy.getPluginURL()}),o.fy.applyArabicShaping=te.applyArabicShaping,o.fy.processBidirectionalText=te.processBidirectionalText,o.fy.processStyledBidirectionalText=te.processStyledBidirectionalText;for(const pe of this.rtlPluginParsingListeners)pe(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(X,te,pe){delete this.layerIndexes[X],delete this.availableImages[X],delete this.availableModels[X],delete this.workerSources[X],pe()}checkIfReady(X,te,pe){pe()}setReferrer(X,te){this.referrer=te}spriteLoaded(X,te){this.isSpriteLoaded[X]||(this.isSpriteLoaded[X]={});const{scope:pe,isLoaded:Ae}=te;if(this.isSpriteLoaded[X][pe]=Ae,this.workerSources[X]&&this.workerSources[X][pe])for(const Ee in this.workerSources[X][pe]){const Se=this.workerSources[X][pe][Ee];for(const $e in Se){const ke=Se[$e];ke instanceof se&&(ke.isSpriteLoaded=Ae,ke.fire(new o.z("isSpriteLoaded")))}}}setImages(X,te,pe){this.availableImages[X]||(this.availableImages[X]={});const{scope:Ae,images:Ee}=te;if(this.availableImages[X][Ae]=Ee,this.workerSources[X]&&this.workerSources[X][Ae]){for(const Se in this.workerSources[X][Ae]){const $e=this.workerSources[X][Ae][Se];for(const ke in $e)$e[ke].availableImages=Ee}pe()}else pe()}setModels(X,{scope:te,models:pe},Ae){if(this.availableModels[X]||(this.availableModels[X]={}),this.availableModels[X][te]=pe,this.workerSources[X]&&this.workerSources[X][te]){for(const Ee in this.workerSources[X][te]){const Se=this.workerSources[X][te][Ee];for(const $e in Se)Se[$e].availableModels=pe}Ae()}else Ae()}setProjection(X,te){this.projections[X]=o.cl(te)}setBrightness(X,te,pe){this.brightness=te,pe()}setWorldview(X,te,pe){this.worldview=te,pe()}setLayers(X,te,pe){this.getLayerIndex(X,te.scope).replace(te.layers,te.options),pe()}updateLayers(X,te,pe){this.getLayerIndex(X,te.scope).update(te.layers,te.removedIds,te.options),pe()}loadTile(X,te,pe){te.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,te.type,te.source,te.scope).loadTile(te,pe)}decodeRasterArray(X,te,pe){this.getWorkerSource(X,te.type,te.source,te.scope).decodeRasterArray(te,pe)}reloadTile(X,te,pe){te.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,te.type,te.source,te.scope).reloadTile(te,pe)}abortTile(X,te,pe){this.getWorkerSource(X,te.type,te.source,te.scope).abortTile(te,pe)}removeTile(X,te,pe){this.getWorkerSource(X,te.type,te.source,te.scope).removeTile(te,pe)}removeSource(X,te,pe){if(!(this.workerSources[X]&&this.workerSources[X][te.scope]&&this.workerSources[X][te.scope][te.type]&&this.workerSources[X][te.scope][te.type][te.source]))return;const Ae=this.workerSources[X][te.scope][te.type][te.source];delete this.workerSources[X][te.scope][te.type][te.source],Ae.removeSource!==void 0?Ae.removeSource(te,pe):pe()}loadWorkerSource(X,te,pe){try{this.self.importScripts(te.url),pe()}catch(Ae){pe(Ae.toString())}}syncRTLPluginState(X,te,pe){if(o.fy.isParsed())pe(null,!0);else if(o.fy.isParsing())this.rtlPluginParsingListeners.push(pe);else try{o.fy.setState(te);const Ae=o.fy.getPluginURL();!o.fy.isLoaded()||o.fy.isParsed()||o.fy.isParsing()||Ae==null||(o.fy.setState({pluginStatus:o.fz.parsing,pluginURL:o.fy.getPluginURL()}),this.self.importScripts(Ae),o.fy.isParsed()?pe(null,!0):this.rtlPluginParsingListeners.push(pe))}catch(Ae){pe(Ae.toString())}}setDracoUrl(X,te){this.dracoUrl=te}getAvailableImages(X,te){this.availableImages[X]||(this.availableImages[X]={});let pe=this.availableImages[X][te];return pe||(pe=[]),pe}getAvailableModels(X,te){this.availableModels[X]||(this.availableModels[X]={});let pe=this.availableModels[X][te];return pe||(pe={}),pe}getLayerIndex(X,te){this.layerIndexes[X]||(this.layerIndexes[X]={});let pe=this.layerIndexes[X][te];return pe||(pe=this.layerIndexes[X][te]=new V,pe.scope=te),pe}getWorkerSource(X,te,pe,Ae){const Ee=this.workerSources;return Ee[X]||(Ee[X]={}),Ee[X][Ae]||(Ee[X][Ae]={}),Ee[X][Ae][te]||(Ee[X][Ae][te]={}),this.isSpriteLoaded[X]||(this.isSpriteLoaded[X]={}),Ee[X][Ae][te][pe]||(Ee[X][Ae][te][pe]=new this.workerSourceTypes[te]({send:(Se,$e,ke,He,_t,st)=>this.actor.send(Se,$e,ke,X,_t,st),scheduler:this.actor.scheduler},this.getLayerIndex(X,Ae),this.getAvailableImages(X,Ae),this.getAvailableModels(X,Ae),this.isSpriteLoaded[X][Ae],void 0,this.brightness,this.worldview)),Ee[X][Ae][te][pe]}rasterizeImagesWorker(X,te,pe){const Ae=new Map;for(const[Ee,{image:Se,imageVariant:$e}]of te.tasks.entries()){const ke=this.imageRasterizer.rasterize($e,Se,te.scope,X);Ae.set(Ee,ke)}pe(void 0,Ae)}removeRasterizedImages(X,te,pe){this.imageRasterizer.removeImagesFromCacheByIds(te.imageIds,te.scope,X),pe()}enforceCacheSizeLimit(X,te){o.fA(te)}getWorkerPerformanceMetrics(X,te,pe){pe(void 0,void 0)}}return o.fw(self)&&(self.worker=new Vc(self)),Vc}),w(["./shared"],function(o){var k="3.15.0";const L={create:"create",load:"load",fullLoad:"fullLoad"},N={mark(d){performance.mark(d)},measure(d,n,a){performance.measure(d,n,a)}};function V(d){const n=d.name.split("?")[0];return o.a(n)&&n.includes("mapbox-gl.js")?"javascript":o.a(n)&&n.includes("mapbox-gl.css")?"css":o.b(n)?"fontRange":o.c(n)?"sprite":o.i(n)?"style":o.d(n)?"tilejson":"other"}var H,ne={},ce=function(){if(H)return ne;function d(h){return!n(h)}function n(h){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,x,T=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(T);try{x=new Worker(I),y=!0}catch{y=!1}return x&&x.terminate(),URL.revokeObjectURL(I),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var x=y.getContext("2d");if(!x)return!1;var T=x.getImageData(0,0,1,1);return T&&T.width===y.width}()?(a[g=h&&h.failIfMajorPerformanceCaveat]===void 0&&(a[g]=function(y){var x,T=function(I){var P=document.createElement("canvas"),R=Object.create(d.webGLContextAttributes);return R.failIfMajorPerformanceCaveat=I,P.getContext("webgl2",R)}(y);if(!T)return!1;try{x=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!x||T.isContextLost())&&(T.shaderSource(x,"void main() {}"),T.compileShader(x),T.getShaderParameter(x,T.COMPILE_STATUS)===!0)}(g)),a[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}H=1,ne.supported=d,ne.notSupportedReason=n;var a={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ne}();function K(d,n,a){const h=document.createElement(d);return n!=null&&(h.className=n),a&&a.appendChild(h),h}function se(d,n,a){const h=document.createElementNS("http://www.w3.org/2000/svg",d);for(const g of Object.keys(n))h.setAttributeNS(null,g,String(n[g]));return a&&a.appendChild(h),h}const Y=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Q=Y&&Y.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ae;function Te(){Y&&Q&&(ae=Y[Q],Y[Q]="none")}function Be(){Y&&Q&&(Y[Q]=ae)}function et(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",et,!0)}function nt(){window.addEventListener("click",et,!0),window.setTimeout(()=>{window.removeEventListener("click",et,!0)},0)}function Je(d,n){const a=d.getBoundingClientRect();return xt(d,a,n)}function Dt(d,n){const a=d.getBoundingClientRect(),h=[];for(let g=0;g<n.length;g++)h.push(xt(d,a,n[g]));return h}function wt(d){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&d.button===2&&d.ctrlKey?0:d.button}function xt(d,n,a){const h=d.offsetWidth===n.width?1:d.offsetWidth/n.width;return new o.P((a.clientX-n.left)*h,(a.clientY-n.top)*h)}const qt="01",ln="NO_ACCESS_TOKEN";class Ht{constructor(n,a,h){this._transformRequestFn=n,this._customAccessToken=a,this._silenceAuthErrors=!!h,this._createSkuToken()}_createSkuToken(){const n=function(){let a="";for(let h=0;h<10;h++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",qt,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,a){return this._transformRequestFn&&this._transformRequestFn(n,a)||{url:n}}normalizeStyleURL(n,a){if(!o.h(n))return n;const h=pn(n);return h.params.push(`sdk=js-${k}`),h.path=`/styles/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||a)}normalizeGlyphsURL(n,a){if(!o.h(n))return n;const h=pn(n);return h.path=`/fonts/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||a)}normalizeModelURL(n,a){if(!o.h(n))return n;const h=pn(n);return h.path=`/models/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||a)}normalizeSourceURL(n,a,h,g){if(!o.h(n))return n;const y=pn(n);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),h&&y.params.push(`language=${h}`),g&&y.params.push(`worldview=${g}`),this._makeAPIURL(y,this._customAccessToken||a)}normalizeIconsetURL(n,a){const h=pn(n);return o.h(n)?(h.path=`/styles/v1${h.path}/iconset.pbf`,this._makeAPIURL(h,this._customAccessToken||a)):Rn(h)}normalizeSpriteURL(n,a,h,g){const y=pn(n);return o.h(n)?(y.path=`/styles/v1${y.path}/sprite${a}${h}`,this._makeAPIURL(y,this._customAccessToken||g)):(y.path+=`${a}${h}`,Rn(y))}normalizeTileURL(n,a,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!o.h(n))return n;const g=pn(n);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||h&&g.authority!=="raster"&&h===512?"@2x":""}${o.k.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${o.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${o.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${o.e.TILE_URL_VERSION}${g.path}`);const y=this._customAccessToken||function(x){for(const T of x){const I=T.match(/^access_token=(.*)$/);if(I)return I[1]}return null}(g.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,y)}canonicalizeTileURL(n,a){const h=pn(n);if(!h.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!h.path.match(/\.[\w]+$/))return n;let g="mapbox://";h.path.match(/^\/raster\/v1\//)?g+=`raster/${h.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:h.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${h.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${h.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let y=h.params;return a&&(y=y.filter(x=>!x.match(/^access_token=/))),y.length&&(g+=`?${y.join("&")}`),g}canonicalizeTileset(n,a){const h=!!a&&o.h(a),g=[];for(const y of n.tiles||[])o.j(y)?g.push(this.canonicalizeTileURL(y,h)):g.push(y);return g}_makeAPIURL(n,a){const h="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=pn(o.e.API_URL);if(n.protocol=g.protocol,n.authority=g.authority,n.protocol==="http"){const y=n.params.indexOf("secure");y>=0&&n.params.splice(y,1)}if(g.path!=="/"&&(n.path=`${g.path}${n.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return Rn(n);if(a=a||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${h}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${h}`)}return n.params=n.params.filter(y=>y.indexOf("access_token")===-1),n.params.push(`access_token=${a||""}`),Rn(n)}}const cn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function pn(d){const n=d.match(cn);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Rn(d){const n=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${n}`}const Nt="mapbox.eventData";function sn(d){if(!d)return null;const n=d.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(o.l(n[1]))}catch{return null}}class Tn{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const a=sn(o.e.ACCESS_TOKEN);let h="";return h=a&&a.u?o.f(a.u):o.e.ACCESS_TOKEN||"",n?`${Nt}.${n}:${h}`:`${Nt}:${h}`}fetchEventData(){const n=o.s("localStorage"),a=this.getStorageKey(),h=this.getStorageKey("uuid");if(n)try{const g=localStorage.getItem(a);g&&(this.eventData=JSON.parse(g));const y=localStorage.getItem(h);y&&(this.anonId=y)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const n=o.s("localStorage"),a=this.getStorageKey(),h=this.getStorageKey("uuid"),g=this.anonId;if(n&&g)try{localStorage.setItem(h,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,a,h,g){if(!o.e.EVENTS_URL)return;const y=pn(o.e.EVENTS_URL);y.params.push(`access_token=${g||o.e.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(n).toISOString()},T=a?Object.assign(x,a):x,I={url:Rn(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};this.pendingRequest=o.p(I,P=>{this.pendingRequest=null,h(P),this.saveEventData(),this.processRequests(g)})}queueRequest(n,a){this.queue.push(n),this.processRequests(a)}}const on=new class extends Tn{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,n){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(a=>o.h(a)||o.j(a))&&this.queueRequest(Date.now(),n)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=sn(o.e.ACCESS_TOKEN),a=n?n.u:o.e.ACCESS_TOKEN;let h=a!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),h=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),x=new Date(g),T=(g-this.eventData.lastSuccess)/864e5;h=h||T>=1||T<-1||y.getDate()!==x.getDate()}else h=!0;h?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:qt,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=g,this.eventData.tokenU=a)},d):this.processRequests()}},Xn=on.postTurnstileEvent.bind(on),_r=new class extends Tn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,n,a,h){this.skuToken=n,this.errorCb=h,o.e.EVENTS_URL&&(a||o.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},a):this.errorCb(new Error(ln)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:qt,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):n&&(this.success[n]=!0)},d))}remove(){this.errorCb=null}},ir=_r.postMapLoadEvent.bind(_r),Qr=new class extends Tn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let n=this.mapInstanceIdMap.get(d);return n||(n=o.u(),this.mapInstanceIdMap.set(d,n)),n}getEventId(d){const n=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,n+1),n}postStyleLoadEvent(d,n){const{map:a,style:h,importedStyles:g}=n;if(!o.e.EVENTS_URL||!d&&!o.e.ACCESS_TOKEN)return;const y=this.getMapInstanceId(a),x={mapInstanceId:y,eventId:this.getEventId(y),style:h};g.length&&(x.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:x},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:a}=this.queue.shift();this.postEvent(n,a,()=>{},d)}},Vn=Qr.postStyleLoadEvent.bind(Qr),Wn=new class extends Tn{constructor(){super("gljs.performance")}postPerformanceEvent(d,n){o.e.EVENTS_URL&&(d||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:a}=this.queue.shift(),h=function(g){const y=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),T=function(j){const U={};if(j){for(const G in j)if(G!=="other")for(const J of j[G]){const Z=`${G}ResolveRangeMin`,ee=`${G}ResolveRangeMax`,oe=`${G}RequestCount`,ue=`${G}RequestCachedCount`;U[Z]=Math.min(U[Z]||1/0,J.startTime),U[ee]=Math.max(U[ee]||-1/0,J.responseEnd);const ye=ge=>{U[ge]===void 0&&(U[ge]=0),++U[ge]};J.transferSize!==void 0&&J.transferSize===0&&ye(ue),ye(oe)}}return U}(function(j,U){const G={};if(j)for(const J of j){const Z=U(J);G[Z]===void 0&&(G[Z]=[]),G[Z].push(J)}return G}(y,V)),I=window.devicePixelRatio,P=navigator.connection||navigator.mozConnection||navigator.webkitConnection,R=P?P.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},D=(j,U,G)=>{G!=null&&j.push({name:U,value:G.toString()})};for(const j in T)D(F.counters,j,T[j]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(D(F.counters,"interactionRangeMin",g.interactionRange[0]),D(F.counters,"interactionRangeMax",g.interactionRange[1])),x)for(const j of Object.keys(L)){const U=L[j],G=x.find(J=>J.name===U);G&&D(F.counters,U,G.startTime)}return D(F.counters,"visibilityHidden",g.visibilityHidden),D(F.attributes,"style",function(j){if(j)for(const U of j){const G=U.name.split("?")[0];if(o.i(G)){const J=G.split("/").slice(-2);if(J.length===2)return`mapbox://styles/${J[0]}/${J[1]}`}}}(y)),D(F.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),D(F.attributes,"fogEnabled",g.fogEnabled?"true":"false"),D(F.attributes,"projection",g.projection),D(F.attributes,"zoom",g.zoom),D(F.metadata,"devicePixelRatio",I),D(F.metadata,"connectionEffectiveType",R),D(F.metadata,"navigatorUserAgent",navigator.userAgent),D(F.metadata,"screenWidth",window.screen.width),D(F.metadata,"screenHeight",window.screen.height),D(F.metadata,"windowWidth",window.innerWidth),D(F.metadata,"windowHeight",window.innerHeight),D(F.metadata,"mapWidth",g.width/I),D(F.metadata,"mapHeight",g.height/I),D(F.metadata,"webglRenderer",g.renderer),D(F.metadata,"webglVendor",g.vendor),D(F.metadata,"sdkVersion",k),D(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(a);for(const g of h.metadata);for(const g of h.counters);for(const g of h.attributes);this.postEvent(n,h,()=>{},d)}},ci=Wn.postPerformanceEvent.bind(Wn),rr=new class extends Tn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,n,a,h){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const g=pn(o.e.API_URL+o.e.SESSION_PATH);g.params.push(`sku=${n||""}`),g.params.push(`access_token=${h||o.e.ACCESS_TOKEN||""}`);const y={url:Rn(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(y,x=>{this.pendingRequest=null,a(x),this.saveEventData(),this.processRequests(h)})}getSessionAPI(d,n,a,h){this.skuToken=n,this.errorCb=h,o.e.SESSION_PATH&&o.e.API_URL&&(a||o.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},a):this.errorCb(new Error(ln)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||this.getSession(a,this.skuToken,h=>{h?this.errorCb(h):n&&(this.success[n]=!0)},d)}remove(){this.errorCb=null}},ui=rr.getSessionAPI.bind(rr),Bi=new Set;function Sn(d,n){n?Bi.add(d):Bi.delete(d)}class ji{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,a){this._updatedSourceCaches[n]=a,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const a=n.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(n.id),this.setDirty()}removeLayer(n){const a=n.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][n.id]=n,this._updatedLayers[a].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const a in this._updatedLayers)n[a]=n[a]||{},n[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)n[a]=n[a]||{},n[a].removedIds=Object.keys(this._removedLayers[a]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,a){this._updatedImages[a]=this._updatedImages[a]||new Set,this._updatedImages[a].add(o.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Li(d){const{userImage:n}=d;return!!(n&&n.render&&n.render())&&(d.data.replace(new Uint8Array(n.data.buffer)),!0)}class ii extends o.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&o.r()&&(this.imageRasterizerDispatcher=new o.D(o.t(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new o.q({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const a=this.atlasTexture.get(n);a&&(a.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,a){this.imageProviders.has(a)||this.imageProviders.set(a,new Map),this.imageProviders.get(a).set(n.id,n)}removeImageProvider(n,a){this.imageProviders.has(a)&&this.imageProviders.get(a).delete(n)}getPendingImageProviders(){const n=[];for(const a of this.imageProviders.values())for(const h of a.values())h.hasPendingRequests()&&n.push(h);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.x),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,a){if(this.loaded.get(a)!==n&&(this.loaded.set(a,n),n)){for(const{ids:h,callback:g}of this.requestors)this._notify(h,a,g);this.requestors=[]}}hasImage(n,a){return!!this.getImage(n,a)}getImage(n,a){return this.images.get(a).get(n.toString())}addImage(n,a,h){this._validate(n,h)&&this.images.get(a).set(n.toString(),h)}_validate(n,a){let h=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new o.y(new Error(`Image "${n.name}" has invalid "stretchX" value`))),h=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new o.y(new Error(`Image "${n.name}" has invalid "stretchY" value`))),h=!1),this._validateContent(a.content,a)||(this.fire(new o.y(new Error(`Image "${n.name}" has invalid "content" value`))),h=!1),h}_validateStretch(n,a){if(!n)return!0;let h=0;for(const g of n){if(g[0]<h||g[1]<g[0]||a<g[1])return!1;h=g[1]}return!0}_validateContent(n,a){return n?n.length!==4||!a.usvg&&(n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,a,h){const g=this.images.get(a).get(n.toString());h.version=g.version+1,this.images.get(a).set(n.toString(),h),this.updatedImages.get(a).add(n),this.removeFromImageRasterizerCache(n,a)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,a){this.spriteFormat!=="raster"&&(o.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([n],a))}removeImage(n,a){const h=this.images.get(a),g=h.get(n.toString());h.delete(n.toString()),this.patterns.get(a).delete(n.toString()),this.removeFromImageRasterizerCache(n,a),g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map(a=>o.I.from(a))}getImages(n,a,h){const g=[],y=[],x=this.imageProviders.get(a);for(const R of n){if(!R.iconsetId){g.push(R);continue}const F=x.get(R.iconsetId);F&&(this.getImage(R,a)?y.push(R):F.addPendingRequest(R))}if(g.length===0)return void this._notify(y,a,h);let T=!0;const I=!!this.loaded.get(a),P=this.images.get(a);if(!I)for(const R of g)P.has(R.toString())||(T=!1);I||T?this._notify(g,a,h):this.requestors.push({ids:g,scope:a,callback:h})}rasterizeImages(n,a){const h=new Map,{tasks:g,scope:y}=n;for(const[x,T]of g.entries()){const I=this.getImage(T.id,y);I&&h.set(x,{image:I,imageVariant:T})}this._rasterizeImages(y,h,a)}_rasterizeImages(n,a,h){if(o.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:a,scope:n},h);else{const g=new Map;for(const[y,{image:x,imageVariant:T}]of a.entries())g.set(y,this.imageRasterizer.rasterize(T,x,n,0));h(void 0,g)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,a,h){const g=this.images.get(a),y=new Map;for(const x of n){if(!g.get(x.toString())){if(x.iconsetId)continue;this.fire(new o.z("styleimagemissing",{id:x.name}))}const T=g.get(x.toString());if(!T){o.w(`Image "${x.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const I={data:T.usvg?null:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,usvg:T.usvg,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)};T.usvg&&Object.assign(I,{width:T.icon.usvg_tree.width,height:T.icon.usvg_tree.height}),y.set(o.I.toString(x),I)}h(null,y)}getPixelSize(n){const{width:a,height:h}=this.atlasImage.get(n);return{width:a,height:h}}getPattern(n,a,h){const g=n.toString(),y=this.patterns.get(a),x=y.get(g),T=this.getImage(n,a);if(!T)return null;if(x){if(x.position.version===T.version)return x.position;x.position.version=T.version}else{if(T.usvg&&!T.data){const I=this.getPatternInFlightId(g,a);if(this.patternsInFlight.has(I))return null;this.patternsInFlight.add(I);const P=new o.A(n).scaleSelf(o.o.devicePixelRatio),R=new Map([[P.toString(),{image:T,imageVariant:P}]]);return this._rasterizeImages(a,R,(F,D)=>this.storePatternImage(P,a,T,h,D)),null}this.storePattern(n,a,T)}return this._updatePatternAtlas(a,h),y.get(g).position}getPatternInFlightId(n,a){return o.B(n,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,a,h,g,y){const x=n.toString(),T=y?y.get(x):void 0;T&&(h.data=T,this.storePattern(n.id,a,h),this._updatePatternAtlas(a,g),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),a)))}storePattern(n,a,h){const g={w:h.data.width+2*o.C,h:h.data.height+2*o.C,x:0,y:0},y=new o.F(g,h,o.C);this.patterns.get(a).set(n.toString(),{bin:g,position:y})}destroyAtlasTextures(){for(const n of this.atlasTexture.values())n&&n.destroy();this.atlasTexture.clear()}bind(n,a){const h=n.gl;let g=this.atlasTexture.get(a);g?this.dirty&&(g.update(this.atlasImage.get(a)),this.dirty=!1):(g=new o.T(n,this.atlasImage.get(a),h.RGBA8),this.atlasTexture.set(a,g)),g.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(n,a){const h=this.patterns.get(n),g=Array.from(h.values()).map(({bin:P})=>P),{w:y,h:x}=o.G(g),T=this.atlasImage.get(n);T.resize({width:y||1,height:x||1});const I=this.images.get(n);for(const[P,{bin:R,position:F}]of h.entries()){let D=F.padding;const j=R.x+D,U=R.y+D,G=I.get(P).data,J=G.width,Z=G.height;D=D>1?D-1:D,o.q.copy(G,T,{x:0,y:0},{x:j,y:U},{width:J,height:Z},a),o.q.copy(G,T,{x:0,y:Z-D},{x:j,y:U-D},{width:J,height:D},a),o.q.copy(G,T,{x:0,y:0},{x:j,y:U+Z},{width:J,height:D},a),o.q.copy(G,T,{x:J-D,y:0},{x:j-D,y:U},{width:D,height:Z},a),o.q.copy(G,T,{x:0,y:0},{x:j+J,y:U},{width:D,height:Z},a),o.q.copy(G,T,{x:J-D,y:Z-D},{x:j-D,y:U-D},{width:D,height:D},a),o.q.copy(G,T,{x:0,y:Z-D},{x:j+J,y:U-D},{width:D,height:D},a),o.q.copy(G,T,{x:0,y:0},{x:j+J,y:U+Z},{width:D,height:D},a),o.q.copy(G,T,{x:J-D,y:0},{x:j-D,y:U+Z},{width:D,height:D},a)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,a){const h=this.images.get(a);for(const g of n){if(this.callbackDispatchedThisFrame.get(a).has(g.toString()))continue;this.callbackDispatchedThisFrame.get(a).add(g.toString());const y=h.get(g.toString());Li(y)&&this.updateImage(g,a,y)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function fs(d){const n=d.value,a=d.valueSpec,h=d.style,g=d.styleSpec,y=d.key,x=d.arrayElementValidator||Ri;if(!Array.isArray(n))return[new o.V(y,n,`array expected, ${o.K(n)} found`)];if(a.length&&n.length!==a.length)return[new o.V(y,n,`array length ${a.length} expected, length ${n.length} found`)];if(a["min-length"]&&n.length<a["min-length"])return[new o.V(y,n,`array length at least ${a["min-length"]} expected, length ${n.length} found`)];let T={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};g.$version<7&&(T.function=a.function),o.H(a.value)&&(T=a.value);let I=[];for(let P=0;P<n.length;P++)I=I.concat(x({array:n,arrayIndex:P,value:n[P],valueSpec:T,style:h,styleSpec:g,key:`${y}[${P}]`},!0));return I}function es(d){const n=d.key,a=d.value,h=d.valueSpec;if(!o.L(a))return[new o.V(n,a,`number expected, ${o.K(a)} found`)];if(a!=a)return[new o.V(n,a,"number expected, NaN found")];if("minimum"in h){let g=h.minimum;if(Array.isArray(h.minimum)&&(g=h.minimum[d.arrayIndex]),a<g)return[new o.V(n,a,`${a} is less than the minimum value ${g}`)]}if("maximum"in h){let g=h.maximum;if(Array.isArray(h.maximum)&&(g=h.maximum[d.arrayIndex]),a>g)return[new o.V(n,a,`${a} is greater than the maximum value ${g}`)]}return[]}function Qs(d){const n=d.key,a=d.value;if(!o.H(a))return[new o.V(n,a,`object expected, ${o.K(a)} found`)];const h=d.valueSpec,g=o.J(a.type);let y,x,T,I={};const P=g!=="categorical"&&a.property===void 0,R=!P,F=function(G){const J=G.stops;return Array.isArray(J)&&Array.isArray(J[0])&&o.H(J[0][0])}(a),D=vr({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(G){if(g==="identity")return[new o.V(G.key,G.value,'identity function may not have a "stops" property')];let J=[];const Z=G.value;return J=J.concat(fs({key:G.key,value:Z,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:j})),Array.isArray(Z)&&Z.length===0&&J.push(new o.V(G.key,Z,"array must have at least one stop")),J},default:function(G){return Ri({key:G.key,value:G.value,valueSpec:h,style:G.style,styleSpec:G.styleSpec})}}});return g==="identity"&&P&&D.push(new o.V(d.key,d.value,'missing required property "property"')),g==="identity"||a.stops||D.push(new o.V(d.key,d.value,'missing required property "stops"')),g==="exponential"&&h.expression&&!o.M(h)&&D.push(new o.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(R&&!o.N(h)?D.push(new o.V(d.key,d.value,"property functions not supported")):P&&!o.O(h)&&D.push(new o.V(d.key,d.value,"zoom functions not supported"))),g!=="categorical"&&!F||a.property!==void 0||D.push(new o.V(d.key,d.value,'"property" property is required')),D;function j(G){let J=[];const Z=G.value,ee=G.key;if(!Array.isArray(Z))return[new o.V(ee,Z,`array expected, ${o.K(Z)} found`)];if(Z.length!==2)return[new o.V(ee,Z,`array length 2 expected, length ${Z.length} found`)];if(F){if(!o.H(Z[0]))return[new o.V(ee,Z,`object expected, ${o.K(Z[0])} found`)];const oe=Z[0];if(oe.zoom===void 0)return[new o.V(ee,Z,"object stop key must have zoom")];if(oe.value===void 0)return[new o.V(ee,Z,"object stop key must have value")];const ue=o.J(oe.zoom);if(typeof ue!="number")return[new o.V(ee,oe.zoom,"stop zoom values must be numbers")];if(T&&T>ue)return[new o.V(ee,oe.zoom,"stop zoom values must appear in ascending order")];ue!==T&&(T=ue,x=void 0,I={}),J=J.concat(vr({key:`${ee}[0]`,value:Z[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:es,value:U}}))}else J=J.concat(U({key:`${ee}[0]`,value:Z[0],style:G.style,styleSpec:G.styleSpec},Z));return o.Q(o.S(Z[1]))?J.concat([new o.V(`${ee}[1]`,Z[1],"expressions are not allowed in function stops.")]):J.concat(Ri({key:`${ee}[1]`,value:Z[1],valueSpec:h,style:G.style,styleSpec:G.styleSpec}))}function U(G,J){const Z=o.K(G.value),ee=o.J(G.value),oe=G.value!==null?G.value:J;if(y){if(Z!==y)return[new o.V(G.key,oe,`${Z} stop domain type must match previous stop domain type ${y}`)]}else y=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean"&&typeof ee!="number"&&typeof ee!="string"&&typeof ee!="boolean")return[new o.V(G.key,oe,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&g!=="categorical"){let ue=`number expected, ${Z} found`;return o.N(h)&&g===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(G.key,oe,ue)]}return g!=="categorical"||Z!=="number"||typeof ee=="number"&&isFinite(ee)&&Math.floor(ee)===ee?g!=="categorical"&&Z==="number"&&typeof ee=="number"&&typeof x=="number"&&x!==void 0&&ee<x?[new o.V(G.key,oe,"stop domain values must appear in ascending order")]:(x=ee,g==="categorical"&&ee in I?[new o.V(G.key,oe,"stop domain values must be unique")]:(I[ee]=!0,[])):[new o.V(G.key,oe,`integer expected, found ${String(ee)}`)]}}function lr(d){const n=(d.expressionContext==="property"?o.W:o.U)(o.S(d.value),d.valueSpec);if(n.result==="error")return n.value.map(h=>new o.V(`${d.key}${h.key}`,d.value,h.message));const a=n.value.expression||n.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!a.outputDefined())return[new o.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!o.Z(a))return[new o.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return ps(a,d);if(d.expressionContext==="appearance")return Nr(a,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!o.X(a,["zoom","feature-state"]))return[new o.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!o.Y(a))return[new o.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ps(d,n){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const g of n.valueSpec.expression.parameters)a.delete(g);if(a.size===0)return[];const h=[];return d instanceof o._&&a.has(d.name)?[new o.V(n.key,n.value,`["${d.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(d.eachChild(g=>{h.push(...ps(g,n))}),h)}function Nr(d,n){const a=new Set;if(n.valueSpec&&n.valueSpec.expression)for(const g of n.valueSpec.expression.parameters)a.add(g);if(a.size===0)return[];const h=[];return d instanceof o._&&!a.has(d.name)?[new o.V(n.key,n.value,`["${d.name}"] is not an allowed parameter`)]:(d.eachChild(g=>{h.push(...Nr(g,n))}),h)}function eo(d){const n=d.key,a=d.value,h=d.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(o.J(a))===-1&&g.push(new o.V(n,a,`expected one of [${h.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(h.values).indexOf(o.J(a))===-1&&g.push(new o.V(n,a,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(a)} found`)),g}function to(d){return o.a2(o.S(d.value))?lr(Object.assign({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):ra(d)}function ra(d){const n=d.value,a=d.key;if(!Array.isArray(n))return[new o.V(a,n,`array expected, ${o.K(n)} found`)];if(n.length<1)return[new o.V(a,n,"filter array must have at least 1 element")];const h=d.styleSpec;let g=eo({key:`${a}[0]`,value:n[0],valueSpec:h.filter_operator});switch(o.J(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&o.J(n[1])==="$type"&&g.push(new o.V(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&g.push(new o.V(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(o.a0(n[1])||g.push(new o.V(`${a}[1]`,n[1],`string expected, ${o.K(n[1])} found`)));for(let y=2;y<n.length;y++)o.J(n[1])==="$type"?g=g.concat(eo({key:`${a}[${y}]`,value:n[y],valueSpec:h.geometry_type})):o.a0(n[y])||o.L(n[y])||o.$(n[y])||g.push(new o.V(`${a}[${y}]`,n[y],`string, number, or boolean expected, ${o.K(n[y])} found.`));break;case"any":case"all":case"none":for(let y=1;y<n.length;y++)g=g.concat(ra({key:`${a}[${y}]`,value:n[y],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":n.length!==2?g.push(new o.V(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):o.a0(n[1])||g.push(new o.V(`${a}[1]`,n[1],`string expected, ${o.K(n[1])} found`))}return g}function sa(d,n){const a=d.key,h=d.style,g=d.layer,y=d.styleSpec,x=d.value,T=d.objectKey,I=y[`${n}_${d.layerType}`];if(!I)return[];const P=T.match(/^(.*)-use-theme$/);if(P&&I[P[1]])return o.Q(x)?[].concat(Ri({key:d.key,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:h,styleSpec:y,expressionContext:"property",propertyType:n,propertyKey:T})):Ri({key:a,value:x,valueSpec:{type:"string"},style:h,styleSpec:y});const R=T.match(/^(.*)-transition$/);if(n==="paint"&&R&&I[R[1]]&&I[R[1]].transition)return Ri({key:a,value:x,valueSpec:y.transition,style:h,styleSpec:y});const F=d.valueSpec||I[T];if(!F)return[new o.a3(a,x,`unknown property "${T}"`)];let D;if(o.a0(x)&&o.N(F)&&!F.tokens&&(D=/^{([^}]+)}$/.exec(x))){const U=`\`{ "type": "identity", "property": ${D?JSON.stringify(D[1]):'"_"'} }\``;return[new o.V(a,x,`"${T}" does not support interpolation syntax
Use an identity property function instead: ${U}.`)]}const j=[];if(d.layerType==="symbol")T!=="text-field"||!h||h.glyphs||h.imports||j.push(new o.V(a,x,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&o.a4(o.S(x))&&o.J(x.type)==="identity"&&j.push(new o.V(a,x,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&n==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&o.N(F)&&(o.a5(F)||o.O(F))){const U=o.W(o.S(x),F),G=U.value.expression||U.value._styleExpression.expression;G&&!o.X(G,["measure-light"])&&(T==="model-emissive-strength"&&o.Y(G)&&o.Z(G)||j.push(new o.V(a,x,`${T} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return j.concat(Ri({key:d.key,value:x,valueSpec:F,style:h,styleSpec:y,expressionContext:"property",propertyType:n,propertyKey:T}))}function os(d){return sa(d,"paint")}function ms(d){return sa(d,"layout")}function ql(d){let n=[];const a=d.value,h=d.key,g=d.style,y=d.styleSpec;if(!o.H(a))return[new o.V(h,a,"object expected")];a.type||a.ref||n.push(new o.V(h,a,'either "type" or "ref" is required'));let x=o.J(a.type);const T=o.J(a.ref);if(a.id){const I=o.J(a.id);for(let P=0;P<d.arrayIndex;P++){const R=g.layers[P];o.J(R.id)===I&&n.push(new o.V(h,a.id,`duplicate layer id "${I}", previously used at line ${R.id.__line__}`))}}if("ref"in a){let I;["type","source","source-layer","filter","layout"].forEach(P=>{P in a&&n.push(new o.V(h,a[P],`"${P}" is prohibited for ref layers`))}),g.layers.forEach(P=>{o.J(P.id)===T&&(I=P)}),I?I.ref?n.push(new o.V(h,a.ref,"ref cannot reference another ref layer")):x=o.J(I.type):typeof T=="string"&&n.push(new o.V(h,a.ref,`ref layer "${T}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(a.source)if(o.a0(a.source)){const I=g.sources&&g.sources[a.source],P=I&&o.J(I.type);I?P==="vector"&&x==="raster"?n.push(new o.V(h,a.source,`layer "${a.id}" requires a raster source`)):P==="raster"&&x!=="raster"?n.push(new o.V(h,a.source,`layer "${a.id}" requires a vector source`)):P!=="vector"||a["source-layer"]?P==="raster-dem"&&x!=="hillshade"?n.push(new o.V(h,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(x)?x==="line"&&a.paint&&(a.paint["line-gradient"]||a.paint["line-trim-offset"])&&P==="geojson"&&!I.lineMetrics?n.push(new o.V(h,a,`layer "${a.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):x==="raster-particle"&&P!=="raster-array"&&n.push(new o.V(h,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):n.push(new o.V(h,a.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new o.V(h,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new o.V(h,a.source,`source "${a.source}" not found`))}else n.push(new o.V(`${h}.source`,a.source,'"source" must be a string'));else n.push(new o.V(h,a,'missing required property "source"'));return n=n.concat(vr({key:h,value:a,valueSpec:y.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ri({key:`${h}.type`,value:a.type,valueSpec:y.layer.type,style:d.style,styleSpec:d.styleSpec,object:a,objectKey:"type"}),filter:I=>to(Object.assign({layerType:x},I)),layout:I=>vr({layer:a,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":P=>ms(Object.assign({layerType:x},P))}}),paint:I=>vr({layer:a,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":P=>os(Object.assign({layerType:x,layer:a},P))}}),appearances(I){const P=fs({key:I.key,value:I.value,valueSpec:I.valueSpec,style:I.style,styleSpec:I.styleSpec,arrayElementValidator:D=>function(j){const{key:U,layer:G,layerType:J}=j,Z=o.J(j.value),ee=o.J(Z.name),oe=o.J(Z.condition),ue=vr({key:U,value:Z,valueSpec:j.styleSpec.appearance,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{condition:ye=>function(ge){const ve=[];return ve.push(...lr({key:ge.key,value:ge.object.condition,valueSpec:o.a6.appearance.condition,expressionContext:"appearance"})),ve}(Object.assign({layer:G,layerType:J},ye)),properties:ye=>function(ge){const ve=[],{styleSpec:_e,layer:me,layerType:xe}=ge,Ne=_e[`paint_${xe}`],Re=_e[`layout_${xe}`],qe=ge.object[ge.objectKey];for(const Oe in qe){const We=Oe in Ne?"paint":Oe in Re?"layout":void 0;if(!We){ve.push(new o.V(ge.key,Oe,`unknown property "${Oe}" for layer type "${xe}"`));continue}const gt=Object.assign({},ge,{key:`${ge.key}.${Oe}`,object:qe,objectKey:Oe,layer:me,layerType:xe,value:qe[Oe],valueSpec:We==="paint"?Ne[Oe]:Re[Oe]});ve.push(...sa(gt,We))}return ve}(Object.assign({layer:G,layerType:J},ye))}});return ee==="hidden"||oe||ue.push(new o.V(j.key,"name",'Appearance with name different than "hidden" must have a condition')),ue}(Object.assign({layerType:x,layer:a},D))}),R=Array.isArray(I.value)?I.value:[],F=new Set;return R.forEach((D,j)=>{const U=o.J(D.name);if(U)if(F.has(U)){const G=o.J(a.id);P.push(new o.V(I.key,U,`Duplicated appearance name "${U}" for layer "${G}"`))}else F.add(U)}),P}}})),n}function no({key:d,value:n}){return o.a0(n)?[]:[new o.V(d,n,`string expected, ${o.K(n)} found`)]}const io={promoteId:function d({key:n,value:a}){if(o.a0(a))return no({key:n,value:a});if(Array.isArray(a)){const g=[],y=o.S(a),x=o.U(y);return x.result==="error"&&x.value.forEach(T=>{g.push(new o.V(`${n}${T.key}`,null,`${T.message}`))}),o.X(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||g.push(new o.V(`${n}`,null,"promoteId expression should be only feature dependent")),g}if(!o.H(a))return[new o.V(n,a,`string, expression or object expected, "${o.K(a)}" found`)];const h=[];for(const g in a)h.push(...d({key:`${n}.${g}`,value:a[g]}));return h}};function yr(d){const n=d.value,a=d.key,h=d.styleSpec,g=d.style;if(!o.H(n))return[new o.V(a,n,`object expected, ${o.K(n)} found`)];if(!("type"in n))return[new o.V(a,n,'"type" is required')];const y=o.J(n.type);let x=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&("url"in n||"tiles"in n||x.push(new o.a3(a,n,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(vr({key:a,value:n,valueSpec:h[`source_${y.replace("-","_")}`],style:d.style,styleSpec:h,objectElementValidators:io})),x;case"geojson":if(x=vr({key:a,value:n,valueSpec:h.source_geojson,style:g,styleSpec:h,objectElementValidators:io}),"cluster"in n&&"clusterProperties"in n){if(!o.H(n.clusterProperties))return[new o.V(`${a}.clusterProperties`,n,`object expected, ${o.K(n)} found`)];for(const T in n.clusterProperties){const I=n.clusterProperties[T];if(!Array.isArray(I))return[new o.V(`${a}.clusterProperties.${T}`,I,"array expected")];const[P,R]=I,F=typeof P=="string"?[P,["accumulated"],["get",T]]:P;x.push(...lr({key:`${a}.${T}.map`,value:R,expressionContext:"cluster-map"})),x.push(...lr({key:`${a}.${T}.reduce`,value:F,expressionContext:"cluster-reduce"}))}}return x;case"video":return vr({key:a,value:n,valueSpec:h.source_video,style:g,styleSpec:h});case"image":return vr({key:a,value:n,valueSpec:h.source_image,style:g,styleSpec:h});case"canvas":return[new o.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return eo({key:`${a}.type`,value:n.type,valueSpec:{values:Cs(h)}})}}function Cs(d){return d.source.reduce((n,a)=>{const h=d[a];return h.type.type==="enum"&&(n=n.concat(Object.keys(h.type.values))),n},[])}function oa(d){const n=d.value,a=d.styleSpec,h=a.light,g=d.style;if(n===void 0)return[];if(!o.H(n))return[new o.V("light",n,`object expected, ${o.K(n)} found`)];let y=[];for(const x in n){const T=x.match(/^(.*)-transition$/),I=x.match(/^(.*)-use-theme$/);y=y.concat(I&&h[I[1]]?Ri({key:x,value:n[x],valueSpec:{type:"string"},style:g,styleSpec:a}):T&&h[T[1]]&&h[T[1]].transition?Ri({key:x,value:n[x],valueSpec:a.transition,style:g,styleSpec:a}):h[x]?Ri({key:x,value:n[x],valueSpec:h[x],style:g,styleSpec:a}):[new o.V(x,n[x],`unknown property "${x}"`)])}return y}function aa(d){const n=d.value;if(!n)return[];const a=d.key;if(!o.H(n))return[new o.V(a,n,`object expected, ${o.K(n)} found`)];let h=[];const g=d.styleSpec,y=g["light-3d"],x=d.style,T=d.style.lights;for(const R of["type","id"])if(!(R in n))return h=h.concat([new o.V(a,n,`missing property "${R}"`)]),h;if(!o.a0(n.type))return h=h.concat([new o.V(`${a}.type`,n.type,"string expected")]),h;if(T)for(let R=0;R<d.arrayIndex;R++){const F=o.J(n.type),D=T[R];o.J(D.type)===F&&h.push(new o.V(a,n.id,`duplicate light type "${n.type}", previously defined at line ${D.id.__line__}`))}const I=`properties_light_${n.type}`;if(!(I in g))return h=h.concat([new o.V(`${a}.type`,n,`Invalid light type ${n.type}`)]),h;const P=g[I];for(const R in n)if(R==="properties"){const F=n[R];if(!o.H(F))return h=h.concat([new o.V("properties",F,`object expected, ${o.K(F)} found`)]),h;for(const D in F){const j=D.match(/^(.*)-transition$/),U=D.match(/^(.*)-use-theme$/);h=h.concat(U&&P[U[1]]?Ri({key:R,value:F[D],valueSpec:{type:"string"},style:x,styleSpec:g}):j&&P[j[1]]&&P[j[1]].transition?Ri({key:R,value:n[R],valueSpec:g.transition,style:x,styleSpec:g}):P[D]?Ri({key:D,value:F[D],valueSpec:P[D],style:x,styleSpec:g}):[new o.a3(d.key,F[D],`unknown property "${D}"`)])}}else h=h.concat(y[R]?Ri({key:R,value:n[R],valueSpec:y[R],style:x,styleSpec:g}):[new o.a3(R,n[R],`unknown property "${R}"`)]);return h}function Io(d){const n=d.value,a=d.key,h=d.style,g=d.styleSpec,y=g.terrain;if(n==null)return[];if(!o.H(n))return[new o.V("terrain",n,`object expected, ${o.K(n)} found`)];let x=[];for(const T in n){const I=T.match(/^(.*)-transition$/),P=T.match(/^(.*)-use-theme$/);x=x.concat(P&&y[P[1]]?Ri({key:T,value:n[T],valueSpec:{type:"string"},style:h,styleSpec:g}):I&&y[I[1]]&&y[I[1]].transition?Ri({key:T,value:n[T],valueSpec:g.transition,style:h,styleSpec:g}):y[T]?Ri({key:T,value:n[T],valueSpec:y[T],style:h,styleSpec:g}):[new o.a3(T,n[T],`unknown property "${T}"`)])}if(n.source)if(o.a0(n.source)){const T=h.sources&&h.sources[n.source],I=T&&o.J(T.type);T?I!=="raster-dem"&&x.push(new o.V(`${a}.source`,n.source,`terrain cannot be used with a source of type ${I}, it only be used with a "raster-dem" source type`)):x.push(new o.V(`${a}.source`,n.source,`source "${n.source}" not found`))}else x.push(new o.V(`${a}.source`,n.source,"source must be a string"));else x.push(new o.V(a,n,'terrain is missing required property "source"'));return x}function zo(d){const n=d.value,a=d.style,h=d.styleSpec,g=h.fog;if(n===void 0)return[];if(!o.H(n))return[new o.V("fog",n,`object expected, ${o.K(n)} found`)];let y=[];for(const x in n){const T=x.match(/^(.*)-transition$/),I=x.match(/^(.*)-use-theme$/);y=y.concat(I&&g[I[1]]?Ri({key:x,value:n[x],valueSpec:{type:"string"},style:a,styleSpec:h}):T&&g[T[1]]&&g[T[1]].transition?Ri({key:x,value:n[x],valueSpec:h.transition,style:a,styleSpec:h}):g[x]?Ri({key:x,value:n[x],valueSpec:g[x],style:a,styleSpec:h}):[new o.a3(x,n[x],`unknown property "${x}"`)])}return y}const Pa={"*":()=>[],array:fs,boolean:function(d){const n=d.value,a=d.key;return o.$(n)?[]:[new o.V(a,n,`boolean expected, ${o.K(n)} found`)]},number:es,color:function({key:d,value:n}){return o.a0(n)?o.a1.parseCSSColor(n)===null?[new o.V(d,n,`color expected, "${n}" found`)]:[]:[new o.V(d,n,`color expected, ${o.K(n)} found`)]},enum:eo,filter:to,function:Qs,layer:ql,object:vr,source:yr,model:o.a7,light:oa,"light-3d":aa,terrain:Io,fog:zo,string:no,formatted:function(d){return no(d).length===0?[]:lr(d)},resolvedImage:function(d){return no(d).length===0?[]:lr(d)},projection:function(d){const n=d.value,a=d.styleSpec,h=a.projection,g=d.style;if(o.H(n)){let y=[];for(const x in n)y=y.concat(Ri({key:x,value:n[x],valueSpec:h[x],style:g,styleSpec:a}));return y}return o.a0(n)?[]:[new o.V("projection",n,`object or string expected, ${o.K(n)} found`)]},import:function(d){const n=d.key,{value:a,styleSpec:h}=d;if(!o.H(a))return[new o.V(n,a,"import must be an object")];const{data:g,...y}=a;Object.defineProperty(y,"__line__",{value:a.__line__,enumerable:!1});let x=vr(Object.assign({},d,{value:y,valueSpec:h.import}));return o.J(y.id)===""&&x.push(new o.V(`${d.key}.id`,y,"import id can't be an empty string")),g&&(x=x.concat(la(g,h,{key:`${d.key}.data`}))),x},iconset:function(d){const n=d.value,a=d.key,h=d.styleSpec,g=d.style;if(!o.H(n))return[new o.V(a,n,"object expected")];if(!n.type)return[new o.V(a,n,'"type" is required')];const y=o.J(n.type);let x=[];if(x=x.concat(vr({key:a,value:n,valueSpec:h[`iconset_${y}`],style:g,styleSpec:h})),function(T,I){return!(T!=="source"||!I.source)}(y,n)){const T=g.sources&&g.sources[n.source],I=T&&o.J(T.type);T?I!=="raster-array"&&x.push(new o.V(a,n.source,`iconset cannot be used with a source of type ${String(I)}, it only be used with a "raster-array" source type`)):x.push(new o.V(a,n.source,`source "${n.source}" not found`))}return x}};function Ri(d,n=!1){const a=d.value,h=d.valueSpec,g=d.styleSpec;if(h.expression){if(o.a4(o.J(a)))return Qs(d);if(o.Q(o.S(a)))return lr(d)}if(h.type&&Pa[h.type]){const y=Pa[h.type](d);return n===!0&&y.length>0&&Array.isArray(d.value)?lr(d):y}return vr(Object.assign({},d,{valueSpec:h.type?g[h.type]:h}))}function vr(d){const n=d.key,a=d.value,h=d.valueSpec||{},g=d.objectElementValidators||{},y=d.style,x=d.styleSpec;if(!o.H(a))return[new o.V(n,a,`object expected, ${o.K(a)} found`)];let T=[];for(const I in a){const P=I.split(".")[0];let R;g[P]?R=g[P]:h[P]?R=Ri:g["*"]?R=g["*"]:h["*"]&&(R=Ri),R?T=T.concat(R({key:(n&&`${n}.`)+I,value:a[I],valueSpec:h[P]||h["*"],style:y,styleSpec:x,object:a,objectKey:I},a)):T.push(new o.a3(n,a[I],`unknown property "${I}"`))}for(const I in h)g[I]||h[I].required&&h[I].default===void 0&&a[I]===void 0&&T.push(new o.V(n,a,`missing required property "${I}"`));return T}function Zl({key:d,value:n}){const a=no({key:d,value:n});if(a.length)return a;const h=n;return h.indexOf("{fontstack}")===-1&&a.push(new o.V(d,n,'"glyphs" url must include a "{fontstack}" token')),h.indexOf("{range}")===-1&&a.push(new o.V(d,n,'"glyphs" url must include a "{range}" token')),a}function la(d,n=o.a6,a={}){return vr({key:a.key||"",value:d,valueSpec:Object.assign(n.$root,{"*":{type:"*"}}),styleSpec:n,style:d,objectElementValidators:{glyphs:Zl}})}function Ns(d,n=o.a6){return Ee(la(d,n))}const rl=d=>Ee(yr(d)),Xl=d=>Ee(oa(d)),Kl=d=>Ee(aa(d)),ct=d=>Ee(Io(d)),Oo=d=>Ee(zo(d)),Dm=d=>Ee(function(n){const a=n.value,h=n.style,g=n.styleSpec,y=g.snow;if(a===void 0)return[];if(!o.H(a))return[new o.V("snow",a,`object expected, ${o.K(a)} found`)];let x=[];for(const T in a){const I=T.match(/^(.*)-transition$/);x=x.concat(I&&y[I[1]]&&y[I[1]].transition?Ri({key:T,value:a[T],valueSpec:g.transition,style:h,styleSpec:g}):y[T]?Ri({key:T,value:a[T],valueSpec:y[T],style:h,styleSpec:g}):[new o.a3(T,a[T],`unknown property "${T}"`)])}return x}(d)),Vc=d=>Ee(function(n){const a=n.value,h=n.style,g=n.styleSpec,y=g.rain;if(a===void 0)return[];if(!o.H(a))return[new o.V("rain",a,`object expected, ${o.K(a)} found`)];let x=[];for(const T in a){const I=T.match(/^(.*)-transition$/);x=x.concat(I&&y[I[1]]&&y[I[1]].transition?Ri({key:T,value:a[T],valueSpec:g.transition,style:h,styleSpec:g}):y[T]?Ri({key:T,value:a[T],valueSpec:y[T],style:h,styleSpec:g}):[new o.a3(T,a[T],`unknown property "${T}"`)])}return x}(d)),De=d=>Ee(ql(d)),X=d=>Ee(to(d)),te=d=>Ee(os(d)),pe=d=>Ee(ms(d)),Ae=d=>Ee(o.a7(d));function Ee(d){return d.slice().sort((n,a)=>n.line&&a.line?n.line-a.line:0)}function Se(d,n){let a=!1;if(n&&n.length)for(const h of n)h instanceof o.a3?o.w(h.message):(d.fire(new o.y(new Error(h.message))),a=!0);return a}let $e;class ke extends o.E{constructor(n,a="flat"){super(),this._transitionable=new o.a8($e||($e=new o.a9({anchor:new o.aa(o.a6.light.anchor),position:new o.ab(o.a6.light.position),color:new o.aa(o.a6.light.color),intensity:new o.aa(o.a6.light.intensity)}))),this.setLight(n,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a,h={}){this._validate(Xl,n,h)||(this._transitionable.setTransitionOrValue(n),this.id=a)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,h){return(!h||h.validate!==!1)&&Se(this,n.call(Ns,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let He=class extends o.E{constructor(d,n,a,h,g){super(),this.scope=a,this._transitionable=new o.a8(new o.a9({source:new o.aa(o.a6.terrain.source),exaggeration:new o.aa(o.a6.terrain.exaggeration)}),a,h),this._transitionable.setTransitionOrValue(d,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=g}get(){return this._transitionable.serialize()}set(d,n){this._transitionable.setTransitionOrValue(d,n)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new o.ac(d,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const d=this._transitionable._values.exaggeration;if(!d)return null;const n=d.value.expression;if(!n)return null;let a=-1,h=-1,g=1;for(const y of n.zoomStops)g=n.evaluate(new o.ac(y,{worldview:this.worldview})),g>.01?(a=y,h=-1):h=y;return g<.01&&a>0&&h>a?[a,h]:null}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof o.ad}};const _t=45,st=65,$t=.05;function tn(d,n,a,h){const g=o.ah(_t,st,a),[y,x]=un(d,h);let T=1-Math.min(1,Math.exp((n-y)/(x-y)*-6));return T*=T*T,T=Math.min(1,1.00747*T),T*g*d.alpha}function un(d,n){const a=.5/Math.tan(.5*n);return[d.range[0]+a,d.range[1]+a]}function kn(d,n,a,h,g){const y=o.af([],[n,a,h],g.mercatorFogMatrix);return tn(d,o.ag(y),g.pitch,g._fov)}function Mn(d,n,a,h,g,y,x){const T=[[a,h,0],[g,h,0],[g,y,0],[a,y,0]];let I=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(const R of T){const F=o.af([],R,n),D=o.ag(F);I=Math.min(I,D),P=Math.max(P,D)}return[tn(d,I,x.pitch,x._fov),tn(d,P,x.pitch,x._fov)]}class On extends o.E{constructor(n,a,h,g){super();const y=new o.a9({range:new o.aa(o.a6.fog.range),color:new o.aa(o.a6.fog.color),"color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.aa(o.a6.fog["high-color"]),"high-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.aa(o.a6.fog["space-color"]),"space-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.aa(o.a6.fog["horizon-blend"]),"star-intensity":new o.aa(o.a6.fog["star-intensity"]),"vertical-range":new o.aa(o.a6.fog["vertical-range"])});this._transitionable=new o.a8(y,h,new Map(g)),this.set(n,g),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new o.ai(y),this.scope=h}get state(){const n=this._transform,a=n.projection.name==="globe",h=o.aj(n.zoom),g=this.properties.get("range"),y=[.5,3];return{range:a?[o.ak(y[0],g[0],h),o.ak(y[1],g[1],h)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a,h={}){if(this._validate(Oo,n,h))return;const g=Object.assign({},n);for(const y of Object.keys(o.a6.fog))g[y]===void 0&&(g[y]=o.a6.fog[y].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.ah(_t,st,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?function(h,g,y){const x=o.ae.fromLngLat(g),T=y.elevation?y.elevation.getAtPointOrZero(x):0;return kn(h,x.x,x.y,T,y)}(this.state,n,a):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Mn(this.state,a,0,0,o.al,o.al,this._transform)}getOpacityForBounds(n,a,h,g,y){return this._transform.projection.supportsFog?Mn(this.state,n,a,h,g,y,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?un(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const h of a){const g=n.points[h];let y;if(g[2]>=0)y=g;else{const x=n.points[h-4];y=o.am(x,g,x[2]/(x[2]-g[2]))}if(kn(this.state,y[0],y[1],0,this._transform)>=$t)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,h){return(!h||h.validate!==!1)&&Se(this,n.call(Ns,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let pi,Dn,Zi,cr,ur=class extends o.E{constructor(d,n,a,h){super();const g=pi||(pi=new o.a9({density:new o.aa(o.a6.snow.density),intensity:new o.aa(o.a6.snow.intensity),color:new o.aa(o.a6.snow.color),opacity:new o.aa(o.a6.snow.opacity),vignette:new o.aa(o.a6.snow.vignette),"vignette-color":new o.aa(o.a6.snow["vignette-color"]),"center-thinning":new o.aa(o.a6.snow["center-thinning"]),direction:new o.aa(o.a6.snow.direction),"flake-size":new o.aa(o.a6.snow["flake-size"])}));this._transitionable=new o.a8(g,a,new Map(h)),this.set(d,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(g),this.scope=a}get state(){const d=this.properties.get("opacity"),n=this.properties.get("color"),a=this.properties.get("direction"),h=o.an(a[0]),g=-Math.max(o.an(a[1]),.01),y=[Math.cos(h)*Math.cos(g),Math.sin(h)*Math.cos(g),Math.sin(g)],x=this.properties.get("vignette"),T=this.properties.get("vignette-color");return T.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(n.r,n.g,n.b,n.a*d),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(d,n,a={}){if(this._validate(Dm,d,a))return;const h=Object.assign({},d);for(const g of Object.keys(o.a6.snow))h[g]===void 0&&(h[g]=o.a6.snow[g].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,n,a){return(!a||a.validate!==!1)&&Se(this,d.call(Ns,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}},fi=class extends o.E{constructor(d,n,a,h){super();const g=Dn||(Dn=new o.a9({density:new o.aa(o.a6.rain.density),intensity:new o.aa(o.a6.rain.intensity),color:new o.aa(o.a6.rain.color),opacity:new o.aa(o.a6.rain.opacity),vignette:new o.aa(o.a6.rain.vignette),"vignette-color":new o.aa(o.a6.rain["vignette-color"]),"center-thinning":new o.aa(o.a6.rain["center-thinning"]),direction:new o.aa(o.a6.rain.direction),"droplet-size":new o.aa(o.a6.rain["droplet-size"]),"distortion-strength":new o.aa(o.a6.rain["distortion-strength"])}));this._transitionable=new o.a8(g,a,new Map(h)),this.set(d,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(g),this.scope=a}get state(){const d=this.properties.get("opacity"),n=this.properties.get("color"),a=this.properties.get("direction"),h=o.an(a[0]),g=-Math.max(o.an(a[1]),.01),y=[Math.cos(h)*Math.cos(g),Math.sin(h)*Math.cos(g),Math.sin(g)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(n.r,n.g,n.b,n.a*d),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(d,n,a={}){if(this._validate(Vc,d,a))return;const h=Object.assign({},d);for(const g of Object.keys(o.a6.rain))h[g]===void 0&&(h[g]=o.a6.rain[g].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,n,a){return(!a||a.validate!==!1)&&Se(this,d.call(Ns,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}};class Kn extends o.E{constructor(n,a,h,g){super(),this.scope=h,this._options=n,this.properties=new o.ai(a),this._transitionable=new o.a8(a,h,new Map(g)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,a){this._options=n,this._transitionable.setTransitionOrValue(n.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Hi{constructor(n,a,h){this.screenBounds=n,this.cameraPoint=h.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=a,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,h)}static createFromScreenPoints(n,a){let h,g;if(n instanceof o.P||typeof n[0]=="number"){const y=o.P.convert(n);h=[y],g=a.isPointAboveHorizon(y)}else{const y=o.P.convert(n[0]),x=o.P.convert(n[1]),T=y.add(x)._div(2);h=[y,x],g=o.aq(y,x).every(I=>a.isPointAboveHorizon(I))&&a.isPointAboveHorizon(T)}return new Hi(h,g,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return o.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],g=o.aq(a,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<h.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?g[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(g[3]=this.cameraPoint)),o.ar(g,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],g=o.aq(a,h,n),y=this.cameraPoint.clone();switch(3*((y.y>a.y)+(y.y>h.y))+((y.x>a.x)+(y.x>h.x))){case 0:g[0]=y,g[4]=y.clone();break;case 1:g.splice(1,0,y);break;case 2:g[1]=y;break;case 3:g.splice(4,0,y);break;case 5:g.splice(2,0,y);break;case 6:g[3]=y;break;case 7:g.splice(3,0,y);break;case 8:g[2]=y}return g}containsTile(n,a,h,g=0){const y=n.queryPadding/a._pixelsPerMercatorPixel+1,x=h?this._bufferedCameraMercator(y,a):this._bufferedScreenMercator(y,a);let T=n.tileID.wrap+(x.unwrapped?g:0);const I=x.polygon.map(J=>o.as(n.tileTransform,J,T));if(!o.at(I,0,0,o.al,o.al))return;T=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const P=this.screenGeometryMercator.polygon.map(J=>o.au(n.tileTransform,J,T)),R=P.map(J=>new o.P(J[0],J[1])),F=a.getFreeCameraOptions().position||new o.ae(0,0,0),D=o.au(n.tileTransform,F,T),j=P.map(J=>{const Z=o.av(J,J,D);return o.aw(Z,Z),new o.ax(D,Z)}),U=o.ay(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:j,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(G=o.az(I),G.min.x=o.aA(G.min.x,0,o.al),G.min.y=o.aA(G.min.y,0,o.al),G.max.x=o.aA(G.max.x,0,o.al),G.max.y=o.aA(G.max.y,0,o.al),G),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:U};var G}_bufferedScreenMercator(n,a){const h=Hr(n);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map(y=>a.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[h]=g,g}}_bufferedCameraMercator(n,a){const h=Hr(n);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map(y=>a.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[h]=g,g}}_projectAndResample(n,a){const h=function(y,x){const T=o.aB([],x.pixelMatrix,x.globeMatrix),I=[0,-o.aD,0,1],P=[0,o.aD,0,1],R=[0,0,0,1];o.aC(I,I,T),o.aC(P,P,T),o.aC(R,R,T);const F=new o.P(I[0]/I[3],I[1]/I[3]),D=new o.P(P[0]/P[3],P[1]/P[3]),j=o.aE(y,F)&&I[3]<R[3],U=o.aE(y,D)&&P[3]<R[3];if(!j&&!U)return null;const G=function(ve,_e,me){for(let xe=1;xe<ve.length;xe++){const Ne=Ti(_e.pointCoordinate3D(ve[xe-1]).x),Re=Ti(_e.pointCoordinate3D(ve[xe]).x);if(me<0){if(Ne<Re)return{idx:xe,t:-Ne/(Re-1-Ne)}}else if(Re<Ne)return{idx:xe,t:(1-Ne)/(Re+1-Ne)}}return null}(y,x,j?-1:1);if(!G)return null;const{idx:J,t:Z}=G;let ee=J>1?Wi(y.slice(0,J),x):[],oe=J<y.length?Wi(y.slice(J),x):[];ee=ee.map(ve=>new o.P(Ti(ve.x),ve.y)),oe=oe.map(ve=>new o.P(Ti(ve.x),ve.y));const ue=[...ee];ue.length===0&&ue.push(oe[oe.length-1]);const ye=o.ak(ue[ue.length-1].y,(oe.length===0?ee[0]:oe[0]).y,Z);let ge;return ge=j?[new o.P(0,ye),new o.P(0,0),new o.P(1,0),new o.P(1,ye)]:[new o.P(1,ye),new o.P(1,1),new o.P(0,1),new o.P(0,ye)],ue.push(...ge),oe.length===0?ue.push(ee[0]):ue.push(...oe),{polygon:ue.map(ve=>new o.ae(ve.x,ve.y)),unwrapped:!1}}(n,a);if(h)return h;const g=function(y,x){let T=!1,I=-1/0,P=0;for(let F=0;F<y.length-1;F++)y[F].x>I&&(I=y[F].x,P=F);for(let F=0;F<y.length-1;F++){const D=(P+F)%(y.length-1),j=y[D],U=y[D+1];Math.abs(j.x-U.x)>.5&&(j.x<U.x?(j.x+=1,D===0&&(y[y.length-1].x+=1)):(U.x+=1,D+1===y.length-1&&(y[0].x+=1)),T=!0)}const R=o.aF(x.center.lng);return T&&R<Math.abs(R-1)&&y.forEach(F=>{F.x-=1}),{polygon:y,unwrapped:T}}(Wi(n,a).map(y=>new o.P(Ti(y.x),y.y)),a);return{polygon:g.polygon.map(y=>new o.ae(y.x,y.y)),unwrapped:g.unwrapped}}}function Wi(d,n){return o.aG(d,a=>{const h=n.pointCoordinate3D(a);a.x=h.x,a.y=h.y},1/256)}function Ti(d){return d<0?1+d%1:d%1}function Hr(d){return 100*d|0}function gs(d,n,a,h,g){const y=function(T,I){if(T)return g(T);if(I){if(d.url&&I.tiles&&d.tiles&&delete d.tiles,I.variants){if(!Array.isArray(I.variants))return g(new Error("variants must be an array"));for(const R of I.variants){if(R==null||typeof R!="object"||R.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(R.capabilities))return g(new Error("capabilities must be an array"));if(R.capabilities.length===1&&R.capabilities[0]==="meshopt"){I=Object.assign(I,R);break}}}const P=o.aH(Object.assign({},I,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);P.tiles=n.canonicalizeTileset(P,d.url),g(null,P)}},x=function(T,I,P){if(!T)return null;if(!I&&!P)return T;P=P||T.worldview_default;const R=Object.values(T.language||{});if(R.length===0)return null;const F=Object.values(T.worldview||{});if(F.length===0)return null;const D=R.every(U=>U===I),j=F.every(U=>U===P);return D&&j?T:I in(T.language_options||{})||P in(T.worldview_options||{})?null:T.language_options&&T.worldview_options?T:null}(d.data,a,h);return x?o.o.frame(()=>y(null,x)):d.url?o.m(n.transformRequest(n.normalizeSourceURL(d.url,null,a,h),o.R.Source),y):o.o.frame(()=>{const{data:T,...I}=d;y(null,I)})}function ro(d,n){const a=Math.pow(2,n.z),h=Math.floor(o.aF(d.getWest())*a),g=Math.floor(o.aJ(d.getNorth())*a),y=Math.ceil(o.aF(d.getEast())*a),x=Math.ceil(o.aJ(d.getSouth())*a);return n.x>=h&&n.x<y&&n.y>=g&&n.y<x}class Ma{constructor(n,a,h){this.bounds=n?o.aI.convert(this.validateBounds(n)):null,this.minzoom=a||0,this.maxzoom=h||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const a of n)this.extraBounds.push(o.aI.convert(this.validateBounds(a)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!ro(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const a of this.extraBounds)if(ro(a,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const a=new Ma(n.bounds,n.minzoom,n.maxzoom);return a.addExtraBounds(n.extra_bounds),a}}class as extends o.E{constructor(n,a,h,g){if(super(),this.id=n,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,o.aH(a,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new o.aK}load(n){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=gs(this._options,this.map._requestManager,a,h,(g,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),h&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new o.y(g));else if(y){if(Object.assign(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const x of y.vector_layers)this.vectorLayerIds.push(x.id),y.worldview&&y.worldview[x.source]&&this.localizableLayerIds.add(x.id)}this.tileBounds=Ma.fromTileJSON(y),Xn(y.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}n&&n(g)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(n,a){const h=n.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(h),y=this.map._requestManager.transformRequest(g,o.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,T=x?{image:x.image.clone()}:null,I={request:y,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:T,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&o.h(h)&&(I.localizableLayerIds=this.localizableLayerIds),I.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=a:n.request=n.actor.send("reloadTile",I,P.bind(this));else if(n.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",I,P.bind(this),void 0,!0);else{const R=o.aL.call({deduped:this._deduped},I,(F,D)=>{F||!D?P.call(this,F):(I.data={cacheControl:D.cacheControl,expires:D.expires,rawData:D.rawData.slice(0)},n.actor&&n.actor.send("loadTile",I,P.bind(this),void 0,!0))},!0);n.request={cancel:R}}function P(R,F){return delete n.request,n.aborted?a(null):R&&R.status!==404?a(R):(F&&F.resourceTiming&&(n.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&n.setExpiryData(F),n.loadVectorData(F,this.map.painter),o.aM(this.dispatcher),a(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,a){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Uc extends o.E{constructor(n,a,h,g){super(),this.id=n,this.dispatcher=h,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},a),Object.assign(this,o.aH(a,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const a=this.map.getWorldview();this._tileJSONRequest=gs(this._options,this.map._requestManager,null,a,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new o.y(h)):g&&(Object.assign(this,g),g.raster_layers&&(this.rasterLayers=g.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=Ma.fromTileJSON(g),Xn(g.tiles),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),n&&n(h)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const h=o.o.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);n.request=o.n(this.map._requestManager.transformRequest(g,o.R.Tile),(y,x,T,I)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):y?(n.state="errored",a(y)):x?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:T,expires:I}),n.setTexture(x,this.map.painter),n.state="loaded",o.aM(this.dispatcher),void a(null)):a(null)))}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a&&a()}unloadTile(n,a){n.texture&&n.texture instanceof o.T?(n.destroy(!0),n.texture&&n.texture instanceof o.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function cv([d,n],a,h,{scaled:g=!0}={}){const{tileSize:y,buffer:x}=h,{x:T,y:I,z:P}=a;if(!isFinite(T)||!isFinite(I)||!isFinite(P))throw new Error("Invalid MRT header");const R=2**P,F=R*o.aF(d),D=R*o.aJ(n);return function([j,U],G,{scaled:J=!0}={}){if(!G)throw new Error("bandView is undefined");const{data:Z,tileSize:ee,buffer:oe,offset:ue,scale:ye,dimension:ge}=G;if(j<-oe||j>ee+oe||U<-oe||U>ee+oe)throw new Error(`Point (${j}, ${U}) out of bounds for tileSize=${ee}, buffer=${oe}`);const ve=(U+oe)*(ee+2*oe)+(j+oe);if(new Uint32Array(Z.buffer)[ve]===4294967295)return null;let _e=[];_e=J?[]:new G.data.constructor(ge);for(let me=0;me<ge;me++)_e[me]=Math.round(1e12*(Z[ge*ve+me]*ye+ue))/1e12;return _e}([Math.min(Math.max(-x,Math.floor((F-T)*y)),y-1+x),Math.min(Math.max(-x,Math.floor((D-I)*y)),y-1+x)],h,{scaled:g})}class sl extends Uc{constructor(n,a,h,g){super(n,a,h,g),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},a)}triggerRepaint(n){const a=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);a&&a.enabled&&h&&a._clearRenderCacheForTile(h.id,n.tileID),this.map.triggerRepaint()}loadTile(n,a){const h=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(h,o.R.Tile),y={request:g,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=g,n.actor||(n.actor=this.dispatcher.getActor());const x=(T,I,P,R)=>{if(delete n.request,n.aborted)return n.state="unloaded",a(null);if(T)return T.name==="AbortError"?void 0:(n.state="errored",a(T));if(this.map._refreshExpiredTiles&&I&&n.setExpiryData({cacheControl:P,expires:R}),this.partial&&n.state!=="expired")n.state="empty";else if(!this.partial){if(!I)return a(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=I}a(null)};n.request=this.partial?n.fetchHeader(void 0,x.bind(this)):n.actor.send("loadTile",y,x.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,a){const h=n.texturePerLayer;if(n.flushAllQueues(),h.size){n.destroy(!0);for(const g of h.values())this.map.painter.saveTileTexture(g)}else n.destroy()}prepareTile(n,a,h,g){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBandForRender(a,h,g,(y,x)=>{if(y)return n.state="errored",this.fire(new o.y(y)),void this.triggerRepaint(n);x&&(n._isHeaderLoaded=!0,n.setTexturePerLayer(h,x,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:y})=>y===n),h=a&&a.fields,g=h&&h.bands&&h.bands;return g?g[0]:0}getTextureDescriptor(n,a,h){if(!n)return;const g=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let y=null;a instanceof o.aP?y=a.paint.get("raster-array-band"):a instanceof o.aQ&&(y=a.paint.get("raster-particle-array-band"));const x=y||this.getInitialBand(g);if(x==null)return;if(!n.textureDescriptorPerLayer.get(a.id))return void this.prepareTile(n,g,a.id,x);if(n.updateNeeded(a.id,x)&&!h)return;const T=n.textureDescriptorPerLayer.get(a.id);return Object.assign({},T,{texture:n.texturePerLayer.get(a.id)})}getImages(n,a){const h=new Map;for(const g of n)for(const y of a){const[x,T]=y.split("/"),I=g.getLayer(x);if(!I||!I.hasBand(T)||!I.hasDataForBand(T))continue;const{bytes:P,tileSize:R,buffer:F}=I.getBandView(T),D=R+2*F,j={data:new o.q({width:D,height:D},P),pixelRatio:2,sdf:!1,usvg:!1,version:0};h.set(y,j)}return h}queryRasterArrayValueByBandId(n,a,h){const g=a._mrt;return new Promise(y=>{const x={},T=new Set;for(const[I,P]of Object.entries(g.layers)){if(h.layerName&&I!==h.layerName)continue;const R={};x[I]=R;for(const{bands:F}of P.dataIndex)for(const D of F)h.bands&&!h.bands.includes(D)||(T.add(o.B(I,D)),a.fetchBand(I,null,D,j=>{o.o.frame(()=>{R[D]=j?null:cv([n.lng,n.lat],g,P.getBandView(D)),T.delete(o.B(I,D)),T.size===0&&y(x)})},!1))}T.size===0&&y(x)})}_loadTileForQuery(n,a){if(this._loadTileLoaded[n.uid])return void a(null,n._mrt);if(this._loadTilePending[n.uid])return void this._loadTilePending[n.uid].push(a);this._loadTilePending[n.uid]=[a];const h=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(h,o.R.Tile);n.actor.send("loadTile",{request:g,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(y,x,T,I)=>y?(this._loadTilePending[n.uid].forEach(P=>P(y,null)),void delete this._loadTilePending[n.uid]):x?(this.map._refreshExpiredTiles&&x&&n.setExpiryData({cacheControl:T,expires:I}),n._mrt=x,n._isHeaderLoaded=!0,n.state="loaded",this._loadTilePending[n.uid].forEach(P=>P(null,x)),this._loadTileLoaded[n.uid]=!0,void delete this._loadTilePending[n.uid]):(this._loadTilePending[n.uid].forEach(P=>P(null,null)),void delete this._loadTilePending[n.uid]),void 0,!0)}queryRasterArrayValueByAllBands(n,a,h){return new Promise((g,y)=>{this._loadTileForQuery(a,(x,T)=>{x?y(x):g(T?this.queryRasterArrayValueByBandId(n,a,h):null)})})}queryRasterArrayValue(n,a){const h=o.aR.convert(n),g=this.findLoadedParent(h);return g&&g._mrt?a.bands||!this.partial?this.queryRasterArrayValueByBandId(h,g,a):this.queryRasterArrayValueByAllBands(h,g,a):Promise.resolve(null)}findLoadedParent(n){const a=o.ae.fromLngLat(n,this.map.transform.tileSize),h=this.maxzoom+1,g=1<<h,y=Math.floor(a.x),x=Math.floor((a.x-y)*g),T=Math.floor(a.y*g),I=this.map.style.getSourceCache(this.id),P=new o.aO(h,y,h,x,T);return I.findLoadedParent(P,this.minzoom)}}const Gc={vector:as,raster:Uc,"raster-dem":class extends Uc{constructor(d,n,a,h){super(d,n,a,h),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(d,n){const a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(g,y){g&&(d.state="errored",n(g)),y&&(d.dem=y,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",n(null))}d.request=o.n(this.map._requestManager.transformRequest(a,o.R.Tile),(function(g,y,x,T){if(delete d.request,d.aborted)d.state="unloaded",n(null);else if(g)d.state="errored",n(g);else if(y){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:x,expires:T});const I=ImageBitmap&&y instanceof ImageBitmap&&o.r(),P=1-(y.width-o.aN(y.width))/2;P<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const R=I?y:o.o.getImageData(y,P),F={uid:d.uid,tileID:d.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:R,encoding:this.encoding,padding:P};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadTile",F,h.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const n=d.canonical,a=Math.pow(2,n.z),h=(n.x-1+a)%a,g=n.x===0?d.wrap-1:d.wrap,y=(n.x+1+a)%a,x=n.x+1===a?d.wrap+1:d.wrap,T={};return T[new o.aO(d.overscaledZ,g,n.z,h,n.y).key]={backfilled:!1},T[new o.aO(d.overscaledZ,x,n.z,y,n.y).key]={backfilled:!1},n.y>0&&(T[new o.aO(d.overscaledZ,g,n.z,h,n.y-1).key]={backfilled:!1},T[new o.aO(d.overscaledZ,d.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},T[new o.aO(d.overscaledZ,x,n.z,y,n.y-1).key]={backfilled:!1}),n.y+1<a&&(T[new o.aO(d.overscaledZ,g,n.z,h,n.y+1).key]={backfilled:!1},T[new o.aO(d.overscaledZ,d.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},T[new o.aO(d.overscaledZ,x,n.z,y,n.y+1).key]={backfilled:!1}),T}},"raster-array":sl,geojson:class extends o.E{constructor(d,n,a,h){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(h),this._data=n.data,this._options=Object.assign({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const g=o.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*g,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*g,extent:o.al,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.al,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*g,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new o.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new o.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const a of this._data.features)n.set(a.id,a);for(const a of d.features)n.set(a.id,a);this._data.features=[...n.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},n),this}getClusterChildren(d,n){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},n),this}getClusterLeaves(d,n,a,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:n,offset:a},h),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.z("dataloading",{dataType:"source"})),this._loaded=!1;const n=Object.assign({append:d},this.workerOptions);n.scope=this.scope;const a=this._data;typeof a=="string"?(n.request=this.map._requestManager.transformRequest(o.o.resolveURL(a),o.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(h,g)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new o.y(h));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(y.resourceTiming=g.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new o.z("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const d=o.B(this.id,this.scope);this.map.style.clearSource(d),this._updateWorkerData()}loadTile(d,n){const a=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const h=this.map.style?this.map.style.getLut(this.scope):null,g=h?{image:h.image.clone()}:null,y=this._partialReload,x={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:d.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview()};d.request=this.actor.send(a,x,(T,I)=>y&&!I?(d.state="loaded",n(null)):(delete d.request,d.destroy(),d.aborted?n(null):T?n(T):(d.loadVectorData(I,this.map.painter,a==="reloadTile"),n(null))),void 0,a==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,n){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aS{constructor(d,n,a,h){super(d,n,a,h),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const n of d.urls)this.urls.push(this.map._requestManager.transformRequest(n,o.R.Source).url);o.aT(this.urls,(n,a)=>{this._loaded=!0,n?this.fire(new o.y(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const n=this.video.seekable;d<n.start(0)||d>n.end(0)?this.fire(new o.y(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,n=d.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(d,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aS,model:class extends o.E{constructor(d,n,a,h){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const d=[];for(const n in this._options.models){const a=this._options.models[n],h=o.aV(this.map._requestManager.transformRequest(a.uri,o.R.Model).url).then(g=>{if(!g)return;const y=o.aW(g),x=new o.aX(n,a.position,a.orientation,y);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(g=>{this.fire(new o.y(new Error(`Could not load model ${n} from ${a.uri}: ${g.message}`)))});d.push(h)}Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this._loaded=!0,this.fire(new o.y(new Error(`Could not load models: ${n.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,n){}serialize(){return this._options}},"batched-model":class extends o.E{constructor(d,n,a,h){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(d){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=gs(this._options,this.map._requestManager,n,a,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new o.y(h))):g&&(Object.assign(this,g),g.bounds&&(this.tileBounds=new Ma(g.bounds,this.minzoom,this.maxzoom)),Xn(g.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),d&&d(h)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,n){const a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(a,o.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.o.devicePixelRatio,promoteId:this.promoteId};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=n;else{if(d.buckets){const y=Object.values(d.buckets);for(const x of y)x.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",h,g.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",h,g.bind(this),void 0,!0);function g(y,x){return d.aborted?n(null):y&&y.status!==404?n(y):(this.map._refreshExpiredTiles&&x&&d.setExpiryData(x),d.loadModelData(x,this.map.painter),d.state="loaded",void n(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends o.aS{constructor(d,n,a,h){super(d,n,a,h),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(y=>typeof y!="number"))||this.fire(new o.y(new o.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.y(new o.V(`sources.${d}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.y(new o.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new o.y(new o.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.y(new o.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof o.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends o.E{constructor(d,n,a,h){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ma(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,o.aH(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:n,y:a,z:h}=d.canonical;return this._implementation.hasTile({x:n,y:a,z:h})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,n){const{x:a,y:h,z:g}=d.tileID.canonical,y=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:a,y:h,z:g},{signal:y.signal})).then((function(x){return delete d.request,d.aborted?(d.state="unloaded",n(null)):x===void 0?(d.state="errored",n(null)):x===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",n(null)):function(T){return T instanceof ImageData||T instanceof HTMLCanvasElement||T instanceof ImageBitmap||T instanceof HTMLImageElement}(x)?(this.loadTileData(d,x),d.state="loaded",void n(null)):(d.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.name!=="AbortError"&&(d.state="errored",n(x))}),d.request.cancel=()=>y.abort()}loadTileData(d,n){d.setTexture(n,this.map.painter)}unloadTile(d,n){if(d.texture&&d.texture instanceof o.T?(d.destroy(!0),d.texture&&d.texture instanceof o.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:a,y:h,z:g}=d.tileID.canonical;this._implementation.unloadTile({x:a,y:h,z:g})}n&&n()}abortTile(d,n){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=o.B(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}}},_h=function(d,n,a,h){const g=new Gc[n.type](d,n,a,h);if(g.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${g.id}`);return o.aY(["load","abort","unload","serialize","prepare"],g),g};function yh(d,n,a=""){return`${a}:${n.id||""}:${n.layer.id}:${function(h){if("layerId"in h)return`layer:${h.layerId}`;{const{featuresetId:g,importId:y}=h;return`featureset:${g}${y?`:import:${y}`:""}`}}(d.target)}`}function ol(d,n,a,h=""){if(d.uniqueFeatureID){const g=yh(d,n,h);if(a.has(g))return!0;a.add(g)}return!1}function vh(d,n,a,h,g=!1){const y=n.sourceCache.transform,x=n.sourceCache.tilesIn(d,n.has3DLayers,g);x.sort(zm);const T=[];for(const I of x){const P=I.tile.queryRenderedFeatures(n,I,a,h,y,g);Object.keys(P).length&&T.push({wrappedTileID:I.tile.tileID.wrapped().key,queryResults:P})}return T.length===0?{}:function(I){const P={},R={};for(const F of I){const D=F.queryResults,j=F.wrappedTileID,U=R[j]=R[j]||{};for(const G in D){const J=D[G],Z=U[G]=U[G]||{},ee=P[G]=P[G]||[];for(const oe of J)Z[oe.featureIndex]||(Z[oe.featureIndex]=!0,ee.push(oe))}}return P}(T)}function Lm(d,n,a,h,g,y){const x={},T=h.queryRenderedSymbols(d),I=[];for(const P of Object.keys(T).map(Number))I.push(g[P]);I.sort(zm);for(const P of I){const R=P.featureIndex.lookupSymbolFeatures(T[P.bucketInstanceId],P.bucketIndex,P.sourceLayerIndex,n,a,y);for(const F in R){const D=x[F]=x[F]||[],j=R[F];j.sort((U,G)=>{const J=P.featureSortOrder;if(J){const Z=J.indexOf(U.featureIndex);return J.indexOf(G.featureIndex)-Z}return G.featureIndex-U.featureIndex});for(const U of j)D.push(U)}}return x}function ca(d,n){const a=d.getRenderableIds().map(y=>d.getTileByID(y)),h=[],g={};for(let y=0;y<a.length;y++){const x=a[y],T=x.tileID.canonical.key;g[T]||(g[T]=!0,x.querySourceFeatures(h,n))}return h}function zm(d,n){const a=d.tileID,h=n.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}function Hd(d,n){const a={};if(!n)return a;for(const h of d){const g=h.layerIds.map(y=>n.getLayer(y)).filter(Boolean);if(g.length!==0){h.layers=g,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map(y=>g.filter(x=>x.id===y)[0]));for(const y of g)a[y.fqid]=h}}return a}const so=32,Fo=33,Ra=new Uint16Array(8184);for(let d=0;d<2046;d++){let n=d+2,a=0,h=0,g=0,y=0,x=0,T=0;for(1&n?g=y=x=so:a=h=T=so;(n>>=1)>1;){const P=a+g>>1,R=h+y>>1;1&n?(g=a,y=h,a=x,h=T):(a=g,h=y,g=x,y=T),x=P,T=R}const I=4*d;Ra[I+0]=a,Ra[I+1]=h,Ra[I+2]=g,Ra[I+3]=y}const No=new Uint16Array(2178),_s=new Uint8Array(1089),Yl=new Uint16Array(1089);function Om(d){return d===0?-.03125:d===32?.03125:0}const xh={type:2,extent:o.al,loadGeometry:()=>[[new o.P(0,0),new o.P(o.al+1,0),new o.P(o.al+1,o.al+1),new o.P(0,o.al+1),new o.P(0,0)]]};class al{constructor(n,a,h,g,y,x){this.tileID=n,this.uid=o.b2(),this.uses=0,this.tileSize=a,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection),this.worldview=x}registerFadeDuration(n){const a=n+this.timeAdded;a<o.o.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,a,h){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=Hd(n.buckets,a.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const y=this.buckets[g];if(y instanceof o.b4){if(this.hasSymbolBuckets=!0,!h)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const y=this.buckets[g];if(y instanceof o.b4&&y.hasRTLText){this.hasRTLText=!0,o.b5();break}}this.queryPadding=0;for(const g in this.buckets){const y=this.buckets[g],x=a.style.getOwnLayer(g);if(!x)continue;const T=x.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,T)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new o.b3}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,a,h){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,Hd(n.buckets,a.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const g in this.buckets){const y=this.buckets[g];y.uploadPending()&&y.upload(n)}const a=n.gl,h=this.imageAtlas;h&&!h.uploaded&&(this.imageAtlasTexture=new o.T(n,h.image,a.RGBA8,{useMipmap:!!h.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(n,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(n,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(n,a,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,h),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const g=a.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==g),this._lastUpdatedBrightness=g))}queryRenderedFeatures(n,a,h,g,y,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const T=function(I,P){const R=o.bq([],[.5*I.width,.5*-I.height,1]);return o.br(R,R,[1,-1,0]),o.aB(R,R,I.calculateProjMatrix(P.toUnwrapped())),Float32Array.from(R)}(y,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:a,pixelPosMatrix:T,transform:g,availableImages:h,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(n,a){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const g=h.loadVTLayers(),y=a?a.sourceLayer:"",x=g._geojsonTileLayer||g[y];if(!x)return;const T=o.b6(a&&a.filter),{z:I,x:P,y:R}=this.tileID.canonical,F={z:I,x:P,y:R};for(let D=0;D<x.length;D++){const j=x.feature(D);if(T.needGeometry){const J=o.b7(j,!0);if(!T.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),J,this.tileID.canonical))continue}else if(!T.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),j))continue;const U=h.getId(j,y),G=new o.b8(j,I,P,R,U);G.tile=F,n.push(G)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const a=this.expirationTime;if(n.cacheControl){const h=o.b9(n.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const h=Date.now();let g=!1;if(this.expirationTime>h)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{const y=this.expirationTime-a;y?this.expirationTime=h+Math.max(y,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}updateBuckets(n,a){if(!this.latestFeatureIndex||!n.style)return;const h=this.latestFeatureIndex.loadVTLayers(),g=n.style.listImages(),y=n.style.getBrightness();for(const x in this.buckets){if(!n.style.hasLayer(x))continue;const T=this.buckets[x],I=T.layers[0],P=I.sourceLayer||"_geojsonTileLayer",R=h[P],F=n.style.getLayerSourceCache(I);let D={};F&&(D=F._state.getState(P,void 0));const j=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},U=Object.keys(D).length>0&&!a;(U&&T.stateDependentLayers.length!==0||a)&&T.update(D,R,g,j,U?T.stateDependentLayers:T.layers,a,y),(T instanceof o.ba||T instanceof o.bb)&&n._terrain&&n._terrain.enabled&&F&&T.uploadPending()&&n._terrain._clearRenderCacheForTile(F.id,this.tileID);const G=n&&n.style&&n.style.getOwnLayer(x);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=o.o.now()+n}setTexture(n,a){const h=a.context,g=h.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof o.T?this.texture.update(n):(this.texture=new o.T(h,n,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(n,a){const h={};for(const g of a)h[g]=!0;this.dependencies[n]=h}hasDependency(n,a){for(const h of n){const g=this.dependencies[h];if(g){for(const y of a)if(g[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const h=o.bc(xh,this.tileID.canonical,this.tileTransform)[0],g=new o.bd,y=new o.be;for(let x=0;x<h.length;x++){const{x:T,y:I}=h[x];g.emplaceBack(T,I),y.emplaceBack(x)}y.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(y),this._tileDebugBuffer=n.createVertexBuffer(g,o.bf.members),this._tileDebugSegments=o.bg.simpleSegment(0,0,g.length,y.length)}_makeTileBoundsBuffers(n,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const h=o.bc(xh,this.tileID.canonical,this.tileTransform)[0];let g,y;if(this.isRaster){const x=function(T,I){const P=o.aZ(T,I),R=Math.pow(2,T.z);for(let J=0;J<Fo;J++)for(let Z=0;Z<Fo;Z++){const ee=o.a_((T.x+(Z+Om(Z))/so)/R),oe=o.a$((T.y+(J+Om(J))/so)/R),ue=I.project(ee,oe),ye=J*Fo+Z;No[2*ye+0]=Math.round((ue.x*P.scale-P.x)*o.al),No[2*ye+1]=Math.round((ue.y*P.scale-P.y)*o.al)}_s.fill(0),Yl.fill(0);for(let J=2045;J>=0;J--){const Z=4*J,ee=Ra[Z+0],oe=Ra[Z+1],ue=Ra[Z+2],ye=Ra[Z+3],ge=ee+ue>>1,ve=oe+ye>>1,_e=ge+ve-oe,me=ve+ee-ge,xe=oe*Fo+ee,Ne=ye*Fo+ue,Re=ve*Fo+ge,qe=Math.hypot((No[2*xe+0]+No[2*Ne+0])/2-No[2*Re+0],(No[2*xe+1]+No[2*Ne+1])/2-No[2*Re+1])>=16;_s[Re]=_s[Re]||(qe?1:0),J<1022&&(_s[Re]=_s[Re]||_s[(oe+me>>1)*Fo+(ee+_e>>1)]||_s[(ye+me>>1)*Fo+(ue+_e>>1)])}const F=new o.b0,D=new o.b1;let j=0;function U(J,Z){const ee=Z*Fo+J;return Yl[ee]===0&&(F.emplaceBack(No[2*ee+0],No[2*ee+1],J*o.al/so,Z*o.al/so),Yl[ee]=++j),Yl[ee]-1}function G(J,Z,ee,oe,ue,ye){const ge=J+ee>>1,ve=Z+oe>>1;if(Math.abs(J-ue)+Math.abs(Z-ye)>1&&_s[ve*Fo+ge])G(ue,ye,J,Z,ge,ve),G(ee,oe,ue,ye,ge,ve);else{const _e=U(J,Z),me=U(ee,oe),xe=U(ue,ye);D.emplaceBack(_e,me,xe)}}return G(0,0,so,so,so,0),G(so,so,0,0,0,so),{vertices:F,indices:D}}(this.tileID.canonical,a);g=x.vertices,y=x.indices}else{g=new o.b0,y=new o.b1;for(const{x:T,y:I}of h)g.emplaceBack(T,I,0,0);const x=o.bh(g.int16.subarray(0,4*g.length),void 0,4);for(let T=0;T<x.length;T+=3)y.emplaceBack(x[T],x[T+1],x[T+2])}this._tileBoundsBuffer=n.createVertexBuffer(g,o.bi.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(y),this._tileBoundsSegments=o.bg.simpleSegment(0,0,g.length,y.length)}_makeGlobeTileDebugBuffers(n,a){const h=a.projection;if(!h||h.name!=="globe"||a.freezeTileCoverage)return;const g=this.tileID.canonical,y=o.bj(g,a),x=o.bk(y),T=o.aj(a.zoom);let I;T>0&&(I=o.bl(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,g,a,x,I,T),this._makeGlobeTileDebugTextBuffer(n,g,a,x,I,T)}_globePoint(n,a,h,g,y,x,T){let I=o.bm(n,a,h);if(x){const P=1<<h.z,R=o.aF(g.center.lng),F=o.aJ(g.center.lat),D=(h.x+.5)/P-R;let j=0;D>.5?j=-1:D<-.5&&(j=1);let U=(n/o.al+h.x)/P+j,G=(a/o.al+h.y)/P;U=(U-R)*g._pixelsPerMercatorPixel+R,G=(G-F)*g._pixelsPerMercatorPixel+F;const J=[U*g.worldSize,G*g.worldSize,0];o.af(J,J,x),I=o.bn(I,J,T)}return o.af(I,I,y)}_makeGlobeTileDebugBorderBuffer(n,a,h,g,y,x){const T=new o.bd,I=new o.be,P=new o.bo,R=(D,j,U,G,J)=>{const Z=(U-D)/(J-1),ee=(G-j)/(J-1),oe=T.length;for(let ue=0;ue<J;ue++){const ye=D+ue*Z,ge=j+ue*ee;T.emplaceBack(ye,ge);const ve=this._globePoint(ye,ge,a,h,g,y,x);P.emplaceBack(ve[0],ve[1],ve[2]),I.emplaceBack(oe+ue)}},F=o.al;R(0,0,F,0,16),R(F,0,F,F,16),R(F,F,0,F,16),R(0,F,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(I),this._tileDebugBuffer=n.createVertexBuffer(T,o.bf.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(P,o.bp.members),this._tileDebugSegments=o.bg.simpleSegment(0,0,T.length,I.length)}_makeGlobeTileDebugTextBuffer(n,a,h,g,y,x){const T=o.al/4,I=new o.bd,P=new o.b1,R=new o.bo,F=25;P.reserve(32),I.reserve(F),R.reserve(F);const D=(j,U)=>F*j+U;for(let j=0;j<F;j++){const U=j*T;for(let G=0;G<F;G++){const J=G*T;I.emplaceBack(J,U);const Z=this._globePoint(J,U,a,h,g,y,x);R.emplaceBack(Z[0],Z[1],Z[2])}}for(let j=0;j<4;j++)for(let U=0;U<4;U++){const G=D(j,U),J=D(j,U+1),Z=D(j+1,U),ee=D(j+1,U+1);P.emplaceBack(G,J,Z),P.emplaceBack(Z,J,ee)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(P),this._tileDebugTextBuffer=n.createVertexBuffer(I,o.bf.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(R,o.bp.members),this._tileDebugTextSegments=o.bg.simpleSegment(0,0,F,32)}destroy(n=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bs.setPbf(o.bt);class wh extends al{constructor(n,a,h,g,y){super(n,a,h,g,y),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexturePerLayer(n,a,h){const g=h.context,y=g.gl;let x=this.texturePerLayer.get(n)||h.getTileTexture(a.width);x&&x instanceof o.T?x.update(a,{premultiply:!1}):x=new o.T(g,a,y.RGBA8,{premultiply:!1}),this.texturePerLayer.has(n)||this.texturePerLayer.set(n,x)}flushQueues(n){const a=this._workQueuePerLayer.get(n)||[],h=this._fetchQueuePerLayer.get(n)||[];for(;a.length;)a.pop()();for(;h.length;)h.pop()()}flushAllQueues(){for(const n of this._workQueuePerLayer.keys()){const a=this._workQueuePerLayer.get(n)||[];for(;a.length;)a.pop()()}for(const n of this._fetchQueuePerLayer.keys()){const a=this._fetchQueuePerLayer.get(n)||[];for(;a.length;)a.pop()()}}fetchHeader(n=16384,a){const h=this._mrt=new o.bs(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=o.bu(g,(y,x,T,I)=>{if(y)a(y);else try{const P=h.getHeaderLength(x);if(P>n)return void(this.request=this.fetchHeader(P,a));h.parseHeader(x),this._isHeaderLoaded=!0;let R=0;for(const F of Object.values(h.layers))R=Math.max(R,F.dataIndex[F.dataIndex.length-1].lastByte);x.byteLength>=R&&(this.entireBuffer=x),a(null,this.entireBuffer||x,T,I)}catch(P){a(P)}}),this.request}fetchBandForRender(n,a,h,g){this.fetchBand(n,a,h,y=>{if(y)return void g(y);this.updateTextureDescriptor(n,a,h);const x=this.textureDescriptorPerLayer.get(a);g(null,x?x.img:null)})}fetchBand(n,a,h,g,y=!0){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void g(new Error("Tile header is not ready"));const T=this.actor;if(!T)return void g(new Error("Can't fetch tile band without an actor"));let I;const P=o.B(String(h),o.B(this.tileID.key,n));let R=this._taskQueue.get(P);R?R.add(g):(R=new Set,R.add(g),this._taskQueue.set(P,R));const F=(G,J)=>{I.complete(G,J),G?g(G):(R.values().forEach(Z=>Z(null,J)),this._taskQueue.delete(P))},D=(G,J)=>{if(G)return g(G);const Z=T.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:J,task:I},F,void 0,!0);if(a!==null){const ee=this._workQueuePerLayer.get(a)||[];ee.push(()=>{Z&&Z.cancel(),I.cancel()}),this._workQueuePerLayer.has(a)||this._workQueuePerLayer.set(a,ee)}};let j;try{j=x.getLayer(n)}catch(G){if(this.state==="reloading")return;throw G}if(!j)return void g(new Error(`Unknown sourceLayer "${n}"`));if(j.hasDataForBand(h))return R.values().forEach(G=>G(null,null)),void this._taskQueue.delete(P);const U=j.getDataRange([h]);if(I=x.createDecodingTask(U),!I||I.tasks.length)if(a!==null&&this.flushQueues(a),this.entireBuffer)D(null,this.entireBuffer.slice(U.firstByte,U.lastByte+1));else{const G=Object.assign({},this.requestParams,{headers:{Range:`bytes=${U.firstByte}-${U.lastByte}`}}),J=o.bu(G,D);if(a!==null){const Z=this._fetchQueuePerLayer.get(a)||[];Z.push(()=>{J.cancel(),I.cancel()}),this._fetchQueuePerLayer.has(a)||this._fetchQueuePerLayer.set(a,Z)}}}updateNeeded(n,a){return(!this.textureDescriptorPerLayer.get(n)||this.textureDescriptorPerLayer.get(n).band!==a||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(n,a,h){if(!this._mrt)return;const g=this._mrt.getLayer(n);if(!g||!g.hasBand(h)||!g.hasDataForBand(h))return;const{bytes:y,tileSize:x,buffer:T,offset:I,scale:P}=g.getBandView(h),R=x+2*T,F=new o.q({width:R,height:R},y),D=this.texturePerLayer.get(a);D&&D instanceof o.T&&D.update(F,{premultiply:!1}),this.textureDescriptorPerLayer.set(a,{layer:n,band:h,img:F,buffer:T,offset:I,tileSize:x,format:g.pixelFormat,mix:[P,256*P,65536*P,16777216*P]})}destroy(n=!1){if(super.destroy(n),delete this._mrt,!n)for(const a of this.texturePerLayer.values())a&&a instanceof o.T&&a.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class bh{constructor(n,a){this.max=n,this.onRemove=a,this.reset()}reset(){for(const n in this.data)for(const a of this.data[n])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(n,a,h){const g=n.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const y={value:a,timeout:void 0};if(h!==void 0&&(y.timeout=setTimeout(()=>{this.remove(n,y)},h)),this.data[g].push(y),this.order.push(g),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const a=this.data[n].shift();return a.timeout&&clearTimeout(a.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),a.value}getByKey(n){const a=this.data[n];return a?a[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,a){if(!this.has(n))return this;const h=n.wrapped().key,g=a===void 0?0:this.data[h].indexOf(a),y=this.data[h][g];return this.data[h].splice(g,1),y.timeout&&clearTimeout(y.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(y.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(n){const a=[];for(const h in this.data)for(const g of this.data[h])n(g.value)||a.push(g);for(const h of a)this.remove(h.value.tileID,h)}}class $c{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,a,h){const g=String(a);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][g]=this.stateChanges[n][g]||{},Object.assign(this.stateChanges[n][g],h),this.deletedStates[n]===null){this.deletedStates[n]={};for(const y in this.state[n])y!==g&&(this.deletedStates[n][y]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][g]===null){this.deletedStates[n][g]={};for(const y in this.state[n][g])h[y]||(this.deletedStates[n][g][y]=null)}else for(const y in h)this.deletedStates[n]&&this.deletedStates[n][g]&&this.deletedStates[n][g][y]===null&&delete this.deletedStates[n][g][y]}removeFeatureState(n,a,h){if(this.deletedStates[n]===null)return;const g=String(a);if(this.deletedStates[n]=this.deletedStates[n]||{},h&&a!==void 0)this.deletedStates[n][g]!==null&&(this.deletedStates[n][g]=this.deletedStates[n][g]||{},this.deletedStates[n][g][h]=null);else if(a!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][g])for(h in this.deletedStates[n][g]={},this.stateChanges[n][g])this.deletedStates[n][g][h]=null;else this.deletedStates[n][g]=null;else this.deletedStates[n]=null}getState(n,a){const h=this.state[n]||{},g=this.stateChanges[n]||{},y=this.deletedStates[n];if(y===null)return{};if(a!==void 0){const T=String(a),I=Object.assign({},h[T],g[T]);if(y){const P=y[a];if(P===null)return{};for(const R in P)delete I[R]}return I}const x=Object.assign({},h,g);if(y)for(const T in y)delete x[T];return x}initializeTileState(n,a){n.refreshFeatureState(a)}coalesceChanges(n,a){const h={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const y={};for(const x in this.stateChanges[g])this.state[g][x]||(this.state[g][x]={}),Object.assign(this.state[g][x],this.stateChanges[g][x]),y[x]=this.state[g][x];h[g]=y}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const y={};if(this.deletedStates[g]===null)for(const x in this.state[g])y[x]={},this.state[g][x]={};else for(const x in this.deletedStates[g]){if(this.deletedStates[g][x]===null)this.state[g][x]={};else if(this.state[g][x])for(const T of Object.keys(this.deletedStates[g][x]))delete this.state[g][x][T];y[x]=this.state[g][x]}h[g]=h[g]||{},Object.assign(h[g],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const g in n)n[g].refreshFeatureState(a)}}class oo extends o.E{constructor(n,a,h){super(),this.id=n,this._onlySymbols=h,a.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new bh(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new $c,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,a){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,a)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const h=this._tiles[a];h.upload(n),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(Fm).map(n=>n.key)}getRenderableIds(n,a){const h=[];for(const g in this._tiles)this._isIdRenderable(+g,n,a)&&h.push(this._tiles[g]);return n?h.sort((g,y)=>{const x=g.tileID,T=y.tileID,I=new o.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),P=new o.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-T.overscaledZ||P.y-I.y||P.x-I.x}).map(g=>g.tileID.key):h.map(g=>g.tileID).sort(Fm).map(g=>g.key)}hasRenderableParent(n){const a=this.findLoadedParent(n,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(n,a,h){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(a||!this._tiles[n].holdingForFade())&&(h||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,a){const h=this._tiles[n];h&&(h.state!=="loading"&&(h.state=a),this._loadTile(h,this._tileLoaded.bind(this,h,n,a)))}_tileLoaded(n,a,h,g){if(g)if(n.state="errored",g.status!==404)this._source.fire(new o.y(g,{tile:n}));else{if(this._source.fire(new o.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=o.o.now(),h==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(a,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new o.z("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const a=this.getRenderableIds();for(let g=0;g<a.length;g++){const y=a[g];if(n.neighboringTiles&&n.neighboringTiles[y]){const x=this.getTileByID(y);h(n,x),h(x,n)}}function h(g,y){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let x=y.tileID.canonical.x-g.tileID.canonical.x;const T=y.tileID.canonical.y-g.tileID.canonical.y,I=Math.pow(2,g.tileID.canonical.z),P=y.tileID.key;x===0&&T===0||Math.abs(T)>1||(Math.abs(x)>1&&(Math.abs(x+I)===1?x+=I:Math.abs(x-I)===1&&(x-=I)),y.dem&&g.dem&&(g.dem.backfillBorder(y.dem,x,T),g.neighboringTiles&&g.neighboringTiles[P]&&(g.neighboringTiles[P].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,a,h,g){for(const y in this._tiles){let x=this._tiles[y];if(g[y]||!x.hasData()||x.tileID.overscaledZ<=a||x.tileID.overscaledZ>h)continue;let T=x.tileID;for(;x&&x.tileID.overscaledZ>a+1;){const P=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[P.key],x&&x.hasData()&&(T=P)}let I=T;for(;I.overscaledZ>a;)if(I=I.scaledTo(I.overscaledZ-1),n[I.key]){g[T.key]=T;break}}}findLoadedParent(n,a){if(n.key in this._loadedParentTiles){const h=this._loadedParentTiles[n.key];return h&&h.tileID.overscaledZ>=a?h:null}for(let h=n.overscaledZ-1;h>=a;h--){const g=n.scaledTo(h),y=this._getLoadedTile(g);if(y)return y}}_getLoadedTile(n){const a=this._tiles[n.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,a){a=a||this._source.tileSize;const h=Math.ceil(n.width/a)+1,g=Math.ceil(n.height/a)+1,y=Math.floor(h*g*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(T)}handleWrapJump(n){const a=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,a){const h={};for(const g in this._tiles){const y=this._tiles[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+a),h[y.tileID.key]=y}this._tiles=h;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(n,a,h,g,y){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;this.updateCacheSize(n,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const x=this._source.type==="batched-model";let T,I=this._source.maxzoom;const P=this.map&&this.map.painter?this.map.painter._terrain:null;if(P&&P.sourceCache===this&&P.attenuationRange()){const D=P.attenuationRange()[0],j=Math.floor(D)-Math.log2(P.getDemUpscale());I>j&&(I=j)}if(this.used||this.usedForTerrain){if(this._source.tileID)T=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new o.aO(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y));else if(this.tileCoverLift!==0){const D=n.clone();D.tileCoverLift=this.tileCoverLift,T=D.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.minzoom<=1&&n.projection.name==="globe"&&(T.push(new o.aO(1,0,1,0,0)),T.push(new o.aO(1,0,1,1,0)),T.push(new o.aO(1,0,1,0,1)),T.push(new o.aO(1,0,1,1,1)))}else if(T=n.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.hasTile){const D=this._source.hasTile.bind(this._source);T=T.filter(j=>D(j))}}else T=[];if(T.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Wd(this._source.type)){const D=n.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),j=Math.min(D,this._source.maxzoom);if(x){const U=n.extendTileCover(T,j);for(const G of U)T.push(G)}else if(y){const U=n.extendTileCoverToNearPlane(T,this.transform.getFrustum(j),j);for(const G of U)T.push(G)}else if(this.castsShadows&&g){const U=n.extendTileCover(T,j,g);for(const G of U)this._shadowCasterTiles[G.key]=!0,T.push(G)}}const R=this._updateRetainedTiles(T);if(Wd(this._source.type)&&T.length!==0){const D={},j={},U=Object.keys(R);for(const J of U){const Z=R[J],ee=this._tiles[J];if(!ee||ee.fadeEndTime&&ee.fadeEndTime<=o.o.now())continue;const oe=this.findLoadedParent(Z,Math.max(Z.overscaledZ-oo.maxOverzooming,this._source.minzoom));oe&&(this._addTile(oe.tileID),D[oe.tileID.key]=oe.tileID),j[J]=Z}const G=T[T.length-1].overscaledZ;for(const J in this._tiles){const Z=this._tiles[J];if(R[J]||!Z.hasData())continue;let ee=Z.tileID;for(;ee.overscaledZ>G;){ee=ee.scaledTo(ee.overscaledZ-1);const oe=this._tiles[ee.key];if(oe&&oe.hasData()&&j[ee.key]){R[J]=Z.tileID;break}}}for(const J in D)R[J]||(this._coveredTiles[J]=!0,R[J]=D[J])}for(const D in R)this._tiles[D].clearFadeHold();const F=o.bv(this._tiles,R);for(const D of F){const j=this._tiles[D];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(+D)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const a={};if(n.length===0)return a;const h={},g=n.reduce((P,R)=>Math.min(P,R.overscaledZ),1/0),y=n[0].overscaledZ,x=Math.max(y-oo.maxOverzooming,this._source.minzoom),T=Math.max(y+oo.maxUnderzooming,this._source.minzoom),I={};for(const P of n){const R=this._addTile(P);a[P.key]=P,R.hasData()||g<this._source.maxzoom&&(I[P.key]=P)}this._retainLoadedChildren(I,g,T,a);for(const P of n){let R=this._tiles[P.key];if(R.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const D=P.children(this._source.maxzoom)[0],j=this.getTile(D);if(j&&j.hasData()){a[D.key]=D;continue}}else{const D=P.children(this._source.maxzoom);if(a[D[0].key]&&a[D[1].key]&&a[D[2].key]&&a[D[3].key])continue}let F=R.wasRequested();for(let D=P.overscaledZ-1;D>=x;--D){const j=P.scaledTo(D);if(h[j.key]||(h[j.key]=!0,R=this.getTile(j),!R&&F&&(R=this._addTile(j)),R&&(a[j.key]=j,F=R.wasRequested(),R.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const a=[];let h,g=this._tiles[n].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){h=this._loadedParentTiles[g.key];break}a.push(g.key);const y=g.scaledTo(g.overscaledZ-1);if(h=this._getLoadedTile(y),h)break;g=y}for(const y of a)this._loadedParentTiles[y]=h}}_addTile(n){let a=this._tiles[n.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),a;a=this._cache.getAndRemove(n),a&&(this._setTileReloadTimer(n.key,a),a.tileID=n,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,a)));const h=!!a;if(!h){const g=this.map?this.map.painter:null,y=this._source.tileSize*n.overscaleFactor();a=this._source.type==="raster-array"?new wh(n,y,this.transform.tileZoom,g,this._isRaster):new al(n,y,this.transform.tileZoom,g,this._isRaster,this._source.worldview),this._loadTile(a,this._tileLoaded.bind(this,a,n.key,a.state))}return a.uses++,this._tiles[n.key]=a,h||this._source.fire(new o.z("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(n,a){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const h=a.getExpiryTimeout();h&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},h))}_removeTile(n){const a=this._tiles[n];a&&(a.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,a,h){const g=[],y=this.transform;if(!y)return g;const x=y.projection.name==="globe",T=o.aF(y.center.lng);for(const I in this._tiles){const P=this._tiles[I];if(h&&P.clearQueryDebugViz(),P.holdingForFade())continue;let R;if(x){const F=P.tileID.canonical;if(F.z===0){const D=[Math.abs(o.aA(T,...Hc(F,-1))-T),Math.abs(o.aA(T,...Hc(F,1))-T)];R=[0,2*D.indexOf(Math.min(...D))-1]}else{const D=[Math.abs(o.aA(T,...Hc(F,-1))-T),Math.abs(o.aA(T,...Hc(F,0))-T),Math.abs(o.aA(T,...Hc(F,1))-T)];R=[D.indexOf(Math.min(...D))-1]}}else R=[0];for(const F of R){const D=n.containsTile(P,y,a,F);D&&g.push(D)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,a){const h=this.getRenderableIds(n,a).map(y=>this._tiles[y].tileID),g=this.transform.projection.name==="globe";for(const y of h)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=g?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return h}sortCoordinatesByDistance(n){const a=n.slice(),h=this.transform._camera.position,g=this.transform._camera.forward(),y={};for(const x of a){const T=1/(1<<x.canonical.z);y[x.key]=((x.canonical.x+.5)*T+x.wrap-h[0])*g[0]+((x.canonical.y+.5)*T-h[1])*g[1]-h[2]*g[2]}return a.sort((x,T)=>y[x.key]-y[T.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(Wd(this._source.type))for(const n in this._tiles){const a=this._tiles[n];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=o.o.now())return!0}return!1}setFeatureState(n,a,h){this._state.updateState(n=n||"_geojsonTileLayer",a,h)}removeFeatureState(n,a,h){this._state.removeFeatureState(n=n||"_geojsonTileLayer",a,h)}getFeatureState(n,a){return this._state.getState(n=n||"_geojsonTileLayer",a)}setDependencies(n,a,h){const g=this._tiles[n];g&&g.setDependencies(a,h)}reloadTilesForDependencies(n,a){for(const h in this._tiles)this._tiles[h].hasDependency(n,a)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(n,a))}_preloadTiles(n,a){if(!this._sourceLoaded){const I=()=>{this._sourceLoaded&&(this._source.off("data",I),this._preloadTiles(n,a))};return void this._source.on("data",I)}const h=new Map,g=Array.isArray(n)?n:[n],y=this.map.painter.terrain,x=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const I of g){const P=I.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const R of P)h.set(R.key,R);this.usedForTerrain&&I.updateElevation(!1)}const T=Array.from(h.values());o.bw(T,(I,P)=>{const R=new al(I,this._source.tileSize*I.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(R,F=>{this._source.type==="raster-dem"&&R.dem&&this._backfillDEM(R),P(F,R)})},a)}}function Fm(d,n){const a=Math.abs(2*d.wrap)-+(d.wrap<0),h=Math.abs(2*n.wrap)-+(n.wrap<0);return d.overscaledZ-n.overscaledZ||h-a||n.canonical.y-d.canonical.y||n.canonical.x-d.canonical.x}function Wd(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function Hc(d,n){const a=1<<d.z;return[d.x/a+n,(d.x+1)/a+n]}oo.maxOverzooming=10,oo.maxUnderzooming=3;class qd{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,a=!1;for(const h in this.style._mergedLayers){const g=this.style._mergedLayers[h];if(g.type==="fill-extrusion"||g.type==="building")this.layers.push({layer:g,visible:n,visibilityChanged:a});else if(g.type==="model"){const y=this.style.getLayerSource(g);y&&y.type==="batched-model"&&this.layers.push({layer:g,visible:n,visibilityChanged:a})}}}onNewFrame(n){this.layersGotHidden=!1;for(const a of this.layers){const h=a.layer;let g=!1;h.type==="fill-extrusion"?g=!h.isHidden(n)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="building"?g=!h.isHidden(n)&&h.paint.get("building-opacity")>0:h.type==="model"&&(g=!h.isHidden(n)&&h.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!g&&a.visible,a.visible=g}}updateZOffset(n,a){this.currentBuildingBuckets=[];for(const g of this.layers){const y=g.layer,x=this.style.getLayerSourceCache(y);let T=1;y.type==="fill-extrusion"?T=g.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(T=g.visible?y.paint.get("building-vertical-scale"):0);let I=x?x.getTile(a):null;if(!I&&x)for(const P in x._tiles){const R=x._tiles[P];if(a.canonical.isChildOf(R.tileID.canonical)){I=R;break}}this.currentBuildingBuckets.push({bucket:I?I.getBucket(y):null,tileID:I?I.tileID:a,verticalScale:T})}n.hasAnyZOffset=!1;let h=!1;for(let g=0;g<n.symbolInstances.length;g++){const y=n.symbolInstances.get(g),x=y.zOffset,T=this._getHeightAtTileOffset(a,y.tileAnchorX,y.tileAnchorY);y.zOffset=T!==Number.NEGATIVE_INFINITY?T:x,h||x===y.zOffset||(h=!0),n.hasAnyZOffset||y.zOffset===0||(n.hasAnyZOffset=!0)}h&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,a,h,g){let y=a,x=h;if(n.canonical.z!==g.canonical.z){const T=g.canonical,I=1/(1<<n.canonical.z-T.z);y=(a+n.canonical.x*o.al)*I-T.x*o.al|0,x=(h+n.canonical.y*o.al)*I-T.y*o.al|0}return{tileX:y,tileY:x}}_getHeightAtTileOffset(n,a,h){let g,y;for(let x=0;x<this.layers.length;++x){const T=this.layers[x].layer;if(T.type!=="fill-extrusion"&&T.type!=="building")continue;const{bucket:I,tileID:P,verticalScale:R}=this.currentBuildingBuckets[x];if(!I)continue;const{tileX:F,tileY:D}=this._mapCoordToOverlappingTile(n,a,h,P),j=I.getHeightAtTileCoord(F,D);j&&j.height!==void 0&&(j.hidden?g=j.height:y=Math.max(j.height*R,y||0))}if(y!==void 0)return y;for(let x=0;x<this.layers.length;++x){const T=this.layers[x];if(T.layer.type!=="model"||!T.visible)continue;const{bucket:I,tileID:P}=this.currentBuildingBuckets[x];if(!I)continue;const{tileX:R,tileY:F}=this._mapCoordToOverlappingTile(n,a,h,P),D=I.getHeightAtTileCoord(R,F);if(D&&!D.hidden)return D.height===void 0&&g!==void 0?Math.min(D.maxHeight,g)*D.verticalScale:D.height?D.height*D.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Nm(d,n){const a={};for(const h in d)h!=="ref"&&(a[h]=d[h]);return o.bx.forEach(h=>{h in n&&(a[h]=n[h])}),a}function Zd(d){d=d.slice();const n=Object.create(null);for(let a=0;a<d.length;a++)n[d[a].id]=d[a];for(let a=0;a<d.length;a++)"ref"in d[a]&&(d[a]=Nm(d[a],n[d[a].ref]));return d}const Nn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Wc(d,n,a){a.push({command:Nn.addSource,args:[d,n[d]]})}function uv(d,n,a){n.push({command:Nn.removeSource,args:[d]}),a[d]=!0}function hv(d,n,a,h){uv(d,a,h),Wc(d,n,a)}function Xd(d,n,a){let h;for(h in d[a])if(d[a].hasOwnProperty(h)&&h!=="data"&&!o.by(d[a][h],n[a][h]))return!1;for(h in n[a])if(n[a].hasOwnProperty(h)&&h!=="data"&&!o.by(d[a][h],n[a][h]))return!1;return!0}function ll(d,n,a,h,g,y){let x;for(x in n=n||{},d=d||{})d.hasOwnProperty(x)&&(o.by(d[x],n[x])||a.push({command:y,args:[h,x,n[x],g]}));for(x in n)n.hasOwnProperty(x)&&!d.hasOwnProperty(x)&&(o.by(d[x],n[x])||a.push({command:y,args:[h,x,n[x],g]}))}function qc(d){return d.id}function Th(d,n){return d[n.id]=n,d}function Kd(d,n,a){const h=n.createTileMatrix(d,d.worldSize,a.toUnwrapped());return o.aB(new Float32Array(16),d.projMatrix,h)}function dv(d,n,a){if(n.projection.name===a.projection.name)return d.projMatrix;const h=a.clone();return h.setProjection(n.projection),Kd(h,n.getProjection(),d)}function Jl(d,n,a){return n.name===a.projection.name?d.projMatrix:Kd(a,n,d)}class fv{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=o.aA(n,0,1);let a=1,h=this._distances[a];const g=n*this.paddedLength+this.padding;for(;h<g&&a<this._distances.length;)h=this._distances[++a];const y=a-1,x=this._distances[y],T=h-x,I=T>0?(g-x)/T:0;return this.points[y].mult(1-I).add(this.points[a].mult(I))}}class Bm{constructor(n,a,h){const g=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(n/h),this.yCellCount=Math.ceil(a/h);for(let x=0;x<this.xCellCount*this.yCellCount;x++)g.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,h,g,y){this._forEachCell(a,h,g,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(y)}insertCircle(n,a,h,g){this._forEachCell(a-g,h-g,a+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(h),this.circles.push(g)}_insertBoxCell(n,a,h,g,y,x){this.boxCells[y].push(x)}_insertCircleCell(n,a,h,g,y,x){this.circleCells[y].push(x)}_query(n,a,h,g,y,x){if(h<0||n>this.width||g<0||a>this.height)return!y&&[];const T=[];if(n<=0&&a<=0&&this.width<=h&&this.height<=g){if(y)return!0;for(let I=0;I<this.boxKeys.length;I++)T.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const P=this.circles[3*I],R=this.circles[3*I+1],F=this.circles[3*I+2];T.push({key:this.circleKeys[I],x1:P-F,y1:R-F,x2:P+F,y2:R+F})}return x?T.filter(x):T}return this._forEachCell(n,a,h,g,this._queryCell,T,{hitTest:y,seenUids:{box:{},circle:{}}},x),y?T.length>0:T}_queryCircle(n,a,h,g,y){const x=n-h,T=n+h,I=a-h,P=a+h;if(T<0||x>this.width||P<0||I>this.height)return!g&&[];const R=[];return this._forEachCell(x,I,T,P,this._queryCellCircle,R,{hitTest:g,circle:{x:n,y:a,radius:h},seenUids:{box:{},circle:{}}},y),g?R.length>0:R}query(n,a,h,g,y){return this._query(n,a,h,g,!1,y)}hitTest(n,a,h,g,y){return this._query(n,a,h,g,!0,y)}hitTestCircle(n,a,h,g){return this._queryCircle(n,a,h,!0,g)}_queryCell(n,a,h,g,y,x,T,I){const P=T.seenUids,R=this.boxCells[y];if(R!==null){const D=this.bboxes;for(const j of R)if(!P.box[j]){P.box[j]=!0;const U=4*j;if(n<=D[U+2]&&a<=D[U+3]&&h>=D[U+0]&&g>=D[U+1]&&(!I||I(this.boxKeys[j]))){if(T.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[j],x1:D[U],y1:D[U+1],x2:D[U+2],y2:D[U+3]})}}}const F=this.circleCells[y];if(F!==null){const D=this.circles;for(const j of F)if(!P.circle[j]){P.circle[j]=!0;const U=3*j;if(this._circleAndRectCollide(D[U],D[U+1],D[U+2],n,a,h,g)&&(!I||I(this.circleKeys[j]))){if(T.hitTest)return x.push(!0),!0;{const G=D[U],J=D[U+1],Z=D[U+2];x.push({key:this.circleKeys[j],x1:G-Z,y1:J-Z,x2:G+Z,y2:J+Z})}}}}}_queryCellCircle(n,a,h,g,y,x,T,I){const P=T.circle,R=T.seenUids,F=this.boxCells[y];if(F!==null){const j=this.bboxes;for(const U of F)if(!R.box[U]){R.box[U]=!0;const G=4*U;if(this._circleAndRectCollide(P.x,P.y,P.radius,j[G+0],j[G+1],j[G+2],j[G+3])&&(!I||I(this.boxKeys[U])))return x.push(!0),!0}}const D=this.circleCells[y];if(D!==null){const j=this.circles;for(const U of D)if(!R.circle[U]){R.circle[U]=!0;const G=3*U;if(this._circlesCollide(j[G],j[G+1],j[G+2],P.x,P.y,P.radius)&&(!I||I(this.circleKeys[U])))return x.push(!0),!0}}}_forEachCell(n,a,h,g,y,x,T,I){const P=this._convertToXCellCoord(n),R=this._convertToYCellCoord(a),F=this._convertToXCellCoord(h),D=this._convertToYCellCoord(g);for(let j=P;j<=F;j++)for(let U=R;U<=D;U++)if(y.call(this,n,a,h,g,this.xCellCount*U+j,x,T,I))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,h,g,y,x){const T=g-n,I=y-a,P=h+x;return P*P>T*T+I*I}_circleAndRectCollide(n,a,h,g,y,x,T){const I=(x-g)/2,P=Math.abs(n-(g+I));if(P>I+h)return!1;const R=(T-y)/2,F=Math.abs(a-(y+R));if(F>R+h)return!1;if(P<=I||F<=R)return!0;const D=P-I,j=F-R;return D*D+j*j<=h*h}}const Zc={unknown:0,flipRequired:1,flipNotRequired:2},Yd=Math.tan(85*Math.PI/180);function Bo(d,n,a,h,g,y,x){const T=o.bC();if(a)if(y.name==="globe"){const I=o.bD(g,n);o.aB(T,T,I)}else{const I=o.bE([],x);T[0]=I[0],T[1]=I[1],T[4]=I[2],T[5]=I[3],h||o.bB(T,T,g.angle)}else o.aB(T,g.labelPlaneMatrix,d);return T}function Sh(d,n,a,h,g,y,x){const T=Bo(d,n,a,h,g,y,x);return y.name==="globe"&&a||(T[2]=T[6]=T[10]=T[14]=0),T}function Jd(d,n,a,h,g,y,x){if(a){if(y.name==="globe"){const T=Bo(d,n,a,h,g,y,x);return o.bl(T,T),o.aB(T,d,T),T}{const T=o.bz(d),I=o.bA([]);return I[0]=x[0],I[1]=x[1],I[4]=x[2],I[5]=x[3],o.aB(T,T,I),h||o.bB(T,T,-g.angle),T}}return g.glCoordMatrix}function ao(d,n,a,h){const g=[d,n,a,1];a?o.aC(g,g,h):Gm(g,g,h);const y=g[3];return g[0]/=y,g[1]/=y,g[2]/=y,g}function Ql(d,n){return Math.min(.5+d/n*.5,1.5)}function lo(d,n){const a=d[0]/d[3],h=d[1]/d[3];return a>=-n[0]&&a<=n[0]&&h>=-n[1]&&h<=n[1]}function jm(d,n,a,h,g,y,x,T,I,P){const R=a.transform,F=h?d.textSizeData:d.iconSizeData,D=o.bK(F,a.transform.zoom),j=R.projection.name==="globe",U=[256/a.width*2+1,256/a.height*2+1],G=h?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;G.clear();let J=null;j&&(J=h?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const Z=d.lineVertexArray,ee=h?d.text.placedSymbolArray:d.icon.placedSymbolArray,oe=a.transform.width/a.transform.height;let ue,ye=!1;for(let ge=0;ge<ee.length;ge++){const ve=ee.get(ge),{numGlyphs:_e,writingMode:me}=ve;if(me!==o.bL.vertical||ye||ue===o.bL.horizontal||(ye=!0),ue=me,(ve.hidden||me===o.bL.vertical)&&!ye){Kt(_e,G);continue}ye=!1;const xe=new o.P(ve.tileAnchorX,ve.tileAnchorY);let{x:Ne,y:Re,z:qe}=R.projection.projectTilePoint(xe.x,xe.y,P.canonical);if(I){const[at,jt,Ot]=I(xe);Ne+=at,Re+=jt,qe+=Ot}const Oe=[Ne,Re,qe,1];if(o.aC(Oe,Oe,n),!lo(Oe,U)){Kt(_e,G);continue}const We=Oe[3],gt=Ql(a.transform.getCameraToCenterDistance(R.projection),We),Fe=o.bM(F,D,ve),Ce=x?Fe/gt:Fe*gt,Ze=ao(Ne,Re,qe,g);if(Ze[3]<=0){Kt(_e,G);continue}let Ve={};const it=o.an(d.layers[0].layout.get("text-max-angle")),mt=Math.cos(it),It=x?null:I,ht=Jn(ve,Ce,!1,T,n,g,y,d.glyphOffsetArray,Z,G,J,Ze,xe,Ve,oe,It,R.projection,P,x,mt);ye=ht.useVertical,It&&ht.needsFlipping&&(Ve={}),(ht.notEnoughRoom||ye||ht.needsFlipping&&Jn(ve,Ce,!0,T,n,g,y,d.glyphOffsetArray,Z,G,J,Ze,xe,Ve,oe,It,R.projection,P,x,mt).notEnoughRoom)&&Kt(_e,G)}h?(d.text.dynamicLayoutVertexBuffer.updateData(G),J&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(J)):(d.icon.dynamicLayoutVertexBuffer.updateData(G),J&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(J))}function Qd(d,n,a,h,g,y,x,T,I,P,R,F,D,j,U,G,J){const{lineStartIndex:Z,glyphStartIndex:ee,segment:oe}=T,ue=ee+T.numGlyphs,ye=Z+T.lineLength,ge=n.getoffsetX(ee),ve=n.getoffsetX(ue-1),_e=ef(d*ge,a,h,g,y,x,oe,Z,ye,I,P,R,F,D,!0,j,U,G,J);if(!_e)return null;const me=ef(d*ve,a,h,g,y,x,oe,Z,ye,I,P,R,F,D,!0,j,U,G,J);return me?{first:_e,last:me}:null}function Vm(d,n,a,h){return d===o.bL.horizontal&&Math.abs(h)>Math.abs(a)?{useVertical:!0}:d===o.bL.vertical?h>0?{needsFlipping:!0}:null:n!==Zc.unknown&&function(g,y){return g===0||Math.abs(y/g)>Yd}(a,h)?n===Zc.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Jn(d,n,a,h,g,y,x,T,I,P,R,F,D,j,U,G,J,Z,ee,oe){const ue=n/24,ye=d.lineOffsetX*ue,ge=d.lineOffsetY*ue,{lineStartIndex:ve,glyphStartIndex:_e,numGlyphs:me,segment:xe,writingMode:Ne,flipState:Re}=d,qe=ve+d.lineLength,Oe=We=>{if(R){const[Ze,Ve,it]=We.up,mt=P.length;o.bN(R,mt+0,Ze,Ve,it),o.bN(R,mt+1,Ze,Ve,it),o.bN(R,mt+2,Ze,Ve,it),o.bN(R,mt+3,Ze,Ve,it)}const[gt,Fe,Ce]=We.point;o.bO(P,gt,Fe,Ce,We.angle)};if(me>1){const We=Qd(ue,T,ye,ge,a,F,D,d,I,y,j,G,!1,J,Z,ee,oe);if(!We)return{notEnoughRoom:!0};if(h&&!a){let[gt,Fe,Ce]=We.first.point,[Ze,Ve,it]=We.last.point;[gt,Fe]=ao(gt,Fe,Ce,x),[Ze,Ve]=ao(Ze,Ve,it,x);const mt=Vm(Ne,Re,(Ze-gt)*U,Ve-Fe);if(d.flipState=mt&&mt.needsFlipping?Zc.flipRequired:Zc.flipNotRequired,mt)return mt}Oe(We.first);for(let gt=_e+1;gt<_e+me-1;gt++){const Fe=ef(ue*T.getoffsetX(gt),ye,ge,a,F,D,xe,ve,qe,I,y,j,G,!1,!1,J,Z,ee,oe);if(!Fe)return P.length-=4*(gt-_e),{notEnoughRoom:!0};Oe(Fe)}Oe(We.last)}else{if(h&&!a){const gt=ao(D.x,D.y,0,g),Fe=ve+xe+1,Ce=new o.P(I.getx(Fe),I.gety(Fe)),Ze=ao(Ce.x,Ce.y,0,g),Ve=Ze[3]>0?Ze:pv(D,Ce,gt,1,g,void 0,J,Z.canonical),it=Vm(Ne,Re,(Ve[0]-gt[0])*U,Ve[1]-gt[1]);if(d.flipState=it&&it.needsFlipping?Zc.flipRequired:Zc.flipNotRequired,it)return it}const We=ef(ue*T.getoffsetX(_e),ye,ge,a,F,D,xe,ve,qe,I,y,j,G,!1,!1,J,Z,ee,oe);if(!We)return{notEnoughRoom:!0};Oe(We)}return{}}function Um(d,n,a,h,g){const{x:y,y:x,z:T}=h.projectTilePoint(d.x,d.y,n);if(!g)return ao(y,x,T,a);const[I,P,R]=g(d);return ao(y+I,x+P,T+R,a)}function pv(d,n,a,h,g,y,x,T){const I=Um(d.sub(n)._unit()._add(d),T,g,x,y);return o.av(I,a,I),o.aw(I,I),o.bH(I,a,I,h)}function ef(d,n,a,h,g,y,x,T,I,P,R,F,D,j,U,G,J,Z,ee){const oe=h?d-n:d+n;let ue=oe>0?1:-1,ye=0;h&&(ue*=-1,ye=Math.PI),ue<0&&(ye+=Math.PI);let ge=T+x+(ue>0?0:1)|0,ve=g,_e=g,me=0,xe=0;const Ne=Math.abs(oe),Re=[],qe=[];let Oe=y,We=Oe,gt=o.bF([]);const Fe=()=>pv(We,Oe,_e,Ne-me+1,R,D,G,J.canonical);for(;me+xe<=Ne;){if(ge+=ue,ge<T||ge>=I)return null;if(_e=ve,We=Oe,Re.push(_e),j&&qe.push(We),Oe=new o.P(P.getx(ge),P.gety(ge)),ve=F[ge],!ve){const Ot=Um(Oe,J.canonical,R,G,D);ve=Ot[3]>0?F[ge]=Ot:Fe()}me+=xe;const at=o.av([],ve,_e),jt=o.bG(_e,ve);if(a&&jt>0&&xe>0&&o.bJ(gt,at)/(xe*jt)<ee)return null;xe=jt,gt=at}U&&D&&(F[ge]&&(ve=Fe(),xe=o.bG(_e,ve),gt=o.av([],ve,_e)),F[ge]=ve);const Ce=(Ne-me)/xe,Ze=Oe.sub(We)._mult(Ce)._add(We),Ve=o.bH([],_e,gt,Ce);let it=[0,0,1],mt=gt[0],It=gt[1];if(Z&&(it=G.upVector(J.canonical,Ze.x,Ze.y),it[0]!==0||it[1]!==0||it[2]!==1)){const at=[it[2],0,-it[0]],jt=o.bI([],it,at);o.aw(at,at),o.aw(jt,jt),mt=o.bJ(gt,at),It=o.bJ(gt,jt)}if(a){const at=o.bI([],it,gt);o.aw(at,at),o.bH(Ve,Ve,at,a*ue)}const ht=ye+Math.atan2(It,mt);return Re.push(Ve),j&&qe.push(Ze),{point:Ve,angle:ht,path:Re,tilePath:qe,up:it}}function Kt(d,n){const a=n.length,h=a+4*d;n.resize(h),n.float32.fill(-1/0,4*a,4*h)}function Gm(d,n,a){const h=n[0],g=n[1];return d[0]=a[0]*h+a[4]*g+a[12],d[1]=a[1]*h+a[5]*g+a[13],d[3]=a[3]*h+a[7]*g+a[15],d}const co=100;class jo{constructor(n,a,h=new Bm(n.width+200,n.height+200,25),g=new Bm(n.width+200,n.height+200,25)){this.transform=n,this.grid=h,this.ignoredGrid=g,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+co,this.screenBottomBoundary=n.height+co,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,h,g,y,x,T,I,P,R,F){let D=h.projectedAnchorX,j=h.projectedAnchorY,U=h.projectedAnchorZ;const G=h.tileAnchorX,J=h.tileAnchorY,Z=h.elevation,ee=h.tileID,oe=n.getProjection();if(Z&&ee){const[qe,Oe,We]=oe.upVector(ee.canonical,h.tileAnchorX,h.tileAnchorY),gt=oe.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=qe*Z*gt,j+=Oe*Z*gt,U+=We*Z*gt}const ue=n.projection.name==="globe",ye=n.projection.name==="globe"?o.aj(this.transform.zoom):0;if(ee&&ue&&ye<1&&!x){const qe=1<<ee.canonical.z,Oe=o.bP(G,J);o.bQ(Oe,Oe,1/o.al),o.bR(Oe,Oe,o.bP(ee.canonical.x,ee.canonical.y)),o.bQ(Oe,Oe,1/qe),o.bS(Oe,Oe,o.bP(g[0],g[1])),Oe[0]=o.bT(Oe[0],-.5,.5),o.bQ(Oe,Oe,o.al);const We=o.bU(Oe[0],Oe[1],o.al/(2*Math.PI),1);o.aC(We,We,y),D=o.ak(D,We[0],ye),j=o.ak(j,We[1],ye),U=o.ak(U,We[2],ye)}const ge=this.projectAndGetPerspectiveRatio(R,D,j,U,h.tileID,oe.name==="globe"||!!Z||this.transform.pitch>0,oe),ve=P*ge.perspectiveRatio,_e=(h.x1*a+T.x-h.padding)*ve+ge.point.x,me=(h.y1*a+T.y-h.padding)*ve+ge.point.y,xe=(h.x2*a+T.x+h.padding)*ve+ge.point.x,Ne=(h.y2*a+T.y+h.padding)*ve+ge.point.y,Re=ge.perspectiveRatio<=.55||ge.occluded;return!this.isInsideGrid(_e,me,xe,Ne)||!I&&this.grid.hitTest(_e,me,xe,Ne,F)||Re?{box:[],offscreen:!1,occluded:ge.occluded}:{box:[_e,me,xe,Ne],offscreen:this.isOffscreen(_e,me,xe,Ne),occluded:!1}}placeCollisionCircles(n,a,h,g,y,x,T,I,P,R,F,D,j,U,G){const J=[],Z=this.transform.elevation,ee=n.getProjection(),oe=Z?Z.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,ee):null,ue=new o.P(h.tileAnchorX,h.tileAnchorY);let{x:ye,y:ge,z:ve}=ee.projectTilePoint(ue.x,ue.y,G.canonical);if(oe){const[it,mt,It]=oe(ue);ye+=it,ge+=mt,ve+=It}const _e=ee.name==="globe",me=this.projectAndGetPerspectiveRatio(T,ye,ge,ve,G,_e||!!Z||this.transform.pitch>0,ee),{perspectiveRatio:xe}=me,Ne=(F?x/xe:x*xe)/o.bX,Re=ao(ye,ge,ve,I),qe=h.lineOffsetX*Ne,Oe=h.lineOffsetY*Ne,We=o.an(n.layers[0].layout.get("text-max-angle")),gt=Math.cos(We),Fe=me.signedDistanceFromCamera>0?Qd(Ne,y,qe,Oe,!1,Re,ue,h,g,I,{},Z&&!F?oe:null,F&&!!Z,ee,G,F,gt):null;let Ce=!1,Ze=!1,Ve=!0;if(Fe&&!me.occluded){const it=.5*j*xe+U,mt=new o.P(-100,-100),It=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ht=new fv,{first:at,last:jt}=Fe,Ot=at.path.length;let Bt=[];for(let gn=Ot-1;gn>=1;gn--)Bt.push(at.path[gn]);for(let gn=1;gn<jt.path.length;gn++)Bt.push(jt.path[gn]);const zt=2.5*it;P&&(Bt=Bt.map(([gn,vn,ei],hn)=>(oe&&!_e&&(ei=oe(hn<Ot-1?at.tilePath[Ot-1-hn]:jt.tilePath[hn-Ot+2])[2]),ao(gn,vn,ei,P))),Bt.some(gn=>gn[3]<=0)&&(Bt=[]));let rn=[];if(Bt.length>0){let gn=1/0,vn=-1/0,ei=1/0,hn=-1/0;for(const jn of Bt)gn=Math.min(gn,jn[0]),ei=Math.min(ei,jn[1]),vn=Math.max(vn,jn[0]),hn=Math.max(hn,jn[1]);vn>=mt.x&&gn<=It.x&&hn>=mt.y&&ei<=It.y&&(rn=[Bt.map(jn=>new o.P(jn[0],jn[1]))],(gn<mt.x||vn>It.x||ei<mt.y||hn>It.y)&&(rn=o.bV(rn,mt.x,mt.y,It.x,It.y)))}for(const gn of rn){ht.reset(gn,.25*it);let vn=0;vn=ht.length<=.5*it?1:Math.ceil(ht.paddedLength/zt)+1;for(let ei=0;ei<vn;ei++){const hn=ei/Math.max(vn-1,1),jn=ht.lerp(hn),Yn=jn.x+co,Ei=jn.y+co;J.push(Yn,Ei,it,0);const _n=Yn-it,$n=Ei-it,Un=Yn+it,Zn=Ei+it;if(Ve=Ve&&this.isOffscreen(_n,$n,Un,Zn),Ze=Ze||this.isInsideGrid(_n,$n,Un,Zn),!a&&this.grid.hitTestCircle(Yn,Ei,it,D)&&(Ce=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ce,occluded:!1}}}}return{circles:!R&&Ce||!Ze?[]:J,offscreen:Ve,collisionDetected:Ce,occluded:me.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let h=1/0,g=1/0,y=-1/0,x=-1/0;for(const R of n){const F=new o.P(R.x+co,R.y+co);h=Math.min(h,F.x),g=Math.min(g,F.y),y=Math.max(y,F.x),x=Math.max(x,F.y),a.push(F)}const T=this.grid.query(h,g,y,x).concat(this.ignoredGrid.query(h,g,y,x)),I={},P={};for(const R of T){const F=R.key;if(I[F.bucketInstanceId]===void 0&&(I[F.bucketInstanceId]={}),I[F.bucketInstanceId][F.featureIndex])continue;const D=[new o.P(R.x1,R.y1),new o.P(R.x2,R.y1),new o.P(R.x2,R.y2),new o.P(R.x1,R.y2)];o.bW(a,D)&&(I[F.bucketInstanceId][F.featureIndex]=!0,P[F.bucketInstanceId]===void 0&&(P[F.bucketInstanceId]=[]),P[F.bucketInstanceId].push(F.featureIndex))}return P}insertCollisionBox(n,a,h,g,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:y},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,h,g,y){const x=a?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:g,collisionGroupID:y};for(let I=0;I<n.length;I+=4)x.insertCircle(T,n[I],n[I+1],n[I+2])}projectAndGetPerspectiveRatio(n,a,h,g,y,x,T){const I=[a,h,g,1];let P=!1;g||this.transform.pitch>0?(o.aC(I,I,n),this.fogState&&y&&T.name!=="globe"&&(P=function(D,j,U,G,J,Z){const ee=Z.calculateFogTileMatrix(J),oe=[j,U,G];return o.af(oe,oe,ee),tn(D,o.ag(oe),Z.pitch,Z._fov)}(this.fogState,a,h,g,y.toUnwrapped(),this.transform)>.9)):Gm(I,I,n);const R=I[3];return{point:new o.P((I[0]/R+1)/2*this.transform.width+co,(-I[1]/R+1)/2*this.transform.height+co),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/R*.5,1.5),signedDistanceFromCamera:R,occluded:x&&I[2]>R||P}}isOffscreen(n,a,h,g){return h<co||n>=this.screenRightBoundary||g<co||a>this.screenBottomBoundary}isInsideGrid(n,a,h,g){return h>=0&&n<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=o.bA([]);return o.br(n,n,[-100,-100,0]),n}}class tf{constructor(n,a,h,g){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):g&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class ua{constructor(n,a,h,g,y,x=!1){this.text=new tf(n?n.text:null,a,h,y),this.icon=new tf(n?n.icon:null,a,g,y),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ut{constructor(n,a,h,g=!1){this.text=n,this.icon=a,this.skipFade=h,this.clipped=g}}class Qn{constructor(){this.invProjMatrix=o.bC(),this.viewportMatrix=o.bC(),this.circles=[]}}class ri{constructor(n,a,h,g,y){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=y}}class Bs{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:h=>h.collisionGroupID===a}}return this.collisionGroups[n]}}function ec(d,n,a,h,g){const{horizontalAlign:y,verticalAlign:x}=o.c0(d),T=-(y-.5)*n,I=-(x-.5)*a,P=o.c1(d,h);return new o.P(T+P[0]*g,I+P[1]*g)}function qn(d,n,a,h,g){const y=new o.P(d,n);return a&&y._rotate(h?g:-g),y}class nf{constructor(n,a,h,g,y,x){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new jo(this.transform,y),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Bs(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,h,g,y=1){const x=h.getBucket(a),T=h.latestFeatureIndex;if(!x||!T||a.fqid!==x.layerIds[0])return;const I=x.layers[0].layout,P=x.layers[0].paint,R=h.collisionBoxArray,F=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),D=h.tileSize/o.al,j=h.tileID.toUnwrapped();this.transform.setProjection(x.projection);const U=(G=h.tileID,J=x.getProjection(),Z=this.transform,J.name===this.projection?Z.calculateProjMatrix(G.toUnwrapped()):Kd(Z,J,G));var G,J,Z;const ee=I.get("text-pitch-alignment")==="map",oe=I.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const ue=a.dynamicFilter(),ye=a.dynamicFilterNeedsFeature(),ge=this.transform.calculatePixelsToTileUnitsMatrix(h),ve=Sh(U,h.tileID.canonical,ee,oe,this.transform,x.getProjection(),ge);let _e=null;const me=x.getProjection().createInversionMatrix(this.transform,h.tileID.canonical);if(ee){const Ce=Jd(U,h.tileID.canonical,ee,oe,this.transform,x.getProjection(),ge);_e=o.aB([],this.transform.labelPlaneMatrix,Ce)}let xe=null;ue&&h.latestFeatureIndex&&(xe={unwrappedTileID:j,dynamicFilter:ue,dynamicFilterNeedsFeature:ye}),this.retainedQueryData[x.bucketInstanceId]=new ri(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,h.tileID);const[Ne,Re]=x.layers[0].layout.get("text-size-scale-range"),qe=o.aA(y,Ne,Re),[Oe,We]=I.get("icon-size-scale-range"),gt=o.aA(y,Oe,We),Fe={bucket:x,layout:I,paint:P,posMatrix:U,invMatrix:me,mercatorCenter:[o.aF(this.transform.center.lng),o.aJ(this.transform.center.lat)],textLabelPlaneMatrix:ve,labelToScreenMatrix:_e,clippingData:xe,scale:F,textPixelRatio:D,holdingForFade:h.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:o.bK(x.textSizeData,this.transform.zoom,qe),partiallyEvaluatedIconSize:o.bK(x.iconSizeData,this.transform.zoom,gt),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:h.latestFeatureIndex};if(g)for(const Ce of x.sortKeyRanges){const{sortKey:Ze,symbolInstanceStart:Ve,symbolInstanceEnd:it}=Ce;n.push({sortKey:Ze,symbolInstanceStart:Ve,symbolInstanceEnd:it,parameters:Fe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(n,a,h,g,y,x,T,I,P,R,F,D,j,U,G,J,Z,ee,oe,ue,ye){const{textOffset0:ge,textOffset1:ve,crossTileID:_e}=G,me=[ge,ve],xe=ec(n,x,T,me,I),Ne=this.collisionIndex.placeCollisionBox(Z,I,a,h,g,y,qn(xe.x,xe.y,P,R,this.transform.angle),U,F,D,j.predicate);if(oe){const Re=Z.getSymbolInstanceIconSize(ye,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Z,Re,oe,h,g,y,qn(xe.x,xe.y,P,R,this.transform.angle),U,F,D,j.predicate).box.length===0)return}if(Ne.box.length>0){let Re;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e]&&this.prevPlacement.placements[_e]&&this.prevPlacement.placements[_e].text&&(Re=this.prevPlacement.variableOffsets[_e].anchor),this.variableOffsets[_e]={textOffset:me,width:x,height:T,anchor:n,textScale:I,prevAnchor:Re},this.markUsedJustification(Z,n,G,ee),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,ee,G),this.placedOrientations[_e]=ee),{shift:xe,placedGlyphBoxes:Ne}}}placeLayerBucketPart(n,a,h,g,y=1){const{bucket:x,layout:T,paint:I,posMatrix:P,textLabelPlaneMatrix:R,labelToScreenMatrix:F,clippingData:D,textPixelRatio:j,mercatorCenter:U,invMatrix:G,holdingForFade:J,collisionBoxArray:Z,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:oe,collisionGroup:ue,latestFeatureIndex:ye}=n.parameters,ge=T.get("text-optional"),ve=T.get("icon-optional"),_e=T.get("text-allow-overlap"),me=T.get("icon-allow-overlap"),xe=T.get("text-rotation-alignment")==="map",Ne=T.get("icon-rotation-alignment")==="map",Re=T.get("text-pitch-alignment")==="map",qe=I.get("symbol-z-offset"),Oe=T.get("symbol-elevation-reference")==="sea",We=T.get("symbol-placement"),[gt,Fe]=T.get("text-size-scale-range"),[Ce,Ze]=T.get("icon-size-scale-range"),Ve=o.aA(y,gt,Fe),it=o.aA(y,Ce,Ze),mt=T.get("text-variable-anchor"),It=xe&&We!=="point",ht=Ne&&We!=="point",at=mt&&x.hasTextData(),jt=x.hasIconTextFit()&&at&&x.hasIconData();this.transform.setProjection(x.projection);const Ot=at||It,Bt=ht||jt;let zt=_e&&(me||!x.hasIconData()||ve),rn=me&&(_e||!x.hasTextData()||ge);const gn=!qe.isConstant();!x.collisionArrays&&Z&&x.deserializeCollisionBoxes(Z),h&&g&&x.updateCollisionDebugBuffers(this.transform.zoom,Z,Ve,it);const vn=(hn,jn,Yn)=>{const{crossTileID:Ei,numVerticalGlyphVertices:_n}=hn;let $n=null;if(D&&D.dynamicFilterNeedsFeature||gn){const qi=this.retainedQueryData[x.bucketInstanceId];$n=ye.loadFeature({featureIndex:hn.featureIndex,bucketIndex:qi.bucketIndex,sourceLayerIndex:qi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(D&&!(0,D.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},$n,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new o.P(hn.tileAnchorX,hn.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[Ei]=new Ut(!1,!1,!1,!0),void a.add(Ei);const Un=qe.evaluate($n,{});if(a.has(Ei))return;if(J)return void(this.placements[Ei]=new Ut(!1,!1,!1));let Zn=!1,Ai=!1,Xi=!0,Ar=!1,Ci=!1,xn=null,Qt={box:null,offscreen:null,occluded:null},ti={box:null},Ui=null,ki=null,tr=null,Br=0,po=0,mo=0;Yn.textFeatureIndex?Br=Yn.textFeatureIndex:hn.useRuntimeCollisionCircles&&(Br=hn.featureIndex),Yn.verticalTextFeatureIndex&&(po=Yn.verticalTextFeatureIndex);const Vs=qi=>{qi.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const Ki=this.transform.elevation;qi.elevation=Oe?Un:Un+(Ki?Ki.getAtTileOffset(qi.tileID,qi.tileAnchorX,qi.tileAnchorY):0),qi.elevation+=hn.zOffset},Us=Yn.textBox;if(Us){Vs(Us);const qi=Di=>{let fr=o.bL.horizontal;if(x.allowVerticalPlacement&&!Di&&this.prevPlacement){const Cr=this.prevPlacement.placedOrientations[Ei];Cr&&(this.placedOrientations[Ei]=Cr,fr=Cr,this.markUsedOrientation(x,fr,hn))}return fr},Ki=(Di,fr)=>{if(x.allowVerticalPlacement&&_n>0&&Yn.verticalTextBox){for(const Cr of x.writingModes)if(Cr===o.bL.vertical?(Qt=fr(),ti=Qt):Qt=Di(),Qt&&Qt.box&&Qt.box.length)break}else Qt=Di()};if(mt){let Di=mt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ei]){const Ji=this.prevPlacement.variableOffsets[Ei];Di.indexOf(Ji.anchor)>0&&(Di=Di.filter(ts=>ts!==Ji.anchor),Di.unshift(Ji.anchor))}const fr=(Ji,ts,ga)=>{const Fa=x.getSymbolInstanceTextSize(ee,hn,this.transform.zoom,jn),qo=(Ji.x2-Ji.x1)*Fa+2*Ji.padding,Il=(Ji.y2-Ji.y1)*Fa+2*Ji.padding,Al=hn.hasIconTextFit&&!me?ts:null;Al&&Vs(Al);let _a={box:[],offscreen:!1,occluded:!1};const wu=_e?2*Di.length:Di.length;for(let Na=0;Na<wu;++Na){const ya=this.attemptAnchorPlacement(Di[Na%Di.length],Ji,U,G,Ot,qo,Il,Fa,xe,Re,j,P,ue,Na>=Di.length,hn,jn,x,ga,Al,ee,oe);if(ya&&(_a=ya.placedGlyphBoxes,_a&&_a.box&&_a.box.length)){Zn=!0,xn=ya.shift;break}}return _a};Ki(()=>fr(Us,Yn.iconBox,o.bL.horizontal),()=>{const Ji=Yn.verticalTextBox;return Ji&&Vs(Ji),x.allowVerticalPlacement&&!(Qt&&Qt.box&&Qt.box.length)&&_n>0&&Ji?fr(Ji,Yn.verticalIconBox,o.bL.vertical):{box:null,offscreen:null,occluded:null}}),Qt&&(Zn=Qt.box,Xi=Qt.offscreen,Ar=Qt.occluded);const Cr=qi(!(!Qt||!Qt.box));if(!Zn&&this.prevPlacement){const Ji=this.prevPlacement.variableOffsets[Ei];Ji&&(this.variableOffsets[Ei]=Ji,this.markUsedJustification(x,Ji.anchor,hn,Cr))}}else{const Di=(fr,Cr)=>{const Ji=x.getSymbolInstanceTextSize(ee,hn,this.transform.zoom,jn),ts=this.collisionIndex.placeCollisionBox(x,Ji,fr,U,G,Ot,new o.P(0,0),_e,j,P,ue.predicate);return ts&&ts.box&&ts.box.length&&(this.markUsedOrientation(x,Cr,hn),this.placedOrientations[Ei]=Cr),ts};Ki(()=>Di(Us,o.bL.horizontal),()=>{const fr=Yn.verticalTextBox;return x.allowVerticalPlacement&&_n>0&&fr?(Vs(fr),Di(fr,o.bL.vertical)):{box:null,offscreen:null,occluded:null}}),qi(!!(Qt&&Qt.box&&Qt.box.length))}}if(Ui=Qt,Zn=Ui&&Ui.box&&Ui.box.length>0,Xi=Ui&&Ui.offscreen,Ar=Ui&&Ui.occluded,hn.useRuntimeCollisionCircles){const qi=x.text.placedSymbolArray.get(hn.centerJustifiedTextSymbolIndex>=0?hn.centerJustifiedTextSymbolIndex:hn.verticalPlacedTextSymbolIndex),Ki=o.bM(x.textSizeData,ee,qi),Di=T.get("text-padding");ki=this.collisionIndex.placeCollisionCircles(x,_e,qi,x.lineVertexArray,x.glyphOffsetArray,Ki,P,R,F,h,Re,ue.predicate,hn.collisionCircleDiameter*Ki/o.bX,Di,this.retainedQueryData[x.bucketInstanceId].tileID),Zn=_e||ki.circles.length>0&&!ki.collisionDetected,Xi=Xi&&ki.offscreen,Ar=ki.occluded}if(Yn.iconFeatureIndex&&(mo=Yn.iconFeatureIndex),Yn.iconBox){const qi=Ki=>{Vs(Ki);const Di=hn.hasIconTextFit&&xn?qn(xn.x,xn.y,xe,Re,this.transform.angle):new o.P(0,0),fr=x.getSymbolInstanceIconSize(oe,this.transform.zoom,hn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,fr,Ki,U,G,Bt,Di,me,j,P,ue.predicate)};ti&&ti.box&&ti.box.length&&Yn.verticalIconBox?(tr=qi(Yn.verticalIconBox),Ai=tr.box.length>0):(tr=qi(Yn.iconBox),Ai=tr.box.length>0),Xi=Xi&&tr.offscreen,Ci=tr.occluded}const ws=ge||hn.numHorizontalGlyphVertices===0&&_n===0,Po=ve||hn.numIconVertices===0;if(ws||Po?Po?ws||(Ai=Ai&&Zn):Zn=Ai&&Zn:Ai=Zn=Ai&&Zn,Zn&&Ui&&Ui.box&&this.collisionIndex.insertCollisionBox(Ui.box,T.get("text-ignore-placement"),x.bucketInstanceId,ti&&ti.box&&po?po:Br,ue.ID),Ai&&tr&&this.collisionIndex.insertCollisionBox(tr.box,T.get("icon-ignore-placement"),x.bucketInstanceId,mo,ue.ID),ki&&(Zn&&this.collisionIndex.insertCollisionCircles(ki.circles,T.get("text-ignore-placement"),x.bucketInstanceId,Br,ue.ID),h)){const qi=x.bucketInstanceId;let Ki=this.collisionCircleArrays[qi];Ki===void 0&&(Ki=this.collisionCircleArrays[qi]=new Qn);for(let Di=0;Di<ki.circles.length;Di+=4)Ki.circles.push(ki.circles[Di+0]),Ki.circles.push(ki.circles[Di+1]),Ki.circles.push(ki.circles[Di+2]),Ki.circles.push(ki.collisionDetected?1:0)}const Wo=x.projection.name!=="globe";zt=zt&&(Wo||!Ar),rn=rn&&(Wo||!Ci),this.placements[Ei]=new Ut(Zn||zt,Ai||rn,Xi||x.justReloaded),a.add(Ei)},ei=this.retainedQueryData[x.bucketInstanceId].tileID;if(x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,ei),x.elevationType==="road"&&x.updateRoadElevation(ei.canonical),x.updateZOffset(),x.sortFeaturesByY){const hn=x.getSortedSymbolIndexes(this.transform.angle);for(let jn=hn.length-1;jn>=0;--jn){const Yn=hn[jn];vn(x.symbolInstances.get(Yn),Yn,x.collisionArrays[Yn])}x.hasAnyZOffset&&o.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){const hn=x.getSortedIndexesByZOffset();for(let jn=0;jn<hn.length;++jn){const Yn=hn[jn];vn(x.symbolInstances.get(Yn),Yn,x.collisionArrays[Yn])}}else for(let hn=n.symbolInstanceStart;hn<n.symbolInstanceEnd;hn++)vn(x.symbolInstances.get(hn),hn,x.collisionArrays[hn]);if(h&&x.bucketInstanceId in this.collisionCircleArrays){const hn=this.collisionCircleArrays[x.bucketInstanceId];o.bl(hn.invProjMatrix,P),hn.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(n,a,h,g){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:I,crossTileID:P}=h,R=o.c2(a),F=g===o.bL.vertical?I:R==="left"?y:R==="center"?x:R==="right"?T:-1;y>=0&&(n.text.placedSymbolArray.get(y).crossTileID=F>=0&&y!==F?0:P),x>=0&&(n.text.placedSymbolArray.get(x).crossTileID=F>=0&&x!==F?0:P),T>=0&&(n.text.placedSymbolArray.get(T).crossTileID=F>=0&&T!==F?0:P),I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=F>=0&&I!==F?0:P)}markUsedOrientation(n,a,h){const g=a===o.bL.horizontal||a===o.bL.horizontalOnly?a:0,y=a===o.bL.vertical?a:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:P}=h,R=n.text.placedSymbolArray;x>=0&&(R.get(x).placedOrientation=g),T>=0&&(R.get(T).placedOrientation=g),I>=0&&(R.get(I).placedOrientation=g),P>=0&&(R.get(P).placedOrientation=y)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let h=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const g=a?a.symbolFadeChange(n):1,y=a?a.opacities:{},x=a?a.variableOffsets:{},T=a?a.placedOrientations:{};for(const I in this.placements){const P=this.placements[I],R=y[I];R?(this.opacities[I]=new ua(R,g,P.text,P.icon,null,P.clipped),h=h||P.text!==R.text.placed||P.icon!==R.icon.placed):(this.opacities[I]=new ua(null,g,P.text,P.icon,P.skipFade,P.clipped),h=h||P.text||P.icon)}for(const I in y){const P=y[I];if(!this.opacities[I]){const R=new ua(P,g,!1,!1);R.isHidden()||(this.opacities[I]=R,h=h||P.text.placed||P.icon.placed)}}for(const I in x)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=x[I]);for(const I in T)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=T[I]);h?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a,h,g){const y=new Set;for(const x of a){const T=x.getBucket(n);T&&x.latestFeatureIndex&&n.fqid===T.layerIds[0]&&(this.updateBucketOpacities(T,y,x,x.collisionBoxArray,h,g,x.tileID,n.scope),T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,x.tileID),T.elevationType==="road"&&T.updateRoadElevation(x.tileID.canonical),T.updateZOffset())}}updateBucketOpacities(n,a,h,g,y,x,T,I){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const P=n.layers[0].layout,R=n.layers[0].paint,F=!!n.layers[0].dynamicFilter(),D=new ua(null,0,!1,!1,!0),j=P.get("text-allow-overlap"),U=P.get("icon-allow-overlap"),G=P.get("text-variable-anchor"),J=P.get("text-rotation-alignment")==="map",Z=P.get("text-pitch-alignment")==="map",ee=R.get("symbol-z-offset"),oe=P.get("symbol-elevation-reference")==="sea",ue=!ee.isConstant(),ye=new ua(null,0,j&&(U||!n.hasIconData()||P.get("icon-optional")),U&&(j||!n.hasTextData()||P.get("text-optional")),!0);!n.collisionArrays&&g&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(g);const ge=(_e,me,xe)=>{for(let Ne=0;Ne<me/4;Ne++)_e.opacityVertexArray.emplaceBack(xe)};let ve=0;x&&n.updateReplacement(T,x);for(let _e=0;_e<n.symbolInstances.length;_e++){const me=n.symbolInstances.get(_e),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:Ne,crossTileID:Re,numIconVertices:qe,tileAnchorX:Oe,tileAnchorY:We}=me;let gt=null;const Fe=this.retainedQueryData[n.bucketInstanceId];ue&&me&&Fe&&(gt=h.latestFeatureIndex.loadFeature({featureIndex:me.featureIndex,bucketIndex:Fe.bucketIndex,sourceLayerIndex:Fe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ce=ee.evaluate(gt,{}),Ze=a.has(Re);let Ve=this.opacities[Re];Ze?Ve=D:Ve||(Ve=ye,this.opacities[Re]=Ve),a.add(Re);const it=xe>0||Ne>0,mt=qe>0,It=this.placedOrientations[Re],ht=It===o.bL.vertical,at=It===o.bL.horizontal||It===o.bL.horizontalOnly;!it&&!mt||Ve.isHidden()||ve++;let jt=!1;if((it||mt)&&x)for(const Ot of n.activeReplacements){if(o.bY(Ot,y,o.bZ.Symbol,I)||Ot.min.x>Oe||Oe>Ot.max.x||Ot.min.y>We||We>Ot.max.y)continue;const Bt=o.b_(Oe,We,T.canonical,Ot.footprintTileId.canonical);if(jt=o.b$(Bt,Ot.footprint),jt)break}if(it){const Ot=jt?ul:Ch(Ve.text);ge(n.text,xe,ht?ul:Ot),ge(n.text,Ne,at?ul:Ot);const Bt=Ve.text.isHidden(),{leftJustifiedTextSymbolIndex:zt,centerJustifiedTextSymbolIndex:rn,rightJustifiedTextSymbolIndex:gn,verticalPlacedTextSymbolIndex:vn}=me,ei=n.text.placedSymbolArray,hn=Bt||ht?1:0;zt>=0&&(ei.get(zt).hidden=hn),rn>=0&&(ei.get(rn).hidden=hn),gn>=0&&(ei.get(gn).hidden=hn),vn>=0&&(ei.get(vn).hidden=Bt||at?1:0);const jn=this.variableOffsets[Re];jn&&this.markUsedJustification(n,jn.anchor,me,It);const Yn=this.placedOrientations[Re];Yn&&(this.markUsedJustification(n,"left",me,Yn),this.markUsedOrientation(n,Yn,me))}if(mt){const Ot=jt?ul:Ch(Ve.icon),{placedIconSymbolIndex:Bt,verticalPlacedIconSymbolIndex:zt}=me,rn=n.icon.placedSymbolArray,gn=Ve.icon.isHidden()?1:0;Bt>=0&&(ge(n.icon,qe,ht?ul:Ot),rn.get(Bt).hidden=gn),zt>=0&&(ge(n.icon,me.numVerticalIconVertices,at?ul:Ot),rn.get(zt).hidden=gn)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Ot=n.collisionArrays[_e];if(Ot){let Bt=new o.P(0,0),zt=!0;if(Ot.textBox||Ot.verticalTextBox){if(G){const gn=this.variableOffsets[Re];gn?(Bt=ec(gn.anchor,gn.width,gn.height,gn.textOffset,gn.textScale),J&&Bt._rotate(Z?this.transform.angle:-this.transform.angle)):zt=!1}F&&(zt=!Ve.clipped),Ot.textBox&&cl(n.textCollisionBox.collisionVertexArray,Ve.text.placed,!zt||ht,Ce,oe,Bt.x,Bt.y),Ot.verticalTextBox&&cl(n.textCollisionBox.collisionVertexArray,Ve.text.placed,!zt||at,Ce,oe,Bt.x,Bt.y)}const rn=zt&&!!(!at&&Ot.verticalIconBox);Ot.iconBox&&cl(n.iconCollisionBox.collisionVertexArray,Ve.icon.placed,rn,Ce,oe,me.hasIconTextFit?Bt.x:0,me.hasIconTextFit?Bt.y:0),Ot.verticalIconBox&&cl(n.iconCollisionBox.collisionVertexArray,Ve.icon.placed,!rn,Ce,oe,me.hasIconTextFit?Bt.x:0,me.hasIconTextFit?Bt.y:0)}}}if(n.fullyClipped=ve===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=_e.invProjMatrix,n.placementViewportMatrix=_e.viewportMatrix,n.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const h=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*h>n}setStale(){this.stale=!0}}function cl(d,n,a,h,g,y,x){d.emplaceBack(n?1:0,a?1:0,y||0,x||0,h,g?1:0),d.emplaceBack(n?1:0,a?1:0,y||0,x||0,h,g?1:0),d.emplaceBack(n?1:0,a?1:0,y||0,x||0,h,g?1:0),d.emplaceBack(n?1:0,a?1:0,y||0,x||0,h,g?1:0)}const Eh=Math.pow(2,25),ls=Math.pow(2,24),hr=Math.pow(2,17),gw=Math.pow(2,16),Ih=Math.pow(2,9),$m=Math.pow(2,8),Ah=Math.pow(2,1);function Ch(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const n=d.placed?1:0,a=Math.floor(127*d.opacity);return a*Eh+n*ls+a*hr+n*gw+a*Ih+n*$m+a*Ah+n}const ul=0;class rf{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,a,h,g,y,x){const T=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(T,g,n[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((I,P)=>I.sortKey-P.sortKey));this._currentPartIndex<T.length;){const I=T[this._currentPartIndex];if(a.placeLayerBucketPart(I,this._seenCrossTileIDs,h,I.symbolInstanceStart===0,x),this._currentPartIndex++,y())return!0}return!1}}class ys{constructor(n,a,h,g,y,x,T,I,P){this.placement=new nf(n,y,x,T,I,P),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(n,a,h,g,y){const x=o.o.now(),T=()=>{const I=o.o.now()-x;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=a[n[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=P)&&(!I.maxzoom||I.maxzoom>P)){const R=I,F=R.layout.get("symbol-z-elevate"),D=R.layout.get("symbol-sort-key").constantOr(1)!==void 0,j=R.layout.get("symbol-z-order"),U=j==="viewport-y"||j==="auto"&&!(j!=="viewport-y"&&D),G=R.layout.get("text-allow-overlap")||R.layout.get("icon-allow-overlap")||R.layout.get("text-ignore-placement")||R.layout.get("icon-ignore-placement"),J=U&&G,Z=this._inProgressLayer=this._inProgressLayer||new rf(R),ee=o.B(I.source,I.scope);if(Z.continuePlacement(F||J?g[ee]:h[ee],this.placement,this._showCollisionBoxes,I,T,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Vo=512/o.al/2;class Ps{constructor(n,a,h){this.tileID=n,this.bucketInstanceId=h,this.index=new o.c3(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=n.canonical.x*o.al,y=n.canonical.y*o.al;for(let x=0;x<a.length;x++){const{key:T,crossTileID:I,tileAnchorX:P,tileAnchorY:R}=a.get(x),F=Math.floor((g+P)*Vo),D=Math.floor((y+R)*Vo);this.index.add(F,D),this.keys.push(T),this.crossTileIDs.push(I)}this.index.finish()}findMatches(n,a,h){const g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),y=Vo/Math.pow(2,a.canonical.z-this.tileID.canonical.z),x=a.canonical.x*o.al,T=a.canonical.y*o.al;for(let I=0;I<n.length;I++){const P=n.get(I);if(P.crossTileID)continue;const{key:R,tileAnchorX:F,tileAnchorY:D}=P,j=Math.floor((x+F)*y),U=Math.floor((T+D)*y),G=this.index.range(j-g,U-g,j+g,U+g).sort((J,Z)=>J-Z);for(const J of G){const Z=this.crossTileIDs[J];if(this.keys[J]===R&&!h.has(Z)){h.add(Z),P.crossTileID=Z;break}}}}}class mv{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(a!==0)for(const h in this.indexes){const g=this.indexes[h],y={};for(const x in g){const T=g[x];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+a),y[T.tileID.key]=T}this.indexes[h]=y}this.lng=n}addBucket(n,a,h){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let y=0;y<a.symbolInstances.length;y++)a.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const g=this.usedCrossTileIDs[n.overscaledZ];for(const y in this.indexes){const x=this.indexes[y];if(Number(y)>n.overscaledZ)for(const T in x){const I=x[T];I.tileID.isChildOf(n)&&I.findMatches(a.symbolInstances,n,g)}else{const T=x[n.scaledTo(Number(y)).key];T&&T.findMatches(a.symbolInstances,n,g)}}for(let y=0;y<a.symbolInstances.length;y++){const x=a.symbolInstances.get(y);x.crossTileID||(x.crossTileID=h.generate(),g.add(x.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Ps(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const h of a.crossTileIDs)this.usedCrossTileIDs[n].delete(h)}removeStaleBuckets(n){let a=!1;for(const h in this.indexes){const g=this.indexes[h];for(const y in g)n[g[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[y]),delete g[y],a=!0)}return a}}class Ir{constructor(){this.layerIndexes={},this.crossTileIDs=new mv,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,h,g){let y=this.layerIndexes[n.fqid];y===void 0&&(y=this.layerIndexes[n.fqid]=new Xc);let x=!1;const T={};g.name!=="globe"&&y.handleWrapJump(h);for(const I of a){const P=I.getBucket(n);P&&n.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(I.tileID,P,this.crossTileIDs)&&(x=!0),T[P.bucketInstanceId]=!0)}return y.removeStaleBuckets(T)&&(x=!0),x}pruneUnusedLayers(n){const a={};n.forEach(h=>{a[h]=!0});for(const h in this.layerIndexes)a[h]||delete this.layerIndexes[h]}}const Ms=771;class yn{constructor(n,a,h,g){this.blendFunction=n,this.blendColor=a.toNonPremultipliedRenderColor(null),this.mask=h,this.blendEquation=g}}yn.Replace=[1,0,1,0],yn.disabled=new yn(yn.Replace,o.ao.transparent,[!1,!1,!1,!1]),yn.unblended=new yn(yn.Replace,o.ao.transparent,[!0,!0,!0,!0]),yn.alphaBlended=new yn([1,Ms,1,Ms],o.ao.transparent,[!0,!0,!0,!0]),yn.alphaBlendedNonPremultiplied=new yn([770,Ms,770,Ms],o.ao.transparent,[!0,!0,!0,!0]),yn.multiply=new yn([774,0,774,0],o.ao.transparent,[!0,!0,!0,!0]);class Ct{constructor(n,a,h){this.func=n,this.mask=a,this.range=h}}Ct.ReadOnly=!1,Ct.ReadWrite=!0,Ct.disabled=new Ct(519,Ct.ReadOnly,[0,1]);const Ph=7680;class Jt{constructor(n,a,h,g,y,x){this.test=n,this.ref=a,this.mask=h,this.fail=g,this.depthFail=y,this.pass=x}}Jt.disabled=new Jt({func:519,mask:0},0,0,Ph,Ph,Ph);const tc=1029,Kc=2305;class nn{constructor(n,a,h){this.enable=n,this.mode=a,this.frontFace=h}}function Hm(d,n){const a=o.c9(d,3);o.cb(d,n),o.cf(d,3,a)}function Mh(d,n){const a=o.c6([]);return o.c7(a,a,-n),o.c8(a,a,-d),a}function Rh(d,n){const a=[d[0],d[1],0],h=[n[0],n[1],0];if(o.ag(a)>=1e-15){const x=o.aw([],a);o.c4(h,x,o.bJ(h,x)),n[0]=h[0],n[1]=h[1]}const g=o.bI([],n,d);if(o.c5(g)<1e-15)return null;const y=Math.atan2(-g[1],g[0]);return Mh(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),y)}nn.disabled=new nn(!1,tc,Kc),nn.backCCW=new nn(!0,tc,Kc),nn.backCW=new nn(!0,tc,2304),nn.frontCW=new nn(!0,1028,2304),nn.frontCCW=new nn(!0,1028,Kc);class Wm{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof o.ae?n:new o.ae(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=o.bT(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;const h=this.position,g=this._elevation?this._elevation.getAtPointOrZero(o.ae.fromLngLat(n)):0,y=o.ae.fromLngLat(n,g),x=[y.x-h.x,y.y-h.y,y.z-h.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Rh(x,a)}setPitchBearing(n,a){this.orientation=Mh(o.an(n),o.an(-a))}}class sf{constructor(n,a){this._transform=o.bA([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new o.ae(n[0],n[1],n[2])}get position(){const n=o.c9(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&o.cf(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||o.c6([]),n&&Hm(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=Mh(n,a),Hm(this._transform,this._orientation)}forward(){const n=o.c9(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=o.c9(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=o.c9(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const h=new Float64Array(16);return o.bl(h,this.getWorldToCamera(n,a)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,a,h){const g=this.position;o.c4(g,g,-n);const y=new Float64Array(16);return o.bq(y,[h,h,h]),o.br(y,y,g),y[10]*=a,y}getWorldToCamera(n,a){const h=new Float64Array(16),g=new Float64Array(4),y=this.position;return o.ca(g,this._orientation),o.c4(y,y,-n),o.cb(h,g),o.br(h,h,y),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=a,h[9]*=a,h[10]*=a,h[11]*=a,h}getCameraToClipPerspective(n,a,h,g){const y=new Float64Array(16);return o.cc(y,n,a,h,g),y}getCameraToClipOrthographic(n,a,h,g,y,x){const T=new Float64Array(16);return o.cd(T,n,a,h,g,y,x),T}getDistanceToElevation(n,a=!1){const h=n===0?0:o.ce(n,a?o.a$(this.position[1]):this.position[1]),g=this.forward();return(h-this.position[2])/g[2]}clone(){return new sf([...this.position],[...this.orientation])}}const er={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class qm{constructor(n=0,a=0,h=0,g=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=h,this.right=g}interpolate(n,a,h){return a.top!=null&&n.top!=null&&(this.top=o.ak(n.top,a.top,h)),a.bottom!=null&&n.bottom!=null&&(this.bottom=o.ak(n.bottom,a.bottom,h)),a.left!=null&&n.left!=null&&(this.left=o.ak(n.left,a.left,h)),a.right!=null&&n.right!=null&&(this.right=o.ak(n.right,a.right,h)),this}getCenter(n,a){const h=o.aA((this.left+n-this.right)/2,0,n),g=o.aA((this.top+a-this.bottom)/2,0,a);return new o.P(h,g)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new qm(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ka=15;class vs{constructor(n,a,h,g,y,x,T){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=h??0,this._maxPitch=g??60,this.setProjection(x),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new o.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qm,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new sf,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new vs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ka}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,a=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(n||h)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return o.aH(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=o.cl(this.projectionOptions);const h=this.getProjection(),g=!o.by(a,h);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cl({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bT(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=o.cm(),o.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=o.aA(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=o.an(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let g=0,y=0;for(let x=0;x<a.length;x++){const T=new o.P(a[x][0]*this.width,h+a[x][1]*(this.height-h)),I=n.pointCoordinate(T);if(!I)continue;const P=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);g+=I[3]*P,y+=P}return y===0?NaN:g/y}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*a,g=this._mercatorZfromZoom(n),y=this._mercatorZfromZoom(this._maxZoom),x=Math.max(g-h,y);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let h;h=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const g=o.ag(o.av([],this._camera.position,h));return o.aA(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!o.co(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const h=[n.position.x,n.position.y,n.position.z];o.cp(h,this._camera.position)||(this._setCameraPosition(h),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new Wm;return a.position=new o.ae(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!o.cq(n))return!1;o.cr(n,n);const a=o.cs([],[0,0,-1],n),h=o.cs([],[0,-1,0],n);if(h[2]<0)return!1;const g=Rh(a,h);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;n[2]=o.aA(n[2],g/h,g/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,h){this._unmodified=!1,this._edgeInsets.interpolate(n,a,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new o.ct(0,n)];if(this.renderWorldCopies){const h=this.pointCoordinate(new o.P(0,0)),g=this.pointCoordinate(new o.P(this.width,0)),y=this.pointCoordinate(new o.P(this.width,this.height)),x=this.pointCoordinate(new o.P(0,this.height)),T=Math.floor(Math.min(h.x,g.x,y.x,x.x)),I=Math.floor(Math.max(h.x,g.x,y.x,x.x)),P=1;for(let R=T-P;R<=I+P;R++)R!==0&&a.push(new o.ct(R,n))}return a}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,a,h){let g=[];const y=h!=null,x=!y;if(x&&this.zoom<a||y&&h[0]===0&&h[1]===0)return g;const T=new Set,I=(R,F,D,j,U)=>{const G=o.cX(F,R,D,j,U);T.has(G)||(g.push(new o.aO(R,F,D,j,U)),T.add(G))};for(let R=0;R<n.length;R++){const F=n[R];if(x&&F.canonical.z!==a)continue;const D=F.canonical,j=F.overscaledZ,U=F.wrap,G=1<<D.z,J=D.x+1<G,Z=D.x>0,ee=D.y+1<G,oe=D.y>0,ue=F.wrap-(Z?0:1),ye=F.wrap+(J?0:1),ge=Z?D.x-1:G-1,ve=J?D.x+1:0;if(y)h[0]<0?(I(j,ye,D.z,ve,D.y),h[1]<0&&ee&&(I(j,U,D.z,D.x,D.y+1),I(j,ye,D.z,ve,D.y+1)),h[1]>0&&oe&&(I(j,U,D.z,D.x,D.y-1),I(j,ye,D.z,ve,D.y-1))):h[0]>0?(I(j,ue,D.z,ge,D.y),h[1]<0&&ee&&(I(j,U,D.z,D.x,D.y+1),I(j,ue,D.z,ge,D.y+1)),h[1]>0&&oe&&(I(j,U,D.z,D.x,D.y-1),I(j,ue,D.z,ge,D.y-1))):h[1]<0&&ee?I(j,U,D.z,D.x,D.y+1):oe&&I(j,U,D.z,D.x,D.y-1);else{const _e=F.visibleQuadrants;1&_e&&(I(j,ue,D.z,ge,D.y),oe&&(I(j,U,D.z,D.x,D.y-1),I(j,ue,D.z,ge,D.y-1))),2&_e&&(I(j,ye,D.z,ve,D.y),oe&&(I(j,U,D.z,D.x,D.y-1),I(j,ye,D.z,ve,D.y-1))),4&_e&&(I(j,ue,D.z,ge,D.y),ee&&(I(j,U,D.z,D.x,D.y+1),I(j,ue,D.z,ge,D.y+1))),8&_e&&(I(j,ye,D.z,ve,D.y),ee&&(I(j,U,D.z,D.x,D.y+1),I(j,ye,D.z,ve,D.y+1)))}}const P=[];for(const R of g)g.some(F=>R.isChildOf(F))||P.push(R);if(g=P.filter(R=>!n.some(F=>!!(R.overscaledZ<a&&F.isChildOf(R))||R.equals(F)||R.isChildOf(F))),x){const R=1<<a,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),D=[R*F.x,R*F.y],j=4,U=j*j;g=g.filter(G=>{const J=G.canonical.x+.5-D[0],Z=G.canonical.y+.5-D[1];return J*J+Z*Z<U})}return g}extendTileCoverToNearPlane(n,a,h){const g=[],y=new Set;for(const ee of n)y.add(ee.key);const x=(ee,oe,ue,ye,ge)=>{const ve=o.cX(oe,ee,ue,ye,ge);y.has(ve)||(g.push(new o.aO(ee,oe,ue,ye,ge)),y.add(ve))},T=n.reduce((ee,oe)=>Math.max(ee,oe.overscaledZ),h),I=1<<h,P=[new o.P(0,0),new o.P(o.al,0),new o.P(o.al,o.al),new o.P(0,o.al)],R=new o.P(0,0),F=new o.P(0,0),D=(ee,oe)=>{const ue=Math.floor(ee[0]),ye=Math.floor(ee[1]),ge=(ee[0]-ue)*o.al,ve=(ee[1]-ye)*o.al,_e=Math.floor(oe[0]),me=Math.floor(oe[1]),xe=(oe[0]-_e)*o.al,Ne=(oe[1]-me)*o.al;for(let Re=-1;Re<=1;Re++){const qe=ue+Re;if(!(qe<0||qe>=I)){R.x=ge-Re*o.al,F.x=xe-(qe-_e)*o.al;for(let Oe=-1;Oe<=1;Oe++){const We=ye+Oe;R.y=ve-Oe*o.al,F.y=Ne-(We-me)*o.al,o.cY(R,F,P)&&x(T,0,h,qe,We)}}}},j=a.points,U=j[o.cu],G=j[o.cv],J=this._projectToGround(U,j[o.cw]),Z=this._projectToGround(G,j[o.cx]);return D(U,J),D(G,Z),g}_projectToGround(n,a){return o.cy(o.cz(),n,a,n[2]/(n[2]-a[2]))}coveringTiles(n){let a=this.coveringZoomLevel(n);const h=a,g=this.elevation&&this.elevation.exaggeration(),y=g&&!n.isTerrainDEM,x=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);const T=this.locationCoordinate(this.center),I=this.center.lat,P=1<<a,R=[P*T.x,P*T.y,0],F=this.projection.name==="globe",D=!F,j=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,D),U=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=P*o.ce(1,this.center.lat),J=this._camera.position[2]/o.ce(1,this.center.lat),Z=[P*U.x,P*U.y,J*(D?1:G)],ee=F||g,oe=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ue=this.isLODDisabled(!0)?a:0;let ye;if(this._elevation&&n.isTerrainDEM)ye=1e4*this._elevation.exaggeration();else if(this._elevation){const Ce=this._elevation.getMinMaxForVisibleTiles();ye=Ce?Ce.max:this._centerAltitude}else ye=this._centerAltitude;const ge=n.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?o.cB(this):1,_e=Ce=>{const Ve=new o.ae(Ce.x+25e-6,Ce.y,Ce.z),it=new o.ae(Ce.x,Ce.y+25e-6,Ce.z),mt=Ce.toLngLat(),It=Ve.toLngLat(),ht=it.toLngLat(),at=this.locationCoordinate(mt),jt=this.locationCoordinate(It),Ot=this.locationCoordinate(ht),Bt=Math.hypot(jt.x-at.x,jt.y-at.y),zt=Math.hypot(Ot.x-at.x,Ot.y-at.y);return Math.sqrt(Bt*zt)*ve/25e-6},me=Ce=>{const Ze=ye,Ve=ge;return{aabb:o.cE(this,P,0,0,0,Ce,Ve,Ze,this.projection),zoom:0,x:0,y:0,minZ:Ve,maxZ:Ze,wrap:Ce,fullyVisible:!1}},xe=[];let Ne=[];const Re=a,qe=n.reparseOverscaled?h:a,Oe=(J-this._centerAltitude)*G,We=Ce=>{if(!this._elevation||!Ce.tileID||!x)return;const Ze=this._elevation.getMinMaxForTile(Ce.tileID),Ve=Ce.aabb;Ze?(Ve.min[2]=Ze.min,Ve.max[2]=Ze.max,Ve.center[2]=(Ve.min[2]+Ve.max[2])/2):(Ce.shouldSplit=Fe(Ce),Ce.shouldSplit||(Ve.min[2]=Ve.max[2]=Ve.center[2]=this._centerAltitude))},gt=(Ce,Ze)=>{if(.707*Ze<Ce)return 1;const Ve=Ze/Ce;return Ve/(1.4144271570014144+(Math.pow(1.1,Ve-1.4144271570014144+1)-1)/(1.1-1)-1)},Fe=Ce=>{if(Ce.zoom<ue)return!0;if(Ce.zoom===Re)return!1;if(Ce.shouldSplit!=null)return Ce.shouldSplit;const Ze=Ce.aabb.distanceX(Z),Ve=Ce.aabb.distanceY(Z);let it=Oe,mt=1;if(F){it=Ce.aabb.distanceZ(Z);const zt=Math.pow(2,Ce.zoom),rn=o.a$((Ce.y+1)/zt),gn=o.a$(Ce.y/zt),vn=Math.min(Math.max(I,rn),gn),ei=o.d0(vn)/o.d0(I);if(mt=vn===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ei/this._mercatorScaleRatio),this.zoom<=o.cZ&&Ce.zoom===Re-1&&ei>=.9)return!0}else if(y&&(it=Ce.aabb.distanceZ(Z)*G),this.projection.isReprojectedInTileSpace&&h<=5){const zt=Math.pow(2,Ce.zoom),rn=_e(new o.ae((Ce.x+.5)/zt,(Ce.y+.5)/zt));mt=rn>.85?1:rn}if(!x){const zt=Math.sqrt(Ze*Ze+Ve*Ve+it*it);let rn=(1<<Re-Ce.zoom)*oe*mt;return rn*=gt(Math.max(it,Oe),zt),zt<rn}let It=Number.MAX_VALUE,ht=0;const at=Ce.aabb.getCorners(),jt=[];for(const zt of at){o.av(jt,zt,Z),F||(y?jt[2]*=G:jt[2]=Oe);const rn=o.bJ(jt,this._camera.forward());rn<It&&(It=rn,ht=Math.abs(jt[2]))}let Ot=(1<<Re-Ce.zoom)*oe*mt;if(Ot*=gt(Math.max(ht,Oe),It),It<Ot)return!0;const Bt=Ce.aabb.closestPoint(R);return Bt[0]===R[0]&&Bt[1]===R[1]};if(this.renderWorldCopies)for(let Ce=1;Ce<=3;Ce++)xe.push(me(-Ce)),xe.push(me(Ce));for(xe.push(me(0));xe.length>0;){const Ce=xe.pop(),Ze=Ce.x,Ve=Ce.y;let it=Ce.fullyVisible;const mt=()=>this.projection.name==="globe"&&(Ce.y===0||Ce.y===(1<<Ce.zoom)-1);if(!it){let It=ee?Ce.aabb.intersects(j):Ce.aabb.intersectsFlat(j);if(It===0&&mt()){const ht=new o.cC(Ce.zoom,Ze,Ve);It=o.cD(this,P,ht,!0).intersects(j)}if(It===0)continue;it=It===2}if(Ce.zoom!==Re&&Fe(Ce))for(let It=0;It<4;It++){const ht=(Ze<<1)+It%2,at=(Ve<<1)+(It>>1),jt={aabb:x?Ce.aabb.quadrant(It):o.cE(this,P,Ce.zoom+1,ht,at,Ce.wrap,Ce.minZ,Ce.maxZ,this.projection),zoom:Ce.zoom+1,x:ht,y:at,wrap:Ce.wrap,fullyVisible:it,tileID:void 0,shouldSplit:void 0,minZ:Ce.minZ,maxZ:Ce.maxZ};y&&!F&&(jt.tileID=new o.aO(Ce.zoom+1===Re?qe:Ce.zoom+1,Ce.wrap,Ce.zoom+1,ht,at),We(jt)),xe.push(jt)}else{const It=Ce.zoom===Re?qe:Ce.zoom;if(n.minzoom&&n.minzoom>It)continue;let ht=0;if(!it){let Bt=ee?Ce.aabb.intersectsPrecise(j):Ce.aabb.intersectsPreciseFlat(j);if(Bt===0&&mt()){const zt=new o.cC(Ce.zoom,Ze,Ve);Bt=o.cD(this,P,zt,!0).intersectsPrecise(j)}if(Bt===0)continue;if(n.calculateQuadrantVisibility)if(j.containsPoint(Ce.aabb.center))ht=15;else for(let zt=0;zt<4;zt++)Ce.aabb.quadrant(zt).intersects(j)!==0&&(ht|=1<<zt)}const at=R[0]-(.5+Ze+(Ce.wrap<<Ce.zoom))*(1<<a-Ce.zoom),jt=R[1]-.5-Ve,Ot=Ce.tileID?Ce.tileID:new o.aO(It,Ce.wrap,Ce.zoom,Ze,Ve);n.calculateQuadrantVisibility&&(Ot.visibleQuadrants=ht),Ne.push({tileID:Ot,distanceSq:at*at+jt*jt})}}if(this.fogCullDistSq){const Ce=this.fogCullDistSq,Ze=this.horizonLineFromTop();Ne=Ne.filter(Ve=>{const it=[0,0,0,1],mt=[o.al,o.al,0,1],It=this.calculateFogTileMatrix(Ve.tileID.toUnwrapped());o.aC(it,it,It),o.aC(mt,mt,It);const ht=o.cF([],it,mt),at=o.cG([],it,mt),jt=o.c_(ht,at);if(jt===0)return!0;let Ot=!1;const Bt=this._elevation;if(Bt&&jt>Ce&&Ze!==0){const zt=this.calculateProjMatrix(Ve.tileID.toUnwrapped());let rn;n.isTerrainDEM||(rn=Bt.getMinMaxForTile(Ve.tileID)),rn||(rn={min:ge,max:ye});const gn=o.cH(this.rotation),vn=[gn[0]*o.al,gn[1]*o.al,rn.max];o.af(vn,vn,zt),Ot=(1-vn[1])*this.height*.5<Ze}return jt<Ce||Ot})}return Ne.sort((Ce,Ze)=>Ce.distanceSq-Ze.distanceSq).map(Ce=>Ce.tileID)}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log2(n)}project(n){const a=o.aA(n.lat,-o.cI,o.cI),h=this.projection.project(n.lng,a);return new o.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,a){let h,g;const y=this.centerPoint;if(this.projection.name==="globe"){const T=this.worldSize;h=(a.x-y.x)/T,g=(a.y-y.y)/T}else{const T=this.pointCoordinate(a),I=this.pointCoordinate(y);h=T.x-I.x,g=T.y-I.y}const x=this.locationCoordinate(n);this.setLocation(new o.ae(x.x-h,x.y-g))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,a){return this.projection.locationPoint(this,n,a)}locationPoint3D(n,a){return this.projection.locationPoint(this,n,a,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,a){return this.coordinateLocation(this.pointCoordinate3D(n,a))}locationCoordinate(n,a){const h=a?o.ce(a,n.lat):void 0,g=this.projection.project(n.lng,n.lat);return new o.ae(g.x,g.y,h)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const h=a??this._centerAltitude,g=[n.x,n.y,0,1],y=[n.x,n.y,1,1];o.aC(g,g,this.pixelMatrixInverse),o.aC(y,y,this.pixelMatrixInverse);const x=y[3];o.cJ(g,g,1/g[3]),o.cJ(y,y,1/x);const T=g[2],I=y[2];return{p0:g,p1:y,t:T===I?0:(h-T)/(I-T)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],h=[n.x,n.y,1,1];return o.aC(a,a,this.pixelMatrixInverse),o.aC(h,h,this.pixelMatrixInverse),o.cJ(a,a,1/a[3]),o.cJ(h,h,1/h[3]),a[2]=o.ce(a[2],this._center.lat)*this.worldSize,h[2]=o.ce(h[2],this._center.lat)*this.worldSize,o.cJ(a,a,1/this.worldSize),o.cJ(h,h,1/this.worldSize),new o.ax([a[0],a[1],a[2]],o.aw([],o.av([],h,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:h,t:g}=n,y=o.ce(a[2],this._center.lat),x=o.ce(h[2],this._center.lat);return new o.ae(o.ak(a[0],h[0],g)/this.worldSize,o.ak(a[1],h[1],g)/this.worldSize,o.ak(y,x,g))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n,a){if(!this.elevation)return this.pointCoordinate(n,a);let h=this.projection.pointCoordinate3D(this,n.x,n.y);if(h)return new o.ae(h[0],h[1],h[2]);let g=0,y=this.horizonLineFromTop();if(n.y>y)return this.pointCoordinate(n,a);const x=.02*y,T=n.clone();for(let I=0;I<10&&y-g>x;I++){T.y=o.ak(g,y,.66);const P=this.projection.pointCoordinate3D(this,T.x,T.y);P?(y=T.y,h=P):g=T.y}return h?new o.ae(h[0],h[1],h[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=o.cK)return!this.isPointAboveHorizon(n);const a=this.pointCoordinate(n);return a.y>=0&&a.y<=1}_coordinatePoint(n,a){const h=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,g=[n.x*this.worldSize,n.y*this.worldSize,h+n.toAltitude(),1];return o.aC(g,g,this.pixelMatrix),g[3]>0?new o.P(g[0]/g[3],g[1]/g[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:a}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,y=this.pointLocation3D(new o.P(a,n)),x=this.pointLocation3D(new o.P(g,n)),T=this.pointLocation3D(new o.P(g,h)),I=this.pointLocation3D(new o.P(a,h));let P=Math.min(y.lng,x.lng,T.lng,I.lng),R=Math.max(y.lng,x.lng,T.lng,I.lng),F=Math.min(y.lat,x.lat,T.lat,I.lat),D=Math.max(y.lat,x.lat,T.lat,I.lat);const j=Math.pow(2,-this.zoom)/16*270,U=this.projection.name==="globe"?1:4,G=(J,Z,ee,oe,ue)=>{const ye=(J+ee)/2,ge=(Z+oe)/2,ve=new o.P(ye,ge),{lng:_e,lat:me}=this.pointLocation3D(ve),xe=Math.max(0,P-_e,F-me,_e-R,me-D);P=Math.min(P,_e),R=Math.max(R,_e),F=Math.min(F,me),D=Math.max(D,me),(ue<U||xe>j)&&(G(J,Z,ye,ge,ue+1),G(ye,ge,ee,oe,ue+1))};if(G(a,n,g,n,1),G(g,n,g,h,1),G(g,h,a,h,1),G(a,h,a,n,1),this.projection.name==="globe"){const[J,Z]=o.cL(this);J?(D=90,R=180,P=-180):Z&&(F=-90,R=180,P=-180)}return new o.aI(new o.aR(P,F),new o.aR(R,D))}_getBoundsRectangular(n,a){const{top:h,left:g}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,T=new o.P(g,h),I=new o.P(x,h),P=new o.P(x,y),R=new o.P(g,y);let F=this.pointCoordinate(T,n),D=this.pointCoordinate(I,n);const j=this.pointCoordinate(P,a),U=this.pointCoordinate(R,a),G=(J,Z)=>(Z.y-J.y)/(Z.x-J.x);return F.y>1&&D.y>=0?F=new o.ae((1-U.y)/G(U,F)+U.x,1):F.y<0&&D.y<=1&&(F=new o.ae(-U.y/G(U,F)+U.x,0)),D.y>1&&F.y>=0?D=new o.ae((1-j.y)/G(j,D)+j.x,1):D.y<0&&F.y<=1&&(D=new o.ae(-j.y/G(j,D)+j.x,0)),new o.aI().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=n.visibleDemTiles.reduce((h,g)=>{if(g.dem){const y=g.dem.tree;h.min=Math.min(h.min,y.minimums[0]),h.max=Math.max(h.max,y.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-o.cI,this.maxLat=o.cI,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aF(this.minLng)*this.tileSize,this.worldMaxX=o.aF(this.maxLng)*this.tileSize,this.worldMinY=o.aJ(this.maxLat)*this.tileSize,this.worldMaxY=o.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,h=this._distanceTileDataCache;if(h[a])return h[a];const g=n.canonical,y=1/this.height,x=this.cameraWorldSize,T=x/this.zoomScale(g.z),I=(g.x+Math.pow(2,g.z)*n.wrap)*T,P=g.y*T,R=this.point;R.x*=x/this.worldSize,R.y*=x/this.worldSize;const F=this.angle,D=Math.sin(-F),j=-Math.cos(-F);return h[a]={bearing:[D,j],center:[(R.x-I)*y,(R.y-P)*y],scale:T/o.al*y},h[a]}calculateFogTileMatrix(n){const a=n.key,h=this._fogTileMatrixCache;if(h[a])return h[a];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return o.aB(g,this.worldToFogMatrix,g),h[a]=new Float32Array(g),h[a]}calculateProjMatrix(n,a=!1,h=!1){const g=n.key;let y;if(y=h?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,y[g])return y[g];const x=this.calculatePosMatrix(n,this.worldSize);let T;return T=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,o.aB(x,T,x),y[g]=new Float32Array(x),y[g]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,h=this._pixelsToTileUnitsCache;if(h[a])return h[a];const g=o.cM(n,this);return h[a]=g,h[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,a=o.bq([],[n,n,n]);return o.aB(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const a=o.ce(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(a),g=this._camera.forward(),y=o.ce(1,this._center.lat);h[2]/=y,g[2]/=y,o.aw(g,g);const x=n.raycast(h,g,n.exaggeration());if(x){const T=o.bH([],h,g,x),I=new o.ae(T[0],T[1],o.ce(T[2],o.a$(T[1]))),P=(I.z+o.ag([I.x-h[0],I.y-h[1],I.z-h[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const a=this._elevation,h=o.ce(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),y=a.getAtPointOrZero(new o.ae(...g)),x=this.pixelsPerMeter/this.worldSize*y,T=this._minimumHeightOverTerrain(),I=g[2]-x;if(I<=T)if(I<0||n){const P=this.locationCoordinate(this._center,this._centerAltitude),R=[g[0],g[1],P.z-g[2]],F=o.ag(R);R[2]-=(T-I)/this._pixelsPerMercatorPixel;const D=o.ag(R);if(D===0)return;o.c4(R,R,F/D*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],P.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const D=this.center;return D.lat=o.aA(D.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(D.lng=o.aA(D.lng,this.minLng,this.maxLng)),this.center=D,void(this._constraining=!1)}const a=this._unmodified,{x:h,y:g}=this.point;let y=0,x=h,T=g;const I=this.width/2,P=this.height/2,R=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(g-P<R&&(T=R+P),g+P>F&&(T=F-P),F-R<this.height&&(y=Math.max(y,this.height/(F-R)),T=(F+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const D=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,U=this.worldSize/2-(D+j)/2;x=(h+U+this.worldSize)%this.worldSize-U,x-I<D&&(x=D+I),x+I>j&&(x=j-I),j-D<this.width&&(y=Math.max(y,this.width/(j-D)),x=(j+D)/2)}x===h&&T===g||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(x,T))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.ce(1,this.center.lat)/o.ce(1,o.d1));const g=o.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?h:1,x=this._camera.getWorldToCamera(this.worldSize,y);let T;const I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(I[8]=2*-n.x/this.width,I[9]=2*n.y/this.height,this.isOrthographic){let me=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),xe=me*this.aspect,Ne=-xe,Re=-me;xe-=n.x,Ne-=n.x,me+=n.y,Re+=n.y,T=this._camera.getCameraToClipOrthographic(Ne,xe,Re,me,this._nearZ,this._farZ),((qe,Oe,We,gt)=>{for(let Fe=0;Fe<16;Fe++)qe[Fe]=o.ak(Oe[Fe],We[Fe],gt)})(T,T,I,o.c$(this.pitch>=ka?1:this.pitch/ka))}else T=I;const P=o.cO([],I,x);let R=o.cO([],T,x);if(this.projection.isReprojectedInTileSpace){const me=this.locationCoordinate(this.center),xe=o.bA([]);o.br(xe,xe,[me.x*this.worldSize,me.y*this.worldSize,0]),o.aB(xe,xe,o.cP(this)),o.br(xe,xe,[-me.x*this.worldSize,-me.y*this.worldSize,0]),o.aB(R,R,xe),o.aB(P,P,xe),this.inverseAdjustmentMatrix=o.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cR([],R,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=R,this.invProjMatrix=o.bl(new Float64Array(16),this.projMatrix),a){const me=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);me[8]=2*-n.x/this.width,me[9]=2*n.y/this.height,this.expandedFarZProjMatrix=o.cO([],me,x)}else this.expandedFarZProjMatrix=this.projMatrix;const F=o.bl([],T);this.frustumCorners=o.cS.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const D=new Float32Array(16);o.bA(D),o.cR(D,D,[1,-1,1]),o.cT(D,D,this._pitch),o.bB(D,D,this.angle);const j=o.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bz(j);const U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-n.x/this.width,j[9]=2*(n.y+U)/this.height,this.skyboxMatrix=o.aB(D,j,D);const G=this.point,J=G.x,Z=G.y,ee=this.width%2/2,oe=this.height%2/2,ue=Math.cos(this.angle),ye=Math.sin(this.angle),ge=J-Math.round(J)+ue*ee+ye*oe,ve=Z-Math.round(Z)+ue*oe+ye*ee,_e=new Float64Array(R);if(o.br(_e,_e,[ge>.5?ge-1:ge,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=_e,R=o.bC(),o.cR(R,R,[this.width/2,-this.height/2,1]),o.br(R,R,[1,-1,0]),this.labelPlaneMatrix=R,R=o.bC(),o.cR(R,R,[1,-1,1]),o.br(R,R,[-1,-1,0]),o.cR(R,R,[2/this.width,2/this.height,1]),this.glCoordMatrix=R,this.pixelMatrix=o.aB(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},R=o.bl(new Float64Array(16),this.pixelMatrix),!R)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=R,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cU(this);const me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.af(me,me,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=R;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,h=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,y=[n,n,a];o.c4(y,y,g),o.c4(h,h,-1),o.cV(h,h,y);const x=o.bC();o.br(x,x,h),o.cR(x,x,y),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,g)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),g=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-h[0]*y,g.y/this.worldSize-h[1]*y,n/this.worldSize*this._centerAltitude-h[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],g=n[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(y=Math.min((a-h)/g,1)),this._camera.position=o.bH([],this._camera.position,n,y),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:h,bearing:g}=this._camera.getPitchBearing(),y=o.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.an(this._maxPitch)),T=Math.max((n[2]-y)/Math.cos(h),x),I=this._zoomFromMercatorZ(T);o.bH(n,n,a,T),this._pitch=o.aA(h,o.an(this.minPitch),o.an(this.maxPitch)),this.angle=o.bT(g,-Math.PI,Math.PI),this._setZoom(o.aA(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ae(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let a=0,h=o.cK,g=0,y=1/0;for(;h-a>1e-6&&h>a;){const x=a+.5*(h-a),T=this.tileSize*Math.pow(2,x),I=this.getCameraToCenterDistance(this.projection,x,T),P=this.scaleZoom(I/(Math.max(0,n)*this.tileSize)),R=Math.abs(x-P);R<y&&(y=R,g=x),x<P?a=x:h=x}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const h=Math.min(n.x,a.x),g=Math.max(n.x,a.x),y=Math.min(n.y,a.y),x=Math.max(n.y,a.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const T=[new o.P(h,y),new o.P(g,x),new o.P(h,x),new o.P(g,y)],I=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const R of T){const F=this.pointRayIntersection(R);if(F.t<0)return!0;const D=this.rayIntersectionCoordinate(F);if(D.x<I||D.y<0||D.x>P||D.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(n,a){const h=o.ag(o.av([],this._camera.position,n)),g=this._zoomFromMercatorZ(h)+a;return h-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([a,h,g],y){const x=[a,h,g,1];o.aC(x,x,y);const T=x[3]=Math.max(x[3],1e-6);return x[0]/=T,x[1]/=T,x[2]/=T,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,n))}}getCameraToCenterDistance(n,a=this.zoom,h=this.worldSize){const g=o.cN(n,a,this.width,this.height,1024),y=n.pixelSpaceConversion(this.center.lat,h,g);let x=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(x=o.ak(1,x,o.c$(this.pitch>=ka?1:this.pitch/ka))),x}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.aB(n,n,this.globeMatrix),n}getFrustum(n){return o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const hl=(d,n)=>{if(n>0&&d.terrain&&o.w("Cutoff is currently disabled on terrain"),n<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=d.transform,h=Math.max(Math.abs(a._zoom-(d.minCutoffZoom-1)),1),g=a.isLODDisabled(!1)?o.ah(60,45,a.pitch):o.ah(30,15,a.pitch),y=a._farZ-a._nearZ,x=n*a.height,T=((1-(I=g))*a.cameraToCenterDistance+I*(a._farZ+x))*h;var I;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(T-a._nearZ)/y,(T-x-a._nearZ)/y]}}},Wr={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class gv{constructor(n,a){this.aabb=n,this.lastCascade=a}}class kh{add(n,a){const h=this.receivers[n.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],a.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],a.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],a.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],a.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],a.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],a.max[2])):this.receivers[n.key]=new gv(a,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,a,h){const g=o.d8.fromPoints(n.points);let y=0;for(const x in this.receivers){const T=this.receivers[x];if(!T||!g.intersectsAabb(T.aabb))continue;T.aabb.min=g.closestPoint(T.aabb.min),T.aabb.max=g.closestPoint(T.aabb.max);const I=T.aabb.getCorners();for(let P=0;P<h.length;P++){let R=!0;for(const F of I){const D=[F[0]*a,F[1]*a,F[2]];if(o.af(D,D,h[P].matrix),D[0]<-1||D[0]>1||D[1]<-1||D[1]>1){R=!1;break}}if(T.lastCascade=P,y=Math.max(y,P),R)break}}return y+1}}class _w{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new kh,this._depthMode=new Ct(n.context.gl.LEQUAL,Ct.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(Wr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(Wr,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(Wr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,a){const h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const g=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||g<=0||(this._shadowLayerCount=h.style.order.reduce((U,G)=>{const J=h.style._mergedLayers[G];return U+(J.hasShadowPass()&&!J.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const y=h.context,x=Wr.shadowMapResolution,T=Wr.shadowMapResolution;if(this._cascades.length===0||Wr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let U=0;U<Wr.cascadeCount;++U){const G=h._shadowMapDebug,J=y.gl,Z=y.createFramebuffer(x,T,G,"texture"),ee=new o.T(y,{width:x,height:T,data:null},J.DEPTH_COMPONENT16);if(Z.depthAttachment.set(ee.texture),G){const oe=new o.T(y,{width:x,height:T,data:null},J.RGBA8);Z.colorAttachment.set(oe.texture)}this._cascades.push({framebuffer:Z,texture:ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cA,scale:0})}}this.shadowDirection=Yc(a);let I=0;if(n.elevation){const U=n.elevation,G=[1e4,-1e4];U.visibleDemTiles.filter(J=>J.dem).forEach(J=>{const Z=J.dem.tree;G[0]=Math.min(G[0],Z.minimums[0]),G[1]=Math.max(G[1],Z.maximums[0])}),G[0]!==1e4&&(I=(G[1]-G[0])*U.exaggeration())}const P=1.5*n.cameraToCenterDistance,R=3*P,F=new Float64Array(16);for(let U=0;U<this._cascades.length;++U){const G=this._cascades[U];let J=n.height/50,Z=1;Wr.cascadeCount===1?Z=R:U===0?Z=P:(J=P,Z=R);const[ee,oe]=yw(n,this.shadowDirection,J,Z,Wr.shadowMapResolution,I);G.scale=n.scale,G.matrix=ee,G.boundingSphereRadius=oe,o.bl(F,G.matrix),G.frustum=o.cA.fromInvProjectionMatrix(F,1,0,!0),G.far=Z}const D=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[D].far,this._cascades[D].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Wr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Wr.shadowMapResolution,this._uniformValues.u_shadowmap_0=er.ShadowMap0,this._uniformValues.u_shadowmap_1=er.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const j=h.transform.elevation;for(const U of this._groundShadowTiles){let G={min:0,max:0};if(j){const J=j.getMinMaxForTile(U);J&&(G=J)}this.addShadowReceiver(U.toUnwrapped(),G.min,G.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,a){if(!this.enabled)return;const h=this.painter,g=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),g.viewport.set([0,0,Wr.shadowMapResolution,Wr.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){h.currentShadowCascade=y,g.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),g.clear({color:o.ao.white,depth:1});for(const x of n.order){const T=n._mergedLayers[x];if(!T.hasShadowPass()||T.isHidden(h.transform.zoom))continue;const I=n.getLayerSourceCache(T),P=I?a[I.id]:void 0;(T.type==="model"||P&&P.length)&&h.renderLayer(h,I,T,P)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,a=n.style,h=n.context,g=h.gl,y=a.directionalLight,x=a.ambientLight;if(!y||!x)return;const T=[],I=hl(n,n.longestCutoffRange);I.shouldRenderCutoff&&T.push("RENDER_CUTOFF"),T.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&T.push("NORMAL_OFFSET");const P=Uo(a,y,x),R=new Ct(g.LEQUAL,Ct.ReadOnly,n.depthRangeFor3D),F=new Jt({func:g.EQUAL,mask:255},0,255,g.KEEP,g.KEEP,g.KEEP);for(const D of this._groundShadowTiles){const j=D.toUnwrapped(),U=n.isTileAffectedByFog(D),G=n.getOrCreateProgram("groundShadow",{defines:T,overrideFog:U});this.setupShadows(j,G),n.uploadCommonUniforms(h,G,j,null,I);const J={u_matrix:n.transform.calculateProjMatrix(j),u_ground_shadow_factor:P};G.draw(n,g.TRIANGLES,R,F,yn.multiply,nn.disabled,J,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?yn.unblended:yn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const a=this.painter.transform,h=a.calculatePosMatrix(n,a.worldSize);return o.aB(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(n){return o.aB(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,a,h){if(!this.enabled)return;const g=this.painter.transform,y=this.painter.context,x=y.gl,T=this._uniformValues,I=new Float64Array(16),P=g.calculatePosMatrix(n,g.worldSize);for(let R=0;R<this._cascades.length;R++)o.aB(I,this._cascades[R].matrix,P),T[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),y.activeTexture.set(x.TEXTURE0+er.ShadowMap0+R),this._cascades[R].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=!!h,this.useNormalOffset){const R=o.d6(n.canonical),F=2/g.tileSize*o.al/Wr.shadowMapResolution,D=F*this._cascades[0].boundingSphereRadius,j=F*this._cascades[this._cascades.length-1].boundingSphereRadius,U=(h==="vector-tile"?1:3)*function(G,J,Z,ee,oe){const ue=o.aA((G-22)/-22,0,1);return .125*(1-ue)+4*ue}(g.zoom);T.u_shadow_normal_offset=[R,D*U,j*U],T.u_shadow_bias=[1e-4,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(y,T)}setupShadowsFromMatrix(n,a,h=!1){if(!this.enabled)return;const g=this.painter.context,y=g.gl,x=this._uniformValues,T=new Float64Array(16);for(let I=0;I<Wr.cascadeCount;I++)o.aB(T,this._cascades[I].matrix,n),x[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),g.activeTexture.set(y.TEXTURE0+er.ShadowMap0+I),this._cascades[I].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);if(this.useNormalOffset=h,h){const I=Wr.normalOffset;x.u_shadow_normal_offset=[1,I,I],x.u_shadow_bias=[6e-5,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(g,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,a,h,g){if(g[2]>=0)return{};const y=function(I,P,R){const F=R/(1<<I.canonical.z);return new o.d8([I.canonical.x*F+I.wrap*R,I.canonical.y*F+I.wrap*R,0],[(I.canonical.x+1)*F+I.wrap*R,(I.canonical.y+1)*F+I.wrap*R,P])}(n,a,h).getCorners(),x=a/-g[2];g[0]<0?(o.d7(y[0],y[0],[g[0]*x,0,0]),o.d7(y[3],y[3],[g[0]*x,0,0])):g[0]>0&&(o.d7(y[1],y[1],[g[0]*x,0,0]),o.d7(y[2],y[2],[g[0]*x,0,0])),g[1]<0?(o.d7(y[0],y[0],[0,g[1]*x,0]),o.d7(y[1],y[1],[0,g[1]*x,0])):g[1]>0&&(o.d7(y[2],y[2],[0,g[1]*x,0]),o.d7(y[3],y[3],[0,g[1]*x,0]));const T={};return T.vertices=y,T.planes=[of(y[1],y[0],y[4]),of(y[2],y[1],y[5]),of(y[3],y[2],y[6]),of(y[0],y[3],y[7])],T}addShadowReceiver(n,a,h){this._receivers.add(n,o.d8.fromTileIdAndHeight(n,a,h))}getMaxCascadeForTile(n){const a=this._receivers.get(n);return a&&a.lastCascade?a.lastCascade:0}}function of(d,n,a){const h=o.av([],a,n),g=o.av([],d,n),y=o.bI([],h,g),x=o.ag(y);return x===0?[0,0,1,0]:(o.c4(y,y,1/x),[y[0],y[1],y[2],-o.bJ(y,n)])}function Yc(d){const n=d.properties.get("direction"),a=o.d3(n.x,n.y,n.z);a[2]=o.aA(a[2],0,75);const h=o.d5([a[0],a[1],a[2]]);return o.d4(h.x,h.y,h.z)}function Uo(d,n,a){const h=n.properties.get("color-use-theme")==="none",g=n.properties.get("color"),y=n.properties.get("intensity"),x=n.properties.get("direction"),T=[x.x,x.y,x.z],I=a.properties.get("color-use-theme")==="none",P=a.properties.get("color"),R=a.properties.get("intensity"),F=Math.max(o.bJ([0,0,1],T),0),D=[0,0,0];o.c4(D,P.toPremultipliedRenderColor(I?null:d.getLut(n.scope)).toArray01Linear().slice(0,3),R);const j=[0,0,0];return o.c4(j,g.toPremultipliedRenderColor(h?null:d.getLut(a.scope)).toArray01Linear().slice(0,3),F*y),o.da([D[0]>0?D[0]/(D[0]+j[0]):0,D[1]>0?D[1]/(D[1]+j[1]):0,D[2]>0?D[2]/(D[2]+j[2]):0])}function yw(d,n,a,h,g,y){const x=d.zoom,T=d.scale,I=d.worldSize,P=1/I,R=d.aspect,F=Math.sqrt(1+R*R)*Math.tan(.5*d.fovX),D=F*F,j=h-a,U=h+a;let G,J;D>j/U?(G=h,J=h*F):(G=.5*U*(1+D),J=.5*Math.sqrt(j*j+2*(h*h+a*a)*D+U*U*D*D));const Z=d.projection.pixelsPerMeter(d.center.lat,I),ee=d._camera.getCameraToWorldMercator(),oe=[0,0,-G*P];o.af(oe,oe,ee);let ue=J*P;const ye=d._edgeInsets;if(!(ye.left===0&&ye.top===0&&ye.right===0&&ye.bottom===0||ye.left===ye.right&&ye.top===ye.bottom)){const it=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?Z:1),mt=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,a,h);mt[8]=2*-d.centerOffset.x/d.width,mt[9]=2*d.centerOffset.y/d.height;const It=new Float64Array(16);o.cO(It,mt,it);const ht=new Float64Array(16);o.bl(ht,It);const at=o.cA.fromInvProjectionMatrix(ht,I,x,!0);for(const jt of at.points){const Ot=((ge=jt)[0]/=T,ge[1]/=T,ge[2]=o.ce(ge[2],d._center.lat),ge);ue=Math.max(ue,o.c5(o.d9([],oe,Ot)))}}var ge;ue*=g/(g-1);const ve=Math.acos(n[2]),_e=Math.atan2(-n[0],-n[1]),me=new sf;me.position=oe,me.setPitchBearing(ve,_e);const xe=me.getWorldToCamera(I,Z),Ne=ue*I,Re=Math.min(d._mercatorZfromZoom(17)*I*-2,-2*Ne),qe=me.getCameraToClipOrthographic(-Ne,Ne,-Ne,Ne,Re,(Ne+y*Z)/n[2]),Oe=new Float64Array(16);o.aB(Oe,qe,xe);const We=o.d4(Math.floor(1e6*oe[0])/1e6*I,Math.floor(1e6*oe[1])/1e6*I,0),gt=.5*g,Fe=[0,0,0];o.af(Fe,We,Oe),o.c4(Fe,Fe,gt);const Ce=[Math.floor(Fe[0]),Math.floor(Fe[1]),Math.floor(Fe[2])],Ze=[0,0,0];o.av(Ze,Fe,Ce),o.c4(Ze,Ze,-1/gt);const Ve=new Float64Array(16);return o.bA(Ve),o.br(Ve,Ve,Ze),o.aB(Oe,Ve,Oe),[Oe,Ne]}class Jc extends o.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,a){return o.aV(this.requestManager.transformRequest(a,o.R.Model).url).then(h=>{if(!h)return;const g=o.aW(h),y=new o.aX(n,void 0,void 0,g);return y.computeBoundsAndApplyParent(),y}).catch(h=>{if(h&&h.status===404)return null;this.fire(new o.y(new Error(`Could not load model ${n} from ${a}: ${h.message}`)))})}load(n,a,h={forceReload:!1}){this.models[a]||(this.models[a]={});const g=Object.keys(n),y=[],x=[];for(const T of g){const I=n[T];this.hasURLBeenRequested(I)&&!h.forceReload||(this.modelByURL[I]={modelId:T,scope:a},y.push(this.loadModel(T,I)),x.push(T)),this.models[a][T]||(this.models[a][T]={model:null,numReferences:1})}this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+x.length,Promise.allSettled(y).then(T=>{for(let I=0;I<T.length;I++){const{status:P}=T[I];if(P==="rejected")continue;const{value:R}=T[I];this.models[a][x[I]]||(this.models[a][x[I]]={model:null,numReferences:1}),this.models[a][x[I]].model=R}this.numModelsLoading[a]-=x.length,this.fire(new o.z("data",{dataType:"style"}))}).catch(T=>{this.fire(new o.y(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,a,h={exactIdMatch:!1}){return!!(h.exactIdMatch?this.getModel(n,a):this.getModelByURL(this.modelUris[a][n]))}getModel(n,a){return this.models[a]||(this.models[a]={}),this.models[a][n]?this.models[a][n].model:void 0}getModelByURL(n){if(!n)return null;const a=this.modelByURL[n];return a?this.models[a.scope][a.modelId].model:null}hasModelBeenAdded(n,a){return this.models[a]&&this.models[a][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,a,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const g=this.requestManager.normalizeModelURL(a);if((this.hasModel(n,h,{exactIdMatch:!0})||this.hasModelBeenAdded(n,h))&&this.modelUris[h][n]===g)this.models[h][n].numReferences++;else if(this.hasURLBeenRequested(g)){const{scope:y,modelId:x}=this.modelByURL[g];this.models[y][x].numReferences++}else this.modelUris[h][n]=g,this.load({[n]:this.modelUris[h][n]},h)}addModelURLs(n,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const h=this.modelUris[a];for(const g in n)h[g]=this.requestManager.normalizeModelURL(n[g])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const h={};for(const g of n)this.hasModel(g,a,{exactIdMatch:!0})||this.hasURLBeenRequested(g)?this.models[a][g].numReferences++:this.modelUris[a][g]&&!this.hasURLBeenRequested(g)?h[g]=this.modelUris[a][g]:!this.hasURLBeenRequested(g)&&o.db(g,!1)&&(this.modelUris[a][g]=this.requestManager.normalizeModelURL(g),h[g]=this.modelUris[a][g]);this.load(h,a)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,a,h=!1,g=!1){if(this.models[a]&&this.models[a][n]&&(this.models[a][n].numReferences--,this.models[a][n].numReferences===0||g)){const y=this.modelUris[a][n];h||delete this.modelUris[a][n],delete this.modelByURL[y];const x=this.models[a][n].model;if(!x)return;delete this.models[a][n],x.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const a of Object.keys(this.models[n])){const h=this.models[n][a].model;delete this.models[n][a],h&&h.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,a){this.models[a]||(this.models[a]={});for(const h in this.models[a])this.models[a][h].model&&this.models[a][h].model.upload(n.context)}}const _v=new o.a9({data:new o.aa(o.a6.colorTheme.data)});function af(d){if(!d.metadata||!d.metadata.content_area)return;const n=o.o.devicePixelRatio,{left:a,top:h,width:g,height:y}=d.metadata.content_area,x=a*n,T=h*n;return[x,T,x+g*n,T+y*n]}function lf(d){if(d)return d.map(([n,a])=>[n*o.o.devicePixelRatio,a*o.o.devicePixelRatio])}class dl{constructor(n,a,h){this.id=n,this.scope=a,this.sourceCache=h,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const a=this.sourceCache.getVisibleCoordinates();if(a.length===0)return n;const h=this.sourceCache.getSource();if(!(h instanceof sl))return n;const g=a.map(x=>this.sourceCache.getTile(x)),y=h.getImages(g,Array.from(this.pendingRequests));for(const[x,T]of y)n.set(o.I.from({name:x,iconsetId:this.id}),T),this.pendingRequests.delete(x);for(const x of this.pendingRequests)this.missingRequests.add(x);return this.pendingRequests.clear(),n}}const nc=(d,n)=>Se(d,n&&n.filter(a=>a.identifier!=="source.canvas")),vw=o.aH(Nn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),xw=o.aH(Nn,["setCenter","setZoom","setBearing","setPitch"]),cf=new Set(["background","sky","slot","custom"]),yv={version:8,layers:[],sources:{}},uf={duration:300,delay:0};class Ao extends o.E{constructor(n,a={}){super(),this.map=n,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=Object.assign({},uf),this._buildingIndex=new qd(this),this.crossTileSymbolIndex=new Ir,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new ji,this.dispatcher=a.dispatcher?a.dispatcher:new o.D(o.dd(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new ii(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new o.de(n._requestManager,a.localFontFamily?o.df.all:a.localIdeographFontFamily?o.df.ideographs:o.df.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new Jc(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",o.dg());const h=this;this._rtlTextPluginCallback=Ao.registerForPluginStateChange(g=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(y,x)=>{if(o.dh(y),x&&x.every(T=>T))for(const T in h._sourceCaches){const I=h._sourceCaches[T],P=I.getSource().type;P!=="vector"&&P!=="geojson"||I.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const y=this.getOwnSource(g.sourceId);if(y&&y.vectorLayerIds)for(const x in this._layers){const T=this._layers[x];T.source===y.id&&this._validateLayer(T)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(o.h(n))return n;const a=o.di(n);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${o.dj(JSON.stringify(n))}`}_diffStyle(n,a,h){this.globalId=this._getGlobalId(n);const g=(y,x)=>{try{x(null,this.setState(y,h))}catch(T){x(T,!1)}};if(typeof n=="string"){const y=this.map._requestManager.normalizeStyleURL(n),x=this.map._requestManager.transformRequest(y,o.R.Style);o.m(x,(T,I)=>{T?this.fire(new o.y(T)):I&&g(I,a)})}else typeof n=="object"&&g(n,a)}loadURL(n,a={}){this.fire(new o.z("dataloading",{dataType:"style"}));const h=typeof a.validate=="boolean"?a.validate:!o.h(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,a.accessToken),this.resolvedImports.add(n);const g=this.importsCache.get(n);if(g)return this._load(g,h);const y=this.map._requestManager.transformRequest(n,o.R.Style);this._request=o.m(y,(x,T)=>{if(this._request=null,x)this.fire(new o.y(x));else if(T)return this.importsCache.set(n,T),this._load(T,h)})}loadJSON(n,a={}){this.fire(new o.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=o.o.frame(()=>{this._request=null,this._load(n,a.validate!==!1)})}loadEmpty(){this.fire(new o.z("dataloading",{dataType:"style"})),this._load(yv,!1)}_loadImports(n,a,h){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const g=[];for(const y of n){const x=this._createFragmentStyle(y),T=new Promise(R=>{x.once("style.import.load",R),x.once("error",R)}).then(()=>this.mergeAll());if(g.push(T),this.resolvedImports.has(y.url)){x.loadEmpty();continue}const I=y.data||this.importsCache.get(y.url);I?(x.loadJSON(I,{validate:a}),this._isInternalStyle(I)&&(x.globalId=null)):y.url?x.loadURL(y.url,{validate:a}):x.loadEmpty();const P={style:x,id:y.id,config:y.config};if(h){const R=this.fragments.findIndex(({id:F})=>F===h);this.fragments=this.fragments.slice(0,R).concat(P).concat(this.fragments.slice(R))}else this.fragments.push(P)}return Promise.allSettled(g)}getImportGlobalIds(n=this,a=new Set){for(const h of n.fragments)h.style.globalId&&a.add(h.style.globalId),this.getImportGlobalIds(h.style,a);return[...a.values()]}_createFragmentStyle(n){const a=this.scope?o.B(n.id,this.scope):n.id;let h;const g=this._initialConfig&&this._initialConfig[a];(n.config||g)&&(h=Object.assign({},n.config,g));const y=new Ao(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:h,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,a){if(this._isInternalStyle(n)){const y=Object.assign({},yv,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(y,a)}if(this.updateConfig(this._config,n.schema),a&&nc(this,Ns(n)))return;this._loaded=!0,this.stylesheet=o.dk(n);const h=()=>{for(const I in n.sources)this.addSource(I,n.sources[I],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const I in n.iconsets)this.addIconset(I,n.iconsets[I]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&n.glyphs&&this.glyphManager.setURL(n.glyphs);const y=Zd(this.stylesheet.layers);if(this._order=y.map(I=>I.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const I=this.stylesheet.lights[0];this.light=new ke(I.properties,I.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ke(this.stylesheet.light)),this._layers={};for(const I of y){const P=o.dq(I,this.scope,this._styleColorTheme.lut,this.options);P.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P;const R=this.getOwnLayerSourceCache(P),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&P.canCastShadows()&&F&&(R.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const x=this.stylesheet.terrain;x&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(x,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.z("data",{dataType:"style"}));const T=this.isRootStyle();n.imports?this._loadImports(n.imports,a).then(()=>{this._reloadImports(),this.fire(new o.z(T?"style.load":"style.import.load"))}).catch(I=>{this.fire(new o.y(new Error("Failed to load imports",I))),this.fire(new o.z(T?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.z(T?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const g=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(g){const y=this._evaluateColorThemeData(g);this._loadColorTheme(y).then(()=>{h()}).catch(x=>{o.w(`Couldn't load color theme from the stylesheet: ${x}`),h()})}else this._styleColorTheme.lut=null,h()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,a,h,g,y,x,T,I,P,R;const F={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(D=>{if(D.stylesheet){if(D.light!=null&&(n=D.light),D.stylesheet.lights)for(const j of D.stylesheet.lights)j.type==="ambient"&&D.ambientLight!=null&&(a=D.ambientLight),j.type==="directional"&&D.directionalLight!=null&&(h=D.directionalLight);g=this._prioritizeTerrain(g,D.terrain,D.stylesheet.terrain),D.stylesheet.fog&&D.fog!=null&&(y=D.fog),D.stylesheet.snow&&D.snow!=null&&(x=D.snow),D.stylesheet.rain&&D.rain!=null&&(T=D.rain),D.stylesheet.camera!=null&&(R=D.stylesheet.camera),D.stylesheet.projection!=null&&(I=D.stylesheet.projection),D.stylesheet.transition!=null&&(P=D.stylesheet.transition),F[D.scope]=D._styleColorTheme}}),this.light=n,this.ambientLight=a,this.directionalLight=h,this.fog=y,this.snow=x,this.rain=T,this._styleColorThemeForScope=F,g===null?delete this.terrain:this.terrain=g,this.camera=R||{"camera-projection":"perspective"},this.projection=I||{name:"mercator"},this.transition=Object.assign({},uf,P),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const a=h=>{for(const g of h.fragments)a(g.style);n(h)};a(this)}_prioritizeTerrain(n,a,h){const g=n&&n.drapeRenderMode===0;return h===null?a&&a.drapeRenderMode===0?a:g?n:null:a!=null&&(!n||g||a&&a.drapeRenderMode===1)?a:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{n=this._prioritizeTerrain(n,a.terrain,a.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(n=a.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},a={},h={};this.forEachFragmentStyle(g=>{for(const y in g._sourceCaches){const x=o.B(y,g.scope);n[x]=g._sourceCaches[y]}for(const y in g._otherSourceCaches){const x=o.B(y,g.scope);a[x]=g._otherSourceCaches[y]}for(const y in g._symbolSourceCaches){const x=o.B(y,g.scope);h[x]=g._symbolSourceCaches[y]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=h}mergeLayers(){const n={},a=[],h={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(const T of x._order){const I=x._layers[T];if(I.type==="slot"){const P=o.dl(T);if(n[P])continue;n[P]=[]}I.slot&&n[I.slot]?n[I.slot].push(I):a.push(I)}}),this._mergedOrder=[];let g=-1;const y=(x=[])=>{for(const T of x)if(T.type==="slot"){const I=o.dl(T.id);n[I]&&y(n[I]),this._mergedSlots.push(I)}else{const I=o.B(T.id,T.scope);this._mergedOrder.push(I),h[I]=T,T.is3D(!!this.terrain)&&(this._has3DLayers=!0,g=this._mergedOrder.length-1),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0),T.type==="clip"&&(this._clipLayerPresent=!0)}};if(y(a),this._has3DLayers){const x={};for(let T=0;T<this._mergedOrder.length;++T){const I=this._mergedOrder[T];x[I]=T===g?1:T<g?h[I].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((T,I)=>x[T]-x[I])}this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?function(a,h,g,y){const x=Object.assign({},h);for(const I of Object.keys(o.a6.colorTheme))x[I]===void 0&&(x[I]=o.a6.colorTheme[I].default);const T=new o.a8(_v,a,new Map(g));return T.setTransitionOrValue(x,g),T.untransitioned().possiblyEvaluate(new o.ac(0,{worldview:void 0}))}(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((h,g)=>{const y="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();let x=n;x.startsWith(y)||(x=y+x);const T=o.I.from("mapbox-reserved-lut"),I=new Image;I.src=x,I.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},I.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void h();this._styleColorTheme.lutLoading=!1;const{width:P,height:R,data:F}=o.o.getImageData(I);if(R>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(P!==R*R)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(T)&&this.removeImage(T),this.addImage(T,{data:new o.q({width:P,height:R},F),pixelRatio:1,sdf:!1,usvg:!1,version:0});const D=this.imageManager.getImage(T,this.scope);D?(this._styleColorTheme.lut={image:D.data,data:n},h()):g(new Error("Missing LUT image."))}})}getLut(n){const a=this._styleColorThemeForScope[n];return a?a.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(a,h,g){let y,x,T;const I=o.o.devicePixelRatio>1?"@2x":"";let P=o.m(h.transformRequest(h.normalizeSpriteURL(a,I,".json"),o.R.SpriteJSON),(D,j)=>{P=null,T||(T=D,y=j,F())}),R=o.n(h.transformRequest(h.normalizeSpriteURL(a,I,".png"),o.R.SpriteImage),(D,j)=>{R=null,T||(T=D,x=j,F())});function F(){if(T)g(T);else if(y&&x){const D=o.o.getImageData(x),j={};for(const U in y){const{width:G,height:J,x:Z,y:ee,sdf:oe,pixelRatio:ue,stretchX:ye,stretchY:ge,content:ve}=y[U],_e=new o.q({width:G,height:J});o.q.copy(D,_e,{x:Z,y:ee},{x:0,y:0},{width:G,height:J},null),j[U]={data:_e,pixelRatio:ue!==void 0?ue:1,sdf:oe!==void 0&&oe,stretchX:ye,stretchY:ge,content:ve,usvg:!1,version:0}}g(null,j)}}return{cancel(){P&&(P.cancel(),P=null),R&&(R.cancel(),R=null)}}}(n,this.map._requestManager,(a,h)=>{if(this._spriteRequest=null,a)this.fire(new o.y(a));else if(h){const g=new Map;for(const y in h)g.set(o.I.from(y),h[y]);this.addImages(g)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))})}addIconset(n,a){if(a.type==="sprite")return void this._loadSprite(a.url);const h=this.getOwnSourceCache(a.source);if(!h)return void this.fire(new o.y(new Error(`Source "${a.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const g=h.getSource();if(g.type!=="raster-array")return void this.fire(new o.y(new Error(`Source "${a.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));g.partial=!1;const y=new dl(n,this.scope,h);this.imageManager.addImageProvider(y,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!o.h(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const a=this.map._spriteFormat==="auto";var h,g;this._spriteRequest=(g=(y,x)=>{if(this._spriteRequest=null,y)a?this._loadSprite(n):this.fire(new o.y(y));else if(x){const T=new Map;for(const I in x)T.set(o.I.from(I),x[I]);this.addImages(T)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))},o.bu((h=this.map._requestManager).transformRequest(h.normalizeIconsetURL(n),o.R.Iconset),(y,x)=>{if(y)return void g(y);const T={},I=o.dc(new o.bt(x));for(const P of I.icons){const R={version:1,pixelRatio:o.o.devicePixelRatio,content:af(P),stretchX:P.metadata?lf(P.metadata.stretch_x_areas):void 0,stretchY:P.metadata?lf(P.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:P};T[P.name]=R}g(null,T)}))}_validateLayer(n){const a=this.getOwnSource(n.source);if(!a)return;const h=n.sourceLayer;h&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(h)===-1)&&this.fire(new o.y(new Error(`Source layer "${h}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,a)=>{const h=this.fragments[a];return h&&h.style&&(n.data=h.style.serialize()),n})}_serializeSources(){const n={};for(const a in this._sourceCaches){const h=this._sourceCaches[a].getSource();n[h.id]||(n[h.id]=h.serialize())}return n}_serializeLayers(n){const a=[];for(const h of n){const g=this._layers[h];g&&g.type!=="custom"&&a.push(g.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const a=this.getOwnLayer(n);if(a)return a;this.fire(new o.y(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const a=this.getOwnSource(n);if(a)return a;this.fire(new o.y(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,a){const h=this.map.painter;if(h)for(let g=n.minzoom||0;g<(n.maxzoom||25.5);g++){const y=n.getProgramIds();if(y)for(const x of y){const T=n.getDefaultProgramParams(x,a.zoom,this._styleColorTheme.lut);T&&(h.style=this,this.fog&&(h._fogVisible=!0,T.overrideFog=!0,h.getOrCreateProgram(x,T)),h._fogVisible=!1,T.overrideFog=!1,h.getOrCreateProgram(x,T),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(T.overrideRtt=!0,h.getOrCreateProgram(x,T)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const a=this.calculateLightsBrightness();n.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const h=this._changes.isDirty();let g=!1;if(this._changes.isDirty()){const T=this._changes.getLayerUpdatesByScope();for(const I in T){const{updatedIds:P,removedIds:R}=T[I];(P||R)&&(this._updateWorkerLayers(I,P,R),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const y={};for(const T in this._mergedSourceCaches){const I=this._mergedSourceCaches[T];y[T]=I.used,I.used=!1,I.tileCoverLift=0}for(const T of this._mergedOrder){const I=this._mergedLayers[T];if(I.recalculate(n,this._availableImages),!I.isHidden(n.zoom)){const P=this.getLayerSourceCache(I);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,n)}):this.precompilePrograms(I,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();const x=this.imageManager.getPendingImageProviders();for(const T of x)T.sourceCache.used=!0;for(const T in y){const I=this._mergedSourceCaches[T];y[T]!==I.used&&I.getSource().fire(new o.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),h&&this.fire(new o.z("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const a of n){const h=a.resolvePendingRequests(),g=this.getFragmentStyle(a.scope);g&&g.addImages(h)}}_updateTilesForChangedImages(){const n={};for(const a in this._mergedSourceCaches){const h=this._mergedSourceCaches[a].getSource().scope;n[h]=n[h]||this._changes.getUpdatedImages(h),n[h].length!==0&&this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n[h])}for(const a in n)this._changes.resetUpdatedImages(a)}_updateWorkerLayers(n,a,h){const g=this.getFragmentStyle(n);g&&this.dispatcher.broadcast("updateLayers",{layers:a?g._serializeLayers(a):[],scope:n,removedIds:h||[],options:g.options})}setState(n,a){if(this._checkLoaded(),nc(this,Ns(n)))return!1;(n=o.dk(n)).layers=Zd(n.layers);const h=function(x,T){if(!x)return[{command:Nn.setStyle,args:[T]}];let I=[];try{if(!o.by(x.version,T.version))return[{command:Nn.setStyle,args:[T]}];if(o.by(x.center,T.center)||I.push({command:Nn.setCenter,args:[T.center]}),o.by(x.zoom,T.zoom)||I.push({command:Nn.setZoom,args:[T.zoom]}),o.by(x.bearing,T.bearing)||I.push({command:Nn.setBearing,args:[T.bearing]}),o.by(x.pitch,T.pitch)||I.push({command:Nn.setPitch,args:[T.pitch]}),o.by(x.sprite,T.sprite)||I.push({command:Nn.setSprite,args:[T.sprite]}),o.by(x.glyphs,T.glyphs)||I.push({command:Nn.setGlyphs,args:[T.glyphs]}),o.by(x.imports,T.imports)||function(j=[],U=[],G){U=U||[];const J=(j=j||[]).map(qc),Z=U.map(qc),ee=j.reduce(Th,{}),oe=U.reduce(Th,{}),ue=J.slice();let ye,ge,ve,_e;for(ye=0,ge=0;ye<J.length;ye++)ve=J[ye],oe.hasOwnProperty(ve)?ge++:(G.push({command:Nn.removeImport,args:[ve]}),ue.splice(ue.indexOf(ve,ge),1));for(ye=0,ge=0;ye<Z.length;ye++)ve=Z[Z.length-1-ye],ue[ue.length-1-ye]!==ve&&(ee.hasOwnProperty(ve)?(G.push({command:Nn.removeImport,args:[ve]}),ue.splice(ue.lastIndexOf(ve,ue.length-ge),1)):ge++,_e=ue[ue.length-ye],G.push({command:Nn.addImport,args:[oe[ve],_e]}),ue.splice(ue.length-ye,0,ve));for(const me of U){const xe=ee[me.id];xe&&(delete xe.data,o.by(xe,me)||G.push({command:Nn.updateImport,args:[me.id,me]}))}}(x.imports,T.imports,I),o.by(x.transition,T.transition)||I.push({command:Nn.setTransition,args:[T.transition]}),o.by(x.light,T.light)||I.push({command:Nn.setLight,args:[T.light]}),o.by(x.fog,T.fog)||I.push({command:Nn.setFog,args:[T.fog]}),o.by(x.snow,T.snow)||I.push({command:Nn.setSnow,args:[T.snow]}),o.by(x.rain,T.rain)||I.push({command:Nn.setRain,args:[T.rain]}),o.by(x.projection,T.projection)||I.push({command:Nn.setProjection,args:[T.projection]}),o.by(x.lights,T.lights)||I.push({command:Nn.setLights,args:[T.lights]}),o.by(x.camera,T.camera)||I.push({command:Nn.setCamera,args:[T.camera]}),o.by(x.iconsets,T.iconsets)||function(j,U,G){let J;for(J in U=U||{},j=j||{})j.hasOwnProperty(J)&&(U.hasOwnProperty(J)||G.push({command:Nn.removeIconset,args:[J]}));for(J in U){if(!U.hasOwnProperty(J))continue;const Z=U[J];j.hasOwnProperty(J)?o.by(j[J],Z)||(G.push({command:Nn.removeIconset,args:[J]}),G.push({command:Nn.addIconset,args:[J,Z]})):G.push({command:Nn.addIconset,args:[J,Z]})}}(x.iconsets,T.iconsets,I),!o.by(x["color-theme"],T["color-theme"]))return[{command:Nn.setStyle,args:[T]}];const P={},R=[];(function(j,U,G,J){let Z;for(Z in U=U||{},j=j||{})j.hasOwnProperty(Z)&&(U.hasOwnProperty(Z)||uv(Z,G,J));for(Z in U){if(!U.hasOwnProperty(Z))continue;const ee=U[Z];j.hasOwnProperty(Z)?o.by(j[Z],ee)||(j[Z].type==="geojson"&&ee.type==="geojson"&&Xd(j,U,Z)?G.push({command:Nn.setGeoJSONSourceData,args:[Z,ee.data]}):hv(Z,U,G,J)):Wc(Z,U,G)}})(x.sources,T.sources,R,P);const F=[];x.layers&&x.layers.forEach(j=>{j.source&&P[j.source]?I.push({command:Nn.removeLayer,args:[j.id]}):F.push(j)});let D=x.terrain;D&&P[D.source]&&(I.push({command:Nn.setTerrain,args:[void 0]}),D=void 0),I=I.concat(R),o.by(D,T.terrain)||I.push({command:Nn.setTerrain,args:[T.terrain]}),function(j,U,G){U=U||[];const J=(j=j||[]).map(qc),Z=U.map(qc),ee=j.reduce(Th,{}),oe=U.reduce(Th,{}),ue=J.slice(),ye=Object.create(null);let ge,ve,_e,me,xe,Ne,Re;for(ge=0,ve=0;ge<J.length;ge++)_e=J[ge],oe.hasOwnProperty(_e)?ve++:(G.push({command:Nn.removeLayer,args:[_e]}),ue.splice(ue.indexOf(_e,ve),1));for(ge=0,ve=0;ge<Z.length;ge++)_e=Z[Z.length-1-ge],ue[ue.length-1-ge]!==_e&&(ee.hasOwnProperty(_e)?(G.push({command:Nn.removeLayer,args:[_e]}),ue.splice(ue.lastIndexOf(_e,ue.length-ve),1)):ve++,Ne=ue[ue.length-ge],G.push({command:Nn.addLayer,args:[oe[_e],Ne]}),ue.splice(ue.length-ge,0,_e),ye[_e]=!0);for(ge=0;ge<Z.length;ge++)if(_e=Z[ge],me=ee[_e],xe=oe[_e],!ye[_e]&&!o.by(me,xe))if(o.by(me.source,xe.source)&&o.by(me["source-layer"],xe["source-layer"])&&o.by(me.type,xe.type)){for(Re in ll(me.layout,xe.layout,G,_e,null,Nn.setLayoutProperty),ll(me.paint,xe.paint,G,_e,null,Nn.setPaintProperty),o.by(me.slot,xe.slot)||G.push({command:Nn.setSlot,args:[_e,xe.slot]}),o.by(me.filter,xe.filter)||G.push({command:Nn.setFilter,args:[_e,xe.filter]}),o.by(me.minzoom,xe.minzoom)&&o.by(me.maxzoom,xe.maxzoom)||G.push({command:Nn.setLayerZoomRange,args:[_e,xe.minzoom,xe.maxzoom]}),me)me.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?ll(me[Re],xe[Re],G,_e,Re.slice(6),Nn.setPaintProperty):o.by(me[Re],xe[Re])||G.push({command:Nn.setLayerProperty,args:[_e,Re,xe[Re]]}));for(Re in xe)xe.hasOwnProperty(Re)&&!me.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?ll(me[Re],xe[Re],G,_e,Re.slice(6),Nn.setPaintProperty):o.by(me[Re],xe[Re])||G.push({command:Nn.setLayerProperty,args:[_e,Re,xe[Re]]}))}else G.push({command:Nn.removeLayer,args:[_e]}),Ne=ue[ue.lastIndexOf(_e)+1],G.push({command:Nn.addLayer,args:[xe,Ne]})}(F,T.layers,I)}catch(P){console.warn("Unable to compute style diff:",P),I=[{command:Nn.setStyle,args:[T]}]}return I}(this.serialize(),n).filter(x=>!(x.command in xw));if(h.length===0)return!1;const g=h.filter(x=>!(x.command in vw));if(g.length>0)throw new Error(`Unimplemented: ${g.map(x=>x.command).join(", ")}.`);const y=[];return h.forEach(x=>{y.push(this[x.command](...x.args))}),a&&Promise.all(y).then(a).catch(a),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){if(n.size===0)return this;for(const[a,h]of n.entries()){if(this.getImage(a))return this.fire(new o.y(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,h),this._changes.updateImage(a,this.scope)}return this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this}addImage(n,a){return this.getImage(n)?this.fire(new o.y(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,a),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this)}updateImage(n,a,h=!1){this.imageManager.updateImage(n,this.scope,a),h&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(n){return this.modelManager.addModelURLs(n,this.scope),this._updateWorkerModels(),this.fire(new o.z("data",{dataType:"style"})),this}addModel(n,a,h={}){return this._checkLoaded(),this._validate(Ae,`models.${n}`,a,null,h)||(this.modelManager.addModel(n,a,this.scope),this.fire(new o.z("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope,!1,!0),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,a,h={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(rl,`sources.${n}`,a,null,h))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const g=_h(n,a,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));const y=x=>{const T=(x?"symbol:":"other:")+g.id,I=o.B(T,this.scope),P=this._sourceCaches[T]=new oo(I,g,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=P,P.onAdd(this.map)};y(!1),a.type!=="vector"&&a.type!=="geojson"||y(!0),g.onAdd&&g.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const a=this.getOwnSource(n);if(!a)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===n)return this.fire(new o.y(new Error(`Source "${n}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new o.y(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const g=Object.entries(this.stylesheet.iconsets).find(([y,x])=>x.type==="source"&&x.source===n);if(g)return this.fire(new o.y(new Error(`Source "${n}" cannot be removed while iconset "${g[0]}" is using it.`)))}const h=this.getOwnSourceCaches(n);for(const g of h){const y=o.dl(g.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(g.id),g.fire(new o.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getOwnSource(n).setData(a),this._changes.setDirty()}getOwnSource(n){const a=this.getOwnSourceCache(n);return a&&a.getSource()}getOwnSources(){const n=[];for(const a in this._otherSourceCaches){const h=this.getOwnSourceCache(a);h&&n.push(h.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const a in n){const h=n[a]._tiles;for(const g in h){const y=h[g];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const y of n){if(this._validate(Kl,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const x=this.ambientLight;x.set(y),x.updateTransitions(a)}else this.ambientLight=new Kn(y,Zi||(Zi=new o.a9({color:new o.aa(o.a6.properties_light_ambient.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const x=this.directionalLight;x.set(y),x.updateTransitions(a)}else this.directionalLight=new Kn(y,cr||(cr=new o.a9({direction:new o.ap(o.a6.properties_light_directional.direction),color:new o.aa(o.a6.properties_light_directional.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_directional.intensity),"cast-shadows":new o.aa(o.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new o.aa(o.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.aa(o.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const h=Object.assign(a,{worldview:this.map.getWorldview()}),g=new o.ac(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,a=this.ambientLight;if(!n||!a)return;const h=D=>.2126*(D[0]<=.03928?D[0]/12.92:Math.pow((D[0]+.055)/1.055,2.4))+.7152*(D[1]<=.03928?D[1]/12.92:Math.pow((D[1]+.055)/1.055,2.4))+.0722*(D[2]<=.03928?D[2]/12.92:Math.pow((D[2]+.055)/1.055,2.4)),g=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=n.properties.get("intensity"),x=n.properties.get("direction"),T=1-o.d3(x.x,x.y,x.z)[2]/90,I=h(g)*y*T,P=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),R=a.properties.get("intensity"),F=h(P)*R;return Number(((I+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(o.dm(n)){const a=o.dn(n),h=this.fragments.find(({id:y})=>y===a);if(!h)return;const g=o.dl(n);return h.style.getFragmentStyle(g)}{const a=this.fragments.find(({id:h})=>h===n);return a?a.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const a={},h=(g,y="")=>`${g}::${y}`;this._featuresetSelectors={};for(const g in n){const y=this._featuresetSelectors[g]=[];for(const x of n[g].selectors){if(x.featureNamespace){const I=this.getOwnLayer(x.layer);if(!I){o.w(`Layer is undefined for selector: ${x.layer}`);continue}const P=h(I.source,I.sourceLayer);if(P in a&&a[P]!==x.featureNamespace){o.w(`"featureNamespace ${x.featureNamespace} of featureset ${g}'s selector is not associated to the same source, skip this selector`);continue}a[P]=x.featureNamespace}let T;if(x.properties)for(const I in x.properties){const P=o.U(x.properties[I]);P.result==="success"&&(T=T||{},T[I]=P.value)}y.push({layerId:x.layer,namespace:x.featureNamespace,properties:T,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const a=this.getFragmentStyle(n);if(!a||!a.stylesheet.featuresets)return[];const h=[];for(const g in a.stylesheet.featuresets)h.push({featuresetId:g,importId:a.scope?a.scope:void 0});return h}getFeaturesetLayers(n,a){const h=this.getFragmentStyle(a),g=h.stylesheet.featuresets;if(!g||!g[n])return this.fire(new o.y(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const y=[];for(const x of g[n].selectors){const T=h.getOwnLayer(x.layer);T&&y.push(T)}return y}getConfigProperty(n,a){const h=this.getFragmentStyle(n);if(!h)return null;const g=o.B(a,h.scope),y=h.options.get(g),x=y?y.value||y.default:null;return x?x.serialize():null}setConfigProperty(n,a,h){const g=this.getFragmentStyle(n);if(!g)return;const y=g.stylesheet.schema;if(!y||!y[a])return;const x=o.U(h);if(x.result!=="success")return void nc(this,x.value);const T=x.value.expression,I=o.B(a,g.scope),P=g.options.get(I);if(!P)return;let R;const{minValue:F,maxValue:D,stepValue:j,type:U,values:G}=y[a],J=o.U(y[a].default);J.result==="success"&&(R=J.value.expression),R?(this.options.set(I,Object.assign({},P,{value:T,default:R,minValue:F,maxValue:D,stepValue:j,type:U,values:G})),this.updateConfigDependencies(a)):this.fire(new o.y(new Error(`No schema defined for the config option "${a}" in the "${n}" fragment.`)))}getConfig(n){const a=this.getFragmentStyle(n);if(!a)return null;const h=a.stylesheet.schema;if(!h)return null;const g={};for(const y in h){const x=o.B(y,a.scope),T=a.options.get(x),I=T?T.value||T.default:null;g[y]=I?I.serialize():null}return g}setConfig(n,a){const h=this.getFragmentStyle(n);h&&(h.updateConfig(a,h.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const a=this.getFragmentStyle(n);return a?a.stylesheet.schema:null}setSchema(n,a){const h=this.getFragmentStyle(n);h&&(h.stylesheet.schema=a,h.updateConfig(h._config,a),this.updateConfigDependencies())}updateConfig(n,a){if(this._config=n,n||a)if(a)for(const h in a){let g,y;const x=o.U(a[h].default);if(x.result==="success"&&(g=x.value.expression),n&&n[h]!==void 0){const D=o.U(n[h]);D.result==="success"&&(y=D.value.expression)}const{minValue:T,maxValue:I,stepValue:P,type:R,values:F}=a[h];if(g){const D=o.B(h,this.scope);this.options.set(D,{default:g,value:y,minValue:T,maxValue:I,stepValue:P,type:R,values:F})}else this.fire(new o.y(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new o.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(n){for(const a of this._configDependentLayers){const h=this.getLayer(a);if(h){if(n&&!h.configDependencies.has(n))continue;h.possiblyEvaluateVisibility(),this._updateLayer(h)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(a=>{const h=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(h){const g=a._evaluateColorThemeData(h);(!a._styleColorTheme.lut&&g!==""||a._styleColorTheme.lut&&g!==a._styleColorTheme.lut.data)&&a.setColorTheme(h)}}),this._changes.setDirty()}addLayer(n,a,h={}){this._checkLoaded();const g=n.id;if(this._layers[g])return void this.fire(new o.y(new Error(`Layer with id "${g}" already exists on this map`)));let y;if(n.type==="custom"){if(nc(this,o.dp(n)))return;y=o.dq(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(g,n.source),n=o.dk(n),n=Object.assign(n,{source:g})),this._validate(De,`layers.${g}`,n,{arrayIndex:-1},h))return;y=o.dq(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:g}})}y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid);let x=this._order.length;if(a){const R=this._order.indexOf(a);if(R===-1)return void this.fire(new o.y(new Error(`Layer with id "${a}" does not exist on this map.`)));y.slot===this._layers[a].slot?x=R:o.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,g),this._layerOrderChanged=!0,this._layers[g]=y;const T=this.getOwnLayerSourceCache(y),I=!!this.directionalLight&&this.directionalLight.shadowsEnabled();T&&y.canCastShadows()&&I&&(T.castsShadows=!0);const P=this._changes.getRemovedLayer(y);if(P&&y.source&&T&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const R=o.B(y.source,y.scope);P.type!==y.type?this._changes.updateSourceCache(R,"clear"):(this._changes.updateSourceCache(R,"reload"),T.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(n,a){this._checkLoaded();const h=this._checkLayer(n);if(!h||n===a)return;const g=this._order.indexOf(n);this._order.splice(g,1);let y=this._order.length;if(a){const x=this._order.indexOf(a);if(x===-1)return void this.fire(new o.y(new Error(`Layer with id "${a}" does not exist on this map.`)));h.slot===this._layers[a].slot?y=x:o.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const a=this._checkLayer(n);if(!a)return;a.setEventedParent(null);const h=this._order.indexOf(n);this._order.splice(h,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const g=this.getOwnLayerSourceCache(a);if(g&&g.castsShadows){let y=!1;for(const x in this._layers)if(this._layers[x].source===a.source&&this._layers[x].canCastShadows()){y=!0;break}g.castsShadows=y}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,h){this._checkLoaded();const g=this._checkLayer(n);g&&(g.minzoom===a&&g.maxzoom===h||(a!=null&&(g.minzoom=a),h!=null&&(g.maxzoom=h),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,a){this._checkLoaded();const h=this._checkLayer(n);h&&h.slot!==a&&(h.slot=a,this._updateLayer(h))}setFilter(n,a,h={}){this._checkLoaded();const g=this._checkLayer(n);if(g&&!o.by(g.filter,a))return a==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(X,`layers.${g.id}.filter`,a,{layerType:g.type},h)||(g.filter=o.dk(a),this._updateLayer(g)))}getFilter(n){const a=this._checkLayer(n);if(a)return o.dk(a.filter)}setLayoutProperty(n,a,h,g={}){this._checkLoaded();const y=this._checkLayer(n);if(y&&!o.by(y.getLayoutProperty(a),h)){if(h!=null&&(!g||g.validate!==!1)&&nc(y,pe.call(Ns,{key:`layers.${n}.layout.${a}`,layerType:y.type,objectKey:a,value:h,styleSpec:o.a6,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(a,h),y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(n,a){const h=this._checkLayer(n);if(h)return h.getLayoutProperty(a)}setPaintProperty(n,a,h,g={}){this._checkLoaded();const y=this._checkLayer(n);if(!y||o.by(y.getPaintProperty(a),h)||h!=null&&(!g||g.validate!==!1)&&nc(y,te.call(Ns,{key:`layers.${n}.paint.${a}`,layerType:y.type,objectKey:a,value:h,styleSpec:o.a6})))return;const x=y.setPaintProperty(a,h);y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),x&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(n,a){const h=this._checkLayer(n);if(h)return h.getPaintProperty(a)}setFeatureState(n,a){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:I,importId:P}=n.target,R=this.getFragmentStyle(P),F=R.getFeaturesetLayers(I);for(const{source:D,sourceLayer:j}of F)R.setFeatureState({id:n.id,source:D,sourceLayer:j},a)}else if("layerId"in n.target){const{layerId:I}=n.target,P=this.getLayer(I);this.setFeatureState({id:n.id,source:P.source,sourceLayer:P.sourceLayer},a)}return}const h=n.source,g=n.sourceLayer,y=this._checkSource(h);if(!y)return;const x=y.type;if(x==="geojson"&&g)return void this.fire(new o.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!g)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided.")));const T=this.getOwnSourceCaches(h);for(const I of T)I.setFeatureState(g,n.id,a)}removeFeatureState(n,a){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:I,importId:P}=n.target,R=this.getFragmentStyle(P),F=R.getFeaturesetLayers(I);for(const{source:D,sourceLayer:j}of F)R.removeFeatureState({id:n.id,source:D,sourceLayer:j},a)}else if("layerId"in n.target){const{layerId:I}=n.target,P=this.getLayer(I);this.removeFeatureState({id:n.id,source:P.source,sourceLayer:P.sourceLayer},a)}return}const h=n.source,g=this._checkSource(h);if(!g)return;const y=g.type,x=y==="vector"?n.sourceLayer:void 0;if(y==="vector"&&!x)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new o.y(new Error("A feature id is required to remove its specific state property.")));const T=this.getOwnSourceCaches(h);for(const I of T)I.removeFeatureState(x,n.id,a)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let y;if("featuresetId"in n.target){const{featuresetId:x,importId:T}=n.target,I=this.getFragmentStyle(T),P=I.getFeaturesetLayers(x);for(const{source:R,sourceLayer:F}of P){const D=I.getFeatureState({id:n.id,source:R,sourceLayer:F});if(D&&!y)y=D;else if(!o.by(y,D))return void this.fire(new o.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:x}=n.target,T=this.getLayer(x);y=this.getFeatureState({id:n.id,source:T.source,sourceLayer:T.sourceLayer})}return y}const a=n.source,h=n.sourceLayer,g=this._checkSource(a);if(g){if(g.type!=="vector"||h)return n.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(h,n.id);this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),a=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return o.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateFilteredLayers(n){for(const a of Object.values(this._mergedLayers))n(a)&&this._updateLayer(a)}_updateLayer(n){this._changes.updateLayer(n);const a=this.getLayerSourceCache(n),h=o.B(n.source,n.scope),g=this._changes.getUpdatedSourceCaches();n.source&&!g[h]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),a.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=T=>this._mergedLayers[T].is3D(!!this.terrain),h=this.order,g={},y=[];for(let T=h.length-1;T>=0;T--){const I=h[T];if(a(I)){g[I]=T;for(const P of n){const R=P[I];if(R)for(const F of R)y.push(F)}}}y.sort((T,I)=>I.intersectionZ-T.intersectionZ);const x=[];for(let T=h.length-1;T>=0;T--){const I=h[T];if(a(I))for(let P=y.length-1;P>=0;P--){const R=y[P].feature;if(R.layer&&g[R.layer.id]<T)break;x.push(R),y.pop()}else for(const P of n){const R=P[I];if(R)for(const F of R)x.push(F.feature)}}return x}queryRasterValue(n,a,h){const g=this.getOwnSource(n);return g?g.type!=="raster-array"?(this.fire(new o.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):g.queryRasterArrayValue(a,h):(this.fire(new o.y(new Error(`Source with id "${n}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(n,a,h){let g;a&&!Array.isArray(a)&&a.filter&&(this._validate(X,"queryRenderedFeatures.filter",a.filter,null,a),g=o.b6(a.filter));const y={},x=R=>{if(cf.has(R.type))return;const F=this.getOwnLayerSourceCache(R),D=y[F.id]=y[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};R.is3D(!!this.terrain)&&(D.has3DLayers=!0),D.layers[R.fqid]=D.layers[R.fqid]||{styleLayer:R,targets:[]},D.layers[R.fqid].targets.push({filter:g})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new o.y(new Error("parameters.layers must be an Array."))),[];for(const R of a.layers){const F=this._layers[R];if(!F)return this.fire(new o.y(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];x(F)}}else for(const R in this._layers)x(this._layers[R]);const T=this._queryRenderedFeatures(n,y,h),I=this._flattenAndSortRenderedFeatures(T),P=[];for(const R of I)o.ds(R.layer.id)===this.scope&&P.push(R);return P}queryRenderedFeatureset(n,a,h){let g;a&&!Array.isArray(a)&&a.filter&&(this._validate(X,"queryRenderedFeatures.filter",a.filter,null,a),g=o.b6(a.filter));const y="mock",x=[];if(a&&a.target)x.push(Object.assign({},a,{targetId:y,filter:g}));else{const R=this.getFeaturesetDescriptors();for(const F of R)x.push({targetId:y,filter:g,target:F});for(const{style:F}of this.fragments){const D=F.getFeaturesetDescriptors();for(const j of D)x.push({targetId:y,filter:g,target:j})}}const T=this.queryRenderedTargets(n,x,h),I=[],P=new Set;for(const R of T)for(const F of R.variants[y])ol(F,R,P)||I.push(new o.dt(R,F));return I}queryRenderedTargets(n,a,h){const g={},y=(T,I,P,R)=>{const F=g[I.id]=g[I.id]||{sourceCache:I,layers:{},has3DLayers:!1};if(F.layers[T.fqid]=F.layers[T.fqid]||{styleLayer:T,targets:[]},T.is3D(!!this.terrain)&&(F.has3DLayers=!0),!R)return P.uniqueFeatureID=!1,void F.layers[T.fqid].targets.push(P);F.layers[T.fqid].targets.push(Object.assign({},P,{namespace:R.namespace,properties:R.properties,uniqueFeatureID:R.uniqueFeatureID}))};for(const T of a)if("featuresetId"in T.target){const{featuresetId:I,importId:P}=T.target,R=this.getFragmentStyle(P);if(!R||!R._featuresetSelectors)continue;const F=R._featuresetSelectors[I];if(!F){this.fire(new o.y(new Error(`The featureset '${I}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const D of F){const j=R.getOwnLayer(D.layerId);j&&!cf.has(j.type)&&y(j,R.getOwnLayerSourceCache(j),T,D)}}else if("layerId"in T.target){const{layerId:I}=T.target,P=this.getLayer(I);if(!P||cf.has(P.type))continue;y(P,this.getLayerSourceCache(P),T)}const x=this._queryRenderedFeatures(n,g,h);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(n,a,h){const g=[],y=!!this.map._showQueryGeometry,x=Hi.createFromScreenPoints(n,h);for(const T in a){const I=vh(x,a[T],this._availableImages,h,y);Object.keys(I).length&&g.push(I)}if(this.placement)for(const T in a){if(!a[T].sourceCache._onlySymbols)continue;const I=Lm(x.screenGeometry,a[T],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(I).length&&g.push(I)}return g}querySourceFeatures(n,a){const h=a&&a.filter;h&&this._validate(X,"querySourceFeatures.filter",h,null,a);let g=[];const y=this.getOwnSourceCaches(n);for(const x of y)g=g.concat(ca(x,a));return g}addSourceType(n,a,h){return Ao.getSourceType(n)?h(new Error(`A source type called "${n}" already exists.`)):(Ao.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,a,h={}){this._checkLoaded();const g=this.light.getLight();let y=!1;for(const T in n)if(!o.by(n[T],g[T])){y=!0;break}if(!y)return;const x=this._getTransitionParameters();this.light.setLight(n,a,h),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,a=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let h=n;const g=n.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof h.source=="object"){const T="terrain-dem-src";this.addSource(T,h.source),h=o.dk(h),h=Object.assign(h,{source:T})}const y=Object.assign({},h),x={};if(this.terrain&&g){y.source=this.terrain.get().source;const T=this.terrain?this.getFragmentStyle(this.terrain.scope):null;T&&(x.style=T.serialize())}if(this._validate(ct,"terrain",y,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&a!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,a),this.fire(new o.z("data",{dataType:"style"}))}else{const y=this.terrain,x=y.get();for(const T of Object.keys(o.a6.terrain))!h.hasOwnProperty(T)&&o.a6.terrain[T].default&&(h[T]=o.a6.terrain[T].default);for(const T in n)if(!o.by(n[T],x[T])){y.set(n,this.options),this.stylesheet.terrain=n;const I=this._getTransitionParameters({duration:0});y.updateTransitions(I),this.fire(new o.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new On(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}_createSnow(n){const a=this.snow=new ur(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}_createRain(n){const a=this.rain=new fi(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!o.by(a.get(),n)){a.set(n,this.options),this.stylesheet.fog=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!o.by(a.get(),n)){a.set(n,this.options),this.stylesheet.snow=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!o.by(a.get(),n)){a.set(n,this.options),this.stylesheet.rain=a.get();const h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(const g in this._sourceCaches)this._sourceCaches[g].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void n();const h=this._evaluateColorThemeData(a);this._loadColorTheme(h).then(()=>{this.fire(new o.z("colorthemeset")),n()}).catch(g=>{o.w(`Couldn't set color theme: ${g}`)})}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,a){const h=this.getFragmentStyle(n);h&&(h._styleColorTheme.colorThemeOverride=a,h._reloadColorTheme())}_getTransitionParameters(n){return{now:o.o.now(),transition:Object.assign(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],a=[];for(const h of this._mergedOrder)this.isLayerDraped(this._mergedLayers[h])?n.push(h):a.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const h=this.terrain=new He(n,a,this.scope,this.options,this.map.getWorldview());a===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,h,g,y={}){if(y&&y.validate===!1)return!1;const x=Object.assign({},this.serialize());return nc(this,n.call(Ns,Object.assign({key:a,style:x,value:h,styleSpec:o.a6},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const a=this.getSourceCaches(n);for(const h of a)h.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}clearLayers(){for(const n in this._mergedLayers){const a=this._mergedLayers[n];a._clear&&a._clear()}}reloadSource(n){const a=this.getSourceCaches(n);for(const h of a)h.resume(),h.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(n=>{n.modelManager.reloadModels(n.scope)})}updateSources(n){let a;this.directionalLight&&(a=Yc(this.directionalLight));const h=new Set;for(const g in this._mergedLayers){const y=this._mergedLayers[g];y.hasElevation()&&!h.has(y.source)&&h.add(y.source)}for(const g in this._mergedSourceCaches){const y=this._mergedSourceCaches[g],x=h.has(y._source.id);y.update(n,void 0,void 0,a,x)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,h,g,y,x,T=!1){let I=!1,P=!1;const R={},F={};for(const D of this._mergedOrder){const j=this._mergedLayers[D];if(j.type!=="symbol")continue;const U=o.B(j.source,j.scope);let G=R[U];if(!G){const Z=this.getLayerSourceCache(j);if(!Z)continue;const ee=Z.getRenderableIds(!0).map(oe=>Z.getTileByID(oe));F[U]=ee.slice(),G=R[U]=ee.sort((oe,ue)=>ue.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(ue.tileID)?-1:1))}const J=this.crossTileSymbolIndex.addLayer(j,G,a.center.lng,a.projection);I=I||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),T=T||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new o.z("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.o.now(),a.zoom))&&(this.pauseablePlacement=new ys(a,this._mergedOrder,T,h,g,y,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,R,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.o.now()),P=!0),I&&this.pauseablePlacement.placement.setStale()),P||I){this._buildingIndex.onNewFrame(a.zoom);for(let D=0;D<this._mergedOrder.length;D++){const j=this._mergedLayers[this._mergedOrder[D]];if(j.type!=="symbol")continue;const U=this.isLayerClipped(j);this.placement.updateLayerOpacities(j,R[o.B(j.source,j.scope)],D,U?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.o.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,a){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex(({id:y})=>y===n.id)!==-1)return void this.fire(new o.y(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!a)return h.push(n),this._loadImports([n],!0);const g=h.findIndex(({id:y})=>y===a);return g===-1&&this.fire(new o.y(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=h.slice(0,g).concat(n).concat(h.slice(g)),this._loadImports([n],!0,a)}updateImport(n,a){this._checkLoaded();const h=this.stylesheet.imports||[],g=this.getImportIndex(n);return g===-1?this:typeof a=="string"?(this.setImportUrl(n,a),this):(a.url&&a.url!==h[g].url&&this.setImportUrl(n,a.url),o.by(a.config,h[g].config)||this.setImportConfig(n,a.config,a.data.schema),o.by(a.data,h[g].data)||this.setImportData(n,a.data),this)}moveImport(n,a){this._checkLoaded();let h=this.stylesheet.imports||[];const g=this.getImportIndex(n);if(g===-1)return this;const y=this.getImportIndex(a);if(y===-1)return this;const x=h[g],T=this.fragments[g];return h=h.filter(({id:I})=>I!==n),this.fragments=this.fragments.filter(({id:I})=>I!==n),this.stylesheet.imports=h.slice(0,y).concat(x).concat(h.slice(y)),this.fragments=this.fragments.slice(0,y).concat(T).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(n,a){this._checkLoaded();const h=this.stylesheet.imports||[],g=this.getImportIndex(n);if(g===-1)return this;h[g].url=a;const y=this.fragments[g];return y.style=this._createFragmentStyle(h[g]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(a),this}setImportData(n,a){this._checkLoaded();const h=this.getImportIndex(n),g=this.stylesheet.imports||[];return h===-1?this:a?(this.fragments[h].style.setState(a),this._reloadImports(),this):(delete g[h].data,this.setImportUrl(n,g[h].url))}setImportConfig(n,a,h){this._checkLoaded();const g=this.getImportIndex(n),y=this.stylesheet.imports||[];if(g===-1)return this;a?y[g].config=a:delete y[g].config;const x=this.fragments[g];h&&x.style.stylesheet&&(x.style.stylesheet.schema=h);const T=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=a,x.style.updateConfig(a,T),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const a=this.stylesheet.imports||[],h=this.getImportIndex(n);h!==-1&&(a.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports())}getImportIndex(n){const a=(this.stylesheet.imports||[]).findIndex(h=>h.id===n);return a===-1&&this.fire(new o.y(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),a}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const a in this._mergedOtherSourceCaches){const h=this._mergedOtherSourceCaches[a];h&&n.push(h.getSource())}return n}getSource(n,a){const h=this.getSourceCache(n,a);return h&&h.getSource()}getLayerSource(n){const a=this.getLayerSourceCache(n);return a&&a.getSource()}getSourceCache(n,a){const h=o.B(n,a);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(n){const a=o.B(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[n]&&a.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&a.push(this._mergedSymbolSourceCaches[n]),a}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const a in n){const h=n[a];h==="reload"?this.reloadSource(a):h==="clear"&&this.clearSource(a)}}updateLayers(n){const a=this._changes.getUpdatedPaintProperties();for(const h of a){const g=this.getLayer(h);g&&g.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n)}getImages(n,a,h){this.imageManager.getImages(a.images,a.scope,h),this._updateTilesForChangedImages();const g=x=>{if(x){const T=a.images.map(I=>o.I.toString(I));x.setDependencies(a.tileID.key,a.type,T)}},y=o.B(a.source,a.scope);g(this._mergedOtherSourceCaches[y]),g(this._mergedSymbolSourceCaches[y]),a.images.some(x=>x.iconsetId)&&this.fire(new o.z("data",{dataType:"style"}))}rasterizeImages(n,a,h){this.imageManager.rasterizeImages(a,h)}getGlyphs(n,a,h){this.glyphManager.getGlyphs(a.stacks,h)}getResource(n,a,h){return o.dv(a,h)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this.getOwnSourceCaches(n);return a.length===0?(this.fire(new o.y(new Error(`There is no source with ID '${n}'`))),!1):a.every(h=>h.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,a){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const h=n.type==="fill-extrusion"&&(n.sourceLayer==="building"||n.sourceLayer==="procedural_buildings"),g=n.type==="building";if(n.is3D(!!this.terrain)){if(h||g||a&&a.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ao.getSourceType=function(d){return Gc[d]},Ao.setSourceType=function(d,n){Gc[d]=n},Ao.registerForPluginStateChange=o.dw;class vv{execute(n){const a=this._makeBuildingsQueryArea(n),h=this._makeFloorsQueryArea(n),g=n.queryRenderedFeatures(a).reduce((P,R)=>{const F=R.properties.id;return R.properties.type!=="building"||P.some(D=>D.properties.id===F)||P.push(R),P},[]),y=n.queryRenderedFeatures(h).reduce((P,R)=>{const F=R.properties.id;return R.properties.type!=="floor"||P.some(D=>D.properties.id===F)||P.push(R),P},[]),x=[n.getCenter().lng,n.getCenter().lat],T=this._findBuildingAtCenter(x,g),I=g.length>0?g[0]:null;return{floors:y.map(P=>({id:P.properties.id,name:P.properties.name,isDefault:P.properties.is_default,zIndex:P.properties.z_index,connectedFloorIds:P.properties.connected_floor_ids,conflictedFloorIds:P.properties.conflicted_floor_ids,buildingIds:P.properties.building_ids})),building:T?{id:T.properties.id,name:T.properties.name}:{id:I.properties.id,name:I.properties.name}}}_makeBuildingsQueryArea(n){const a=n.transform.width,h=n.transform.height,g=Math.min(a,h)*(1/8),y=.5*(a-g),x=.5*(h-g);return[new o.P(y,x),new o.P(y+g,x+g)]}_makeFloorsQueryArea(n){const a=n.transform.width,h=n.transform.height;return[new o.P(0,0),new o.P(a,h)]}_findBuildingAtCenter(n,a){for(const h of a)if(h.geometry.type==="Polygon"&&this._pointInPolygon(n,h.geometry.coordinates[0]))return h;return null}_pointInPolygon(n,a){let h=!1;for(let g=0,y=a.length-1;g<a.length;y=g++){const x=a[g][0],T=a[g][1],I=a[y][1];T>n[1]!=I>n[1]&&n[0]<(a[y][0]-x)*(n[1]-T)/(I-T)+x&&(h=!h)}return h}}class xv{constructor(){this._floors=new Map,this._buildings=new Map}append(n){const a=n.building;let h=!1;if(a){const g=a.id;g&&(this._buildings.set(g,a),h||this._buildings.has(g)||(h=!0))}return n.floors.forEach(g=>{const y=g.id;h||this._floors.has(y)||(h=!0),this._floors.set(y,g)}),h}clear(){this._floors.clear(),this._buildings.clear()}getFloors(n=null){const a=Array.from(this._floors.values());return n?a.filter(h=>{const g=h.buildingIds;return!!g&&g.split(";").includes(n)}):a}}class wv{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new xv}setIndoorData(n){const a=this._featuresStorage.append(n);return this._selectedBuildingId=n.building?n.building.id:null,a}setFloorId(n){const a=this._selectedFloorId!==n;return a&&(this._selectedFloorId=n),a}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const n=this._featuresStorage.getFloors(this._selectedBuildingId),a=this.getActiveFloors().find(h=>{const g=h.buildingIds;if(!g)return!1;const y=g.split(";");return!!this._selectedBuildingId&&y.includes(this._selectedBuildingId)});return{selectedFloorId:a?a.id:null,floors:n}}getActiveFloors(n=!1){const a=this._featuresStorage.getFloors(),h=a.find(I=>I.id===this._selectedFloorId),g=a.filter(I=>I.isDefault===!0);let y=[];if(h)return y=this._calculateCurrentActiveFloors(a,h,g,n),y;if(g.length===0){const I=this._featuresStorage.getFloors(this._selectedBuildingId);y=I.length>0?[I[0]]:[]}else y=g;const x=this._getNonConflictingLastActiveFloors(y),T=[...y,...x];return this._lastActiveFloors=T,T}hasBuildingChanged(n){return this._selectedBuildingId!==(n.building?n.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(n,a,h,g){if(!a)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,h);const y=this._getConnectedFloors(a,n);return g?this._buildExplicitSelectionFloors(a,y,h):this._buildImplicitSelectionFloors(y,h)}_getConnectedFloors(n,a){const h=n.connectedFloorIds;if(!h)return[];const g=new Set(h.split(";"));return a.filter(y=>g.has(y.id))}_buildExplicitSelectionFloors(n,a,h){const g=[n,...a],y=this._getNonConflictingLastActiveFloors(g),x=[...g,...y],T=this._deduplicateFloors(x),I=this._getConflictingFloorIdsFrom(T),P=h.filter(F=>!I.has(F.id)),R=[...T,...P];return this._lastActiveFloors=R,R}_buildImplicitSelectionFloors(n,a){const h=this._getConflictingFloorIdsFrom(this._lastActiveFloors),g=a.filter(x=>!h.has(x.id)),y=this._deduplicateFloors([...this._lastActiveFloors,...g]);return this._lastActiveFloors=y,y}_getNonConflictingDefaultFloors(n,a){const h=this._getConflictingFloorIdsFrom(n),g=a.filter(x=>!h.has(x.id)),y=this._deduplicateFloors([...n,...g]);return this._lastActiveFloors=y,y}_deduplicateFloors(n){const a=new Set;return n.filter(h=>{const g=h.id;return!a.has(g)&&(a.add(g),!0)})}_getConflictingFloorIdsFrom(n){const a=new Set;return n.forEach(h=>{const g=h.conflictedFloorIds;g&&g.split(";").forEach(y=>a.add(y))}),a}_getNonConflictingLastActiveFloors(n){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const a=new Set(n.map(g=>g.id)),h=this._getConflictingFloorIdsFrom(n);return this._lastActiveFloors.filter(g=>{const y=g.id;return!a.has(y)&&!h.has(y)})}_isFloorConflicted(n,a){const h=n.id;return a.some(g=>{const y=g.conflictedFloorIds;return!!y&&y.split(";").includes(h)})}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class ic extends o.E{constructor(n){super(),o.aY(["_onLoad","_onMove"],this),this._map=n,this._floorSelectionState=new wv,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(n){this._floorSelectionState.setFloorId(n)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle(n=>{n.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new o.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=n.scope,this._indoorDataQuery=new vv))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const n=this._indoorDataQuery.execute(this._map);if(!n||n.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(n)){if(!n.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(n),n.building&&this._updateIndoorSelector()}else this._setIndoorData(n)}_setIndoorData(n){this._floorSelectionState.setIndoorData(n)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const n=this._floorSelectionState.getCurrentBuildingSelection(),a=n.floors.map(h=>({id:h.id,name:h.name,shortName:h.zIndex.toString(),levelOrder:h.zIndex}));this.fire(new o.z("indoorupdate",{selectedFloorId:n.selectedFloorId,floors:a}))}_updateIndoorConfig(n=!1){const a=this._floorSelectionState.getActiveFloors(n).map(h=>h.id)||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",a])}}var Dh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Zm=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Xm=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Qc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",eu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Km=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,hf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,uo=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,df=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,vt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Ym=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const tu=[];Co(Dh,tu),Co(Xm,tu),Co(Zm,tu);const nu={"_prelude_fog.vertex.glsl":Km,"_prelude_terrain.vertex.glsl":eu,"_prelude_shadow.vertex.glsl":vt,"_prelude_fog.fragment.glsl":hf,"_prelude_shadow.fragment.glsl":Ym,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":uo,"_prelude_raster_particle.glsl":df},Lh={};Ln("",eu),Ln(hf,Km),Ln(Ym,vt),Ln(uo,""),Ln(df,"");const zh=Ln(Zm,Xm),ha=Dh;var ff={background:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Ln(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Ln(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ln("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ln(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ln(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ln("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ln("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ln("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ln(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ln(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ln(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ln(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ln(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ln(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ln("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ln("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ln(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ln(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ln("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ln(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Qc),skyboxGradient:Ln(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Qc),skyboxCapture:Ln(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ln(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ln(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ln(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ln("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ln("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ln("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ln("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Co(d,n){const a=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of a)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=h.split(" ");for(const y of g)n.includes(y)||n.push(y)}}function Ln(d,n){const a=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,g={},y=[],x=[];if(d=d.replace(a,(I,P)=>(x.push(P),"")),(n=n.replace(a,(I,P)=>(y.push(P),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let T=[...tu];Co(d,T),Co(n,T);for(const I of[...y,...x])nu[I]||console.error(`Undefined include: ${I}`),Lh[I]||(Lh[I]=[],Co(nu[I],Lh[I])),T=[...T,...Lh[I]];return{fragmentSource:d=d.replace(h,(I,P,R,F,D)=>(g[D]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${D}
in ${R} ${F} ${D};
#else
uniform ${R} ${F} u_${D};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${D}
    ${R} ${F} ${D} = u_${D};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${D}
    in ${R} ${F} ${D};
#endif
`:P==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(h,(I,P,R,F,D)=>{const j=F==="float"?"vec2":F,U=D.match(/color/)?"color":j;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${D}
in ${R} ${F} a_${D};
#endif
`:g[D]?P==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${R} ${j} a_${D};
out ${R} ${F} ${D};
#else
uniform ${R} ${F} u_${D};
#endif
`:P==="initialize"?U==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${R} ${F} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${U}(a_${D}, u_${D}_t);
#else
    ${R} ${F} ${D} = u_${D};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${D}
    in ${R} ${F} a_${D};
    out ${R} ${F} ${D};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${D}
    ${D} = a_${D};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${R} ${j} a_${D};
#else
uniform ${R} ${F} u_${D};
#endif
`:P==="define-instanced"?U==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${D}0;
in vec4 a_${D}1;
in vec4 a_${D}2;
in vec4 a_${D}3;
#else
uniform ${R} ${F} u_${D};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${R} ${j} a_${D};
#else
uniform ${R} ${F} u_${D};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${D}
    ${R} ${F} ${D} = a_${D};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${R} ${F} ${D} = a_${D};
#else
    ${R} ${F} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${R} ${F} ${D} = unpack_mix_${U}(a_${D}, u_${D}_t);
#else
    ${R} ${F} ${D} = u_${D};
#endif
`}),usedDefines:T,vertexIncludes:y,fragmentIncludes:x}}class iu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,h,g,y,x,T,I){this.context=n;let P=this.boundPaintVertexBuffers.length!==g.length;for(let F=0;!P&&F<g.length;F++)this.boundPaintVertexBuffers[F]!==g[F]&&(P=!0);let R=this.boundDynamicVertexBuffers.length!==T.length;for(let F=0;!R&&F<T.length;F++)this.boundDynamicVertexBuffers[F]!==T[F]&&(R=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==h||P||R||this.boundIndexBuffer!==y||this.boundVertexOffset!==x)this.freshBind(a,h,g,y,x,T,I);else{n.bindVertexArrayOES.set(this.vao);for(const F of T)F&&(F.bind(),I&&F.instanceCount&&F.setVertexAttribDivisor(n.gl,a,I));y&&y.dynamicDraw&&y.bind()}}freshBind(n,a,h,g,y,x,T){const I=this.context,P=I.gl;this.vao&&this.destroy(),this.vao=I.gl.createVertexArray(),I.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=x,a.enableAttributes(P,n),a.bind(),a.setVertexAttribPointers(P,n,y);for(const R of h)R.enableAttributes(P,n),R.bind(),R.setVertexAttribPointers(P,n,y);for(const R of x)R&&(R.enableAttributes(P,n),R.bind(),R.setVertexAttribPointers(P,n,y),T&&R.instanceCount&&R.setVertexAttribDivisor(P,n,T));g&&g.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ww(d,n){const a=Math.pow(2,n.canonical.z),h=n.canonical.y;return[new o.ae(0,h/a).toLngLat().lat,new o.ae(0,(h+1)/a).toLngLat().lat]}function bw(d,n,a,h,g,y,x){const T=d.context,I=T.gl,P=a.hillshadeFBO;if(!P)return;d.prepareDrawTile();const R=d.isTileAffectedByFog(n),F=d.getOrCreateProgram("hillshade",{overrideFog:R});T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,P.colorAttachment.get());const D=((J,Z,ee,oe)=>{const ue=ee.paint.get("hillshade-shadow-color"),ye=ee.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ge=ee.paint.get("hillshade-highlight-color"),ve=ee.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",_e=ee.paint.get("hillshade-accent-color"),me=ee.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",xe=ee.paint.get("hillshade-emissive-strength");let Ne=o.an(ee.paint.get("hillshade-illumination-direction"));if(ee.paint.get("hillshade-illumination-anchor")==="viewport")Ne-=J.transform.angle;else if(J.style&&J.style.enable3dLights()&&J.style.directionalLight){const qe=J.style.directionalLight.properties.get("direction"),Oe=o.d3(qe.x,qe.y,qe.z);Ne=o.an(Oe[1])}const Re=!J.options.moving;return{u_matrix:oe||J.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),Re),u_image:0,u_latrange:ww(0,Z.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),Ne],u_shadow:ue.toPremultipliedRenderColor(ye?null:ee.lut),u_highlight:ge.toPremultipliedRenderColor(ve?null:ee.lut),u_emissive_strength:xe,u_accent:_e.toPremultipliedRenderColor(me?null:ee.lut)}})(d,a,h,d.terrain?n.projMatrix:null);d.uploadCommonUniforms(T,F,n.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:U,tileBoundsSegments:G}=d.getTileBoundsBuffers(a);F.draw(d,I.TRIANGLES,g,y,x,nn.disabled,D,h.id,j,U,G)}function pf(d,n,a){if(!n.needsDEMTextureUpload)return;const h=d.context,g=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||d.getTileTexture(a.stride);const y=a.getPixels();n.demTexture?n.demTexture.update(y,{premultiply:!1}):n.demTexture=new o.T(h,y,g.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Tw(d,n,a){const h=d.context,g=h.gl;if(!n.dem)return;const y=n.dem;if(h.activeTexture.set(g.TEXTURE1),pf(d,n,y),!n.demTexture)return;n.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);const x=y.dim;h.activeTexture.set(g.TEXTURE0);let T=n.hillshadeFBO;if(!T){const D=new o.T(h,{width:x,height:x,data:null},g.RGBA8);D.bind(g.LINEAR,g.CLAMP_TO_EDGE),T=n.hillshadeFBO=h.createFramebuffer(x,x,!0,"renderbuffer"),T.colorAttachment.set(D.texture)}h.bindFramebuffer.set(T.framebuffer),h.viewport.set([0,0,x,x]);const{tileBoundsBuffer:I,tileBoundsIndexBuffer:P,tileBoundsSegments:R}=d.getMercatorTileBoundsBuffers(),F=[];d.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(d,g.TRIANGLES,Ct.disabled,Jt.disabled,yn.unblended,nn.disabled,((D,j)=>{const U=j.stride,G=o.bC();return o.cd(G,0,o.al,-o.al,0,0,1),o.br(G,G,[0,-o.al,0]),{u_matrix:G,u_image:1,u_dimension:[U,U],u_zoom:D.overscaledZ}})(n.tileID,y),a.id,I,P,R),n.needsHillshadePrepare=!1}class zi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class bv extends zi{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Jm extends zi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Sw extends zi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Ew extends zi{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Iw extends zi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Aw extends zi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Tv extends zi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Cw extends zi{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class mf extends zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class Pw extends zi{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Sv extends zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class Qm extends zi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class gf extends zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class eg extends zi{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class rc extends zi{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class ru extends zi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class _f extends zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class yf extends zi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class su extends zi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Ev=class extends zi{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class tg extends zi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Iv extends zi{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ou extends zi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class vf extends zi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class xf extends zi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class ng extends zi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class wf extends zi{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Oh extends zi{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class Av extends zi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Cv extends zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Pv extends zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class fl extends zi{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class Mv extends fl{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Rv extends fl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Mw extends fl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Rw extends Rv{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const ig=(d,n,a)=>({u_matrix:d,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:a}),bf=(d,n,a,h,g,y,x,T,I,P,R,F,D,j,U,G)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:a,u_zoom_transition:g,u_merc_center:y,u_image0:0,u_frustum_tl:x,u_frustum_tr:T,u_frustum_br:I,u_frustum_bl:P,u_globe_pos:R,u_globe_radius:F,u_viewport:D,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:U});function Tf(d,n){return d!=null&&n!=null&&!(!d.hasData()||!n.hasData())&&d.demTexture!=null&&n.demTexture!=null&&d.tileID.key!==n.tileID.key}const pl=new class{constructor(){this.operations={}}newMorphing(d,n,a,h,g){if(d in this.operations){const y=this.operations[d];y.to.tileID.key!==a.tileID.key&&(y.queued=a)}else this.operations[d]={startTime:h,phase:0,duration:g,from:n,to:a,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const n=this.operations[d];return{from:n.from,to:n.to,phase:n.phase}}update(d){for(const n in this.operations){const a=this.operations[n];for(a.phase=(d-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,d)){delete this.operations[n];break}}}_nextOp(d,n){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=n,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},rg={0:null,1:"TERRAIN_VERTEX_MORPHING"};function sg(d,n,a){if(n===0)return 0;const h=n<1&&a===514?.25/n:1;return 6*Math.pow(1.5,22-d)*Math.max(n,1)*h}function kw(d,n){const a=1<<d.z;return!n&&(d.x===0||d.x===a-1)||d.y===0||d.y===a-1}const sc=d=>({u_matrix:d});function oc(d,n,a,h,g){if(g>0){const y=o.o.now(),x=(y-d.timeAdded)/g,T=n?(y-n.timeAdded)/g:-1,I=a.getSource(),P=h.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),R=!n||Math.abs(n.tileID.overscaledZ-P)>Math.abs(d.tileID.overscaledZ-P),F=R&&d.refreshedUponExpiration?1:o.aA(R?x:1-T,0,1);return n?{opacity:1,mix:1-F,isFading:x<1}:{opacity:F,mix:0,isFading:x<1}}return{opacity:1,mix:0,isFading:!1}}class kv extends oo{constructor(n){const a=_h("mock-dem",{type:"raster-dem",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class ho extends oo{constructor(n){const a=_h("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,h){if(n.freezeTileCoverage)return;this.transform=n;const g=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,x)=>{if(y[x.key]="",!this._tiles[x.key]){const T=new al(x,this._source.tileSize*x.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);T.state="loaded",this._tiles[x.key]=T}return y},{});for(const y in this._tiles)y in g||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(n){const a=this.proxyCachedFBO[n];if(a!==void 0){const h=Object.values(a);this.renderCachePool.push(...h),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Sf extends o.aO{constructor(n,a,h){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=h}}class Fh extends o.dH{constructor(n,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,g,y]=function(I){const P=new o.bd,R=new o.b1,F=131;P.reserve(17161),R.reserve(33800);const D=o.al/128,j=o.al+D/2,U=j+D;for(let J=-D;J<U;J+=D)for(let Z=-D;Z<U;Z+=D){const ee=Z<0||Z>j||J<0||J>j?24575:0,oe=o.aA(Math.round(Z),0,o.al),ue=o.aA(Math.round(J),0,o.al);P.emplaceBack(oe+ee,ue)}const G=(J,Z)=>{const ee=Z*F+J;R.emplaceBack(ee+1,ee,ee+F),R.emplaceBack(ee+F,ee+F+1,ee+1)};for(let J=1;J<129;J++)for(let Z=1;Z<129;Z++)G(Z,J);return[0,129].forEach(J=>{for(let Z=0;Z<130;Z++)G(Z,J),G(J,Z)}),[P,R,32768]}(),x=n.context;this.gridBuffer=x.createVertexBuffer(h,o.bf.members),this.gridIndexBuffer=x.createIndexBuffer(g),this.gridSegments=o.bg.simpleSegment(0,0,h.length,g.length),this.gridNoSkirtSegments=o.bg.simpleSegment(0,0,h.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ho(a.map),this.orthoMatrix=o.bC(),o.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.al,0,o.al,0,1);const T=x.gl;this._overlapStencilMode=new Jt({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new kv(a.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,a,h){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const g=n.terrain.properties,y=n.terrain.drapeRenderMode===0,x=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.o.now();const T=n.terrain&&n.terrain.scope,I=g.get("source"),P=y?this._mockSourceCache:n.getSourceCache(I,T);if(!P)return void o.w(`Couldn't find terrain source "${I}".`);if(this.sourceCache=P,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(a):g.get("exaggeration"),!a.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;const R=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(a,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,R(),this._initializing=!0),R(),a.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const a=this._previousCameraAltitude,h=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=h;const g=a!=null?h-a:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;const y=n.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(y);let T=y-this._previousZoom;const I=this._previousUpdateTimestamp;let P=y;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(y-P)>.5&&(T=.5*(y-P+T)),T*g<0&&(P+=T)),this._evaluationZoom=P;const R=x.getExaggeration(P),F=R===x.getExaggeration(Math.max(0,P-.1));if(F&&Math.abs(R-this._exaggeration)<.01)return R;let D=Math.min(.1,.00375*(this._updateTimestamp-I));return(F||R<.1||Math.abs(T)<1e-4)&&(D=Math.min(.2,4*D)),o.ak(this._exaggeration,R,D)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.dataType==="source"&&n.coord?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(o.ae.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=a.getIds().map(I=>{const P=a.getTileByID(I).tileID;return P.projMatrix=h.calculateProjMatrix(P.toUnwrapped()),P});(function(I,P){const R=P.transform.pointCoordinate(P.transform.getCameraPoint()),F=new o.P(R.x,R.y);I.sort((D,j)=>{if(j.overscaledZ-D.overscaledZ)return j.overscaledZ-D.overscaledZ;const U=new o.P(D.canonical.x+(1<<D.canonical.z)*D.wrap,D.canonical.y),G=new o.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),J=F.mult(1<<D.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(U)-J.distSqr(G)})})(g,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},g.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const x=this._style._mergedSourceCaches;for(const I in x){const P=x[I];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,n[I],y),P.usedForTerrain))continue;const R=n[I];P.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[a.id]=g.map(I=>new Sf(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const T={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const P=this.terrainTileForTile[I.key];if(!P)continue;const R=P.tileID.key;R in T||(this._visibleDemTiles.push(P),T[R]=R)}}_assignTerrainTiles(n){this._initializing||n.forEach(a=>{if(this.terrainTileForTile[a.key])return;const h=this._findTileCoveringTileID(a,this.sourceCache);h&&(this.terrainTileForTile[a.key]=h)})}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const h in this.terrainTileForTile){const g=this.terrainTileForTile[h],y=g.dem;!y||g.demTexture&&!g.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),pf(this.painter,g,y))}}_prepareDemTileUniforms(n,a,h,g){if(!a||a.demTexture==null)return!1;const y=n.tileID.canonical,x=Math.pow(2,a.tileID.canonical.z-y.z),T=g||"";return h[`u_dem_tl${T}`]=[y.x*x%1,y.y*x%1],h[`u_dem_scale${T}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const a=this._visibleDemTiles.reduce((h,g)=>{if(!g.dem)return h;const y=g.dem.tree.minimums[0];return y>0&&n++,h+y},0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const h=this._getLoadedAreaMinimum(),g=new o.dI({width:1,height:1},new Float32Array([h]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(g,{premultiply:!1}):y=this._emptyDEMTexture=new o.T(n,g,a.R32F,{premultiply:!1}),y}setupElevationDraw(n,a,h){const g=this.painter.context,y=g.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let T=null,I=null,P=1;if(h&&h.morphing&&this._useVertexMorphing){const j=h.morphing.srcDemTile,U=h.morphing.dstDemTile;P=h.morphing.phase,j&&U&&(this._prepareDemTileUniforms(n,j,x,"_prev")&&(I=j),this._prepareDemTileUniforms(n,U,x)&&(T=U))}const R=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST;let F=null;var D;if(this.enabled?I&&T?(F=T.demTexture,g.activeTexture.set(y.TEXTURE4),I.demTexture.bind(R(I),y.CLAMP_TO_EDGE),x.u_dem_lerp=P):(T=this.terrainTileForTile[n.tileID.key],F=this._prepareDemTileUniforms(n,T,x)?T.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,g.activeTexture.set(y.TEXTURE2),F&&(x.u_dem_size=(D=F).size[0]===1?1:D.size[0]-2,F.bind(R(T),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(h&&h.useDepthForOcclusion,a,x),h&&h.useMeterToDem&&T){const j=(1<<T.tileID.canonical.z)*o.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=j}if(h&&h.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),a.setTerrainUniformValues(g,x),this.painter.transform.projection.name==="globe"){const j=this.globeUniformValues(this.painter.transform,n.tileID.canonical,h&&h.useDenormalizedUpVectorScale);a.setGlobeUniformValues(g,j)}}globeUniformValues(n,a,h){const g=n.projection;return{u_tile_tl_up:g.upVector(a,0,0),u_tile_tr_up:g.upVector(a,o.al,0),u_tile_br_up:g.upVector(a,o.al,o.al),u_tile_bl_up:g.upVector(a,0,o.al),u_tile_up_scale:h?o.dJ(1):g.upVectorScale(a,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const a=this.painter,h=this.painter.context;n.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,y,x,T,I){if(g.transform.projection.name==="globe")(function(P,R,F,D,j){const U=P.context,G=U.gl;let J,Z;const ee=P.transform,oe=o.dA(P,U,ee),ue=(qe,Oe)=>{if(Z===Oe)return;const We=[rg[Oe],"PROJECTION_GLOBE_VIEW"];oe&&We.push("CUSTOM_ANTIALIASING");const gt=P.isTileAffectedByFog(qe);J=P.getOrCreateProgram("globeRaster",{defines:We,overrideFog:gt}),Z=Oe},ye=P.colorModeForRenderPass(),ge=new Ct(G.LEQUAL,Ct.ReadWrite,P.depthRangeFor3D);pl.update(j);const ve=o.dB(ee),_e=[o.aF(ee.center.lng),o.aJ(ee.center.lat)],me=P.globeSharedBuffers,xe=[ee.width*o.o.devicePixelRatio,ee.height*o.o.devicePixelRatio],Ne=Float32Array.from(ee.globeMatrix),Re={useDenormalizedUpVectorScale:!0};{const qe=P.transform,Oe=sg(qe.zoom,R.exaggeration(),R.sourceCache._source.tileSize);Z=-1;const We=G.TRIANGLES;for(const gt of D){const Fe=F.getTile(gt),Ce=Jt.disabled,Ze=R.prevTerrainTileForTile[gt.key],Ve=R.terrainTileForTile[gt.key];Tf(Ze,Ve)&&pl.newMorphing(gt.key,Ze,Ve,j,250),U.activeTexture.set(G.TEXTURE0),Fe.texture&&Fe.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const it=pl.getMorphValuesForProxy(gt.key),mt=it?1:0;it&&Object.assign(Re,{morphing:{srcDemTile:it.from,dstDemTile:it.to,phase:o.dz(it.phase)}});const It=o.dC(gt.canonical),ht=o.dD(It.getCenter().lat),at=o.dE(gt.canonical,It,ht,qe.worldSize/qe._pixelsPerMercatorPixel),jt=o.bk(o.dF(gt.canonical)),Ot=bf(qe.expandedFarZProjMatrix,Ne,ve,jt,o.aj(qe.zoom),_e,qe.frustumCorners.TL,qe.frustumCorners.TR,qe.frustumCorners.BR,qe.frustumCorners.BL,qe.globeCenterInViewSpace,qe.globeRadius,xe,Oe,qe._farZ,at);if(ue(gt,mt),J&&(R.setupElevationDraw(Fe,J,Re),P.uploadCommonUniforms(U,J,gt.toUnwrapped()),me)){const[Bt,zt,rn]=me.getGridBuffers(ht,Oe!==0);J.draw(P,We,ge,Ce,ye,nn.backCCW,Ot,"globe_raster",Bt,zt,rn)}}}if(me&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){const qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&qe.push("CUSTOM_ANTIALIASING"),J=P.getOrCreateProgram("globeRaster",{defines:qe});for(const Oe of D){const{x:We,y:gt,z:Fe}=Oe.canonical,Ce=gt===0,Ze=gt===(1<<Fe)-1,[Ve,it,mt,It]=me.getPoleBuffers(Fe,!1);if(It&&(Ce||Ze)){const ht=F.getTile(Oe);U.activeTexture.set(G.TEXTURE0),ht.texture&&ht.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let at=o.dG(Fe,We,ee);const jt=o.bk(o.dF(Oe.canonical)),Ot=(Bt,zt)=>Bt.draw(P,G.TRIANGLES,ge,Jt.disabled,ye,nn.disabled,bf(ee.expandedFarZProjMatrix,at,at,jt,0,_e,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,xe,0,ee._farZ),"globe_pole_raster",zt,mt,It);R.setupElevationDraw(ht,J,Re),P.uploadCommonUniforms(U,J,Oe.toUnwrapped()),Ce&&P.renderDefaultNorthPole&&Ot(J,Ve),Ze&&P.renderDefaultSouthPole&&(at=o.cR(o.bC(),at,[1,-1,1]),Ot(J,it))}}}})(g,y,x,T,I);else{const P=g.context,R=P.gl;let F,D;const j=g.shadowRenderer,U=hl(g,g.longestCutoffRange),G=ye=>{if(D===ye)return;const ge=[];ge.push(rg[ye]),U.shouldRenderCutoff&&ge.push("RENDER_CUTOFF"),j&&(ge.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&ge.push("NORMAL_OFFSET")),F=g.getOrCreateProgram("terrainRaster",{defines:ge}),D=ye},J=g.colorModeForRenderPass(),Z=new Ct(R.LEQUAL,Ct.ReadWrite,g.depthRangeFor3D);pl.update(I);const ee=g.transform,oe=sg(ee.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let ue=[0,0,0];if(j){const ye=g.style.directionalLight,ge=g.style.ambientLight;ye&&ge&&(ue=Uo(g.style,ye,ge))}{D=-1;const ye=R.TRIANGLES,[ge,ve]=[y.gridIndexBuffer,y.gridSegments];for(const _e of T){const me=x.getTile(_e),xe=Jt.disabled,Ne=y.prevTerrainTileForTile[_e.key],Re=y.terrainTileForTile[_e.key];Tf(Ne,Re)&&pl.newMorphing(_e.key,Ne,Re,I,250),P.activeTexture.set(R.TEXTURE0),me.texture&&me.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE);const qe=pl.getMorphValuesForProxy(_e.key),Oe=qe?1:0;let We;qe&&(We={morphing:{srcDemTile:qe.from,dstDemTile:qe.to,phase:o.dz(qe.phase)}});const gt=ig(_e.projMatrix,kw(_e.canonical,ee.renderWorldCopies)?oe/10:oe,ue);if(G(Oe),!F)continue;y.setupElevationDraw(me,F,We);const Fe=_e.toUnwrapped();j&&j.setupShadows(Fe,F),g.uploadCommonUniforms(P,F,Fe,null,U),F.draw(g,ye,Z,xe,J,nn.backCCW,gt,"terrain_raster",y.gridBuffer,ge,ve)}}}}(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const a=this.painter,h=this.painter.context,g=this.proxySourceCache,y=this.proxiedCoords[g.id],x=this._drapedRenderBatches.shift(),T=a.style.order,I=[];let P=0;for(const R of y){const F=g.getTileByID(R.proxyTileKey),D=g.proxyCachedFBO[R.key]?g.proxyCachedFBO[R.key][n]:void 0,j=D!==void 0?g.renderCache[D]:this.pool[P++],U=D!==void 0;if(F.texture=j.tex,U&&!j.dirty){I.push(F.tileID);continue}let G;h.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(h.clear({color:o.ao.transparent,stencil:0}),j.dirty=!1);for(let J=x.start;J<=x.end;++J){const Z=a.style._mergedLayers[T[J]];if(Z.isHidden(a.transform.zoom))continue;const ee=a.style.getLayerSourceCache(Z),oe=ee?this.proxyToSource[R.key][ee.id]:[R];if(!oe)continue;const ue=oe;h.viewport.set([0,0,j.fb.width,j.fb.height]),G!==(ee?ee.id:null)&&(this._setupStencil(j,oe,Z,ee),G=ee?ee.id:null),a.renderLayer(a,ee,Z,ue)}if(this._drapedRenderBatches.length===0)for(const J of this._pendingGroundEffectLayers){const Z=a.style._mergedLayers[T[J]];if(Z.isHidden(a.transform.zoom))continue;const ee=a.style.getLayerSourceCache(Z),oe=ee?this.proxyToSource[R.key][ee.id]:[R];if(!oe)continue;const ue=oe;h.viewport.set([0,0,j.fb.width,j.fb.height]),G!==(ee?ee.id:null)&&(this._setupStencil(j,oe,Z,ee),G=ee?ee.id:null),a.renderLayer(a,ee,Z,ue)}this.renderedToTile?(j.dirty=!0,I.push(F.tileID)):U||--P,P===5&&(P=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,a.width,a.height]),x.end+1}postRender(){}isLayerOrderingCorrect(n){const a=n.order.length;let h=-1,g=a;for(let y=0;y<a;++y)this._style.isLayerDraped(n._mergedLayers[n.order[y]])?h=Math.max(h,y):g=Math.min(g,y);return g>h}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{n=Math.min(n,a.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,a,h){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const x=y.tileID,T=1<<x.overscaledZ,{x:I,y:P}=x.canonical,R=I/T,F=(I+1)/T,D=P/T,j=(P+1)/T;return{minx:R,miny:D,maxx:F,maxy:j,t:y.dem.tree.raycastRoot(R,D,F,j,n,a,h),tile:y}});g.sort((y,x)=>(y.t!==null?y.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const y of g){if(y.t==null)return null;const x=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,n,a,h);if(x!=null)return x}return null}_createFBO(){const n=this.painter.context,a=n.gl,h=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const g=new o.T(n,{width:h[0],height:h[1],data:null},a.RGBA8);g.bind(a.LINEAR,a.CLAMP_TO_EDGE);const y=n.createFramebuffer(h[0],h[1],!0,null);return y.colorAttachment.set(g.texture),y.depthAttachment=new Rw(n,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:y,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const a=this._style._mergedLayers[n],h=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!h&&a.shouldRedrape():!h&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const h of this._style.getSources())if(h instanceof as){n=!0;break}if(!n)return;const a={};for(let h=0;h<this._style.order.length;++h){const g=this._style._mergedLayers[this._style.order[h]],y=this._style.getLayerSourceCache(g);if(y&&!a[y.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof o.ad){a[y.id]=!0;for(const x of this.proxyCoords){const T=this.proxyToSource[x.key][y.id];if(T)for(const I of T)this._clearRenderCacheForTile(y.id,I)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof Uc){n=!0;break}if(!n)return;const a={};for(let h=0;h<this._style.order.length;++h){const g=this._style._mergedLayers[this._style.order[h]],y=this._style.getLayerSourceCache(g);if(!y||a[y.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const x=g.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const I=this.proxyToSource[T.key][y.id];if(I)for(const P of I){const R=oc(y.getTile(P),y.findLoadedParent(P,0),y,this.painter.transform,x);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(y.id,P)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,a=n.length;if(a===0)return;const h=[];this._pendingGroundEffectLayers=[];let g,y=0,x=this._style._mergedLayers[n[y]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++y<a;)x=this._style._mergedLayers[n[y]];for(;y<a;++y){const T=this._style._mergedLayers[n[y]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?g===void 0&&(g=y):(T.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),g!==void 0&&(h.push({start:g,end:y-1}),g=void 0)))}if(g!==void 0&&h.push({start:g,end:y-1}),h.length!==0){const T=h[h.length-1];this._pendingGroundEffectLayers.every(I=>I>T.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const x=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let T=0;T<x.length;++T){const I=Object.values(x[T]);a.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,g=this._tilesDirty;for(let x=h.length-1;x>=0;x--){const T=h[x];if(a.getTileByID(T.key),a.proxyCachedFBO[T.key]!==void 0){const I=n[T.key],P=this.proxyToSource[T.key];let R=0;for(const F in P){const D=P[F],j=I[F];if(!j||j.length!==D.length||D.some((U,G)=>U!==j[G]||g[F]&&g[F].hasOwnProperty(U.key))){R=-1;break}++R}for(const F in a.proxyCachedFBO[T.key])a.renderCache[a.proxyCachedFBO[T.key][F]].dirty=R<0||R!==Object.values(I).length}}const y=[...this._drapedRenderBatches];y.sort((x,T)=>T.end-T.start-(x.end-x.start));for(const x of y)for(const T of h){if(a.proxyCachedFBO[T.key])continue;let I=a.renderCachePool.pop();I===void 0&&a.renderCache.length<50&&(I=a.renderCache.length,a.renderCache.push(this._createFBO())),I!==void 0&&(a.proxyCachedFBO[T.key]={},a.proxyCachedFBO[T.key][x.start]=I,a.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,h,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,x=y.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let T;if(h.isTileClipped())T=a.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):Jt.disabled}_renderTileClippingMasks(n,a){const h=this.painter,g=this.painter.context,y=g.gl;h._tileClippingMaskIDs={},g.setColorMode(yn.disabled),g.setDepthMode(Ct.disabled);const x=h.getOrCreateProgram("clippingMask");for(const T of n){const I=h._tileClippingMaskIDs[T.key]=--a;x.draw(h,y.TRIANGLES,Ct.disabled,new Jt({func:y.ALWAYS,mask:0},I,255,y.KEEP,y.KEEP,y.REPLACE),yn.disabled,nn.disabled,sc(T.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const h=[n.x,n.y,1,1];o.aC(h,h,a.pixelMatrixInverse),o.cJ(h,h,1/h[3]),h[0]/=a.worldSize,h[1]/=a.worldSize;const g=a._camera.position,y=o.ce(1,a.center.lat),x=[g[0],g[1],g[2]/y,0],T=o.d9([],h.slice(0,3),x);o.aw(T,T);const I=this.raycast(x,T,this._exaggeration);return I!==null&&I?(o.bH(x,x,T,I),x[3]=x[2],x[2]*=y,x):null}_setupProxiedCoordsForOrtho(n,a,h){if(n.getSource()instanceof o.aS)return this._setupProxiedCoordsForImageSource(n,a,h);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const g=this.proxiedCoords[n.id]=[],y=this.proxyCoords;for(let I=0;I<y.length;I++){const P=y[I],R=this._findTileCoveringTileID(P,n);if(R){const F=this._createProxiedId(P,R,h[P.key]&&h[P.key][n.id]);g.push(F),this.proxyToSource[P.key][n.id]=[F]}}let x=!1;const T=new Set;for(let I=0;I<a.length;I++){const P=n.getTile(a[I]);if(!P||!P.hasData())continue;const R=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==P.tileID.canonical.z){const F=this.proxyToSource[R.tileID.key][n.id],D=this._createProxiedId(R.tileID,P,h[R.tileID.key]&&h[R.tileID.key][n.id]);F?F.splice(F.length-1,0,D):this.proxyToSource[R.tileID.key][n.id]=[D];const j=this.proxyToSource[R.tileID.key][n.id];T.has(j)||T.add(j),g.push(D),x=!0}}if(this._sourceTilesOverlap[n.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(const I of T)I.sort((P,R)=>R.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(n,a,h){if(!n.getSource().loaded())return;const g=this.proxiedCoords[n.id]=[],y=this.proxyCoords,x=n.getSource(),T=x.tileID;if(!T)return;const I=new o.P(T.x,T.y)._div(1<<T.z),P=x.coordinates.map(o.ae.fromLngLat).reduce((F,D)=>(F.min.x=Math.min(F.min.x,D.x-I.x),F.min.y=Math.min(F.min.y,D.y-I.y),F.max.x=Math.max(F.max.x,D.x-I.x),F.max.y=Math.max(F.max.y,D.y-I.y),F),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(F,D)=>{const j=F.wrap+F.canonical.x/(1<<F.canonical.z),U=F.canonical.y/(1<<F.canonical.z),G=o.al/(1<<F.canonical.z),J=D.wrap+D.canonical.x/(1<<D.canonical.z),Z=D.canonical.y/(1<<D.canonical.z);return j+G<J+P.min.x||j>J+P.max.x||U+G<Z+P.min.y||U>Z+P.max.y};for(let F=0;F<y.length;F++){const D=y[F];for(let j=0;j<a.length;j++){const U=n.getTile(a[j]);if(!U||!U.hasData()||R(D,U.tileID))continue;const G=this._createProxiedId(D,U,h[D.key]&&h[D.key][n.id]),J=this.proxyToSource[D.key][n.id];J?J.push(G):this.proxyToSource[D.key][n.id]=[G],g.push(G)}}}_createProxiedId(n,a,h){let g=this.orthoMatrix;if(h){const y=h.find(x=>x.key===a.tileID.key);if(y)return y}if(a.tileID.key!==n.key){const y=n.canonical.z-a.tileID.canonical.z;let x,T,I;g=o.bC();const P=a.tileID.wrap-n.wrap<<n.overscaledZ;y>0?(x=o.al>>y,T=x*((a.tileID.canonical.x<<y)-n.canonical.x+P),I=x*((a.tileID.canonical.y<<y)-n.canonical.y)):(x=o.al<<-y,T=o.al*(a.tileID.canonical.x-(n.canonical.x+P<<-y)),I=o.al*(a.tileID.canonical.y-(n.canonical.y<<-y))),o.cd(g,0,x,0,x,0,1),o.br(g,g,[T,I,0])}return new Sf(a.tileID,n.key,g)}_findTileCoveringTileID(n,a){let h=a.getTile(n);if(h&&h.hasData())return h;const g=this._findCoveringTileCache[a.id],y=g[n.key];if(h=y?a.getTileByID(y):null,h&&h.hasData()||y===null)return h;let x=h?h.tileID:n,T=x.overscaledZ;const I=a.getSource().minzoom,P=[];if(!y){const F=a.getSource().maxzoom;if(n.canonical.z>=F){const D=n.canonical.z-F;a.getSource().reparseOverscaled?(T=Math.max(n.canonical.z+2,a.transform.tileZoom),x=new o.aO(T,n.wrap,F,n.canonical.x>>D,n.canonical.y>>D)):D!==0&&(T=F,x=new o.aO(T,n.wrap,F,n.canonical.x>>D,n.canonical.y>>D))}x.key!==n.key&&(P.push(x.key),h=a.getTile(x))}const R=F=>{P.forEach(D=>{g[D]=F}),P.length=0};for(T-=1;T>=I&&(!h||!h.hasData());T--){h&&R(h.tileID.key);const F=x.calculateScaledKey(T);if(h=a.getTileByID(F),h&&h.hasData())break;const D=g[F];if(D===null)break;D===void 0?P.push(F):h=a.getTileByID(D)}return R(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let h=this._tilesDirty[n];h||(h=this._tilesDirty[n]={}),h[a.key]=!0}}function Ef(d,n,a){const h=function(T,I,P){const R=o.bJ(I,T),F=o.bJ(P,[.2126,.7152,.0722]),D=(U,G,J)=>(1-J)*U+J*G,j=D(1-.3*Math.min(F,1),1,Math.min(R+1,1));return D(.92,1,Math.asin(o.aA(I[2],-1,1))/Math.PI+.5)*j}(d,[0,0,1],n),g=[0,0,0];o.c4(g,a.slice(0,3),h);const y=[0,0,0];o.c4(y,n.slice(0,3),d[2]);const x=[0,0,0];return o.d7(x,g,y),o.da(x)}const og=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ag=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class If{static cacheKey(n,a,h,g){let y=`${a}${g?g.cacheKey:""}`;for(const x of h)n.usedDefines.includes(x)&&(y+=`/${x}`);return y}constructor(n,a,h,g,y,x){const T=n.gl;this.program=T.createProgram(),this.configuration=g,this.name=a,this.fixedDefines=[...x];let I=g?g.defines():[];I=I.concat(x.map(U=>`#define ${U}`));const P=`#version 300 es
`;let R=P+I.concat("precision mediump float;",ha,zh.fragmentSource).join(`
`);for(const U of h.fragmentIncludes)R+=`
${nu[U]}`;R+=`
${h.fragmentSource}`;let F=P+I.concat("precision highp float;",ha,zh.vertexSource).join(`
`);for(const U of h.vertexIncludes)F+=`
${nu[U]}`;this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&h.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(F+=`
uniform int u_instanceID;
`),F+=`
${h.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(F=F.replaceAll("gl_InstanceID","u_instanceID"));const D=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(D,R),T.compileShader(D),T.attachShader(this.program,D);const j=T.createShader(T.VERTEX_SHADER);T.isContextLost()?this.failedToCreate=!0:(T.shaderSource(j,F),T.compileShader(j),T.attachShader(this.program,j),this.attributes={},T.linkProgram(this.program),T.deleteShader(j),T.deleteShader(D),this.fixedUniforms=y(n),this.binderUniforms=g?g.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(U=>({u_instanceID:new o.cg(U)}))(n)),(x.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(U=>({u_dem:new o.cg(U),u_dem_prev:new o.cg(U),u_dem_tl:new o.cj(U),u_dem_scale:new o.ci(U),u_dem_tl_prev:new o.cj(U),u_dem_scale_prev:new o.ci(U),u_dem_size:new o.ci(U),u_dem_lerp:new o.ci(U),u_exaggeration:new o.ci(U),u_depth:new o.cg(U),u_depth_size_inv:new o.cj(U),u_depth_range_unpack:new o.cj(U),u_occluder_half_size:new o.ci(U),u_occlusion_depth_offset:new o.ci(U),u_meter_to_dem:new o.ci(U),u_label_plane_matrix_inv:new o.ck(U)}))(n)),x.includes("GLOBE")&&(this.globeUniforms=(U=>({u_tile_tl_up:new o.ch(U),u_tile_tr_up:new o.ch(U),u_tile_br_up:new o.ch(U),u_tile_bl_up:new o.ch(U),u_tile_up_scale:new o.ci(U)}))(n)),x.includes("FOG")&&(this.fogUniforms=(U=>({u_fog_matrix:new o.ck(U),u_fog_range:new o.cj(U),u_fog_color:new o.d2(U),u_fog_horizon_blend:new o.ci(U),u_fog_vertical_limit:new o.cj(U),u_fog_temporal_offset:new o.ci(U),u_frustum_tl:new o.ch(U),u_frustum_tr:new o.ch(U),u_frustum_br:new o.ch(U),u_frustum_bl:new o.ch(U),u_globe_pos:new o.ch(U),u_globe_radius:new o.ci(U),u_globe_transition:new o.ci(U),u_is_globe:new o.cg(U),u_viewport:new o.cj(U)}))(n)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(U=>({u_cutoff_params:new o.d2(U)}))(n)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(U=>({u_lighting_ambient_color:new o.ch(U),u_lighting_directional_dir:new o.ch(U),u_lighting_directional_color:new o.ch(U),u_ground_radiance:new o.ch(U)}))(n)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(U=>({u_light_matrix_0:new o.ck(U),u_light_matrix_1:new o.ck(U),u_fade_range:new o.cj(U),u_shadow_normal_offset:new o.ch(U),u_shadow_intensity:new o.ci(U),u_shadow_texel_size:new o.ci(U),u_shadow_map_resolution:new o.ci(U),u_shadow_direction:new o.ch(U),u_shadow_bias:new o.ch(U),u_shadowmap_0:new o.cg(U),u_shadowmap_1:new o.cg(U)}))(n)))}getAttributeLocation(n,a){let h=this.attributes[a];return h===void 0&&(h=this.attributes[a]=n.getAttribLocation(this.program,a)),h}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)h[g]&&h[g].set(this.program,g,a[g])}}setGlobeUniformValues(n,a){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)h[g]&&h[g].set(this.program,g,a[g])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)h[g].set(this.program,g,a[g])}}setCutoffUniformValues(n,a){if(!this.cutoffUniforms)return;const h=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)h[g].set(this.program,g,a[g])}}setLightsUniformValues(n,a){if(!this.lightsUniforms)return;const h=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)h[g].set(this.program,g,a[g])}}setShadowUniformValues(n,a){if(this.failedToCreate||!this.shadowUniforms)return;const h=this.shadowUniforms;n.program.set(this.program);for(const g in a)h[g].set(this.program,g,a[g])}_drawDebugWireframe(n,a,h,g,y,x,T,I,P,R){const F=n.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;const D=n.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||n._terrain&&n._terrain.renderingToTexture||!og.includes(this.name))||!(!F.layers3D||!ag.includes(this.name))))return;const j=D.gl,U=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,y,D);if(!U)return;const G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");const J=n.getOrCreateProgram(this.name,{config:this.configuration,defines:G});D.program.set(J.program);const Z=(ue,ye,ge)=>{if(ye[ue]&&ge[ue])for(const ve in ye[ue])ge[ue][ve]&&ge[ue][ve].set(ge.program,ve,ye[ue][ve].current)};P&&P.setUniforms(J.program,D,J.binderUniforms,T,{zoom:I}),Z("fixedUniforms",this,J),Z("terrainUniforms",this,J),Z("globeUniforms",this,J),Z("fogUniforms",this,J),Z("lightsUniforms",this,J),Z("shadowUniforms",this,J),U.bind(),D.setColorMode(new yn([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],o.ao.transparent,[!0,!0,!0,!1])),D.setDepthMode(new Ct(a.func===j.LESS?j.LEQUAL:a.func,Ct.ReadOnly,a.range)),D.setStencilMode(Jt.disabled);const ee=3*x.primitiveLength*2,oe=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ue=R||1;for(let ye=0;ye<ue;++ye)J.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ye),j.drawElements(j.LINES,ee,j.UNSIGNED_SHORT,oe)}else R&&R>1?j.drawElementsInstanced(j.LINES,ee,j.UNSIGNED_SHORT,oe,R):j.drawElements(j.LINES,ee,j.UNSIGNED_SHORT,oe);y.bind(),D.program.set(this.program),D.setDepthMode(a),D.setStencilMode(h),D.setColorMode(g)}checkUniforms(n,a,h){if(this.fixedDefines.includes(a)){for(const g of Object.keys(h))if(!h[g].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${g} not set but required by ${a} being defined`)}}draw(n,a,h,g,y,x,T,I,P,R,F,D,j,U,G,J){const Z=n.context,ee=Z.gl;if(this.failedToCreate)return;Z.program.set(this.program),Z.setDepthMode(h),Z.setStencilMode(g),Z.setColorMode(y),Z.setCullFace(x);for(const ye of Object.keys(this.fixedUniforms))this.fixedUniforms[ye].set(this.program,ye,T[ye]);U&&U.setUniforms(this.program,Z,this.binderUniforms,D,{zoom:j});const oe={[ee.POINTS]:1,[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[a];this.checkUniforms(I,"RENDER_SHADOWS",this.shadowUniforms);const ue=J&&J>0?1:void 0;for(const ye of F.get()){const ge=ye.vaos||(ye.vaos={});if((ge[I]||(ge[I]=new iu)).bind(Z,this,P,U?U.getPaintVertexBuffers():[],R,ye.vertexOffset,G||[],ue),this.forceManualRenderingForInstanceIDShaders){const ve=J||1;for(let _e=0;_e<ve;++_e)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",_e),R?ee.drawElements(a,ye.primitiveLength*oe,ee.UNSIGNED_SHORT,ye.primitiveOffset*oe*2):ee.drawArrays(a,ye.vertexOffset,ye.vertexLength)}else J&&J>1?ee.drawElementsInstanced(a,ye.primitiveLength*oe,ee.UNSIGNED_SHORT,ye.primitiveOffset*oe*2,J):R?ee.drawElements(a,ye.primitiveLength*oe,ee.UNSIGNED_SHORT,ye.primitiveOffset*oe*2):ee.drawArrays(a,ye.vertexOffset,ye.vertexLength);a===ee.TRIANGLES&&R&&this._drawDebugWireframe(n,h,g,y,R,ye,D,j,U,J)}}}function Nh(d,n,a=0){const h=Math.pow(2,n.tileID.overscaledZ),g=n.tileSize*Math.pow(2,d.transform.tileZoom)/h,y=g*(n.tileID.canonical.x+n.tileID.wrap*h),x=g*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ay(n,1,d.transform.tileZoom),u_pixel_coord_upper:[y>>16,x>>16],u_pixel_coord_lower:[65535&y,65535&x],u_pattern_transition:a}}const au={terrain:0,flat:1},lg=o.bC(),Bh=(d,n,a,h,g,y,x,T,I,P,R,F,D,j,U,G,J,Z)=>{const ee=n.style.light,oe=ee.properties.get("position"),ue=[oe.x,oe.y,oe.z],ye=o.dL();ee.properties.get("anchor")==="viewport"&&(o.dM(ye,-n.transform.angle),o.dN(ue,ue,ye));const ge=ee.properties.get("color").toPremultipliedRenderColor(null),ve=n.transform,_e={u_matrix:d,u_lightpos:ue,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_vertical_gradient:+a,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:lg,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:au[P],u_base_type:au[R],u_ao:g,u_edge_radius:y,u_width_scale:x,u_flood_light_color:U,u_vertical_scale:G,u_flood_light_intensity:J,u_ground_shadow_factor:Z};return ve.projection.name==="globe"&&(_e.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],_e.u_zoom_transition=F,_e.u_inv_rot_matrix=j,_e.u_merc_center=D,_e.u_up_dir=ve.projection.upVector(new o.cC(0,0,0),D[0]*o.al,D[1]*o.al),_e.u_height_lift=I),_e},cg=(d,n,a,h,g,y)=>({u_matrix:d,u_edge_radius:n,u_width_scale:a,u_vertical_scale:h,u_height_type:au[g],u_base_type:au[y]}),Dv=(d,n,a,h,g,y,x,T,I,P,R,F,D,j,U,G,J,Z)=>{const ee=Bh(d,n,a,h,g,y,x,T,P,R,F,D,j,U,G,J,1,[0,0,0]),oe={u_height_factor:-Math.pow(2,T.overscaledZ)/I.tileSize/8};return Object.assign(ee,Nh(n,I,Z),oe)},ug=(d,n,a)=>({u_matrix:d,u_emissive_strength:n,u_ground_shadow_factor:a}),ac=(d,n,a,h,g,y=0)=>Object.assign(ug(d,n,g),Nh(a,h,y)),Dw=(d,n,a,h)=>({u_matrix:d,u_world:a,u_emissive_strength:n,u_ground_shadow_factor:h}),Lw=(d,n,a,h,g,y,x=0)=>Object.assign(ac(d,n,a,h,y,x),{u_world:g}),zw=(d,n)=>({u_matrix:d,u_ground_shadow_factor:n}),Af=(d,n,a,h,g)=>({u_matrix:d,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:a,u_height_scale:h,u_reset_depth:g}),Ow=(d,n,a,h,g,y,x)=>({u_matrix:d,u_normal_matrix:n,u_opacity:a,u_faux_facade_ao_intensity:h,u_camera_pos:g,u_tile_to_meter:y,u_facade_emissive_chance:x}),Fw=d=>({u_matrix:d}),hg=d=>({u_matrix:d}),dg=(d,n,a,h,g,y,x,T)=>{const I=o.al/y.tileSize;return{u_matrix:d,u_inv_rot_matrix:n,u_camera_to_center_distance:a.getCameraToCenterDistance(T),u_extrude_scale:[a.pixelsToGLUnits[0]/I,a.pixelsToGLUnits[1]/I],u_zoom_transition:h,u_tile_id:x,u_merc_center:g}},fg=(d,n,a=1)=>({u_matrix:d,u_color:n,u_overlay:0,u_overlay_scale:a}),lu=o.bC(),Lv=(d,n,a,h,g,y,x)=>{const T=d.transform,I=T.projection.name==="globe",P=I?o.dO(T.zoom,n.canonical)*T._pixelsPerMercatorPixel:o.ay(a,1,y),R={u_matrix:n.projMatrix,u_extrude_scale:P,u_intensity:x,u_inv_rot_matrix:lu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){R.u_inv_rot_matrix=h,R.u_merc_center=g,R.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],R.u_zoom_transition=o.aj(T.zoom);const F=g[0]*o.al,D=g[1]*o.al;R.u_up_dir=T.projection.upVector(new o.cC(0,0,0),F,D)}return R};function pg(d,[n,a,h,g],[y,x]){if(y===x)return[0,0,0,0];const T=255*(d-1)/(d*(x-y));return[n*T,a*T,h*T,g*T]}function mg(d,n,[a,h]){return a===h?0:.5/d+(n-a)*(d-1)/(d*(h-a))}const Cf=(d,n,a,h,g,y,x,T,I,P,R,F,D,j,U,G,J,Z,ee,oe,ue)=>({u_matrix:d,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:h,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:P,u_fade_t:R.mix,u_opacity:R.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:o.dQ(F.paint.get("raster-saturation")),u_contrast_factor:o.dP(F.paint.get("raster-contrast")),u_spin_weights:lc(F.paint.get("raster-hue-rotate")),u_perspective_transform:D,u_raster_elevation:j,u_zoom_transition:x,u_merc_center:T,u_cutoff_params:I,u_colorization_mix:pg(o.dR,G,Z),u_colorization_offset:mg(o.dR,J,Z),u_color_ramp:U,u_texture_offset:[oe/(ee+2*oe),ee/(ee+2*oe)],u_texture_res:[ee+2*oe,ee+2*oe],u_emissive_strength:ue});function lc(d){d*=Math.PI/180;const n=Math.sin(d),a=Math.cos(d);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const cc=.05,ml=(d,n,a,h,g,y,x,T,I,P,R,F)=>({u_matrix:d,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:h,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:P,u_fade_t:R.mix,u_opacity:R.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:x,u_merc_center:T,u_cutoff_params:I}),gg=(d,n,a,h,g,y,x,T,I,P)=>({u_particle_texture:d,u_particle_texture_side_len:n,u_tile_offset:a,u_velocity:h,u_color_ramp:y,u_velocity_res:g,u_max_speed:x,u_uv_offset:T,u_data_scale:[255*I[0],255*I[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[cc,cc]}),Pf=(d,n,a,h,g,y,x,T,I,P)=>({u_particle_texture:d,u_particle_texture_side_len:n,u_velocity:a,u_velocity_res:h,u_max_speed:g,u_speed_factor:y,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:T,u_data_scale:[255*I[0],255*I[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[cc,cc]}),_g=o.bC(),yg=(d,n,a,h,g,y,x,T,I,P,R,F,D,j,U,G,J,Z,ee,oe,ue,ye,ge,ve)=>{const _e=g.transform,me={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:_e.getCameraToCenterDistance(ee),u_rotate_symbol:+a,u_aspect_ratio:_e.width/_e.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:x,u_coord_matrix:T,u_is_text:+P,u_elevation_from_sea:I?1:0,u_pitch_with_map:+h,u_texsize:R,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:_g,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:_g,u_up_vector:[0,-1,0],u_color_adj_mat:ye,u_icon_transition:ge||0,u_gamma_scale:h?g.transform.getCameraToCenterDistance(ee)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:o.o.devicePixelRatio,u_is_halo:1,u_scale_factor:ve||1,u_ground_shadow_factor:oe,u_inv_matrix:o.bl(o.bC(),x),u_normal_scale:ue,u_lutTexture:er.LUT};return ee.name==="globe"&&(me.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],me.u_zoom_transition=U,me.u_inv_rot_matrix=J,me.u_merc_center=G,me.u_camera_forward=_e._camera.forward(),me.u_ecef_origin=o.dS(_e.globeMatrix,j.toUnwrapped()),me.u_tile_matrix=Float32Array.from(_e.globeMatrix),me.u_up_vector=Z),me},Mf=(d,n,a,h)=>({u_matrix:d,u_emissive_strength:n,u_opacity:a,u_color:h}),Rf=(d,n,a,h,g,y,x,T,I)=>Object.assign(function(P,R,F,D,j,U){const{width:G,height:J}=D.imageManager.getPixelSize(R),Z=Math.pow(2,U.tileID.overscaledZ),ee=U.tileSize*Math.pow(2,D.transform.tileZoom)/Z,oe=ee*(U.tileID.canonical.x+U.tileID.wrap*Z),ue=ee*U.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[G,J],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:j?[D.transform.width,-1*D.transform.height]:[1/o.ay(U,1,D.transform.tileZoom),1/o.ay(U,1,D.transform.tileZoom)],u_pixel_coord_upper:[oe>>16,ue>>16],u_pixel_coord_lower:[65535&oe,65535&ue]}}(0,y,x,h,T,I),{u_matrix:d,u_emissive_strength:n,u_opacity:a}),vg=new Float32Array(o.bA([])),kf=(d,n,a,h,g,y,x,T,I,P,R,F,D,j=[0,0,0],U)=>{const G=g.style.light,J=G.properties.get("position"),Z=[-J.x,-J.y,J.z],ee=o.dL();G.properties.get("anchor")==="viewport"&&(o.dM(ee,-g.transform.angle),o.dN(Z,Z,ee));const oe=R.alphaMode==="MASK",ue=G.properties.get("color").toNonPremultipliedRenderColor(null),ye=D.paint.get("model-ambient-occlusion-intensity"),ge=D.paint.get("model-color").constantOr(o.ao.white).toNonPremultipliedRenderColor(null);return ge.a=D.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:d,u_lighting_matrix:n,u_normal_matrix:a,u_node_matrix:h||vg,u_lightpos:Z,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[ue.r,ue.g,ue.b],u_camera_pos:j,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+oe,u_alphaCutoff:R.alphaCutoff,u_baseColorFactor:x.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:I,u_roughnessFactor:P,u_baseColorTexture:er.BaseColor,u_metallicRoughnessTexture:er.MetallicRoughness,u_normalTexture:er.Normal,u_occlusionTexture:er.Occlusion,u_emissionTexture:er.Emission,u_lutTexture:er.LUT,u_color_mix:ge.toArray01(),u_aoIntensity:ye,u_emissive_strength:F,u_occlusionTextureTransform:U||[0,0,0,0]}},cu=(d,n=vg,a=vg)=>({u_matrix:d,u_instance:n,u_node_matrix:a}),Nw={fillExtrusion:d=>({u_matrix:new o.ck(d),u_lightpos:new o.ch(d),u_lightintensity:new o.ci(d),u_lightcolor:new o.ch(d),u_vertical_gradient:new o.ci(d),u_opacity:new o.ci(d),u_edge_radius:new o.ci(d),u_width_scale:new o.ci(d),u_ao:new o.cj(d),u_height_type:new o.cg(d),u_base_type:new o.cg(d),u_tile_id:new o.ch(d),u_zoom_transition:new o.ci(d),u_inv_rot_matrix:new o.ck(d),u_merc_center:new o.cj(d),u_up_dir:new o.ch(d),u_height_lift:new o.ci(d),u_flood_light_color:new o.ch(d),u_vertical_scale:new o.ci(d),u_flood_light_intensity:new o.ci(d),u_ground_shadow_factor:new o.ch(d)}),fillExtrusionDepth:d=>({u_matrix:new o.ck(d),u_edge_radius:new o.ci(d),u_width_scale:new o.ci(d),u_vertical_scale:new o.ci(d),u_height_type:new o.cg(d),u_base_type:new o.cg(d)}),fillExtrusionPattern:d=>({u_matrix:new o.ck(d),u_lightpos:new o.ch(d),u_lightintensity:new o.ci(d),u_lightcolor:new o.ch(d),u_vertical_gradient:new o.ci(d),u_height_factor:new o.ci(d),u_edge_radius:new o.ci(d),u_width_scale:new o.ci(d),u_ao:new o.cj(d),u_height_type:new o.cg(d),u_base_type:new o.cg(d),u_tile_id:new o.ch(d),u_zoom_transition:new o.ci(d),u_inv_rot_matrix:new o.ck(d),u_merc_center:new o.cj(d),u_up_dir:new o.ch(d),u_height_lift:new o.ci(d),u_image:new o.cg(d),u_texsize:new o.cj(d),u_pixel_coord_upper:new o.cj(d),u_pixel_coord_lower:new o.cj(d),u_tile_units_to_pixels:new o.ci(d),u_opacity:new o.ci(d),u_pattern_transition:new o.ci(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new o.ck(d),u_opacity:new o.ci(d),u_ao_pass:new o.ci(d),u_meter_to_tile:new o.ci(d),u_ao:new o.cj(d),u_flood_light_intensity:new o.ci(d),u_flood_light_color:new o.ch(d),u_attenuation:new o.ci(d),u_edge_radius:new o.ci(d),u_fb:new o.cg(d),u_fb_size:new o.ci(d),u_dynamic_offset:new o.ci(d)}),fill:d=>({u_matrix:new o.ck(d),u_emissive_strength:new o.ci(d),u_ground_shadow_factor:new o.ch(d)}),fillPattern:d=>({u_matrix:new o.ck(d),u_emissive_strength:new o.ci(d),u_image:new o.cg(d),u_texsize:new o.cj(d),u_pixel_coord_upper:new o.cj(d),u_pixel_coord_lower:new o.cj(d),u_tile_units_to_pixels:new o.ci(d),u_ground_shadow_factor:new o.ch(d),u_pattern_transition:new o.ci(d)}),fillOutline:d=>({u_matrix:new o.ck(d),u_emissive_strength:new o.ci(d),u_world:new o.cj(d),u_ground_shadow_factor:new o.ch(d)}),fillOutlinePattern:d=>({u_matrix:new o.ck(d),u_emissive_strength:new o.ci(d),u_world:new o.cj(d),u_image:new o.cg(d),u_texsize:new o.cj(d),u_pixel_coord_upper:new o.cj(d),u_pixel_coord_lower:new o.cj(d),u_tile_units_to_pixels:new o.ci(d),u_ground_shadow_factor:new o.ch(d),u_pattern_transition:new o.ci(d)}),building:d=>({u_matrix:new o.ck(d),u_normal_matrix:new o.ck(d),u_opacity:new o.ci(d),u_faux_facade_ao_intensity:new o.ci(d),u_camera_pos:new o.ch(d),u_tile_to_meter:new o.ci(d),u_facade_emissive_chance:new o.ci(d)}),buildingBloom:d=>({u_matrix:new o.ck(d)}),buildingDepth:d=>({u_matrix:new o.ck(d)}),elevatedStructuresDepth:d=>({u_matrix:new o.ck(d),u_depth_bias:new o.ci(d)}),elevatedStructures:d=>({u_matrix:new o.ck(d),u_ground_shadow_factor:new o.ch(d)}),elevatedStructuresDepthReconstruct:d=>({u_matrix:new o.ck(d),u_camera_pos:new o.ch(d),u_depth_bias:new o.ci(d),u_height_scale:new o.ci(d),u_reset_depth:new o.ci(d)}),circle:o.dV,collisionBox:d=>({u_matrix:new o.ck(d),u_inv_rot_matrix:new o.ck(d),u_camera_to_center_distance:new o.ci(d),u_extrude_scale:new o.cj(d),u_zoom_transition:new o.ci(d),u_merc_center:new o.cj(d),u_tile_id:new o.ch(d)}),collisionCircle:d=>({u_matrix:new o.ck(d),u_inv_matrix:new o.ck(d),u_camera_to_center_distance:new o.ci(d),u_viewport_size:new o.cj(d)}),debug:d=>({u_color:new o.dx(d),u_matrix:new o.ck(d),u_overlay:new o.cg(d),u_overlay_scale:new o.ci(d)}),clippingMask:d=>({u_matrix:new o.ck(d)}),heatmap:d=>({u_extrude_scale:new o.ci(d),u_intensity:new o.ci(d),u_matrix:new o.ck(d),u_inv_rot_matrix:new o.ck(d),u_merc_center:new o.cj(d),u_tile_id:new o.ch(d),u_zoom_transition:new o.ci(d),u_up_dir:new o.ch(d)}),heatmapTexture:d=>({u_image:new o.cg(d),u_color_ramp:new o.cg(d),u_opacity:new o.ci(d)}),hillshade:d=>({u_matrix:new o.ck(d),u_image:new o.cg(d),u_latrange:new o.cj(d),u_light:new o.cj(d),u_shadow:new o.dx(d),u_highlight:new o.dx(d),u_emissive_strength:new o.ci(d),u_accent:new o.dx(d)}),hillshadePrepare:d=>({u_matrix:new o.ck(d),u_image:new o.cg(d),u_dimension:new o.cj(d),u_zoom:new o.ci(d)}),line:o.dU,linePattern:o.dT,raster:d=>({u_matrix:new o.ck(d),u_normalize_matrix:new o.ck(d),u_globe_matrix:new o.ck(d),u_merc_matrix:new o.ck(d),u_grid_matrix:new o.dy(d),u_tl_parent:new o.cj(d),u_scale_parent:new o.ci(d),u_fade_t:new o.ci(d),u_opacity:new o.ci(d),u_image0:new o.cg(d),u_image1:new o.cg(d),u_brightness_low:new o.ci(d),u_brightness_high:new o.ci(d),u_saturation_factor:new o.ci(d),u_contrast_factor:new o.ci(d),u_spin_weights:new o.ch(d),u_perspective_transform:new o.cj(d),u_raster_elevation:new o.ci(d),u_zoom_transition:new o.ci(d),u_merc_center:new o.cj(d),u_cutoff_params:new o.d2(d),u_colorization_mix:new o.d2(d),u_colorization_offset:new o.ci(d),u_color_ramp:new o.cg(d),u_texture_offset:new o.cj(d),u_texture_res:new o.cj(d),u_emissive_strength:new o.ci(d)}),rasterParticle:d=>({u_matrix:new o.ck(d),u_normalize_matrix:new o.ck(d),u_globe_matrix:new o.ck(d),u_merc_matrix:new o.ck(d),u_grid_matrix:new o.dy(d),u_tl_parent:new o.cj(d),u_scale_parent:new o.ci(d),u_fade_t:new o.ci(d),u_opacity:new o.ci(d),u_image0:new o.cg(d),u_image1:new o.cg(d),u_raster_elevation:new o.ci(d),u_zoom_transition:new o.ci(d),u_merc_center:new o.cj(d),u_cutoff_params:new o.d2(d)}),rasterParticleTexture:d=>({u_texture:new o.cg(d),u_opacity:new o.ci(d)}),rasterParticleDraw:d=>({u_particle_texture:new o.cg(d),u_particle_texture_side_len:new o.ci(d),u_tile_offset:new o.cj(d),u_velocity:new o.cg(d),u_color_ramp:new o.cg(d),u_velocity_res:new o.cj(d),u_max_speed:new o.ci(d),u_uv_offset:new o.cj(d),u_data_scale:new o.cj(d),u_data_offset:new o.ci(d),u_particle_pos_scale:new o.ci(d),u_particle_pos_offset:new o.cj(d)}),rasterParticleUpdate:d=>({u_particle_texture:new o.cg(d),u_particle_texture_side_len:new o.ci(d),u_velocity:new o.cg(d),u_velocity_res:new o.cj(d),u_max_speed:new o.ci(d),u_speed_factor:new o.ci(d),u_reset_rate:new o.ci(d),u_rand_seed:new o.ci(d),u_uv_offset:new o.cj(d),u_data_scale:new o.cj(d),u_data_offset:new o.ci(d),u_particle_pos_scale:new o.ci(d),u_particle_pos_offset:new o.cj(d)}),symbol:d=>({u_is_size_zoom_constant:new o.cg(d),u_is_size_feature_constant:new o.cg(d),u_size_t:new o.ci(d),u_size:new o.ci(d),u_camera_to_center_distance:new o.ci(d),u_rotate_symbol:new o.cg(d),u_aspect_ratio:new o.ci(d),u_fade_change:new o.ci(d),u_matrix:new o.ck(d),u_label_plane_matrix:new o.ck(d),u_coord_matrix:new o.ck(d),u_is_text:new o.cg(d),u_elevation_from_sea:new o.cg(d),u_pitch_with_map:new o.cg(d),u_texsize:new o.cj(d),u_texsize_icon:new o.cj(d),u_texture:new o.cg(d),u_texture_icon:new o.cg(d),u_gamma_scale:new o.ci(d),u_device_pixel_ratio:new o.ci(d),u_tile_id:new o.ch(d),u_zoom_transition:new o.ci(d),u_inv_rot_matrix:new o.ck(d),u_merc_center:new o.cj(d),u_camera_forward:new o.ch(d),u_tile_matrix:new o.ck(d),u_up_vector:new o.ch(d),u_ecef_origin:new o.ch(d),u_is_halo:new o.cg(d),u_icon_transition:new o.ci(d),u_color_adj_mat:new o.ck(d),u_scale_factor:new o.ci(d),u_ground_shadow_factor:new o.ch(d),u_inv_matrix:new o.ck(d),u_normal_scale:new o.ci(d),u_lutTexture:new o.cg(d)}),background:d=>({u_matrix:new o.ck(d),u_emissive_strength:new o.ci(d),u_opacity:new o.ci(d),u_color:new o.dx(d)}),backgroundPattern:d=>({u_matrix:new o.ck(d),u_emissive_strength:new o.ci(d),u_opacity:new o.ci(d),u_image:new o.cg(d),u_pattern_tl:new o.cj(d),u_pattern_br:new o.cj(d),u_texsize:new o.cj(d),u_pattern_size:new o.cj(d),u_pixel_coord_upper:new o.cj(d),u_pixel_coord_lower:new o.cj(d),u_pattern_units_to_pixels:new o.cj(d)}),terrainRaster:d=>({u_matrix:new o.ck(d),u_image0:new o.cg(d),u_skirt_height:new o.ci(d),u_ground_shadow_factor:new o.ch(d)}),skybox:d=>({u_matrix:new o.ck(d),u_sun_direction:new o.ch(d),u_cubemap:new o.cg(d),u_opacity:new o.ci(d),u_temporal_offset:new o.ci(d)}),skyboxGradient:d=>({u_matrix:new o.ck(d),u_color_ramp:new o.cg(d),u_center_direction:new o.ch(d),u_radius:new o.ci(d),u_opacity:new o.ci(d),u_temporal_offset:new o.ci(d)}),skyboxCapture:d=>({u_matrix_3f:new o.dy(d),u_sun_direction:new o.ch(d),u_sun_intensity:new o.ci(d),u_color_tint_r:new o.d2(d),u_color_tint_m:new o.d2(d),u_luminance:new o.ci(d)}),globeRaster:d=>({u_proj_matrix:new o.ck(d),u_globe_matrix:new o.ck(d),u_normalize_matrix:new o.ck(d),u_merc_matrix:new o.ck(d),u_zoom_transition:new o.ci(d),u_merc_center:new o.cj(d),u_image0:new o.cg(d),u_grid_matrix:new o.dy(d),u_skirt_height:new o.ci(d),u_far_z_cutoff:new o.ci(d),u_frustum_tl:new o.ch(d),u_frustum_tr:new o.ch(d),u_frustum_br:new o.ch(d),u_frustum_bl:new o.ch(d),u_globe_pos:new o.ch(d),u_globe_radius:new o.ci(d),u_viewport:new o.cj(d)}),globeAtmosphere:d=>({u_frustum_tl:new o.ch(d),u_frustum_tr:new o.ch(d),u_frustum_br:new o.ch(d),u_frustum_bl:new o.ch(d),u_horizon:new o.ci(d),u_transition:new o.ci(d),u_fadeout_range:new o.ci(d),u_atmosphere_fog_color:new o.d2(d),u_high_color:new o.d2(d),u_space_color:new o.d2(d),u_temporal_offset:new o.ci(d),u_horizon_angle:new o.ci(d)}),model:d=>({u_matrix:new o.ck(d),u_lighting_matrix:new o.ck(d),u_normal_matrix:new o.ck(d),u_node_matrix:new o.ck(d),u_lightpos:new o.ch(d),u_lightintensity:new o.ci(d),u_lightcolor:new o.ch(d),u_camera_pos:new o.ch(d),u_opacity:new o.ci(d),u_baseColorFactor:new o.d2(d),u_emissiveFactor:new o.d2(d),u_metallicFactor:new o.ci(d),u_roughnessFactor:new o.ci(d),u_baseTextureIsAlpha:new o.cg(d),u_alphaMask:new o.cg(d),u_alphaCutoff:new o.ci(d),u_baseColorTexture:new o.cg(d),u_metallicRoughnessTexture:new o.cg(d),u_normalTexture:new o.cg(d),u_occlusionTexture:new o.cg(d),u_emissionTexture:new o.cg(d),u_lutTexture:new o.cg(d),u_color_mix:new o.d2(d),u_aoIntensity:new o.ci(d),u_emissive_strength:new o.ci(d),u_occlusionTextureTransform:new o.d2(d)}),modelDepth:d=>({u_matrix:new o.ck(d),u_instance:new o.ck(d),u_node_matrix:new o.ck(d)}),groundShadow:d=>({u_matrix:new o.ck(d),u_ground_shadow_factor:new o.ch(d)}),stars:d=>({u_matrix:new o.ck(d),u_up:new o.ch(d),u_right:new o.ch(d),u_intensity_multiplier:new o.ci(d)}),snowParticle:d=>({u_modelview:new o.ck(d),u_projection:new o.ck(d),u_time:new o.ci(d),u_cam_pos:new o.ch(d),u_velocityConeAperture:new o.ci(d),u_velocity:new o.ci(d),u_horizontalOscillationRadius:new o.ci(d),u_horizontalOscillationRate:new o.ci(d),u_boxSize:new o.ci(d),u_billboardSize:new o.ci(d),u_simpleShapeParameters:new o.cj(d),u_screenSize:new o.cj(d),u_thinningCenterPos:new o.cj(d),u_thinningShape:new o.ch(d),u_thinningAffectedRatio:new o.ci(d),u_thinningParticleOffset:new o.ci(d),u_particleColor:new o.d2(d),u_direction:new o.ch(d)}),rainParticle:d=>({u_modelview:new o.ck(d),u_projection:new o.ck(d),u_time:new o.ci(d),u_cam_pos:new o.ch(d),u_texScreen:new o.cg(d),u_velocityConeAperture:new o.ci(d),u_velocity:new o.ci(d),u_boxSize:new o.ci(d),u_rainDropletSize:new o.cj(d),u_distortionStrength:new o.ci(d),u_rainDirection:new o.ch(d),u_color:new o.d2(d),u_screenSize:new o.cj(d),u_thinningCenterPos:new o.cj(d),u_thinningShape:new o.ch(d),u_thinningAffectedRatio:new o.ci(d),u_thinningParticleOffset:new o.ci(d),u_shapeDirectionalPower:new o.ci(d),u_shapeNormalPower:new o.ci(d),u_mode:new o.ci(d)}),vignette:d=>({u_vignetteShape:new o.ch(d),u_vignetteColor:new o.d2(d)}),occlusion:d=>({u_matrix:new o.ck(d),u_anchorPos:new o.ch(d),u_screenSizePx:new o.cj(d),u_occluderSizePx:new o.cj(d),u_color:new o.d2(d)})};class gl{constructor(n,a,h,g){this.id=gl.uniqueIdxCounter,gl.uniqueIdxCounter++,this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||g||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=gl.uniqueIdxCounter,gl.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}gl.uniqueIdxCounter=0;const zv={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Bw{constructor(n,a,h,g,y,x){this.length=a.length,this.attributes=h,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.instanceCount=x,this.context=n;const T=n.gl;this.buffer=T.createBuffer(),n.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||y||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let h=0;h<this.attributes.length;h++){const g=a.getAttributeLocation(n,this.attributes[h].name);g!==-1&&n.enableVertexAttribArray(g)}}setVertexAttribPointers(n,a,h){for(let g=0;g<this.attributes.length;g++){const y=this.attributes[g],x=a.getAttributeLocation(n,y.name);x!==-1&&n.vertexAttribPointer(x,y.components,n[zv[y.type]],!1,this.itemSize,y.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(n,a,h){for(let g=0;g<this.attributes.length;g++){const y=a.getAttributeLocation(n,this.attributes[g].name);y!==-1&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(y,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Df{constructor(n,a,h,g,y){this.context=n,this.width=a,this.height=h;const x=this.framebuffer=n.gl.createFramebuffer();g&&(this.colorAttachment=new Mv(n,x)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new Rv(n,x):new Mw(n,x))}destroy(){const n=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&n.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&n.deleteTexture(a)}n.deleteFramebuffer(this.framebuffer)}}class xg{constructor(n,a){this.gl=n,this.clearColor=new bv(this),this.clearDepth=new Jm(this),this.clearStencil=new Sw(this),this.colorMask=new Ew(this),this.depthMask=new Iw(this),this.stencilMask=new Aw(this),this.stencilFunc=new Tv(this),this.stencilOp=new Cw(this),this.stencilTest=new mf(this),this.depthRange=new Pw(this),this.depthTest=new Sv(this),this.depthFunc=new Qm(this),this.blend=new gf(this),this.blendFunc=new eg(this),this.blendColor=new rc(this),this.blendEquation=new ru(this),this.cullFace=new _f(this),this.cullFaceSide=new yf(this),this.frontFace=new su(this),this.program=new Ev(this),this.activeTexture=new tg(this),this.viewport=new Iv(this),this.bindFramebuffer=new ou(this),this.bindRenderbuffer=new vf(this),this.bindTexture=new xf(this),this.bindVertexBuffer=new ng(this),this.bindElementBuffer=new wf(this),this.bindVertexArrayOES=new Oh(this),this.pixelStoreUnpack=new Av(this),this.pixelStoreUnpackPremultiplyAlpha=new Cv(this),this.pixelStoreUnpackFlipY=new Pv(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a,h){return new gl(this,n,a,h)}createVertexBuffer(n,a,h,g,y){return new Bw(this,n,a,h,g,y)}createRenderbuffer(n,a,h){const g=this.gl,y=g.createRenderbuffer();return this.bindRenderbuffer.set(y),g.renderbufferStorage(g.RENDERBUFFER,n,a,h),this.bindRenderbuffer.set(null),y}createFramebuffer(n,a,h,g){return new Df(this,n,a,h,g)}clear({color:n,depth:a,stencil:h,colorMask:g}){const y=this.gl;let x=0;n&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(g||[!0,!0,!0,!0])),a!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),y.clear(x)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){o.by(n.blendFunction,yn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let da;function jh(d,n,a,h,g,y,x){const T=d.context,I=T.gl,P=d.transform,R=[o.aF(P.center.lng),o.aJ(P.center.lat)],F=a.layout.get("symbol-placement"),D=a.layout.get("text-variable-anchor"),j=a.layout.get("icon-rotation-alignment")==="map",U=a.layout.get("text-rotation-alignment")==="map",G=F!=="point",J=[];let Z=0,ee=0;for(let me=0;me<h.length;me++){const xe=h[me],Ne=n.getTile(xe),Re=Ne.getBucket(a);if(!Re)continue;const qe=Re.getProjection().createInversionMatrix(P,xe.canonical),Oe=[],We=dv(xe,Re,P),gt=!x&&j&&G,Fe=x&&U&&G,Ce=D&&Re.hasTextData(),Ze=Re.hasIconTextFit()&&Ce&&Re.hasIconData(),Ve=gt||Fe||x&&Ce||Ze,it=Re.projection.name==="globe",mt=it?o.aj(P.zoom):0;it&&(Oe.push("PROJECTION_GLOBE_VIEW"),Ve&&Oe.push("PROJECTED_POS_ON_VIEWPORT"));const It=d.getOrCreateProgram("collisionBox",{defines:Oe});let ht=We;g[0]===0&&g[1]===0||(ht=d.translatePosMatrix(We,Ne,g,y));const at=x?Re.textCollisionBox:Re.iconCollisionBox,jt=Re.collisionCircleArray;if(jt.length>0){const Bt=o.bC(),zt=ht;o.cO(Bt,Re.placementInvProjMatrix,P.glCoordMatrix),o.cO(Bt,Bt,Re.placementViewportMatrix),J.push({circleArray:jt,circleOffset:ee,transform:zt,invTransform:Bt,projection:Re.getProjection()}),Z+=jt.length/4,ee=Z}if(!at)continue;d.terrain&&d.terrain.setupElevationDraw(Ne,It);const Ot=it?[xe.canonical.x,xe.canonical.y,1<<xe.canonical.z]:[0,0,0];It.draw(d,I.LINES,Ct.disabled,Jt.disabled,d.colorModeForRenderPass(),nn.disabled,dg(ht,qe,P,mt,R,Ne,Ot,Re.getProjection()),a.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,null,P.zoom,null,[at.collisionVertexBuffer,at.collisionVertexBufferExt])}if(!x||!J.length)return;const oe=d.getOrCreateProgram("collisionCircle"),ue=new o.dW;ue.resize(4*Z),ue._trim();let ye=0;for(const me of J)for(let xe=0;xe<me.circleArray.length/4;xe++){const Ne=4*xe,Re=me.circleArray[Ne+0],qe=me.circleArray[Ne+1],Oe=me.circleArray[Ne+2],We=me.circleArray[Ne+3];ue.emplace(ye++,Re,qe,Oe,We,0),ue.emplace(ye++,Re,qe,Oe,We,1),ue.emplace(ye++,Re,qe,Oe,We,2),ue.emplace(ye++,Re,qe,Oe,We,3)}(!da||da.length<2*Z)&&(da=function(me){const xe=2*me,Ne=new o.b1;Ne.resize(xe),Ne._trim();for(let Re=0;Re<xe;Re++){const qe=6*Re;Ne.uint16[qe+0]=4*Re+0,Ne.uint16[qe+1]=4*Re+1,Ne.uint16[qe+2]=4*Re+2,Ne.uint16[qe+3]=4*Re+2,Ne.uint16[qe+4]=4*Re+3,Ne.uint16[qe+5]=4*Re+0}return Ne}(Z));const ge=T.createIndexBuffer(da,!0),ve=T.createVertexBuffer(ue,o.dX.members,!0);for(const me of J){const xe={u_matrix:me.transform,u_inv_matrix:me.invTransform,u_camera_to_center_distance:(_e=P).getCameraToCenterDistance(me.projection),u_viewport_size:[_e.width,_e.height]};oe.draw(d,I.TRIANGLES,Ct.disabled,Jt.disabled,d.colorModeForRenderPass(),nn.disabled,xe,a.id,ve,ge,o.bg.simpleSegment(0,2*me.circleOffset,me.circleArray.length,me.circleArray.length/2),null,P.zoom)}var _e;ve.destroy(),ge.destroy()}const _l=o.bC();function wg(d){const n=d._camera.getWorldToCamera(d.worldSize,1),a=o.aB([],n,d.globeMatrix);o.bl(a,a);const h=[0,0,0],g=[0,1,0,0];return o.aC(g,g,a),h[0]=g[0],h[1]=g[1],h[2]=g[2],o.aw(h,h),h}function Lf({width:d,height:n,anchor:a,textOffset:h,textScale:g},y){const{horizontalAlign:x,verticalAlign:T}=o.c0(a),I=-(x-.5)*d,P=-(T-.5)*n,R=o.c1(a,h);return new o.P((I/g+R[0])*y,(P/g+R[1])*y)}function zf(d,n,a,h,g,y,x,T,I,P){const R=d.text.placedSymbolArray,F=d.text.dynamicLayoutVertexArray,D=d.icon.dynamicLayoutVertexArray,j={},U=d.getProjection(),G=Jl(x,U,g),J=g.elevation,Z=U.upVectorScale(x.canonical,g.center.lat,g.worldSize).metersToTile;F.clear();for(let ee=0;ee<R.length;ee++){const oe=R.get(ee),{tileAnchorX:ue,tileAnchorY:ye,numGlyphs:ge}=oe,ve=oe.hidden||!oe.crossTileID||d.allowVerticalPlacement&&!oe.placedOrientation?null:h[oe.crossTileID];if(ve){let _e=0,me=0,xe=0;if(J){const Ze=J?J.getAtTileOffset(x,ue,ye):0,[Ve,it,mt]=U.upVector(x.canonical,ue,ye);_e=Ze*Ve*Z,me=Ze*it*Z,xe=Ze*mt*Z}let[Ne,Re,qe,Oe]=ao(oe.projectedAnchorX+_e,oe.projectedAnchorY+me,oe.projectedAnchorZ+xe,a?G:y);const We=Ql(g.getCameraToCenterDistance(U),Oe);let gt=o.bM(d.textSizeData,I,oe)*We/o.bX;a&&(gt*=d.tilePixelRatio/T);const Fe=Lf(ve,gt);a?({x:Ne,y:Re,z:qe}=U.projectTilePoint(ue+Fe.x,ye+Fe.y,x.canonical),[Ne,Re,qe]=ao(Ne+_e,Re+me,qe+xe,y)):(n&&Fe._rotate(-g.angle),Ne+=Fe.x,Re+=Fe.y,qe=0);const Ce=d.allowVerticalPlacement&&oe.placedOrientation===o.bL.vertical?Math.PI/2:0;for(let Ze=0;Ze<ge;Ze++)o.bO(F,Ne,Re,qe,Ce);P&&oe.associatedIconIndex>=0&&(j[oe.associatedIconIndex]={x:Ne,y:Re,z:qe,angle:Ce})}else Kt(ge,F)}if(P){D.clear();const ee=d.icon.placedSymbolArray;for(let oe=0;oe<ee.length;oe++){const ue=ee.get(oe),{numGlyphs:ye}=ue,ge=j[oe];if(ue.hidden||!ge)Kt(ye,D);else{const{x:ve,y:_e,z:me,angle:xe}=ge;for(let Ne=0;Ne<ye;Ne++)o.bO(D,ve,_e,me,xe)}}d.icon.dynamicLayoutVertexBuffer.updateData(D)}d.text.dynamicLayoutVertexBuffer.updateData(F)}function Vh(d,n,a,h,g,y,x={}){const T=a.paint.get("icon-translate"),I=a.paint.get("text-translate"),P=a.paint.get("icon-translate-anchor"),R=a.paint.get("text-translate-anchor"),F=a.layout.get("icon-rotation-alignment"),D=a.layout.get("text-rotation-alignment"),j=a.layout.get("icon-pitch-alignment"),U=a.layout.get("text-pitch-alignment"),G=a.layout.get("icon-keep-upright"),J=a.layout.get("text-keep-upright"),Z=a.paint.get("icon-color-saturation"),ee=a.paint.get("icon-color-contrast"),oe=a.paint.get("icon-color-brightness-min"),ue=a.paint.get("icon-color-brightness-max"),ye=a.layout.get("symbol-elevation-reference")==="sea",ge=a.layout.get("icon-image-use-theme")==="none",ve=d.context,_e=ve.gl,me=d.transform,xe=F==="map",Ne=D==="map",Re=j==="map",qe=U==="map",Oe=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let We=!1;const gt=d.depthModeForSublayer(0,Ct.ReadOnly),Fe=new Ct(d.context.gl.LEQUAL,Ct.ReadOnly,d.depthRangeFor3D),Ce=[o.aF(me.center.lng),o.aJ(me.center.lat)],Ze=a.layout.get("text-variable-anchor"),Ve=me.projection.name==="globe",it=[],mt=[0,-1,0];for(const It of h){const ht=n.getTile(It),at=ht.getBucket(a);if(!at||at.projection.name==="mercator"&&Ve||at.fullyClipped)continue;const jt=at.projection.name==="globe",Ot=jt?o.aj(me.zoom):0,Bt=Jl(It,at.getProjection(),me),zt=me.calculatePixelsToTileUnitsMatrix(ht),rn=Ze&&at.hasTextData(),gn=at.hasIconTextFit()&&rn&&at.hasIconData(),vn=at.getProjection().createInversionMatrix(me,It.canonical),ei=(1<<ht.tileID.canonical.z)*o.al/d.transform.worldSize,hn=Ci=>{let xn=[0,0,0];if(Ci){const Qt=d.style.directionalLight,ti=d.style.ambientLight;Qt&&ti&&(xn=Uo(d.style,Qt,ti))}return xn},jn=Ci=>{me.depthOcclusionForSymbolsAndCircles&&(a.hasOcclusionOpacityProperties||d.terrain)&&(Ci.push("DEPTH_D24"),Ci.push("DEPTH_OCCLUSION"))},Yn=Ci=>{a.lut&&!ge&&(a.lut.texture||(a.lut.texture=new o.dY(d.context,a.lut.image,[a.lut.image.height,a.lut.image.height,a.lut.image.height],ve.gl.RGBA8)),ve.activeTexture.set(ve.gl.TEXTURE0+er.LUT),a.lut.texture&&a.lut.texture.bind(ve.gl.LINEAR,ve.gl.CLAMP_TO_EDGE),Ci.push("APPLY_LUT_ON_GPU"))},Ei=()=>{const Ci=xe&&a.layout.get("symbol-placement")!=="point",xn=[];jn(xn),Yn(xn);const Qt=Ci||gn,ti=at.elevationType==="road",Ui=d.shadowRenderer,ki=ti&&Re&&!!Ui&&Ui.enabled,tr=hn(ki),Br=ti&&Re&&!d.terrain?Fe:gt,po=a.paint.get("icon-image-cross-fade");d.terrainRenderModeElevated()&&Re&&xn.push("PITCH_WITH_MAP_TERRAIN"),jt&&(xn.push("PROJECTION_GLOBE_VIEW"),Qt&&xn.push("PROJECTED_POS_ON_VIEWPORT")),po>0&&at.hasAnySecondaryIcon&&xn.push("ICON_TRANSITION"),!at.icon.zOffsetVertexBuffer||ti&&d.terrain||xn.push("Z_OFFSET"),Z===0&&ee===0&&oe===0&&ue===1||xn.push("COLOR_ADJUSTMENT"),at.sdfIcons&&xn.push("RENDER_SDF"),ki&&xn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ti&&Re&&!d.terrain&&at.icon.orientationVertexBuffer&&xn.push("ELEVATED_ROADS");const mo=at.icon.programConfigurations.get(a.id),Vs=d.getOrCreateProgram("symbol",{config:mo,defines:xn}),Us=ht.imageAtlasTexture?ht.imageAtlasTexture.size:[0,0],ws=at.iconSizeData,Po=o.bK(ws,me.zoom),Wo=Re||!me.isOrthographic,qi=Bo(Bt,ht.tileID.canonical,Re,xe,me,at.getProjection(),zt),Ki=Jd(Bt,ht.tileID.canonical,Re,xe,me,at.getProjection(),zt),Di=d.translatePosMatrix(Ki,ht,T,P,!0),fr=d.translatePosMatrix(Bt,ht,T,P),Cr=Qt?_l:qi,Ji=xe&&!Re&&!Ci;let ts=mt;!Ve&&!me.mercatorFromTransition||xe||(ts=wg(me));const ga=jt?ts:mt,Fa=a.getColorAdjustmentMatrix(Z,ee,oe,ue),qo=yg(ws.kind,Po,Ji,Re,d,fr,Cr,Di,ye,!1,Us,[0,0],0,It,Ot,Ce,vn,ga,at.getProjection(),tr,ei,Fa,po,null),Il=ht.imageAtlasTexture?ht.imageAtlasTexture:null,Al=a.layout.get("icon-size").constantOr(0)!==1||at.iconsNeedLinear,_a=at.sdfIcons||d.options.rotating||d.options.zooming||Al||Wo?_e.LINEAR:_e.NEAREST,wu=at.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,Na=d.terrain&&Re&&Ci?o.bl(o.bC(),qi):_l;if(Ci&&at.icon){const ya=me.elevation,Ba=ya?ya.getAtTileOffsetFunc(It,me.center.lat,me.worldSize,at.getProjection()):null,np=Sh(Bt,ht.tileID.canonical,Re,xe,me,at.getProjection(),zt);jm(at,Bt,d,!1,np,Ki,Re,G,Ba,It)}return{program:Vs,buffers:at.icon,uniformValues:qo,atlasTexture:Il,atlasTextureIcon:null,atlasInterpolation:_a,atlasInterpolationIcon:null,isSDF:at.sdfIcons,hasHalo:wu,depthMode:Br,tile:ht,renderWithShadows:ki,labelPlaneMatrixInv:Na}},_n=()=>{const Ci=Ne&&a.layout.get("symbol-placement")!=="point",xn=[],Qt=Ci||Ze||gn,ti=at.elevationType==="road",Ui=d.shadowRenderer,ki=ti&&qe&&!!Ui&&Ui.enabled,tr=hn(ki),Br=ti&&qe&&!d.terrain?Fe:gt;d.terrainRenderModeElevated()&&qe&&xn.push("PITCH_WITH_MAP_TERRAIN"),jt&&(xn.push("PROJECTION_GLOBE_VIEW"),Qt&&xn.push("PROJECTED_POS_ON_VIEWPORT")),!at.text.zOffsetVertexBuffer||ti&&d.terrain||xn.push("Z_OFFSET"),at.iconsInText&&xn.push("RENDER_TEXT_AND_SYMBOL"),xn.push("RENDER_SDF"),ki&&xn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ti&&qe&&!d.terrain&&at.text.orientationVertexBuffer&&xn.push("ELEVATED_ROADS"),jn(xn);const po=at.text.programConfigurations.get(a.id),mo=d.getOrCreateProgram("symbol",{config:po,defines:xn});let Vs,Us=[0,0],ws=null;const Po=at.textSizeData;at.iconsInText&&(Us=ht.imageAtlasTexture?ht.imageAtlasTexture.size:[0,0],ws=ht.imageAtlasTexture?ht.imageAtlasTexture:null,Vs=qe||!me.isOrthographic||d.options.rotating||d.options.zooming||Po.kind==="composite"||Po.kind==="camera"?_e.LINEAR:_e.NEAREST);const Wo=ht.glyphAtlasTexture?ht.glyphAtlasTexture.size:[0,0],qi=a.layout.get("text-size-scale-range"),Ki=o.aA(d.scaleFactor,qi[0],qi[1]),Di=o.bK(Po,me.zoom,Ki),fr=Bo(Bt,ht.tileID.canonical,qe,Ne,me,at.getProjection(),zt),Cr=Jd(Bt,ht.tileID.canonical,qe,Ne,me,at.getProjection(),zt),Ji=d.translatePosMatrix(Cr,ht,I,R,!0),ts=d.translatePosMatrix(Bt,ht,I,R),ga=Qt?_l:fr,Fa=Ne&&!qe&&!Ci;let qo=mt;!Ve&&!me.mercatorFromTransition||Ne||(qo=wg(me));const Il=yg(Po.kind,Di,Fa,qe,d,ts,ga,Ji,ye,!0,Wo,Us,0,It,Ot,Ce,vn,jt?qo:mt,at.getProjection(),tr,ei,null,null,Ki),Al=ht.glyphAtlasTexture?ht.glyphAtlasTexture:null,_a=_e.LINEAR,wu=a.paint.get("text-halo-width").constantOr(1)!==0,Na=d.terrain&&qe&&Ci?o.bl(o.bC(),fr):_l;if(Ci&&at.text){const ya=me.elevation,Ba=ya?ya.getAtTileOffsetFunc(It,me.center.lat,me.worldSize,at.getProjection()):null,np=Sh(Bt,ht.tileID.canonical,qe,Ne,me,at.getProjection(),zt);jm(at,Bt,d,!0,np,Cr,qe,J,Ba,It)}return{program:mo,buffers:at.text,uniformValues:Il,atlasTexture:Al,atlasTextureIcon:ws,atlasInterpolation:_a,atlasInterpolationIcon:Vs,isSDF:!0,hasHalo:wu,depthMode:Br,tile:ht,renderWithShadows:ki,labelPlaneMatrixInv:Na}},$n=at.icon.segments.get().length,Un=at.text.segments.get().length,Zn=$n&&!x.onlyText?Ei():null,Ai=Un&&!x.onlyIcons?_n():null,Xi=a.paint.get("icon-opacity").constantOr(1),Ar=a.paint.get("text-opacity").constantOr(1);if(Oe&&at.canOverlap){We=!0;const Ci=Xi&&!x.onlyText?at.icon.segments.get():[],xn=Ar&&!x.onlyIcons?at.text.segments.get():[];for(const Qt of Ci)it.push({segments:new o.bg([Qt]),sortKey:Qt.sortKey,state:Zn});for(const Qt of xn)it.push({segments:new o.bg([Qt]),sortKey:Qt.sortKey,state:Ai})}else x.onlyText||it.push({segments:Xi?at.icon.segments:new o.bg([]),sortKey:0,state:Zn}),x.onlyIcons||it.push({segments:Ar?at.text.segments:new o.bg([]),sortKey:0,state:Ai})}We&&it.sort((It,ht)=>It.sortKey-ht.sortKey);for(const It of it){const ht=It.state;if(ht)if(d.terrain?d.terrain.setupElevationDraw(ht.tile,ht.program,{useDepthForOcclusion:me.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ht.labelPlaneMatrixInv}):d.setupDepthForOcclusion(me.depthOcclusionForSymbolsAndCircles,ht.program),ve.activeTexture.set(_e.TEXTURE0),ht.atlasTexture&&ht.atlasTexture.bind(ht.atlasInterpolation,_e.CLAMP_TO_EDGE,!0),ht.atlasTextureIcon&&(ve.activeTexture.set(_e.TEXTURE1),ht.atlasTextureIcon&&ht.atlasTextureIcon.bind(ht.atlasInterpolationIcon,_e.CLAMP_TO_EDGE,!0)),ht.renderWithShadows&&d.shadowRenderer.setupShadows(ht.tile.tileID.toUnwrapped(),ht.program,"vector-tile"),d.uploadCommonLightUniforms(d.context,ht.program),ht.hasHalo){const at=ht.uniformValues;at.u_is_halo=1,Of(ht.buffers,It.segments,a,d,ht.program,ht.depthMode,g,y,at,2),at.u_is_halo=0}else{if(ht.isSDF){const at=ht.uniformValues;ht.hasHalo&&(at.u_is_halo=1,Of(ht.buffers,It.segments,a,d,ht.program,ht.depthMode,g,y,at,1)),at.u_is_halo=0}Of(ht.buffers,It.segments,a,d,ht.program,ht.depthMode,g,y,ht.uniformValues,1)}}}function Of(d,n,a,h,g,y,x,T,I,P){const R=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer,d.orientationVertexBuffer];g.draw(h,h.context.gl.TRIANGLES,y,x,T,nn.disabled,I,a.id,d.layoutVertexBuffer,d.indexBuffer,n,a.paint,h.transform.zoom,d.programConfigurations.get(a.id),R,P)}function Ov(d,n){const a=1<<d.canonical.z,h=(n.x*a-d.canonical.x-d.wrap*a)*o.al,g=(n.y*a-d.canonical.y)*o.al,y=o.e5(n.z,n.y);return o.d4(h,g,y)}function uc(d,n,a,h,g){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const y=d.context.gl,x=new Ct(d.context.gl.LEQUAL,Ct.ReadWrite,d.depthRangeFor3D),T=new Ct(d.context.gl.GREATER,Ct.ReadWrite,d.depthRangeFor3D),I=function(j){let U=.01;return j.isOrthographic&&(U=o.ak(1e-4,U,o.c$(j.pitch>=ka?1:j.pitch/ka))),2*U}(d.transform),P=d.transform.getFreeCameraOptions().position,R="elevatedStructuresDepthReconstruct",F=d.getOrCreateProgram(R,{defines:["DEPTH_RECONSTRUCTION"]}),D=d.getOrCreateProgram(R);for(const j of h){const U=n.getTile(j),G=U.getBucket(a);if(!G)continue;const J=G.elevatedStructures;if(!J)continue;const Z=G.elevationBufferData.heightRange,ee=Ov(j.toUnwrapped(),P),oe=d.translatePosMatrix(j.projMatrix,U,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let ue,ye,ge,ve;if(g==="initialize"){if(!Z||Z.min>=1||J.depthSegments.segments[0].primitiveLength===0)continue;ue=Af(oe,ee,I,1,0),ye=x,ge=J.depthSegments,ve=F}else if(g==="reset"){if(!Z||Z.min>=0||J.maskSegments.segments[0].primitiveLength===0)continue;ue=Af(oe,ee,0,0,1),ye=T,ge=J.maskSegments,ve=F}else if(g==="geometry"){if(J.depthSegments.segments[0].primitiveLength===0)continue;ue=Af(oe,ee,I,1,0),ye=x,ge=J.depthSegments,ve=D}ve.draw(d,y.TRIANGLES,ye,Jt.disabled,yn.disabled,nn.disabled,ue,a.id,J.vertexBuffer,J.indexBuffer,ge,a.paint,d.transform.zoom)}}function uu(d,n,a){const{painter:h,sourceCache:g,layer:y,coords:x,colorMode:T,elevationType:I,terrainEnabled:P,pass:R}=d,F=h.context.gl,D=y.paint.get("fill-pattern"),j=y.paint.get("fill-pattern-cross-fade"),U=D.constantOr(null);let G=I;I!=="road"||n&&!P||(G="none");const J=G==="road",Z=d.painter.shadowRenderer,ee=J&&!!Z&&Z.enabled,oe=new Ct(h.context.gl.LEQUAL,Ct.ReadOnly,h.depthRangeFor3D);let ue=[0,0,0];if(ee){const ve=h.style.directionalLight,_e=h.style.ambientLight;ve&&_e&&(ue=Uo(h.style,ve,_e))}const ye=D&&D.constantOr(1),ge=(ve,_e)=>{let me,xe,Ne,Re,qe;_e?(me=ye&&!y.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ne=F.LINES):(me=ye?"fillPattern":"fill",Ne=F.TRIANGLES);for(const Oe of x){const We=g.getTile(Oe);if(ye&&!We.patternsLoaded())continue;const gt=We.getBucket(y);if(!gt)continue;const Fe=n?gt.elevationBufferData:gt.bufferData;if(Fe.isEmpty())continue;h.prepareDrawTile();const Ce=Fe.programConfigurations.get(y.id),Ze=h.isTileAffectedByFog(Oe),Ve=[],it=[];J&&(Ve.push("ELEVATED_ROADS"),it.push(Fe.elevatedLayoutVertexBuffer)),ee&&Ve.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ye&&(h.context.activeTexture.set(F.TEXTURE0),We.imageAtlasTexture&&We.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Ce.updatePaintBuffers());let mt=!1;if(U&&We.imageAtlas){const Ot=We.imageAtlas,Bt=o.e0.from(U),zt=Bt.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),rn=Bt.getSecondary(),gn=Ot.patternPositions.get(zt),vn=rn?Ot.patternPositions.get(rn.scaleSelf(o.o.devicePixelRatio).toString()):null;mt=!!gn&&!!vn,gn&&Ce.setConstantPatternPositions(gn,vn)}j>0&&(mt||Ce.getPatternTransitionVertexBuffer("fill-pattern"))&&Ve.push("FILL_PATTERN_TRANSITION");const It=h.getOrCreateProgram(me,{config:Ce,overrideFog:Ze,defines:Ve}),ht=h.translatePosMatrix(Oe.projMatrix,We,y.paint.get("fill-translate"),y.paint.get("fill-translate-anchor"));ee&&Z.setupShadows(We.tileID.toUnwrapped(),It,"vector-tile");const at=y.paint.get("fill-emissive-strength");if(_e){Re=Fe.lineIndexBuffer,qe=Fe.lineSegments;const Ot=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];xe=me==="fillOutlinePattern"&&ye?Lw(ht,at,h,We,Ot,ue,j):Dw(ht,at,Ot,ue)}else Re=Fe.indexBuffer,qe=Fe.triangleSegments,xe=ye?ac(ht,at,h,We,ue,j):ug(ht,at,ue);h.uploadCommonUniforms(h.context,It,Oe.toUnwrapped());let jt=ve;(I==="road"&&!P||I==="offset")&&(jt=oe),It.draw(h,Ne,jt,a||h.stencilModeForClipping(Oe),T,nn.disabled,xe,y.id,Fe.layoutVertexBuffer,Re,qe,y.paint,h.transform.zoom,Ce,it)}};h.renderPass===R&&ge(h.depthModeForSublayer(1,h.renderPass==="opaque"?Ct.ReadWrite:Ct.ReadOnly),!1),G==="none"&&h.renderPass==="translucent"&&y.paint.get("fill-antialias")&&ge(h.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,Ct.ReadOnly),!0)}function Pt(d,n,a,h,g,y,x,T){a.resetLayerRenderingStats(d);const I=d.context,P=I.gl,R=d.transform,F=a.paint.get("fill-extrusion-pattern"),D=a.paint.get("fill-extrusion-pattern-cross-fade"),j=F.constantOr(null),U=F.constantOr(1),G=a.paint.get("fill-extrusion-opacity"),J=d.style.enable3dLights(),Z=a.paint.get(J&&!U?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ee=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],oe=a.layout.get("fill-extrusion-edge-radius"),ue=oe>0&&!a.paint.get("fill-extrusion-rounded-roof"),ye=ue?0:oe,ge=R.projection.name==="globe"?o.e8():0,ve=R.projection.name==="globe",_e=ve?o.aj(R.zoom):0,me=[o.aF(R.center.lng),o.aJ(R.center.lat)],xe=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ne=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(xe?null:a.lut).toArray01().slice(0,3),Re=a.paint.get("fill-extrusion-flood-light-intensity"),qe=a.paint.get("fill-extrusion-vertical-scale"),Oe=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,We=a.paint.get("fill-extrusion-height-alignment"),gt=a.paint.get("fill-extrusion-base-alignment"),Fe=hl(d,a.paint.get("fill-extrusion-cutoff-fade-range")),Ce=[];let Ze;ve&&Ce.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&Ce.push("FAUX_AO"),ue&&Ce.push("ZERO_ROOF_RADIUS"),T&&Ce.push("HAS_CENTROID"),Re>0&&Ce.push("FLOOD_LIGHT"),Fe.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF"),Oe&&Ce.push("RENDER_WALL_MODE");const Ve=d.renderPass==="shadow",it=d.shadowRenderer,mt=Ve&&!!it,It=Ve?nn.disabled:nn.backCCW;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let ht=[0,0,0];if(it){const Ot=d.style.directionalLight,Bt=d.style.ambientLight;Ot&&Bt&&(ht=Uo(d.style,Ot,Bt)),Ve||(Ce.push("RENDER_SHADOWS","DEPTH_TEXTURE"),it.useNormalOffset&&Ce.push("NORMAL_OFFSET")),Ze=Ce.concat(["SHADOWS_SINGLE_CASCADE"])}const at=mt?"fillExtrusionDepth":U?"fillExtrusionPattern":"fillExtrusion",jt=a.getLayerRenderingStats();for(const Ot of h){const Bt=n.getTile(Ot),zt=Bt.getBucket(a);if(!zt||zt.projection.name!==R.projection.name)continue;let rn=!1;it&&(rn=it.getMaxCascadeForTile(Ot.toUnwrapped())===0);const gn=d.isTileAffectedByFog(Ot),vn=zt.programConfigurations.get(a.id);let ei=!1;if(j&&Bt.imageAtlas){const Un=Bt.imageAtlas,Zn=o.e0.from(j),Ai=Zn.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),Xi=Zn.getSecondary(),Ar=Un.patternPositions.get(Ai),Ci=Xi?Un.patternPositions.get(Xi.scaleSelf(o.o.devicePixelRatio).toString()):null;ei=!!Ar&&!!Ci,Ar&&vn.setConstantPatternPositions(Ar,Ci)}D>0&&(ei||vn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ce.push("FILL_EXTRUSION_PATTERN_TRANSITION");const hn=d.getOrCreateProgram(at,{config:vn,defines:rn?Ze:Ce,overrideFog:gn});if(d.terrain&&d.terrain.setupElevationDraw(Bt,hn,{useMeterToDem:!0}),!zt.centroidVertexBuffer){const Un=hn.getAttributeLocation(P,"a_centroid_pos");Un!==-1&&P.vertexAttrib2f(Un,0,0)}!Ve&&it&&it.setupShadows(Bt.tileID.toUnwrapped(),hn,"vector-tile"),U&&(d.context.activeTexture.set(P.TEXTURE0),Bt.imageAtlasTexture&&Bt.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),vn.updatePaintBuffers());const jn=a.paint.get("fill-extrusion-vertical-gradient"),Yn=1/zt.tileToMeter;let Ei;if(Ve&&it){if(Fv(Bt.tileID,zt.maxHeight,d))continue;const Un=it.calculateShadowPassMatrixFromTile(Bt.tileID.toUnwrapped());Ei=cg(Un,ye,Yn,qe,We,gt)}else{const Un=d.translatePosMatrix(Ot.expandedProjMatrix,Bt,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Zn=R.projection.createInversionMatrix(R,Ot.canonical);Ei=U?Dv(Un,d,jn,G,ee,ye,Yn,Ot,Bt,ge,We,gt,_e,me,Zn,Ne,qe,D):Bh(Un,d,jn,G,ee,ye,Yn,Ot,ge,We,gt,_e,me,Zn,Ne,qe,Re,ht)}d.uploadCommonUniforms(I,hn,Ot.toUnwrapped(),null,Fe);let _n=zt.segments;if(R.projection.name==="mercator"&&!Ve&&(_n=zt.getVisibleSegments(Bt.tileID,d.terrain,d.transform.getFrustum(0)),!_n.get().length))continue;if(jt)if(Ve)for(const Un of _n.get())jt.numRenderedVerticesInShadowPass+=Un.primitiveLength;else for(const Un of _n.get())jt.numRenderedVerticesInTransparentPass+=Un.primitiveLength;const $n=[];(d.terrain||T)&&$n.push(zt.centroidVertexBuffer),ve&&$n.push(zt.layoutVertexExtBuffer),Oe&&$n.push(zt.wallVertexBuffer),hn.draw(d,I.gl.TRIANGLES,g,y,x,It,Ei,a.id,zt.layoutVertexBuffer,zt.indexBuffer,_n,a.paint,d.transform.zoom,vn,$n)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}class bg{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Da(d,n,a,h,g,y,x,T,I,P,R,F,D,j,U,G,J,Z,ee,oe){const ue=n.context,ye=ue.gl,ge=n.transform,ve=n.transform.zoom,_e=[],me=d.translate,xe=d.translateAnchor,Ne=d.edgeRadius,Re=hl(n,d.cutoffFadeRange);R==="clear"?(_e.push("CLEAR_SUBPASS"),oe&&(_e.push("CLEAR_FROM_TEXTURE"),ue.activeTexture.set(ye.TEXTURE0),oe.bind(ye.LINEAR,ye.CLAMP_TO_EDGE))):R==="sdf"&&_e.push("SDF_SUBPASS"),Z&&_e.push("HAS_CENTROID"),Re.shouldRenderCutoff&&_e.push("RENDER_CUTOFF");const qe=(Oe,We,gt,Fe,Ce)=>{const Ze=We.programConfigurations.get(h.id),Ve=n.isTileAffectedByFog(Oe),it=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ze,defines:_e,overrideFog:Ve}),mt=((ht,at,jt,Ot,Bt,zt,rn,gn,vn,ei,hn)=>({u_matrix:at,u_opacity:jt,u_ao_pass:Ot?1:0,u_meter_to_tile:Bt,u_ao:zt,u_flood_light_intensity:rn,u_flood_light_color:gn,u_attenuation:vn,u_edge_radius:ei,u_fb:0,u_fb_size:hn,u_dynamic_offset:1}))(0,Fe,F,P,Ce,[D,j*Ce],U,G,J,ve>=17?0:Ne*Ce,oe?oe.size[0]:0),It=[];Z&&It.push(We.hiddenByLandmarkVertexBuffer),n.uploadCommonUniforms(ue,it,Oe.toUnwrapped(),null,Re),it.draw(n,ue.gl.TRIANGLES,y,x,T,I,mt,h.id,We.vertexBuffer,We.indexBuffer,gt,h.paint,ve,Ze,It)};for(const Oe of g){const We=a.getTile(Oe),gt=We.getBucket(h);if(!gt||gt.projection.name!==ge.projection.name||!gt.groundEffect||gt.groundEffect&&!gt.groundEffect.hasData())continue;const Fe=gt.groundEffect,Ce=1/gt.tileToMeter;{const Ze=n.translatePosMatrix(Oe.projMatrix,We,me,xe),Ve=Fe.getDefaultSegment();qe(Oe,Fe,Ve,Ze,Ce)}if(ee)for(let Ze=0;Ze<4;Ze++){const Ve=o.e6[Ze](Oe),it=a.getTile(Ve);if(!it)continue;const mt=it.getBucket(h);if(!mt||mt.projection.name!==ge.projection.name||!mt.groundEffect||mt.groundEffect&&!mt.groundEffect.hasData())continue;const It=mt.groundEffect;let ht,at;Ze===0?(ht=[-o.al,0,0],at=1):Ze===1?(ht=[o.al,0,0],at=0):Ze===2?(ht=[0,-o.al,0],at=3):(ht=[0,o.al,0],at=2);const jt=It.regionSegments[at];if(!jt)continue;const Ot=new Float32Array(16);o.br(Ot,Oe.projMatrix,ht),qe(Oe,It,jt,n.translatePosMatrix(Ot,We,me,xe),Ce)}}}function yl(d,n,a,h,g,y,x){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();const T=y?y.findDEMTileFor(a):null;if(!(T&&T.dem||x))return;y&&T&&T.dem&&h.selfDEMTileTimestamp!==T.dem._timestamp&&(h.borderDoneWithNeighborZ=[-1,-1,-1,-1],h.selfDEMTileTimestamp=T.dem._timestamp);const I=Z=>new o.P(Math.ceil((Z+o.ea)*o.eb),0),P=Z=>{const ee=n.getSource().minzoom,oe=ye=>{const ge=n.getTileByID(ye);if(ge&&ge.hasData())return ge.getBucket(g)},ue=[0,-1,1];for(const ye of ue){if(Z.overscaledZ+ye<ee)continue;const ge=oe(Z.calculateScaledKey(Z.overscaledZ+ye));if(ge)return ge}},R=[0,0,0],F=(Z,ee)=>(R[0]=Math.min(Z.min.y,ee.min.y),R[1]=Math.max(Z.max.y,ee.max.y),R[2]=o.al-ee.min.x>Z.max.x?ee.min.x-o.al:Z.max.x,R),D=(Z,ee)=>(R[0]=Math.min(Z.min.x,ee.min.x),R[1]=Math.max(Z.max.x,ee.max.x),R[2]=o.al-ee.min.y>Z.max.y?ee.min.y-o.al:Z.max.y,R),j=[(Z,ee)=>F(Z,ee),(Z,ee)=>F(ee,Z),(Z,ee)=>D(Z,ee),(Z,ee)=>D(ee,Z)],U=(Z,ee,oe,ue,ye,ge,ve)=>{if(!y)return 0;const _e=[[ge?oe:Z,ge?Z:oe,0],[ge?oe:ee,ge?ee:oe,0]],me=ve<0?o.al+ve:ve,xe=[ge?me:(Z+ee)/2,ge?(Z+ee)/2:me,0];return oe===0&&ve<0||oe!==0&&ve>0?y.getForTilePoints(ye,[xe],!0,ue):_e.push(xe),y.getForTilePoints(a,_e,!0,T),Math.max(_e[0][2],_e[1][2],xe[2])/y.exaggeration()};for(let Z=0;Z<4;Z++){const ee=h.borderFeatureIndices[Z];if(ee.length===0)continue;const oe=o.e6[Z](a),ue=P(oe);if(!(ue&&ue instanceof o.e7))continue;const ye=y?y.findDEMTileFor(oe):null;if(!(ye&&ye.dem||x)||(y&&ye&&ye.dem&&h.borderDEMTileTimestamp[Z]!==ye.dem._timestamp&&(h.borderDoneWithNeighborZ[Z]=-1,h.borderDEMTileTimestamp[Z]=ye.dem._timestamp),h.borderDoneWithNeighborZ[Z]===ue.canonical.z))continue;ue.centroidVertexArray.length===0&&ue.createCentroidsBuffer();const ge=(Z<2?1:5)-Z,ve=ue.borderDoneWithNeighborZ[ge]!==h.canonical.z,_e=ue.borderFeatureIndices[ge];let me=0;if(h.canonical.z!==ue.canonical.z){for(const xe of ee)h.showCentroid(h.featuresOnBorder[xe]);if(ve)for(const xe of _e)ue.showCentroid(ue.featuresOnBorder[xe]);h.borderDoneWithNeighborZ[Z]=ue.canonical.z,ue.borderDoneWithNeighborZ[ge]=h.canonical.z}for(const xe of ee){const Ne=h.featuresOnBorder[xe],Re=h.centroidData[Ne.centroidDataIndex],qe=Ne.borders[Z];let Oe;for(;me<_e.length;){Oe=ue.featuresOnBorder[_e[me]];const We=Oe.borders[ge];if(We[1]>qe[0]+3||We[0]>qe[0]-3)break;ue.showCentroid(Oe),me++}if(Oe&&me<_e.length){const We=me;let gt=0;for(;!(Oe.borders[ge][0]>qe[1]-3)&&(gt++,++me!==_e.length);)Oe=ue.featuresOnBorder[_e[me]];Oe=ue.featuresOnBorder[_e[We]];let Fe=!1;if(gt>=1){const Ve=Oe.borders[ge];Math.abs(qe[0]-Ve[0])<3&&Math.abs(qe[1]-Ve[1])<3&&(gt=1,Fe=!0,me=We+1)}else if(gt===0){h.showCentroid(Ne);continue}const Ce=ue.centroidData[Oe.centroidDataIndex];x&&Fe&&(((G=Re).flags|(J=Ce).flags)&o.e9?(G.flags|=o.e9,J.flags|=o.e9):(G.flags&=~o.e9,J.flags&=~o.e9));const Ze=Ne.intersectsCount()>1||Oe.intersectsCount()>1;if(gt>1)me=We,Re.centroidXY=Ce.centroidXY=new o.P(0,0);else if(ye&&ye.dem&&!Ze){const Ve=j[Z](Re,Ce),it=Z%2?o.al-1:0,mt=U(Ve[0],Math.min(o.al-1,Ve[1]),it,ye,oe,Z<2,Ve[2]);Re.centroidXY=Ce.centroidXY=I(mt)}else Ze?Re.centroidXY=Ce.centroidXY=new o.P(0,0):(Re.centroidXY=h.encodeBorderCentroid(Ne),Ce.centroidXY=ue.encodeBorderCentroid(Oe));h.writeCentroidToBuffer(Re),ue.writeCentroidToBuffer(Ce)}else h.showCentroid(Ne)}h.borderDoneWithNeighborZ[Z]=ue.canonical.z,ue.borderDoneWithNeighborZ[ge]=h.canonical.z}var G,J;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(d)}const vl=[1,0,0],Xt=[0,1,0],Tg=[0,0,1];function Fv(d,n,a){const h=a.transform,g=a.shadowRenderer;if(!g)return!0;const y=d.toUnwrapped(),x=h.tileSize*g._cascades[a.currentShadowCascade].scale;let T=n;if(h.elevation){const G=h.elevation.getMinMaxForTile(d);G&&(T+=G.max)}const I=[...g.shadowDirection];I[2]=-I[2];const P=g.computeSimplifiedTileShadowVolume(y,T,x,I);if(!P)return!1;const R=[vl,Xt,Tg,I,[I[0],0,I[2]],[0,I[1],I[2]]],F=h.projection.name==="globe",D=h.scaleZoom(x),j=o.cA.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,D,!F),U=g.getCurrentCascadeFrustum();return j.intersectsPrecise(P.vertices,P.planes,R)===0||U.intersectsPrecise(P.vertices,P.planes,R)===0}function Ff(d){const{painter:n,source:a,layer:h,coords:g}=d;let y=d.defines;const x=n.context,T=n.renderPass==="shadow",I=n.renderPass==="light-beam",P=n.shadowRenderer,R=o.ec(n.transform.center.lat,n.transform.zoom),F=hl(n,h.paint.get("building-cutoff-fade-range"));F.shouldRenderCutoff&&(y=y.concat("RENDER_CUTOFF"));for(const D of g){const j=a.getTile(D),U=j.getBucket(h);if(!U)continue;P&&P.getMaxCascadeForTile(D.toUnwrapped())===0&&(y=y.concat("SHADOWS_SINGLE_CASCADE"));const G=U.programConfigurations.get(h.id);let J,Z,ee,oe=n.translatePosMatrix(D.expandedProjMatrix,j,[0,0],"map");if(oe=o.cR(o.bC(),oe,[1,1,d.verticalScale]),T&&P){if(Fv(j.tileID,U.maxHeight*R,n))continue;let ye=P.calculateShadowPassMatrixFromTile(j.tileID.toUnwrapped());ye=o.cR(o.bC(),ye,[1,1,d.verticalScale]),ee=hg(ye),J=Z=n.getOrCreateProgram("buildingDepth",{config:G,defines:y,overrideFog:!1})}else if(I)J=Z=n.getOrCreateProgram("buildingBloom",{config:G,defines:y,overrideFog:!1}),ee=Fw(oe);else{const ye=n.transform.calculatePosMatrix(D.toUnwrapped(),n.transform.worldSize);o.cR(ye,ye,[1,1,d.verticalScale]);const ge=o.bC();o.cR(ge,ye,[1,-1,1/R]),o.bl(ge,ge),o.ed(ge,ge);const ve=n.transform.getFreeCameraOptions().position,_e=1<<D.canonical.z;ee=Ow(oe,ge,d.opacity,d.facadeAOIntensity,[((ve.x-D.wrap)*_e-D.canonical.x)*o.al,(ve.y*_e-D.canonical.y)*o.al,ve.z*_e*o.al],U.tileToMeter,d.facadeEmissiveChance),Z=n.getOrCreateProgram("building",{config:G,defines:y,overrideFog:!1});const me=y.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);J=n.getOrCreateProgram("building",{config:G,defines:me,overrideFog:!1}),P&&(P.setupShadowsFromMatrix(ye,Z,!0),P.setupShadowsFromMatrix(ye,J,!0))}const ue=(ye,ge)=>{if(I){const ve=ye.entranceBloom;ge.draw(n,x.gl.TRIANGLES,d.depthMode,Jt.disabled,d.blendMode,nn.disabled,ee,h.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segmentsBucket,h.paint,n.transform.zoom,G,[ve.layoutAttenuationBuffer,ve.layoutColorBuffer])}else{const ve=ye.segmentsBucket;let _e=[ye.layoutNormalBuffer,ye.layoutCentroidBuffer,ye.layoutColorBuffer];ye.layoutFacadePaintBuffer&&(_e=_e.concat([ye.layoutFacadeDataBuffer,ye.layoutFacadeVerticalRangeBuffer,ye.layoutFacadePaintBuffer])),ge.draw(n,x.gl.TRIANGLES,d.depthMode,Jt.disabled,d.blendMode,T?nn.disabled:nn.backCW,ee,h.id,ye.layoutVertexBuffer,ye.indexBuffer,ve,h.paint,n.transform.zoom,G,_e)}};n.uploadCommonUniforms(x,Z,D.toUnwrapped(),null,F),U.buildingWithoutFacade&&ue(U.buildingWithoutFacade,Z),J!==Z&&n.uploadCommonUniforms(x,J,D.toUnwrapped(),null,F),U.buildingWithFacade&&ue(U.buildingWithFacade,J)}}function Nf(d){return[d[0]*o.ee,d[1]*o.ee,d[2]*o.ee,0]}function Bf(d,n,a,h,g,y,x,T,I){const P=h.getSource(),R=a.globeSharedBuffers;if(!R)return;let F,D,j;if(n&&(F=h.getTile(n)),P instanceof o.aS?(D=P.texture,j=o.dG(0,0,a.transform)):F&&n&&(D=F.texture,j=o.dG(n.canonical.z,n.canonical.x,a.transform)),!D||!j)return;d||(j=o.cR(o.bC(),j,[1,-1,1]));const U=a.context,G=U.gl,J=g.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,Z=a.colorModeForDrapableLayerRenderPass(y),ee=x.defines;ee.push("GLOBE_POLES");const oe=new Ct(G.LEQUAL,Ct.ReadWrite,a.depthRangeFor3D),ue=Float32Array.from(a.transform.expandedFarZProjMatrix),ye=Float32Array.from(o.bk(o.dF(new o.cC(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),U.activeTexture.set(G.TEXTURE0),D.bind(J,G.CLAMP_TO_EDGE),U.activeTexture.set(G.TEXTURE1),D.bind(J,G.CLAMP_TO_EDGE),"useMipmap"in D&&U.extTextureFilterAnisotropic&&a.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);const[ge,ve,_e,me]=n?R.getPoleBuffers(n.canonical.z,!1):R.getPoleBuffers(0,!0),xe=g.paint.get("raster-elevation");let Ne;d?(Ne=ge,a.renderDefaultNorthPole=xe!==0):(Ne=ve,a.renderDefaultSouthPole=xe!==0);const Re=Nf(x.mix),qe=((We,gt,Fe,Ce,Ze,Ve,it,mt,It,ht,at,jt,Ot)=>Cf(We,gt,Fe,new Float32Array(16),new Float32Array(9),[0,0],Ce,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ve,[0,0],mt,2,ht,at,jt,1,0,Ot))(ue,ye,j,o.aj(a.transform.zoom),0,g,0,xe,0,Re,x.offset,x.range,y),Oe=a.getOrCreateProgram("raster",{defines:ee});a.uploadCommonUniforms(U,Oe,null),Oe.draw(a,G.TRIANGLES,oe,I,Z,T,qe,g.id,Ne,_e,me)}function jw(d){const n=d._nearZ,a=d.projection.farthestPixelDistance(d),h=a-n,g=.2*d.height,y=n+g;return[n,a,(y-g-n)/h,(y-n)/h]}function Nv(d,n,a,h){if(d)return n instanceof sl&&d instanceof wh?n.getTextureDescriptor(d,a,!0):{texture:d.texture,mix:Nf(h.mix),offset:h.offset,buffer:0,tileSize:1}}var Vw=o.ef([{name:"a_index",type:"Int16",components:1}]);class Uw{constructor(n,a,h,g){const y={width:h[0],height:h[1],data:null},x=n.gl;this.targetColorTexture=new o.T(n,y,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(n,y,x.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(a,g),this.lastInvalidatedAt=0}updateParticleTexture(n,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const h=this.context.gl,g=a.width*a.height;this.particleTexture0=new o.T(this.context,a,h.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,a,h.RGBA8,{premultiply:!1,useMipmap:!1});const y=new o.eg;y.reserve(g);for(let x=0;x<g;x++)y.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(y,Vw.members,!0),this.particleSegment=o.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=o.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function js(d,n,a){if(!d)return null;const h=n.getTextureDescriptor(d,a,!0);if(!h)return null;let{texture:g,mix:y,offset:x,tileSize:T,buffer:I,format:P}=h;if(!g||!P)return null;let R=!1;return P==="uint32"&&(R=!0,y[3]=0,y=pg(o.eh,y,[0,a.paint.get("raster-particle-max-speed")]),x=mg(o.eh,x,[0,a.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[I/(T+2*I),T/(T+2*I)],tileSize:T,scalarData:R,scale:y,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function Sg(d){const n=d._nearZ,a=d.projection.farthestPixelDistance(d),h=a-n,g=.2*d.height,y=n+g;return[n,a,(y-g-n)/h,(y-n)/h]}const xs=new o.ao(1,0,0,1),xl=new o.ao(0,1,0,1),Bv=new o.ao(0,0,1,1),Eg=new o.ao(1,0,1,1),Ig=new o.ao(0,1,1,1);function jf(d,n,a,h,g,y){for(let x=0;x<a.length;x++)if(g){const P=new o.ao(h.r*.8,h.g*.8,h.b*.8,1);hc(d,n,a[x],h,-1,-1,y),hc(d,n,a[x],h,-1,1,y),hc(d,n,a[x],h,1,1,y),hc(d,n,a[x],h,1,-1,y),hc(d,n,a[x],P,0,0,y)}else hc(d,n,a[x],h,0,0,y)}function hc(d,n,a,h,g,y,x){const T=d.context,I=d.transform,P=T.gl,R=I.projection.name==="globe",F=R?["PROJECTION_GLOBE_VIEW"]:[];let D=o.bz(a.projMatrix);if(R&&o.aj(I.zoom)>0){const Re=o.bj(a.canonical,I),qe=o.ei(Re);D=o.aB(new Float32Array(16),I.globeMatrix,qe),o.aB(D,I.projMatrix,D)}const j=o.bC();j[12]+=2*g/(o.o.devicePixelRatio*I.width),j[13]+=2*y/(o.o.devicePixelRatio*I.height),o.aB(D,j,D);const U=d.getOrCreateProgram("debug",{defines:F}),G=n.getTileByID(a.key);d.terrain&&d.terrain.setupElevationDraw(G,U);const J=Ct.disabled,Z=Jt.disabled,ee=d.colorModeForRenderPass(),oe="$debug";T.activeTexture.set(P.TEXTURE0),d.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),R?G._makeGlobeTileDebugBuffers(d.context,I):G._makeDebugTileBoundsBuffers(d.context,I.projection);const ue=G._tileDebugBuffer||d.debugBuffer,ye=G._tileDebugIndexBuffer||d.debugIndexBuffer,ge=G._tileDebugSegments||d.debugSegments;if(U.draw(d,P.LINE_STRIP,J,Z,ee,nn.disabled,fg(D,h.toPremultipliedRenderColor(null)),oe,ue,ye,ge,null,null,null,[G._globeTileDebugBorderBuffer]),x){const Re=G.latestRawTileData,qe=Math.floor((Re&&Re.byteLength||0)/1024);let Oe=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Oe+=` => ${a.overscaledZ}`),Oe+=` ${G.state}`,Oe+=` ${qe}kb`,function(We,gt){We.initDebugOverlayCanvas();const Fe=We.debugOverlayCanvas,Ce=We.context.gl,Ze=We.debugOverlayCanvas.getContext("2d");Ze.clearRect(0,0,Fe.width,Fe.height),Ze.shadowColor="white",Ze.shadowBlur=2,Ze.lineWidth=1.5,Ze.strokeStyle="white",Ze.textBaseline="top",Ze.font="bold 36px Open Sans, sans-serif",Ze.fillText(gt,5,5),Ze.strokeText(gt,5,5),We.debugOverlayTexture.update(Fe),We.debugOverlayTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}(d,Oe)}const ve=n.getTile(a).tileSize,_e=512/Math.min(ve,512)*(a.overscaledZ/I.zoom)*.5,me=G._tileDebugTextBuffer||d.debugBuffer,xe=G._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Ne=G._tileDebugTextSegments||d.debugSegments;U.draw(d,P.TRIANGLES,J,Z,yn.alphaBlended,nn.disabled,fg(D,o.ao.transparent.toPremultipliedRenderColor(null),_e),oe,me,xe,Ne,null,null,null,[G._globeTileDebugTextBuffer])}function fa(d,n,a,h){dc(d,0,n+a/2,d.transform.width,a,h)}function _i(d,n,a,h){dc(d,n-a/2,0,a,d.transform.height,h)}function dc(d,n,a,h,g,y){const x=d.context,T=x.gl;T.enable(T.SCISSOR_TEST),T.scissor(n*o.o.devicePixelRatio,a*o.o.devicePixelRatio,h*o.o.devicePixelRatio,g*o.o.devicePixelRatio),x.clear({color:y}),T.disable(T.SCISSOR_TEST)}const Ag=o.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:jv}=Ag;function La(d,n,a,h){d.emplaceBack(n,a,h)}class Cg{constructor(n){this.vertexArray=new o.ej,this.indices=new o.b1,La(this.vertexArray,-1,-1,1),La(this.vertexArray,1,-1,1),La(this.vertexArray,-1,1,1),La(this.vertexArray,1,1,1),La(this.vertexArray,-1,-1,-1),La(this.vertexArray,1,-1,-1),La(this.vertexArray,-1,1,-1),La(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,jv),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=o.bg.simpleSegment(0,0,36,12)}}function fc(d,n,a,h,g,y){const x=d.context.gl,T=n.paint.get("sky-atmosphere-color"),I=n.paint.get("sky-atmosphere-halo-color"),P=n.paint.get("sky-atmosphere-sun-intensity"),R=((F,D,j,U,G)=>({u_matrix_3f:F,u_sun_direction:D,u_sun_intensity:j,u_color_tint_r:[U.r,U.g,U.b,U.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(o.el(o.dL(),h),g,P,T.toPremultipliedRenderColor(null),I.toPremultipliedRenderColor(null));x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+y,n.skyboxTexture,0),a.draw(d,x.TRIANGLES,Ct.disabled,Jt.disabled,yn.unblended,nn.frontCW,R,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const pc=o.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class mc{constructor(n){const a=new o.em;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const h=new o.b1;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,pc.members),this.indexBuffer=n.createIndexBuffer(h),this.segments=o.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const pt=o.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Et{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class hu{constructor(n){this.colorModeAlphaBlendedWriteRGB=new yn([1,Ms,1,Ms],o.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new yn([1,0,1,0],o.ao.transparent,[!1,!1,!1,!0]),this.params=new Et,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const a=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new mc(a);const h=this.params.sizeRange,g=this.params.intensityRange,y=function(R){const F=o.eo(30),D=[];for(let j=0;j<R;++j){const U=2*Math.PI*F(),G=Math.acos(1-2*F())-.5*Math.PI;D.push(o.d4(Math.cos(G)*Math.cos(U),Math.cos(G)*Math.sin(U),Math.sin(G)))}return D}(this.params.starsCount),x=o.eo(300),T=new o.en,I=new o.b1;let P=0;for(let R=0;R<y.length;++R){const F=o.c4([],y[R],200),D=Math.max(0,1+.01*h*(1*x()-.5)),j=Math.max(0,1+.01*g*(1*x()-.5));T.emplaceBack(F[0],F[1],F[2],-1,-1,D,j),T.emplaceBack(F[0],F[1],F[2],1,-1,D,j),T.emplaceBack(F[0],F[1],F[2],1,1,D,j),T.emplaceBack(F[0],F[1],F[2],-1,1,D,j),I.emplaceBack(P+0,P+1,P+2),I.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=a.createVertexBuffer(T,pt.members),this.starsIdx=a.createIndexBuffer(I),this.starsSegments=o.bg.simpleSegment(0,0,T.length,I.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,a){const h=n.context,g=h.gl,y=n.transform,x=new Ct(g.LEQUAL,Ct.ReadOnly,[0,1]),T=o.aj(y.zoom),I=n.style.getLut(a.scope),P=a.properties.get("color-use-theme")==="none",R=a.properties.get("color").toNonPremultipliedRenderColor(P?null:I),F=a.properties.get("high-color-use-theme")==="none",D=a.properties.get("high-color").toNonPremultipliedRenderColor(F?null:I),j=a.properties.get("space-color-use-theme")==="none",U=a.properties.get("space-color").toNonPremultipliedRenderColor(j?null:I),G=5e-4,J=o.ep(a.properties.get("horizon-blend"),0,1,G,.25),Z=o.dA(n,h,y)&&J===G?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,ee=n.frameCounter/1e3%1,oe=o.ag(y.globeCenterInViewSpace),ue=Math.sqrt(Math.pow(oe,2)-Math.pow(Z,2)),ye=Math.acos(ue/oe),ge=ve=>{const _e=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ve&&_e.push("ALPHA_PASS");const me=n.getOrCreateProgram("globeAtmosphere",{defines:_e}),xe=((Re,qe,Oe,We,gt,Fe,Ce,Ze,Ve,it,mt,It)=>({u_frustum_tl:Re,u_frustum_tr:qe,u_frustum_br:Oe,u_frustum_bl:We,u_horizon:gt,u_transition:Fe,u_fadeout_range:Ce,u_atmosphere_fog_color:Ze.toArray01(),u_high_color:Ve.toArray01(),u_space_color:it.toArray01(),u_temporal_offset:mt,u_horizon_angle:It}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,T,J,R,D,U,ee,ye);n.uploadCommonUniforms(h,me);const Ne=this.atmosphereBuffer;Ne&&me.draw(n,g.TRIANGLES,x,Jt.disabled,ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,nn.backCW,xe,ve?"atmosphere_glow_alpha":"atmosphere_glow",Ne.vertexBuffer,Ne.indexBuffer,Ne.segments)};ge(!1),ge(!0)}drawStars(n,a){const h=o.aA(a.properties.get("star-intensity"),0,1);if(h===0)return;const g=n.context,y=g.gl,x=n.transform,T=n.getOrCreateProgram("stars"),I=o.c6([]);o.c8(I,I,-x._pitch),o.c7(I,I,-x.angle),o.c8(I,I,o.an(x._center.lat)),o.eq(I,I,-o.an(x._center.lng));const P=o.cb(new Float32Array(16),I),R=o.aB([],x.starsProjMatrix,P),F=o.el([],P),D=o.er([],F),j=[0,1,0];o.dN(j,j,D),o.c4(j,j,this.params.sizeMultiplier);const U=[1,0,0];o.dN(U,U,D),o.c4(U,U,this.params.sizeMultiplier);const G=(J=j,Z=U,ee=h,{u_matrix:Float32Array.from(R),u_up:J,u_right:Z,u_intensity_multiplier:ee});var J,Z,ee;n.uploadCommonUniforms(g,T),this.starsVx&&this.starsIdx&&T.draw(n,y.TRIANGLES,Ct.disabled,Jt.disabled,this.colorModeAlphaBlendedWriteRGB,nn.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Vi{constructor(){this.visibleTiles=[]}updateBorders(n,a){const h=[],g=[],y=n._getRenderableCoordinates(!1,!0);for(const I of y){const P=n.getTile(I);if(!P.hasData())continue;const R=P.getBucket(a);R&&(R.isEmpty()||(h.push(I.key),g.push({bucket:R,tileID:I.canonical})))}let x=h.length!==this.visibleTiles.length;if(!x){h.sort();for(let I=0;I<h.length;I++)if(h[I]!==this.visibleTiles[I]){x=!0;break}}if(!x)return;const T=new Set;this.visibleTiles=h,g.sort((I,P)=>I.tileID.z-P.tileID.z||I.tileID.x-P.tileID.x||I.tileID.y-P.tileID.y);for(const I of g){const P=new Array,R=new Array,F=I.bucket;for(const D of F.featuresOnBorder)T.has(D.featureId)?R.push(D.footprintIndex):(T.add(D.featureId),P.push(D.footprintIndex));F.updateFootprintHiddenFlags(P,o.es,!1),F.updateFootprintHiddenFlags(R,o.es,!0)}}}function Le(d,n){const a=[...d],h=n.cameraWorldSizeForFog/n.worldSize,g=o.bA([]);return o.cR(g,g,[h,h,1]),o.aB(a,g,a),o.aB(a,n.worldToFogMatrix,a),a}function Vf(d,n,a,h,g){const y=a.material,x=h.context,{baseColorTexture:T,metallicRoughnessTexture:I}=y.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:R,emissionTexture:F}=y;function D(U,G,J){if(U&&(d.push(G),x.activeTexture.set(x.gl.TEXTURE0+J),U.gfxTexture)){const{minFilter:Z,magFilter:ee,wrapS:oe,wrapT:ue}=U.sampler;U.gfxTexture.bindExtraParam(Z,ee,oe,ue)}}D(T,"HAS_TEXTURE_u_baseColorTexture",er.BaseColor),D(I,"HAS_TEXTURE_u_metallicRoughnessTexture",er.MetallicRoughness),D(P,"HAS_TEXTURE_u_normalTexture",er.Normal),D(R,"HAS_TEXTURE_u_occlusionTexture",er.Occlusion),D(F,"HAS_TEXTURE_u_emissionTexture",er.Emission),g&&(g.texture||(g.texture=new o.dY(h.context,g.image,[g.image.height,g.image.height,g.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+er.LUT),g.texture&&g.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(a.texcoordBuffer)),a.colorBuffer&&(d.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(a.colorBuffer)),a.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(a.normalBuffer)),a.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(a.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||d.push("DIFFUSE_SHADED");const j=h.shadowRenderer;j&&(d.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&d.push("NORMAL_OFFSET"))}function gc(d,n,a,h,g,y){const x=a.paint.get("model-opacity").constantOr(1),T=n.context,I=new Ct(n.context.gl.LEQUAL,Ct.ReadWrite,n.depthRangeFor3D),P=n.transform,R=d.mesh,F=R.material,D=F.pbrMetallicRoughness,j=n.style.fog;let U;U=n.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:o.aB([],h.zScaleMatrix,d.nodeModelMatrix),o.aB(U,h.negCameraPosMatrix,U);const G=o.bl([],U);o.ed(G,G);const J=a.paint.get("model-color-use-theme").constantOr("default")==="none",Z=a.paint.get("model-emissive-strength").constantOr(0),ee=kf(new Float32Array(d.worldViewProjection),new Float32Array(U),new Float32Array(G),null,n,x,D.baseColorFactor,F.emissiveFactor,D.metallicFactor,D.roughnessFactor,F,Z,a),oe={defines:[]},ue=[],ye=n.shadowRenderer;ye&&(ye.useNormalOffset=!1),Vf(oe.defines,ue,R,n,J?null:a.lut);let ge=null;if(j){const me=Le(d.nodeModelMatrix,n.transform);if(ge=new Float32Array(me),P.projection.name!=="globe"){const xe=R.aabb.min,Ne=R.aabb.max,[Re,qe]=j.getOpacityForBounds(me,xe[0],xe[1],Ne[0],Ne[1]);oe.overrideFog=Re>=$t||qe>=$t}}const ve=hl(n,a.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&oe.defines.push("RENDER_CUTOFF");const _e=n.getOrCreateProgram("model",oe);n.uploadCommonUniforms(T,_e,null,ge,ve),n.renderPass!=="shadow"&&ye&&ye.setupShadowsFromMatrix(d.nodeModelMatrix,_e),_e.draw(n,T.gl.TRIANGLES,I,g,y,R.material.doubleSided?nn.disabled:nn.backCCW,ee,a.id,R.vertexBuffer,R.indexBuffer,R.segments,a.paint,n.transform.zoom,void 0,ue)}function Uf(d,n,a,h,g,y,x){let T;T=d.projection.name==="globe"?o.eu(a,d):[...a],o.aB(T,T,n.matrix);const I=o.aB([],h,T);if(n.meshes)for(const P of n.meshes){if(P.material.alphaMode!=="BLEND"){x.push({mesh:P,depth:0,modelIndex:g,worldViewProjection:I,nodeModelMatrix:T});continue}const R=o.af([],P.centroid,I);!d.isOrthographic&&R[2]<=0||y.push({mesh:P,depth:R[2],modelIndex:g,worldViewProjection:I,nodeModelMatrix:T})}if(n.children)for(const P of n.children)Uf(d,P,a,h,g,y,x)}function Uh(d,n,a,h){const g=a.shadowRenderer;if(!g)return;const y=g.getShadowPassDepthMode(),x=g.getShadowPassColorMode(),T=g.calculateShadowPassMatrixFromMatrix(n),I=cu(T);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,y,Jt.disabled,x,nn.backCCW,I,h.id,d.vertexBuffer,d.indexBuffer,d.segments,h.paint,a.transform.zoom,void 0,void 0)}function Vv(d,n,a){const h=n.updateZoomBasedPaintProperties(),g=function(y,x,T){let I,P,R,F=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&F>0){const D=y.terrain,j=D.findDEMTileFor(T);j&&j.dem?I=o.ew.create(D,T,j):F=0}if(F===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),F===x.validForExaggeration&&(F===0||I&&I._demTile&&I._demTile.tileID===x.validForDEMTile.id&&I._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(const D in x.instancesPerModel){const j=x.instancesPerModel[D];for(let U=0;U<j.instancedDataArray.length;++U){const G=(I?F*I.getElevationAt(0|j.instancedDataArray.float32[16*U],0|j.instancedDataArray.float32[16*U+1],!0,!0):0)+j.instancesEvaluatedElevation[U];j.instancedDataArray.float32[16*U+6]=G,P=P?Math.min(x.terrainElevationMin,G):G,R=R?Math.max(x.terrainElevationMax,G):G}}return x.terrainElevationMin=P||0,x.terrainElevationMax=R||0,x.validForExaggeration=F,x.validForDEMTile=I&&I._demTile?{id:I._demTile.tileID,timestamp:I._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,n,a);(h||g)&&(n.uploaded=!1,n.upload(d.context))}const Go={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d8([0,0,0],[o.al,o.al,0])};function du(d,n){const a=1<<d.canonical.z,h=n.getFreeCameraOptions().position,g=n.elevation,y=d.canonical.x/a,x=(d.canonical.x+1)/a,T=d.canonical.y/a,I=(d.canonical.y+1)/a;let P=n._centerAltitude;if(g){const j=g.getMinMaxForTile(d);j&&j.max>P&&(P=j.max)}const R=o.aA(h.x,y,x)-h.x,F=o.aA(h.y,T,I)-h.y,D=o.ce(P,n.center.lat)-h.z;return n._zoomFromMercatorZ(Math.sqrt(R*R+F*F+D*D))}function Uv(d,n,a,h,g,y,x){const T=d.context,I=d.renderPass==="shadow",P=d.shadowRenderer,R=I&&P?P.getShadowPassDepthMode():new Ct(T.gl.LEQUAL,Ct.ReadWrite,d.depthRangeFor3D),F=d.isTileAffectedByFog(y);if(a.meshes)for(const D of a.meshes){const j=["MODEL_POSITION_ON_GPU"],U=[];let G,J,Z;h.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");const ee=hl(d,n.paint.get("model-cutoff-fade-range"));if(ee.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),I&&P)G=d.getOrCreateProgram("modelDepth",{defines:j}),J=cu(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(a.matrix)),Z=P.getShadowPassColorMode();else{Vf(j,U,D,d,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),G=d.getOrCreateProgram("model",{defines:j,overrideFog:F});const ue=D.material,ye=ue.pbrMetallicRoughness,ge=n.paint.get("model-opacity").constantOr(1),ve=n.paint.get("model-emissive-strength").constantOr(0);J=kf(y.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,d,ge,ye.baseColorFactor,ue.emissiveFactor,ye.metallicFactor,ye.roughnessFactor,ue,ve,n,g),P&&(x.shadowUniformsInitialized?G.setShadowUniformValues(T,P.getShadowUniformValues()):(P.setupShadows(y.toUnwrapped(),G,"model-tile"),x.shadowUniformsInitialized=!0)),Z=ee.shouldRenderCutoff||ge<1||ue.alphaMode!=="OPAQUE"?yn.alphaBlended:yn.unblended}d.uploadCommonUniforms(T,G,y.toUnwrapped(),null,ee);const oe=D.material.doubleSided?nn.disabled:nn.backCCW;if(h.instancedDataArray.length>20)U.push(h.instancedDataBuffer),G.draw(d,T.gl.TRIANGLES,R,Jt.disabled,Z,oe,J,n.id,D.vertexBuffer,D.indexBuffer,D.segments,n.paint,d.transform.zoom,void 0,U,h.instancedDataArray.length);else{const ue=I?"u_instance":"u_normal_matrix";for(let ye=0;ye<h.instancedDataArray.length;++ye)J[ue]=new Float32Array(h.instancedDataArray.arrayBuffer,64*ye,16),G.draw(d,T.gl.TRIANGLES,R,Jt.disabled,Z,oe,J,n.id,D.vertexBuffer,D.indexBuffer,D.segments,n.paint,d.transform.zoom,void 0,U)}}if(a.children)for(const D of a.children)Uv(d,n,D,h,g,y,x)}const Gw=[1,-1,1];function Gv(d,n,a,h){if(!a.modelManager)return!0;const g=a.modelManager;if(!a.shadowRenderer)return!0;const y=a.shadowRenderer,x=n.aabb;let T=!0,I=d.maxHeight;if(I===0){let R=0;for(const F in d.instancesPerModel){const D=g.getModel(F,h);D?R=Math.max(R,Math.max(Math.max(D.aabb.max[0],D.aabb.max[1]),D.aabb.max[2])):T=!1}I=d.maxScale*R*1.41+d.maxVerticalOffset,T&&(d.maxHeight=I)}x.max[2]=I,x.min[2]+=d.terrainElevationMin,x.max[2]+=d.terrainElevationMax,o.af(x.min,x.min,n.tileMatrix),o.af(x.max,x.max,n.tileMatrix);const P=x.intersects(y.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=P===2),P===0}function Gf(d,n){const a=d.uniformValues.u_cutoff_params[0],h=d.uniformValues.u_cutoff_params[1],g=d.uniformValues.u_cutoff_params[2],y=d.uniformValues.u_cutoff_params[3];return h===a||y===g?1:o.aA(((n-a)/(h-a)-g)/(y-g),0,1)}function Pg(d,n,a,h){if(n.pitch<20)return 1;const g=n.getWorldToCameraMatrix();o.aB(g,g,d);const y=o.bU(a.min[0],a.min[1],a.min[2],1);let x=o.aC(o.ex(),y,g),T=x,I=x;y[1]=a.max[1],x=o.aC(o.ex(),y,g),T=x[1]<T[1]?x:T,I=x[1]>I[1]?x:I,y[0]=a.max[0],x=o.aC(o.ex(),y,g),T=x[1]<T[1]?x:T,I=x[1]>I[1]?x:I,y[1]=a.min[1],x=o.aC(o.ex(),y,g),T=x[1]<T[1]?x:T,I=x[1]>I[1]?x:I;const P=o.aA(h[0],0,1),R=100*n.pixelsPerMeter*o.aA(h[1],0,1),F=o.aA(h[2],0,1),D=o.ey(o.ex(),T,I,P),j=Math.tan(.5*n.fovX),U=-D[2]*j;if(R===0)return D[1]<-Math.abs(U)?F:1;const G=(-Math.abs(U)-D[1])/R,J=(ee,oe,ue)=>(1-ue)*ee+ue*oe,Z=o.aA(J(1,F,G),F,1);return J(1,Z,o.aA((n.pitch-20)/20,0,1))}class $v{}class Hv{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,a,h){{const F=this._storage.get(a.id);if(F)return F.lastUsedFrameIdx=n,F.buf}const g=h.gl,y=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),x=new ArrayBuffer(y),T=new Int16Array(x);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));const I=new o.eA;for(let F=0;F<y/2;F+=3){const D=T[F],j=T[F+1],U=T[F+2];I.emplaceBack(D,j),I.emplaceBack(j,U),I.emplaceBack(U,D)}const P=h.bindVertexArrayOES.current,R=new $v;return R.buf=new gl(h,I),R.lastUsedFrameIdx=n,this._storage.set(a.id,R),h.bindVertexArrayOES.set(P),R.buf}update(n){for(const[a,h]of this._storage)n-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(a))}destroy(){for(const[n,a]of this._storage)a.buf.destroy(),this._storage.delete(n)}}class $f{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Gh=o.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class fu{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Mg{constructor(n,a){this.revealStart=11,this.revealRange=2,n.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),n.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Wv=o.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class $w{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,a){const h=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const x=new o.eB,T=new o.b1;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),T.emplaceBack(0,1,2),T.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(x,Wv.members),this.vignetteIdx=n.context.createIndexBuffer(T)}const g=o.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,h);const x={u_vignetteShape:(y={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};h.draw(n,n.context.gl.TRIANGLES,Ct.disabled,Jt.disabled,yn.alphaBlended,nn.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,g)}var y}}class qv{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,a){const h=n.getFreeCameraOptions().position,g=h.toAltitude(),y=h.toLngLat(),x=o.an(y.lng),T=o.an(y.lat),I=n.pixelsPerMeter/a,P=x*o.eD,R=o.eD*Math.log(Math.tan(Math.PI/4+T/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const F=-this._offsetYPrev+R,D=-this._elevationPrev+g;this._accumulatedOffsetX+=(-this._offsetXPrev+P)*I,this._accumulatedOffsetY+=F*I,this._accumulatedElevation+=D*I,this._offsetXPrev=P,this._offsetYPrev=R,this._elevationPrev=g}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Zv(d,n){return[-(d[0]-Math.floor(d[0]/n)*n),-(d[1]-Math.floor(d[1]/n)*n),-(d[2]-Math.floor(d[2]/n)*n)]}function cs(d){const n=o.eo(1323123451230),a=[];for(let h=0;h<d;++h){const g=2*n()-1,y=2*n()-1,x=2*n()-1;a.push(o.d4(g,y,x))}return a}function wl(d,n,a,h,g){const y=o.aA((g-a)/(h-a),0,1);return(1-y)*d+y*n}class pu{constructor(n){this._movement=new qv,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new $w,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,a){const h=n.transform;this._movement.update(h,this._ppmScaleFactor);const g=h.starsProjMatrix,y=o.c6([]);o.c8(y,y,o.an(90)-h._pitch),o.c7(y,y,-h.angle);const x=o.cb(new Float32Array(16),y),T=o.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),I=o.ed([],T),P=o.aB([],I,x),R=Date.now()/1e3;return this._accumulatedTimeFromStart+=(R-this._prevTime)*a,this._prevTime=R,{projectionMatrix:g,modelviewMatrix:P}}}class Si extends pu{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Mg(n.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const a=n.context;if(!this.particlesVx){const h=cs(this.particlesCount),g=new o.eE,y=new o.b1;let x=0;const T=o.eo(1323123451230);for(let I=0;I<h.length;++I){const P=h[I],R=[2*T()-1,T(),T(),T()];g.emplaceBack(P[0],P[1],P[2],-1,-1,...R),g.emplaceBack(P[0],P[1],P[2],1,-1,...R),g.emplaceBack(P[0],P[1],P[2],1,1,...R),g.emplaceBack(P[0],P[1],P[2],-1,1,...R),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=a.createVertexBuffer(g,Gh.members),this.particlesIdx=a.createIndexBuffer(y)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},h=n.transform.zoom;if(a.revealStart>h)return;const g=wl(0,1,a.revealStart,a.revealStart+a.revealRange,h);if(!this.particlesVx||!this.particlesIdx)return;const y=structuredClone(this._params);let x=[-y.direction.x,y.direction.y,-100];o.aw(x,x);const T=structuredClone(this._vignetteParams);T.strength*=g,y.overrideStyleParameters||(y.intensity=n.style.rain.state.density,y.timeFactor=n.style.rain.state.intensity,y.color=structuredClone(n.style.rain.state.color),x=structuredClone(n.style.rain.state.direction),y.screenThinning.intensity=n.style.rain.state.centerThinning,y.dropletSizeX=n.style.rain.state.dropletSize[0],y.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],y.distortionStrength=100*n.style.rain.state.distortionStrength,T.strength=1,T.color=structuredClone(n.style.rain.state.vignetteColor));const I=this.updateOnRender(n,y.timeFactor),P=n.context,R=P.gl,F=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new o.T(P,{width:n.width,height:n.height,data:null},R.RGBA8)),y.distortionStrength>0&&(P.activeTexture.set(R.TEXTURE0),this.screenTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),R.copyTexSubImage2D(R.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const D=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(P,D),P.activeTexture.set(R.TEXTURE0),this.screenTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE);const j=[y.color.r,y.color.g,y.color.b,y.color.a],U=(G,J)=>{const Z=Zv(this._movement.getPosition(),G),ee=y.dropletSizeX,oe=y.dropletSizeX*y.dropletSizeYScale,ue=n.width/2,ye=n.height/2,ge=wl(0,y.screenThinning.start,0,1,y.screenThinning.intensity),ve=wl(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),_e=wl(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),me=(xe={modelview:I.modelviewMatrix,projection:I.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Z,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:G,rainDropletSize:[ee,oe],distortionStrength:y.distortionStrength,rainDirection:x,color:j,screenSize:[F.width,F.height],thinningCenterPos:[ue,ye],thinningShape:[ge,ve,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:_e,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:J?0:1},{u_modelview:Float32Array.from(xe.modelview),u_projection:Float32Array.from(xe.projection),u_time:xe.time,u_cam_pos:xe.camPos,u_texScreen:0,u_velocityConeAperture:xe.velocityConeAperture,u_velocity:xe.velocity,u_boxSize:xe.boxSize,u_rainDropletSize:xe.rainDropletSize,u_distortionStrength:xe.distortionStrength,u_rainDirection:xe.rainDirection,u_color:xe.color,u_screenSize:xe.screenSize,u_thinningCenterPos:xe.thinningCenterPos,u_thinningShape:xe.thinningShape,u_thinningAffectedRatio:xe.thinningAffectedRatio,u_thinningParticleOffset:xe.thinningParticleOffset,u_shapeDirectionalPower:xe.shapeDirectionalPower,u_shapeNormalPower:xe.shapeNormalPower,u_mode:xe.mode});var xe;const Ne=Math.round(y.intensity*this.particlesCount),Re=o.bg.simpleSegment(0,0,4*Ne,2*Ne);D.draw(n,R.TRIANGLES,Ct.disabled,Jt.disabled,yn.alphaBlended,nn.disabled,me,"rain_particles",this.particlesVx,this.particlesIdx,Re)};y.distortionStrength>0&&U(y.boxSize,!0),U(y.boxSize,!1),this._vignette.draw(n,T)}}const zn=o.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Xv extends pu{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Mg(n.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const a=n.context;if(!this.particlesVx){const h=cs(this.particlesCount),g=new o.eF,y=new o.b1;let x=0;const T=o.eo(1323123451230);for(let I=0;I<h.length;++I){const P=h[I],R=T(),F=T(),D=T(),j=[I/h.length,R,F,D],U=[T(),T()];g.emplaceBack(P[0],P[1],P[2],-1,-1,...j,...U),g.emplaceBack(P[0],P[1],P[2],1,-1,...j,...U),g.emplaceBack(P[0],P[1],P[2],1,1,...j,...U),g.emplaceBack(P[0],P[1],P[2],-1,1,...j,...U),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=a.createVertexBuffer(g,zn.members),this.particlesIdx=a.createIndexBuffer(y)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const a=structuredClone(this._params);let h=[-a.direction.x,a.direction.y,-100];o.aw(h,h);const g=structuredClone(this._vignetteParams),y=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=n.transform.zoom;if(y.revealStart>x)return;const T=wl(0,1,y.revealStart,y.revealStart+y.revealRange,x);g.strength*=T,a.overrideStyleParameters||(a.intensity=n.style.snow.state.density,a.timeFactor=n.style.snow.state.intensity,a.color=structuredClone(n.style.snow.state.color),h=structuredClone(n.style.snow.state.direction),a.screenThinning.intensity=n.style.snow.state.centerThinning,a.billboardSize=2.79*n.style.snow.state.flakeSize,g.strength=1,g.color=structuredClone(n.style.snow.state.vignetteColor));const I=this.updateOnRender(n,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const P=n.context,R=P.gl,F=n.transform,D=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(P,D),((j,U,G)=>{const J=Zv(this._movement.getPosition(),j),Z=F.width/2,ee=F.height/2,oe=wl(0,G.screenThinning.start,0,1,G.screenThinning.intensity),ue=wl(.001,G.screenThinning.range,0,1,G.screenThinning.intensity),ye=wl(0,G.screenThinning.particleOffset,0,1,G.screenThinning.intensity),ge=(ve={modelview:I.modelviewMatrix,projection:I.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:G.velocityConeAperture,velocity:G.velocity,horizontalOscillationRadius:G.horizontalOscillationRadius,horizontalOscillationRate:G.horizontalOscillationRate,boxSize:j,billboardSize:1*G.billboardSize,simpleShapeParameters:[G.shapeFadeStart,G.shapeFadePower],screenSize:[F.width,F.height],thinningCenterPos:[Z,ee],thinningShape:[oe,ue,Math.pow(10,G.screenThinning.fadePower)],thinningAffectedRatio:G.screenThinning.affectedRatio,thinningParticleOffset:ye,color:[G.color.r,G.color.g,G.color.b,G.color.a],direction:h},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_horizontalOscillationRadius:ve.horizontalOscillationRadius,u_horizontalOscillationRate:ve.horizontalOscillationRate,u_boxSize:ve.boxSize,u_billboardSize:ve.billboardSize,u_simpleShapeParameters:ve.simpleShapeParameters,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_particleColor:ve.color,u_direction:ve.direction});var ve;const _e=Math.round(G.intensity*this.particlesCount),me=o.bg.simpleSegment(0,0,4*_e,2*_e);this.particlesVx&&this.particlesIdx&&D.draw(n,R.TRIANGLES,Ct.disabled,Jt.disabled,yn.alphaBlended,nn.disabled,ge,"snow_particles",this.particlesVx,this.particlesIdx,me)})(a.boxSize,0,a),this._vignette.draw(n,g)}}const bl={symbol:function(d,n,a,h,g){if(d.renderPass!=="translucent")return;const y=Jt.disabled,x=d.colorModeForRenderPass(),T=a.layout.get("text-variable-anchor"),I=a.layout.get("text-size-scale-range"),P=o.aA(d.scaleFactor,I[0],I[1]);T&&function(D,j,U,G,J,Z,ee,oe){const ue=j.transform,ye=J==="map",ge=Z==="map";for(const ve of D){const _e=G.getTile(ve),me=_e.getBucket(U);if(!me||!me.text||!me.text.segments.get().length)continue;const xe=o.bK(me.textSizeData,ue.zoom,oe),Ne=Jl(ve,me.getProjection(),ue),Re=ue.calculatePixelsToTileUnitsMatrix(_e),qe=Bo(Ne,_e.tileID.canonical,ge,ye,ue,me.getProjection(),Re),Oe=me.hasIconTextFit()&&me.hasIconData();xe&&zf(me,ye,ge,ee,ue,qe,ve,Math.pow(2,ue.zoom-_e.tileID.overscaledZ),xe,Oe)}}(h,d,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g,P);const R=a.paint.get("icon-opacity").constantOr(1)!==0,F=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(R||F)?Vh(d,n,a,h,y,x):(R&&Vh(d,n,a,h,y,x,{onlyIcons:!0}),F&&Vh(d,n,a,h,y,x,{onlyText:!0})),n.map.showCollisionBoxes&&(jh(d,n,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),jh(d,n,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(d,n,a,h){if(d.renderPass!=="translucent")return;const g=a.paint.get("circle-opacity"),y=a.paint.get("circle-stroke-width"),x=a.paint.get("circle-stroke-opacity"),T=a.layout.get("circle-sort-key").constantOr(1)!==void 0,I=a.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(y.constantOr(1)===0||x.constantOr(1)===0))return;const P=d.context,R=P.gl,F=d.transform,D=!(!d.terrain||!d.terrain.enabled),j=a.layout.get("circle-elevation-reference"),U=d.depthModeForSublayer(0,Ct.ReadOnly),G=new Ct(d.context.gl.LEQUAL,Ct.ReadOnly,d.depthRangeFor3D),J=j==="none"||D?U:G,Z=Jt.disabled,ee=d.colorModeForDrapableLayerRenderPass(I),oe=F.projection.name==="globe",ue=[o.aF(F.center.lng),o.aJ(F.center.lat)],ye=[];for(let ve=0;ve<h.length;ve++){const _e=h[ve],me=n.getTile(_e),xe=me.getBucket(a);if(!xe||xe.projection.name!==F.projection.name)continue;const Ne=xe.programConfigurations.get(a.id),Re=xe.layoutVertexBuffer,qe=xe.globeExtVertexBuffer,Oe=xe.indexBuffer,We=o.dZ(a),gt=[qe],Fe=d.isTileAffectedByFog(_e);oe&&We.push("PROJECTION_GLOBE_VIEW"),We.push("DEPTH_D24"),d.terrain&&F.depthOcclusionForSymbolsAndCircles&&We.push("DEPTH_OCCLUSION"),xe.hasElevation&&!d.terrain&&(We.push("ELEVATED_ROADS"),gt.push(xe.elevatedLayoutVertexBuffer));const Ce=d.getOrCreateProgram("circle",{config:Ne,defines:We,overrideFog:Fe}),Ze=F.projection.createInversionMatrix(F,_e.canonical),Ve={programConfiguration:Ne,program:Ce,layoutVertexBuffer:Re,dynamicBuffers:gt,indexBuffer:Oe,uniformValues:o.d_(d,_e,me,Ze,ue,a),tile:me};if(T){const it=xe.segments.get();for(const mt of it)ye.push({segments:new o.bg([mt]),sortKey:mt.sortKey,state:Ve})}else ye.push({segments:xe.segments,sortKey:0,state:Ve})}T&&ye.sort((ve,_e)=>ve.sortKey-_e.sortKey);const ge={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(const ve of ye){const{programConfiguration:_e,program:me,layoutVertexBuffer:xe,dynamicBuffers:Ne,indexBuffer:Re,uniformValues:qe,tile:Oe}=ve.state,We=ve.segments;d.terrain&&d.terrain.setupElevationDraw(Oe,me,ge),d.uploadCommonUniforms(P,me,Oe.tileID.toUnwrapped()),me.draw(d,R.TRIANGLES,J,Z,ee,nn.disabled,qe,a.id,xe,Re,We,a.paint,F.zoom,_e,Ne)}},heatmap:function(d,n,a,h){if(a.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const g=d.context,y=g.gl,x=Jt.disabled,T=new yn([y.ONE,y.ONE,y.ONE,y.ONE],o.ao.transparent,[!0,!0,!0,!0]);(function(j,U,G,J){const Z=j.gl,ee=U.width*J,oe=U.height*J;j.activeTexture.set(Z.TEXTURE1),j.viewport.set([0,0,ee,oe]);let ue=G.heatmapFbo;if(!ue||ue&&(ue.width!==ee||ue.height!==oe)){ue&&ue.destroy();const ye=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,ye),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),ue=G.heatmapFbo=j.createFramebuffer(ee,oe,!0,null),function(ge,ve,_e,me,xe,Ne){const Re=ge.gl;Re.texImage2D(Re.TEXTURE_2D,0,ge.extRenderToTextureHalfFloat?Re.RGBA16F:Re.RGBA,xe,Ne,0,Re.RGBA,ge.extRenderToTextureHalfFloat?Re.HALF_FLOAT:Re.UNSIGNED_BYTE,null),me.colorAttachment.set(_e)}(j,0,ye,ue,ee,oe)}else Z.bindTexture(Z.TEXTURE_2D,ue.colorAttachment.get()),j.bindFramebuffer.set(ue.framebuffer)})(g,d,a,d.transform.projection.name==="globe"?.5:.25),g.clear({color:o.ao.transparent});const I=d.transform,P=I.projection.name==="globe",R=P?["PROJECTION_GLOBE_VIEW"]:[],F=P?nn.frontCCW:nn.disabled,D=[o.aF(I.center.lng),o.aJ(I.center.lat)];for(let j=0;j<h.length;j++){const U=h[j];if(n.hasRenderableParent(U))continue;const G=n.getTile(U),J=G.getBucket(a);if(!J||J.projection.name!==I.projection.name)continue;const Z=d.isTileAffectedByFog(U),ee=J.programConfigurations.get(a.id),oe=d.getOrCreateProgram("heatmap",{config:ee,defines:R,overrideFog:Z}),{zoom:ue}=d.transform;d.terrain&&d.terrain.setupElevationDraw(G,oe),d.uploadCommonUniforms(g,oe,U.toUnwrapped());const ye=I.projection.createInversionMatrix(I,U.canonical);oe.draw(d,y.TRIANGLES,Ct.disabled,x,T,F,Lv(d,U,G,ye,D,ue,a.paint.get("heatmap-intensity")),a.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,a.paint,d.transform.zoom,ee,P?[J.globeExtVertexBuffer]:null)}g.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(g,y){const x=g.context,T=x.gl,I=y.heatmapFbo;if(!I)return;x.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,I.colorAttachment.get()),x.activeTexture.set(T.TEXTURE1);let P=y.colorRampTexture;P||(P=y.colorRampTexture=new o.T(x,y.colorRamp,T.RGBA8)),P.bind(T.LINEAR,T.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,T.TRIANGLES,Ct.disabled,Jt.disabled,g.colorModeForRenderPass(),nn.disabled,((R,F,D,j)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,y),y.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,y.paint,g.transform.zoom)}(d,a))},line:function(d,n,a,h){if(d.renderPass!=="translucent")return;const g=a.paint.get("line-opacity"),y=a.paint.get("line-width");if(g.constantOr(1)===0||y.constantOr(1)===0)return;const x=a.paint.get("line-emissive-strength"),T=a.paint.get("line-occlusion-opacity"),I=a.layout.get("line-elevation-reference"),P=a.layout.get("line-width-unit")==="meters",R=I==="sea",F=!(!d.terrain||!d.terrain.enabled),D=d.context,j=D.gl;if(a.hasElevatedBuckets&&d.transform.projection.name==="globe")return;const U=a.layout.get("line-cross-slope"),G=U!==void 0,J=U<1,Z=d.colorModeForDrapableLayerRenderPass(x),ee=d.terrain&&d.terrain.renderingToTexture,oe=ee?1:o.o.devicePixelRatio,ue=a.paint.get("line-dasharray"),ye=ue.constantOr(1),ge=a.layout.get("line-cap"),ve=ue.constantOr(null),_e=ge.constantOr(null),me=a.paint.get("line-pattern"),xe=me.constantOr(1),Ne=a.paint.get("line-pattern-cross-fade"),Re=me.constantOr(null),qe=a.paint.get("line-opacity").constantOr(1);let Oe=!xe&&qe!==1||d.depthOcclusion&&T>0&&T<1;const We=a.paint.get("line-gradient"),gt=xe?"linePattern":"line",Fe=o.d$(a);let Ce;if(ee&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Oe=!1),T!==0&&d.depthOcclusion){const mt=a.paint._values["line-opacity"];mt&&mt.value&&mt.value.kind==="constant"?Ce=mt.value:o.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&Fe.push("VARIABLE_LINE_WIDTH");const Ze=(mt,It,ht,at,jt,Ot)=>{for(const Bt of mt){const zt=n.getTile(Bt);if(xe&&!zt.patternsLoaded())continue;const rn=zt.getBucket(a);if(!rn||rn.elevationType!=="none"&&!jt||rn.elevationType==="none"&&jt)continue;d.prepareDrawTile();const gn=[...It],vn=d.shadowRenderer,ei=rn.elevationType==="road"&&!!vn&&vn.enabled;let hn=[0,0,0];if(ei){const xn=d.style.directionalLight,Qt=d.style.ambientLight;xn&&Qt&&(hn=Uo(d.style,xn,Qt)),gn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const jn=rn.programConfigurations.get(a.id);let Yn=!1;if(Re&&zt.imageAtlas){const xn=o.e0.from(Re),Qt=xn.getPrimary().scaleSelf(oe).toString(),ti=zt.imageAtlas.patternPositions.get(Qt),Ui=xn.getSecondary(),ki=Ui?zt.imageAtlas.patternPositions.get(Ui.scaleSelf(oe).toString()):null;Yn=!!ti&&!!ki,ti&&jn.setConstantPatternPositions(ti,ki)}Ne>0&&(Yn||jn.getPatternTransitionVertexBuffer("line-pattern"))&&gn.push("LINE_PATTERN_TRANSITION");const Ei=d.isTileAffectedByFog(Bt),_n=d.getOrCreateProgram(gt,{config:jn,defines:gn,overrideFog:Ei});if(!xe&&ve&&_e&&zt.lineAtlas){const xn=zt.lineAtlas.getDash(ve,_e);xn&&jn.setConstantPatternPositions(xn)}ei&&vn.setupShadows(zt.tileID.toUnwrapped(),_n,"vector-tile");let[$n,Un]=a.paint.get("line-trim-offset");(_e==="round"||_e==="square")&&$n!==Un&&($n===0&&($n-=1),Un===1&&(Un+=1));const Zn=ee?Bt.projMatrix:null,Ai=P?1/rn.tileToMeter/o.ay(zt,1,d.transform.zoom):1,Xi=P?1/rn.tileToMeter/o.ay(zt,1,Math.floor(d.transform.zoom)):1,Ar=xe?o.e1(d,zt,a,Zn,oe,Ai,Xi,[$n,Un],hn,Ne):o.e2(d,zt,a,Zn,rn.lineClipsArray.length,oe,Ai,Xi,[$n,Un],hn);if(We){const xn=rn.gradients[a.id];let Qt=xn.texture;if(a.gradientVersion!==xn.version){let ti=256;if(a.stepInterpolant){const Ui=n.getSource().maxzoom,ki=Bt.canonical.z===Ui?Math.ceil(1<<d.transform.maxZoom-Bt.canonical.z):1;ti=o.aA(o.e3(rn.maxLineLength/o.al*1024*ki),256,D.maxTextureSize)}xn.gradient=o.e4({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:ti,image:xn.gradient||void 0,clips:rn.lineClipsArray}),xn.texture?xn.texture.update(xn.gradient):xn.texture=new o.T(D,xn.gradient,j.RGBA8),xn.version=a.gradientVersion,Qt=xn.texture}D.activeTexture.set(j.TEXTURE1),Qt.bind(a.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}ye&&(D.activeTexture.set(j.TEXTURE0),zt.lineAtlasTexture&&zt.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),jn.updatePaintBuffers()),xe&&(D.activeTexture.set(j.TEXTURE0),zt.imageAtlasTexture&&zt.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),jn.updatePaintBuffers()),jt&&!R&&d.terrain.setupElevationDraw(zt,_n),d.uploadCommonUniforms(D,_n,Bt.toUnwrapped());const Ci=xn=>{Ce!=null&&(Ce.value=qe*T),_n.draw(d,j.TRIANGLES,ht,xn,Z,nn.disabled,Ar,a.id,rn.layoutVertexBuffer,rn.indexBuffer,rn.segments,a.paint,d.transform.zoom,jn,[rn.layoutVertexBuffer2,rn.patternVertexBuffer,rn.zOffsetVertexBuffer]),Ce!=null&&(Ce.value=qe)};if(Oe&&!jt){const xn=d.stencilModeForClipping(Bt).ref;xn===0&&ee&&D.clear({stencil:0});const Qt={func:j.EQUAL,mask:255};Ar.u_alpha_discard_threshold=.8,Ci(new Jt(Qt,xn,255,j.KEEP,j.KEEP,j.INVERT)),Ar.u_alpha_discard_threshold=0,Ci(new Jt(Qt,xn,255,j.KEEP,j.KEEP,j.KEEP))}else Ar.u_alpha_discard_threshold=Oe&&jt&&Ot?.8:0,Ci(jt?at:d.stencilModeForClipping(Bt))}};let Ve=d.depthModeForSublayer(0,Ct.ReadOnly);const it=new Ct(d.depthOcclusion?j.GREATER:j.LEQUAL,Ct.ReadOnly,d.depthRangeFor3D);if(a.hasNonElevatedBuckets){const mt=!ee&&d.terrain;T!==0&&mt?o.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):mt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):Ze(h,Fe,Ve,Jt.disabled,!1,!0)}if(a.hasElevatedBuckets){I==="hd-road-markup"?F||(Ve=it,Fe.push("ELEVATED_ROADS")):(Fe.push("ELEVATED"),Ve=it,G&&Fe.push(J?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),R&&Fe.push("ELEVATION_REFERENCE_SEA"));const mt=Oe?d.stencilModeFor3D():Jt.disabled;d.forceTerrainMode=!0,Ze(h,Fe,Ve,mt,!0,!0),Oe&&Ze(h,Fe,Ve,mt,!0,!1),d.forceTerrainMode=!1}Oe&&(d.resetStencilClippingMasks(),ee&&D.clear({stencil:0})),T===0||d.depthOcclusion||ee||d.layersWithOcclusionOpacity.push(d.currentLayer)},fill:function(d,n,a,h){const g=a.paint.get("fill-color"),y=a.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const x=a.paint.get("fill-emissive-strength"),T=d.colorModeForDrapableLayerRenderPass(x),I=a.paint.get("fill-pattern"),P=d.opaquePassEnabledForLayer()&&!I.constantOr(1)&&g.constantOr(o.ao.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";let R="none";a.layout.get("fill-elevation-reference")!=="none"?R="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(R="offset");const F=!(!d.terrain||!d.terrain.enabled),D={painter:d,sourceCache:n,layer:a,coords:h,colorMode:T,elevationType:R,terrainEnabled:F,pass:P};if(d.renderPass!=="shadow")if(R!=="offset"){if(uu(D,!1),R==="road"){const j=!F&&d.renderPass==="translucent";j&&uc(d,n,a,h,"geometry"),uu(D,!0,Jt.disabled),j&&function(U){const{painter:G,sourceCache:J,layer:Z,coords:ee,colorMode:oe}=U,ue=G.context.gl,ye=U.painter.shadowRenderer,ge=!!ye&&ye.enabled,ve=new Ct(G.context.gl.LEQUAL,Ct.ReadOnly,G.depthRangeFor3D);let _e=[0,0,0];if(ge){const xe=G.style.directionalLight,Ne=G.style.ambientLight;xe&&Ne&&(_e=Uo(G.style,xe,Ne))}const me=xe=>{for(const Ne of ee){const Re=J.getTile(Ne),qe=Re.getBucket(Z);if(!qe)continue;const Oe=qe.elevatedStructures;if(!Oe)continue;let We,gt;if(xe?(We=Oe.renderableBridgeSegments,gt=Oe.bridgeProgramConfigurations.get(Z.id)):(We=Oe.renderableTunnelSegments,gt=Oe.tunnelProgramConfigurations.get(Z.id)),!We||We.segments[0].primitiveLength===0)continue;gt.updatePaintBuffers(),G.prepareDrawTile();const Fe=G.isTileAffectedByFog(Ne),Ce=[];ge&&Ce.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ze=G.getOrCreateProgram("elevatedStructures",{config:gt,overrideFog:Fe,defines:Ce}),Ve=G.translatePosMatrix(Ne.projMatrix,Re,Z.paint.get("fill-translate"),Z.paint.get("fill-translate-anchor"));ge&&ye.setupShadows(Re.tileID.toUnwrapped(),Ze,"vector-tile");const it=zw(Ve,_e);G.uploadCommonUniforms(G.context,Ze,Ne.toUnwrapped()),Ze.draw(G,ue.TRIANGLES,ve,Jt.disabled,oe,nn.backCCW,it,Z.id,Oe.vertexBuffer,Oe.indexBuffer,We,Z.paint,G.transform.zoom,gt,[Oe.vertexBufferNormal])}};me(!0),me(!1)}(D)}}else uu(D,!1,d.stencilModeFor3D());else d.shadowRenderer&&R==="road"&&!F&&function(j){const{painter:U,sourceCache:G,layer:J,coords:Z}=j,ee=U.context.gl,oe=j.painter.shadowRenderer;for(const ue of Z){const ye=G.getTile(ue),ge=ye.getBucket(J);if(!ge)continue;const ve=ge.elevatedStructures;if(!ve||!ve.shadowCasterSegments||ve.shadowCasterSegments.segments[0].primitiveLength===0)continue;U.prepareDrawTile();const _e=ge.bufferData.programConfigurations.get(J.id),me=U.isTileAffectedByFog(ue),xe=U.getOrCreateProgram("elevatedStructuresDepth",{config:_e,overrideFog:me}),Ne=oe.calculateShadowPassMatrixFromTile(ye.tileID.toUnwrapped());U.uploadCommonUniforms(U.context,xe,ue.toUnwrapped());const Re={u_matrix:Ne,u_depth_bias:0};xe.draw(U,ee.TRIANGLES,oe.getShadowPassDepthMode(),Jt.disabled,oe.getShadowPassColorMode(),nn.disabled,Re,J.id,ve.vertexBuffer,ve.indexBuffer,ve.shadowCasterSegments,J.paint,U.transform.zoom,_e)}}(D)},"fill-extrusion":function(d,n,a,h){const g=a.paint.get("fill-extrusion-opacity"),y=d.context,x=y.gl,T=d.terrain,I=T&&T.renderingToTexture;if(g===0)return;const P=d.conflationActive&&d.style.isLayerClipped(a,n.getSource()),R=d.style.order.indexOf(a.fqid);if(P&&function(F,D,j,U,G){for(const J of U){const Z=D.getTile(J).getBucket(j);Z&&(Z.updateReplacement(J,F.replacementSource,G),Z.uploadCentroid(F.context))}}(d,n,a,h,R),T||P)for(const F of h){const D=n.getTile(F).getBucket(a);D&&yl(d.context,n,F,D,a,T,P)}if(d.renderPass==="shadow"&&d.shadowRenderer){const F=d.shadowRenderer;if(T&&g<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ad)return;const D=F.getShadowPassDepthMode(),j=F.getShadowPassColorMode();Pt(d,n,a,h,D,Jt.disabled,j,P)}else if(d.renderPass==="translucent"){const F=!a.paint.get("fill-extrusion-pattern").constantOr(1),D=a.paint.get("fill-extrusion-color").constantOr(o.ao.white);if(!I&&D.a!==0){const j=new Ct(d.context.gl.LEQUAL,Ct.ReadWrite,d.depthRangeFor3D);g===1&&F?Pt(d,n,a,h,j,Jt.disabled,yn.unblended,P):(Pt(d,n,a,h,j,Jt.disabled,yn.disabled,P),Pt(d,n,a,h,j,d.stencilModeFor3D(),d.colorModeForRenderPass(),P),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&F&&(!T&&d.transform.projection.name!=="globe"||I)){const j=a.paint.get("fill-extrusion-opacity"),U=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),G=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),J=a.paint.get("fill-extrusion-flood-light-intensity"),Z=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ee=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Z?null:a.lut).toArray01().slice(0,3),oe=U>0&&G>0,ue=J>0,ye=(_e,me,xe)=>(1-xe)*_e+xe*me,ge=new bg;ge.translate=a.paint.get("fill-extrusion-translate"),ge.translateAnchor=a.paint.get("fill-extrusion-translate-anchor"),ge.edgeRadius=a.layout.get("fill-extrusion-edge-radius"),ge.cutoffFadeRange=a.paint.get("fill-extrusion-cutoff-fade-range");const ve=_e=>{const me=d.depthModeForSublayer(1,Ct.ReadOnly,x.LEQUAL,!0),xe=a.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=ye(.1,3,xe),Re=d._showOverdrawInspector;if(!Re){const qe=new Jt({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Oe=new yn([x.ONE,x.ONE,x.ONE,x.ONE],o.ao.transparent,[!1,!1,!1,!0],x.MIN);Da(ge,d,n,a,h,me,qe,Oe,nn.disabled,_e,"sdf",j,U,G,J,ee,Ne,P,!1)}{const qe=Re?Jt.disabled:new Jt({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Oe=Re?d.colorModeForRenderPass():new yn([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],o.ao.transparent,[!0,!0,!0,!0]);Da(ge,d,n,a,h,me,qe,Oe,nn.disabled,_e,"color",j,U,G,J,ee,Ne,P,!1)}};if(I){const _e=(me,xe,Ne)=>{const Re=d.depthModeForSublayer(1,Ct.ReadOnly,x.LEQUAL,!1),qe=a.paint.get(me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Oe=ye(.1,3,qe);{const We=new yn([x.ONE,x.ONE,x.ONE,x.ONE],o.ao.transparent,[!1,!1,!1,!0]);Da(ge,d,n,a,h,Re,Jt.disabled,We,nn.disabled,me,"clear",j,U,G,J,ee,Oe,P,xe)}{const We=new Jt({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),gt=new yn([x.ONE,x.ONE,x.ONE,x.ONE],o.ao.transparent,[!1,!1,!1,!0],x.MIN);Da(ge,d,n,a,h,Re,We,gt,nn.disabled,me,"sdf",j,U,G,J,ee,Oe,P,xe)}{const We=me?x.ZERO:x.ONE_MINUS_DST_ALPHA,gt=new Jt({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Fe=new yn([We,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],o.ao.transparent,[!0,!0,!0,!0]);Da(ge,d,n,a,h,Re,gt,Fe,nn.disabled,me,"color",j,U,G,J,ee,Oe,P,xe)}{const We=new yn([x.ONE,x.ONE,x.ONE,me?x.ZERO:x.ONE],o.ao.transparent,[!1,!1,!1,!0],me?x.FUNC_ADD:x.MAX);Da(ge,d,n,a,h,Re,Jt.disabled,We,nn.disabled,me,"clear",j,U,G,J,ee,Oe,P,xe,Ne)}};if(oe||ue){let me;if(d.prepareDrawTile(),T){const xe=T.drapeBufferSize[0],Ne=T.drapeBufferSize[1];me=T.framebufferCopyTexture,me&&(!me||me.size[0]===xe&&me.size[1]===Ne)||(me&&me.destroy(),me=T.framebufferCopyTexture=new o.T(y,new o.q({width:xe,height:Ne}),x.RGBA8)),me.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,xe,Ne)}oe&&_e(!0,!1,me),ue&&_e(!1,!0,me)}}else oe&&ve(!0),ue&&ve(!1),(oe||ue)&&d.resetStencilClippingMasks()}}},building:function(d,n,a,h){d.currentLayer<d.firstLightBeamLayer&&(d.firstLightBeamLayer=d.currentLayer);const g=a.paint.get("building-ambient-occlusion-ground-intensity"),y=a.paint.get("building-ambient-occlusion-ground-radius"),x=a.paint.get("building-ambient-occlusion-ground-attenuation"),T=a.paint.get("building-opacity");if(T<=0)return;let I=g>0&&y>0,P=!0;const R=a.paint.get("building-vertical-scale");(!d.shadowRenderer||R<1)&&(P=!1);const F=d.conflationActive&&d.style.isLayerClipped(a,n.getSource()),D=d.style.order.indexOf(a.fqid);if(function(j,U,G,J,Z,ee){for(const oe of ee){const ue=U.getTile(oe).getBucket(G);ue&&(Z&&ue.updateReplacement(oe,j.replacementSource,J),ue.uploadUpdatedIndexBuffer(j.context))}}(d,n,a,D,F,h),function(j,U,G,J){for(const Z of J){const ee=U.getTile(Z).getBucket(G);ee&&ee.needsEvaluation()&&ee.uploadUpdatedColorBuffer(j.context)}}(d,n,a,h),a.resetLayerRenderingStats(d),d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0),d.renderPass==="shadow"&&d.shadowRenderer){const j=d.shadowRenderer,U=[],G=j.getShadowPassDepthMode();Ff({painter:d,source:n,layer:a,coords:h,defines:U,blendMode:j.getShadowPassColorMode(),depthMode:G,opacity:T,verticalScale:R,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(d.renderPass==="translucent"){let j=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];P&&(j=j.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),d.shadowRenderer&&d.shadowRenderer.useNormalOffset&&(j=j.concat("NORMAL_OFFSET"));const U=a.paint.get("building-facade-emissive-chance"),G=a.paint.get("building-ambient-occlusion-intensity"),J=new Ct(d.context.gl.LEQUAL,Ct.ReadWrite,d.depthRangeFor3D);T<1&&Ff({painter:d,source:n,layer:a,coords:h,defines:j,blendMode:yn.disabled,depthMode:J,opacity:T,verticalScale:R,facadeEmissiveChance:U,facadeAOIntensity:G});const Z=d.colorModeForRenderPass();Ff({painter:d,source:n,layer:a,coords:h,defines:j,blendMode:Z,depthMode:J,opacity:T,verticalScale:R,facadeEmissiveChance:U,facadeAOIntensity:G}),I&&function(ee,oe,ue,ye,ge,ve,_e,me,xe,Ne,Re,qe,Oe){const We=ee.context.gl,gt=ee.depthModeForSublayer(1,Ct.ReadOnly,We.LEQUAL,!0),Fe=.1*(1-(Ce=Re))+3*Ce;var Ce;const Ze=ee._showOverdrawInspector,Ve=qe,it=new bg;Ze||Da(it,ee,oe,ue,ye,gt,new Jt({func:We.ALWAYS,mask:255},255,255,We.KEEP,We.KEEP,We.REPLACE),new yn([We.ONE,We.ONE,We.ONE,We.ONE],o.ao.transparent,[!1,!1,!1,!0],We.MIN),nn.disabled,ge,"sdf",ve,_e,me,0,Ne,Fe,Ve,!1);{const mt=Ze?Jt.disabled:new Jt({func:We.EQUAL,mask:255},255,255,We.KEEP,We.DECR,We.DECR),It=Ze?ee.colorModeForRenderPass():new yn([We.ONE_MINUS_DST_ALPHA,We.DST_ALPHA,We.ONE,We.ONE],o.ao.transparent,[!0,!0,!0,!0]);Da(it,ee,oe,ue,ye,gt,mt,It,nn.disabled,ge,"color",ve,_e,me,0,Ne,Fe,Ve,!1)}}(d,n,a,h,!0,T,g,y,0,[0,0,0],x,F)}else if(d.renderPass==="light-beam"){const j=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],U=new Ct(d.context.gl.LEQUAL,Ct.ReadOnly,d.depthRangeFor3D);Ff({painter:d,source:n,layer:a,coords:h,defines:j,blendMode:yn.alphaBlended,depthMode:U,opacity:T,verticalScale:R,facadeEmissiveChance:0,facadeAOIntensity:0})}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1),d.resetStencilClippingMasks()},hillshade:function(d,n,a,h){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const g=d.context,y=d.terrain&&d.terrain.renderingToTexture,[x,T]=d.renderPass!=="translucent"||y?[{},h]:d.stencilConfigForOverlap(h);for(const I of T){const P=n.getTile(I);if(P.needsHillshadePrepare&&d.renderPass==="offscreen")Tw(d,P,a);else if(d.renderPass==="translucent"){const R=d.depthModeForSublayer(0,Ct.ReadOnly),F=a.paint.get("hillshade-emissive-strength"),D=d.colorModeForDrapableLayerRenderPass(F),j=y&&d.terrain?d.terrain.stencilModeForRTTOverlap(I):x[I.overscaledZ];bw(d,I,P,a,R,j,D)}}g.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,n,a,h,g,y){if(d.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const x=d.transform.projection.name==="globe",T=a.paint.get("raster-elevation")!==0,I=T&&x;if(d.renderElevatedRasterBackface&&!I)return;const P=d.context,R=P.gl,F=n.getSource(),D=function(ge,ve,_e,me){const xe=ve.paint.get("raster-color"),Ne=ge.type==="raster-array",Re=[],qe=ve.paint.get("raster-resampling"),Oe=ve.paint.get("raster-color-mix");let We=ve.paint.get("raster-color-range");const gt=[Oe[0],Oe[1],Oe[2],0],Fe=Oe[3];let Ce=qe==="nearest"?me.NEAREST:me.LINEAR;if(Ne&&(Re.push("RASTER_ARRAY"),xe||Re.push("RASTER_COLOR"),qe==="linear"&&Re.push("RASTER_ARRAY_LINEAR"),Ce=me.NEAREST,!We&&ge.rasterLayers)){const Ze=ge.rasterLayers.find(({id:Ve})=>Ve===ve.sourceLayer);Ze&&Ze.fields&&Ze.fields.range&&(We=Ze.fields.range)}if(We=We||[0,1],xe){Re.push("RASTER_COLOR"),_e.activeTexture.set(me.TEXTURE2),ve.updateColorRamp(We);let Ze=ve.colorRampTexture;Ze||(Ze=ve.colorRampTexture=new o.T(_e,ve.colorRamp,me.RGBA8)),Ze.bind(me.LINEAR,me.CLAMP_TO_EDGE)}return{mix:gt,range:We,offset:Fe,defines:Re,resampling:Ce}}(F,a,P,R);if(F instanceof o.aS&&!h.length&&!x)return;const j=a.paint.get("raster-emissive-strength"),U=d.colorModeForDrapableLayerRenderPass(j),G=d.terrain&&d.terrain.renderingToTexture,J=!d.options.moving,Z=a.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;if(F instanceof o.aS&&!h.length&&(F.onNorthPole||F.onSouthPole)){const ge=T?d.stencilModeFor3D():Jt.disabled;return void Bf(!!F.onNorthPole,null,d,n,a,j,D,nn.disabled,ge)}if(!h.length)return;const[ee,oe]=F instanceof o.aS||G?[{},h]:d.stencilConfigForOverlap(h),ue=oe[oe.length-1].overscaledZ;I&&D.defines.push("PROJECTION_GLOBE_VIEW"),T&&D.defines.push("RENDER_CUTOFF");const ye=(ge,ve,_e)=>{for(const me of ge){const xe=me.toUnwrapped(),Ne=n.getTile(me);if(G&&(!Ne||!Ne.hasData()))continue;P.activeTexture.set(R.TEXTURE0);const Re=Nv(Ne,F,a,D);if(!Re||!Re.texture)continue;const{texture:qe,mix:Oe,offset:We,tileSize:gt,buffer:Fe}=Re;let Ce,Ze;G?(Ce=Ct.disabled,Ze=me.projMatrix):T?(Ce=new Ct(R.LEQUAL,Ct.ReadWrite,d.depthRangeFor3D),Ze=x?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(xe,J)):(Ce=d.depthModeForSublayer(me.overscaledZ-ue,a.paint.get("raster-opacity")===1?Ct.ReadWrite:Ct.ReadOnly,R.LESS),Ze=d.transform.calculateProjMatrix(xe,J));const Ve=d.terrain&&G?d.terrain.stencilModeForRTTOverlap(me):ee[me.overscaledZ],it=y?0:a.paint.get("raster-fade-duration");Ne.registerFadeDuration(it);const mt=n.findLoadedParent(me,0),It=oc(Ne,mt,n,d.transform,it);let ht,at;!It.isFading&&Ne.refreshedUponExpiration&&(Ne.refreshedUponExpiration=!1),d.terrain&&d.terrain.prepareDrawTile(),P.activeTexture.set(R.TEXTURE0),qe.bind(Z,R.CLAMP_TO_EDGE),P.activeTexture.set(R.TEXTURE1),mt?(mt.texture&&mt.texture.bind(Z,R.CLAMP_TO_EDGE),ht=Math.pow(2,mt.tileID.overscaledZ-Ne.tileID.overscaledZ),at=[Ne.tileID.canonical.x*ht%1,Ne.tileID.canonical.y*ht%1]):qe.bind(Z,R.CLAMP_TO_EDGE),"useMipmap"in qe&&P.extTextureFilterAnisotropic&&d.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const jt=d.transform;let Ot;const Bt=T?jw(jt):[0,0,0,0];let zt,rn,gn,vn,ei,hn=0;if(I&&F instanceof o.aS&&F.coordinates.length>3)zt=Float32Array.from(o.bk(o.dF(new o.cC(0,0,0)))),rn=Float32Array.from(jt.globeMatrix),gn=Float32Array.from(o.dB(jt)),vn=[o.aF(jt.center.lng),o.aJ(jt.center.lat)],Ot=F.elevatedGlobePerspectiveTransform,ei=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(I){const _n=o.dC(me.canonical);hn=o.dD(_n.getCenter().lat),zt=Float32Array.from(o.bk(o.dF(me.canonical))),rn=Float32Array.from(jt.globeMatrix),gn=Float32Array.from(o.dB(jt)),vn=[o.aF(jt.center.lng),o.aJ(jt.center.lat)],Ot=[0,0],ei=Float32Array.from(o.dE(me.canonical,_n,hn,jt.worldSize/jt._pixelsPerMercatorPixel))}else Ot=F instanceof o.aS?F.perspectiveTransform:[0,0],zt=new Float32Array(16),rn=new Float32Array(9),gn=new Float32Array(16),vn=[0,0],ei=new Float32Array(9);const jn=Cf(Ze,zt,rn,gn,ei,at||[0,0],o.aj(d.transform.zoom),vn,Bt,ht||1,It,a,Ot,T?a.paint.get("raster-elevation"):0,2,Oe,We,D.range,gt,Fe,j),Yn=d.isTileAffectedByFog(me),Ei=d.getOrCreateProgram("raster",{defines:D.defines,overrideFog:Yn});if(d.uploadCommonUniforms(P,Ei,xe),F instanceof o.aS){const _n=F.elevatedGlobeVertexBuffer,$n=F.elevatedGlobeIndexBuffer;if(G||!x)F.boundsBuffer&&F.boundsSegments&&Ei.draw(d,R.TRIANGLES,Ce,Jt.disabled,U,nn.disabled,jn,a.id,F.boundsBuffer,d.quadTriangleIndexBuffer,F.boundsSegments);else if(_n&&$n){const Un=jt.zoom<=o.cZ?F.elevatedGlobeSegments:F.getSegmentsForLongitude(jt.center.lng);Un&&Ei.draw(d,R.TRIANGLES,Ce,Jt.disabled,U,ve,jn,a.id,_n,$n,Un)}}else if(I){Ce=new Ct(R.LEQUAL,Ct.ReadOnly,d.depthRangeFor3D);const _n=d.globeSharedBuffers;if(_n){const[$n,Un,Zn]=_n.getGridBuffers(hn,!1);Ei.draw(d,R.TRIANGLES,Ce,_e||Ve,d.colorModeForRenderPass(),ve,jn,a.id,$n,Un,Zn)}}else{const{tileBoundsBuffer:_n,tileBoundsIndexBuffer:$n,tileBoundsSegments:Un}=d.getTileBoundsBuffers(Ne);Ei.draw(d,R.TRIANGLES,Ce,Ve,U,nn.disabled,jn,a.id,_n,$n,Un)}}if(!(F instanceof o.aS)&&I)for(const me of ge){const xe=me.canonical.y===(1<<me.canonical.z)-1;me.canonical.y===0&&Bf(!0,me,d,n,a,j,D,ve,_e||Jt.disabled),xe&&Bf(!1,me,d,n,a,j,D,ve===nn.frontCW?nn.backCW:nn.frontCW,_e||Jt.disabled)}};I?ye(oe,d.renderElevatedRasterBackface?nn.backCW:nn.frontCW,d.stencilModeFor3D()):ye(oe,nn.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,n,a,h,g,y){d.renderPass==="offscreen"&&function(x,T,I,P){if(!P.length)return;const R=x.context,F=R.gl,D=T.getSource();if(!(D instanceof sl))return;const j=Math.ceil(Math.sqrt(I.paint.get("raster-particle-count")));let U=I.particlePositionRGBAImage;if(!U||U.width!==j){const oe=function(ue){const ye=ue*ue,ge=new Uint8Array(4*ye),ve=function(me){return me|=0,me=Math.imul(2747636419^me,2654435769),me=Math.imul(me^me>>>16,2654435769),((me=Math.imul(me^me>>>16,2654435769))>>>0)/4294967296},_e=1/1.1;for(let me=0;me<ye;me++){const xe=_e*(ve(2*me+0)+cc),Ne=_e*(ve(2*me+1)+cc),Re=255*xe%1,qe=255*Ne%1,Oe=Re,We=Ne-qe/255,gt=qe;ge[4*me+0]=255*(xe-Re/255),ge[4*me+1]=255*Oe,ge[4*me+2]=255*We,ge[4*me+3]=255*gt}return ge}(j);U=I.particlePositionRGBAImage=new o.q({width:j,height:j},oe)}let G=I.particleFramebuffer;G?G.width!==j&&(G.destroy(),G=I.particleFramebuffer=R.createFramebuffer(j,j,!0,null)):G=I.particleFramebuffer=R.createFramebuffer(j,j,!0,null);const J=[];for(const oe of P){const ue=T.getTile(oe);if(!(ue instanceof wh))continue;const ye=js(ue,D,I);if(!ye)continue;const ge=[ue.tileSize,ue.tileSize];let ve=I.tileFramebuffer;ve||(ve=I.tileFramebuffer=R.createFramebuffer(ge[0],ge[1],!0,null));let _e=ue.rasterParticleState;_e||(_e=ue.rasterParticleState=new Uw(R,oe,ge,U));const me=_e.update(I.lastInvalidatedAt);_e.particleTextureDimension!==j&&_e.updateParticleTexture(oe,U);const xe=_e.targetColorTexture;_e.targetColorTexture=_e.backgroundColorTexture,_e.backgroundColorTexture=xe;const Ne=_e.particleTexture0;_e.particleTexture0=_e.particleTexture1,_e.particleTexture1=Ne,J.push([oe,ye,_e,me])}if(J.length===0)return;const Z=o.o.now(),ee=I.previousDrawTimestamp?.001*(Z-I.previousDrawTimestamp):.0167;if(I.previousDrawTimestamp=Z,I.hasColorMap()){R.activeTexture.set(F.TEXTURE0+2);let oe=I.colorRampTexture;oe||(oe=I.colorRampTexture=new o.T(R,I.colorRamp,F.RGBA8)),oe.bind(F.LINEAR,F.CLAMP_TO_EDGE)}R.bindFramebuffer.set(I.tileFramebuffer.framebuffer),function(oe,ue,ye){const ge=oe.context,ve=ge.gl,_e=ue.tileFramebuffer;ge.activeTexture.set(ve.TEXTURE0);const me={u_texture:0,u_opacity:1.05*(Ne=ue.paint.get("raster-particle-fade-opacity-factor"))/(Ne+.05)},xe=oe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ne;for(const Re of ye){const[,,qe,Oe]=Re;_e.colorAttachment.set(qe.targetColorTexture.texture),ge.viewport.set([0,0,_e.width,_e.height]),ge.clear({color:o.ao.transparent}),Oe&&(qe.backgroundColorTexture.bind(ve.NEAREST,ve.CLAMP_TO_EDGE),xe.draw(oe,ve.TRIANGLES,Ct.disabled,Jt.disabled,yn.alphaBlended,nn.disabled,me,ue.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments))}}(x,I,J),function(oe,ue,ye,ge){const ve=oe.context,_e=ve.gl,me=ye.tileFramebuffer,xe=oe.transform.projection.name==="globe",Ne=ye.paint.get("raster-particle-max-speed");for(const Re of ge){const[qe,Oe,We]=Re;ve.activeTexture.set(_e.TEXTURE0+0),Oe.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),me.colorAttachment.set(We.targetColorTexture.texture);const gt=oe.getOrCreateProgram("rasterParticleDraw",{defines:Oe.defines,overrideFog:!1});ve.activeTexture.set(_e.TEXTURE0+1);const Fe=Oe.scalarData?[]:[0,1,2,3].map(Ve=>o.e6[Ve](qe));Fe.push(qe);const Ce=qe.canonical.x,Ze=qe.canonical.y;for(const Ve of Fe){const it=ue.getTile(xe?Ve.wrapped():Ve);if(!it)continue;const mt=it.rasterParticleState;if(!mt)continue;const It=Ve.canonical.x+(1<<Ve.canonical.z)*(Ve.wrap-qe.wrap),ht=Ve.canonical.y;mt.particleTexture0.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);const at=gg(1,mt.particleTexture0.size[0],[It-Ce,ht-Ze],0,Oe.texture.size,2,Ne,Oe.textureOffset,Oe.scale,Oe.offset);gt.draw(oe,_e.POINTS,Ct.disabled,Jt.disabled,yn.alphaBlended,nn.disabled,at,ye.id,mt.particleIndexBuffer,void 0,mt.particleSegment)}}}(x,T,I,J),R.bindFramebuffer.set(I.particleFramebuffer.framebuffer),function(oe,ue,ye,ge){const ve=oe.context,_e=ve.gl,me=ue.paint.get("raster-particle-max-speed"),xe=ge*ue.paint.get("raster-particle-speed-factor")*.15,Ne=function(qe){return Math.pow(qe,6)}(.01+1*ue.paint.get("raster-particle-reset-rate-factor")),Re=ue.particleFramebuffer;ve.viewport.set([0,0,Re.width,Re.height]);for(const qe of ye){const[,Oe,We]=qe;ve.activeTexture.set(_e.TEXTURE0+0),Oe.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),ve.activeTexture.set(_e.TEXTURE0+1);const gt=We.particleTexture0;gt.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);const Fe=Pf(1,gt.size[0],0,Oe.texture.size,me,xe,Ne,Oe.textureOffset,Oe.scale,Oe.offset);Re.colorAttachment.set(We.particleTexture1.texture),ve.clear({color:o.ao.transparent}),oe.getOrCreateProgram("rasterParticleUpdate",{defines:Oe.defines}).draw(oe,_e.TRIANGLES,Ct.disabled,Jt.disabled,yn.unblended,nn.disabled,Fe,ue.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments)}}(x,I,J,ee)}(d,n,a,h),d.renderPass==="translucent"&&(function(x,T,I,P,R){const F=x.context,D=F.gl,j=T.getSource().tileSize,U=5*(1-o.ah(o.cK,o.cK+1,x.transform.zoom))*j+I.paint.get("raster-particle-elevation"),G=!x.options.moving,J=x.transform.projection.name==="globe";if(!P.length)return;const[Z,ee]=x.stencilConfigForOverlap(P),oe=[];J&&oe.push("PROJECTION_GLOBE_VIEW");const ue=x.stencilModeFor3D();for(const ye of ee){const ge=ye.toUnwrapped(),ve=T.getTile(ye);if(!ve.rasterParticleState)continue;const _e=ve.rasterParticleState,me=100;ve.registerFadeDuration(me);const xe=T.findLoadedParent(ye,0),Ne=oc(ve,xe,T,x.transform,me);let Re,qe;x.terrain&&x.terrain.prepareDrawTile(),F.activeTexture.set(D.TEXTURE0),_e.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),F.activeTexture.set(D.TEXTURE1),xe&&xe.rasterParticleState?(xe.rasterParticleState.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Re=Math.pow(2,xe.tileID.overscaledZ-ve.tileID.overscaledZ),qe=[ve.tileID.canonical.x*Re%1,ve.tileID.canonical.y*Re%1]):_e.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const Oe=J?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(ge,G),We=x.transform,gt=Sg(We),Fe=o.dC(ye.canonical),Ce=o.dD(Fe.getCenter().lat);let Ze,Ve,it,mt,It;J?(Ze=Float32Array.from(o.bk(o.dF(ye.canonical))),Ve=Float32Array.from(We.globeMatrix),it=Float32Array.from(o.dB(We)),mt=[o.aF(We.center.lng),o.aJ(We.center.lat)],It=Float32Array.from(o.dE(ye.canonical,Fe,Ce,We.worldSize/We._pixelsPerMercatorPixel))):(Ze=new Float32Array(16),Ve=new Float32Array(9),it=new Float32Array(16),mt=[0,0],It=new Float32Array(9));const ht=ml(Oe,Ze,Ve,it,It,qe||[0,0],o.aj(x.transform.zoom),mt,gt,Re||1,Ne,U),at=x.isTileAffectedByFog(ye),jt=x.getOrCreateProgram("rasterParticle",{defines:oe,overrideFog:at});if(x.uploadCommonUniforms(F,jt,ge),J){const Ot=new Ct(D.LEQUAL,Ct.ReadOnly,x.depthRangeFor3D),Bt=0,zt=x.globeSharedBuffers;if(zt){const[rn,gn,vn]=zt.getGridBuffers(Ce,Bt!==0);jt.draw(x,D.TRIANGLES,Ot,ue,yn.alphaBlended,x.renderElevatedRasterBackface?nn.frontCCW:nn.backCCW,ht,I.id,rn,gn,vn)}}else{const Ot=x.depthModeForSublayer(0,Ct.ReadOnly),Bt=Z[ye.overscaledZ],{tileBoundsBuffer:zt,tileBoundsIndexBuffer:rn,tileBoundsSegments:gn}=x.getTileBoundsBuffers(ve);jt.draw(x,D.TRIANGLES,Ot,Bt,yn.alphaBlended,nn.disabled,ht,I.id,zt,rn,gn)}}x.resetStencilClippingMasks()}(d,n,a,h),d.style.map.triggerRepaint())},background:function(d,n,a,h){const g=a.paint.get("background-color"),y=a.paint.get("background-color-use-theme").constantOr("default")==="none",x=a.paint.get("background-opacity"),T=a.paint.get("background-emissive-strength"),I=a.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;const P=d.context,R=P.gl,F=d.transform,D=F.tileSize,j=a.paint.get("background-pattern");let U;if(j!==void 0&&(j===null||(U=d.imageManager.getPattern(o.I.from(j.toString()),a.scope,d.style.getLut(a.scope)),!U)))return;const G=!j&&g.a===1&&x===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==G)return;const J=Jt.disabled,Z=d.depthModeForSublayer(0,G==="opaque"?Ct.ReadWrite:Ct.ReadOnly),ee=d.colorModeForDrapableLayerRenderPass(T),oe=j?"backgroundPattern":"background";let ue,ye=h;if(ye||(ue=d.getBackgroundTiles(),ye=Object.values(ue).map(ge=>ge.tileID)),j&&(P.activeTexture.set(R.TEXTURE0),d.imageManager.bind(d.context,a.scope)),I){const ge=d.getOrCreateProgram(oe,{overrideFog:!1,overrideRtt:!0}),ve=new Float32Array(o.bA([])),_e=new o.aO(0,0,0,0,0),me=j?Rf(ve,T,x,d,0,a.scope,U,I,{tileID:_e,tileSize:D}):Mf(ve,T,x,g.toPremultipliedRenderColor(y?null:a.lut));ge.draw(d,R.TRIANGLES,Z,J,ee,nn.disabled,me,a.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const ge of ye){const ve=d.isTileAffectedByFog(ge),_e=d.getOrCreateProgram(oe,{overrideFog:ve}),me=ge.toUnwrapped(),xe=h?ge.projMatrix:d.transform.calculateProjMatrix(me);d.prepareDrawTile();const Ne=n?n.getTile(ge):ue?ue[ge.key]:new al(ge,D,F.zoom,d),Re=j?Rf(xe,T,x,d,0,a.scope,U,I,{tileID:ge,tileSize:D}):Mf(xe,T,x,g.toPremultipliedRenderColor(y?null:a.lut));d.uploadCommonUniforms(P,_e,me);const{tileBoundsBuffer:qe,tileBoundsIndexBuffer:Oe,tileBoundsSegments:We}=d.getTileBoundsBuffers(Ne);_e.draw(d,R.TRIANGLES,Z,J,ee,nn.disabled,Re,a.id,qe,Oe,We)}},sky:function(d,n,a){const h=d._atmosphere?o.aj(d.transform.zoom):1,g=a.paint.get("sky-opacity")*h;if(g===0)return;const y=d.context,x=a.paint.get("sky-type"),T=new Ct(y.gl.LEQUAL,Ct.ReadOnly,[0,1]),I=d.frameCounter/1e3%1;x==="atmosphere"?d.renderPass==="offscreen"?a.needsSkyboxCapture(d)&&(function(P,R,F,D){const j=P.context,U=j.gl;let G=R.skyboxFbo;if(!G){G=R.skyboxFbo=j.createFramebuffer(32,32,!0,null),R.skyboxGeometry=new Cg(j),R.skyboxTexture=j.gl.createTexture(),U.bindTexture(U.TEXTURE_CUBE_MAP,R.skyboxTexture),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR);for(let oe=0;oe<6;++oe)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,U.RGBA,32,32,0,U.RGBA,U.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(G.framebuffer),j.viewport.set([0,0,32,32]);const J=R.getCenter(P,!0),Z=P.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);o.bA(ee),o.ek(ee,ee,.5*-Math.PI),fc(P,R,Z,ee,J,0),o.bA(ee),o.ek(ee,ee,.5*Math.PI),fc(P,R,Z,ee,J,1),o.bA(ee),o.cT(ee,ee,.5*-Math.PI),fc(P,R,Z,ee,J,2),o.bA(ee),o.cT(ee,ee,.5*Math.PI),fc(P,R,Z,ee,J,3),o.bA(ee),fc(P,R,Z,ee,J,4),o.bA(ee),o.ek(ee,ee,Math.PI),fc(P,R,Z,ee,J,5),j.viewport.set([0,0,P.width,P.height])}(d,a),a.markSkyboxValid(d)):d.renderPass==="sky"&&function(P,R,F,D,j){const U=P.context,G=U.gl,J=P.transform,Z=P.getOrCreateProgram("skybox");U.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,R.skyboxTexture);const ee=((oe,ue,ye,ge,ve)=>({u_matrix:oe,u_sun_direction:ue,u_cubemap:0,u_opacity:ge,u_temporal_offset:ve}))(J.skyboxMatrix,R.getCenter(P,!1),0,D,j);P.uploadCommonUniforms(U,Z),Z.draw(P,G.TRIANGLES,F,Jt.disabled,P.colorModeForRenderPass(),nn.backCW,ee,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(d,a,T,g,I):x==="gradient"&&d.renderPass==="sky"&&function(P,R,F,D,j){const U=P.context,G=U.gl,J=P.transform,Z=P.getOrCreateProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new Cg(U)),U.activeTexture.set(G.TEXTURE0);let ee=R.colorRampTexture;ee||(ee=R.colorRampTexture=new o.T(U,R.colorRamp,G.RGBA8)),ee.bind(G.LINEAR,G.CLAMP_TO_EDGE);const oe=((ue,ye,ge,ve,_e)=>({u_matrix:ue,u_color_ramp:0,u_center_direction:ye,u_radius:o.an(ge),u_opacity:ve,u_temporal_offset:_e}))(J.skyboxMatrix,R.getCenter(P,!1),R.paint.get("sky-gradient-radius"),D,j);P.uploadCommonUniforms(U,Z),Z.draw(P,G.TRIANGLES,F,Jt.disabled,P.colorModeForRenderPass(),nn.backCW,oe,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(d,a,T,g,I)},custom:function(d,n,a,h){const g=d.context,y=a.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&a.isDraped(n)){if(d.renderPass==="offscreen"){const x=y.prerender;if(x){if(d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const T=d.transform.pointMerc;x.call(y,g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),o.aj(d.transform.zoom),[T.x,T.y],d.transform.pixelsPerMeterRatio)}else x.call(y,g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const T=y.renderToTile;if(T){const I=h[0].canonical,P={x:I.x+h[0].wrap*(y.wrapTileId?0:1<<I.z),y:I.y,z:I.z};g.setDepthMode(Ct.disabled),g.setStencilMode(Jt.disabled),g.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),T.call(y,g.gl,P),g.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),g.setStencilMode(Jt.disabled);const x=y.renderingMode==="3d"?new Ct(d.context.gl.LEQUAL,Ct.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Ct.ReadOnly);if(g.setDepthMode(x),d.transform.projection.name==="globe"){const T=d.transform.pointMerc;y.render(g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),o.aj(d.transform.zoom),[T.x,T.y],d.transform.pixelsPerMeterRatio)}else y.render(g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState(),g.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,n,a,h){if(d.renderPass==="opaque")return;const g=a.paint.get("model-opacity").constantOr(1);if(g===0)return;const y=a.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!y||d.terrain&&g<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof o.ad))return;const x=d.shadowRenderer,T=a.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,T||(x.enabled=!1));const I=()=>{x&&(x.useNormalOffset=!0,T||(x.enabled=!0))},P=n.getSource();if(d.renderPass==="light-beam"&&P.type!=="batched-model")return;if(P.type==="vector"||P.type==="geojson")return function(Z,ee,oe,ue,ye){const ge=Z.transform;if(ge.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${ge.projection.name} projection is not yet implemented`);const ve=ge.getFreeCameraOptions().position;if(!Z.modelManager)return;const _e=Z.modelManager;oe.modelManager=_e;const me=Z.shadowRenderer;if(!oe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const xe=oe._unevaluatedLayout._values["model-id"],Ne=Object.assign({},oe.layout.get("model-id").parameters),Re=Z.style.order.indexOf(oe.fqid);for(const qe of ue){const Oe=ee.getTile(qe).getBucket(oe);if(!Oe||Oe.projection.name!==ge.projection.name)continue;const We=Oe.getModelUris();We&&!Oe.modelsRequested&&(_e.addModelsFromBucket(We,ye),Oe.modelsRequested=!0);const gt=du(qe,ge);Ne.zoom=gt;const Fe=xe.possiblyEvaluate(Ne);if(Vv(Z,Oe,qe),Go.shadowUniformsInitialized=!1,Go.useSingleShadowCascade=!!me&&me.getMaxCascadeForTile(qe.toUnwrapped())===0,Z.renderPass==="shadow"&&me){if(Z.currentShadowCascade===1&&Oe.isInsideFirstShadowMapFrustum)continue;const Ve=ge.calculatePosMatrix(qe.toUnwrapped(),ge.worldSize);if(Go.tileMatrix.set(Ve),Go.shadowTileMatrix=Float32Array.from(me.calculateShadowPassMatrixFromMatrix(Ve)),Go.aabb.min=[0,0,0],Go.aabb.max[0]=Go.aabb.max[1]=o.al,Go.aabb.max[2]=0,Gv(Oe,Go,Z,oe.scope))continue}const Ce=1<<qe.canonical.z,Ze=[((ve.x-qe.wrap)*Ce-qe.canonical.x)*o.al,(ve.y*Ce-qe.canonical.y)*o.al,ve.z*Ce*o.al];Z.conflationActive&&Object.keys(Oe.instancesPerModel).length>0&&Z.style.isLayerClipped(oe,ee.getSource())&&Oe.updateReplacement(qe,Z.replacementSource,Re,ye)&&(Oe.uploaded=!1,Oe.upload(Z.context));for(let Ve in Oe.instancesPerModel){const it=Oe.instancesPerModel[Ve];it.features.length>0&&(Ve=Fe.evaluate(it.features[0].feature,{}));const mt=_e.getModel(Ve,ye);if(mt||_e.hasURLBeenRequested(Ve)||Oe.modelUris.includes(Ve)||(Oe.modelUris.push(Ve),Oe.modelsRequested=!1),mt&&mt.uploaded)for(const It of mt.nodes)Uv(Z,oe,It,it,Ze,qe,Go)}}}(d,n,a,h,P.type==="vector"?a.scope:""),void I();if(!P.loaded())return;if(P.type==="batched-model")return function(Z,ee,oe,ue){oe.resetLayerRenderingStats(Z);const ye=Z.context,ge=Z.transform,ve=Z.style.fog,_e=Z.shadowRenderer;if(ge.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${ge.projection.name} projection is not yet implemented`);const me=Z.transform.getFreeCameraOptions().position,xe=o.c4([],[me.x,me.y,me.z],Z.transform.worldSize),Ne=o.et([],xe),Re=o.bA([]),qe=o.ec(ge.center.lat,ge.zoom),Oe=o.bq([],[1,1,1/qe]);o.br(Re,Re,Ne);const We=oe.paint.get("model-opacity").constantOr(1),gt=new Ct(ye.gl.LEQUAL,Ct.ReadWrite,Z.depthRangeFor3D),Fe=new Ct(ye.gl.LEQUAL,Ct.ReadOnly,Z.depthRangeFor3D),Ce=new o.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ze=Z.renderPass==="shadow",Ve=Ze&&_e?_e.getCurrentCascadeFrustum():ge.getFrustum(ge.scaleZoom(ge.worldSize)),it=oe.paint.get("model-front-cutoff"),mt=it[2]<1,It=hl(Z,oe.paint.get("model-cutoff-fade-range")),ht=oe.getLayerRenderingStats();(function(at,jt,Ot,Bt){const zt=at.terrain?at.terrain.exaggeration():0,rn=at.transform.zoom;for(const gn of Bt){const vn=jt.getTile(gn).getBucket(Ot);vn&&(vn.setFilter(Ot.filter),at.conflationActive&&vn.updateReplacement(gn,at.replacementSource),vn.evaluateTransform(at,Ot),at.terrain&&zt>0&&vn.elevationUpdate(at.terrain,zt,gn,Ot.source),vn.needsReEvaluation(at,rn,Ot)&&vn.evaluate(Ot))}})(Z,ee,oe,ue),function(){let at,jt,Ot;mt?(at=ue.length-1,jt=-1,Ot=-1):(at=0,jt=ue.length,Ot=1);const Bt=new Float64Array(16),zt=o.cz(),rn=new o.P(0,0);for(let gn=at;gn!==jt;gn+=Ot){const vn=ue[gn],ei=ee.getTile(vn).getBucket(oe);if(!ei||!ei.uploaded)continue;let hn=!1;_e&&(hn=_e.getMaxCascadeForTile(vn.toUnwrapped())===0);const jn=ge.calculatePosMatrix(vn.toUnwrapped(),ge.worldSize),Yn=ei.modelTraits;!Ze&&mt&&(o.bl(Bt,jn),o.af(zt,xe,Bt),rn.x=zt[0],rn.y=zt[1]);const Ei=[];ei.setFilter(oe.filter);for(const _n of ei.getNodesInfo()){if(_n.hiddenByReplacement||!_n.node.meshes)continue;const $n=_n.node;let Un=0;Z.terrain&&$n.elevation&&(Un=$n.elevation*Z.terrain.exaggeration());const Zn=(()=>{const Br=_n.aabb;return Ce.min=[...Br.min],Ce.max=[...Br.max],Ce.min[2]+=Un,Ce.max[2]+=Un,o.af(Ce.min,Ce.min,jn),o.af(Ce.max,Ce.max,jn),Ce})(),Ai=_n.evaluatedScale;if(Ai[0]<=1&&Ai[1]<=1&&Ai[2]<=1&&Zn.intersects(Ve)===0)continue;if(!Ze&&mt){const Br=.16666666666666666;_n.cameraCollisionOpacity=xe[0]>Zn.min[0]&&xe[0]<Zn.max[0]&&xe[1]>Zn.min[1]&&xe[1]<Zn.max[1]&&xe[2]*qe<Zn.max[2]&&$n.footprint&&o.b$(rn,$n.footprint)?Math.max(_n.cameraCollisionOpacity-Br,0):Math.min(1,_n.cameraCollisionOpacity+Br)}const Xi=[...jn],Ar=1/o.d6(vn.canonical),Ci=$n.anchor?$n.anchor[0]:0,xn=$n.anchor?$n.anchor[1]:0;o.br(Xi,Xi,[Ci*(Ai[0]-1)+_n.evaluatedTranslation[0]*Ar,xn*(Ai[1]-1)+_n.evaluatedTranslation[1]*Ar,Un+_n.evaluatedTranslation[2]]),o.cp(Ai,o.ev)||o.cR(Xi,Xi,Ai);const Qt=o.aB([],Xi,$n.matrix),ti=o.aB([],ge.expandedFarZProjMatrix,Qt),Ui=o.aB([],ge.expandedFarZProjMatrix,Xi),ki=o.aC([],[Ci,xn,Un,1],ti)[2];$n.hidden=!1;let tr=We;Ze||(mt&&(tr*=_n.cameraCollisionOpacity,tr*=Pg(Xi,ge,_n.aabb,it)),tr*=Gf(It,ki)),tr!==0?Ei.push({nodeInfo:_n,depth:ki,opacity:tr,wvpForNode:ti,wvpForTile:Ui,nodeModelMatrix:Qt,tileModelMatrix:Xi}):$n.hidden=!0}Ze||Ei.sort((_n,$n)=>!mt||_n.opacity===1&&$n.opacity===1?_n.depth<$n.depth?-1:1:_n.opacity===1?-1:$n.opacity===1?1:_n.depth>$n.depth?-1:1);for(const _n of Ei){const $n=_n.nodeInfo,Un=$n.node;let Zn=o.aB([],Oe,_n.tileModelMatrix);o.aB(Zn,Re,Zn);const Ai=o.bl([],Zn);o.ed(Ai,Ai),o.cR(Ai,Ai,Gw),Zn=o.aB(Zn,Zn,Un.matrix);const Xi=Z.renderPass==="light-beam",Ar=oe.paint.get("model-color-use-theme").constantOr("default")==="none",Ci=Yn&o.ez.HasMapboxMeshFeatures,xn=Ci?0:$n.evaluatedRMEA[0][2];for(let Qt=0;Qt<Un.meshes.length;++Qt){const ti=Un.meshes[Qt],Ui=Qt===Un.lightMeshIndex;let ki=_n.wvpForNode;if(Ui){if(!Xi&&!Z.terrain&&Z.shadowRenderer){Z.currentLayer<Z.firstLightBeamLayer&&(Z.firstLightBeamLayer=Z.currentLayer);continue}ki=_n.wvpForTile}else if(Xi)continue;const tr={defines:[]},Br=[];if(!Ze&&_e&&(_e.useNormalOffset=!!ti.normalBuffer),Vf(tr.defines,Br,ti,Z,Ar?null:oe.lut),Ci||tr.defines.push("DIFFUSE_SHADED"),hn&&tr.defines.push("SHADOWS_SINGLE_CASCADE"),ht&&(Ze?ht.numRenderedVerticesInShadowPass+=ti.vertexArray.length:ht.numRenderedVerticesInTransparentPass+=ti.vertexArray.length),Ze){Uh(ti,_n.nodeModelMatrix,Z,oe);continue}let po=null;if(ve){const Wo=Le(_n.nodeModelMatrix,Z.transform);if(po=new Float32Array(Wo),ge.projection.name!=="globe"){const qi=ti.aabb.min,Ki=ti.aabb.max,[Di,fr]=ve.getOpacityForBounds(Wo,qi[0],qi[1],Ki[0],Ki[1]);tr.overrideFog=Di>=$t||fr>=$t}}const mo=ti.material;let Vs;mo.occlusionTexture&&mo.occlusionTexture.offsetScale&&(Vs=mo.occlusionTexture.offsetScale,tr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Us=Z.getOrCreateProgram("model",tr);!Ze&&_e&&_e.setupShadowsFromMatrix(_n.tileModelMatrix,Us,_e.useNormalOffset),Z.uploadCommonUniforms(ye,Us,null,po);const ws=mo.pbrMetallicRoughness;ws.metallicFactor=.9,ws.roughnessFactor=.5;const Po=kf(new Float32Array(ki),new Float32Array(Zn),new Float32Array(Ai),new Float32Array(Un.matrix),Z,_n.opacity,ws.baseColorFactor,mo.emissiveFactor,ws.metallicFactor,ws.roughnessFactor,mo,xn,oe,[0,0,0],Vs);!Ui&&($n.hasTranslucentParts||_n.opacity<1)&&Us.draw(Z,ye.gl.TRIANGLES,gt,Jt.disabled,yn.disabled,nn.backCCW,Po,oe.id,ti.vertexBuffer,ti.indexBuffer,ti.segments,oe.paint,Z.transform.zoom,void 0,Br),Us.draw(Z,ye.gl.TRIANGLES,Ui?Fe:gt,Jt.disabled,Ui||_n.opacity<1||$n.hasTranslucentParts?yn.alphaBlended:yn.unblended,nn.backCCW,Po,oe.id,ti.vertexBuffer,ti.indexBuffer,ti.segments,oe.paint,Z.transform.zoom,void 0,Br)}}}}()}(d,n,a,h),void I();if(P.type!=="model")return;const R=P.getModels(),F=[],D=d.transform.getFreeCameraOptions().position,j=o.c4([],[D.x,D.y,D.z],d.transform.worldSize);o.et(j,j);const U=[],G=[];let J=0;for(const Z of R){const ee=a.paint.get("model-rotation").constantOr(null),oe=a.paint.get("model-scale").constantOr(null),ue=a.paint.get("model-translation").constantOr(null);Z.computeModelMatrix(d,ee,oe,ue,!0,!0,!1);const ye=o.bA([]),ge=o.ec(Z.position.lat,d.transform.zoom),ve=o.bq([],[1,1,1/ge]);o.br(ye,ye,j),F.push({zScaleMatrix:ve,negCameraPosMatrix:ye});for(const _e of Z.nodes)Uf(d.transform,_e,Z.matrix,d.transform.expandedFarZProjMatrix,J,U,G);J++}if(U.sort((Z,ee)=>ee.depth-Z.depth),d.renderPass!=="shadow"){if(g===1)for(const Z of G)gc(Z,d,a,F[Z.modelIndex],Jt.disabled,d.colorModeForRenderPass());else{for(const Z of G)gc(Z,d,a,F[Z.modelIndex],Jt.disabled,yn.disabled);for(const Z of G)gc(Z,d,a,F[Z.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const Z of U)gc(Z,d,a,F[Z.modelIndex],Jt.disabled,d.colorModeForRenderPass());I()}else{for(const Z of G)Uh(Z.mesh,Z.nodeModelMatrix,d,a);for(const Z of U)Uh(Z.mesh,Z.nodeModelMatrix,d,a);I()}}},_c={line:function(d,n,a){if(d.hasElevatedBuckets=!1,d.hasNonElevatedBuckets=!1,d._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||d._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const h=n.getVisibleCoordinates();for(const g of h){const y=n.getTile(g).getBucket(d);if(y&&(y.elevationType!=="none"?d.hasElevatedBuckets=!0:d.hasNonElevatedBuckets=!0,d.hasElevatedBuckets&&d.hasNonElevatedBuckets))break}}}else d.hasNonElevatedBuckets=!0},model:function(d,n,a){const h=n.getSource();if(!h.loaded())return;if(h.type==="vector"||h.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,h.type==="vector"?d.scope:""));if(h.type==="batched-model"||h.type!=="model")return;const g=h.getModels();for(const y of g)y.upload(a.context)},raster:function(d,n,a){const h=n.getSource();if(!(h instanceof sl&&h.loaded()))return;const g=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!g)return;const y=d.paint.get("raster-array-band")||h.getInitialBand(g);if(y==null)return;const x=n.getIds().map(T=>n.getTileByID(T));for(const T of x)T.updateNeeded(d.id,y)&&h.prepareTile(T,g,d.id,y)},"raster-particle":function(d,n,a){const h=n.getSource();if(!(h instanceof sl&&h.loaded()))return;const g=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!g)return;const y=d.paint.get("raster-particle-array-band")||h.getInitialBand(g);if(y==null)return;const x=n.getIds().map(T=>n.getTileByID(T));for(const T of x)T.updateNeeded(d.id,y)&&h.prepareTile(T,g,d.id,y)}},yc={fill:uc},Tl={fill:function(d,n,a,h){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const g=d.context.gl,y=new Ct(g.LEQUAL,Ct.ReadOnly,d.depthRangeFor3D),x=new Jt({func:g.ALWAYS,mask:255},255,255,g.KEEP,g.KEEP,g.REPLACE),T=d.transform.getFreeCameraOptions().position,I=d.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const P of h){const R=n.getTile(P),F=R.getBucket(a);if(!F)continue;const D=F.elevatedStructures;if(!D||D.depthSegments.segments[0].primitiveLength===0)continue;const j=Ov(P.toUnwrapped(),T),U=d.translatePosMatrix(P.projMatrix,R,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),G=Af(U,j,0,1,0);I.draw(d,g.TRIANGLES,y,x,yn.disabled,nn.disabled,G,a.id,D.vertexBuffer,D.indexBuffer,D.depthSegments,a.paint,d.transform.zoom)}}};class Rg{constructor(n,a,h,g,y,x){this.context=new xg(n,a),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=o.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const P of T)this._debugParams.enabledLayers[P]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const P of T)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],P);this.occlusionParams=new $f(y),this.setup(),this.numSublayers=oo.maxUnderzooming+oo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new _w(this),this._wireframeDebugCache=new Hv,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new o.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,I,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g,this.worldview=x}updateTerrain(n,a){const h=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Fh(this,n));const g=this._terrain;this.transform.elevation=h?g:null,g.update(n,this.transform,a),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(n){const a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,g]=a.getFovAdjustedRange(this.transform._fov);if(h>g)return void(this.transform.fogCullDistSq=null);const y=h+.78*(g-h);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new Fh(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,a){if(this.width=n*o.o.devicePixelRatio,this.height=a*o.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._mergedLayers[h].resize()}setup(){const n=this.context,a=new o.bd;a.emplaceBack(0,0),a.emplaceBack(o.al,0),a.emplaceBack(0,o.al),a.emplaceBack(o.al,o.al),this.tileExtentBuffer=n.createVertexBuffer(a,o.bf.members),this.tileExtentSegments=o.bg.simpleSegment(0,0,4,2);const h=new o.bd;h.emplaceBack(0,0),h.emplaceBack(o.al,0),h.emplaceBack(0,o.al),h.emplaceBack(o.al,o.al),this.debugBuffer=n.createVertexBuffer(h,o.bf.members),this.debugSegments=o.bg.simpleSegment(0,0,4,5);const g=new o.bd;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(g,o.bf.members),this.viewportSegments=o.bg.simpleSegment(0,0,4,2);const y=new o.b0;y.emplaceBack(0,0,0,0),y.emplaceBack(o.al,0,o.al,0),y.emplaceBack(0,o.al,0,o.al),y.emplaceBack(o.al,o.al,o.al,o.al),this.mercatorBoundsBuffer=n.createVertexBuffer(y,o.bi.members),this.mercatorBoundsSegments=o.bg.simpleSegment(0,0,4,2);const x=new o.b1;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(x);const T=new o.be;for(const P of[0,1,3,2,0])T.emplaceBack(P);this.debugIndexBuffer=n.createIndexBuffer(T),this.emptyTexture=new o.T(n,new o.q({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=o.bC();const I=this.context.gl;this.stencilClearMode=new Jt({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,Ct.disabled,this.stencilClearMode,yn.disabled,nn.disabled,sc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,h){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const I of h)if(this._tileClippingMaskIDs[I.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=a.id;const g=this.context,y=g.gl;this.nextStencilID+h.length>256&&this.clearStencil(),g.setColorMode(yn.disabled),g.setDepthMode(Ct.disabled);const x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of h){const I=a.getTile(T),P=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:F,tileBoundsSegments:D}=this.getTileBoundsBuffers(I);x.draw(this,y.TRIANGLES,Ct.disabled,new Jt({func:y.ALWAYS,mask:0},P,255,y.KEEP,y.KEEP,y.REPLACE),yn.disabled,nn.disabled,sc(T.projMatrix),"$clipping",R,F,D)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new Jt({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new Jt({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,h=n.sort((x,T)=>T.overscaledZ-x.overscaledZ),g=h[h.length-1].overscaledZ,y=h[0].overscaledZ-g+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const x={};for(let T=0;T<y;T++)x[T+g]=new Jt({func:a.GEQUAL,mask:255},T+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=y,[x,h]}return[{[g]:Jt.disabled},h]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new yn([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new o.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?yn.unblended:yn.alphaBlended}colorModeForDrapableLayerRenderPass(n){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new yn([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new o.ao(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,a,h,g=!1){if(this.depthOcclusion)return new Ct(this.context.gl.GREATER,Ct.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return Ct.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Ct(h||this.context.gl.LEQUAL,a,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,a=Math.ceil(this.width),h=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),y=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===h||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&h!==0&&(this.depthFBO=new Df(this.context,a,h,!1,"texture"),this.depthTexture=new o.T(this.context,{width:a,height:h,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),n.bindTexture(n.TEXTURE_2D,y),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,a,h,0,0,a,h,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,a)=>n+a/this._fpsHistory.length,0))}render(n,a){const h=o.o.now();this._dt=h-this._timeStamp,this._timeStamp=h,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=a;const g=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(y).filter(Fe=>{const Ce=g[Fe];return!(Ce.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ce.type]});let T=x(),I=!1,P=!1,R=null;for(const Fe of T){const Ce=g[Fe];Ce.type==="circle"?I=!0:Ce.type==="building"?R=Ce:Ce.type==="symbol"&&(Ce.hasOcclusionOpacityProperties?P=!0:I=!0)}let F=T.map(Fe=>g[Fe]);const D=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.o.now()),this.imageManager.beginFrame();let j=0,U=!1;for(const Fe in D){const Ce=D[Fe];Ce.used&&(Ce.prepare(this.context),Ce.getSource().usedInConflation&&++j)}let G=!1;for(const Fe of F)Fe.isHidden(this.transform.zoom)||(Fe.type==="clip"&&(G=!0),this.prepareLayer(Fe));const J={},Z={},ee={},oe={},ue={};for(const Fe in D){const Ce=D[Fe];J[Fe]=Ce.getVisibleCoordinates(),Z[Fe]=J[Fe].slice().reverse(),ee[Fe]=Ce.getVisibleCoordinates(!0).reverse(),oe[Fe]=Ce.getShadowCasterCoordinates(),ue[Fe]=Ce.sortCoordinatesByDistance(J[Fe])}const ye=Fe=>{const Ce=this.style.getLayerSourceCache(Fe);return Ce&&Ce.used?Ce.getSource():null};if(j||G||this._clippingActiveLastFrame){const Fe=[],Ce=[];let Ze=0;for(const Ve of F)this.isSourceForClippingOrConflation(Ve,ye(Ve))&&(Fe.push(Ve),Ce.push(Ze)),Ze++;if(Fe&&(G||Fe.length>1)||this._clippingActiveLastFrame){G=!1;const Ve=[];for(let it=0;it<Fe.length;it++){const mt=Fe[it],It=Ce[it],ht=this.style.getLayerSourceCache(mt);if(!ht||!ht.used||!ht.getSource().usedInConflation&&mt.type!=="clip"&&mt.type!=="building")continue;let at=o.eH,jt=o.bZ.None;const Ot=[];let Bt=!0;if(mt.type==="building")at=o.eJ;else if(mt.type==="clip"){at=It;for(const zt of mt.layout.get("clip-layer-types"))jt|=zt==="model"?o.bZ.Model:zt==="symbol"?o.bZ.Symbol:o.bZ.FillExtrusion;for(const zt of mt.layout.get("clip-layer-scope"))Ot.push(zt);mt.isHidden(this.transform.zoom)?Bt=!1:G=!0}Bt&&Ve.push({layer:mt.fqid,cache:ht,order:at,clipMask:jt,clipScope:Ot})}this.replacementSource.setSources(Ve),U=!0}}this._clippingActiveLastFrame=G,U||this.replacementSource.clear(),this.conflationActive=U,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Fe=0;Fe<F.length;Fe++){const Ce=F[Fe],Ze=Ce.cutoffRange();if(this.longestCutoffRange=Math.max(Ze,this.longestCutoffRange),Ze>0){const Ve=ye(Ce);Ve&&(this.minCutoffZoom=Math.max(Ve.minzoom,this.minCutoffZoom)),Ce.minzoom&&(this.minCutoffZoom=Math.max(Ce.minzoom,this.minCutoffZoom))}Ce.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Fe),this._lastOcclusionLayer=Fe)}const ge=this.style&&this.style.fog;ge?(this._fogVisible=ge.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ge.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ee),this.opaquePassCutoff=0,T=x(),F=T.map(Fe=>g[Fe]));const ve=this._shadowRenderer;if(ve){ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const Fe in D)for(const Ce of J[Fe]){let Ze={min:0,max:0};this.terrain&&(Ze=this.terrain.getMinMaxForTile(Ce)||Ze),ve.addShadowReceiver(Ce.toUnwrapped(),Ze.min,Ze.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new hu(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const _e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),me=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(_e&&!this._snow&&(this._snow=new Xv(this)),!_e&&this._snow&&(this._snow.destroy(),delete this._snow),me&&!this._rain&&(this._rain=new Si(this)),!me&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),R){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Vi);const Fe=this.style.getLayerSourceCache(R);this.buildingTileBorderManager.updateBorders(Fe,R)}if(!Bi.has(this.context.gl))return;this.renderPass="offscreen";for(const Fe of F){const Ce=n.getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;const Ze=Ce?Z[Ce.id]:void 0;(Fe.type==="custom"||Fe.type==="raster"||Fe.type==="raster-particle"||Fe.isSky()||Ze&&Ze.length)&&this.renderLayer(this,Ce,Fe,Ze)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,oe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const xe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ne=(()=>{if(a.showOverdrawInspector)return o.ao.black;const Fe=this.style.fog;if(Fe&&this.transform.projection.supportsFog){const Ce=this.style.getLut(Fe.scope);if(!xe){const Ze=Fe.properties.get("color-use-theme")==="none",Ve=Fe.properties.get("color").toNonPremultipliedRenderColor(Ze?null:Ce).toArray01();return new o.ao(...Ve)}if(xe){const Ze=Fe.properties.get("space-color-use-theme")==="none",Ve=Fe.properties.get("space-color").toNonPremultipliedRenderColor(Ze?null:Ce).toArray01();return new o.ao(...Ve)}}return o.ao.transparent})();if(this.context.clear({color:Ne,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const Fe=F[this.currentLayer],Ce=n.getLayerSourceCache(Fe);if(Fe.isSky())continue;const Ze=Ce?(Fe.is3D(y)?ue:Z)[Ce.id]:void 0;this._renderTileClippingMasks(Fe,Ce,Ze),this.renderLayer(this,Ce,Fe,Ze)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const Fe=F[this.currentLayer],Ce=n.getLayerSourceCache(Fe);Fe.isSky()&&this.renderLayer(this,Ce,Fe,Ce?Z[Ce.id]:void 0)}function Re(Fe,Ce){let Ze;return Ce&&(Ze=(Fe.type==="symbol"?ee:Fe.is3D(y)?ue:Z)[Ce.id]),Ze}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<T.length;){const Fe=F[this.currentLayer];if(Fe.type==="raster"||Fe.type==="raster-particle"){const Ce=n.getLayerSourceCache(Fe);this.renderLayer(this,Ce,Fe,Re(Fe,Ce))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let qe=0;ve&&(qe=ve.getShadowCastingLayerCount());let Oe=!1,We=-1;for(let Fe=0;Fe<T.length;++Fe){const Ce=F[Fe];Ce.isHidden(this.transform.zoom)||Ce.is3D(y)&&(We=Fe)}P&&We===-1&&(I=!0);let gt=!1;for(;this.currentLayer<T.length;){const Fe=F[this.currentLayer],Ce=n.getLayerSourceCache(Fe);if(Fe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Fe)){if(Fe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!gt&&Fe.is3D(y)&&!y){const Ze=this.currentLayer,Ve=it=>{for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const mt=F[this.currentLayer];if(yc[mt.type]){const It=this.style.getLayerSourceCache(mt);yc[mt.type](this,It,mt,Re(mt,It),it)}}};Ve("initialize"),Ve("reset"),this.currentLayer=Ze,gt=!0}if(I&&!Oe&&this.terrain&&!this.transform.isOrthographic&&(Oe=!0,this.blitDepth()),P&&We!==-1&&this.currentLayer===We+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Fe,Ce,Ce?J[Ce.id]:void 0),this.renderLayer(this,Ce,Fe,Re(Fe,Ce)),!this.terrain&&ve&&qe>0&&Fe.hasShadowPass()&&--qe==0){{this.clearStencil(),this.resetStencilClippingMasks();const Ze=this.currentLayer;for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const Ve=F[this.currentLayer];if(Tl[Ve.type]){const it=this.style.getLayerSourceCache(Ve);Tl[Ve.type](this,it,Ve,Re(Ve,it))}}this.currentLayer=Ze}if(ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Ze=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ze;this.currentLayer++){const Ve=F[this.currentLayer];if(!Ve.hasLightBeamPass())continue;const it=n.getLayerSourceCache(Ve);this.renderLayer(this,it,Ve,it?Z[it.id]:void 0)}this.currentLayer=Ze,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ze=this.currentLayer;this.depthOcclusion=!0;for(const Ve of this.layersWithOcclusionOpacity){this.currentLayer=Ve;const it=F[this.currentLayer],mt=n.getLayerSourceCache(it),It=mt?Z[mt.id]:void 0;this.terrain||this._renderTileClippingMasks(it,mt,mt?J[mt.id]:void 0),this.renderLayer(this,mt,it,It)}this.depthOcclusion=!1,this.currentLayer=Ze,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Fe=null;F.forEach(Ce=>{const Ze=n.getLayerSourceCache(Ce);Ze&&!Ce.isHidden(this.transform.zoom)&&Ze.getVisibleCoordinates().length&&(!Fe||Fe.getSource().maxzoom<Ze.getSource().maxzoom)&&(Fe=Ze)}),Fe&&this.options.showTileBoundaries&&jf(this,Fe,Fe.getVisibleCoordinates(),o.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&jf(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Fe){const Ce=Fe.transform.padding;fa(Fe,Fe.transform.height-(Ce.top||0),3,xs),fa(Fe,Ce.bottom||0,3,xl),_i(Fe,Ce.left||0,3,Bv),_i(Fe,Fe.transform.width-(Ce.right||0),3,Eg);const Ze=Fe.transform.centerPoint;(function(Ve,it,mt,It){dc(Ve,it-1,mt-10,2,20,It),dc(Ve,it-10,mt-1,20,2,It)})(Fe,Ze.x,Fe.transform.height-Ze.y,Ig)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),U||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:a}=this.transform.projection,h=!a||!a.includes(n.type);if(_c[n.type]&&(h||this.terrain&&n.type==="custom")){const g=this.style.getLayerSourceCache(n);_c[n.type](n,g,this)}this.gpuTimingEnd()}renderLayer(n,a,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||g&&g.length)&&(this.id=h.id,this.gpuTimingStart(h),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(h.type)&&(!n.terrain||h.type!=="custom")||h.type==="clip"||bl[h.type](n,a,h,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,h=this.context.gl;let g=this.gpuTimers[n.id];g||(g=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:h.createQuery()}),g.calls++,h.beginQuery(a.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=this.context.gl,h=a.createQuery();this.deferredRenderGpuTimeQueries.push(h),a.beginQuery(n.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const h in n){const g=n[h],y=this.context.extTimerQuery,x=y.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(g.query),a[h]=x}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let h=0;for(const g of n)h+=a.getQueryParameter(g,a.QUERY_RESULT)/1e6,a.deleteQuery(g);return h}translatePosMatrix(n,a,h,g,y){if(!h[0]&&!h[1])return n;const x=y?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(x){const P=Math.sin(x),R=Math.cos(x);h=[h[0]*R-h[1]*P,h[0]*P+h[1]*R]}const T=[y?h[0]:o.ay(a,h[0],this.transform.zoom),y?h[1]:o.ay(a,h[1],this.transform.zoom),0],I=new Float32Array(16);return o.br(I,n,T),I}saveTileTexture(n){if(n.context!==this.context)return;const a=n.size[0],h=this._tileTextures[a];h?h.push(n):this._tileTextures[a]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,a,h){const g=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,y=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||g||a!==void 0&&!a||y.push("FOG","FOG_DITHERING"),g&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(n,a){this.cache=this.cache||{};const h=a&&a.defines||[],g=a&&a.config,y=this.currentGlobalDefines(n,a&&a.overrideFog,a&&a.overrideRtt).concat(h),x=If.cacheKey(ff[n],n,y,g);return this.cache[x]||(this.cache[x]=new If(this.context,n,ff[n],g,Nw[n],y)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,a){if(this.style.enable3dLights()){const h=this.style.directionalLight,g=this.style.ambientLight;if(h&&g){const y=((x,T,I)=>{const P=x.properties.get("direction"),R=x.properties.get("color-use-theme")==="none",F=x.properties.get("color").toNonPremultipliedRenderColor(R?null:I.getLut(x.scope)).toArray01(),D=x.properties.get("intensity"),j=T.properties.get("color-use-theme")==="none",U=T.properties.get("color").toNonPremultipliedRenderColor(j?null:I.getLut(T.scope)).toArray01(),G=T.properties.get("intensity"),J=[P.x,P.y,P.z],Z=o.dK(U,G),ee=o.dK(F,D);return{u_lighting_ambient_color:Z,u_lighting_directional_dir:J,u_lighting_directional_color:ee,u_ground_radiance:Ef(J,ee,Z)}})(h,g,this.style);a.setLightsUniformValues(n,y)}}}uploadCommonUniforms(n,a,h,g,y){if(this.uploadCommonLightUniforms(n,a),this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const T=x.getOpacity(this.transform.pitch),I=((P,R,F,D,j,U,G,J,Z,ee,oe,ue)=>{const ye=P.transform,ge=R.properties.get("color-use-theme")==="none",ve=R.properties.get("color").toNonPremultipliedRenderColor(ge?null:P.style.getLut(R.scope)).toArray01();ve[3]=D;const _e=P.frameCounter/1e3%1,[me,xe]=R.properties.get("vertical-range");return{u_fog_matrix:F?ye.calculateFogTileMatrix(F):ue||P.identityMat,u_fog_range:R.getFovAdjustedRange(ye._fov),u_fog_color:ve,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(me,xe),xe],u_fog_temporal_offset:_e,u_frustum_tl:j,u_frustum_tr:U,u_frustum_br:G,u_frustum_bl:J,u_globe_pos:Z,u_globe_radius:ee,u_viewport:oe,u_globe_transition:o.aj(ye.zoom),u_is_globe:+(ye.projection.name==="globe")}})(this,x,h,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.o.devicePixelRatio,this.transform.height*o.o.devicePixelRatio],g);a.setFogUniformValues(n,I)}y&&a.setCutoffUniformValues(n,y.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const g of h)a[g.key]=n[g.key]||new al(g,512,this.transform.tileZoom,this,void 0,this.worldview);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,a){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&n.type!=="building"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building"&&n.sourceLayer!=="procedural_buildings")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[n.key];return a||(this._cachedTileFogOpacities[n.key]=a=this.style.fog.getOpacityForTile(n)),a[0]>=$t||a[1]>=$t}setupDepthForOcclusion(n,a,h){const g=this.context,y=g.gl,x=!!h;var T;h||(h={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(y.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),h.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],h.u_depth_range_unpack=[2/((T=this.depthRangeFor3D)[1]-T[0]),-1-2*T[0]/(T[1]-T[0])],h.u_occluder_half_size=.5*this.occlusionParams.occluderSize,h.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),g.activeTexture.set(y.TEXTURE0),x||a.setTerrainUniformValues(g,h)}}function Hf(d,n){let a=!1,h=null;const g=()=>{h=null,a&&(d(),h=setTimeout(g,n),a=!1)};return()=>(a=!0,h||g(),h)}class kg{constructor(n){this._hashName=n&&encodeURIComponent(n),o.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Hf(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=Wf(n);if(this._hashName){const h=this._hashName;let g=!1;const y=location.hash.slice(1).split("&").map(x=>{const T=x.split("=")[0];return T===h?(g=!0,`${T}=${a}`):x}).filter(x=>x);return g||y.push(`${h}=${a}`),`#${y.join("&")}`}return`#${a}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(a=h)}),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(h=>isNaN(Number(h)))){const h=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:h,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Wf(d,n){const a=d.getCenter(),h=Math.round(100*d.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,g),x=Math.round(a.lng*y)/y,T=Math.round(a.lat*y)/y,I=d.getBearing(),P=d.getPitch();let R=n?`/${x}/${T}/${h}`:`${h}/${T}/${x}`;return(I||P)&&(R+="/"+Math.round(10*I)/10),P&&(R+=`/${Math.round(P)}`),R}const Rs={linearity:.3,easing:o.eK(0,0,.3,1)},Sl=Object.assign({deceleration:2500,maxSpeed:1400},Rs),mu=Object.assign({deceleration:20,maxSpeed:1400},Rs),qf=Object.assign({deceleration:1e3,maxSpeed:360},Rs),Dg=Object.assign({deceleration:1e3,maxSpeed:90},Rs);class Lg{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.o.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=o.o.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)a.zoom+=y.zoomDelta||0,a.bearing+=y.bearingDelta||0,a.pitch+=y.pitchDelta||0,y.panDelta&&a.pan._add(y.panDelta),y.around&&(a.around=y.around),y.pinchAround&&(a.pinchAround=y.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){const y=gu(a.pan.mag(),h,Object.assign({},Sl,n||{}));g.offset=a.pan.mult(y.amount/a.pan.mag()),g.center=this._map.transform.center,$o(g,y)}if(a.zoom){const y=gu(a.zoom,h,mu);g.zoom=this._map.transform.zoom+y.amount,$o(g,y)}if(a.bearing){const y=gu(a.bearing,h,qf);g.bearing=this._map.transform.bearing+o.aA(y.amount,-179,179),$o(g,y)}if(a.pitch){const y=gu(a.pitch,h,Dg);g.pitch=this._map.transform.pitch+y.amount,$o(g,y)}if(g.zoom||g.bearing){const y=a.pinchAround===void 0?a.around:a.pinchAround;g.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function $o(d,n){(!d.duration||d.duration<n.duration)&&(d.duration=n.duration,d.easing=n.easing)}function gu(d,n,a){const{maxSpeed:h,linearity:g,deceleration:y}=a,x=o.aA(d*g/(n/1e3),-h,h),T=Math.abs(x)/(y*g);return{easing:a.easing,duration:1e3*T,amount:x*(T/2)}}class dr extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,h,g={}){const y=Je(a.getCanvasContainer(),h),x=a.unproject(y);super(n,Object.assign({point:y,lngLat:x,originalEvent:h},g)),this._defaultPrevented=!1,this.target=a}}class _u extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,h){const g=n==="touchend"?h.changedTouches:h.touches,y=Dt(a.getCanvasContainer(),g),x=y.map(I=>a.unproject(I)),T=y.reduce((I,P,R,F)=>I.add(P.div(F.length)),new o.P(0,0));super(n,{points:y,point:T,lngLats:x,lngLat:a.unproject(T),originalEvent:h}),this._defaultPrevented=!1}}class Zf extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class zg{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Zf(this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new dr(n.type,this._map,n))}mouseup(n){this._map.fire(new dr(n.type,this._map,n))}preclick(n){const a=new MouseEvent("preclick",n);this._map.fire(new dr(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new dr(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new dr(n.type,this._map,n))}mouseover(n){this._map.fire(new dr(n.type,this._map,n))}mouseout(n){this._map.fire(new dr(n.type,this._map,n))}touchstart(n){return this._firePreventable(new _u(n.type,this._map,n))}touchmove(n){this._map.fire(new _u(n.type,this._map,n))}touchend(n){this._map.fire(new _u(n.type,this._map,n))}touchcancel(n){this._map.fire(new _u(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Og{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new dr(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new dr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new dr(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xr{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(Te(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const h=a,g=this._startPos,y=this._lastPos;if(!g||!y||y.equals(h)||!this._box&&h.dist(g)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=K("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const x=Math.min(g.x,h.x),T=Math.max(g.x,h.x),I=Math.min(g.y,h.y),P=Math.max(g.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${I}px)`,this._box.style.width=T-x+"px",this._box.style.height=P-I+"px")})}mouseupWindow(n,a){if(!this._active)return;const h=this._startPos,g=a;if(h&&n.button===0){if(this.reset(),nt(),h.x!==g.x||h.y!==g.y)return this._map.fire(new o.z("boxzoomend",{originalEvent:n})),{cameraAnimation:y=>y.fitScreenCoordinates(h,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Be(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new o.z(n,{originalEvent:a}))}}function $h(d,n){const a={};for(let h=0;h<d.length;h++)a[d[h].identifier]=n[h];return a}class Fg{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){const y=new o.P(0,0);for(const x of g)y._add(x);return y.div(g.length)}(a),this.touches=$h(h,a)))}touchmove(n,a,h){if(this.aborted||!this.centroid)return;const g=$h(h,a);for(const y in this.touches){const x=g[y];(!x||x.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(n,a,h){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Hh{constructor(n){this.singleTap=new Fg(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,h){this.singleTap.touchstart(n,a,h)}touchmove(n,a,h){this.singleTap.touchmove(n,a,h)}touchend(n,a,h){const g=this.singleTap.touchend(n,a,h);if(g){const y=n.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(g)<30;if(y&&x||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class vc{constructor(){this._zoomIn=new Hh({numTouches:1,numTaps:2}),this._zoomOut=new Hh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,h){this._zoomIn.touchstart(n,a,h),this._zoomOut.touchstart(n,a,h)}touchmove(n,a,h){this._zoomIn.touchmove(n,a,h),this._zoomOut.touchmove(n,a,h)}touchend(n,a,h){const g=this._zoomIn.touchend(n,a,h),y=this._zoomOut.touchend(n,a,h);return g?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(g)},{originalEvent:n})}):y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(y)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ng={0:1,2:2},Xf={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Wh{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const h=wt(n);this._correctButton(n,h)&&(this._lastPoint=a,this._eventButton=h)}mousemoveWindow(n,a){const h=this._lastPoint;if(h){if(n.preventDefault(),this._eventButton!=null&&function(g,y){const x=Ng[y];return g.buttons===void 0||(g.buttons&x)!==x}(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(h,a)}}mouseupWindow(n){this._lastPoint&&wt(n)===this._eventButton&&(this._moved&&nt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yu extends Wh{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class Kf extends Wh{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?Xf[n.pitchRotateKey]:void 0}_correctButton(n,a){return this._pitchRotateKey?a===0&&n[this._pitchRotateKey]:a===0&&n.ctrlKey||a===2}_move(n,a){const h=.8*(a.x-n.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Yf extends Wh{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?Xf[n.pitchRotateKey]:void 0}_correctButton(n,a){return this._pitchRotateKey?a===0&&n[this._pitchRotateKey]:a===0&&n.ctrlKey||a===2}_move(n,a){const h=-.5*(a.y-n.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Bg{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),o.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(n,a,h){return this._calculateTransform(n,a,h)}touchmove(n,a,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!o.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,h)}}touchend(n,a,h){this._calculateTransform(n,a,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,h){h.length>0&&(this._active=!0);const g=$h(h,a),y=new o.P(0,0),x=new o.P(0,0);let T=0;for(const P in g){const R=g[P],F=this._touches[P];F&&(y._add(R),x._add(R.sub(F)),T++,g[P]=R)}if(this._touches=g,T<this._minTouches||!x.mag())return;const I=x.div(T);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(T),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=K("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class vu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,h){return{}}touchstart(n,a,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,h){const g=this._firstTwoTouches;if(!g)return;n.preventDefault();const[y,x]=g,T=xu(h,a,y),I=xu(h,a,x);if(!T||!I)return;const P=this._aroundCenter?null:T.add(I).div(2);return this._move([T,I],P,n)}touchend(n,a,h){if(!this._firstTwoTouches)return;const[g,y]=this._firstTwoTouches,x=xu(h,a,g),T=xu(h,a,y);x&&T||(this._active&&nt(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function xu(d,n,a){for(let h=0;h<d.length;h++)if(d[h].identifier===a)return n[h]}function Jf(d,n){return Math.log2(d/n)}class Kv extends vu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const h=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Jf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jf(this._distance,h),pinchAround:a}}}function jg(d,n){return 180*d.angleWith(n)/Math.PI}class Yv extends vu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const h=this._vector;if(this._vector=n[0].sub(n[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:jg(this._vector,h),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const g=jg(n,h);return Math.abs(g)<a}}function Qf(d){return Math.abs(d.y)>Math.abs(d.x)}class Jv extends vu{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Qf(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,h){const g=this._lastPoints;if(!g)return;const y=n[0].sub(g[0]),x=n[1].sub(g[1]);return this._map._cooperativeGestures&&!o.eL()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(y,x,h.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5})}gestureBeginsVertically(n,a,h){if(this._valid!==void 0)return this._valid;const g=n.mag()>=2,y=a.mag()>=2;if(!g&&!y)return;if(!g||!y)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const x=n.y>0==a.y>0;return Qf(n)&&Qf(a)&&x}}const Qv={panStep:100,bearingStep:15,pitchStep:10};class ex{constructor(){const n=Qv;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,h=0,g=0,y=0,x=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?h=-1:(n.preventDefault(),y=-1);break;case 39:n.shiftKey?h=1:(n.preventDefault(),y=1);break;case 38:n.shiftKey?g=1:(n.preventDefault(),x=-1);break;case 40:n.shiftKey?g=-1:(n.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:T=>{const I=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:tx,zoom:a?Math.round(I)+a*(n.shiftKey?2:1):I,bearing:T.getBearing()+h*this._bearingStep,pitch:T.getPitch()+g*this._pitchStep,offset:[-y*this._panStep,-x*this._panStep],center:T.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function tx(d){return d*(2-d)}const Vg=4.000244140625,nx=1/450;class ix{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=nx,o.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||o.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const h=o.o.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,a!==0&&a%Vg==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Je(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Vg?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&R!==0&&(R=1/R);const F=a(),D=Math.pow(2,F),j=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):D;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(j*R))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:a(),g=this._startZoom,y=this._easing;let x,T=!1;if(this._type==="wheel"&&g&&y){const P=Math.min((o.o.now()-this._lastWheelEventTime)/200,1),R=y(P);x=o.ak(g,h,R),P<1?this._frameId||(this._frameId=!0):T=!0}else x=h,T=!0;this._active=!0,T&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let I=x-a();return I*this._lastDelta<0&&(I=0),{noInertia:!0,needsRenderFrame:!T,zoomDelta:I,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=o.eM;if(this._prevEase){const h=this._prevEase,g=(o.o.now()-h.start)/h.duration,y=h.easing(g+.01)-h.easing(g),x=.27/Math.sqrt(y*y+1e-4)*.01,T=Math.sqrt(.0729-x*x);a=o.eK(x,T,.25,1)}return this._prevEase={start:o.o.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=K("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class rx{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class sx{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(n.shiftKey?-1:1),around:h.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hw{constructor(){this._tap=new Hh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,h){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=a[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(n,a,h))}touchmove(n,a,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const g=a[0],y=g.y-this._swipePoint.y;return this._swipePoint=g,n.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(n,a,h)}touchend(n,a,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(n,a,h)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ww{constructor(n,a,h){this._el=n,this._mousePan=a,this._touchPan=h}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class qw{constructor(n,a,h){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Oi{constructor(n,a,h,g){this._el=n,this._touchZoom=a,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const qh=d=>d.zoom||d.drag||d.pitch||d.rotate;class Zw extends o.z{}class Xw{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const h=o.av([],a,n);this.radius=o.ag(h[2]<0?o.eO([],h,this.constants):[h[0],h[1],0])}projectRay(n){o.eO(n,n,this.constants),o.aw(n,n),o.eP(n,n,this.constants);const a=o.c4([],n,this.radius);if(a[2]>0){const h=o.c4([],[0,0,1],o.bJ(a,[0,0,1])),g=o.c4([],o.aw([],[a[0],a[1],0]),this.radius),y=o.d7([],a,o.c4([],o.av([],o.d7([],g,h),a),2));a[0]=y[0],a[1]=y[1]}return a}}function ep(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Zh{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Lg(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Xw,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),o.aY(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,y,x]of this._listeners){const T=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(y,T,x)}}destroy(){for(const[n,a,h]of this._listeners){const g=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(a,g,h)}}_addDefaultHandlers(n){const a=this._map,h=a.getCanvasContainer();this._add("mapEvent",new zg(a,n));const g=a.boxZoom=new xr(a,n);this._add("boxZoom",g);const y=new vc,x=new sx;a.doubleClickZoom=new rx(x,y),this._add("tapZoom",y),this._add("clickZoom",x);const T=new Hw;this._add("tapDragZoom",T);const I=a.touchPitch=new Jv(a);this._add("touchPitch",I);const P=new Kf(n),R=new Yf(n);a.dragRotate=new qw(n,P,R),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const F=new yu(n),D=new Bg(a,n);a.dragPan=new Ww(h,F,D),this._add("mousePan",F),this._add("touchPan",D,["touchZoom","touchRotate"]);const j=new Yv,U=new Kv;a.touchZoomRotate=new Oi(h,U,j,T),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Og(a));const G=a.scrollZoom=new ix(a,this);this._add("scrollZoom",G,["mousePan"]);const J=a.keyboard=new ex;this._add("keyboard",J);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[Z]&&a[Z].enable(n[Z])}_add(n,a,h){this._handlers.push({handlerName:n,handler:a,allowed:h}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,a,h){for(const g in n)if(g!==h&&(!a||a.indexOf(g)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const h of n)this._el.contains(h.target)&&a.push(h);return a}handleEvent(n,a){this._updatingCamera=!0;const h=n.type==="renderFrame",g=h?void 0:n,y={needsRenderFrame:!1},x={},T={},I=n.touches?this._getMapTouches(n.touches):void 0,P=I?Dt(this._el,I):h?void 0:Je(this._el,n);for(const{handlerName:D,handler:j,allowed:U}of this._handlers){if(!j.isEnabled())continue;let G;this._blockedByActive(T,U,D)?j.reset():j[a||n.type]&&(G=j[a||n.type](n,P,I),this.mergeHandlerResult(y,x,G,D,g),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||j.isActive())&&(T[D]=j)}const R={};for(const D in this._previousActiveHandlers)T[D]||(R[D]=g);this._previousActiveHandlers=T,(Object.keys(R).length||ep(y))&&(this._changes.push([y,x,R]),this._triggerRenderFrame()),(Object.keys(T).length||ep(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=y;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(n,a,h,g,y){if(!h)return;Object.assign(n,h);const x={handlerName:g,originalEvent:h.originalEvent||y};h.zoomDelta!==void 0&&(a.zoom=x),h.panDelta!==void 0&&(a.drag=x),h.pitchDelta!==void 0&&(a.pitch=x),h.bearingDelta!==void 0&&(a.rotate=x)}_applyChanges(){const n={},a={},h={};for(const[g,y,x]of this._changes)g.panDelta&&(n.panDelta=(n.panDelta||new o.P(0,0))._add(g.panDelta)),g.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(n.around=g.around),g.aroundCoord!==void 0&&(n.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(n.pinchAround=g.pinchAround),g.noInertia&&(n.noInertia=g.noInertia),Object.assign(a,y),Object.assign(h,x);this._updateMapTransform(n,a,h),this._changes=[]}_updateMapTransform(n,a,h){const g=this._map,y=g.transform,x=ee=>[ee.x,ee.y,ee.z];if((ee=>{const oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!ep(n)){const ee=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),ee!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&g._stop(!0),!ep(n))return void this._fireEvents(a,h,!0);let{panDelta:T,zoomDelta:I,bearingDelta:P,pitchDelta:R,around:F,aroundCoord:D,pinchAround:j}=n;y._isCameraConstrained&&(I>0&&(I=0),y._isCameraConstrained=!1),j!==void 0&&(F=j),(I||(ee=>a[ee]&&!this._eventsInProgress[ee])("drag"))&&F&&(this._dragOrigin=x(y.pointCoordinate3D(F)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",g._stop(!0),F=F||g.transform.centerPoint,P&&(y.bearing+=P),R&&(y.pitch+=R),y._updateCameraState();const U=[0,0,0];if(T)if(y.projection.name==="mercator"){const ee=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(F).dir),oe=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(F.sub(T)).dir);U[0]=oe[0]-ee[0],U[1]=oe[1]-ee[1]}else{const ee=y.pointCoordinate(F);if(y.projection.name==="globe"){T=T.rotate(-y.angle);const oe=y._pixelsPerMercatorPixel/y.worldSize;U[0]=-T.x*o.eN(o.a$(ee.y))*oe,U[1]=-T.y*o.eN(y.center.lat)*oe}else{const oe=y.pointCoordinate(F.sub(T));ee&&oe&&(U[0]=oe.x-ee.x,U[1]=oe.y-ee.y)}}const G=y.zoom,J=[0,0,0];if(I){const ee=x(D||y.pointCoordinate3D(F)),oe={dir:o.aw([],o.av([],ee,y._camera.position))};if(oe.dir[2]<0){const ue=y.zoomDeltaToMovement(ee,I);o.c4(J,oe.dir,ue)}}const Z=o.d7(U,U,J);y._translateCameraConstrained(Z),I&&Math.abs(y.zoom-G)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,h,!0)}_fireEvents(n,a,h){const g=qh(this._eventsInProgress),y=qh(n),x={};for(const R in n){const{originalEvent:F}=n[R];this._eventsInProgress[R]||(x[`${R}start`]=F),this._eventsInProgress[R]=n[R]}!g&&y&&this._fireEvent("movestart",y.originalEvent);for(const R in x)this._fireEvent(R,x[R]);y&&this._fireEvent("move",y.originalEvent);for(const R in n){const{originalEvent:F}=n[R];this._fireEvent(R,F)}const T={};let I;for(const R in this._eventsInProgress){const{handlerName:F,originalEvent:D}=this._eventsInProgress[R];this._handlersById[F].isActive()||(delete this._eventsInProgress[R],I=a[F]||D,T[`${R}end`]=I)}for(const R in T)this._fireEvent(R,T[R]);const P=qh(this._eventsInProgress);if(h&&(g||y)&&!P){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=D=>D!==0&&-this._bearingSnap<D&&D<this._bearingSnap;R?(F(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:I})):(this._map.fire(new o.z("moveend",{originalEvent:I})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new o.z(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Zw("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ug="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Gg extends o.E{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,o.aY(["_renderFrameCallback"],this)}getCenter(){return new o.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,h){return n=o.P.convert(n).mult(-1),this.panTo(this.transform.center,Object.assign({offset:n},a),h)}panTo(n,a,h){return this.easeTo(Object.assign({center:n},a),h)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,h){return this.easeTo(Object.assign({zoom:n},a),h)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,h){return this.easeTo(Object.assign({bearing:n},a),h)}resetNorth(n,a){return this.rotateTo(0,Object.assign({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){n=o.aI.convert(n);const h=a&&a.bearing||0,g=a&&a.pitch||0,y=n.getNorthWest(),x=n.getSouthEast();return this._cameraForBounds(this.transform,y,x,h,g,a)}_extendPadding(n){const a={top:0,right:0,bottom:0,left:0};return n==null?Object.assign({},a,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:Object.assign({},a,n)}_extendCameraOptions(n){return(n=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,a){const h=a.max[0]-a.min[0],g=a.max[1]-a.min[1];return h/g>n.aspect?h/(2*Math.tan(.5*n.fovX)*n.aspect):g/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,a,h,g,y,x){const T=n.clone(),I=this._extendCameraOptions(x);T.bearing=g,T.pitch=y;const P=o.aR.convert(a),R=o.aR.convert(h),F=.5*(P.lat+R.lat),D=.5*(P.lng+R.lng),j=o.eQ(F,D),U=o.aw([],j),G=o.aw([],o.bI([],U,[0,1,0])),J=o.bI([],G,U),Z=[G[0],G[1],G[2],0,J[0],J[1],J[2],0,U[0],U[1],U[2],0,0,0,0,1],ee=[j,o.eQ(P.lat,P.lng),o.eQ(R.lat,P.lng),o.eQ(R.lat,R.lng),o.eQ(P.lat,R.lng),o.eQ(F,P.lng),o.eQ(F,R.lng),o.eQ(P.lat,D),o.eQ(R.lat,D)];let oe=o.d8.fromPoints(ee.map(Ve=>[o.bJ(G,Ve),o.bJ(J,Ve),o.bJ(U,Ve)]));const ue=o.af([],oe.center,Z);o.eR(ue)===0&&o.eS(ue,0,0,1),o.aw(ue,ue),o.c4(ue,ue,o.aD),T.center=o.eT(ue);const ye=T.getWorldToCameraMatrix(),ge=o.bl(new Float64Array(16),ye);oe=o.d8.applyTransform(oe,o.aB([],ye,Z));const ve=this._extendAABB(oe,T,I,g);if(!ve)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");oe=ve,o.af(ue,ue,ye);const _e=.5*(oe.max[2]-oe.min[2]),me=this._minimumAABBFrustumDistance(T,oe),xe=o.c4([],[0,0,1],_e),Ne=o.d7(xe,ue,xe),Re=me+(T.pitch===0?0:o.bG(ue,Ne)),qe=T.globeCenterInViewSpace,Oe=o.av([],ue,[qe[0],qe[1],qe[2]]);o.aw(Oe,Oe),o.c4(Oe,Oe,Re);const We=o.d7([],ue,Oe);o.af(We,We,ge);const gt=o.eD/o.aD,Fe=o.ag(We),Ce=o.ce(Math.max(Fe*gt-o.eD,Number.EPSILON),0),Ze=Math.min(T.zoomFromMercatorZAdjusted(Ce),I.maxZoom);return Ze>.5*(o.cZ+o.cK)?(T.setProjection({name:"mercator"}),T.zoom=Ze,this._cameraForBounds(T,a,h,g,y,x)):{center:T.center,zoom:Ze,bearing:g,pitch:y}}_extendAABB(n,a,h,g){const y=.5*((h.padding.left||0)+(h.padding.right||0)),x=.5*((h.padding.top||0)+(h.padding.bottom||0)),T=x,I=y,P=y,R=x,F=a.width-(I+P),D=a.height-(T+R),j=o.av([],n.max,n.min),U=Math.min(F/j[0],D/j[1]),G=Math.min(a.scaleZoom(a.scale*U),h.maxZoom);if(isNaN(G))return null;const J=a.scale/a.zoomScale(G),Z=new o.d8([n.min[0]-I*J,n.min[1]-R*J,n.min[2]],[n.max[0]+P*J,n.max[1]+T*J,n.max[2]]),ee=(typeof h.offset.x=="number"&&typeof h.offset.y=="number"?new o.P(h.offset.x,h.offset.y):o.P.convert(h.offset)).rotate(-o.an(g));return Z.center[0]-=ee.x*J,Z.center[1]+=ee.y*J,Z}queryTerrainElevation(n,a){const h=this.transform.elevation;return h?(a=Object.assign({},{exaggerated:!0},a),h.getAtPoint(o.ae.fromLngLat(n),null,a.exaggerated)):null}_cameraForBounds(n,a,h,g,y,x){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,a,h,g,y,x);const T=n.clone(),I=this._extendCameraOptions(x);T.bearing=g,T.pitch=y;const P=o.aR.convert(a),R=o.aR.convert(h),F=new o.aR(P.lng,R.lat),D=new o.aR(R.lng,P.lat),j=T.project(P),U=T.project(R),G=this.queryTerrainElevation(P),J=this.queryTerrainElevation(R),Z=this.queryTerrainElevation(F),ee=this.queryTerrainElevation(D),oe=[[j.x,j.y,Math.min(G||0,J||0,Z||0,ee||0)],[U.x,U.y,Math.max(G||0,J||0,Z||0,ee||0)]];let ue=o.d8.fromPoints(oe);const ye=T.getWorldToCameraMatrix(),ge=o.bl(new Float64Array(16),ye);ue=o.d8.applyTransform(ue,ye);const ve=this._extendAABB(ue,T,I,g);if(!ve)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ue=ve;const _e=.5*o.av([],ue.max,ue.min)[2],me=this._minimumAABBFrustumDistance(T,ue),xe=[0,0,1,0];o.aC(xe,xe,ye),o.eU(xe,xe);const Ne=o.c4([],xe,me+_e),Re=o.d7([],ue.center,Ne);o.af(ue.center,ue.center,ge),o.af(Re,Re,ge);const qe=T.unproject(new o.P(ue.center[0],ue.center[1])),Oe=o.eV(T.projection,qe),We=Math.pow(2,Oe),gt=Math.min(T._zoomFromMercatorZ(Re[2]*T.pixelsPerMeter*We/T.worldSize),I.maxZoom);return T.mercatorFromTransition&&gt<.5*(o.cZ+o.cK)?(T.setProjection({name:"globe"}),T.zoom=gt,this._cameraForBounds(T,a,h,g,y,x)):{center:qe,zoom:gt,bearing:g,pitch:y}}fitBounds(n,a,h){const g=this.cameraForBounds(n,a);return this._fitInternal(g,a,h)}fitScreenCoordinates(n,a,h,g,y){const x=o.P.convert(n),T=o.P.convert(a),I=new o.P(Math.min(x.x,T.x),Math.min(x.y,T.y)),P=new o.P(Math.max(x.x,T.x),Math.max(x.y,T.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,T))return this;const R=this.transform.pointLocation3D(I),F=this.transform.pointLocation3D(P),D=this.transform.pointLocation3D(new o.P(I.x,P.y)),j=this.transform.pointLocation3D(new o.P(P.x,I.y)),U=[Math.min(R.lng,F.lng,D.lng,j.lng),Math.min(R.lat,F.lat,D.lat,j.lat)],G=[Math.max(R.lng,F.lng,D.lng,j.lng),Math.max(R.lat,F.lat,D.lat,j.lat)],J=g&&g.pitch?g.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,U,G,h,J,g);return this._fitInternal(Z,g,y)}_fitInternal(n,a,h){return n?(a=Object.assign(n,a)).linear?this.easeTo(a,h):this.flyTo(a,h):this}jumpTo(n,a){this.stop();const h=n.preloadOnly?this.transform.clone():this.transform;let g=!1,y=!1,x=!1;"zoom"in n&&h.zoom!==+n.zoom&&(g=!0,h.zoom=+n.zoom),n.center!==void 0&&(h.center=o.aR.convert(n.center)),"bearing"in n&&h.bearing!==+n.bearing&&(y=!0,h.bearing=+n.bearing),"pitch"in n&&h.pitch!==+n.pitch&&(x=!0,h.pitch=+n.pitch);const T=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!h.isPaddingEqual(T))if(n.retainPadding===!1){const I=h.clone();I.padding=T,h.setLocationAtPoint(h.center,I.centerPoint)}else h.padding=T;return n.preloadOnly?(this._preloadTiles(h),this):(this.fire(new o.z("movestart",a)).fire(new o.z("move",a)),g&&this.fire(new o.z("zoomstart",a)).fire(new o.z("zoom",a)).fire(new o.z("zoomend",a)),y&&this.fire(new o.z("rotatestart",a)).fire(new o.z("rotate",a)).fire(new o.z("rotateend",a)),x&&this.fire(new o.z("pitchstart",a)).fire(new o.z("pitch",a)).fire(new o.z("pitchend",a)),this.fire(new o.z("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Ug),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const h=this.transform;if(!h.projection.supportsFreeCamera)return o.w(Ug),this;this.stop();const g=h.zoom,y=h.pitch,x=h.bearing;h.setFreeCameraOptions(n);const T=g!==h.zoom,I=y!==h.pitch,P=x!==h.bearing;return this.fire(new o.z("movestart",a)).fire(new o.z("move",a)),T&&this.fire(new o.z("zoomstart",a)).fire(new o.z("zoom",a)).fire(new o.z("zoomend",a)),P&&this.fire(new o.z("rotatestart",a)).fire(new o.z("rotate",a)).fire(new o.z("rotateend",a)),I&&this.fire(new o.z("pitchstart",a)).fire(new o.z("pitch",a)).fire(new o.z("pitchend",a)),this.fire(new o.z("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=Object.assign({offset:[0,0],duration:500,easing:o.eM},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const h=this.transform,g=this.getZoom(),y=this.getBearing(),x=this.getPitch(),T=this.getPadding(),I="zoom"in n?+n.zoom:g,P="bearing"in n?this._normalizeBearing(n.bearing,y):y,R="pitch"in n?+n.pitch:x,F=this._extendPadding(n.padding),D=o.P.convert(n.offset);let j,U,G;if(h.projection.name==="globe"){const xe=o.ae.fromLngLat(h.center),Ne=D.rotate(-h.angle);xe.x+=Ne.x/h.worldSize,xe.y+=Ne.y/h.worldSize;const Re=xe.toLngLat(),qe=o.aR.convert(n.center||Re);this._normalizeCenter(qe),j=h.centerPoint.add(Ne),U=new o.P(xe.x,xe.y).mult(h.worldSize),G=new o.P(o.aF(qe.lng),o.aJ(qe.lat)).mult(h.worldSize).sub(U)}else{j=h.centerPoint.add(D);const xe=h.pointLocation(j),Ne=o.aR.convert(n.center||xe);this._normalizeCenter(Ne),U=h.project(xe),G=h.project(Ne).sub(U)}const J=h.zoomScale(I-g);let Z,ee;n.around&&(Z=o.aR.convert(n.around),ee=h.locationPoint(Z));const oe=this._zooming||I!==g,ue=this._rotating||y!==P,ye=this._pitching||R!==x,ge=!h.isPaddingEqual(F),ve=n.retainPadding===!1?h.clone():h,_e=xe=>Ne=>{if(oe&&(xe.zoom=o.ak(g,I,Ne)),ue&&(xe.bearing=o.ak(y,P,Ne)),ye&&(xe.pitch=o.ak(x,R,Ne)),ge&&(ve.interpolatePadding(T,F,Ne),j=ve.centerPoint.add(D)),Z)xe.setLocationAtPoint(Z,ee);else{const Re=xe.zoomScale(xe.zoom-g),qe=I>g?Math.min(2,J):Math.max(.5,J),Oe=Math.pow(qe,1-Ne),We=xe.unproject(U.add(G.mult(Ne*Oe)).mult(Re));xe.setLocationAtPoint(xe.renderWorldCopies?We.wrap():We,j)}return n.preloadOnly||this._fireMoveEvents(a),xe};if(n.preloadOnly){const xe=this._emulate(_e,n.duration,h);return this._preloadTiles(xe),this}const me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=oe,this._rotating=ue,this._pitching=ye,this._padding=ge,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,me),this._ease(_e(h),xe=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(a,xe)},n),this}_prepareEase(n,a,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||h.moving||this.fire(new o.z("movestart",n)),this._zooming&&!h.zooming&&this.fire(new o.z("zoomstart",n)),this._rotating&&!h.rotating&&this.fire(new o.z("rotatestart",n)),this._pitching&&!h.pitching&&this.fire(new o.z("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.z("move",n)),this._zooming&&this.fire(new o.z("zoom",n)),this._rotating&&this.fire(new o.z("rotate",n)),this._pitching&&this.fire(new o.z("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,g=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new o.z("zoomend",n)),g&&this.fire(new o.z("rotateend",n)),y&&this.fire(new o.z("pitchend",n)),this.fire(new o.z("moveend",n))}flyTo(n,a){if(this._prefersReducedMotion(n)){const Ve=o.aH(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ve,a)}this.stop(),n=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:o.eM},n);const h=this.transform,g=this.getZoom(),y=this.getBearing(),x=this.getPitch(),T=this.getPadding(),I="zoom"in n?o.aA(+n.zoom,h.minZoom,h.maxZoom):g,P="bearing"in n?this._normalizeBearing(n.bearing,y):y,R="pitch"in n?+n.pitch:x,F=this._extendPadding(n.padding),D=h.zoomScale(I-g),j=o.P.convert(n.offset);let U=h.centerPoint.add(j);const G=h.pointLocation(U),J=o.aR.convert(n.center||G);this._normalizeCenter(J);const Z=h.project(G),ee=h.project(J).sub(Z);let oe=n.curve;const ue=Math.max(h.width,h.height),ye=ue/D,ge=ee.mag();if("minZoom"in n){const Ve=o.aA(Math.min(n.minZoom,g,I),h.minZoom,h.maxZoom),it=ue/h.zoomScale(Ve-g);oe=Math.sqrt(it/ge*2)}const ve=oe*oe;function _e(Ve){const it=(ye*ye-ue*ue+(Ve?-1:1)*ve*ve*ge*ge)/(2*(Ve?ye:ue)*ve*ge);return Math.log(Math.sqrt(it*it+1)-it)}function me(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function xe(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}const Ne=_e(0);let Re=function(Ve){return xe(Ne)/xe(Ne+oe*Ve)},qe=function(Ve){return ue*((xe(Ne)*(me(it=Ne+oe*Ve)/xe(it))-me(Ne))/ve)/ge;var it},Oe=(_e(1)-Ne)/oe;if(Math.abs(ge)<1e-6||!isFinite(Oe)){if(Math.abs(ue-ye)<1e-6)return this.easeTo(n,a);const Ve=ye<ue?-1:1;Oe=Math.abs(Math.log(ye/ue))/oe,qe=function(){return 0},Re=function(it){return Math.exp(Ve*oe*it)}}n.duration="duration"in n?+n.duration:1e3*Oe/("screenSpeed"in n?+n.screenSpeed/oe:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const We=y!==P,gt=R!==x,Fe=!h.isPaddingEqual(F),Ce=n.retainPadding===!1?h.clone():h,Ze=Ve=>it=>{const mt=it*Oe,It=1/Re(mt);Ve.zoom=it===1?I:g+Ve.scaleZoom(It),We&&(Ve.bearing=o.ak(y,P,it)),gt&&(Ve.pitch=o.ak(x,R,it)),Fe&&(Ce.interpolatePadding(T,F,it),U=Ce.centerPoint.add(j));const ht=it===1?J:Ve.unproject(Z.add(ee.mult(qe(mt))).mult(It));return Ve.setLocationAtPoint(Ve.renderWorldCopies?ht.wrap():ht,U),Ve._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),Ve};if(n.preloadOnly){const Ve=this._emulate(Ze,n.duration,h);return this._preloadTiles(Ve),this}return this._zooming=!0,this._rotating=We,this._pitching=gt,this._padding=Fe,this._prepareEase(a,!1),this._ease(Ze(h),()=>this._afterEase(a),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,a)}if(!n){const h=this.handlers;h&&h.stop(!1)}return this}_ease(n,a,h){h.animate===!1||h.duration===0?(n(1),a()):(this._easeStart=o.o.now(),this._easeOptions=h,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((o.o.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=o.bT(n,-180,180);const h=Math.abs(n-a);return Math.abs(n-360-a)<h&&(n-=360),Math.abs(n+360-a)<h&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const h=n.lng-a.center.lng;n.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&o.o.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,a,h){const g=Math.ceil(15*a/1e3),y=[],x=n(h.clone());for(let T=0;T<=g;T++){const I=x(T/g);y.push(I.clone())}return y}_preloadTiles(n,a){}}class Xh{constructor(n={}){this.options=n,o.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact,h=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=K("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",h);const g=K("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",h),this._innerContainer=K("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(n){const h=a.reduce((g,y,x)=>(y.value&&(g+=`${y.key}=${y.value}${x<a.length-1?"&":""}`),g),"?");n.href=`${o.e.FEEDBACK_URL}/${h}#${Wf(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||(n.dataType!=="source"||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility")&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const a=this._map.style._mergedSourceCaches;for(const g in a){const y=a[g];if(y.used){const x=y.getSource();x.attribution&&n.indexOf(x.attribution)<0&&n.push(x.attribution)}}n.sort((g,y)=>g.length-y.length),n=n.filter((g,y)=>{for(let x=y+1;x<n.length;x++)if(n[x].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const h=n.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,n.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class pa{constructor(){o.aY(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=K("div","mapboxgl-ctrl");const a=K("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const a in n){const h=n[a].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Kh{constructor(){o.aY(["_onIndoorUpdate"],this)}onAdd(n){return this._map=n,this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",a=>this._onIndoorUpdate({selectedFloorId:a.selectedFloorId,floors:a.floors})),this._container}_createButton(n,a){const h=K("button",n,this._container);return h.type="button",h.addEventListener("click",a),h}_createSeparator(){return K("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(n,a){this._map&&(n.setAttribute("aria-label",a),n.textContent=a)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(n){if(!n||!n.floors)return void(this._container.style.display="none");const a=this._model;this._model=n,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const h=n.floors.sort((g,y)=>y.levelOrder-g.levelOrder);a?(Array.from(this._container.children).forEach(g=>g.remove()),this.addCurrentFloors(h)):this.addCurrentFloors(h)}addCurrentFloors(n){for(let a=0;a<n.length;a++){const h=n[a],g=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(h.id),this._model&&(this._model.selectedFloorId=h.id),Array.from(this._container.children).forEach(y=>{y.classList.contains("mapboxgl-ctrl-level-button")&&y.classList.remove("mapboxgl-ctrl-level-button-selected")}),g.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(g,h.shortName),this._model&&h.id===this._model.selectedFloorId&&g.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(g),a<n.length-1&&this._createSeparator()}}}class Yi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,h=a?this._queue.concat(a):this._queue;for(const g of h)if(g.id===n)return void(g.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const h of a)if(!h.cancelled&&(h.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class ma{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=o.dz((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,h){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+h}}const Yh={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Jh extends o.z{constructor(n,a,h,g){const{point:y,lngLat:x,originalEvent:T,target:I}=n;super(n.type,{point:y,lngLat:x,originalEvent:T,target:I}),this.preventDefault=()=>{n.preventDefault()},this.id=a,this.interaction=h,this.feature=g}}class ox{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,a){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const h=a.filter;let g=a.type;h&&this.filters.set(n,o.b6(h)),g==="mouseover"&&(g="mouseenter"),g==="mouseout"&&(g="mouseleave");const y=this.interactionsByType.get(g)||new Map;g==="mouseenter"||g==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,a)):y.size===0&&this.map.on(g,this.handleType),y.size===0&&this.interactionsByType.set(g,y),y.set(n,a),this.typeById.set(n,g)}get(n){const a=this.typeById.get(n);if(!a)return;const h=this.interactionsByType.get(a);return h?h.get(n):void 0}remove(n){const a=this.typeById.get(n);if(!a)return;this.typeById.delete(n),this.filters.delete(n);const h=this.interactionsByType.get(a);h&&(h.delete(n),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):h.size===0&&this.map.off(a,this.handleType))}queryTargets(n,a){const h=[];for(const[g,y]of a)y.target&&h.push({targetId:g,target:y.target,filter:this.filters.get(g)});return this.map.style.queryRenderedTargets(n,h,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());a.length&&(n.type="mouseenter",this.handleType(n,a));const h=new Map;for(const[g,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(g)||h.set(y.id,y);h.size&&(n.type="mouseleave",this.handleType(n,Array.from(h.values())))}handleOut(n){const a=Array.from(this.hoveredFeatures.values()).map(({feature:h})=>h);a.length&&(n.type="mouseleave",this.handleType(n,a)),this.hoveredFeatures.clear()}handleType(n,a){const h=n.type==="mouseenter";if(h&&!this.interactionsByType.has(n.type))return void o.w("mouseenter interaction required for mouseleave to work.");const g=Array.from(this.interactionsByType.get(n.type)).reverse(),y=!!a;a=a||this.queryTargets(n.point,g);let x=!1;const T=new Set;for(const I of a){for(const[P,R]of g){if(!R.target)continue;const F=I.variants?I.variants[P]:null;if(F){for(const D of F){if(ol(D,I,T,P))continue;const j=new o.dt(I,D),U=yh(D,I,P);y&&(j.state=this.map.getFeatureState(j));const G=h?this.prevHoveredFeatures.get(U):null,J=new Jh(n,P,R,j),Z=G?G.stop:R.handler(J);if(h&&this.hoveredFeatures.set(U,{feature:I,stop:Z}),Z!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(const[I,P]of g){const{handler:R,target:F}=P;if(!F&&R(new Jh(n,I,P,null))!==!1)break}}}function Kw(d,n){if(Array.isArray(d)&&Array.isArray(n)){const a=new Set(d),h=new Set(n);return a.size===h.size&&d.every(g=>h.has(g))}return o.by(d,n)}const Qh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Yw={showCompass:!0,showZoom:!0,visualizePitch:!1};class Jw{constructor(n,a,h=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Kf({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,h&&(this.mousePitch=new Yf({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),Te()}move(n,a){const h=this.map,g=this.mouseRotate.mousemoveWindow(n,a),y=g&&g.bearingDelta;if(y&&h.setBearing(h.getBearing()+y),this.mousePitch){const x=this.mousePitch.mousemoveWindow(n,a),T=x&&x.pitchDelta;T&&h.setPitch(h.getPitch()+T)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Be(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(Object.assign({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Je(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Je(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Dt(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Dt(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function tp(d,n,a){if(d=new o.aR(d.lng,d.lat),n){const h=new o.aR(d.lng-360,d.lat),g=new o.aR(d.lng+360,d.lat),y=360*Math.ceil(Math.abs(d.lng-a.center.lng)/360),x=a.locationPoint3D(d).distSqr(n),T=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint3D(h).distSqr(n)<x&&(T||Math.abs(h.lng-a.center.lng)<y)?d=h:a.locationPoint3D(g).distSqr(n)<x&&(T||Math.abs(g.lng-a.center.lng)<y)&&(d=g)}for(;Math.abs(d.lng-a.center.lng)>180;){const h=a.locationPoint3D(d);if(h.x>=0&&h.y>=0&&h.x<=a.width&&h.y<=a.height)break;d.lng>a.center.lng?d.lng-=360:d.lng+=360}return d}const ed={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},fo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class xc extends o.E{constructor(n,a){super(),(n instanceof HTMLElement||a)&&(n=Object.assign({element:n},a)),o.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:h="center",color:g="#3FB1CE",scale:y=1,draggable:x=!1,clickTolerance:T=0,rotation:I=fo.rotation,rotationAlignment:P=fo.rotationAlignment,pitchAlignment:R=fo.pitchAlignment,occludedOpacity:F=fo.occludedOpacity,altitude:D=fo.altitude}=n||{};this._anchor=h,this._color=g,this._scale=y,this._draggable=x,this._clickTolerance=T,this._rotation=I,this._rotationAlignment=P,this._pitchAlignment=R,this._occludedOpacity=F,this._altitude=D,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=o.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",G=>{G.preventDefault()}),this._element.addEventListener("mousedown",G=>{G.preventDefault()});const j=this._element.classList;for(const G in ed)j.remove(`mapboxgl-marker-anchor-${G}`);j.add(`mapboxgl-marker-anchor-${this._anchor}`);const U=n&&n.className?n.className.trim().split(/\s+/):[];j.add(...U),this._popup=null}_createDefaultMarker(){const n=K("div"),a=se("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const h=se("radialGradient",{id:"shadowGradient"},se("defs",{},a));se("stop",{offset:"10%","stop-opacity":.4},h),se("stop",{offset:"100%","stop-opacity":.05},h),se("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return se("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),se("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),se("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.aR.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||fo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,h=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,h=this._element;this._popup&&(a===h||h.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,a=this._pos;if(!n||!a)return!1;const h=n.unproject(a,this._altitude),g=n.getFreeCameraOptions();if(!g.position)return!1;const y=g.position.toLngLat();return y.distanceTo(h)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const h=n.unproject(a,this._altitude);let g;n._showingGlobe()&&o.eY(n.transform,this._lngLat)?g=0:(g=1-n._queryFogOpacity(h),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${ed[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const n=this._pos,a=this._map,h=this.getPitchAlignment();if(!a||!n||h!=="map")return"";if(!a._showingGlobe()){const I=a.getPitch();return I?`rotateX(${I}deg)`:""}const g=o.cW(o.eZ(a.transform,this._lngLat)),y=n.sub(o.e_(a.transform)),x=Math.abs(y.x)+Math.abs(y.y);if(x===0)return"";const T=g/x;return`rotateX(${-y.y*T}deg) rotateY(${y.x*T}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let h=0;const g=this.getRotationAlignment();if(g==="map")if(a._showingGlobe()){const y=a.project(new o.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),x=a.project(new o.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);h=o.cW(Math.atan2(x.y,x.x))-90}else h=-a.getBearing();else if(g==="horizon"){const y=o.ah(4,6,a.getZoom()),x=o.e_(a.transform);x.y+=y*a.transform.height;const T=n.sub(x),I=o.cW(Math.atan2(T.y,T.x));h=(I>90?I-270:I+90)*(1-y)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=tp(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=o.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const a=this._map;if(!a)return;const h=this._pointerdownPos,g=this._positionDelta;if(h&&g){if(!this._isDragging){const y=this._clickTolerance||a._clickTolerance;if(n.point.dist(h)<y)return;this._isDragging=!0}this._pos=n.point.sub(g),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.z("dragstart"))),this.fire(new o.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.z("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map,h=this._pos;a&&h&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(h),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||fo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||fo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||fo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||fo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const El={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},za={maxWidth:100,unit:"metric"},Oa={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},wc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ho=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ax(d=new o.P(0,0),n="bottom"){if(typeof d=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(n){case"top":return new o.P(0,d);case"top-left":return new o.P(a,a);case"top-right":return new o.P(-a,a);case"bottom":return new o.P(0,-d);case"bottom-left":return new o.P(a,-a);case"bottom-right":return new o.P(-a,-a);case"left":return new o.P(d,0);case"right":return new o.P(-d,0)}return new o.P(0,0)}return d instanceof o.P||Array.isArray(d)?o.P.convert(d):o.P.convert(d[n]||[0,0])}return{version:k,supported:ce.supported,setRTLTextPlugin:o.f2,getRTLTextPluginStatus:o.f1,Map:class extends Gg{constructor(d){N.mark(L.create);const n=d;if((d=Object.assign({},Qh,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&o.eW(window)&&(d.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new vs(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies,null,null),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Yi,this._domRenderTaskQueue=new Yi,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.b2(),this._locale=Object.assign({},Yh,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ma(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=d.scaleFactor,this._requestManager=new Ht(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?Object.assign({},d.contextCreateOptions):{},typeof d.container=="string"){const a=document.getElementById(d.container);if(!a)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=a}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),this._spriteFormat=d.spriteFormat,o.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new fu),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Zh(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||o.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this.indoor=new ic(this),d.hash&&(this._hash=new kg(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const a=d.bounds;a&&(this.resize(),this.fitBounds(a,Object.assign({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new Xh({customAttribution:d.customAttribution})),this._logoControl=new pa,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new o.z(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new o.z(`${a.dataType}dataloading`,a))}),this._interactions=new ox(this)}_getMapId(){return this._mapId}addControl(d,n){if(n===void 0&&(n=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new o.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=d.onAdd(this);this._controls.push(d);const h=this._controlPositions[n];return n.indexOf("bottom")!==-1?h.insertBefore(a,h.firstChild):h.appendChild(a),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new o.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(d);return n>-1&&this._controls.splice(n,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new o.z("movestart",d)).fire(new o.z("move",d)),this.fire(new o.z("resize",d)),n&&this.fire(new o.z("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(o.aI.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(d){return this._scaleFactor=d,this.painter.scaleFactor=d,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(n=>n==="auto"?navigator.language:n):d}setLanguage(d){const n=this._parseLanguage(d);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,n=d.projection.name;let a;n==="globe"&&d.zoom>=o.cK?(d.setMercatorFromTransition(),a=!0):n==="mercator"&&d.zoom<o.cK&&(d.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(d,n){return this._updateProjection(d||n||{name:"mercator"})}_updateProjection(d){let n;return n=d.name==="globe"&&this.transform.zoom>=o.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d,n){return this.transform.locationPoint3D(o.aR.convert(d),n)}unproject(d,n){return this.transform.pointLocation3D(o.P.convert(d),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,n,a){const h=g=>{let y=[];if(Array.isArray(n)){const x=n.filter(T=>this.getLayer(T));y=x.length?this.queryRenderedFeatures(g,{layers:x}):[]}else y=this.queryRenderedFeatures(g,{target:n});return y};if(d==="mouseenter"||d==="mouseover"){let g=!1;return{listener:a,targets:n,delegates:{mousemove:x=>{const T=h(x.point);T.length?g||(g=!0,a.call(this,new dr(d,this,x.originalEvent,{features:T}))):g=!1},mouseout:()=>{g=!1}}}}if(d==="mouseleave"||d==="mouseout"){let g=!1;return{listener:a,targets:n,delegates:{mousemove:T=>{h(T.point).length?g=!0:g&&(g=!1,a.call(this,new dr(d,this,T.originalEvent)))},mouseout:T=>{g&&(g=!1,a.call(this,new dr(d,this,T.originalEvent)))}}}}{const g=y=>{const x=h(y.point);x.length&&(y.features=x,a.call(this,y),delete y.features)};return{listener:a,targets:n,delegates:{[d]:g}}}}on(d,n,a){if(typeof n=="function"||a===void 0)return super.on(d,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const h=this._createDelegatedListener(d,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(h);for(const g in h.delegates)this.on(g,h.delegates[g]);return this}once(d,n,a){if(typeof n=="function"||a===void 0)return super.once(d,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const h=this._createDelegatedListener(d,n,a);for(const g in h.delegates)this.once(g,h.delegates[g]);return this}off(d,n,a){if(typeof n=="function"||a===void 0)return super.off(d,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const h=this._delegatedListeners?this._delegatedListeners[d]:void 0;return h&&(g=>{for(let y=0;y<g.length;y++){const x=g[y];if(x.listener===a&&Kw(x.targets,n)){for(const T in x.delegates)this.off(T,x.delegates[T]);return g.splice(y,1),this}}})(h),this}queryRenderedFeatures(d,n){if(!this.style)return[];if(d===void 0||d instanceof o.P||Array.isArray(d)||n!==void 0||(n=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],!n){const y=this.style.queryRenderedFeatures(d,void 0,this.transform),x=this.style.queryRenderedFeatureset(d,void 0,this.transform);return y.concat(x)}let a=!0;if(n.target&&(a=this._isTargetValid(n.target),a&&!n.layers))return this.style.queryRenderedFeatureset(d,n,this.transform);let h=!0;if(n.layers&&Array.isArray(n.layers)){for(const y of n.layers)if(!this._isValidId(y)){h=!1;break}if(h&&!n.target)return this.style.queryRenderedFeatures(d,n,this.transform)}let g=[];return h&&(g=g.concat(this.style.queryRenderedFeatures(d,n,this.transform))),a&&(g=g.concat(this.style.queryRenderedFeatureset(d,n,this.transform))),g}querySourceFeatures(d,n){return!d||typeof d=="string"&&!this._isValidId(d)?[]:this.style.querySourceFeatures(d,n)}queryRasterValue(d,n,a){return this._isValidId(d)?this.style.queryRasterValue(d,n,a):Promise.resolve(null)}isPointOnSurface(d){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&o.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(d))}addInteraction(d,n){return this._interactions.add(d,n),this}removeInteraction(d){return this._interactions.remove(d),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this}setStyle(d,n){return n=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&d&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(d,(a,h)=>{if(a){const g=typeof a=="string"?a:a instanceof Error?a.message:a.error;o.w(`Unable to perform style diff: ${g}. Rebuilding the style from scratch.`),this._updateStyle(d,n)}else h&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(d,n))}_getUIString(d){const n=this._locale[d];if(n==null)throw new Error(`Missing UI string '${d}'`);return n}_updateStyle(d,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const a=Object.assign({},n);n&&n.config&&(a.initialConfig=n.config,delete a.config),this.style=new Ao(this,a).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ao(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new o.y(new Error("IDs can't be empty."))),!1):!o.dm(d)||(this.fire(new o.y(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}_isTargetValid(d){return"featuresetId"in d?this._isValidId("importId"in d?d.importId:d.featuresetId):"layerId"in d&&this._isValidId(d.layerId)}_areTargetsValid(d){if(Array.isArray(d)){for(const n of d)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(d)}addSource(d,n){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,n),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(d,n,a)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,n,{pixelRatio:a=1,sdf:h=!1,stretchX:g,stretchY:y,content:x}={}){this._lazyInitEmptyStyle();const T=o.I.from(d);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:I,height:P,data:R}=o.o.getImageData(n);this.style.addImage(T,{data:new o.q({width:I,height:P},R),pixelRatio:a,stretchX:g,stretchY:y,content:x,sdf:h,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new o.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:P}=n,R=n;this.style.addImage(T,{data:new o.q({width:I,height:P},new Uint8Array(R.data)),pixelRatio:a,stretchX:g,stretchY:y,content:x,sdf:h,usvg:!1,version:0,userImage:R}),R.onAdd&&R.onAdd(this,d)}}updateImage(d,n){this._lazyInitEmptyStyle();const a=o.I.from(d),h=this.style.getImage(a);if(!h)return void this.fire(new o.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?o.o.getImageData(n):n,{width:y,height:x,data:T}=g;if(y===void 0||x===void 0)return void this.fire(new o.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(h.usvg?h.icon.usvg_tree.width:h.data.width)||x!==(h.usvg?h.icon.usvg_tree.height:h.data.height))return void this.fire(new o.y(new Error(`The width and height of the updated image (${y}, ${x})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));const I=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let P=!1;h.usvg?(h.data=new o.q({width:y,height:x},new Uint8Array(T)),h.usvg=!1,h.icon=void 0,P=!0):h.data.replace(T,I),this.style.updateImage(a,h,P)}hasImage(d){return d?!!this.style&&!!this.style.getImage(o.I.from(d)):(this.fire(new o.y(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(o.I.from(d))}loadImage(d,n){o.n(this._requestManager.transformRequest(d,o.R.Image),(a,h)=>{n(a,h instanceof HTMLImageElement?o.o.getImageData(h):h)})}listImages(){return this.style.listImages().map(d=>d.name)}addModel(d,n){this._lazyInitEmptyStyle(),this.style.addModel(d,n)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new o.y(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,n){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,n),this._update(!0)):this}getSlot(d){const n=this.getLayer(d);return n&&n.slot||null}setSlot(d,n){return this.style.setSlot(d,n),this.style.mergeLayers(),this._update(!0)}addImport(d,n){return this.style.addImport(d,n).catch(a=>this.fire(new o.y(new Error("Failed to add import",a)))),this}updateImport(d,n){return typeof n!="string"&&n.id!==d?(this.removeImport(d),this.addImport(n)):(this.style.updateImport(d,n),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,n){return this.style.moveImport(d,n),this._update(!0)}moveLayer(d,n){return this._isValidId(d)?(this.style.moveLayer(d,n),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const n=this.style.getOwnLayer(d);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,n,a){return this._isValidId(d)?(this.style.setLayerZoomRange(d,n,a),this._update(!0)):this}setFilter(d,n,a={}){return this._isValidId(d)?(this.style.setFilter(d,n,a),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,n,a,h={}){return this._isValidId(d)?(this.style.setPaintProperty(d,n,a,h),this._update(!0)):this}getPaintProperty(d,n){return this._isValidId(d)?this.style.getPaintProperty(d,n):null}setLayoutProperty(d,n,a,h={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,n,a,h),this._update(!0)):this}getLayoutProperty(d,n){return this._isValidId(d)?this.style.getLayoutProperty(d,n):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(d){return this.style.setGlyphsUrl(d),this._update(!0)}getSchema(d){return this.style.getSchema(d)}setSchema(d,n){return this.style.setSchema(d,n),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,n){return this.style.setConfig(d,n),this._update(!0)}getConfigProperty(d,n){return this.style.getConfigProperty(d,n)}setConfigProperty(d,n,a){return this.style.setConfigProperty(d,n,a),this._update(!0)}getFeaturesetDescriptors(d){return this.style.getFeaturesetDescriptors(d)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const n=d[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(d){return this._lazyInitEmptyStyle(),this.style.setSnow(d),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(d){return this._lazyInitEmptyStyle(),this.style.setRain(d),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setImportColorTheme(d,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(d,n),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aR.convert(d),this.transform):0}setFeatureState(d,n){return d.source&&!this._isValidId(d.source)?this:(this.style.setFeatureState(d,n),this._update())}removeFeatureState(d,n){return d.source&&!this._isValidId(d.source)?this:(this.style.removeFeatureState(d,n),this._update())}getFeatureState(d){return d.source&&!this._isValidId(d.source)?null:this.style.getFeatureState(d)}_selectIndoorFloor(d){this.indoor.selectFloor(d)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Kh),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,h,g,y=this._container;for(;y&&(!h||!g);){const x=window.getComputedStyle(y).transform;x&&x!=="none"&&(a=x.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(h=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(g=a[3])),y=y.parentElement}this._containerWidth=h?Math.abs(d/h):d,this._containerHeight=g?Math.abs(n/g):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=K("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=K("div","mapboxgl-canvas-container",d);this._canvas=K("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=K("div","mapboxgl-control-container",d),h=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{h[g]=K("div",`mapboxgl-ctrl-${g}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,n){const a=o.o.devicePixelRatio||1;this._canvas.width=a*Math.ceil(d),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${n}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const n=this._markers.indexOf(d);n!==-1&&this._markers.splice(n,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const n=this._popups.indexOf(d);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const d=Object.assign({},ce.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",d);n?(Sn(n,!0),this.painter=new Rg(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.k.testSupport(n)):this.fire(new o.y(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.z("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.z("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let n;this.fire(new o.z("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,h=o.o.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=g.createQuery(),g.beginQuery(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,R=this.transform.pitch,F=o.o.now(),D=new o.ac(P,{now:F,fadeDuration:y,pitch:R,transition:this.style.transition,worldview:this._worldview});this.style.update(D)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(h),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(h);const T=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),T&&(this._placementDirty=T.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,N.mark(L.load),this.fire(new o.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const P=o.o.now()-h;g.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const R=g.getQueryParameter(n,g.QUERY_RESULT)/1e6;g.deleteQuery(n),this.fire(new o.z("gpu-timing-frame",{cpuTime:P,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(P);this.fire(new o.z("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(P);this.fire(new o.z("gpu-timing-deferred-render",{gpuTime:R}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(I||this._repaint)this.triggerRepaint();else{const P=this.idle();if(P&&(x=this._updateAverageElevation(h,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new o.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new o.z("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,N.mark(L.fullLoad),this._performanceMetricsCollection&&ci(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const n of this._markers)d&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!d||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(d,n=!1){const a=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(n||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const g=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=d;const x=Math.abs(g-y);if(x>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(y),a(y);this._averageElevation.easeTo(y,d,300)}else if(x>1e-4)return this._averageElevation.jumpTo(y),a(y)}return!!this._averageElevation.isEasing(d)&&a(this._averageElevation.getValue(d))}_authenticate(){ui(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===ln||d.status===401)){const n=this.painter.context.gl;Sn(n,!1),this._logoControl instanceof pa&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ir(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Vn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,h=a.createFramebuffer();function g(y){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,y,0);const x=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,x),x}return a.bindFramebuffer(a.FRAMEBUFFER,h),this._canvasPixelComparison(g(d),n.canvasCopies.map(g),n.timeStamps)}_canvasPixelComparison(d,n,a){let h=a[1]-a[0];const g=d.length/4;for(let y=0;y<n.length;y++){const x=n[y];let T=0;for(let I=0;I<x.length;I+=4)x[I]===d[I]&&x[I+1]===d[I+1]&&x[I+2]===d[I+2]&&x[I+3]===d[I+3]&&(T+=1);h+=(a[y+2]-a[y+1])*(1-T/g)}return h}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Bi.delete(this.painter.context.gl),rr.remove(),_r.remove(),this._removed=!0,this.fire(new o.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=o.o.frame(n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)}))}_preloadTiles(d){const n=this.style?this.style.getSourceCaches():[];return o.bw(n,(a,h)=>a._preloadTiles(d,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,n){o.eX(d,n)}get version(){return k}},NavigationControl:class{constructor(d={}){this.options=Object.assign({},Yw,d),this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(o.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),K("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),K("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))}),this._compassIcon=K("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const n=d.getZoom(),a=n===d.getMaxZoom(),h=n===d.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Jw(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,n){const a=K("button",d,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(d,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);d.setAttribute("aria-label",a),d.firstElementChild&&d.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends o.E{constructor(d={}){super();const n=navigator.geolocation;this.options=Object.assign({geolocation:n},El,d),o.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Hf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const n=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,d(a)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>n(a.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(d){const n=this._map.getMaxBounds(),a=d.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new o.z("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("geolocate",d)),this._finish()}}_updateCamera(d){const n=new o.aR(d.coords.longitude,d.coords.latitude),a=d.coords.accuracy,h=this._map.getBearing(),g=Object.assign({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),g,{geolocateSource:!0})}_updateMarker(d){if(d){const n=new o.aR(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,n=o.ce(1,d._center.lat)*d.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=K("button","mapboxgl-ctrl-geolocate",this._container),K("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K("div","mapboxgl-user-location"),this._dotElement.appendChild(K("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(K("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new xc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=K("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.z("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Xh,ScaleControl:class{constructor(d={}){this.options=Object.assign({},za,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,h=n._containerWidth/2-d/2,g=n.unproject([h,a]),y=n.unproject([h+d,a]),x=g.distanceTo(y);if(this.options.unit==="imperial"){const T=3.2808*x;T>5280?this._setScale(d,T/5280,"mile"):this._setScale(d,T,"foot")}else this.options.unit==="nautical"?this._setScale(d,x/1852,"nautical-mile"):x>=1e3?this._setScale(d,x/1e3,"kilometer"):this._setScale(d,x,"meter")}_setScale(d,n,a){this._map._requestDomTask(()=>{const h=function(y){const x=Math.pow(10,`${Math.floor(y)}`.length-1);let T=y/x;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(I){const P=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*P)/P}(T),x*T}(n),g=h/n;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(h):`${h}&nbsp;${Oa[a]}`,this._container.style.width=d*g+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:o.w("Full screen control 'container' must be a DOM element.")),o.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=K("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=K("button","mapboxgl-ctrl-fullscreen",this._controlContainer);K("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Kh,Popup:class extends o.E{constructor(d){super(),this.options=Object.assign(Object.create(wc),d),this._altitude=this.options.altitude,o.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new o.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new o.z("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=o.aR.convert(d),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(d){return this._altitude=d,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const n=document.createDocumentFragment(),a=document.createElement("body");let h;for(a.innerHTML=d;h=a.firstChild,h;)n.appendChild(h);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=K("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(d),this.options.closeButton){const a=this._closeButton=K("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let n;return this._classList.delete(d)?n=!1:(this._classList.add(d),n=!0),this._updateClassList(),n}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,h=this._pos;if(!n||!a||!h)return"bottom";const g=a.offsetWidth,y=a.offsetHeight,x=h.x<g/2,T=h.x>n.transform.width-g/2;if(h.y+d<y)return x?"top-left":T?"top-right":"top";if(h.y>n.transform.height-y){if(x)return"bottom-left";if(T)return"bottom-right"}return x?"left":T?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),d.className=n.join(" ")}_update(d){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let h=this._container;if(h||(h=this._container=K("div","mapboxgl-popup",n.getContainer()),this._tip=K("div","mapboxgl-popup-tip",h),h.appendChild(a)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=tp(this._lngLat,this._pos,n.transform)),!this._trackPointer||d){const g=this._pos=this._trackPointer&&d instanceof o.P?d:n.project(this._lngLat,this._altitude),y=ax(this.options.offset),x=this._anchor=this._getAnchor(y.y),T=ax(this.options.offset,x),I=g.add(T).round();n._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${ed[x]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&n._showingGlobe()){const g=o.eY(n.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Ho);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:xc,Style:Ao,LngLat:o.aR,LngLatBounds:o.aI,Point:o.P,MercatorCoordinate:o.ae,FreeCameraOptions:Wm,Evented:o.E,config:o.e,prewarm:o.f0,clearPrewarmedResources:o.e$,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(d){o.e.ACCESS_TOKEN=d},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(d){o.e.API_URL=d},get workerCount(){return o.f9.workerCount},set workerCount(d){o.f9.workerCount=d},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){o.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){o.f8(d)},get workerUrl(){return o.f7.workerUrl},set workerUrl(d){o.f7.workerUrl=d},get workerClass(){return o.f7.workerClass},set workerClass(d){o.f7.workerClass=d},get workerParams(){return o.f7.workerParams},set workerParams(d){o.f7.workerParams=d},get dracoUrl(){return o.f6()},set dracoUrl(d){o.f5(d)},get meshoptUrl(){return o.f4()},set meshoptUrl(d){o.f3(d)},setNow:o.o.setNow,restoreNow:o.o.restoreNow}});var E=_;return E})})(DN);var EX=DN.exports;const ud=O1(EX);function IX({userLocation:t,merchants:i,onMerchantSelect:c,className:f=""}){const _=fe.useRef(null),w=fe.useRef(null),[E,o]=fe.useState(!1);return fe.useEffect(()=>{if(!_.current||w.current)return;const k="pk.eyJ1IjoidGVjY3kiLCJhIjoiY21nY3Q0bHA2MDdwZzJrcHprNDh6Z3VpbiJ9.ZrxhwoOaFiIY49RfG-afAg";return ud.accessToken=k,w.current=new ud.Map({container:_.current,style:"mapbox://styles/mapbox/streets-v12",center:[t.lng,t.lat],zoom:13}),w.current.on("load",()=>{o(!0)}),w.current.addControl(new ud.NavigationControl,"top-right"),new ud.Marker({color:"#3b82f6"}).setLngLat([t.lng,t.lat]).setPopup(new ud.Popup().setHTML('<div class="p-2"><strong>Your Location</strong></div>')).addTo(w.current),()=>{var L;(L=w.current)==null||L.remove(),w.current=null}},[]),fe.useEffect(()=>{!w.current||!E||i.forEach(k=>{const L=gH(k.category),N=document.createElement("div");N.className="merchant-marker",N.style.backgroundColor=AX(k.category),N.style.width="30px",N.style.height="30px",N.style.borderRadius="50%",N.style.display="flex",N.style.alignItems="center",N.style.justifyContent="center",N.style.cursor="pointer",N.style.border="2px solid white",N.style.boxShadow="0 2px 4px rgba(0,0,0,0.2)",N.textContent=L,new ud.Marker(N).setLngLat([k.location.lng,k.location.lat]).setPopup(new ud.Popup({offset:25}).setHTML(`
            <div class="p-3">
              <strong class="text-base">${k.name}</strong>
              <p class="text-sm text-gray-600 mt-1">${k.category}</p>
              ${k.address?`<p class="text-xs text-gray-500 mt-1">${k.address}</p>`:""}
              ${k.estimatedSpend?`<p class="text-xs text-gray-700 mt-2">Est: $${k.estimatedSpend}</p>`:""}
            </div>
          `)).addTo(w.current),N.addEventListener("click",()=>{c&&c(k)})})},[i,E,c]),B.jsx("div",{ref:_,className:`w-full h-[300px] md:h-[400px] rounded-xl shadow-md ${f}`})}function AX(t){return{dining:"#ef4444",gas:"#f59e0b",groceries:"#10b981",travel:"#3b82f6",shopping:"#8b5cf6",entertainment:"#ec4899"}[t.toLowerCase()]||"#6b7280"}function CX(t){return Object.prototype.toString.call(t)==="[object Object]"}function sL(t){return CX(t)||Array.isArray(t)}function PX(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function VI(t,i){const c=Object.keys(t),f=Object.keys(i);if(c.length!==f.length)return!1;const _=JSON.stringify(Object.keys(t.breakpoints||{})),w=JSON.stringify(Object.keys(i.breakpoints||{}));return _!==w?!1:c.every(E=>{const o=t[E],k=i[E];return typeof o=="function"?`${o}`==`${k}`:!sL(o)||!sL(k)?o===k:VI(o,k)})}function oL(t){return t.concat().sort((i,c)=>i.name>c.name?1:-1).map(i=>i.options)}function MX(t,i){if(t.length!==i.length)return!1;const c=oL(t),f=oL(i);return c.every((_,w)=>{const E=f[w];return VI(_,E)})}function UI(t){return typeof t=="number"}function $2(t){return typeof t=="string"}function dw(t){return typeof t=="boolean"}function aL(t){return Object.prototype.toString.call(t)==="[object Object]"}function zr(t){return Math.abs(t)}function GI(t){return Math.sign(t)}function dy(t,i){return zr(t-i)}function RX(t,i){if(t===0||i===0||zr(t)<=zr(i))return 0;const c=dy(zr(t),zr(i));return zr(c/t)}function kX(t){return Math.round(t*100)/100}function Gy(t){return $y(t).map(Number)}function tl(t){return t[ov(t)]}function ov(t){return Math.max(0,t.length-1)}function $I(t,i){return i===ov(t)}function lL(t,i=0){return Array.from(Array(t),(c,f)=>i+f)}function $y(t){return Object.keys(t)}function zN(t,i){return[t,i].reduce((c,f)=>($y(f).forEach(_=>{const w=c[_],E=f[_],o=aL(w)&&aL(E);c[_]=o?zN(w,E):E}),c),{})}function H2(t,i){return typeof i.MouseEvent<"u"&&t instanceof i.MouseEvent}function DX(t,i){const c={start:f,center:_,end:w};function f(){return 0}function _(k){return w(k)/2}function w(k){return i-k}function E(k,L){return $2(t)?c[t](k):t(i,k,L)}return{measure:E}}function Hy(){let t=[];function i(_,w,E,o={passive:!0}){let k;if("addEventListener"in _)_.addEventListener(w,E,o),k=()=>_.removeEventListener(w,E,o);else{const L=_;L.addListener(E),k=()=>L.removeListener(E)}return t.push(k),f}function c(){t=t.filter(_=>_())}const f={add:i,clear:c};return f}function LX(t,i,c,f){const _=Hy(),w=1e3/60;let E=null,o=0,k=0;function L(){_.add(t,"visibilitychange",()=>{t.hidden&&ce()})}function N(){ne(),_.clear()}function V(se){if(!k)return;E||(E=se,c(),c());const Y=se-E;for(E=se,o+=Y;o>=w;)c(),o-=w;const Q=o/w;f(Q),k&&(k=i.requestAnimationFrame(V))}function H(){k||(k=i.requestAnimationFrame(V))}function ne(){i.cancelAnimationFrame(k),E=null,o=0,k=0}function ce(){E=null,o=0}return{init:L,destroy:N,start:H,stop:ne,update:c,render:f}}function zX(t,i){const c=i==="rtl",f=t==="y",_=f?"y":"x",w=f?"x":"y",E=!f&&c?-1:1,o=N(),k=V();function L(ce){const{height:K,width:se}=ce;return f?K:se}function N(){return f?"top":c?"right":"left"}function V(){return f?"bottom":c?"left":"right"}function H(ce){return ce*E}return{scroll:_,cross:w,startEdge:o,endEdge:k,measureSize:L,direction:H}}function Bd(t=0,i=0){const c=zr(t-i);function f(L){return L<t}function _(L){return L>i}function w(L){return f(L)||_(L)}function E(L){return w(L)?f(L)?t:i:L}function o(L){return c?L-c*Math.ceil((L-i)/c):L}return{length:c,max:i,min:t,constrain:E,reachedAny:w,reachedMax:_,reachedMin:f,removeOffset:o}}function ON(t,i,c){const{constrain:f}=Bd(0,t),_=t+1;let w=E(i);function E(H){return c?zr((_+H)%_):f(H)}function o(){return w}function k(H){return w=E(H),V}function L(H){return N().set(o()+H)}function N(){return ON(t,o(),c)}const V={get:o,set:k,add:L,clone:N};return V}function OX(t,i,c,f,_,w,E,o,k,L,N,V,H,ne,ce,K,se,Y,Q){const{cross:ae,direction:Te}=t,Be=["INPUT","SELECT","TEXTAREA"],et={passive:!1},nt=Hy(),Je=Hy(),Dt=Bd(50,225).constrain(ne.measure(20)),wt={mouse:300,touch:400},xt={mouse:500,touch:600},qt=ce?43:25;let ln=!1,Ht=0,cn=0,pn=!1,Rn=!1,Nt=!1,sn=!1;function Tn(Sn){if(!Q)return;function ji(ii){(dw(Q)||Q(Sn,ii))&&Vn(ii)}const Li=i;nt.add(Li,"dragstart",ii=>ii.preventDefault(),et).add(Li,"touchmove",()=>{},et).add(Li,"touchend",()=>{}).add(Li,"touchstart",ji).add(Li,"mousedown",ji).add(Li,"touchcancel",ci).add(Li,"contextmenu",ci).add(Li,"click",rr,!0)}function on(){nt.clear(),Je.clear()}function Xn(){const Sn=sn?c:i;Je.add(Sn,"touchmove",Wn,et).add(Sn,"touchend",ci).add(Sn,"mousemove",Wn,et).add(Sn,"mouseup",ci)}function _r(Sn){const ji=Sn.nodeName||"";return Be.includes(ji)}function ir(){return(ce?xt:wt)[sn?"mouse":"touch"]}function Qr(Sn,ji){const Li=V.add(GI(Sn)*-1),ii=N.byDistance(Sn,!ce).distance;return ce||zr(Sn)<Dt?ii:se&&ji?ii*.5:N.byIndex(Li.get(),0).distance}function Vn(Sn){const ji=H2(Sn,f);sn=ji,Nt=ce&&ji&&!Sn.buttons&&ln,ln=dy(_.get(),E.get())>=2,!(ji&&Sn.button!==0)&&(_r(Sn.target)||(pn=!0,w.pointerDown(Sn),L.useFriction(0).useDuration(0),_.set(E),Xn(),Ht=w.readPoint(Sn),cn=w.readPoint(Sn,ae),H.emit("pointerDown")))}function Wn(Sn){if(!H2(Sn,f)&&Sn.touches.length>=2)return ci(Sn);const Li=w.readPoint(Sn),ii=w.readPoint(Sn,ae),fs=dy(Li,Ht),es=dy(ii,cn);if(!Rn&&!sn&&(!Sn.cancelable||(Rn=fs>es,!Rn)))return ci(Sn);const Qs=w.pointerMove(Sn);fs>K&&(Nt=!0),L.useFriction(.3).useDuration(.75),o.start(),_.add(Te(Qs)),Sn.preventDefault()}function ci(Sn){const Li=N.byDistance(0,!1).index!==V.get(),ii=w.pointerUp(Sn)*ir(),fs=Qr(Te(ii),Li),es=RX(ii,fs),Qs=qt-10*es,lr=Y+es/50;Rn=!1,pn=!1,Je.clear(),L.useDuration(Qs).useFriction(lr),k.distance(fs,!ce),sn=!1,H.emit("pointerUp")}function rr(Sn){Nt&&(Sn.stopPropagation(),Sn.preventDefault(),Nt=!1)}function ui(){return pn}return{init:Tn,destroy:on,pointerDown:ui}}function FX(t,i){let f,_;function w(V){return V.timeStamp}function E(V,H){const ce=`client${(H||t.scroll)==="x"?"X":"Y"}`;return(H2(V,i)?V:V.touches[0])[ce]}function o(V){return f=V,_=V,E(V)}function k(V){const H=E(V)-E(_),ne=w(V)-w(f)>170;return _=V,ne&&(f=V),H}function L(V){if(!f||!_)return 0;const H=E(_)-E(f),ne=w(V)-w(f),ce=w(V)-w(_)>170,K=H/ne;return ne&&!ce&&zr(K)>.1?K:0}return{pointerDown:o,pointerMove:k,pointerUp:L,readPoint:E}}function NX(){function t(c){const{offsetTop:f,offsetLeft:_,offsetWidth:w,offsetHeight:E}=c;return{top:f,right:_+w,bottom:f+E,left:_,width:w,height:E}}return{measure:t}}function BX(t){function i(f){return t*(f/100)}return{measure:i}}function jX(t,i,c,f,_,w,E){const o=[t].concat(f);let k,L,N=[],V=!1;function H(se){return _.measureSize(E.measure(se))}function ne(se){if(!w)return;L=H(t),N=f.map(H);function Y(Q){for(const ae of Q){if(V)return;const Te=ae.target===t,Be=f.indexOf(ae.target),et=Te?L:N[Be],nt=H(Te?t:f[Be]);if(zr(nt-et)>=.5){se.reInit(),i.emit("resize");break}}}k=new ResizeObserver(Q=>{(dw(w)||w(se,Q))&&Y(Q)}),c.requestAnimationFrame(()=>{o.forEach(Q=>k.observe(Q))})}function ce(){V=!0,k&&k.disconnect()}return{init:ne,destroy:ce}}function VX(t,i,c,f,_,w){let E=0,o=0,k=_,L=w,N=t.get(),V=0;function H(){const et=f.get()-t.get(),nt=!k;let Je=0;return nt?(E=0,c.set(f),t.set(f),Je=et):(c.set(t),E+=et/k,E*=L,N+=E,t.add(E),Je=N-V),o=GI(Je),V=N,Be}function ne(){const et=f.get()-i.get();return zr(et)<.001}function ce(){return k}function K(){return o}function se(){return E}function Y(){return ae(_)}function Q(){return Te(w)}function ae(et){return k=et,Be}function Te(et){return L=et,Be}const Be={direction:K,duration:ce,velocity:se,seek:H,settled:ne,useBaseFriction:Q,useBaseDuration:Y,useFriction:Te,useDuration:ae};return Be}function UX(t,i,c,f,_){const w=_.measure(10),E=_.measure(50),o=Bd(.1,.99);let k=!1;function L(){return!(k||!t.reachedAny(c.get())||!t.reachedAny(i.get()))}function N(ne){if(!L())return;const ce=t.reachedMin(i.get())?"min":"max",K=zr(t[ce]-i.get()),se=c.get()-i.get(),Y=o.constrain(K/E);c.subtract(se*Y),!ne&&zr(se)<w&&(c.set(t.constrain(c.get())),f.useDuration(25).useBaseFriction())}function V(ne){k=!ne}return{shouldConstrain:L,constrain:N,toggleActive:V}}function GX(t,i,c,f,_){const w=Bd(-i+t,0),E=V(),o=N(),k=H();function L(ce,K){return dy(ce,K)<=1}function N(){const ce=E[0],K=tl(E),se=E.lastIndexOf(ce),Y=E.indexOf(K)+1;return Bd(se,Y)}function V(){return c.map((ce,K)=>{const{min:se,max:Y}=w,Q=w.constrain(ce),ae=!K,Te=$I(c,K);return ae?Y:Te||L(se,Q)?se:L(Y,Q)?Y:Q}).map(ce=>parseFloat(ce.toFixed(3)))}function H(){if(i<=t+_)return[w.max];if(f==="keepSnaps")return E;const{min:ce,max:K}=o;return E.slice(ce,K)}return{snapsContained:k,scrollContainLimit:o}}function $X(t,i,c){const f=i[0],_=c?f-t:tl(i);return{limit:Bd(_,f)}}function HX(t,i,c,f){const w=i.min+.1,E=i.max+.1,{reachedMin:o,reachedMax:k}=Bd(w,E);function L(H){return H===1?k(c.get()):H===-1?o(c.get()):!1}function N(H){if(!L(H))return;const ne=t*(H*-1);f.forEach(ce=>ce.add(ne))}return{loop:N}}function WX(t){const{max:i,length:c}=t;function f(w){const E=w-i;return c?E/-c:0}return{get:f}}function qX(t,i,c,f,_){const{startEdge:w,endEdge:E}=t,{groupSlides:o}=_,k=V().map(i.measure),L=H(),N=ne();function V(){return o(f).map(K=>tl(K)[E]-K[0][w]).map(zr)}function H(){return f.map(K=>c[w]-K[w]).map(K=>-zr(K))}function ne(){return o(L).map(K=>K[0]).map((K,se)=>K+k[se])}return{snaps:L,snapsAligned:N}}function ZX(t,i,c,f,_,w){const{groupSlides:E}=_,{min:o,max:k}=f,L=N();function N(){const H=E(w),ne=!t||i==="keepSnaps";return c.length===1?[w]:ne?H:H.slice(o,k).map((ce,K,se)=>{const Y=!K,Q=$I(se,K);if(Y){const ae=tl(se[0])+1;return lL(ae)}if(Q){const ae=ov(w)-tl(se)[0]+1;return lL(ae,tl(se)[0])}return ce})}return{slideRegistry:L}}function XX(t,i,c,f,_){const{reachedAny:w,removeOffset:E,constrain:o}=f;function k(ce){return ce.concat().sort((K,se)=>zr(K)-zr(se))[0]}function L(ce){const K=t?E(ce):o(ce),se=i.map((Q,ae)=>({diff:N(Q-K,0),index:ae})).sort((Q,ae)=>zr(Q.diff)-zr(ae.diff)),{index:Y}=se[0];return{index:Y,distance:K}}function N(ce,K){const se=[ce,ce+c,ce-c];if(!t)return ce;if(!K)return k(se);const Y=se.filter(Q=>GI(Q)===K);return Y.length?k(Y):tl(se)-c}function V(ce,K){const se=i[ce]-_.get(),Y=N(se,K);return{index:ce,distance:Y}}function H(ce,K){const se=_.get()+ce,{index:Y,distance:Q}=L(se),ae=!t&&w(se);if(!K||ae)return{index:Y,distance:ce};const Te=i[Y]-Q,Be=ce+N(Te,0);return{index:Y,distance:Be}}return{byDistance:H,byIndex:V,shortcut:N}}function KX(t,i,c,f,_,w,E){function o(V){const H=V.distance,ne=V.index!==i.get();w.add(H),H&&(f.duration()?t.start():(t.update(),t.render(1),t.update())),ne&&(c.set(i.get()),i.set(V.index),E.emit("select"))}function k(V,H){const ne=_.byDistance(V,H);o(ne)}function L(V,H){const ne=i.clone().set(V),ce=_.byIndex(ne.get(),H);o(ce)}return{distance:k,index:L}}function YX(t,i,c,f,_,w,E,o){const k={passive:!0,capture:!0};let L=0;function N(ne){if(!o)return;function ce(K){if(new Date().getTime()-L>10)return;E.emit("slideFocusStart"),t.scrollLeft=0;const Q=c.findIndex(ae=>ae.includes(K));UI(Q)&&(_.useDuration(0),f.index(Q,0),E.emit("slideFocus"))}w.add(document,"keydown",V,!1),i.forEach((K,se)=>{w.add(K,"focus",Y=>{(dw(o)||o(ne,Y))&&ce(se)},k)})}function V(ne){ne.code==="Tab"&&(L=new Date().getTime())}return{init:N}}function Z_(t){let i=t;function c(){return i}function f(k){i=E(k)}function _(k){i+=E(k)}function w(k){i-=E(k)}function E(k){return UI(k)?k:k.get()}return{get:c,set:f,add:_,subtract:w}}function FN(t,i){const c=t.scroll==="x"?E:o,f=i.style;let _=null,w=!1;function E(H){return`translate3d(${H}px,0px,0px)`}function o(H){return`translate3d(0px,${H}px,0px)`}function k(H){if(w)return;const ne=kX(t.direction(H));ne!==_&&(f.transform=c(ne),_=ne)}function L(H){w=!H}function N(){w||(f.transform="",i.getAttribute("style")||i.removeAttribute("style"))}return{clear:N,to:k,toggleActive:L}}function JX(t,i,c,f,_,w,E,o,k){const N=Gy(_),V=Gy(_).reverse(),H=Y().concat(Q());function ne(nt,Je){return nt.reduce((Dt,wt)=>Dt-_[wt],Je)}function ce(nt,Je){return nt.reduce((Dt,wt)=>ne(Dt,Je)>0?Dt.concat([wt]):Dt,[])}function K(nt){return w.map((Je,Dt)=>({start:Je-f[Dt]+.5+nt,end:Je+i-.5+nt}))}function se(nt,Je,Dt){const wt=K(Je);return nt.map(xt=>{const qt=Dt?0:-c,ln=Dt?c:0,Ht=Dt?"end":"start",cn=wt[xt][Ht];return{index:xt,loopPoint:cn,slideLocation:Z_(-1),translate:FN(t,k[xt]),target:()=>o.get()>cn?qt:ln}})}function Y(){const nt=E[0],Je=ce(V,nt);return se(Je,c,!1)}function Q(){const nt=i-E[0]-1,Je=ce(N,nt);return se(Je,-c,!0)}function ae(){return H.every(({index:nt})=>{const Je=N.filter(Dt=>Dt!==nt);return ne(Je,i)<=.1})}function Te(){H.forEach(nt=>{const{target:Je,translate:Dt,slideLocation:wt}=nt,xt=Je();xt!==wt.get()&&(Dt.to(xt),wt.set(xt))})}function Be(){H.forEach(nt=>nt.translate.clear())}return{canLoop:ae,clear:Be,loop:Te,loopPoints:H}}function QX(t,i,c){let f,_=!1;function w(k){if(!c)return;function L(N){for(const V of N)if(V.type==="childList"){k.reInit(),i.emit("slidesChanged");break}}f=new MutationObserver(N=>{_||(dw(c)||c(k,N))&&L(N)}),f.observe(t,{childList:!0})}function E(){f&&f.disconnect(),_=!0}return{init:w,destroy:E}}function eK(t,i,c,f){const _={};let w=null,E=null,o,k=!1;function L(){o=new IntersectionObserver(ce=>{k||(ce.forEach(K=>{const se=i.indexOf(K.target);_[se]=K}),w=null,E=null,c.emit("slidesInView"))},{root:t.parentElement,threshold:f}),i.forEach(ce=>o.observe(ce))}function N(){o&&o.disconnect(),k=!0}function V(ce){return $y(_).reduce((K,se)=>{const Y=parseInt(se),{isIntersecting:Q}=_[Y];return(ce&&Q||!ce&&!Q)&&K.push(Y),K},[])}function H(ce=!0){if(ce&&w)return w;if(!ce&&E)return E;const K=V(ce);return ce&&(w=K),ce||(E=K),K}return{init:L,destroy:N,get:H}}function tK(t,i,c,f,_,w){const{measureSize:E,startEdge:o,endEdge:k}=t,L=c[0]&&_,N=ce(),V=K(),H=c.map(E),ne=se();function ce(){if(!L)return 0;const Q=c[0];return zr(i[o]-Q[o])}function K(){if(!L)return 0;const Q=w.getComputedStyle(tl(f));return parseFloat(Q.getPropertyValue(`margin-${k}`))}function se(){return c.map((Q,ae,Te)=>{const Be=!ae,et=$I(Te,ae);return Be?H[ae]+N:et?H[ae]+V:Te[ae+1][o]-Q[o]}).map(zr)}return{slideSizes:H,slideSizesWithGaps:ne,startGap:N,endGap:V}}function nK(t,i,c,f,_,w,E,o,k){const{startEdge:L,endEdge:N,direction:V}=t,H=UI(c);function ne(Y,Q){return Gy(Y).filter(ae=>ae%Q===0).map(ae=>Y.slice(ae,ae+Q))}function ce(Y){return Y.length?Gy(Y).reduce((Q,ae,Te)=>{const Be=tl(Q)||0,et=Be===0,nt=ae===ov(Y),Je=_[L]-w[Be][L],Dt=_[L]-w[ae][N],wt=!f&&et?V(E):0,xt=!f&&nt?V(o):0,qt=zr(Dt-xt-(Je+wt));return Te&&qt>i+k&&Q.push(ae),nt&&Q.push(Y.length),Q},[]).map((Q,ae,Te)=>{const Be=Math.max(Te[ae-1]||0);return Y.slice(Be,Q)}):[]}function K(Y){return H?ne(Y,c):ce(Y)}return{groupSlides:K}}function iK(t,i,c,f,_,w,E){const{align:o,axis:k,direction:L,startIndex:N,loop:V,duration:H,dragFree:ne,dragThreshold:ce,inViewThreshold:K,slidesToScroll:se,skipSnaps:Y,containScroll:Q,watchResize:ae,watchSlides:Te,watchDrag:Be,watchFocus:et}=w,nt=2,Je=NX(),Dt=Je.measure(i),wt=c.map(Je.measure),xt=zX(k,L),qt=xt.measureSize(Dt),ln=BX(qt),Ht=DX(o,qt),cn=!V&&!!Q,pn=V||!!Q,{slideSizes:Rn,slideSizesWithGaps:Nt,startGap:sn,endGap:Tn}=tK(xt,Dt,wt,c,pn,_),on=nK(xt,qt,se,V,Dt,wt,sn,Tn,nt),{snaps:Xn,snapsAligned:_r}=qX(xt,Ht,Dt,wt,on),ir=-tl(Xn)+tl(Nt),{snapsContained:Qr,scrollContainLimit:Vn}=GX(qt,ir,_r,Q,nt),Wn=cn?Qr:_r,{limit:ci}=$X(ir,Wn,V),rr=ON(ov(Wn),N,V),ui=rr.clone(),Bi=Gy(c),Sn=({dragHandler:io,scrollBody:yr,scrollBounds:Cs,options:{loop:oa}})=>{oa||Cs.constrain(io.pointerDown()),yr.seek()},ji=({scrollBody:io,translate:yr,location:Cs,offsetLocation:oa,previousLocation:aa,scrollLooper:Io,slideLooper:zo,dragHandler:Pa,animation:Ri,eventHandler:vr,scrollBounds:Zl,options:{loop:la}},Ns)=>{const rl=io.settled(),Xl=!Zl.shouldConstrain(),Kl=la?rl:rl&&Xl,ct=Kl&&!Pa.pointerDown();ct&&Ri.stop();const Oo=Cs.get()*Ns+aa.get()*(1-Ns);oa.set(Oo),la&&(Io.loop(io.direction()),zo.loop()),yr.to(oa.get()),ct&&vr.emit("settle"),Kl||vr.emit("scroll")},Li=LX(f,_,()=>Sn(no),io=>ji(no,io)),ii=.68,fs=Wn[rr.get()],es=Z_(fs),Qs=Z_(fs),lr=Z_(fs),ps=Z_(fs),Nr=VX(es,lr,Qs,ps,H,ii),eo=XX(V,Wn,ir,ci,ps),to=KX(Li,rr,ui,Nr,eo,ps,E),ra=WX(ci),sa=Hy(),os=eK(i,c,E,K),{slideRegistry:ms}=ZX(cn,Q,Wn,Vn,on,Bi),ql=YX(t,c,ms,to,Nr,sa,E,et),no={ownerDocument:f,ownerWindow:_,eventHandler:E,containerRect:Dt,slideRects:wt,animation:Li,axis:xt,dragHandler:OX(xt,t,f,_,ps,FX(xt,_),es,Li,to,Nr,eo,rr,E,ln,ne,ce,Y,ii,Be),eventStore:sa,percentOfView:ln,index:rr,indexPrevious:ui,limit:ci,location:es,offsetLocation:lr,previousLocation:Qs,options:w,resizeHandler:jX(i,E,_,c,xt,ae,Je),scrollBody:Nr,scrollBounds:UX(ci,lr,ps,Nr,ln),scrollLooper:HX(ir,ci,lr,[es,lr,Qs,ps]),scrollProgress:ra,scrollSnapList:Wn.map(ra.get),scrollSnaps:Wn,scrollTarget:eo,scrollTo:to,slideLooper:JX(xt,qt,ir,Rn,Nt,Xn,Wn,lr,c),slideFocus:ql,slidesHandler:QX(i,E,Te),slidesInView:os,slideIndexes:Bi,slideRegistry:ms,slidesToScroll:on,target:ps,translate:FN(xt,i)};return no}function rK(){let t={},i;function c(L){i=L}function f(L){return t[L]||[]}function _(L){return f(L).forEach(N=>N(i,L)),k}function w(L,N){return t[L]=f(L).concat([N]),k}function E(L,N){return t[L]=f(L).filter(V=>V!==N),k}function o(){t={}}const k={init:c,emit:_,off:E,on:w,clear:o};return k}const sK={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function oK(t){function i(w,E){return zN(w,E||{})}function c(w){const E=w.breakpoints||{},o=$y(E).filter(k=>t.matchMedia(k).matches).map(k=>E[k]).reduce((k,L)=>i(k,L),{});return i(w,o)}function f(w){return w.map(E=>$y(E.breakpoints||{})).reduce((E,o)=>E.concat(o),[]).map(t.matchMedia)}return{mergeOptions:i,optionsAtMedia:c,optionsMediaQueries:f}}function aK(t){let i=[];function c(w,E){return i=E.filter(({options:o})=>t.optionsAtMedia(o).active!==!1),i.forEach(o=>o.init(w,t)),E.reduce((o,k)=>Object.assign(o,{[k.name]:k}),{})}function f(){i=i.filter(w=>w.destroy())}return{init:c,destroy:f}}function D1(t,i,c){const f=t.ownerDocument,_=f.defaultView,w=oK(_),E=aK(w),o=Hy(),k=rK(),{mergeOptions:L,optionsAtMedia:N,optionsMediaQueries:V}=w,{on:H,off:ne,emit:ce}=k,K=xt;let se=!1,Y,Q=L(sK,D1.globalOptions),ae=L(Q),Te=[],Be,et,nt;function Je(){const{container:Bi,slides:Sn}=ae;et=($2(Bi)?t.querySelector(Bi):Bi)||t.children[0];const Li=$2(Sn)?et.querySelectorAll(Sn):Sn;nt=[].slice.call(Li||et.children)}function Dt(Bi){const Sn=iK(t,et,nt,f,_,Bi,k);if(Bi.loop&&!Sn.slideLooper.canLoop()){const ji=Object.assign({},Bi,{loop:!1});return Dt(ji)}return Sn}function wt(Bi,Sn){se||(Q=L(Q,Bi),ae=N(Q),Te=Sn||Te,Je(),Y=Dt(ae),V([Q,...Te.map(({options:ji})=>ji)]).forEach(ji=>o.add(ji,"change",xt)),ae.active&&(Y.translate.to(Y.location.get()),Y.animation.init(),Y.slidesInView.init(),Y.slideFocus.init(ui),Y.eventHandler.init(ui),Y.resizeHandler.init(ui),Y.slidesHandler.init(ui),Y.options.loop&&Y.slideLooper.loop(),et.offsetParent&&nt.length&&Y.dragHandler.init(ui),Be=E.init(ui,Te)))}function xt(Bi,Sn){const ji=on();qt(),wt(L({startIndex:ji},Bi),Sn),k.emit("reInit")}function qt(){Y.dragHandler.destroy(),Y.eventStore.clear(),Y.translate.clear(),Y.slideLooper.clear(),Y.resizeHandler.destroy(),Y.slidesHandler.destroy(),Y.slidesInView.destroy(),Y.animation.destroy(),E.destroy(),o.clear()}function ln(){se||(se=!0,o.clear(),qt(),k.emit("destroy"),k.clear())}function Ht(Bi,Sn,ji){!ae.active||se||(Y.scrollBody.useBaseFriction().useDuration(Sn===!0?0:ae.duration),Y.scrollTo.index(Bi,ji||0))}function cn(Bi){const Sn=Y.index.add(1).get();Ht(Sn,Bi,-1)}function pn(Bi){const Sn=Y.index.add(-1).get();Ht(Sn,Bi,1)}function Rn(){return Y.index.add(1).get()!==on()}function Nt(){return Y.index.add(-1).get()!==on()}function sn(){return Y.scrollSnapList}function Tn(){return Y.scrollProgress.get(Y.offsetLocation.get())}function on(){return Y.index.get()}function Xn(){return Y.indexPrevious.get()}function _r(){return Y.slidesInView.get()}function ir(){return Y.slidesInView.get(!1)}function Qr(){return Be}function Vn(){return Y}function Wn(){return t}function ci(){return et}function rr(){return nt}const ui={canScrollNext:Rn,canScrollPrev:Nt,containerNode:ci,internalEngine:Vn,destroy:ln,off:ne,on:H,emit:ce,plugins:Qr,previousScrollSnap:Xn,reInit:K,rootNode:Wn,scrollNext:cn,scrollPrev:pn,scrollProgress:Tn,scrollSnapList:sn,scrollTo:Ht,selectedScrollSnap:on,slideNodes:rr,slidesInView:_r,slidesNotInView:ir};return wt(i,c),setTimeout(()=>k.emit("init"),0),ui}D1.globalOptions=void 0;function HI(t={},i=[]){const c=fe.useRef(t),f=fe.useRef(i),[_,w]=fe.useState(),[E,o]=fe.useState(),k=fe.useCallback(()=>{_&&_.reInit(c.current,f.current)},[_]);return fe.useEffect(()=>{VI(c.current,t)||(c.current=t,k())},[t,k]),fe.useEffect(()=>{MX(f.current,i)||(f.current=i,k())},[i,k]),fe.useEffect(()=>{if(PX()&&E){D1.globalOptions=HI.globalOptions;const L=D1(E,c.current,f.current);return w(L),()=>L.destroy()}else w(void 0)},[E,w]),[o,_]}HI.globalOptions=void 0;function lK({card:t,onClick:i}){return B.jsxs("div",{onClick:i,className:"w-[280px] h-[160px] bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl p-4 cursor-pointer hover:scale-105 transition-transform shadow-lg touch-target relative overflow-hidden",children:[B.jsxs("div",{className:"absolute inset-0 opacity-10",children:[B.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white rounded-full -translate-y-16 translate-x-16"}),B.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white rounded-full translate-y-12 -translate-x-12"})]}),B.jsxs("div",{className:"relative z-10 h-full flex flex-col justify-between text-white",children:[B.jsxs("div",{className:"flex justify-between items-start",children:[B.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center",children:B.jsx("span",{className:"text-2xl",children:""})}),t.annualFee===0&&B.jsx("span",{className:"text-xs bg-green-400 text-green-900 px-2 py-1 rounded-full font-semibold",children:"No Fee"})]}),B.jsxs("div",{children:[B.jsx("h3",{className:"font-bold text-lg mb-1 line-clamp-1",children:t.name}),B.jsx("p",{className:"text-sm opacity-90 mb-2 line-clamp-1",children:t.primaryBenefit}),B.jsxs("div",{className:"flex justify-between items-center text-xs",children:[B.jsx("span",{className:"opacity-80",children:t.issuer}),t.annualFee>0&&B.jsxs("span",{className:"font-semibold",children:[Fd(t.annualFee),"/year"]})]})]})]})]})}function cK({cards:t,onCardClick:i}){const[c,f]=HI({align:"start",dragFree:!0}),_=fe.useCallback(()=>{f&&f.scrollPrev()},[f]),w=fe.useCallback(()=>{f&&f.scrollNext()},[f]);return B.jsxs("div",{className:"relative",children:[B.jsx("div",{className:"embla overflow-hidden",ref:c,children:B.jsx("div",{className:"embla__container flex gap-4 py-2",children:t.map(E=>B.jsx("div",{className:"embla__slide flex-[0_0_280px]",children:B.jsx(lK,{card:E,onClick:()=>i(E)})},E.id))})}),B.jsx("button",{onClick:_,className:"absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 hidden md:flex items-center justify-center w-10 h-10 bg-white rounded-full shadow-lg hover:bg-gray-50 transition-colors","aria-label":"Previous cards",children:B.jsx(bH,{className:"w-6 h-6"})}),B.jsx("button",{onClick:w,className:"absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 hidden md:flex items-center justify-center w-10 h-10 bg-white rounded-full shadow-lg hover:bg-gray-50 transition-colors","aria-label":"Next cards",children:B.jsx(TH,{className:"w-6 h-6"})})]})}var uK=nE[" useId ".trim().toString()]||(()=>{}),hK=0;function cS(t){const[i,c]=fe.useState(uK());return Hl(()=>{c(f=>f??String(hK++))},[t]),t||(i?`radix-${i}`:"")}function Wl(t){const i=fe.useRef(t);return fe.useEffect(()=>{i.current=t}),fe.useMemo(()=>(...c)=>{var f;return(f=i.current)==null?void 0:f.call(i,...c)},[])}function dK(t,i=globalThis==null?void 0:globalThis.document){const c=Wl(t);fe.useEffect(()=>{const f=_=>{_.key==="Escape"&&c(_)};return i.addEventListener("keydown",f,{capture:!0}),()=>i.removeEventListener("keydown",f,{capture:!0})},[c,i])}var fK="DismissableLayer",W2="dismissableLayer.update",pK="dismissableLayer.pointerDownOutside",mK="dismissableLayer.focusOutside",cL,NN=fe.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),WI=fe.forwardRef((t,i)=>{const{disableOutsidePointerEvents:c=!1,onEscapeKeyDown:f,onPointerDownOutside:_,onFocusOutside:w,onInteractOutside:E,onDismiss:o,...k}=t,L=fe.useContext(NN),[N,V]=fe.useState(null),H=(N==null?void 0:N.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,ne]=fe.useState({}),ce=Fs(i,nt=>V(nt)),K=Array.from(L.layers),[se]=[...L.layersWithOutsidePointerEventsDisabled].slice(-1),Y=K.indexOf(se),Q=N?K.indexOf(N):-1,ae=L.layersWithOutsidePointerEventsDisabled.size>0,Te=Q>=Y,Be=_K(nt=>{const Je=nt.target,Dt=[...L.branches].some(wt=>wt.contains(Je));!Te||Dt||(_==null||_(nt),E==null||E(nt),nt.defaultPrevented||o==null||o())},H),et=yK(nt=>{const Je=nt.target;[...L.branches].some(wt=>wt.contains(Je))||(w==null||w(nt),E==null||E(nt),nt.defaultPrevented||o==null||o())},H);return dK(nt=>{Q===L.layers.size-1&&(f==null||f(nt),!nt.defaultPrevented&&o&&(nt.preventDefault(),o()))},H),fe.useEffect(()=>{if(N)return c&&(L.layersWithOutsidePointerEventsDisabled.size===0&&(cL=H.body.style.pointerEvents,H.body.style.pointerEvents="none"),L.layersWithOutsidePointerEventsDisabled.add(N)),L.layers.add(N),uL(),()=>{c&&L.layersWithOutsidePointerEventsDisabled.size===1&&(H.body.style.pointerEvents=cL)}},[N,H,c,L]),fe.useEffect(()=>()=>{N&&(L.layers.delete(N),L.layersWithOutsidePointerEventsDisabled.delete(N),uL())},[N,L]),fe.useEffect(()=>{const nt=()=>ne({});return document.addEventListener(W2,nt),()=>document.removeEventListener(W2,nt)},[]),B.jsx(ar.div,{...k,ref:ce,style:{pointerEvents:ae?Te?"auto":"none":void 0,...t.style},onFocusCapture:Rr(t.onFocusCapture,et.onFocusCapture),onBlurCapture:Rr(t.onBlurCapture,et.onBlurCapture),onPointerDownCapture:Rr(t.onPointerDownCapture,Be.onPointerDownCapture)})});WI.displayName=fK;var gK="DismissableLayerBranch",BN=fe.forwardRef((t,i)=>{const c=fe.useContext(NN),f=fe.useRef(null),_=Fs(i,f);return fe.useEffect(()=>{const w=f.current;if(w)return c.branches.add(w),()=>{c.branches.delete(w)}},[c.branches]),B.jsx(ar.div,{...t,ref:_})});BN.displayName=gK;function _K(t,i=globalThis==null?void 0:globalThis.document){const c=Wl(t),f=fe.useRef(!1),_=fe.useRef(()=>{});return fe.useEffect(()=>{const w=o=>{if(o.target&&!f.current){let k=function(){jN(pK,c,L,{discrete:!0})};const L={originalEvent:o};o.pointerType==="touch"?(i.removeEventListener("click",_.current),_.current=k,i.addEventListener("click",_.current,{once:!0})):k()}else i.removeEventListener("click",_.current);f.current=!1},E=window.setTimeout(()=>{i.addEventListener("pointerdown",w)},0);return()=>{window.clearTimeout(E),i.removeEventListener("pointerdown",w),i.removeEventListener("click",_.current)}},[i,c]),{onPointerDownCapture:()=>f.current=!0}}function yK(t,i=globalThis==null?void 0:globalThis.document){const c=Wl(t),f=fe.useRef(!1);return fe.useEffect(()=>{const _=w=>{w.target&&!f.current&&jN(mK,c,{originalEvent:w},{discrete:!1})};return i.addEventListener("focusin",_),()=>i.removeEventListener("focusin",_)},[i,c]),{onFocusCapture:()=>f.current=!0,onBlurCapture:()=>f.current=!1}}function uL(){const t=new CustomEvent(W2);document.dispatchEvent(t)}function jN(t,i,c,{discrete:f}){const _=c.originalEvent.target,w=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:c});i&&_.addEventListener(t,i,{once:!0}),f?mN(_,w):_.dispatchEvent(w)}var vK=WI,xK=BN,uS="focusScope.autoFocusOnMount",hS="focusScope.autoFocusOnUnmount",hL={bubbles:!1,cancelable:!0},wK="FocusScope",VN=fe.forwardRef((t,i)=>{const{loop:c=!1,trapped:f=!1,onMountAutoFocus:_,onUnmountAutoFocus:w,...E}=t,[o,k]=fe.useState(null),L=Wl(_),N=Wl(w),V=fe.useRef(null),H=Fs(i,K=>k(K)),ne=fe.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;fe.useEffect(()=>{if(f){let K=function(ae){if(ne.paused||!o)return;const Te=ae.target;o.contains(Te)?V.current=Te:Fu(V.current,{select:!0})},se=function(ae){if(ne.paused||!o)return;const Te=ae.relatedTarget;Te!==null&&(o.contains(Te)||Fu(V.current,{select:!0}))},Y=function(ae){if(document.activeElement===document.body)for(const Be of ae)Be.removedNodes.length>0&&Fu(o)};document.addEventListener("focusin",K),document.addEventListener("focusout",se);const Q=new MutationObserver(Y);return o&&Q.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",K),document.removeEventListener("focusout",se),Q.disconnect()}}},[f,o,ne.paused]),fe.useEffect(()=>{if(o){fL.add(ne);const K=document.activeElement;if(!o.contains(K)){const Y=new CustomEvent(uS,hL);o.addEventListener(uS,L),o.dispatchEvent(Y),Y.defaultPrevented||(bK(AK(UN(o)),{select:!0}),document.activeElement===K&&Fu(o))}return()=>{o.removeEventListener(uS,L),setTimeout(()=>{const Y=new CustomEvent(hS,hL);o.addEventListener(hS,N),o.dispatchEvent(Y),Y.defaultPrevented||Fu(K??document.body,{select:!0}),o.removeEventListener(hS,N),fL.remove(ne)},0)}}},[o,L,N,ne]);const ce=fe.useCallback(K=>{if(!c&&!f||ne.paused)return;const se=K.key==="Tab"&&!K.altKey&&!K.ctrlKey&&!K.metaKey,Y=document.activeElement;if(se&&Y){const Q=K.currentTarget,[ae,Te]=TK(Q);ae&&Te?!K.shiftKey&&Y===Te?(K.preventDefault(),c&&Fu(ae,{select:!0})):K.shiftKey&&Y===ae&&(K.preventDefault(),c&&Fu(Te,{select:!0})):Y===Q&&K.preventDefault()}},[c,f,ne.paused]);return B.jsx(ar.div,{tabIndex:-1,...E,ref:H,onKeyDown:ce})});VN.displayName=wK;function bK(t,{select:i=!1}={}){const c=document.activeElement;for(const f of t)if(Fu(f,{select:i}),document.activeElement!==c)return}function TK(t){const i=UN(t),c=dL(i,t),f=dL(i.reverse(),t);return[c,f]}function UN(t){const i=[],c=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:f=>{const _=f.tagName==="INPUT"&&f.type==="hidden";return f.disabled||f.hidden||_?NodeFilter.FILTER_SKIP:f.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;c.nextNode();)i.push(c.currentNode);return i}function dL(t,i){for(const c of t)if(!SK(c,{upTo:i}))return c}function SK(t,{upTo:i}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(i!==void 0&&t===i)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function EK(t){return t instanceof HTMLInputElement&&"select"in t}function Fu(t,{select:i=!1}={}){if(t&&t.focus){const c=document.activeElement;t.focus({preventScroll:!0}),t!==c&&EK(t)&&i&&t.select()}}var fL=IK();function IK(){let t=[];return{add(i){const c=t[0];i!==c&&(c==null||c.pause()),t=pL(t,i),t.unshift(i)},remove(i){var c;t=pL(t,i),(c=t[0])==null||c.resume()}}}function pL(t,i){const c=[...t],f=c.indexOf(i);return f!==-1&&c.splice(f,1),c}function AK(t){return t.filter(i=>i.tagName!=="A")}var CK="Portal",qI=fe.forwardRef((t,i)=>{var o;const{container:c,...f}=t,[_,w]=fe.useState(!1);Hl(()=>w(!0),[]);const E=c||_&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return E?m8.createPortal(B.jsx(ar.div,{...f,ref:i}),E):null});qI.displayName=CK;function PK(t,i){return fe.useReducer((c,f)=>i[c][f]??c,t)}var av=t=>{const{present:i,children:c}=t,f=MK(i),_=typeof c=="function"?c({present:f.isPresent}):fe.Children.only(c),w=Fs(f.ref,RK(_));return typeof c=="function"||f.isPresent?fe.cloneElement(_,{ref:w}):null};av.displayName="Presence";function MK(t){const[i,c]=fe.useState(),f=fe.useRef(null),_=fe.useRef(t),w=fe.useRef("none"),E=t?"mounted":"unmounted",[o,k]=PK(E,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return fe.useEffect(()=>{const L=S0(f.current);w.current=o==="mounted"?L:"none"},[o]),Hl(()=>{const L=f.current,N=_.current;if(N!==t){const H=w.current,ne=S0(L);t?k("MOUNT"):ne==="none"||(L==null?void 0:L.display)==="none"?k("UNMOUNT"):k(N&&H!==ne?"ANIMATION_OUT":"UNMOUNT"),_.current=t}},[t,k]),Hl(()=>{if(i){let L;const N=i.ownerDocument.defaultView??window,V=ne=>{const K=S0(f.current).includes(CSS.escape(ne.animationName));if(ne.target===i&&K&&(k("ANIMATION_END"),!_.current)){const se=i.style.animationFillMode;i.style.animationFillMode="forwards",L=N.setTimeout(()=>{i.style.animationFillMode==="forwards"&&(i.style.animationFillMode=se)})}},H=ne=>{ne.target===i&&(w.current=S0(f.current))};return i.addEventListener("animationstart",H),i.addEventListener("animationcancel",V),i.addEventListener("animationend",V),()=>{N.clearTimeout(L),i.removeEventListener("animationstart",H),i.removeEventListener("animationcancel",V),i.removeEventListener("animationend",V)}}else k("ANIMATION_END")},[i,k]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:fe.useCallback(L=>{f.current=L?getComputedStyle(L):null,c(L)},[])}}function S0(t){return(t==null?void 0:t.animationName)||"none"}function RK(t){var f,_;let i=(f=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:f.get,c=i&&"isReactWarning"in i&&i.isReactWarning;return c?t.ref:(i=(_=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:_.get,c=i&&"isReactWarning"in i&&i.isReactWarning,c?t.props.ref:t.props.ref||t.ref)}var dS=0;function kK(){fe.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??mL()),document.body.insertAdjacentElement("beforeend",t[1]??mL()),dS++,()=>{dS===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(i=>i.remove()),dS--}},[])}function mL(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Bl=function(){return Bl=Object.assign||function(i){for(var c,f=1,_=arguments.length;f<_;f++){c=arguments[f];for(var w in c)Object.prototype.hasOwnProperty.call(c,w)&&(i[w]=c[w])}return i},Bl.apply(this,arguments)};function GN(t,i){var c={};for(var f in t)Object.prototype.hasOwnProperty.call(t,f)&&i.indexOf(f)<0&&(c[f]=t[f]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _=0,f=Object.getOwnPropertySymbols(t);_<f.length;_++)i.indexOf(f[_])<0&&Object.prototype.propertyIsEnumerable.call(t,f[_])&&(c[f[_]]=t[f[_]]);return c}function DK(t,i,c){if(c||arguments.length===2)for(var f=0,_=i.length,w;f<_;f++)(w||!(f in i))&&(w||(w=Array.prototype.slice.call(i,0,f)),w[f]=i[f]);return t.concat(w||Array.prototype.slice.call(i))}var W0="right-scroll-bar-position",q0="width-before-scroll-bar",LK="with-scroll-bars-hidden",zK="--removed-body-scroll-bar-size";function fS(t,i){return typeof t=="function"?t(i):t&&(t.current=i),t}function OK(t,i){var c=fe.useState(function(){return{value:t,callback:i,facade:{get current(){return c.value},set current(f){var _=c.value;_!==f&&(c.value=f,c.callback(f,_))}}}})[0];return c.callback=i,c.facade}var FK=typeof window<"u"?fe.useLayoutEffect:fe.useEffect,gL=new WeakMap;function NK(t,i){var c=OK(null,function(f){return t.forEach(function(_){return fS(_,f)})});return FK(function(){var f=gL.get(c);if(f){var _=new Set(f),w=new Set(t),E=c.current;_.forEach(function(o){w.has(o)||fS(o,null)}),w.forEach(function(o){_.has(o)||fS(o,E)})}gL.set(c,t)},[t]),c}function BK(t){return t}function jK(t,i){i===void 0&&(i=BK);var c=[],f=!1,_={read:function(){if(f)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return c.length?c[c.length-1]:t},useMedium:function(w){var E=i(w,f);return c.push(E),function(){c=c.filter(function(o){return o!==E})}},assignSyncMedium:function(w){for(f=!0;c.length;){var E=c;c=[],E.forEach(w)}c={push:function(o){return w(o)},filter:function(){return c}}},assignMedium:function(w){f=!0;var E=[];if(c.length){var o=c;c=[],o.forEach(w),E=c}var k=function(){var N=E;E=[],N.forEach(w)},L=function(){return Promise.resolve().then(k)};L(),c={push:function(N){E.push(N),L()},filter:function(N){return E=E.filter(N),c}}}};return _}function VK(t){t===void 0&&(t={});var i=jK(null);return i.options=Bl({async:!0,ssr:!1},t),i}var $N=function(t){var i=t.sideCar,c=GN(t,["sideCar"]);if(!i)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var f=i.read();if(!f)throw new Error("Sidecar medium not found");return fe.createElement(f,Bl({},c))};$N.isSideCarExport=!0;function UK(t,i){return t.useMedium(i),$N}var HN=VK(),pS=function(){},fw=fe.forwardRef(function(t,i){var c=fe.useRef(null),f=fe.useState({onScrollCapture:pS,onWheelCapture:pS,onTouchMoveCapture:pS}),_=f[0],w=f[1],E=t.forwardProps,o=t.children,k=t.className,L=t.removeScrollBar,N=t.enabled,V=t.shards,H=t.sideCar,ne=t.noRelative,ce=t.noIsolation,K=t.inert,se=t.allowPinchZoom,Y=t.as,Q=Y===void 0?"div":Y,ae=t.gapMode,Te=GN(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),Be=H,et=NK([c,i]),nt=Bl(Bl({},Te),_);return fe.createElement(fe.Fragment,null,N&&fe.createElement(Be,{sideCar:HN,removeScrollBar:L,shards:V,noRelative:ne,noIsolation:ce,inert:K,setCallbacks:w,allowPinchZoom:!!se,lockRef:c,gapMode:ae}),E?fe.cloneElement(fe.Children.only(o),Bl(Bl({},nt),{ref:et})):fe.createElement(Q,Bl({},nt,{className:k,ref:et}),o))});fw.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};fw.classNames={fullWidth:q0,zeroRight:W0};var GK=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function $K(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var i=GK();return i&&t.setAttribute("nonce",i),t}function HK(t,i){t.styleSheet?t.styleSheet.cssText=i:t.appendChild(document.createTextNode(i))}function WK(t){var i=document.head||document.getElementsByTagName("head")[0];i.appendChild(t)}var qK=function(){var t=0,i=null;return{add:function(c){t==0&&(i=$K())&&(HK(i,c),WK(i)),t++},remove:function(){t--,!t&&i&&(i.parentNode&&i.parentNode.removeChild(i),i=null)}}},ZK=function(){var t=qK();return function(i,c){fe.useEffect(function(){return t.add(i),function(){t.remove()}},[i&&c])}},WN=function(){var t=ZK(),i=function(c){var f=c.styles,_=c.dynamic;return t(f,_),null};return i},XK={left:0,top:0,right:0,gap:0},mS=function(t){return parseInt(t||"",10)||0},KK=function(t){var i=window.getComputedStyle(document.body),c=i[t==="padding"?"paddingLeft":"marginLeft"],f=i[t==="padding"?"paddingTop":"marginTop"],_=i[t==="padding"?"paddingRight":"marginRight"];return[mS(c),mS(f),mS(_)]},YK=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return XK;var i=KK(t),c=document.documentElement.clientWidth,f=window.innerWidth;return{left:i[0],top:i[1],right:i[2],gap:Math.max(0,f-c+i[2]-i[0])}},JK=WN(),nm="data-scroll-locked",QK=function(t,i,c,f){var _=t.left,w=t.top,E=t.right,o=t.gap;return c===void 0&&(c="margin"),`
  .`.concat(LK,` {
   overflow: hidden `).concat(f,`;
   padding-right: `).concat(o,"px ").concat(f,`;
  }
  body[`).concat(nm,`] {
    overflow: hidden `).concat(f,`;
    overscroll-behavior: contain;
    `).concat([i&&"position: relative ".concat(f,";"),c==="margin"&&`
    padding-left: `.concat(_,`px;
    padding-top: `).concat(w,`px;
    padding-right: `).concat(E,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(f,`;
    `),c==="padding"&&"padding-right: ".concat(o,"px ").concat(f,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(W0,` {
    right: `).concat(o,"px ").concat(f,`;
  }
  
  .`).concat(q0,` {
    margin-right: `).concat(o,"px ").concat(f,`;
  }
  
  .`).concat(W0," .").concat(W0,` {
    right: 0 `).concat(f,`;
  }
  
  .`).concat(q0," .").concat(q0,` {
    margin-right: 0 `).concat(f,`;
  }
  
  body[`).concat(nm,`] {
    `).concat(zK,": ").concat(o,`px;
  }
`)},_L=function(){var t=parseInt(document.body.getAttribute(nm)||"0",10);return isFinite(t)?t:0},eY=function(){fe.useEffect(function(){return document.body.setAttribute(nm,(_L()+1).toString()),function(){var t=_L()-1;t<=0?document.body.removeAttribute(nm):document.body.setAttribute(nm,t.toString())}},[])},tY=function(t){var i=t.noRelative,c=t.noImportant,f=t.gapMode,_=f===void 0?"margin":f;eY();var w=fe.useMemo(function(){return YK(_)},[_]);return fe.createElement(JK,{styles:QK(w,!i,_,c?"":"!important")})},q2=!1;if(typeof window<"u")try{var E0=Object.defineProperty({},"passive",{get:function(){return q2=!0,!0}});window.addEventListener("test",E0,E0),window.removeEventListener("test",E0,E0)}catch{q2=!1}var Sp=q2?{passive:!1}:!1,nY=function(t){return t.tagName==="TEXTAREA"},qN=function(t,i){if(!(t instanceof Element))return!1;var c=window.getComputedStyle(t);return c[i]!=="hidden"&&!(c.overflowY===c.overflowX&&!nY(t)&&c[i]==="visible")},iY=function(t){return qN(t,"overflowY")},rY=function(t){return qN(t,"overflowX")},yL=function(t,i){var c=i.ownerDocument,f=i;do{typeof ShadowRoot<"u"&&f instanceof ShadowRoot&&(f=f.host);var _=ZN(t,f);if(_){var w=XN(t,f),E=w[1],o=w[2];if(E>o)return!0}f=f.parentNode}while(f&&f!==c.body);return!1},sY=function(t){var i=t.scrollTop,c=t.scrollHeight,f=t.clientHeight;return[i,c,f]},oY=function(t){var i=t.scrollLeft,c=t.scrollWidth,f=t.clientWidth;return[i,c,f]},ZN=function(t,i){return t==="v"?iY(i):rY(i)},XN=function(t,i){return t==="v"?sY(i):oY(i)},aY=function(t,i){return t==="h"&&i==="rtl"?-1:1},lY=function(t,i,c,f,_){var w=aY(t,window.getComputedStyle(i).direction),E=w*f,o=c.target,k=i.contains(o),L=!1,N=E>0,V=0,H=0;do{if(!o)break;var ne=XN(t,o),ce=ne[0],K=ne[1],se=ne[2],Y=K-se-w*ce;(ce||Y)&&ZN(t,o)&&(V+=Y,H+=ce);var Q=o.parentNode;o=Q&&Q.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Q.host:Q}while(!k&&o!==document.body||k&&(i.contains(o)||i===o));return(N&&Math.abs(V)<1||!N&&Math.abs(H)<1)&&(L=!0),L},I0=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},vL=function(t){return[t.deltaX,t.deltaY]},xL=function(t){return t&&"current"in t?t.current:t},cY=function(t,i){return t[0]===i[0]&&t[1]===i[1]},uY=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},hY=0,Ep=[];function dY(t){var i=fe.useRef([]),c=fe.useRef([0,0]),f=fe.useRef(),_=fe.useState(hY++)[0],w=fe.useState(WN)[0],E=fe.useRef(t);fe.useEffect(function(){E.current=t},[t]),fe.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(_));var K=DK([t.lockRef.current],(t.shards||[]).map(xL),!0).filter(Boolean);return K.forEach(function(se){return se.classList.add("allow-interactivity-".concat(_))}),function(){document.body.classList.remove("block-interactivity-".concat(_)),K.forEach(function(se){return se.classList.remove("allow-interactivity-".concat(_))})}}},[t.inert,t.lockRef.current,t.shards]);var o=fe.useCallback(function(K,se){if("touches"in K&&K.touches.length===2||K.type==="wheel"&&K.ctrlKey)return!E.current.allowPinchZoom;var Y=I0(K),Q=c.current,ae="deltaX"in K?K.deltaX:Q[0]-Y[0],Te="deltaY"in K?K.deltaY:Q[1]-Y[1],Be,et=K.target,nt=Math.abs(ae)>Math.abs(Te)?"h":"v";if("touches"in K&&nt==="h"&&et.type==="range")return!1;var Je=yL(nt,et);if(!Je)return!0;if(Je?Be=nt:(Be=nt==="v"?"h":"v",Je=yL(nt,et)),!Je)return!1;if(!f.current&&"changedTouches"in K&&(ae||Te)&&(f.current=Be),!Be)return!0;var Dt=f.current||Be;return lY(Dt,se,K,Dt==="h"?ae:Te)},[]),k=fe.useCallback(function(K){var se=K;if(!(!Ep.length||Ep[Ep.length-1]!==w)){var Y="deltaY"in se?vL(se):I0(se),Q=i.current.filter(function(Be){return Be.name===se.type&&(Be.target===se.target||se.target===Be.shadowParent)&&cY(Be.delta,Y)})[0];if(Q&&Q.should){se.cancelable&&se.preventDefault();return}if(!Q){var ae=(E.current.shards||[]).map(xL).filter(Boolean).filter(function(Be){return Be.contains(se.target)}),Te=ae.length>0?o(se,ae[0]):!E.current.noIsolation;Te&&se.cancelable&&se.preventDefault()}}},[]),L=fe.useCallback(function(K,se,Y,Q){var ae={name:K,delta:se,target:Y,should:Q,shadowParent:fY(Y)};i.current.push(ae),setTimeout(function(){i.current=i.current.filter(function(Te){return Te!==ae})},1)},[]),N=fe.useCallback(function(K){c.current=I0(K),f.current=void 0},[]),V=fe.useCallback(function(K){L(K.type,vL(K),K.target,o(K,t.lockRef.current))},[]),H=fe.useCallback(function(K){L(K.type,I0(K),K.target,o(K,t.lockRef.current))},[]);fe.useEffect(function(){return Ep.push(w),t.setCallbacks({onScrollCapture:V,onWheelCapture:V,onTouchMoveCapture:H}),document.addEventListener("wheel",k,Sp),document.addEventListener("touchmove",k,Sp),document.addEventListener("touchstart",N,Sp),function(){Ep=Ep.filter(function(K){return K!==w}),document.removeEventListener("wheel",k,Sp),document.removeEventListener("touchmove",k,Sp),document.removeEventListener("touchstart",N,Sp)}},[]);var ne=t.removeScrollBar,ce=t.inert;return fe.createElement(fe.Fragment,null,ce?fe.createElement(w,{styles:uY(_)}):null,ne?fe.createElement(tY,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function fY(t){for(var i=null;t!==null;)t instanceof ShadowRoot&&(i=t.host,t=t.host),t=t.parentNode;return i}const pY=UK(HN,dY);var KN=fe.forwardRef(function(t,i){return fe.createElement(fw,Bl({},t,{ref:i,sideCar:pY}))});KN.classNames=fw.classNames;var mY=function(t){if(typeof document>"u")return null;var i=Array.isArray(t)?t[0]:t;return i.ownerDocument.body},Ip=new WeakMap,A0=new WeakMap,C0={},gS=0,YN=function(t){return t&&(t.host||YN(t.parentNode))},gY=function(t,i){return i.map(function(c){if(t.contains(c))return c;var f=YN(c);return f&&t.contains(f)?f:(console.error("aria-hidden",c,"in not contained inside",t,". Doing nothing"),null)}).filter(function(c){return!!c})},_Y=function(t,i,c,f){var _=gY(i,Array.isArray(t)?t:[t]);C0[c]||(C0[c]=new WeakMap);var w=C0[c],E=[],o=new Set,k=new Set(_),L=function(V){!V||o.has(V)||(o.add(V),L(V.parentNode))};_.forEach(L);var N=function(V){!V||k.has(V)||Array.prototype.forEach.call(V.children,function(H){if(o.has(H))N(H);else try{var ne=H.getAttribute(f),ce=ne!==null&&ne!=="false",K=(Ip.get(H)||0)+1,se=(w.get(H)||0)+1;Ip.set(H,K),w.set(H,se),E.push(H),K===1&&ce&&A0.set(H,!0),se===1&&H.setAttribute(c,"true"),ce||H.setAttribute(f,"true")}catch(Y){console.error("aria-hidden: cannot operate on ",H,Y)}})};return N(i),o.clear(),gS++,function(){E.forEach(function(V){var H=Ip.get(V)-1,ne=w.get(V)-1;Ip.set(V,H),w.set(V,ne),H||(A0.has(V)||V.removeAttribute(f),A0.delete(V)),ne||V.removeAttribute(c)}),gS--,gS||(Ip=new WeakMap,Ip=new WeakMap,A0=new WeakMap,C0={})}},yY=function(t,i,c){c===void 0&&(c="data-aria-hidden");var f=Array.from(Array.isArray(t)?t:[t]),_=mY(t);return _?(f.push.apply(f,Array.from(_.querySelectorAll("[aria-live], script"))),_Y(f,_,c,"aria-hidden")):function(){return null}},pw="Dialog",[JN]=Rm(pw),[vY,il]=JN(pw),QN=t=>{const{__scopeDialog:i,children:c,open:f,defaultOpen:_,onOpenChange:w,modal:E=!0}=t,o=fe.useRef(null),k=fe.useRef(null),[L,N]=BI({prop:f,defaultProp:_??!1,onChange:w,caller:pw});return B.jsx(vY,{scope:i,triggerRef:o,contentRef:k,contentId:cS(),titleId:cS(),descriptionId:cS(),open:L,onOpenChange:N,onOpenToggle:fe.useCallback(()=>N(V=>!V),[N]),modal:E,children:c})};QN.displayName=pw;var eB="DialogTrigger",xY=fe.forwardRef((t,i)=>{const{__scopeDialog:c,...f}=t,_=il(eB,c),w=Fs(i,_.triggerRef);return B.jsx(ar.button,{type:"button","aria-haspopup":"dialog","aria-expanded":_.open,"aria-controls":_.contentId,"data-state":KI(_.open),...f,ref:w,onClick:Rr(t.onClick,_.onOpenToggle)})});xY.displayName=eB;var ZI="DialogPortal",[wY,tB]=JN(ZI,{forceMount:void 0}),nB=t=>{const{__scopeDialog:i,forceMount:c,children:f,container:_}=t,w=il(ZI,i);return B.jsx(wY,{scope:i,forceMount:c,children:fe.Children.map(f,E=>B.jsx(av,{present:c||w.open,children:B.jsx(qI,{asChild:!0,container:_,children:E})}))})};nB.displayName=ZI;var L1="DialogOverlay",iB=fe.forwardRef((t,i)=>{const c=tB(L1,t.__scopeDialog),{forceMount:f=c.forceMount,..._}=t,w=il(L1,t.__scopeDialog);return w.modal?B.jsx(av,{present:f||w.open,children:B.jsx(TY,{..._,ref:i})}):null});iB.displayName=L1;var bY=k1("DialogOverlay.RemoveScroll"),TY=fe.forwardRef((t,i)=>{const{__scopeDialog:c,...f}=t,_=il(L1,c);return B.jsx(KN,{as:bY,allowPinchZoom:!0,shards:[_.contentRef],children:B.jsx(ar.div,{"data-state":KI(_.open),...f,ref:i,style:{pointerEvents:"auto",...f.style}})})}),jd="DialogContent",rB=fe.forwardRef((t,i)=>{const c=tB(jd,t.__scopeDialog),{forceMount:f=c.forceMount,..._}=t,w=il(jd,t.__scopeDialog);return B.jsx(av,{present:f||w.open,children:w.modal?B.jsx(SY,{..._,ref:i}):B.jsx(EY,{..._,ref:i})})});rB.displayName=jd;var SY=fe.forwardRef((t,i)=>{const c=il(jd,t.__scopeDialog),f=fe.useRef(null),_=Fs(i,c.contentRef,f);return fe.useEffect(()=>{const w=f.current;if(w)return yY(w)},[]),B.jsx(sB,{...t,ref:_,trapFocus:c.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Rr(t.onCloseAutoFocus,w=>{var E;w.preventDefault(),(E=c.triggerRef.current)==null||E.focus()}),onPointerDownOutside:Rr(t.onPointerDownOutside,w=>{const E=w.detail.originalEvent,o=E.button===0&&E.ctrlKey===!0;(E.button===2||o)&&w.preventDefault()}),onFocusOutside:Rr(t.onFocusOutside,w=>w.preventDefault())})}),EY=fe.forwardRef((t,i)=>{const c=il(jd,t.__scopeDialog),f=fe.useRef(!1),_=fe.useRef(!1);return B.jsx(sB,{...t,ref:i,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:w=>{var E,o;(E=t.onCloseAutoFocus)==null||E.call(t,w),w.defaultPrevented||(f.current||(o=c.triggerRef.current)==null||o.focus(),w.preventDefault()),f.current=!1,_.current=!1},onInteractOutside:w=>{var k,L;(k=t.onInteractOutside)==null||k.call(t,w),w.defaultPrevented||(f.current=!0,w.detail.originalEvent.type==="pointerdown"&&(_.current=!0));const E=w.target;((L=c.triggerRef.current)==null?void 0:L.contains(E))&&w.preventDefault(),w.detail.originalEvent.type==="focusin"&&_.current&&w.preventDefault()}})}),sB=fe.forwardRef((t,i)=>{const{__scopeDialog:c,trapFocus:f,onOpenAutoFocus:_,onCloseAutoFocus:w,...E}=t,o=il(jd,c),k=fe.useRef(null),L=Fs(i,k);return kK(),B.jsxs(B.Fragment,{children:[B.jsx(VN,{asChild:!0,loop:!0,trapped:f,onMountAutoFocus:_,onUnmountAutoFocus:w,children:B.jsx(WI,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":KI(o.open),...E,ref:L,onDismiss:()=>o.onOpenChange(!1)})}),B.jsxs(B.Fragment,{children:[B.jsx(AY,{titleId:o.titleId}),B.jsx(PY,{contentRef:k,descriptionId:o.descriptionId})]})]})}),XI="DialogTitle",oB=fe.forwardRef((t,i)=>{const{__scopeDialog:c,...f}=t,_=il(XI,c);return B.jsx(ar.h2,{id:_.titleId,...f,ref:i})});oB.displayName=XI;var aB="DialogDescription",IY=fe.forwardRef((t,i)=>{const{__scopeDialog:c,...f}=t,_=il(aB,c);return B.jsx(ar.p,{id:_.descriptionId,...f,ref:i})});IY.displayName=aB;var lB="DialogClose",cB=fe.forwardRef((t,i)=>{const{__scopeDialog:c,...f}=t,_=il(lB,c);return B.jsx(ar.button,{type:"button",...f,ref:i,onClick:Rr(t.onClick,()=>_.onOpenChange(!1))})});cB.displayName=lB;function KI(t){return t?"open":"closed"}var uB="DialogTitleWarning",[GJ,hB]=$7(uB,{contentName:jd,titleName:XI,docsSlug:"dialog"}),AY=({titleId:t})=>{const i=hB(uB),c=`\`${i.contentName}\` requires a \`${i.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${i.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${i.docsSlug}`;return fe.useEffect(()=>{t&&(document.getElementById(t)||console.error(c))},[c,t]),null},CY="DialogDescriptionWarning",PY=({contentRef:t,descriptionId:i})=>{const f=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${hB(CY).contentName}}.`;return fe.useEffect(()=>{var w;const _=(w=t.current)==null?void 0:w.getAttribute("aria-describedby");i&&_&&(document.getElementById(i)||console.warn(f))},[f,t,i]),null},MY=QN,RY=nB,dB=iB,fB=rB,pB=oB,kY=cB;const DY=MY,LY=RY,mB=fe.forwardRef(({className:t,...i},c)=>B.jsx(dB,{ref:c,className:or("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...i}));mB.displayName=dB.displayName;const gB=fe.forwardRef(({className:t,children:i,...c},f)=>B.jsxs(LY,{children:[B.jsx(mB,{}),B.jsxs(fB,{ref:f,className:or("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg md:w-full",t),...c,children:[i,B.jsxs(kY,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[B.jsx(R3,{className:"h-4 w-4"}),B.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));gB.displayName=fB.displayName;const _B=({className:t,...i})=>B.jsx("div",{className:or("flex flex-col space-y-1.5 text-center sm:text-left",t),...i});_B.displayName="DialogHeader";const yB=fe.forwardRef(({className:t,...i},c)=>B.jsx(pB,{ref:c,className:or("text-lg font-semibold leading-none tracking-tight",t),...i}));yB.displayName=pB.displayName;function vB({card:t,isOpen:i,onClose:c,aiRecommendation:f}){return t?B.jsx(DY,{open:i,onOpenChange:c,children:B.jsxs(gB,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[B.jsx(_B,{children:B.jsx(yB,{className:"text-2xl",children:t.name})}),B.jsxs("div",{className:"w-full h-48 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl p-6 text-white mb-6 relative overflow-hidden",children:[B.jsxs("div",{className:"absolute inset-0 opacity-10",children:[B.jsx("div",{className:"absolute top-0 right-0 w-48 h-48 bg-white rounded-full -translate-y-24 translate-x-24"}),B.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-white rounded-full translate-y-16 -translate-x-16"})]}),B.jsxs("div",{className:"relative z-10 h-full flex flex-col justify-between",children:[B.jsx("div",{className:"text-sm opacity-90",children:t.issuer}),B.jsxs("div",{children:[B.jsx("h3",{className:"text-2xl font-bold mb-2",children:t.name}),B.jsx("p",{className:"text-sm opacity-90",children:t.primaryBenefit})]})]})]}),f&&B.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[B.jsxs("h4",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[B.jsx("span",{className:"text-lg",children:""})," AI Recommendation"]}),B.jsx("p",{className:"text-sm text-blue-800",children:f})]}),B.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[B.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[B.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Annual Fee"}),B.jsx("p",{className:"text-xl font-bold",children:t.annualFee===0?"No Fee":Fd(t.annualFee)})]}),t.signupBonus&&B.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[B.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Sign-up Bonus"}),B.jsx("p",{className:"text-sm font-semibold",children:t.signupBonus})]})]}),B.jsxs("div",{className:"mb-6",children:[B.jsx("h4",{className:"font-semibold text-lg mb-3",children:"Rewards Structure"}),B.jsx("div",{className:"space-y-2",children:t.rewardsStructure.map((_,w)=>B.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[B.jsx(Nk,{className:"w-5 h-5 text-green-500 mt-0.5 flex-shrink-0"}),B.jsxs("div",{className:"flex-1",children:[B.jsxs("div",{className:"flex justify-between items-baseline",children:[B.jsx("span",{className:"font-semibold",children:_.category}),B.jsx("span",{className:"text-primary font-bold",children:_.rate})]}),_.description&&B.jsx("p",{className:"text-sm text-gray-600 mt-1",children:_.description})]})]},w))})]}),B.jsxs("div",{className:"mb-6",children:[B.jsx("h4",{className:"font-semibold text-lg mb-3",children:"Additional Benefits"}),B.jsx("ul",{className:"space-y-2",children:t.secondaryBenefits.map((_,w)=>B.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[B.jsx(Nk,{className:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),B.jsx("span",{children:_})]},w))})]}),B.jsxs("div",{className:"mb-6",children:[B.jsx("h4",{className:"font-semibold text-lg mb-2",children:"Requirements"}),B.jsxs("p",{className:"text-sm text-gray-700",children:["Credit Score: ",t.creditScoreRequired]})]}),B.jsx("p",{className:"text-sm text-gray-700 mb-6",children:t.fullDescription}),B.jsxs("div",{className:"flex gap-3",children:[B.jsxs($r,{onClick:()=>window.open(t.applicationUrl,"_blank"),className:"flex-1",size:"lg",children:["Apply Now",B.jsx(SH,{className:"w-4 h-4 ml-2"})]}),B.jsx($r,{onClick:c,variant:"outline",size:"lg",children:"Close"})]})]})}):null}const zY=[{icon:IH,label:"Home",route:"/dashboard"},{icon:tm,label:"For You",route:"/recommendations"},{icon:kH,label:"Add",route:"#",disabled:!0},{icon:DH,label:"Profile",route:"/profile"}];function YI(){const i=Am().pathname;return B.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-xl border-t border-gray-200/50 safe-area-bottom shadow-lg",children:B.jsx("div",{className:"flex items-center justify-around h-20 max-w-screen-xl mx-auto px-4",children:zY.map(c=>{const f=c.icon,_=i===c.route,w=c.disabled;return B.jsxs(_G,{to:w?"#":c.route,className:or("relative flex flex-col items-center justify-center gap-1 touch-target flex-1 transition-all",{"text-primary":_&&!w,"text-gray-500 hover:text-gray-700":!_&&!w,"text-gray-300 cursor-not-allowed":w}),onClick:E=>w&&E.preventDefault(),children:[_&&!w&&B.jsx(di.div,{layoutId:"activeNav",className:"absolute inset-0 bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl -z-10",initial:!1,transition:{type:"spring",stiffness:500,damping:30}}),B.jsxs("div",{className:or("relative p-2 rounded-xl transition-all",{"scale-110":_&&!w}),children:[_&&!w&&B.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl opacity-10"}),B.jsx(f,{className:"w-6 h-6 relative z-10"})]}),B.jsx("span",{className:or("text-xs font-medium transition-all",{"font-bold":_&&!w}),children:c.label})]},c.route)})})})}var JI="Progress",QI=100,[OY]=Rm(JI),[FY,NY]=OY(JI),xB=fe.forwardRef((t,i)=>{const{__scopeProgress:c,value:f=null,max:_,getValueLabel:w=BY,...E}=t;(_||_===0)&&!wL(_)&&console.error(jY(`${_}`,"Progress"));const o=wL(_)?_:QI;f!==null&&!bL(f,o)&&console.error(VY(`${f}`,"Progress"));const k=bL(f,o)?f:null,L=z1(k)?w(k,o):void 0;return B.jsx(FY,{scope:c,value:k,max:o,children:B.jsx(ar.div,{"aria-valuemax":o,"aria-valuemin":0,"aria-valuenow":z1(k)?k:void 0,"aria-valuetext":L,role:"progressbar","data-state":TB(k,o),"data-value":k??void 0,"data-max":o,...E,ref:i})})});xB.displayName=JI;var wB="ProgressIndicator",bB=fe.forwardRef((t,i)=>{const{__scopeProgress:c,...f}=t,_=NY(wB,c);return B.jsx(ar.div,{"data-state":TB(_.value,_.max),"data-value":_.value??void 0,"data-max":_.max,...f,ref:i})});bB.displayName=wB;function BY(t,i){return`${Math.round(t/i*100)}%`}function TB(t,i){return t==null?"indeterminate":t===i?"complete":"loading"}function z1(t){return typeof t=="number"}function wL(t){return z1(t)&&!isNaN(t)&&t>0}function bL(t,i){return z1(t)&&!isNaN(t)&&t<=i&&t>=0}function jY(t,i){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${i}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${QI}\`.`}function VY(t,i){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${i}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${QI} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var SB=xB,UY=bB;const eA=fe.forwardRef(({className:t,value:i,...c},f)=>B.jsx(SB,{ref:f,className:or("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...c,children:B.jsx(UY,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(i||0)}%)`}})}));eA.displayName=SB.displayName;function GY(){return new Promise((t,i)=>{if(!navigator.geolocation){i({code:0,message:"Geolocation is not supported by your browser"});return}navigator.geolocation.getCurrentPosition(c=>{t({lat:c.coords.latitude,lng:c.coords.longitude,accuracy:c.coords.accuracy})},c=>{i({code:c.code,message:$Y(c.code)})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})})}function $Y(t){switch(t){case 1:return"Location permission denied. Please enable location access in your browser settings.";case 2:return"Location information is unavailable.";case 3:return"Location request timed out.";default:return"An unknown error occurred while getting your location."}}function HY(){const[t,i]=fe.useState(null),[c,f]=fe.useState(null),[_,w]=fe.useState(!0),E=async()=>{w(!0),f(null);try{const o=await GY();i(o)}catch(o){f(o)}finally{w(!1)}};return fe.useEffect(()=>{E()},[]),{location:t,error:c,loading:_,refetch:E}}const Wp=[{id:"chase-sapphire-preferred",name:"Chase Sapphire Preferred",issuer:"Chase",logoUrl:"https://logo.clearbit.com/chase.com",imageUrl:"https://images.unsplash.com/photo-1563013544-824ae1b704d3?w=800&h=500&fit=crop",annualFee:95,signupBonus:"60,000 points after spending $4,000 in 3 months",primaryBenefit:"3x points on dining and travel",secondaryBenefits:["2x points on all other travel","25% more value when redeemed through Chase","No foreign transaction fees","Trip cancellation/interruption insurance"],rewardsStructure:[{category:"Dining",rate:"3x",description:"Worldwide restaurants"},{category:"Travel",rate:"3x",description:"Hotels, flights, rental cars"},{category:"Online Groceries",rate:"3x",description:"Excludes Target, Walmart"},{category:"Everything Else",rate:"1x"}],creditScoreRequired:"Good to Excellent (690-850)",fullDescription:"The Chase Sapphire Preferred is perfect for travelers and food lovers. Earn bonus points on dining and travel purchases, plus get valuable travel protections.",applicationUrl:"https://creditcards.chase.com/rewards-credit-cards/sapphire/preferred"},{id:"amex-gold",name:"American Express Gold Card",issuer:"American Express",logoUrl:"https://logo.clearbit.com/americanexpress.com",imageUrl:"https://images.unsplash.com/photo-1604174447415-d9f0efcb0f62?w=800&h=500&fit=crop",annualFee:250,signupBonus:"60,000 points after $6,000 in spend",primaryBenefit:"4x points at restaurants and supermarkets",secondaryBenefits:["$120 Uber Cash annually","$120 dining credit annually","3x points on flights","No foreign transaction fees"],rewardsStructure:[{category:"Restaurants",rate:"4x",description:"Worldwide, including takeout and delivery"},{category:"Supermarkets",rate:"4x",description:"Up to $25,000 per year in purchases"},{category:"Flights",rate:"3x",description:"Booked directly with airlines"},{category:"Everything Else",rate:"1x"}],creditScoreRequired:"Good to Excellent (670-850)",fullDescription:"The Amex Gold Card is ideal for foodies and frequent diners. Maximize rewards on everyday spending with generous dining and grocery bonuses, plus valuable credits.",applicationUrl:"https://www.americanexpress.com/us/credit-cards/card/gold-card/"},{id:"citi-custom-cash",name:"Citi Custom Cash",issuer:"Citi",logoUrl:"https://logo.clearbit.com/citi.com",imageUrl:"https://images.unsplash.com/photo-1559511260-66a654ae982a?w=800&h=500&fit=crop",annualFee:0,signupBonus:"$200 cash back after $750 in purchases",primaryBenefit:"5% cash back on top spending category",secondaryBenefits:["Automatic category selection","Up to $500 per billing cycle","No annual fee","1% cash back on all other purchases"],rewardsStructure:[{category:"Top Category",rate:"5%",description:"Gas, groceries, restaurants, travel, drugstores, or home improvement"},{category:"Everything Else",rate:"1%"}],creditScoreRequired:"Good to Excellent (690-850)",fullDescription:"The Citi Custom Cash card automatically earns 5% cash back in your top spending category each billing cycle, making it perfect for flexible rewards without category tracking.",applicationUrl:"https://www.citi.com/credit-cards/citi-custom-cash-credit-card"},{id:"capital-one-savor",name:"Capital One SavorOne",issuer:"Capital One",logoUrl:"https://logo.clearbit.com/capitalone.com",imageUrl:"https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?w=800&h=500&fit=crop",annualFee:0,signupBonus:"$200 bonus after $500 in purchases",primaryBenefit:"3% on dining and entertainment",secondaryBenefits:["3% on streaming services","3% on grocery stores","No annual fee","No foreign transaction fees"],rewardsStructure:[{category:"Dining",rate:"3%",description:"Restaurants, bars, and food delivery"},{category:"Entertainment",rate:"3%",description:"Movies, concerts, sporting events"},{category:"Groceries",rate:"3%",description:"Excludes superstores"},{category:"Streaming",rate:"3%",description:"Popular streaming services"},{category:"Everything Else",rate:"1%"}],creditScoreRequired:"Good to Excellent (670-850)",fullDescription:"The SavorOne card offers excellent rewards for dining and entertainment without an annual fee, perfect for enjoying life's experiences while earning cash back.",applicationUrl:"https://www.capitalone.com/credit-cards/savorone/"},{id:"discover-it-cash-back",name:"Discover it Cash Back",issuer:"Discover",logoUrl:"https://logo.clearbit.com/discover.com",imageUrl:"https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?w=800&h=500&fit=crop",annualFee:0,signupBonus:"Cash back match for all cash back earned first year",primaryBenefit:"5% rotating categories",secondaryBenefits:["Cash back match first year","No annual fee","Free FICO score","0% intro APR for 15 months"],rewardsStructure:[{category:"Rotating Categories",rate:"5%",description:"Up to $1,500 each quarter when activated"},{category:"Everything Else",rate:"1%",description:"Unlimited cash back"}],creditScoreRequired:"Good to Excellent (670-850)",fullDescription:"The Discover it Cash Back card offers rotating 5% categories and an incredible first-year cash back match, essentially doubling all rewards in your first year.",applicationUrl:"https://www.discover.com/credit-cards/cash-back/it-card.html"},{id:"wells-fargo-active-cash",name:"Wells Fargo Active Cash",issuer:"Wells Fargo",logoUrl:"https://logo.clearbit.com/wellsfargo.com",imageUrl:"https://images.unsplash.com/photo-1553729459-efe14ef6055d?w=800&h=500&fit=crop",annualFee:0,signupBonus:"$200 cash rewards after $500 in purchases",primaryBenefit:"2% cash back on all purchases",secondaryBenefits:["Unlimited 2% on everything","No annual fee","0% intro APR for 15 months","Cell phone protection"],rewardsStructure:[{category:"All Purchases",rate:"2%",description:"Unlimited cash rewards"}],creditScoreRequired:"Good to Excellent (670-850)",fullDescription:"The Wells Fargo Active Cash card offers a simple flat 2% cash back on all purchases with no annual fee, making it an excellent everyday spending card.",applicationUrl:"https://www.wellsfargo.com/credit-cards/active-cash/"}];function WY(t,i,c=2){const f=[],_=[{name:"dining",merchants:["Chipotle","Starbucks","McDonald's","Panera Bread","Local Bistro"]},{name:"gas",merchants:["Shell","Chevron","BP","ExxonMobil","7-Eleven"]},{name:"groceries",merchants:["Whole Foods","Trader Joe's","Safeway","Walmart","Target"]},{name:"shopping",merchants:["Best Buy","Apple Store","Nordstrom","Macy's","HomeGoods"]},{name:"entertainment",merchants:["AMC Theatres","Dave & Buster's","Top Golf","Bowling Alley","Arcade"]}];let w=1;return _.forEach(E=>{E.merchants.forEach(o=>{const k=Math.random()*2*Math.PI,L=Math.random()*c,N=L/69*Math.cos(k),V=L/(69*Math.cos(t*Math.PI/180))*Math.sin(k);f.push({id:`merchant-${w++}`,name:o,category:E.name,location:{lat:t+N,lng:i+V},address:`${Math.floor(Math.random()*9e3+1e3)} Main St`,estimatedSpend:Math.floor(Math.random()*50+10)})})}),f}function qY(){var nt;const{user:t}=ev(),i=Gd(),{location:c,budget:f,onboardingCompleted:_,setLocation:w}=sv(),{location:E,error:o,loading:k,refetch:L}=HY(),[N,V]=fe.useState(null),[H,ne]=fe.useState(!1),[ce,K]=fe.useState([]),[se,Y]=fe.useState(null);fe.useEffect(()=>{_||i("/onboarding/choice")},[_,i]),fe.useEffect(()=>{if(E){w(E);const Je=WY(E.lat,E.lng);K(Je)}},[E,w]);const Q=E||c,ae=Je=>{V(Je),ne(!0)},Te=Je=>{Y(Je)};if(!_)return null;const Be=f?Object.values(f).reduce((Je,Dt)=>Je+Dt,0):0,et=f?Object.entries(f).sort((Je,Dt)=>Dt[1]-Je[1])[0]:null;return B.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-purple-50/30 pb-24",children:[B.jsxs("div",{className:"relative bg-gradient-to-r from-blue-600 via-purple-600 to-pink-500 text-white px-4 py-8 overflow-hidden",children:[B.jsx("div",{className:"absolute inset-0 bg-grid-white/10"}),B.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -translate-y-32 translate-x-32"}),B.jsxs("div",{className:"max-w-7xl mx-auto relative z-10",children:[B.jsxs("div",{className:"flex items-start justify-between mb-4",children:[B.jsxs("div",{children:[B.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["Welcome back, ",(nt=t==null?void 0:t.name)==null?void 0:nt.split(" ")[0],"! "]}),B.jsx("p",{className:"text-blue-100 text-lg",children:"Here are your personalized insights"})]}),B.jsxs(Ks,{variant:"secondary",className:"bg-white/20 text-white border-white/30 backdrop-blur-sm",children:[B.jsx(oh,{className:"w-3 h-3 mr-1"}),"Premium"]})]}),Be>0&&B.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6",children:[B.jsxs(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20",children:[B.jsx(b1,{className:"w-5 h-5 mb-2 opacity-80"}),B.jsxs("p",{className:"text-2xl font-bold",children:["$",Be]}),B.jsx("p",{className:"text-xs opacity-80",children:"Monthly Budget"})]}),B.jsxs(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20",children:[B.jsx(em,{className:"w-5 h-5 mb-2 opacity-80"}),B.jsx("p",{className:"text-2xl font-bold",children:Wp.length}),B.jsx("p",{className:"text-xs opacity-80",children:"Top Cards"})]}),B.jsxs(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20",children:[B.jsx(Nd,{className:"w-5 h-5 mb-2 opacity-80"}),B.jsx("p",{className:"text-2xl font-bold",children:"3.2x"}),B.jsx("p",{className:"text-xs opacity-80",children:"Avg. Rewards"})]})]})]})]}),B.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6 space-y-6",children:[k&&B.jsxs(di.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-center gap-3",children:[B.jsx(oI,{className:"w-5 h-5 text-blue-600 animate-spin"}),B.jsx("span",{className:"text-blue-900",children:"Getting your location..."})]}),o&&B.jsx(di.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:B.jsxs("div",{className:"flex items-start gap-3",children:[B.jsx(xH,{className:"w-5 h-5 text-orange-600 mt-0.5"}),B.jsxs("div",{className:"flex-1",children:[B.jsx("p",{className:"text-orange-900 font-medium mb-1",children:"Location Access Needed"}),B.jsx("p",{className:"text-sm text-orange-800 mb-3",children:o.message}),B.jsxs($r,{onClick:L,size:"sm",variant:"outline",children:[B.jsx(oy,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})]})}),Q&&B.jsx(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:B.jsxs(Xr,{className:"shadow-lg border-0 bg-white/80 backdrop-blur-sm",children:[B.jsx(wo,{children:B.jsxs("div",{className:"flex justify-between items-center",children:[B.jsxs("div",{className:"flex items-center gap-2",children:[B.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center",children:B.jsx(oy,{className:"w-5 h-5 text-white"})}),B.jsxs("div",{children:[B.jsx(bo,{className:"text-xl",children:"Nearby Merchants"}),B.jsx("p",{className:"text-sm text-muted-foreground",children:"Discover best cards for each location"})]})]}),B.jsxs(Ks,{variant:"outline",className:"ml-2",children:[ce.length," locations"]})]})}),B.jsxs(Kr,{className:"pt-0",children:[B.jsx("div",{className:"rounded-xl overflow-hidden border-2 border-gray-200",children:B.jsx(IX,{userLocation:Q,merchants:ce,onMerchantSelect:Te})}),se&&B.jsx(di.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-4 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-200",children:B.jsxs("div",{className:"flex items-start justify-between",children:[B.jsxs("div",{children:[B.jsxs("h3",{className:"font-semibold text-gray-900 mb-1 flex items-center gap-2",children:[B.jsx(oy,{className:"w-4 h-4 text-blue-600"}),se.name]}),B.jsx("p",{className:"text-sm text-gray-600",children:se.category})]}),B.jsxs(Ks,{className:"bg-green-100 text-green-800 border-green-300",children:["~$",se.estimatedSpend]})]})})]})]})}),B.jsx(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:B.jsxs(Xr,{className:"shadow-lg border-0 bg-white/80 backdrop-blur-sm",children:[B.jsx(wo,{children:B.jsxs("div",{className:"flex items-start justify-between",children:[B.jsxs("div",{className:"flex items-center gap-2",children:[B.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center",children:B.jsx(oh,{className:"w-5 h-5 text-white"})}),B.jsxs("div",{children:[B.jsx(bo,{className:"text-xl",children:"Smart Recommendations"}),B.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Optimized for your ",et?et[0]:"spending"," habits"]})]})]}),B.jsxs(Ks,{className:"bg-purple-100 text-purple-800 border-purple-300",children:[B.jsx(Nd,{className:"w-3 h-3 mr-1"}),"Top Picks"]})]})}),B.jsx(Kr,{children:B.jsx(cK,{cards:Wp,onCardClick:ae})})]})}),f&&B.jsx(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},children:B.jsxs(Xr,{className:"shadow-lg border-0 bg-white/80 backdrop-blur-sm",children:[B.jsx(wo,{children:B.jsxs("div",{className:"flex items-center gap-2",children:[B.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:B.jsx(b1,{className:"w-5 h-5 text-white"})}),B.jsxs("div",{children:[B.jsx(bo,{className:"text-xl",children:"Spending Breakdown"}),B.jsx("p",{className:"text-sm text-muted-foreground",children:"Monthly budget allocation"})]})]})}),B.jsxs(Kr,{children:[B.jsx("div",{className:"space-y-4",children:Object.entries(f).sort((Je,Dt)=>Dt[1]-Je[1]).map(([Je,Dt],wt)=>{const xt=Be>0?Dt/Be*100:0,qt=["bg-blue-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-violet-500","bg-fuchsia-500"];return B.jsxs(di.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:wt*.05},className:"group",children:[B.jsxs("div",{className:"flex items-center justify-between mb-2",children:[B.jsxs("div",{className:"flex items-center gap-2",children:[B.jsx("div",{className:`w-3 h-3 rounded-full ${qt[wt%qt.length]}`}),B.jsx("span",{className:"text-sm font-medium capitalize group-hover:text-primary transition-colors",children:Je})]}),B.jsxs("div",{className:"flex items-center gap-2",children:[B.jsxs("span",{className:"text-sm text-muted-foreground",children:[xt.toFixed(0),"%"]}),B.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["$",Dt]})]})]}),B.jsx(eA,{value:xt,className:"h-2"})]},Je)})}),B.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:B.jsxs("div",{className:"flex justify-between items-center",children:[B.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Monthly Budget"}),B.jsxs("span",{className:"text-2xl font-bold text-primary",children:["$",Be]})]})})]})]})})]}),B.jsx(vB,{card:N,isOpen:H,onClose:()=>ne(!1)}),B.jsx(YI,{})]})}function ZY(){const{budget:t}=sv(),[i,c]=fe.useState(null),[f,_]=fe.useState(!1),w=N=>{c(N),_(!0)},E=()=>{if(!t)return Wp.slice(0,3);const N=Object.entries(t).sort((H,ne)=>ne[1]-H[1])[0][0];return[...Wp].sort((H,ne)=>{const ce=o(H,N);return o(ne,N)-ce}).slice(0,3)},o=(N,V)=>{const H=N.primaryBenefit.toLowerCase()+" "+N.secondaryBenefits.join(" ").toLowerCase();return H.includes(V)||H.includes("dining")&&V==="dining"||H.includes("travel")&&V==="travel"||H.includes("gas")&&V==="gas"||H.includes("grocer")&&V==="groceries"?10:N.annualFee===0?5:3},k=E(),L=Wp.filter(N=>!k.find(V=>V.id===N.id));return B.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-purple-50/30 to-pink-50/30 pb-24",children:[B.jsxs("div",{className:"relative bg-gradient-to-r from-purple-600 via-pink-600 to-rose-500 text-white px-4 py-12 overflow-hidden",children:[B.jsx("div",{className:"absolute inset-0 bg-grid-white/10"}),B.jsx("div",{className:"absolute top-0 left-0 w-96 h-96 bg-white/10 rounded-full blur-3xl -translate-y-48 -translate-x-48"}),B.jsx("div",{className:"absolute bottom-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl translate-y-32 translate-x-32"}),B.jsx("div",{className:"max-w-7xl mx-auto relative z-10",children:B.jsxs(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[B.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[B.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:B.jsx(oh,{className:"w-6 h-6"})}),B.jsxs("div",{children:[B.jsx("h1",{className:"text-3xl font-bold",children:"AI Recommendations"}),B.jsx("p",{className:"text-purple-100 text-sm",children:"Personalized for your spending habits"})]})]}),B.jsxs("div",{className:"flex flex-wrap gap-2 mt-6",children:[B.jsxs(Ks,{variant:"secondary",className:"bg-white/20 text-white border-white/30 backdrop-blur-sm",children:[B.jsx(ay,{className:"w-3 h-3 mr-1 fill-current"}),"Top Rated"]}),B.jsxs(Ks,{variant:"secondary",className:"bg-white/20 text-white border-white/30 backdrop-blur-sm",children:[B.jsx(em,{className:"w-3 h-3 mr-1"}),"Best Match"]}),B.jsxs(Ks,{variant:"secondary",className:"bg-white/20 text-white border-white/30 backdrop-blur-sm",children:[B.jsx(S1,{className:"w-3 h-3 mr-1"}),"Updated Daily"]})]})]})})]}),B.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6 space-y-6",children:[B.jsxs(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[B.jsxs("div",{className:"flex items-center justify-between mb-6",children:[B.jsxs("div",{className:"flex items-center gap-2",children:[B.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center",children:B.jsx(Nd,{className:"w-5 h-5 text-white"})}),B.jsxs("div",{children:[B.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Top Picks for You"}),B.jsx("p",{className:"text-sm text-muted-foreground",children:"Best matches based on AI analysis"})]})]}),B.jsxs(Ks,{className:"bg-purple-100 text-purple-800 border-purple-300",children:[B.jsx(ay,{className:"w-3 h-3 mr-1 fill-current"}),"Recommended"]})]}),B.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:k.map((N,V)=>B.jsx(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:V*.1},whileHover:{y:-8},children:B.jsxs(Xr,{className:"h-full hover:shadow-2xl transition-all cursor-pointer border-0 bg-white/80 backdrop-blur-sm relative overflow-hidden group",children:[B.jsx("div",{className:"absolute top-4 right-4 z-10",children:B.jsxs(Ks,{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white border-0",children:["#",V+1," Pick"]})}),B.jsxs(wo,{children:[B.jsxs("div",{className:"w-full h-40 bg-gradient-to-br from-purple-500 via-pink-500 to-rose-500 rounded-xl mb-4 flex items-center justify-center relative overflow-hidden group-hover:scale-105 transition-transform",children:[B.jsx("div",{className:"absolute inset-0 bg-grid-white/10"}),B.jsx("span",{className:"text-6xl relative z-10",children:""})]}),B.jsx(bo,{className:"text-xl",children:N.name}),B.jsx(Vy,{className:"text-base",children:N.issuer})]}),B.jsx(Kr,{children:B.jsxs("div",{className:"space-y-3",children:[B.jsxs("div",{className:"p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg",children:[B.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Primary Benefit"}),B.jsx("p",{className:"font-semibold text-purple-900",children:N.primaryBenefit})]}),B.jsxs("div",{className:"flex justify-between items-center",children:[B.jsxs("div",{children:[B.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Annual Fee"}),B.jsx("p",{className:"font-bold text-lg",children:N.annualFee===0?B.jsx("span",{className:"text-green-600",children:"$0 "}):B.jsx("span",{className:"text-gray-900",children:Fd(N.annualFee)})})]}),N.signupBonus&&B.jsxs(Ks,{className:"bg-green-100 text-green-800 border-green-300",children:[B.jsx(S1,{className:"w-3 h-3 mr-1"}),"Bonus"]})]}),B.jsxs($r,{className:"w-full mt-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",onClick:H=>{H.stopPropagation(),w(N)},children:[B.jsx(em,{className:"w-4 h-4 mr-2"}),"View Full Details"]})]})})]})},N.id))})]}),B.jsxs(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[B.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"More Options to Consider"}),B.jsx("div",{className:"grid md:grid-cols-3 lg:grid-cols-4 gap-4",children:L.map((N,V)=>B.jsx(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4+V*.05},whileHover:{y:-4},children:B.jsxs(Xr,{className:"h-full hover:shadow-xl transition-all cursor-pointer border-0 bg-white/60 backdrop-blur-sm",onClick:()=>w(N),children:[B.jsxs(wo,{className:"pb-3",children:[B.jsx("div",{className:"w-full h-28 bg-gradient-to-br from-gray-400 to-gray-600 rounded-lg mb-3 flex items-center justify-center",children:B.jsx("span",{className:"text-4xl",children:""})}),B.jsx(bo,{className:"text-base line-clamp-1",children:N.name}),B.jsx(Vy,{className:"text-xs line-clamp-2",children:N.primaryBenefit})]}),B.jsx(Kr,{className:"pt-0",children:B.jsx($r,{variant:"outline",size:"sm",className:"w-full",onClick:H=>{H.stopPropagation(),w(N)},children:"Details"})})]})},N.id))})]}),t&&B.jsx(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:B.jsxs(Xr,{className:"bg-gradient-to-r from-purple-100 via-pink-100 to-rose-100 border-0 shadow-xl",children:[B.jsx(wo,{children:B.jsxs("div",{className:"flex items-center gap-3",children:[B.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-600 to-pink-600 rounded-2xl flex items-center justify-center shadow-lg",children:B.jsx(oh,{className:"w-6 h-6 text-white"})}),B.jsxs("div",{children:[B.jsx(bo,{className:"text-2xl",children:"AI-Powered Insights"}),B.jsx("p",{className:"text-sm text-gray-600",children:"Personalized recommendations just for you"})]})]})}),B.jsx(Kr,{children:B.jsxs("div",{className:"bg-white/60 backdrop-blur-sm rounded-xl p-6",children:[B.jsxs("p",{className:"text-gray-800 text-lg leading-relaxed",children:["Based on your spending pattern, focusing on cards with strong "," ",B.jsx("span",{className:"font-bold text-purple-700 bg-purple-100 px-2 py-1 rounded",children:Object.entries(t).sort((N,V)=>V[1]-N[1])[0][0]})," "," rewards could maximize your earnings. Our AI recommends cards that offer"," ",B.jsx("span",{className:"font-bold text-green-700",children:"3-5% back"})," in your top categories."]}),B.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mt-6",children:[B.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-xl",children:[B.jsx(Nd,{className:"w-8 h-8 text-blue-600 mb-2"}),B.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Potential Earnings"}),B.jsx("p",{className:"text-2xl font-bold text-blue-900",children:"+$847/yr"})]}),B.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-xl",children:[B.jsx(em,{className:"w-8 h-8 text-purple-600 mb-2"}),B.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Match Score"}),B.jsx("p",{className:"text-2xl font-bold text-purple-900",children:"94%"})]}),B.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 p-4 rounded-xl",children:[B.jsx(ay,{className:"w-8 h-8 text-pink-600 mb-2 fill-current"}),B.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Cards Analyzed"}),B.jsx("p",{className:"text-2xl font-bold text-pink-900",children:Wp.length})]})]})]})})]})})]}),B.jsx(vB,{card:i,isOpen:f,onClose:()=>_(!1)}),B.jsx(YI,{})]})}function XY(){return hN.useSyncExternalStore(KY,()=>!0,()=>!1)}function KY(){return()=>{}}var tA="Avatar",[YY]=Rm(tA),[JY,EB]=YY(tA),IB=fe.forwardRef((t,i)=>{const{__scopeAvatar:c,...f}=t,[_,w]=fe.useState("idle");return B.jsx(JY,{scope:c,imageLoadingStatus:_,onImageLoadingStatusChange:w,children:B.jsx(ar.span,{...f,ref:i})})});IB.displayName=tA;var AB="AvatarImage",CB=fe.forwardRef((t,i)=>{const{__scopeAvatar:c,src:f,onLoadingStatusChange:_=()=>{},...w}=t,E=EB(AB,c),o=QY(f,w),k=Wl(L=>{_(L),E.onImageLoadingStatusChange(L)});return Hl(()=>{o!=="idle"&&k(o)},[o,k]),o==="loaded"?B.jsx(ar.img,{...w,ref:i,src:f}):null});CB.displayName=AB;var PB="AvatarFallback",MB=fe.forwardRef((t,i)=>{const{__scopeAvatar:c,delayMs:f,..._}=t,w=EB(PB,c),[E,o]=fe.useState(f===void 0);return fe.useEffect(()=>{if(f!==void 0){const k=window.setTimeout(()=>o(!0),f);return()=>window.clearTimeout(k)}},[f]),E&&w.imageLoadingStatus!=="loaded"?B.jsx(ar.span,{..._,ref:i}):null});MB.displayName=PB;function TL(t,i){return t?i?(t.src!==i&&(t.src=i),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function QY(t,{referrerPolicy:i,crossOrigin:c}){const f=XY(),_=fe.useRef(null),w=f?(_.current||(_.current=new window.Image),_.current):null,[E,o]=fe.useState(()=>TL(w,t));return Hl(()=>{o(TL(w,t))},[w,t]),Hl(()=>{const k=V=>()=>{o(V)};if(!w)return;const L=k("loaded"),N=k("error");return w.addEventListener("load",L),w.addEventListener("error",N),i&&(w.referrerPolicy=i),typeof c=="string"&&(w.crossOrigin=c),()=>{w.removeEventListener("load",L),w.removeEventListener("error",N)}},[w,c,i]),E}var RB=IB,kB=CB,DB=MB;const LB=fe.forwardRef(({className:t,...i},c)=>B.jsx(RB,{ref:c,className:or("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...i}));LB.displayName=RB.displayName;const zB=fe.forwardRef(({className:t,...i},c)=>B.jsx(kB,{ref:c,className:or("aspect-square h-full w-full",t),...i}));zB.displayName=kB.displayName;const OB=fe.forwardRef(({className:t,...i},c)=>B.jsx(DB,{ref:c,className:or("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...i}));OB.displayName=DB.displayName;var eJ="Separator",SL="horizontal",tJ=["horizontal","vertical"],FB=fe.forwardRef((t,i)=>{const{decorative:c,orientation:f=SL,..._}=t,w=nJ(f)?f:SL,o=c?{role:"none"}:{"aria-orientation":w==="vertical"?w:void 0,role:"separator"};return B.jsx(ar.div,{"data-orientation":w,...o,..._,ref:i})});FB.displayName=eJ;function nJ(t){return tJ.includes(t)}var NB=FB;const BB=fe.forwardRef(({className:t,orientation:i="horizontal",decorative:c=!0,...f},_)=>B.jsx(NB,{ref:_,decorative:c,orientation:i,className:or("shrink-0 bg-border",i==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...f}));BB.displayName=NB.displayName;function iJ(){var E;const{user:t,logout:i}=ev(),{budget:c,linkedBank:f,onboardingCompleted:_}=sv(),w=c?Object.values(c).reduce((o,k)=>o+k,0):0;return B.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-purple-50/30 pb-24",children:[B.jsxs("div",{className:"relative bg-gradient-to-r from-blue-600 via-purple-600 to-pink-500 text-white px-4 py-12 overflow-hidden",children:[B.jsx("div",{className:"absolute inset-0 bg-grid-white/10"}),B.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full blur-3xl -translate-y-48 translate-x-48"}),B.jsx("div",{className:"max-w-4xl mx-auto relative z-10",children:B.jsxs(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center text-center",children:[B.jsxs(LB,{className:"w-24 h-24 border-4 border-white shadow-xl mb-4",children:[B.jsx(zB,{src:t==null?void 0:t.picture,alt:(t==null?void 0:t.name)||"User"}),B.jsx(OB,{className:"text-3xl bg-gradient-to-br from-blue-500 to-purple-600 text-white",children:((E=t==null?void 0:t.name)==null?void 0:E.split(" ").map(o=>o[0]).join(""))||"U"})]}),B.jsx("h1",{className:"text-3xl font-bold mb-2",children:t==null?void 0:t.name}),B.jsxs("p",{className:"text-blue-100 flex items-center gap-2 mb-4",children:[B.jsx(MH,{className:"w-4 h-4"}),t==null?void 0:t.email]}),B.jsxs(Ks,{variant:"secondary",className:"bg-white/20 text-white border-white/30 backdrop-blur-sm",children:[B.jsx(oh,{className:"w-3 h-3 mr-1"}),"Premium Member"]})]})})]}),B.jsxs("div",{className:"max-w-4xl mx-auto px-4 -mt-12 relative z-10 space-y-6",children:[B.jsxs(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"grid grid-cols-3 gap-4",children:[B.jsx(Xr,{className:"shadow-lg border-0 bg-white/80 backdrop-blur-sm",children:B.jsxs(Kr,{className:"pt-6 text-center",children:[B.jsx(b1,{className:"w-8 h-8 mx-auto mb-2 text-green-600"}),B.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",w]}),B.jsx("p",{className:"text-sm text-muted-foreground",children:"Monthly Budget"})]})}),B.jsx(Xr,{className:"shadow-lg border-0 bg-white/80 backdrop-blur-sm",children:B.jsxs(Kr,{className:"pt-6 text-center",children:[B.jsx(em,{className:"w-8 h-8 mx-auto mb-2 text-purple-600"}),B.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"12"}),B.jsx("p",{className:"text-sm text-muted-foreground",children:"Tracked Cards"})]})}),B.jsx(Xr,{className:"shadow-lg border-0 bg-white/80 backdrop-blur-sm",children:B.jsxs(Kr,{className:"pt-6 text-center",children:[B.jsx(Nd,{className:"w-8 h-8 mx-auto mb-2 text-blue-600"}),B.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"3.2x"}),B.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg. Rewards"})]})})]}),B.jsx(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:B.jsxs(Xr,{className:"shadow-lg border-0 bg-white/80 backdrop-blur-sm",children:[B.jsx(wo,{children:B.jsx(bo,{children:"Account Information"})}),B.jsxs(Kr,{className:"space-y-4",children:[B.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl",children:[B.jsxs("div",{className:"flex items-center gap-3",children:[B.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center",children:B.jsx(T1,{className:"w-5 h-5 text-white"})}),B.jsxs("div",{children:[B.jsx("p",{className:"font-medium text-gray-900",children:"Account Status"}),B.jsx("p",{className:"text-sm text-gray-600",children:_?"Active & Verified":"Setup Incomplete"})]})]}),B.jsx(Ks,{className:_?"bg-green-100 text-green-800 border-green-300":"bg-orange-100 text-orange-800 border-orange-300",children:_?" Active":" Incomplete"})]}),B.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-purple-100 rounded-xl",children:[B.jsxs("div",{className:"flex items-center gap-3",children:[B.jsx("div",{className:"w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center",children:B.jsx(tm,{className:"w-5 h-5 text-white"})}),B.jsxs("div",{children:[B.jsx("p",{className:"font-medium text-gray-900",children:"Data Source"}),B.jsx("p",{className:"text-sm text-gray-600",children:f?"Bank account linked":"Manual entry mode"})]})]}),B.jsx(Ks,{className:f?"bg-blue-100 text-blue-800 border-blue-300":"bg-gray-100 text-gray-800 border-gray-300",children:f?" Linked":" Manual"})]})]})]})}),c&&B.jsx(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:B.jsxs(Xr,{className:"shadow-lg border-0 bg-white/80 backdrop-blur-sm",children:[B.jsx(wo,{children:B.jsxs("div",{className:"flex items-center justify-between",children:[B.jsxs("div",{className:"flex items-center gap-2",children:[B.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:B.jsx(b1,{className:"w-5 h-5 text-white"})}),B.jsxs("div",{children:[B.jsx(bo,{children:"Monthly Budget"}),B.jsx("p",{className:"text-sm text-muted-foreground",children:"Spending allocation"})]})]}),B.jsxs("div",{className:"text-right",children:[B.jsx("p",{className:"text-3xl font-bold text-primary",children:Fd(w)}),B.jsx("p",{className:"text-xs text-muted-foreground",children:"Total budget"})]})]})}),B.jsxs(Kr,{className:"space-y-4",children:[Object.entries(c).sort((o,k)=>k[1]-o[1]).map(([o,k],L)=>{const N=k/w*100,V=["bg-blue-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-green-500","bg-orange-500"];return B.jsxs(di.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3+L*.05},children:[B.jsxs("div",{className:"flex justify-between items-center mb-2",children:[B.jsxs("div",{className:"flex items-center gap-2",children:[B.jsx("div",{className:`w-3 h-3 rounded-full ${V[L%V.length]}`}),B.jsx("span",{className:"text-sm font-medium capitalize",children:o})]}),B.jsxs("div",{className:"flex items-center gap-3",children:[B.jsxs("span",{className:"text-xs text-muted-foreground",children:[N.toFixed(0),"%"]}),B.jsx("span",{className:"text-sm font-bold",children:Fd(k)})]})]}),B.jsx(eA,{value:N,className:"h-2"})]},o)}),B.jsx(BB,{className:"my-6"}),B.jsxs($r,{variant:"outline",className:"w-full",size:"lg",children:[B.jsx(Bk,{className:"w-4 h-4 mr-2"}),"Update Budget Categories"]})]})]})}),B.jsxs(di.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"grid md:grid-cols-2 gap-6",children:[B.jsxs(Xr,{className:"shadow-lg border-0 bg-white/80 backdrop-blur-sm",children:[B.jsx(wo,{children:B.jsx(bo,{className:"text-lg",children:"Quick Actions"})}),B.jsxs(Kr,{className:"space-y-3",children:[B.jsxs($r,{variant:"outline",className:"w-full justify-start hover:bg-blue-50 hover:border-blue-300 transition-colors",size:"lg",children:[B.jsx(tm,{className:"w-5 h-5 mr-3 text-blue-600"}),B.jsx("span",{children:"Manage Cards"})]}),B.jsxs($r,{variant:"outline",className:"w-full justify-start hover:bg-purple-50 hover:border-purple-300 transition-colors",size:"lg",children:[B.jsx(Bk,{className:"w-5 h-5 mr-3 text-purple-600"}),B.jsx("span",{children:"Preferences"})]}),B.jsxs($r,{variant:"outline",className:"w-full justify-start hover:bg-green-50 hover:border-green-300 transition-colors",size:"lg",children:[B.jsx(wH,{className:"w-5 h-5 mr-3 text-green-600"}),B.jsx("span",{children:"Notifications"})]})]})]}),B.jsxs(Xr,{className:"shadow-lg border-0 bg-white/80 backdrop-blur-sm",children:[B.jsx(wo,{children:B.jsx(bo,{className:"text-lg",children:"Support & Account"})}),B.jsxs(Kr,{className:"space-y-3",children:[B.jsxs($r,{variant:"outline",className:"w-full justify-start hover:bg-blue-50 hover:border-blue-300 transition-colors",size:"lg",children:[B.jsx(EH,{className:"w-5 h-5 mr-3 text-blue-600"}),B.jsx("span",{children:"Help Center"})]}),B.jsxs($r,{variant:"outline",className:"w-full justify-start hover:bg-indigo-50 hover:border-indigo-300 transition-colors",size:"lg",children:[B.jsx(T1,{className:"w-5 h-5 mr-3 text-indigo-600"}),B.jsx("span",{children:"Security"})]}),B.jsxs($r,{variant:"outline",className:"w-full justify-start text-red-600 hover:text-red-700 hover:bg-red-50 hover:border-red-300 transition-colors",size:"lg",onClick:()=>i({logoutParams:{returnTo:window.location.origin}}),children:[B.jsx(PH,{className:"w-5 h-5 mr-3"}),B.jsx("span",{children:"Log Out"})]})]})]})]})]}),B.jsx(YI,{})]})}function rJ(){return B.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:B.jsxs("div",{className:"text-center",children:[B.jsx(oI,{className:"w-12 h-12 text-primary animate-spin mx-auto mb-4"}),B.jsx("p",{className:"text-gray-600",children:"Loading..."})]})})}const sJ=1,oJ=1e6;let _S=0;function aJ(){return _S=(_S+1)%Number.MAX_SAFE_INTEGER,_S.toString()}const yS=new Map,EL=t=>{if(yS.has(t))return;const i=setTimeout(()=>{yS.delete(t),fy({type:"REMOVE_TOAST",toastId:t})},oJ);yS.set(t,i)},lJ=(t,i)=>{switch(i.type){case"ADD_TOAST":return{...t,toasts:[i.toast,...t.toasts].slice(0,sJ)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(c=>c.id===i.toast.id?{...c,...i.toast}:c)};case"DISMISS_TOAST":{const{toastId:c}=i;return c?EL(c):t.toasts.forEach(f=>{EL(f.id)}),{...t,toasts:t.toasts.map(f=>f.id===c||c===void 0?{...f,open:!1}:f)}}case"REMOVE_TOAST":return i.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(c=>c.id!==i.toastId)}}},Z0=[];let X0={toasts:[]};function fy(t){X0=lJ(X0,t),Z0.forEach(i=>{i(X0)})}function cJ({...t}){const i=aJ(),c=_=>fy({type:"UPDATE_TOAST",toast:{..._,id:i}}),f=()=>fy({type:"DISMISS_TOAST",toastId:i});return fy({type:"ADD_TOAST",toast:{...t,id:i,open:!0,onOpenChange:_=>{_||f()}}}),{id:i,dismiss:f,update:c}}function uJ(){const[t,i]=fe.useState(X0);return fe.useEffect(()=>(Z0.push(i),()=>{const c=Z0.indexOf(i);c>-1&&Z0.splice(c,1)}),[t]),{...t,toast:cJ,dismiss:c=>fy({type:"DISMISS_TOAST",toastId:c})}}var hJ=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),dJ="VisuallyHidden",nA=fe.forwardRef((t,i)=>B.jsx(ar.span,{...t,ref:i,style:{...hJ,...t.style}}));nA.displayName=dJ;var iA="ToastProvider",[rA,fJ,pJ]=gN("Toast"),[jB]=Rm("Toast",[pJ]),[mJ,mw]=jB(iA),VB=t=>{const{__scopeToast:i,label:c="Notification",duration:f=5e3,swipeDirection:_="right",swipeThreshold:w=50,children:E}=t,[o,k]=fe.useState(null),[L,N]=fe.useState(0),V=fe.useRef(!1),H=fe.useRef(!1);return c.trim()||console.error(`Invalid prop \`label\` supplied to \`${iA}\`. Expected non-empty \`string\`.`),B.jsx(rA.Provider,{scope:i,children:B.jsx(mJ,{scope:i,label:c,duration:f,swipeDirection:_,swipeThreshold:w,toastCount:L,viewport:o,onViewportChange:k,onToastAdd:fe.useCallback(()=>N(ne=>ne+1),[]),onToastRemove:fe.useCallback(()=>N(ne=>ne-1),[]),isFocusedToastEscapeKeyDownRef:V,isClosePausedRef:H,children:E})})};VB.displayName=iA;var UB="ToastViewport",gJ=["F8"],Z2="toast.viewportPause",X2="toast.viewportResume",GB=fe.forwardRef((t,i)=>{const{__scopeToast:c,hotkey:f=gJ,label:_="Notifications ({hotkey})",...w}=t,E=mw(UB,c),o=fJ(c),k=fe.useRef(null),L=fe.useRef(null),N=fe.useRef(null),V=fe.useRef(null),H=Fs(i,V,E.onViewportChange),ne=f.join("+").replace(/Key/g,"").replace(/Digit/g,""),ce=E.toastCount>0;fe.useEffect(()=>{const se=Y=>{var ae;f.length!==0&&f.every(Te=>Y[Te]||Y.code===Te)&&((ae=V.current)==null||ae.focus())};return document.addEventListener("keydown",se),()=>document.removeEventListener("keydown",se)},[f]),fe.useEffect(()=>{const se=k.current,Y=V.current;if(ce&&se&&Y){const Q=()=>{if(!E.isClosePausedRef.current){const et=new CustomEvent(Z2);Y.dispatchEvent(et),E.isClosePausedRef.current=!0}},ae=()=>{if(E.isClosePausedRef.current){const et=new CustomEvent(X2);Y.dispatchEvent(et),E.isClosePausedRef.current=!1}},Te=et=>{!se.contains(et.relatedTarget)&&ae()},Be=()=>{se.contains(document.activeElement)||ae()};return se.addEventListener("focusin",Q),se.addEventListener("focusout",Te),se.addEventListener("pointermove",Q),se.addEventListener("pointerleave",Be),window.addEventListener("blur",Q),window.addEventListener("focus",ae),()=>{se.removeEventListener("focusin",Q),se.removeEventListener("focusout",Te),se.removeEventListener("pointermove",Q),se.removeEventListener("pointerleave",Be),window.removeEventListener("blur",Q),window.removeEventListener("focus",ae)}}},[ce,E.isClosePausedRef]);const K=fe.useCallback(({tabbingDirection:se})=>{const Q=o().map(ae=>{const Te=ae.ref.current,Be=[Te,...PJ(Te)];return se==="forwards"?Be:Be.reverse()});return(se==="forwards"?Q.reverse():Q).flat()},[o]);return fe.useEffect(()=>{const se=V.current;if(se){const Y=Q=>{var Be,et,nt;const ae=Q.altKey||Q.ctrlKey||Q.metaKey;if(Q.key==="Tab"&&!ae){const Je=document.activeElement,Dt=Q.shiftKey;if(Q.target===se&&Dt){(Be=L.current)==null||Be.focus();return}const qt=K({tabbingDirection:Dt?"backwards":"forwards"}),ln=qt.findIndex(Ht=>Ht===Je);vS(qt.slice(ln+1))?Q.preventDefault():Dt?(et=L.current)==null||et.focus():(nt=N.current)==null||nt.focus()}};return se.addEventListener("keydown",Y),()=>se.removeEventListener("keydown",Y)}},[o,K]),B.jsxs(xK,{ref:k,role:"region","aria-label":_.replace("{hotkey}",ne),tabIndex:-1,style:{pointerEvents:ce?void 0:"none"},children:[ce&&B.jsx(K2,{ref:L,onFocusFromOutsideViewport:()=>{const se=K({tabbingDirection:"forwards"});vS(se)}}),B.jsx(rA.Slot,{scope:c,children:B.jsx(ar.ol,{tabIndex:-1,...w,ref:H})}),ce&&B.jsx(K2,{ref:N,onFocusFromOutsideViewport:()=>{const se=K({tabbingDirection:"backwards"});vS(se)}})]})});GB.displayName=UB;var $B="ToastFocusProxy",K2=fe.forwardRef((t,i)=>{const{__scopeToast:c,onFocusFromOutsideViewport:f,..._}=t,w=mw($B,c);return B.jsx(nA,{tabIndex:0,..._,ref:i,style:{position:"fixed"},onFocus:E=>{var L;const o=E.relatedTarget;!((L=w.viewport)!=null&&L.contains(o))&&f()}})});K2.displayName=$B;var lv="Toast",_J="toast.swipeStart",yJ="toast.swipeMove",vJ="toast.swipeCancel",xJ="toast.swipeEnd",HB=fe.forwardRef((t,i)=>{const{forceMount:c,open:f,defaultOpen:_,onOpenChange:w,...E}=t,[o,k]=BI({prop:f,defaultProp:_??!0,onChange:w,caller:lv});return B.jsx(av,{present:c||o,children:B.jsx(TJ,{open:o,...E,ref:i,onClose:()=>k(!1),onPause:Wl(t.onPause),onResume:Wl(t.onResume),onSwipeStart:Rr(t.onSwipeStart,L=>{L.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Rr(t.onSwipeMove,L=>{const{x:N,y:V}=L.detail.delta;L.currentTarget.setAttribute("data-swipe","move"),L.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${N}px`),L.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${V}px`)}),onSwipeCancel:Rr(t.onSwipeCancel,L=>{L.currentTarget.setAttribute("data-swipe","cancel"),L.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),L.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),L.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),L.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Rr(t.onSwipeEnd,L=>{const{x:N,y:V}=L.detail.delta;L.currentTarget.setAttribute("data-swipe","end"),L.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),L.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),L.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${N}px`),L.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${V}px`),k(!1)})})})});HB.displayName=lv;var[wJ,bJ]=jB(lv,{onClose(){}}),TJ=fe.forwardRef((t,i)=>{const{__scopeToast:c,type:f="foreground",duration:_,open:w,onClose:E,onEscapeKeyDown:o,onPause:k,onResume:L,onSwipeStart:N,onSwipeMove:V,onSwipeCancel:H,onSwipeEnd:ne,...ce}=t,K=mw(lv,c),[se,Y]=fe.useState(null),Q=Fs(i,Ht=>Y(Ht)),ae=fe.useRef(null),Te=fe.useRef(null),Be=_||K.duration,et=fe.useRef(0),nt=fe.useRef(Be),Je=fe.useRef(0),{onToastAdd:Dt,onToastRemove:wt}=K,xt=Wl(()=>{var cn;(se==null?void 0:se.contains(document.activeElement))&&((cn=K.viewport)==null||cn.focus()),E()}),qt=fe.useCallback(Ht=>{!Ht||Ht===1/0||(window.clearTimeout(Je.current),et.current=new Date().getTime(),Je.current=window.setTimeout(xt,Ht))},[xt]);fe.useEffect(()=>{const Ht=K.viewport;if(Ht){const cn=()=>{qt(nt.current),L==null||L()},pn=()=>{const Rn=new Date().getTime()-et.current;nt.current=nt.current-Rn,window.clearTimeout(Je.current),k==null||k()};return Ht.addEventListener(Z2,pn),Ht.addEventListener(X2,cn),()=>{Ht.removeEventListener(Z2,pn),Ht.removeEventListener(X2,cn)}}},[K.viewport,Be,k,L,qt]),fe.useEffect(()=>{w&&!K.isClosePausedRef.current&&qt(Be)},[w,Be,K.isClosePausedRef,qt]),fe.useEffect(()=>(Dt(),()=>wt()),[Dt,wt]);const ln=fe.useMemo(()=>se?JB(se):null,[se]);return K.viewport?B.jsxs(B.Fragment,{children:[ln&&B.jsx(SJ,{__scopeToast:c,role:"status","aria-live":f==="foreground"?"assertive":"polite",children:ln}),B.jsx(wJ,{scope:c,onClose:xt,children:Q1.createPortal(B.jsx(rA.ItemSlot,{scope:c,children:B.jsx(vK,{asChild:!0,onEscapeKeyDown:Rr(o,()=>{K.isFocusedToastEscapeKeyDownRef.current||xt(),K.isFocusedToastEscapeKeyDownRef.current=!1}),children:B.jsx(ar.li,{tabIndex:0,"data-state":w?"open":"closed","data-swipe-direction":K.swipeDirection,...ce,ref:Q,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:Rr(t.onKeyDown,Ht=>{Ht.key==="Escape"&&(o==null||o(Ht.nativeEvent),Ht.nativeEvent.defaultPrevented||(K.isFocusedToastEscapeKeyDownRef.current=!0,xt()))}),onPointerDown:Rr(t.onPointerDown,Ht=>{Ht.button===0&&(ae.current={x:Ht.clientX,y:Ht.clientY})}),onPointerMove:Rr(t.onPointerMove,Ht=>{if(!ae.current)return;const cn=Ht.clientX-ae.current.x,pn=Ht.clientY-ae.current.y,Rn=!!Te.current,Nt=["left","right"].includes(K.swipeDirection),sn=["left","up"].includes(K.swipeDirection)?Math.min:Math.max,Tn=Nt?sn(0,cn):0,on=Nt?0:sn(0,pn),Xn=Ht.pointerType==="touch"?10:2,_r={x:Tn,y:on},ir={originalEvent:Ht,delta:_r};Rn?(Te.current=_r,P0(yJ,V,ir,{discrete:!1})):IL(_r,K.swipeDirection,Xn)?(Te.current=_r,P0(_J,N,ir,{discrete:!1}),Ht.target.setPointerCapture(Ht.pointerId)):(Math.abs(cn)>Xn||Math.abs(pn)>Xn)&&(ae.current=null)}),onPointerUp:Rr(t.onPointerUp,Ht=>{const cn=Te.current,pn=Ht.target;if(pn.hasPointerCapture(Ht.pointerId)&&pn.releasePointerCapture(Ht.pointerId),Te.current=null,ae.current=null,cn){const Rn=Ht.currentTarget,Nt={originalEvent:Ht,delta:cn};IL(cn,K.swipeDirection,K.swipeThreshold)?P0(xJ,ne,Nt,{discrete:!0}):P0(vJ,H,Nt,{discrete:!0}),Rn.addEventListener("click",sn=>sn.preventDefault(),{once:!0})}})})})}),K.viewport)})]}):null}),SJ=t=>{const{__scopeToast:i,children:c,...f}=t,_=mw(lv,i),[w,E]=fe.useState(!1),[o,k]=fe.useState(!1);return AJ(()=>E(!0)),fe.useEffect(()=>{const L=window.setTimeout(()=>k(!0),1e3);return()=>window.clearTimeout(L)},[]),o?null:B.jsx(qI,{asChild:!0,children:B.jsx(nA,{...f,children:w&&B.jsxs(B.Fragment,{children:[_.label," ",c]})})})},EJ="ToastTitle",WB=fe.forwardRef((t,i)=>{const{__scopeToast:c,...f}=t;return B.jsx(ar.div,{...f,ref:i})});WB.displayName=EJ;var IJ="ToastDescription",qB=fe.forwardRef((t,i)=>{const{__scopeToast:c,...f}=t;return B.jsx(ar.div,{...f,ref:i})});qB.displayName=IJ;var ZB="ToastAction",XB=fe.forwardRef((t,i)=>{const{altText:c,...f}=t;return c.trim()?B.jsx(YB,{altText:c,asChild:!0,children:B.jsx(sA,{...f,ref:i})}):(console.error(`Invalid prop \`altText\` supplied to \`${ZB}\`. Expected non-empty \`string\`.`),null)});XB.displayName=ZB;var KB="ToastClose",sA=fe.forwardRef((t,i)=>{const{__scopeToast:c,...f}=t,_=bJ(KB,c);return B.jsx(YB,{asChild:!0,children:B.jsx(ar.button,{type:"button",...f,ref:i,onClick:Rr(t.onClick,_.onClose)})})});sA.displayName=KB;var YB=fe.forwardRef((t,i)=>{const{__scopeToast:c,altText:f,..._}=t;return B.jsx(ar.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":f||void 0,..._,ref:i})});function JB(t){const i=[];return Array.from(t.childNodes).forEach(f=>{if(f.nodeType===f.TEXT_NODE&&f.textContent&&i.push(f.textContent),CJ(f)){const _=f.ariaHidden||f.hidden||f.style.display==="none",w=f.dataset.radixToastAnnounceExclude==="";if(!_)if(w){const E=f.dataset.radixToastAnnounceAlt;E&&i.push(E)}else i.push(...JB(f))}}),i}function P0(t,i,c,{discrete:f}){const _=c.originalEvent.currentTarget,w=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:c});i&&_.addEventListener(t,i,{once:!0}),f?mN(_,w):_.dispatchEvent(w)}var IL=(t,i,c=0)=>{const f=Math.abs(t.x),_=Math.abs(t.y),w=f>_;return i==="left"||i==="right"?w&&f>c:!w&&_>c};function AJ(t=()=>{}){const i=Wl(t);Hl(()=>{let c=0,f=0;return c=window.requestAnimationFrame(()=>f=window.requestAnimationFrame(i)),()=>{window.cancelAnimationFrame(c),window.cancelAnimationFrame(f)}},[i])}function CJ(t){return t.nodeType===t.ELEMENT_NODE}function PJ(t){const i=[],c=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:f=>{const _=f.tagName==="INPUT"&&f.type==="hidden";return f.disabled||f.hidden||_?NodeFilter.FILTER_SKIP:f.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;c.nextNode();)i.push(c.currentNode);return i}function vS(t){const i=document.activeElement;return t.some(c=>c===i?!0:(c.focus(),document.activeElement!==i))}var MJ=VB,QB=GB,e5=HB,t5=WB,n5=qB,i5=XB,r5=sA;const RJ=MJ,s5=fe.forwardRef(({className:t,...i},c)=>B.jsx(QB,{ref:c,className:or("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...i}));s5.displayName=QB.displayName;const kJ=M3("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),o5=fe.forwardRef(({className:t,variant:i,...c},f)=>B.jsx(e5,{ref:f,className:or(kJ({variant:i}),t),...c}));o5.displayName=e5.displayName;const DJ=fe.forwardRef(({className:t,...i},c)=>B.jsx(i5,{ref:c,className:or("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...i}));DJ.displayName=i5.displayName;const a5=fe.forwardRef(({className:t,...i},c)=>B.jsx(r5,{ref:c,className:or("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...i,children:B.jsx(R3,{className:"h-4 w-4"})}));a5.displayName=r5.displayName;const l5=fe.forwardRef(({className:t,...i},c)=>B.jsx(t5,{ref:c,className:or("text-sm font-semibold",t),...i}));l5.displayName=t5.displayName;const c5=fe.forwardRef(({className:t,...i},c)=>B.jsx(n5,{ref:c,className:or("text-sm opacity-90",t),...i}));c5.displayName=n5.displayName;function LJ(){const{toasts:t}=uJ();return B.jsxs(RJ,{children:[t.map(function({id:i,title:c,description:f,action:_,...w}){return B.jsxs(o5,{...w,children:[B.jsxs("div",{className:"grid gap-1",children:[c&&B.jsx(l5,{children:c}),f&&B.jsx(c5,{children:f})]}),_,B.jsx(a5,{})]},i)}),B.jsx(s5,{})]})}const zJ=new z$({defaultOptions:{queries:{staleTime:60*1e3,refetchOnWindowFocus:!1}}});function Ap({children:t}){const{isAuthenticated:i,isLoading:c}=ev();return c?B.jsx(rJ,{}):i?B.jsx(B.Fragment,{children:t}):B.jsx(sG,{to:"/",replace:!0})}function OJ(){return B.jsxs(F$,{client:zJ,children:[B.jsxs(aG,{children:[B.jsx(Lu,{path:"/",element:B.jsx(s7,{})}),B.jsx(Lu,{path:"/onboarding/choice",element:B.jsx(Ap,{children:B.jsx(a7,{})})}),B.jsx(Lu,{path:"/onboarding/link-bank",element:B.jsx(Ap,{children:B.jsx(G7,{})})}),B.jsx(Lu,{path:"/onboarding/manual-setup",element:B.jsx(Ap,{children:B.jsx(SX,{})})}),B.jsx(Lu,{path:"/dashboard",element:B.jsx(Ap,{children:B.jsx(qY,{})})}),B.jsx(Lu,{path:"/recommendations",element:B.jsx(Ap,{children:B.jsx(ZY,{})})}),B.jsx(Lu,{path:"/profile",element:B.jsx(Ap,{children:B.jsx(iJ,{})})})]}),B.jsx(LJ,{})]})}const FJ="dev-0hgz613sulw430rh.us.auth0.com",NJ="qgQVzRtyehHQD3D0K2X6hCVN80AeGtYb",BJ="http://localhost:3000";xS.createRoot(document.getElementById("root")).render(B.jsx(Ka.StrictMode,{children:B.jsx(c$,{domain:FJ,clientId:NJ,authorizationParams:{redirect_uri:BJ},cacheLocation:"localstorage",children:B.jsx(pG,{children:B.jsx(OJ,{})})})}));
